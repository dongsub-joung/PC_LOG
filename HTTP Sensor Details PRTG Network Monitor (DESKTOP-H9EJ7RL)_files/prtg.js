if (!String.capitalize) String.prototype.capitalize = function capitalize() {
  return this.replace(/(^|\s)([a-z])/g, function(m, p1, p2) {
    return p1 + p2.toUpperCase() }) };
if (!String.camelCase) String.prototype.camelCase = function camelCase() {
  return this.replace(/(\-[a-z])/g, function($1) {
    return $1.toUpperCase().replace("-", "") }) };
if (!String.printf) String.prototype.printf = function printf(obj) {
  return this.replace(/{([^{}]*)}/g, function(a, b) {
    var r = obj[b];
    return typeof r === "string" ? r : typeof r === "number" ? r : a }) };
if (!String.ellipsis) String.prototype.ellipsis = function ellipsis(length) {
  return this.length > length ? this.substr(0, length) + String.fromCharCode(8230) : this };
if (!String.centerellipsis) String.prototype.centerellipsis = function centerellipsis(length) {
  return this.length > length ? this.substr(0, Math.floor(length / 2)) + String.fromCharCode(8230) + this.substr(Math.floor(length / -2)) : this };
if (!Math.sign) Math.sign = function sign(x) {
  return typeof x == "number" ? x ? x < 0 ? -1 : 1 : isNaN(x) ? NaN : 0 : NaN };
window.typeOf = function(t) {
  if (t instanceof $) return "jQuery";
  else return String(t.constructor).split(" ")[1].split("()").join("") };
if (!Date.addDays) Date.prototype.addDays = function(days) { this.setDate(this.getDate() + days) };
if (!Date.addHours) Date.prototype.addHours = function(hours) { this.setHours(this.getHours() + hours);
  return this };
if (!Date.addMinutes) Date.prototype.addMinutes = function(minutes) { this.setMinutes(this.getMinutes() + minutes);
  return this };
if (!Date.addMonth) Date.prototype.addMonth = function(month) { this.setMonth(this.getMonth() + month);
  return this };
if (!Date.toPrtgString) Date.prototype.toPrtgString = function() {
  return this.getFullYear() + "-" + _Prtg.Util.padNumber(this.getMonth() + 1, 2) + "-" + _Prtg.Util.padNumber(this.getDate(), 2) + "-" + _Prtg.Util.padNumber(this.getHours(), 2) + "-" + _Prtg.Util.padNumber(this.getMinutes(), 2) + "-" + _Prtg.Util.padNumber(this.getSeconds(), 2) };
;

// History plugin (Pushstate with hash fallback)
//https://github.com/browserstate/history.js/
//https://raw.github.com/browserstate/history.js/master/scripts/bundled/html4+html5/jquery.history.js
//Version: v1.8b2, June 22 2013
/*
    json2.js
    2012-10-08

    Public Domain.

    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.

    See http://www.JSON.org/js.html


    This code should be minified before deployment.
    See http://javascript.crockford.com/jsmin.html

    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO
    NOT CONTROL.


    This file creates a global JSON object containing two methods: stringify
    and parse.

        JSON.stringify(value, replacer, space)
            value       any JavaScript value, usually an object or array.

            replacer    an optional parameter that determines how object
                        values are stringified for objects. It can be a
                        function or an array of strings.

            space       an optional parameter that specifies the indentation
                        of nested structures. If it is omitted, the text will
                        be packed without extra whitespace. If it is a number,
                        it will specify the number of spaces to indent at each
                        level. If it is a string (such as '\t' or '&nbsp;'),
                        it contains the characters used to indent at each level.

            This method produces a JSON text from a JavaScript value.

            When an object value is found, if the object contains a toJSON
            method, its toJSON method will be called and the result will be
            stringified. A toJSON method does not serialize: it returns the
            value represented by the name/value pair that should be serialized,
            or undefined if nothing should be serialized. The toJSON method
            will be passed the key associated with the value, and this will be
            bound to the value

            For example, this would serialize Dates as ISO strings.

                Date.prototype.toJSON = function (key) {
                    function f(n) {
                        // Format integers to have at least two digits.
                        return n < 10 ? '0' + n : n;
                    }

                    return this.getUTCFullYear()   + '-' +
                         f(this.getUTCMonth() + 1) + '-' +
                         f(this.getUTCDate())      + 'T' +
                         f(this.getUTCHours())     + ':' +
                         f(this.getUTCMinutes())   + ':' +
                         f(this.getUTCSeconds())   + 'Z';
                };

            You can provide an optional replacer method. It will be passed the
            key and value of each member, with this bound to the containing
            object. The value that is returned from your method will be
            serialized. If your method returns undefined, then the member will
            be excluded from the serialization.

            If the replacer parameter is an array of strings, then it will be
            used to select the members to be serialized. It filters the results
            such that only members with keys listed in the replacer array are
            stringified.

            Values that do not have JSON representations, such as undefined or
            functions, will not be serialized. Such values in objects will be
            dropped; in arrays they will be replaced with null. You can use
            a replacer function to replace those with JSON values.
            JSON.stringify(undefined) returns undefined.

            The optional space parameter produces a stringification of the
            value that is filled with line breaks and indentation to make it
            easier to read.

            If the space parameter is a non-empty string, then that string will
            be used for indentation. If the space parameter is a number, then
            the indentation will be that many spaces.

            Example:

            text = JSON.stringify(['e', {pluribus: 'unum'}]);
            // text is '["e",{"pluribus":"unum"}]'


            text = JSON.stringify(['e', {pluribus: 'unum'}], null, '\t');
            // text is '[\n\t"e",\n\t{\n\t\t"pluribus": "unum"\n\t}\n]'

            text = JSON.stringify([new Date()], function (key, value) {
                return this[key] instanceof Date ?
                    'Date(' + this[key] + ')' : value;
            });
            // text is '["Date(---current time---)"]'


        JSON.parse(text, reviver)
            This method parses a JSON text to produce an object or array.
            It can throw a SyntaxError exception.

            The optional reviver parameter is a function that can filter and
            transform the results. It receives each of the keys and values,
            and its return value is used instead of the original value.
            If it returns what it received, then the structure is not modified.
            If it returns undefined then the member is deleted.

            Example:

            // Parse the text. Values that look like ISO date strings will
            // be converted to Date objects.

            myData = JSON.parse(text, function (key, value) {
                var a;
                if (typeof value === 'string') {
                    a =
/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(value);
                    if (a) {
                        return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],
                            +a[5], +a[6]));
                    }
                }
                return value;
            });

            myData = JSON.parse('["Date(09/09/2001)"]', function (key, value) {
                var d;
                if (typeof value === 'string' &&
                        value.slice(0, 5) === 'Date(' &&
                        value.slice(-1) === ')') {
                    d = new Date(value.slice(5, -1));
                    if (d) {
                        return d;
                    }
                }
                return value;
            });


    This is a reference implementation. You are free to copy, modify, or
    redistribute.
*/

/*jslint evil: true, regexp: true */

/*members "", "\b", "\t", "\n", "\f", "\r", "\"", JSON, "\\", apply,
    call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,
    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,
    lastIndex, length, parse, prototype, push, replace, slice, stringify,
    test, toJSON, toString, valueOf
*/


// Create a JSON object only if one does not already exist. We create the
// methods in a closure to avoid creating global variables.

if (typeof JSON !== 'object') {
    JSON = {};
}

(function () {
    'use strict';

    function f(n) {
        // Format integers to have at least two digits.
        return n < 10 ? '0' + n : n;
    }

    if (typeof Date.prototype.toJSON !== 'function') {

        Date.prototype.toJSON = function (key) {

            return isFinite(this.valueOf())
                ? this.getUTCFullYear()     + '-' +
                    f(this.getUTCMonth() + 1) + '-' +
                    f(this.getUTCDate())      + 'T' +
                    f(this.getUTCHours())     + ':' +
                    f(this.getUTCMinutes())   + ':' +
                    f(this.getUTCSeconds())   + 'Z'
                : null;
        };

        String.prototype.toJSON      =
            Number.prototype.toJSON  =
            Boolean.prototype.toJSON = function (key) {
                return this.valueOf();
            };
    }

    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        gap,
        indent,
        meta = {    // table of character substitutions
            '\b': '\\b',
            '\t': '\\t',
            '\n': '\\n',
            '\f': '\\f',
            '\r': '\\r',
            '"' : '\\"',
            '\\': '\\\\'
        },
        rep;


    function quote(string) {

// If the string contains no control characters, no quote characters, and no
// backslash characters, then we can safely slap some quotes around it.
// Otherwise we must also replace the offending characters with safe escape
// sequences.

        escapable.lastIndex = 0;
        return escapable.test(string) ? '"' + string.replace(escapable, function (a) {
            var c = meta[a];
            return typeof c === 'string'
                ? c
                : '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
        }) + '"' : '"' + string + '"';
    }


    function str(key, holder) {

// Produce a string from holder[key].

        var i,          // The loop counter.
            k,          // The member key.
            v,          // The member value.
            length,
            mind = gap,
            partial,
            value = holder[key];

// If the value has a toJSON method, call it to obtain a replacement value.

        if (value && typeof value === 'object' &&
                typeof value.toJSON === 'function') {
            value = value.toJSON(key);
        }

// If we were called with a replacer function, then call the replacer to
// obtain a replacement value.

        if (typeof rep === 'function') {
            value = rep.call(holder, key, value);
        }

// What happens next depends on the value's type.

        switch (typeof value) {
        case 'string':
            return quote(value);

        case 'number':

// JSON numbers must be finite. Encode non-finite numbers as null.

            return isFinite(value) ? String(value) : 'null';

        case 'boolean':
        case 'null':

// If the value is a boolean or null, convert it to a string. Note:
// typeof null does not produce 'null'. The case is included here in
// the remote chance that this gets fixed someday.

            return String(value);

// If the type is 'object', we might be dealing with an object or an array or
// null.

        case 'object':

// Due to a specification blunder in ECMAScript, typeof null is 'object',
// so watch out for that case.

            if (!value) {
                return 'null';
            }

// Make an array to hold the partial results of stringifying this object value.

            gap += indent;
            partial = [];

// Is the value an array?

            if (Object.prototype.toString.apply(value) === '[object Array]') {

// The value is an array. Stringify every element. Use null as a placeholder
// for non-JSON values.

                length = value.length;
                for (i = 0; i < length; i += 1) {
                    partial[i] = str(i, value) || 'null';
                }

// Join all of the elements together, separated with commas, and wrap them in
// brackets.

                v = partial.length === 0
                    ? '[]'
                    : gap
                    ? '[\n' + gap + partial.join(',\n' + gap) + '\n' + mind + ']'
                    : '[' + partial.join(',') + ']';
                gap = mind;
                return v;
            }

// If the replacer is an array, use it to select the members to be stringified.

            if (rep && typeof rep === 'object') {
                length = rep.length;
                for (i = 0; i < length; i += 1) {
                    if (typeof rep[i] === 'string') {
                        k = rep[i];
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            } else {

// Otherwise, iterate through all of the keys in the object.

                for (k in value) {
                    if (Object.prototype.hasOwnProperty.call(value, k)) {
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            }

// Join all of the member texts together, separated with commas,
// and wrap them in braces.

            v = partial.length === 0
                ? '{}'
                : gap
                ? '{\n' + gap + partial.join(',\n' + gap) + '\n' + mind + '}'
                : '{' + partial.join(',') + '}';
            gap = mind;
            return v;
        }
    }

// If the JSON object does not yet have a stringify method, give it one.

    if (typeof JSON.stringify !== 'function') {
        JSON.stringify = function (value, replacer, space) {

// The stringify method takes a value and an optional replacer, and an optional
// space parameter, and returns a JSON text. The replacer can be a function
// that can replace values, or an array of strings that will select the keys.
// A default replacer method can be provided. Use of the space parameter can
// produce text that is more easily readable.

            var i;
            gap = '';
            indent = '';

// If the space parameter is a number, make an indent string containing that
// many spaces.

            if (typeof space === 'number') {
                for (i = 0; i < space; i += 1) {
                    indent += ' ';
                }

// If the space parameter is a string, it will be used as the indent string.

            } else if (typeof space === 'string') {
                indent = space;
            }

// If there is a replacer, it must be a function or an array.
// Otherwise, throw an error.

            rep = replacer;
            if (replacer && typeof replacer !== 'function' &&
                    (typeof replacer !== 'object' ||
                    typeof replacer.length !== 'number')) {
                throw new Error('JSON.stringify');
            }

// Make a fake root object containing our value under the key of ''.
// Return the result of stringifying the value.

            return str('', {'': value});
        };
    }


// If the JSON object does not yet have a parse method, give it one.

    if (typeof JSON.parse !== 'function') {
        JSON.parse = function (text, reviver) {

// The parse method takes a text and an optional reviver function, and returns
// a JavaScript value if the text is a valid JSON text.

            var j;

            function walk(holder, key) {

// The walk method is used to recursively walk the resulting structure so
// that modifications can be made.

                var k, v, value = holder[key];
                if (value && typeof value === 'object') {
                    for (k in value) {
                        if (Object.prototype.hasOwnProperty.call(value, k)) {
                            v = walk(value, k);
                            if (v !== undefined) {
                                value[k] = v;
                            } else {
                                delete value[k];
                            }
                        }
                    }
                }
                return reviver.call(holder, key, value);
            }


// Parsing happens in four stages. In the first stage, we replace certain
// Unicode characters with escape sequences. JavaScript handles many characters
// incorrectly, either silently deleting them, or treating them as line endings.

            text = String(text);
            cx.lastIndex = 0;
            if (cx.test(text)) {
                text = text.replace(cx, function (a) {
                    return '\\u' +
                        ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
                });
            }

// In the second stage, we run the text against regular expressions that look
// for non-JSON patterns. We are especially concerned with '()' and 'new'
// because they can cause invocation, and '=' because it can cause mutation.
// But just to be safe, we want to reject all unexpected forms.

// We split the second stage into 4 regexp operations in order to work around
// crippling inefficiencies in IE's and Safari's regexp engines. First we
// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we
// replace all simple value tokens with ']' characters. Third, we delete all
// open brackets that follow a colon or comma or that begin the text. Finally,
// we look to see that the remaining characters are only whitespace or ']' or
// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.

            if (/^[\],:{}\s]*$/
                    .test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')
                        .replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']')
                        .replace(/(?:^|:|,)(?:\s*\[)+/g, ''))) {

// In the third stage we use the eval function to compile the text into a
// JavaScript structure. The '{' operator is subject to a syntactic ambiguity
// in JavaScript: it can begin a block or an object literal. We wrap the text
// in parens to eliminate the ambiguity.

                j = eval('(' + text + ')');

// In the optional fourth stage, we recursively walk the new structure, passing
// each name/value pair to a reviver function for possible transformation.

                return typeof reviver === 'function'
                    ? walk({'': j}, '')
                    : j;
            }

// If the text is not JSON parseable, then a SyntaxError is thrown.

            throw new SyntaxError('JSON.parse');
        };
    }
}());/**
 * History.js jQuery Adapter
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */

// Closure
(function(window,undefined){
  "use strict";

  // Localise Globals
  var
    History = window.History = window.History||{},
    jQuery = window.jQuery;

  // Check Existence
  if ( typeof History.Adapter !== 'undefined' ) {
    throw new Error('History.js Adapter has already been loaded...');
  }

  // Add the Adapter
  History.Adapter = {
    /**
     * History.Adapter.bind(el,event,callback)
     * @param {Element|string} el
     * @param {string} event - custom and standard events
     * @param {function} callback
     * @return {void}
     */
    bind: function(el,event,callback){
      jQuery(el).bind(event,callback);
    },

    /**
     * History.Adapter.trigger(el,event)
     * @param {Element|string} el
     * @param {string} event - custom and standard events
     * @param {Object=} extra - a object of extra event data (optional)
     * @return {void}
     */
    trigger: function(el,event,extra){
      jQuery(el).trigger(event,extra);
    },

    /**
     * History.Adapter.extractEventData(key,event,extra)
     * @param {string} key - key for the event data to extract
     * @param {string} event - custom and standard events
     * @param {Object=} extra - a object of extra event data (optional)
     * @return {mixed}
     */
    extractEventData: function(key,event,extra){
      // jQuery Native then jQuery Custom
      var result = (event && event.originalEvent && event.originalEvent[key]) || (extra && extra[key]) || undefined;

      // Return
      return result;
    },

    /**
     * History.Adapter.onDomLoad(callback)
     * @param {function} callback
     * @return {void}
     */
    onDomLoad: function(callback) {
      jQuery(callback);
    }
  };

  // Try and Initialise History
  if ( typeof History.init !== 'undefined' ) {
    History.init();
  }

})(window);

/**
 * History.js HTML4 Support
 * Depends on the HTML5 Support
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */

(function(window,undefined){
  "use strict";

  // ========================================================================
  // Initialise

  // Localise Globals
  var
    document = window.document, // Make sure we are using the correct document
    setTimeout = window.setTimeout||setTimeout,
    clearTimeout = window.clearTimeout||clearTimeout,
    setInterval = window.setInterval||setInterval,
    History = window.History = window.History||{}; // Public History Object

  // Check Existence
  if ( typeof History.initHtml4 !== 'undefined' ) {
    throw new Error('History.js HTML4 Support has already been loaded...');
  }


  // ========================================================================
  // Initialise HTML4 Support

  // Initialise HTML4 Support
  History.initHtml4 = function(){
    // Initialise
    if ( typeof History.initHtml4.initialized !== 'undefined' ) {
      // Already Loaded
      return false;
    }
    else {
      History.initHtml4.initialized = true;
    }


    // ====================================================================
    // Properties

    /**
     * History.enabled
     * Is History enabled?
     */
    History.enabled = true;


    // ====================================================================
    // Hash Storage

    /**
     * History.savedHashes
     * Store the hashes in an array
     */
    History.savedHashes = [];

    /**
     * History.isLastHash(newHash)
     * Checks if the hash is the last hash
     * @param {string} newHash
     * @return {boolean} true
     */
    History.isLastHash = function(newHash){
      // Prepare
      var oldHash = History.getHashByIndex(),
        isLast;

      // Check
      isLast = newHash === oldHash;

      // Return isLast
      return isLast;
    };

    /**
     * History.isHashEqual(newHash, oldHash)
     * Checks to see if two hashes are functionally equal
     * @param {string} newHash
     * @param {string} oldHash
     * @return {boolean} true
     */
    History.isHashEqual = function(newHash, oldHash){
      newHash = encodeURIComponent(newHash).replace(/%25/g, "%");
      oldHash = encodeURIComponent(oldHash).replace(/%25/g, "%");
      return newHash === oldHash;
    };

    /**
     * History.saveHash(newHash)
     * Push a Hash
     * @param {string} newHash
     * @return {boolean} true
     */
    History.saveHash = function(newHash){
      // Check Hash
      if ( History.isLastHash(newHash) ) {
        return false;
      }

      // Push the Hash
      History.savedHashes.push(newHash);

      // Return true
      return true;
    };

    /**
     * History.getHashByIndex()
     * Gets a hash by the index
     * @param {integer} index
     * @return {string}
     */
    History.getHashByIndex = function(index){
      // Prepare
      var hash = null;

      // Handle
      if ( typeof index === 'undefined' ) {
        // Get the last inserted
        hash = History.savedHashes[History.savedHashes.length-1];
      }
      else if ( index < 0 ) {
        // Get from the end
        hash = History.savedHashes[History.savedHashes.length+index];
      }
      else {
        // Get from the beginning
        hash = History.savedHashes[index];
      }

      // Return hash
      return hash;
    };


    // ====================================================================
    // Discarded States

    /**
     * History.discardedHashes
     * A hashed array of discarded hashes
     */
    History.discardedHashes = {};

    /**
     * History.discardedStates
     * A hashed array of discarded states
     */
    History.discardedStates = {};

    /**
     * History.discardState(State)
     * Discards the state by ignoring it through History
     * @param {object} State
     * @return {true}
     */
    History.discardState = function(discardedState,forwardState,backState){
      //History.debug('History.discardState', arguments);
      // Prepare
      var discardedStateHash = History.getHashByState(discardedState),
        discardObject;

      // Create Discard Object
      discardObject = {
        'discardedState': discardedState,
        'backState': backState,
        'forwardState': forwardState
      };

      // Add to DiscardedStates
      History.discardedStates[discardedStateHash] = discardObject;

      // Return true
      return true;
    };

    /**
     * History.discardHash(hash)
     * Discards the hash by ignoring it through History
     * @param {string} hash
     * @return {true}
     */
    History.discardHash = function(discardedHash,forwardState,backState){
      //History.debug('History.discardState', arguments);
      // Create Discard Object
      var discardObject = {
        'discardedHash': discardedHash,
        'backState': backState,
        'forwardState': forwardState
      };

      // Add to discardedHash
      History.discardedHashes[discardedHash] = discardObject;

      // Return true
      return true;
    };

    /**
     * History.discardedState(State)
     * Checks to see if the state is discarded
     * @param {object} State
     * @return {bool}
     */
    History.discardedState = function(State){
      // Prepare
      var StateHash = History.getHashByState(State),
        discarded;

      // Check
      discarded = History.discardedStates[StateHash]||false;

      // Return true
      return discarded;
    };

    /**
     * History.discardedHash(hash)
     * Checks to see if the state is discarded
     * @param {string} State
     * @return {bool}
     */
    History.discardedHash = function(hash){
      // Check
      var discarded = History.discardedHashes[hash]||false;

      // Return true
      return discarded;
    };

    /**
     * History.recycleState(State)
     * Allows a discarded state to be used again
     * @param {object} data
     * @param {string} title
     * @param {string} url
     * @return {true}
     */
    History.recycleState = function(State){
      //History.debug('History.recycleState', arguments);
      // Prepare
      var StateHash = History.getHashByState(State);

      // Remove from DiscardedStates
      if ( History.discardedState(State) ) {
        delete History.discardedStates[StateHash];
      }

      // Return true
      return true;
    };


    // ====================================================================
    // HTML4 HashChange Support

    if ( History.emulated.hashChange ) {
      /*
       * We must emulate the HTML4 HashChange Support by manually checking for hash changes
       */

      /**
       * History.hashChangeInit()
       * Init the HashChange Emulation
       */
      History.hashChangeInit = function(){
        // Define our Checker Function
        History.checkerFunction = null;

        // Define some variables that will help in our checker function
        var lastDocumentHash = '',
          iframeId, iframe,
          lastIframeHash, checkerRunning,
          startedWithHash = Boolean(History.getHash());

        // Handle depending on the browser
        if ( History.isInternetExplorer() ) {
          // IE6 and IE7
          // We need to use an iframe to emulate the back and forward buttons

          // Create iFrame
          iframeId = 'historyjs-iframe';
          iframe = document.createElement('iframe');

          // Adjust iFarme
          // IE 6 requires iframe to have a src on HTTPS pages, otherwise it will throw a
          // "This page contains both secure and nonsecure items" warning.
          iframe.setAttribute('id', iframeId);
          iframe.setAttribute('src', '#');
          iframe.style.display = 'none';

          // Append iFrame
          document.body.appendChild(iframe);

          // Create initial history entry
          iframe.contentWindow.document.open();
          iframe.contentWindow.document.close();

          // Define some variables that will help in our checker function
          lastIframeHash = '';
          checkerRunning = false;

          // Define the checker function
          History.checkerFunction = function(){
            // Check Running
            if ( checkerRunning ) {
              return false;
            }

            // Update Running
            checkerRunning = true;

            // Fetch
            var
              documentHash = History.getHash(),
              iframeHash = History.getHash(iframe.contentWindow.document);

            // The Document Hash has changed (application caused)
            if ( documentHash !== lastDocumentHash ) {
              // Equalise
              lastDocumentHash = documentHash;

              // Create a history entry in the iframe
              if ( iframeHash !== documentHash ) {
                //History.debug('hashchange.checker: iframe hash change', 'documentHash (new):', documentHash, 'iframeHash (old):', iframeHash);

                // Equalise
                lastIframeHash = iframeHash = documentHash;

                // Create History Entry
                iframe.contentWindow.document.open();
                iframe.contentWindow.document.close();

                // Update the iframe's hash
                iframe.contentWindow.document.location.hash = History.escapeHash(documentHash);
              }

              // Trigger Hashchange Event
              History.Adapter.trigger(window,'hashchange');
            }

            // The iFrame Hash has changed (back button caused)
            else if ( iframeHash !== lastIframeHash ) {
              //History.debug('hashchange.checker: iframe hash out of sync', 'iframeHash (new):', iframeHash, 'documentHash (old):', documentHash);

              // Equalise
              lastIframeHash = iframeHash;
              
              // If there is no iframe hash that means we're at the original
              // iframe state.
              // And if there was a hash on the original request, the original
              // iframe state was replaced instantly, so skip this state and take
              // the user back to where they came from.
              if (startedWithHash && iframeHash === '') {
                History.back();
              }
              else {
                // Update the Hash
                History.setHash(iframeHash,false);
              }
            }

            // Reset Running
            checkerRunning = false;

            // Return true
            return true;
          };
        }
        else {
          // We are not IE
          // Firefox 1 or 2, Opera

          // Define the checker function
          History.checkerFunction = function(){
            // Prepare
            var documentHash = History.getHash()||'';

            // The Document Hash has changed (application caused)
            if ( documentHash !== lastDocumentHash ) {
              // Equalise
              lastDocumentHash = documentHash;

              // Trigger Hashchange Event
              History.Adapter.trigger(window,'hashchange');
            }

            // Return true
            return true;
          };
        }

        // Apply the checker function
        History.intervalList.push(setInterval(History.checkerFunction, History.options.hashChangeInterval));

        // Done
        return true;
      }; // History.hashChangeInit

      // Bind hashChangeInit
      History.Adapter.onDomLoad(History.hashChangeInit);

    } // History.emulated.hashChange


    // ====================================================================
    // HTML5 State Support

    // Non-Native pushState Implementation
    if ( History.emulated.pushState ) {
      /*
       * We must emulate the HTML5 State Management by using HTML4 HashChange
       */

      /**
       * History.onHashChange(event)
       * Trigger HTML5's window.onpopstate via HTML4 HashChange Support
       */
      History.onHashChange = function(event){
        //History.debug('History.onHashChange', arguments);

        // Prepare
        var currentUrl = ((event && event.newURL) || History.getLocationHref()),
          currentHash = History.getHashByUrl(currentUrl),
          currentState = null,
          currentStateHash = null,
          currentStateHashExits = null,
          discardObject;

        // Check if we are the same state
        if ( History.isLastHash(currentHash) ) {
          // There has been no change (just the page's hash has finally propagated)
          //History.debug('History.onHashChange: no change');
          History.busy(false);
          return false;
        }

        // Reset the double check
        History.doubleCheckComplete();

        // Store our location for use in detecting back/forward direction
        History.saveHash(currentHash);

        // Expand Hash
        if ( currentHash && History.isTraditionalAnchor(currentHash) ) {
          //History.debug('History.onHashChange: traditional anchor', currentHash);
          // Traditional Anchor Hash
          History.Adapter.trigger(window,'anchorchange');
          History.busy(false);
          return false;
        }

        // Create State
        currentState = History.extractState(History.getFullUrl(currentHash||History.getLocationHref()),true);

        // Check if we are the same state
        if ( History.isLastSavedState(currentState) ) {
          //History.debug('History.onHashChange: no change');
          // There has been no change (just the page's hash has finally propagated)
          History.busy(false);
          return false;
        }

        // Create the state Hash
        currentStateHash = History.getHashByState(currentState);

        // Check if we are DiscardedState
        discardObject = History.discardedState(currentState);
        if ( discardObject ) {
          // Ignore this state as it has been discarded and go back to the state before it
          if ( History.getHashByIndex(-2) === History.getHashByState(discardObject.forwardState) ) {
            // We are going backwards
            //History.debug('History.onHashChange: go backwards');
            History.back(false);
          } else {
            // We are going forwards
            //History.debug('History.onHashChange: go forwards');
            History.forward(false);
          }
          return false;
        }

        // Push the new HTML5 State
        //History.debug('History.onHashChange: success hashchange');
        History.pushState(currentState.data,currentState.title,encodeURI(currentState.url),false);

        // End onHashChange closure
        return true;
      };
      History.Adapter.bind(window,'hashchange',History.onHashChange);

      /**
       * History.pushState(data,title,url)
       * Add a new State to the history object, become it, and trigger onpopstate
       * We have to trigger for HTML4 compatibility
       * @param {object} data
       * @param {string} title
       * @param {string} url
       * @return {true}
       */
      History.pushState = function(data,title,url,queue){
        //History.debug('History.pushState: called', arguments);

        // We assume that the URL passed in is URI-encoded, but this makes
        // sure that it's fully URI encoded; any '%'s that are encoded are
        // converted back into '%'s
        url = encodeURI(url).replace(/%25/g, "%");

        // Check the State
        if ( History.getHashByUrl(url) ) {
          throw new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');
        }

        // Handle Queueing
        if ( queue !== false && History.busy() ) {
          // Wait + Push to Queue
          //History.debug('History.pushState: we must wait', arguments);
          History.pushQueue({
            scope: History,
            callback: History.pushState,
            args: arguments,
            queue: queue
          });
          return false;
        }

        // Make Busy
        History.busy(true);

        // Fetch the State Object
        var newState = History.createStateObject(data,title,url),
          newStateHash = History.getHashByState(newState),
          oldState = History.getState(false),
          oldStateHash = History.getHashByState(oldState),
          html4Hash = History.getHash(),
          wasExpected = History.expectedStateId == newState.id;

        // Store the newState
        History.storeState(newState);
        History.expectedStateId = newState.id;

        // Recycle the State
        History.recycleState(newState);

        // Force update of the title
        History.setTitle(newState);

        // Check if we are the same State
        if ( newStateHash === oldStateHash ) {
          //History.debug('History.pushState: no change', newStateHash);
          History.busy(false);
          return false;
        }

        // Update HTML5 State
        History.saveState(newState);

        // Fire HTML5 Event
        if(!wasExpected)
          History.Adapter.trigger(window,'statechange');

        // Update HTML4 Hash
        if ( !History.isHashEqual(newStateHash, html4Hash) && !History.isHashEqual(newStateHash, History.getShortUrl(History.getLocationHref())) ) {
          History.setHash(newStateHash,false);
        }
        
        History.busy(false);

        // End pushState closure
        return true;
      };

      /**
       * History.replaceState(data,title,url)
       * Replace the State and trigger onpopstate
       * We have to trigger for HTML4 compatibility
       * @param {object} data
       * @param {string} title
       * @param {string} url
       * @return {true}
       */
      History.replaceState = function(data,title,url,queue){
        //History.debug('History.replaceState: called', arguments);

        // We assume that the URL passed in is URI-encoded, but this makes
        // sure that it's fully URI encoded; any '%'s that are encoded are
        // converted back into '%'s
        url = encodeURI(url).replace(/%25/g, "%");

        // Check the State
        if ( History.getHashByUrl(url) ) {
          throw new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');
        }

        // Handle Queueing
        if ( queue !== false && History.busy() ) {
          // Wait + Push to Queue
          //History.debug('History.replaceState: we must wait', arguments);
          History.pushQueue({
            scope: History,
            callback: History.replaceState,
            args: arguments,
            queue: queue
          });
          return false;
        }

        // Make Busy
        History.busy(true);

        // Fetch the State Objects
        var newState        = History.createStateObject(data,title,url),
          newStateHash = History.getHashByState(newState),
          oldState        = History.getState(false),
          oldStateHash = History.getHashByState(oldState),
          previousState   = History.getStateByIndex(-2);

        // Discard Old State
        History.discardState(oldState,newState,previousState);

        // If the url hasn't changed, just store and save the state
        // and fire a statechange event to be consistent with the
        // html 5 api
        if ( newStateHash === oldStateHash ) {
          // Store the newState
          History.storeState(newState);
          History.expectedStateId = newState.id;
  
          // Recycle the State
          History.recycleState(newState);
  
          // Force update of the title
          History.setTitle(newState);
          
          // Update HTML5 State
          History.saveState(newState);

          // Fire HTML5 Event
          //History.debug('History.pushState: trigger popstate');
          History.Adapter.trigger(window,'statechange');
          History.busy(false);
        }
        else {
          // Alias to PushState
          History.pushState(newState.data,newState.title,newState.url,false);
        }

        // End replaceState closure
        return true;
      };

    } // History.emulated.pushState



    // ====================================================================
    // Initialise

    // Non-Native pushState Implementation
    if ( History.emulated.pushState ) {
      /**
       * Ensure initial state is handled correctly
       */
      if ( History.getHash() && !History.emulated.hashChange ) {
        History.Adapter.onDomLoad(function(){
          History.Adapter.trigger(window,'hashchange');
        });
      }

    } // History.emulated.pushState

  }; // History.initHtml4

  // Try to Initialise History
  if ( typeof History.init !== 'undefined' ) {
    History.init();
  }

})(window);
/**
 * History.js Core
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */

(function(window,undefined){
  "use strict";

  // ========================================================================
  // Initialise

  // Localise Globals
  var
    console = window.console||undefined, // Prevent a JSLint complain
    document = window.document, // Make sure we are using the correct document
    navigator = window.navigator, // Make sure we are using the correct navigator
    sessionStorage = false, // sessionStorage
    setTimeout = window.setTimeout,
    clearTimeout = window.clearTimeout,
    setInterval = window.setInterval,
    clearInterval = window.clearInterval,
    JSON = window.JSON,
    alert = window.alert,
    History = window.History = window.History||{}, // Public History Object
    history = window.history; // Old History Object

  try {
    sessionStorage = window.sessionStorage; // This will throw an exception in some browsers when cookies/localStorage are explicitly disabled (i.e. Chrome)
    sessionStorage.setItem('TEST', '1');
    sessionStorage.removeItem('TEST');
  } catch(e) {
    sessionStorage = false;
  }

  // MooTools Compatibility
  JSON.stringify = JSON.stringify||JSON.encode;
  JSON.parse = JSON.parse||JSON.decode;

  // Check Existence
  if ( typeof History.init !== 'undefined' ) {
    throw new Error('History.js Core has already been loaded...');
  }

  // Initialise History
  History.init = function(options){
    // Check Load Status of Adapter
    if ( typeof History.Adapter === 'undefined' ) {
      return false;
    }

    // Check Load Status of Core
    if ( typeof History.initCore !== 'undefined' ) {
      History.initCore();
    }

    // Check Load Status of HTML4 Support
    if ( typeof History.initHtml4 !== 'undefined' ) {
      History.initHtml4();
    }

    // Return true
    return true;
  };


  // ========================================================================
  // Initialise Core

  // Initialise Core
  History.initCore = function(options){
    // Initialise
    if ( typeof History.initCore.initialized !== 'undefined' ) {
      // Already Loaded
      return false;
    }
    else {
      History.initCore.initialized = true;
    }


    // ====================================================================
    // Options

    /**
     * History.options
     * Configurable options
     */
    History.options = History.options||{};

    /**
     * History.options.hashChangeInterval
     * How long should the interval be before hashchange checks
     */
    History.options.hashChangeInterval = History.options.hashChangeInterval || 100;

    /**
     * History.options.safariPollInterval
     * How long should the interval be before safari poll checks
     */
    History.options.safariPollInterval = History.options.safariPollInterval || 500;

    /**
     * History.options.doubleCheckInterval
     * How long should the interval be before we perform a double check
     */
    History.options.doubleCheckInterval = History.options.doubleCheckInterval || 500;

    /**
     * History.options.disableSuid
     * Force History not to append suid
     */
    History.options.disableSuid = History.options.disableSuid || false;

    /**
     * History.options.storeInterval
     * How long should we wait between store calls
     */
    History.options.storeInterval = History.options.storeInterval || 1000;

    /**
     * History.options.busyDelay
     * How long should we wait between busy events
     */
    History.options.busyDelay = History.options.busyDelay || 250;

    /**
     * History.options.debug
     * If true will enable debug messages to be logged
     */
    History.options.debug = History.options.debug || false;

    /**
     * History.options.initialTitle
     * What is the title of the initial state
     */
    History.options.initialTitle = History.options.initialTitle || document.title;

    /**
     * History.options.html4Mode
     * If true, will force HTMl4 mode (hashtags)
     */
    History.options.html4Mode = History.options.html4Mode || false;

    /**
     * History.options.delayInit
     * Want to override default options and call init manually.
     */
    History.options.delayInit = History.options.delayInit || false;


    // ====================================================================
    // Interval record

    /**
     * History.intervalList
     * List of intervals set, to be cleared when document is unloaded.
     */
    History.intervalList = [];

    /**
     * History.clearAllIntervals
     * Clears all setInterval instances.
     */
    History.clearAllIntervals = function(){
      var i, il = History.intervalList;
      if (typeof il !== "undefined" && il !== null) {
        for (i = 0; i < il.length; i++) {
          clearInterval(il[i]);
        }
        History.intervalList = null;
      }
    };


    // ====================================================================
    // Debug

    /**
     * History.debug(message,...)
     * Logs the passed arguments if debug enabled
     */
    History.debug = function(){
      if ( (History.options.debug||false) ) {
        History.log.apply(History,arguments);
      }
    };

    /**
     * History.log(message,...)
     * Logs the passed arguments
     */
    History.log = function(){
      // Prepare
      var
        consoleExists = !(typeof console === 'undefined' || typeof console.log === 'undefined' || typeof console.log.apply === 'undefined'),
        textarea = document.getElementById('log'),
        message,
        i,n,
        args,arg
        ;

      // Write to Console
      if ( consoleExists ) {
        args = Array.prototype.slice.call(arguments);
        message = args.shift();
        if ( typeof console.debug !== 'undefined' ) {
          console.debug.apply(console,[message,args]);
        }
        else {
          console.log.apply(console,[message,args]);
        }
      }
      else {
        message = ("\n"+arguments[0]+"\n");
      }

      // Write to log
      for ( i=1,n=arguments.length; i<n; ++i ) {
        arg = arguments[i];
        if ( typeof arg === 'object' && typeof JSON !== 'undefined' ) {
          try {
            arg = JSON.stringify(arg);
          }
          catch ( Exception ) {
            // Recursive Object
          }
        }
        message += "\n"+arg+"\n";
      }

      // Textarea
      if ( textarea ) {
        textarea.value += message+"\n-----\n";
        textarea.scrollTop = textarea.scrollHeight - textarea.clientHeight;
      }
      // No Textarea, No Console
      else if ( !consoleExists ) {
        alert(message);
      }

      // Return true
      return true;
    };


    // ====================================================================
    // Emulated Status

    /**
     * History.getInternetExplorerMajorVersion()
     * Get's the major version of Internet Explorer
     * @return {integer}
     * @license Public Domain
     * @author Benjamin Arthur Lupton <contact@balupton.com>
     * @author James Padolsey <https://gist.github.com/527683>
     */
    History.getInternetExplorerMajorVersion = function(){
      var result = History.getInternetExplorerMajorVersion.cached =
          (typeof History.getInternetExplorerMajorVersion.cached !== 'undefined')
        ? History.getInternetExplorerMajorVersion.cached
        : (function(){
            var v = 3,
                div = document.createElement('div'),
                all = div.getElementsByTagName('i');
            while ( (div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->') && all[0] ) {}
            return (v > 4) ? v : false;
          })()
        ;
      return result;
    };

    /**
     * History.isInternetExplorer()
     * Are we using Internet Explorer?
     * @return {boolean}
     * @license Public Domain
     * @author Benjamin Arthur Lupton <contact@balupton.com>
     */
    History.isInternetExplorer = function(){
      var result =
        History.isInternetExplorer.cached =
        (typeof History.isInternetExplorer.cached !== 'undefined')
          ? History.isInternetExplorer.cached
          : Boolean(History.getInternetExplorerMajorVersion())
        ;
      return result;
    };

    /**
     * History.emulated
     * Which features require emulating?
     */

    if (History.options.html4Mode) {
      History.emulated = {
        pushState : true,
        hashChange: true
      };
    }

    else {

      History.emulated = {
        pushState: !Boolean(
          window.history && window.history.pushState && window.history.replaceState
          && !(
            (/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent) /* disable for versions of iOS before version 4.3 (8F190) */
            || (/AppleWebKit\/5([0-2]|3[0-2])/i).test(navigator.userAgent) /* disable for the mercury iOS browser, or at least older versions of the webkit engine */
          )
        ),
        hashChange: Boolean(
          !(('onhashchange' in window) && ('onhashchange' in document))
          ||
          (History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8)
        )
      };
    }

    /**
     * History.enabled
     * Is History enabled?
     */
    History.enabled = !History.emulated.pushState;

    /**
     * History.bugs
     * Which bugs are present
     */
    History.bugs = {
      /**
       * Safari 5 and Safari iOS 4 fail to return to the correct state once a hash is replaced by a `replaceState` call
       * https://bugs.webkit.org/show_bug.cgi?id=56249
       */
      setHash: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

      /**
       * Safari 5 and Safari iOS 4 sometimes fail to apply the state change under busy conditions
       * https://bugs.webkit.org/show_bug.cgi?id=42940
       */
      safariPoll: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

      /**
       * MSIE 6 and 7 sometimes do not apply a hash even it was told to (requiring a second call to the apply function)
       */
      ieDoubleCheck: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8),

      /**
       * MSIE 6 requires the entire hash to be encoded for the hashes to trigger the onHashChange event
       */
      hashEscape: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 7)
    };

    /**
     * History.isEmptyObject(obj)
     * Checks to see if the Object is Empty
     * @param {Object} obj
     * @return {boolean}
     */
    History.isEmptyObject = function(obj) {
      for ( var name in obj ) {
        if ( obj.hasOwnProperty(name) ) {
          return false;
        }
      }
      return true;
    };

    /**
     * History.cloneObject(obj)
     * Clones a object and eliminate all references to the original contexts
     * @param {Object} obj
     * @return {Object}
     */
    History.cloneObject = function(obj) {
      var hash,newObj;
      if ( obj ) {
        hash = JSON.stringify(obj);
        newObj = JSON.parse(hash);
      }
      else {
        newObj = {};
      }
      return newObj;
    };


    // ====================================================================
    // URL Helpers

    /**
     * History.getRootUrl()
     * Turns "http://mysite.com/dir/page.html?asd" into "http://mysite.com"
     * @return {String} rootUrl
     */
    History.getRootUrl = function(){
      // Create
      var rootUrl = document.location.protocol+'//'+(document.location.hostname||document.location.host);
      if ( document.location.port||false ) {
        rootUrl += ':'+document.location.port;
      }
      rootUrl += '/';

      // Return
      return rootUrl;
    };

    /**
     * History.getBaseHref()
     * Fetches the `href` attribute of the `<base href="...">` element if it exists
     * @return {String} baseHref
     */
    History.getBaseHref = function(){
      // Create
      var
        baseElements = document.getElementsByTagName('base'),
        baseElement = null,
        baseHref = '';

      // Test for Base Element
      if ( baseElements.length === 1 ) {
        // Prepare for Base Element
        baseElement = baseElements[0];
        baseHref = baseElement.href.replace(/[^\/]+$/,'');
      }

      // Adjust trailing slash
      baseHref = baseHref.replace(/\/+$/,'');
      if ( baseHref ) baseHref += '/';

      // Return
      return baseHref;
    };

    /**
     * History.getBaseUrl()
     * Fetches the baseHref or basePageUrl or rootUrl (whichever one exists first)
     * @return {String} baseUrl
     */
    History.getBaseUrl = function(){
      // Create
      var baseUrl = History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();

      // Return
      return baseUrl;
    };

    /**
     * History.getPageUrl()
     * Fetches the URL of the current page
     * @return {String} pageUrl
     */
    History.getPageUrl = function(){
      // Fetch
      var
        State = History.getState(false,false),
        stateUrl = (State||{}).url||History.getLocationHref(),
        pageUrl;

      // Create
      pageUrl = stateUrl.replace(/\/+$/,'').replace(/[^\/]+$/,function(part,index,string){
        return (/\./).test(part) ? part : part+'/';
      });

      // Return
      return pageUrl;
    };

    /**
     * History.getBasePageUrl()
     * Fetches the Url of the directory of the current page
     * @return {String} basePageUrl
     */
    History.getBasePageUrl = function(){
      // Create
      var basePageUrl = (History.getLocationHref()).replace(/[#\?].*/,'').replace(/[^\/]+$/,function(part,index,string){
        return (/[^\/]$/).test(part) ? '' : part;
      }).replace(/\/+$/,'')+'/';

      // Return
      return basePageUrl;
    };

    /**
     * History.getFullUrl(url)
     * Ensures that we have an absolute URL and not a relative URL
     * @param {string} url
     * @param {Boolean} allowBaseHref
     * @return {string} fullUrl
     */
    History.getFullUrl = function(url,allowBaseHref){
      // Prepare
      var fullUrl = url, firstChar = url.substring(0,1);
      allowBaseHref = (typeof allowBaseHref === 'undefined') ? true : allowBaseHref;

      // Check
      if ( /[a-z]+\:\/\//.test(url) ) {
        // Full URL
      }
      else if ( firstChar === '/' ) {
        // Root URL
        fullUrl = History.getRootUrl()+url.replace(/^\/+/,'');
      }
      else if ( firstChar === '#' ) {
        // Anchor URL
        fullUrl = History.getPageUrl().replace(/#.*/,'')+url;
      }
      else if ( firstChar === '?' ) {
        // Query URL
        fullUrl = History.getPageUrl().replace(/[\?#].*/,'')+url;
      }
      else {
        // Relative URL
        if ( allowBaseHref ) {
          fullUrl = History.getBaseUrl()+url.replace(/^(\.\/)+/,'');
        } else {
          fullUrl = History.getBasePageUrl()+url.replace(/^(\.\/)+/,'');
        }
        // We have an if condition above as we do not want hashes
        // which are relative to the baseHref in our URLs
        // as if the baseHref changes, then all our bookmarks
        // would now point to different locations
        // whereas the basePageUrl will always stay the same
      }

      // Return
      return fullUrl.replace(/\#$/,'');
    };

    /**
     * History.getShortUrl(url)
     * Ensures that we have a relative URL and not a absolute URL
     * @param {string} url
     * @return {string} url
     */
    History.getShortUrl = function(url){
      // Prepare
      var shortUrl = url, baseUrl = History.getBaseUrl(), rootUrl = History.getRootUrl();

      // Trim baseUrl
      if ( History.emulated.pushState ) {
        // We are in a if statement as when pushState is not emulated
        // The actual url these short urls are relative to can change
        // So within the same session, we the url may end up somewhere different
        shortUrl = shortUrl.replace(baseUrl,'');
      }

      // Trim rootUrl
      shortUrl = shortUrl.replace(rootUrl,'/');

      // Ensure we can still detect it as a state
      if ( History.isTraditionalAnchor(shortUrl) ) {
        shortUrl = './'+shortUrl;
      }

      // Clean It
      shortUrl = shortUrl.replace(/^(\.\/)+/g,'./').replace(/\#$/,'');

      // Return
      return shortUrl;
    };

    /**
     * History.getLocationHref(document)
     * Returns a normalized version of document.location.href
     * accounting for browser inconsistencies, etc.
     *
     * This URL will be URI-encoded and will include the hash
     *
     * @param {object} document
     * @return {string} url
     */
    History.getLocationHref = function(doc) {
      doc = doc || document;

      // most of the time, this will be true
      if (doc.URL === doc.location.href)
        return doc.location.href;

      // some versions of webkit URI-decode document.location.href
      // but they leave document.URL in an encoded state
      if (doc.location.href === decodeURIComponent(doc.URL))
        return doc.URL;

      // FF 3.6 only updates document.URL when a page is reloaded
      // document.location.href is updated correctly
      if (doc.location.hash && decodeURIComponent(doc.location.href.replace(/^[^#]+/, "")) === doc.location.hash)
        return doc.location.href;

      if (doc.URL.indexOf('#') == -1 && doc.location.href.indexOf('#') != -1)
        return doc.location.href;
      
      return doc.URL || doc.location.href;
    };


    // ====================================================================
    // State Storage

    /**
     * History.store
     * The store for all session specific data
     */
    History.store = {};

    /**
     * History.idToState
     * 1-1: State ID to State Object
     */
    History.idToState = History.idToState||{};

    /**
     * History.stateToId
     * 1-1: State String to State ID
     */
    History.stateToId = History.stateToId||{};

    /**
     * History.urlToId
     * 1-1: State URL to State ID
     */
    History.urlToId = History.urlToId||{};

    /**
     * History.storedStates
     * Store the states in an array
     */
    History.storedStates = History.storedStates||[];

    /**
     * History.savedStates
     * Saved the states in an array
     */
    History.savedStates = History.savedStates||[];

    /**
     * History.noramlizeStore()
     * Noramlize the store by adding necessary values
     */
    History.normalizeStore = function(){
      History.store.idToState = History.store.idToState||{};
      History.store.urlToId = History.store.urlToId||{};
      History.store.stateToId = History.store.stateToId||{};
    };

    /**
     * History.getState()
     * Get an object containing the data, title and url of the current state
     * @param {Boolean} friendly
     * @param {Boolean} create
     * @return {Object} State
     */
    History.getState = function(friendly,create){
      // Prepare
      if ( typeof friendly === 'undefined' ) { friendly = true; }
      if ( typeof create === 'undefined' ) { create = true; }

      // Fetch
      var State = History.getLastSavedState();

      // Create
      if ( !State && create ) {
        State = History.createStateObject();
      }

      // Adjust
      if ( friendly ) {
        State = History.cloneObject(State);
        State.url = State.cleanUrl||State.url;
      }

      // Return
      return State;
    };

    /**
     * History.getIdByState(State)
     * Gets a ID for a State
     * @param {State} newState
     * @return {String} id
     */
    History.getIdByState = function(newState){

      // Fetch ID
      var id = History.extractId(newState.url),
        str;

      if ( !id ) {
        // Find ID via State String
        str = History.getStateString(newState);
        if ( typeof History.stateToId[str] !== 'undefined' ) {
          id = History.stateToId[str];
        }
        else if ( typeof History.store.stateToId[str] !== 'undefined' ) {
          id = History.store.stateToId[str];
        }
        else {
          // Generate a new ID
          while ( true ) {
            id = (new Date()).getTime() + String(Math.random()).replace(/\D/g,'');
            if ( typeof History.idToState[id] === 'undefined' && typeof History.store.idToState[id] === 'undefined' ) {
              break;
            }
          }

          // Apply the new State to the ID
          History.stateToId[str] = id;
          History.idToState[id] = newState;
        }
      }

      // Return ID
      return id;
    };

    /**
     * History.normalizeState(State)
     * Expands a State Object
     * @param {object} State
     * @return {object}
     */
    History.normalizeState = function(oldState){
      // Variables
      var newState, dataNotEmpty;

      // Prepare
      if ( !oldState || (typeof oldState !== 'object') ) {
        oldState = {};
      }

      // Check
      if ( typeof oldState.normalized !== 'undefined' ) {
        return oldState;
      }

      // Adjust
      if ( !oldState.data || (typeof oldState.data !== 'object') ) {
        oldState.data = {};
      }

      // ----------------------------------------------------------------

      // Create
      newState = {};
      newState.normalized = true;
      newState.title = oldState.title||'';
      newState.url = History.getFullUrl(oldState.url?oldState.url:(History.getLocationHref()));
      newState.hash = History.getShortUrl(newState.url);
      newState.data = History.cloneObject(oldState.data);

      // Fetch ID
      newState.id = History.getIdByState(newState);

      // ----------------------------------------------------------------

      // Clean the URL
      newState.cleanUrl = newState.url.replace(/\??\&_suid.*/,'');
      newState.url = newState.cleanUrl;

      // Check to see if we have more than just a url
      dataNotEmpty = !History.isEmptyObject(newState.data);

      // Apply
      if ( (newState.title || dataNotEmpty) && History.options.disableSuid !== true ) {
        // Add ID to Hash
        newState.hash = History.getShortUrl(newState.url).replace(/\??\&_suid.*/,'');
        if ( !/\?/.test(newState.hash) ) {
          newState.hash += '?';
        }
        newState.hash += '&_suid='+newState.id;
      }

      // Create the Hashed URL
      newState.hashedUrl = History.getFullUrl(newState.hash);

      // ----------------------------------------------------------------

      // Update the URL if we have a duplicate
      if ( (History.emulated.pushState || History.bugs.safariPoll) && History.hasUrlDuplicate(newState) ) {
        newState.url = newState.hashedUrl;
      }

      // ----------------------------------------------------------------

      // Return
      return newState;
    };

    /**
     * History.createStateObject(data,title,url)
     * Creates a object based on the data, title and url state params
     * @param {object} data
     * @param {string} title
     * @param {string} url
     * @return {object}
     */
    History.createStateObject = function(data,title,url){
      // Hashify
      var State = {
        'data': data,
        'title': title,
        'url': url
      };

      // Expand the State
      State = History.normalizeState(State);

      // Return object
      return State;
    };

    /**
     * History.getStateById(id)
     * Get a state by it's UID
     * @param {String} id
     */
    History.getStateById = function(id){
      // Prepare
      id = String(id);

      // Retrieve
      var State = History.idToState[id] || History.store.idToState[id] || undefined;

      // Return State
      return State;
    };

    /**
     * Get a State's String
     * @param {State} passedState
     */
    History.getStateString = function(passedState){
      // Prepare
      var State, cleanedState, str;

      // Fetch
      State = History.normalizeState(passedState);

      // Clean
      cleanedState = {
        data: State.data,
        title: passedState.title,
        url: passedState.url
      };

      // Fetch
      str = JSON.stringify(cleanedState);

      // Return
      return str;
    };

    /**
     * Get a State's ID
     * @param {State} passedState
     * @return {String} id
     */
    History.getStateId = function(passedState){
      // Prepare
      var State, id;

      // Fetch
      State = History.normalizeState(passedState);

      // Fetch
      id = State.id;

      // Return
      return id;
    };

    /**
     * History.getHashByState(State)
     * Creates a Hash for the State Object
     * @param {State} passedState
     * @return {String} hash
     */
    History.getHashByState = function(passedState){
      // Prepare
      var State, hash;

      // Fetch
      State = History.normalizeState(passedState);

      // Hash
      hash = State.hash;

      // Return
      return hash;
    };

    /**
     * History.extractId(url_or_hash)
     * Get a State ID by it's URL or Hash
     * @param {string} url_or_hash
     * @return {string} id
     */
    History.extractId = function ( url_or_hash ) {
      // Prepare
      var id,parts,url, tmp;

      // Extract
      
      // If the URL has a #, use the id from before the #
      if (url_or_hash.indexOf('#') != -1)
      {
        tmp = url_or_hash.split("#")[0];
      }
      else
      {
        tmp = url_or_hash;
      }
      
      parts = /(.*)\&_suid=([0-9]+)$/.exec(tmp);
      url = parts ? (parts[1]||url_or_hash) : url_or_hash;
      id = parts ? String(parts[2]||'') : '';

      // Return
      return id||false;
    };

    /**
     * History.isTraditionalAnchor
     * Checks to see if the url is a traditional anchor or not
     * @param {String} url_or_hash
     * @return {Boolean}
     */
    History.isTraditionalAnchor = function(url_or_hash){
      // Check
      var isTraditional = !(/[\/\?\.]/.test(url_or_hash));

      // Return
      return isTraditional;
    };

    /**
     * History.extractState
     * Get a State by it's URL or Hash
     * @param {String} url_or_hash
     * @return {State|null}
     */
    History.extractState = function(url_or_hash,create){
      // Prepare
      var State = null, id, url;
      create = create||false;

      // Fetch SUID
      id = History.extractId(url_or_hash);
      if ( id ) {
        State = History.getStateById(id);
      }

      // Fetch SUID returned no State
      if ( !State ) {
        // Fetch URL
        url = History.getFullUrl(url_or_hash);

        // Check URL
        id = History.getIdByUrl(url)||false;
        if ( id ) {
          State = History.getStateById(id);
        }

        // Create State
        if ( !State && create && !History.isTraditionalAnchor(url_or_hash) ) {
          State = History.createStateObject(null,null,url);
        }
      }

      // Return
      return State;
    };

    /**
     * History.getIdByUrl()
     * Get a State ID by a State URL
     */
    History.getIdByUrl = function(url){
      // Fetch
      var id = History.urlToId[url] || History.store.urlToId[url] || undefined;

      // Return
      return id;
    };

    /**
     * History.getLastSavedState()
     * Get an object containing the data, title and url of the current state
     * @return {Object} State
     */
    History.getLastSavedState = function(){
      return History.savedStates[History.savedStates.length-1]||undefined;
    };

    /**
     * History.getLastStoredState()
     * Get an object containing the data, title and url of the current state
     * @return {Object} State
     */
    History.getLastStoredState = function(){
      return History.storedStates[History.storedStates.length-1]||undefined;
    };

    /**
     * History.hasUrlDuplicate
     * Checks if a Url will have a url conflict
     * @param {Object} newState
     * @return {Boolean} hasDuplicate
     */
    History.hasUrlDuplicate = function(newState) {
      // Prepare
      var hasDuplicate = false,
        oldState;

      // Fetch
      oldState = History.extractState(newState.url);

      // Check
      hasDuplicate = oldState && oldState.id !== newState.id;

      // Return
      return hasDuplicate;
    };

    /**
     * History.storeState
     * Store a State
     * @param {Object} newState
     * @return {Object} newState
     */
    History.storeState = function(newState){
      // Store the State
      History.urlToId[newState.url] = newState.id;

      // Push the State
      History.storedStates.push(History.cloneObject(newState));

      // Return newState
      return newState;
    };

    /**
     * History.isLastSavedState(newState)
     * Tests to see if the state is the last state
     * @param {Object} newState
     * @return {boolean} isLast
     */
    History.isLastSavedState = function(newState){
      // Prepare
      var isLast = false,
        newId, oldState, oldId;

      // Check
      if ( History.savedStates.length ) {
        newId = newState.id;
        oldState = History.getLastSavedState();
        oldId = oldState.id;

        // Check
        isLast = (newId === oldId);
      }

      // Return
      return isLast;
    };

    /**
     * History.saveState
     * Push a State
     * @param {Object} newState
     * @return {boolean} changed
     */
    History.saveState = function(newState){
      // Check Hash
      if ( History.isLastSavedState(newState) ) {
        return false;
      }

      // Push the State
      History.savedStates.push(History.cloneObject(newState));

      // Return true
      return true;
    };

    /**
     * History.getStateByIndex()
     * Gets a state by the index
     * @param {integer} index
     * @return {Object}
     */
    History.getStateByIndex = function(index){
      // Prepare
      var State = null;

      // Handle
      if ( typeof index === 'undefined' ) {
        // Get the last inserted
        State = History.savedStates[History.savedStates.length-1];
      }
      else if ( index < 0 ) {
        // Get from the end
        State = History.savedStates[History.savedStates.length+index];
      }
      else {
        // Get from the beginning
        State = History.savedStates[index];
      }

      // Return State
      return State;
    };
    
    /**
     * History.getCurrentIndex()
     * Gets the current index
     * @return (integer)
    */
    History.getCurrentIndex = function(){
      // Prepare
      var index = null;
      
      // No states saved
      if(History.savedStates.length < 1) {
        index = 0;
      }
      else {
        index = History.savedStates.length-1;
      }
      return index;
    };

    // ====================================================================
    // Hash Helpers

    /**
     * History.getHash()
     * @param {Location=} location
     * Gets the current document hash
     * Note: unlike location.hash, this is guaranteed to return the escaped hash in all browsers
     * @return {string}
     */
    History.getHash = function(doc){
      var url = History.getLocationHref(doc),
        hash;
      hash = History.getHashByUrl(url);
      return hash;
    };

    /**
     * History.unescapeHash()
     * normalize and Unescape a Hash
     * @param {String} hash
     * @return {string}
     */
    History.unescapeHash = function(hash){
      // Prepare
      var result = History.normalizeHash(hash);

      // Unescape hash
      result = decodeURIComponent(result);

      // Return result
      return result;
    };

    /**
     * History.normalizeHash()
     * normalize a hash across browsers
     * @return {string}
     */
    History.normalizeHash = function(hash){
      // Prepare
      var result = hash.replace(/[^#]*#/,'').replace(/#.*/, '');

      // Return result
      return result;
    };

    /**
     * History.setHash(hash)
     * Sets the document hash
     * @param {string} hash
     * @return {History}
     */
    History.setHash = function(hash,queue){
      // Prepare
      var State, pageUrl;

      // Handle Queueing
      if ( queue !== false && History.busy() ) {
        // Wait + Push to Queue
        //History.debug('History.setHash: we must wait', arguments);
        History.pushQueue({
          scope: History,
          callback: History.setHash,
          args: arguments,
          queue: queue
        });
        return false;
      }

      // Log
      //History.debug('History.setHash: called',hash);

      // Make Busy + Continue
      History.busy(true);

      // Check if hash is a state
      State = History.extractState(hash,true);
      if ( State && !History.emulated.pushState ) {
        // Hash is a state so skip the setHash
        //History.debug('History.setHash: Hash is a state so skipping the hash set with a direct pushState call',arguments);

        // PushState
        History.pushState(State.data,State.title,State.url,false);
      }
      else if ( History.getHash() !== hash ) {
        // Hash is a proper hash, so apply it

        // Handle browser bugs
        if ( History.bugs.setHash ) {
          // Fix Safari Bug https://bugs.webkit.org/show_bug.cgi?id=56249

          // Fetch the base page
          pageUrl = History.getPageUrl();

          // Safari hash apply
          History.pushState(null,null,pageUrl+'#'+hash,false);
        }
        else {
          // Normal hash apply
          document.location.hash = hash;
        }
      }

      // Chain
      return History;
    };

    /**
     * History.escape()
     * normalize and Escape a Hash
     * @return {string}
     */
    History.escapeHash = function(hash){
      // Prepare
      var result = History.normalizeHash(hash);

      // Escape hash
      result = window.encodeURIComponent(result);

      // IE6 Escape Bug
      if ( !History.bugs.hashEscape ) {
        // Restore common parts
        result = result
          .replace(/\%21/g,'!')
          .replace(/\%26/g,'&')
          .replace(/\%3D/g,'=')
          .replace(/\%3F/g,'?');
      }

      // Return result
      return result;
    };

    /**
     * History.getHashByUrl(url)
     * Extracts the Hash from a URL
     * @param {string} url
     * @return {string} url
     */
    History.getHashByUrl = function(url){
      // Extract the hash
      var hash = String(url)
        .replace(/([^#]*)#?([^#]*)#?(.*)/, '$2')
        ;

      // Unescape hash
      hash = History.unescapeHash(hash);

      // Return hash
      return hash;
    };

    /**
     * History.setTitle(title)
     * Applies the title to the document
     * @param {State} newState
     * @return {Boolean}
     */
    History.setTitle = function(newState){
      // Prepare
      var title = newState.title,
        firstState;

      // Initial
      if ( !title ) {
        firstState = History.getStateByIndex(0);
        if ( firstState && firstState.url === newState.url ) {
          title = firstState.title||History.options.initialTitle;
        }
      }

      // Apply
      try {
        document.getElementsByTagName('title')[0].innerHTML = title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');
      }
      catch ( Exception ) { }
      document.title = title;

      // Chain
      return History;
    };


    // ====================================================================
    // Queueing

    /**
     * History.queues
     * The list of queues to use
     * First In, First Out
     */
    History.queues = [];

    /**
     * History.busy(value)
     * @param {boolean} value [optional]
     * @return {boolean} busy
     */
    History.busy = function(value){
      // Apply
      if ( typeof value !== 'undefined' ) {
        //History.debug('History.busy: changing ['+(History.busy.flag||false)+'] to ['+(value||false)+']', History.queues.length);
        History.busy.flag = value;
      }
      // Default
      else if ( typeof History.busy.flag === 'undefined' ) {
        History.busy.flag = false;
      }

      // Queue
      if ( !History.busy.flag ) {
        // Execute the next item in the queue
        clearTimeout(History.busy.timeout);
        var fireNext = function(){
          var i, queue, item;
          if ( History.busy.flag ) return;
          for ( i=History.queues.length-1; i >= 0; --i ) {
            queue = History.queues[i];
            if ( queue.length === 0 ) continue;
            item = queue.shift();
            History.fireQueueItem(item);
            History.busy.timeout = setTimeout(fireNext,History.options.busyDelay);
          }
        };
        History.busy.timeout = setTimeout(fireNext,History.options.busyDelay);
      }

      // Return
      return History.busy.flag;
    };

    /**
     * History.busy.flag
     */
    History.busy.flag = false;

    /**
     * History.fireQueueItem(item)
     * Fire a Queue Item
     * @param {Object} item
     * @return {Mixed} result
     */
    History.fireQueueItem = function(item){
      return item.callback.apply(item.scope||History,item.args||[]);
    };

    /**
     * History.pushQueue(callback,args)
     * Add an item to the queue
     * @param {Object} item [scope,callback,args,queue]
     */
    History.pushQueue = function(item){
      // Prepare the queue
      History.queues[item.queue||0] = History.queues[item.queue||0]||[];

      // Add to the queue
      History.queues[item.queue||0].push(item);

      // Chain
      return History;
    };

    /**
     * History.queue (item,queue), (func,queue), (func), (item)
     * Either firs the item now if not busy, or adds it to the queue
     */
    History.queue = function(item,queue){
      // Prepare
      if ( typeof item === 'function' ) {
        item = {
          callback: item
        };
      }
      if ( typeof queue !== 'undefined' ) {
        item.queue = queue;
      }

      // Handle
      if ( History.busy() ) {
        History.pushQueue(item);
      } else {
        History.fireQueueItem(item);
      }

      // Chain
      return History;
    };

    /**
     * History.clearQueue()
     * Clears the Queue
     */
    History.clearQueue = function(){
      History.busy.flag = false;
      History.queues = [];
      return History;
    };


    // ====================================================================
    // IE Bug Fix

    /**
     * History.stateChanged
     * States whether or not the state has changed since the last double check was initialised
     */
    History.stateChanged = false;

    /**
     * History.doubleChecker
     * Contains the timeout used for the double checks
     */
    History.doubleChecker = false;

    /**
     * History.doubleCheckComplete()
     * Complete a double check
     * @return {History}
     */
    History.doubleCheckComplete = function(){
      // Update
      History.stateChanged = true;

      // Clear
      History.doubleCheckClear();

      // Chain
      return History;
    };

    /**
     * History.doubleCheckClear()
     * Clear a double check
     * @return {History}
     */
    History.doubleCheckClear = function(){
      // Clear
      if ( History.doubleChecker ) {
        clearTimeout(History.doubleChecker);
        History.doubleChecker = false;
      }

      // Chain
      return History;
    };

    /**
     * History.doubleCheck()
     * Create a double check
     * @return {History}
     */
    History.doubleCheck = function(tryAgain){
      // Reset
      History.stateChanged = false;
      History.doubleCheckClear();

      // Fix IE6,IE7 bug where calling history.back or history.forward does not actually change the hash (whereas doing it manually does)
      // Fix Safari 5 bug where sometimes the state does not change: https://bugs.webkit.org/show_bug.cgi?id=42940
      if ( History.bugs.ieDoubleCheck ) {
        // Apply Check
        History.doubleChecker = setTimeout(
          function(){
            History.doubleCheckClear();
            if ( !History.stateChanged ) {
              //History.debug('History.doubleCheck: State has not yet changed, trying again', arguments);
              // Re-Attempt
              tryAgain();
            }
            return true;
          },
          History.options.doubleCheckInterval
        );
      }

      // Chain
      return History;
    };


    // ====================================================================
    // Safari Bug Fix

    /**
     * History.safariStatePoll()
     * Poll the current state
     * @return {History}
     */
    History.safariStatePoll = function(){
      // Poll the URL

      // Get the Last State which has the new URL
      var
        urlState = History.extractState(History.getLocationHref()),
        newState;

      // Check for a difference
      if ( !History.isLastSavedState(urlState) ) {
        newState = urlState;
      }
      else {
        return;
      }

      // Check if we have a state with that url
      // If not create it
      if ( !newState ) {
        //History.debug('History.safariStatePoll: new');
        newState = History.createStateObject();
      }

      // Apply the New State
      //History.debug('History.safariStatePoll: trigger');
      History.Adapter.trigger(window,'popstate');

      // Chain
      return History;
    };


    // ====================================================================
    // State Aliases

    /**
     * History.back(queue)
     * Send the browser history back one item
     * @param {Integer} queue [optional]
     */
    History.back = function(queue){
      //History.debug('History.back: called', arguments);

      // Handle Queueing
      if ( queue !== false && History.busy() ) {
        // Wait + Push to Queue
        //History.debug('History.back: we must wait', arguments);
        History.pushQueue({
          scope: History,
          callback: History.back,
          args: arguments,
          queue: queue
        });
        return false;
      }

      // Make Busy + Continue
      History.busy(true);

      // Fix certain browser bugs that prevent the state from changing
      History.doubleCheck(function(){
        History.back(false);
      });

      // Go back
      history.go(-1);

      // End back closure
      return true;
    };

    /**
     * History.forward(queue)
     * Send the browser history forward one item
     * @param {Integer} queue [optional]
     */
    History.forward = function(queue){
      //History.debug('History.forward: called', arguments);

      // Handle Queueing
      if ( queue !== false && History.busy() ) {
        // Wait + Push to Queue
        //History.debug('History.forward: we must wait', arguments);
        History.pushQueue({
          scope: History,
          callback: History.forward,
          args: arguments,
          queue: queue
        });
        return false;
      }

      // Make Busy + Continue
      History.busy(true);

      // Fix certain browser bugs that prevent the state from changing
      History.doubleCheck(function(){
        History.forward(false);
      });

      // Go forward
      history.go(1);

      // End forward closure
      return true;
    };

    /**
     * History.go(index,queue)
     * Send the browser history back or forward index times
     * @param {Integer} queue [optional]
     */
    History.go = function(index,queue){
      //History.debug('History.go: called', arguments);

      // Prepare
      var i;

      // Handle
      if ( index > 0 ) {
        // Forward
        for ( i=1; i<=index; ++i ) {
          History.forward(queue);
        }
      }
      else if ( index < 0 ) {
        // Backward
        for ( i=-1; i>=index; --i ) {
          History.back(queue);
        }
      }
      else {
        throw new Error('History.go: History.go requires a positive or negative integer passed.');
      }

      // Chain
      return History;
    };


    // ====================================================================
    // HTML5 State Support

    // Non-Native pushState Implementation
    if ( History.emulated.pushState ) {
      /*
       * Provide Skeleton for HTML4 Browsers
       */

      // Prepare
      var emptyFunction = function(){};
      History.pushState = History.pushState||emptyFunction;
      History.replaceState = History.replaceState||emptyFunction;
    } // History.emulated.pushState

    // Native pushState Implementation
    else {
      /*
       * Use native HTML5 History API Implementation
       */

      /**
       * History.onPopState(event,extra)
       * Refresh the Current State
       */
      History.onPopState = function(event,extra){
        // Prepare
        var stateId = false, newState = false, currentHash, currentState;

        // Reset the double check
        History.doubleCheckComplete();

        // Check for a Hash, and handle apporiatly
        currentHash = History.getHash();
        if ( currentHash ) {
          // Expand Hash
          currentState = History.extractState(currentHash||History.getLocationHref(),true);
          if ( currentState ) {
            // We were able to parse it, it must be a State!
            // Let's forward to replaceState
            //History.debug('History.onPopState: state anchor', currentHash, currentState);
            History.replaceState(currentState.data, currentState.title, currentState.url, false);
          }
          else {
            // Traditional Anchor
            //History.debug('History.onPopState: traditional anchor', currentHash);
            History.Adapter.trigger(window,'anchorchange');
            History.busy(false);
          }

          // We don't care for hashes
          History.expectedStateId = false;
          return false;
        }

        // Ensure
        stateId = History.Adapter.extractEventData('state',event,extra) || false;

        // Fetch State
        if ( stateId ) {
          // Vanilla: Back/forward button was used
          newState = History.getStateById(stateId);
        }
        else if ( History.expectedStateId ) {
          // Vanilla: A new state was pushed, and popstate was called manually
          newState = History.getStateById(History.expectedStateId);
        }
        else {
          // Initial State
          newState = History.extractState(History.getLocationHref());
        }

        // The State did not exist in our store
        if ( !newState ) {
          // Regenerate the State
          newState = History.createStateObject(null,null,History.getLocationHref());
        }

        // Clean
        History.expectedStateId = false;

        // Check if we are the same state
        if ( History.isLastSavedState(newState) ) {
          // There has been no change (just the page's hash has finally propagated)
          //History.debug('History.onPopState: no change', newState, History.savedStates);
          History.busy(false);
          return false;
        }

        // Store the State
        History.storeState(newState);
        History.saveState(newState);

        // Force update of the title
        History.setTitle(newState);

        // Fire Our Event
        History.Adapter.trigger(window,'statechange');
        History.busy(false);

        // Return true
        return true;
      };
      History.Adapter.bind(window,'popstate',History.onPopState);

      /**
       * History.pushState(data,title,url)
       * Add a new State to the history object, become it, and trigger onpopstate
       * We have to trigger for HTML4 compatibility
       * @param {object} data
       * @param {string} title
       * @param {string} url
       * @return {true}
       */
      History.pushState = function(data,title,url,queue){
        //History.debug('History.pushState: called', arguments);

        // Check the State
        if ( History.getHashByUrl(url) && History.emulated.pushState ) {
          throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
        }

        // Handle Queueing
        if ( queue !== false && History.busy() ) {
          // Wait + Push to Queue
          //History.debug('History.pushState: we must wait', arguments);
          History.pushQueue({
            scope: History,
            callback: History.pushState,
            args: arguments,
            queue: queue
          });
          return false;
        }

        // Make Busy + Continue
        History.busy(true);

        // Create the newState
        var newState = History.createStateObject(data,title,url);

        // Check it
        if ( History.isLastSavedState(newState) ) {
          // Won't be a change
          History.busy(false);
        }
        else {
          // Store the newState
          History.storeState(newState);
          History.expectedStateId = newState.id;

          // Push the newState
          history.pushState(newState.id,newState.title,newState.url);

          // Fire HTML5 Event
          History.Adapter.trigger(window,'popstate');
        }

        // End pushState closure
        return true;
      };

      /**
       * History.replaceState(data,title,url)
       * Replace the State and trigger onpopstate
       * We have to trigger for HTML4 compatibility
       * @param {object} data
       * @param {string} title
       * @param {string} url
       * @return {true}
       */
      History.replaceState = function(data,title,url,queue){
        //History.debug('History.replaceState: called', arguments);

        // Check the State
        if ( History.getHashByUrl(url) && History.emulated.pushState ) {
          throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
        }

        // Handle Queueing
        if ( queue !== false && History.busy() ) {
          // Wait + Push to Queue
          //History.debug('History.replaceState: we must wait', arguments);
          History.pushQueue({
            scope: History,
            callback: History.replaceState,
            args: arguments,
            queue: queue
          });
          return false;
        }

        // Make Busy + Continue
        History.busy(true);

        // Create the newState
        var newState = History.createStateObject(data,title,url);

        // Check it
        if ( History.isLastSavedState(newState) ) {
          // Won't be a change
          History.busy(false);
        }
        else {
          // Store the newState
          History.storeState(newState);
          History.expectedStateId = newState.id;

          // Push the newState
          history.replaceState(newState.id,newState.title,newState.url);

          // Fire HTML5 Event
          History.Adapter.trigger(window,'popstate');
        }

        // End replaceState closure
        return true;
      };

    } // !History.emulated.pushState


    // ====================================================================
    // Initialise

    /**
     * Load the Store
     */
    if ( sessionStorage ) {
      // Fetch
      try {
        History.store = JSON.parse(sessionStorage.getItem('History.store'))||{};
      }
      catch ( err ) {
        History.store = {};
      }

      // Normalize
      History.normalizeStore();
    }
    else {
      // Default Load
      History.store = {};
      History.normalizeStore();
    }

    /**
     * Clear Intervals on exit to prevent memory leaks
     */
    History.Adapter.bind(window,"unload",History.clearAllIntervals);

    /**
     * Create the initial State
     */
    History.saveState(History.storeState(History.extractState(History.getLocationHref(),true)));

    /**
     * Bind for Saving Store
     */
    if ( sessionStorage ) {
      // When the page is closed
      History.onUnload = function(){
        // Prepare
        var currentStore, item, currentStoreString;

        // Fetch
        try {
          currentStore = JSON.parse(sessionStorage.getItem('History.store'))||{};
        }
        catch ( err ) {
          currentStore = {};
        }

        // Ensure
        currentStore.idToState = currentStore.idToState || {};
        currentStore.urlToId = currentStore.urlToId || {};
        currentStore.stateToId = currentStore.stateToId || {};

        // Sync
        for ( item in History.idToState ) {
          if ( !History.idToState.hasOwnProperty(item) ) {
            continue;
          }
          currentStore.idToState[item] = History.idToState[item];
        }
        for ( item in History.urlToId ) {
          if ( !History.urlToId.hasOwnProperty(item) ) {
            continue;
          }
          currentStore.urlToId[item] = History.urlToId[item];
        }
        for ( item in History.stateToId ) {
          if ( !History.stateToId.hasOwnProperty(item) ) {
            continue;
          }
          currentStore.stateToId[item] = History.stateToId[item];
        }

        // Update
        History.store = currentStore;
        History.normalizeStore();

        // In Safari, going into Private Browsing mode causes the
        // Session Storage object to still exist but if you try and use
        // or set any property/function of it it throws the exception
        // "QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to
        // add something to storage that exceeded the quota." infinitely
        // every second.
        currentStoreString = JSON.stringify(currentStore);
        try {
          // Store
          sessionStorage.setItem('History.store', currentStoreString);
        }
        catch (e) {
          if (e.code === DOMException.QUOTA_EXCEEDED_ERR) {
            if (sessionStorage.length) {
              // Workaround for a bug seen on iPads. Sometimes the quota exceeded error comes up and simply
              // removing/resetting the storage can work.
              sessionStorage.removeItem('History.store');
              sessionStorage.setItem('History.store', currentStoreString);
            } else {
              // Otherwise, we're probably private browsing in Safari, so we'll ignore the exception.
            }
          } else {
            throw e;
          }
        }
      };

      // For Internet Explorer
      History.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));

      // For Other Browsers
      History.Adapter.bind(window,'beforeunload',History.onUnload);
      History.Adapter.bind(window,'unload',History.onUnload);

      // Both are enabled for consistency
    }

    // Non-Native pushState Implementation
    if ( !History.emulated.pushState ) {
      // Be aware, the following is only for native pushState implementations
      // If you are wanting to include something for all browsers
      // Then include it above this if block

      /**
       * Setup Safari Fix
       */
      if ( History.bugs.safariPoll ) {
        History.intervalList.push(setInterval(History.safariStatePoll, History.options.safariPollInterval));
      }

      /**
       * Ensure Cross Browser Compatibility
       */
      if ( navigator.vendor === 'Apple Computer, Inc.' || (navigator.appCodeName||'') === 'Mozilla' ) {
        /**
         * Fix Safari HashChange Issue
         */

        // Setup Alias
        History.Adapter.bind(window,'hashchange',function(){
          History.Adapter.trigger(window,'popstate');
        });

        // Initialise Alias
        if ( History.getHash() ) {
          History.Adapter.onDomLoad(function(){
            History.Adapter.trigger(window,'hashchange');
          });
        }
      }

    } // !History.emulated.pushState


  }; // History.initCore

  // Try to Initialise History
  if (!History.options || !History.options.delayInit) {
    History.init();
  }

})(window);
;
var History = window.History;

// Polyfills
// PRTG-6122 EC: Pages cannot be loaded and are not displayed
// formdata polyfill causes an js error inside ec that makes it
// impossible to load side content. Due to that issue formdata.min.js 
// must be wrapped in a try-catch block, so the ec won't break.
try {
;(function(){var k;function l(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}var m="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){a!=Array.prototype&&a!=Object.prototype&&(a[b]=e.value)},n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function p(){p=function(){};n.Symbol||(n.Symbol=r)}var r=function(){var a=0;return function(b){return"jscomp_symbol_"+(b||"")+a++}}();
function u(){p();var a=n.Symbol.iterator;a||(a=n.Symbol.iterator=n.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&m(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return v(l(this))}});u=function(){}}function v(a){u();a={next:a};a[n.Symbol.iterator]=function(){return this};return a}function x(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:l(a)}}var y;
if("function"==typeof Object.setPrototypeOf)y=Object.setPrototypeOf;else{var z;a:{var A={s:!0},B={};try{B.__proto__=A;z=B.s;break a}catch(a){}z=!1}y=z?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var C=y;function D(){this.h=!1;this.c=null;this.o=void 0;this.b=1;this.m=this.u=0;this.g=null}function E(a){if(a.h)throw new TypeError("Generator is already running");a.h=!0}D.prototype.i=function(a){this.o=a};
D.prototype.j=function(a){this.g={v:a,w:!0};this.b=this.u||this.m};D.prototype["return"]=function(a){this.g={"return":a};this.b=this.m};function F(a,b,e){a.b=e;return{value:b}}function G(a){this.A=a;this.l=[];for(var b in a)this.l.push(b);this.l.reverse()}function H(a){this.a=new D;this.B=a}H.prototype.i=function(a){E(this.a);if(this.a.c)return I(this,this.a.c.next,a,this.a.i);this.a.i(a);return J(this)};
function K(a,b){E(a.a);var e=a.a.c;if(e)return I(a,"return"in e?e["return"]:function(a){return{value:a,done:!0}},b,a.a["return"]);a.a["return"](b);return J(a)}H.prototype.j=function(a){E(this.a);if(this.a.c)return I(this,this.a.c["throw"],a,this.a.i);this.a.j(a);return J(this)};
function I(a,b,e,c){try{var d=b.call(a.a.c,e);if(!(d instanceof Object))throw new TypeError("Iterator result "+d+" is not an object");if(!d.done)return a.a.h=!1,d;var f=d.value}catch(g){return a.a.c=null,a.a.j(g),J(a)}a.a.c=null;c.call(a.a,f);return J(a)}function J(a){for(;a.a.b;)try{var b=a.B(a.a);if(b)return a.a.h=!1,{value:b.value,done:!1}}catch(e){a.a.o=void 0,a.a.j(e)}a.a.h=!1;if(a.a.g){b=a.a.g;a.a.g=null;if(b.w)throw b.v;return{value:b["return"],done:!0}}return{value:void 0,done:!0}}
function L(a){this.next=function(b){return a.i(b)};this["throw"]=function(b){return a.j(b)};this["return"]=function(b){return K(a,b)};u();this[Symbol.iterator]=function(){return this}}function M(a,b){var e=new L(new H(b));C&&C(e,a.prototype);return e}
if("function"===typeof Blob&&("undefined"===typeof FormData||!FormData.prototype.keys || window.navigator.userAgent.indexOf("Edge") > -1)){var N=function(a,b){for(var e=0;e<a.length;e++)b(a[e])},O=function(a,b,e){return b instanceof Blob?[String(a),b,void 0!==e?e+"":"string"===typeof b.name?b.name:"blob"]:[String(a),String(b)]},P=function(a,b){if(a.length<b)throw new TypeError(b+" argument required, but only "+a.length+" present.");},Q=function(a){var b=x(a);a=b.next().value;b=b.next().value;a instanceof Blob&&(a=new File([a],b,{type:a.type,lastModified:a.lastModified}));
return a},R="object"===typeof window?window:"object"===typeof self?self:this,S=R.FormData,T=R.XMLHttpRequest&&R.XMLHttpRequest.prototype.send,U=R.Request&&R.fetch,V=R.navigator&&R.navigator.sendBeacon;p();var W=R.Symbol&&Symbol.toStringTag;W&&(Blob.prototype[W]||(Blob.prototype[W]="Blob"),"File"in R&&!File.prototype[W]&&(File.prototype[W]="File"));try{new File([],"")}catch(a){R.File=function(b,e,c){b=new Blob(b,c);c=c&&void 0!==c.lastModified?new Date(c.lastModified):new Date;Object.defineProperties(b,
{name:{value:e},lastModifiedDate:{value:c},lastModified:{value:+c},toString:{value:function(){return"[object File]"}}});W&&Object.defineProperty(b,W,{value:"File"});return b}}p();u();var X=function(a){this.f=Object.create(null);if(!a)return this;var b=this;N(a.elements,function(a){if(a.name&&!a.disabled&&"submit"!==a.type&&"button"!==a.type)if("file"===a.type){var c=a.files&&a.files.length?a.files:[new File([],"",{type:"application/octet-stream"})];N(c,function(c){b.append(a.name,c)})}else"select-multiple"===
a.type||"select-one"===a.type?N(a.options,function(c){!c.disabled&&c.selected&&b.append(a.name,c.value)}):"checkbox"===a.type||"radio"===a.type?a.checked&&b.append(a.name,a.value):(c="textarea"===a.type?a.value.replace(/\r\n/g,"\n").replace(/\n/g,"\r\n"):a.value,b.append(a.name,c))})};k=X.prototype;k.append=function(a,b,e){P(arguments,2);var c=x(O.apply(null,arguments));a=c.next().value;b=c.next().value;e=c.next().value;c=this.f;c[a]||(c[a]=[]);c[a].push([b,e])};k["delete"]=function(a){P(arguments,
1);delete this.f[String(a)]};k.entries=function b(){var e=this,c,d,f,g,h,q;return M(b,function(b){switch(b.b){case 1:c=e.f,f=new G(c);case 2:var t;a:{for(t=f;0<t.l.length;){var w=t.l.pop();if(w in t.A){t=w;break a}}t=null}if(null==(d=t)){b.b=0;break}g=x(c[d]);h=g.next();case 5:if(h.done){b.b=2;break}q=h.value;return F(b,[d,Q(q)],6);case 6:h=g.next(),b.b=5}})};k.forEach=function(b,e){P(arguments,1);for(var c=x(this),d=c.next();!d.done;d=c.next()){var f=x(d.value);d=f.next().value;f=f.next().value;
b.call(e,f,d,this)}};k.get=function(b){P(arguments,1);var e=this.f;b=String(b);return e[b]?Q(e[b][0]):null};k.getAll=function(b){P(arguments,1);return(this.f[String(b)]||[]).map(Q)};k.has=function(b){P(arguments,1);return String(b)in this.f};k.keys=function e(){var c=this,d,f,g,h,q;return M(e,function(e){1==e.b&&(d=x(c),f=d.next());if(3!=e.b){if(f.done){e.b=0;return}g=f.value;h=x(g);q=h.next().value;return F(e,q,3)}f=d.next();e.b=2})};k.set=function(e,c,d){P(arguments,2);var f=O.apply(null,arguments);
this.f[f[0]]=[[f[1],f[2]]]};k.values=function c(){var d=this,f,g,h,q,w;return M(c,function(c){1==c.b&&(f=x(d),g=f.next());if(3!=c.b){if(g.done){c.b=0;return}h=g.value;q=x(h);q.next();w=q.next().value;return F(c,w,3)}g=f.next();c.b=2})};X.prototype._asNative=function(){for(var c=new S,d=x(this),f=d.next();!f.done;f=d.next()){var g=x(f.value);f=g.next().value;g=g.next().value;c.append(f,g)}return c};X.prototype._blob=function(){for(var c="----formdata-polyfill-"+Math.random(),d=[],f=x(this),g=f.next();!g.done;g=
f.next()){var h=x(g.value);g=h.next().value;h=h.next().value;d.push("--"+c+"\r\n");h instanceof Blob?d.push('Content-Disposition: form-data; name="'+g+'"; filename="'+h.name+'"\r\n',"Content-Type: "+(h.type||"application/octet-stream")+"\r\n\r\n",h,"\r\n"):d.push('Content-Disposition: form-data; name="'+g+'"\r\n\r\n'+h+"\r\n")}d.push("--"+c+"--");return new Blob(d,{type:"multipart/form-data; boundary="+c})};X.prototype[Symbol.iterator]=function(){return this.entries()};X.prototype.toString=function(){return"[object FormData]"};
W&&(X.prototype[W]="FormData");T&&(R.XMLHttpRequest.prototype.send=function(c){c instanceof X?(c=c._blob(),this.setRequestHeader("Content-Type",c.type),T.call(this,c)):T.call(this,c)});if(U){var Y=R.fetch;R.fetch=function(c,d){d&&d.body&&d.body instanceof X&&(d.body=d.body._blob());return Y.call(this,c,d)}}V&&(R.navigator.sendBeacon=function(c,d){d instanceof X&&(d=d._asNative());return V.call(this,c,d)});R.FormData=X};
})();
;
} catch (error) {
    
}

// PRTG-13550: Polyfill for missing isInteger function in Internet Explorer
Number.isInteger = Number.isInteger || function(value) {
    return typeof value === 'number' && 
        isFinite(value) && 
        Math.floor(value) === value;
};

// Libs
/*
 * PRTG's Context Menu
 *
 * December 2007: V2.0 by Dirk Paessler
 *
 * based on:
 *
 * ContextMenu - jQuery plugin for right-click context menus
 *
 * Author: Chris Domigan
 * Contributors: Dan G. Switzer, II
 * Parts of this plugin are inspired by Joern Zaefferer's Tooltip plugin
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Version: r2
 * Date: 16 July 2007
 *
 * For documentation visit http://www.trendskitchens.co.nz/jquery/contextmenu/
 *
 */

(function($) {
  var menu, trigger, content, hash, currentborder;
  var defaults = {
    menuStyle: {
      bindToEvent: "contextmenu"
    },
    itemStyle: {},
    itemHoverStyle: {},
    eventPosX: "pageX",
    eventPosY: "pageY",
    onContextMenu: null,
    onShowMenu: null
  };

  $.fn.contextMenu = function(id, options) {
    if (!menu) {
      menu = $("<div/>", {
        id: id,
        class: "jqContextMenu",
        style: "position:absolute"
      })
        .hide()
        .appendTo("body")
        .on("click", function(e) {
          e.stopPropagation();
        });
    }
    hash = hash || [];
    hash.push({
      id: id,
      contextMenus: options.contextMenus,
      menuStyle: $.extend({}, defaults.menuStyle, options.menuStyle || {}),
      itemStyle: $.extend({}, defaults.itemStyle, options.itemStyle || {}),
      itemHoverStyle: $.extend(
        {},
        defaults.itemHoverStyle,
        options.itemHoverStyle || {}
      ),
      bindings: options.bindings || {},
      onContextMenu: options.onContextMenu || defaults.onContextMenu,
      onShowMenu: options.onShowMenu || defaults.onShowMenu,
      eventPosX: options.eventPosX || defaults.eventPosX,
      eventPosY: options.eventPosY || defaults.eventPosY
    });

    var index = hash.length - 1;

    if (!options.menuStyle.bindToEvent) {
      options.menuStyle.bindToEvent = "contextmenu";
    }

    $(this).on(options.menuStyle.bindToEvent, function(e) {
      //unter Windows kommt hier immer die Info, dass CTRL gedrueckt wird im Safari. Chrome geht aber
      //if ((_Prtg.Options.browser == 'chrome') || (_Prtg.Options.browser == 'safari')) {
      if (e.ctrlKey || e.metaKey) return true; //if someone presses CTRL with a right click he will see the usual browser context menu
      //}
      if ($(e.target).is("img")) return true; //if someone right-clicks an image (chart), show usual context menu
      if ($(e.target).is("input")) return true; //if someone right-clicks an image (chart), show usual context menu
      if ($(e.target).is("textarea")) return true; //if someone right-clicks an image (chart), show usual context menu
      if ($(e.target).is(".enablebrowsercontextmenu")) return true; //if someone right-clicks an image (chart), show usual context menu
      // Check if onContextMenu() defined
      var bShowContext = !!hash[index].onContextMenu
        ? hash[index].onContextMenu(e)
        : true;
      if (bShowContext) display(index, this, e, options);
      return false;
    });
    return menu;
  };

  function display(index, trigger, e, options) {
    var cur = hash[index],
      timer = 0;
    content = cur.contextMenus.clone(true);
    content
      .css(cur.menuStyle)
      .find("li")
      .css(cur.itemStyle)
      .hover(
        function() {
          $(this).css(cur.itemHoverStyle);
        },
        function() {
          $(this).css(cur.itemStyle);
        }
      )
      .find("img")
      .css({ verticalAlign: "middle", paddingRight: "2px" });

    menu.html(content);
    _Prtg.Tip.kill();

    var myobject = $(e.target);
    if (!!cur.onShowMenu) cur.onShowMenu.apply(myobject[0], [e, menu]);

    menu.hover(
      function() {
        myobject.addClass("hover");
        myobject.parent().addClass("hover");
      },
      function() {
        myobject.removeClass("hover");
        myobject.parent().removeClass("hover");
      }
    );

    $.each(cur.bindings, function(id, func) {
      $("#" + id + ":not(.disabled)", menu).bind("click.contextmenu", function(
        e
      ) {
        e.preventDefault();
        hide(e);
        $(this).data("element", myobject);
        func.call(this, myobject, e);
      });
    });
    menu
      .removeClass("flyoutleft")
      .fadeIn(100)
      .css(setPosition({ left: e.pageX - 10, top: e.pageY - 10 }))
      .on("mouseleave", function(e) {
        var $self = $(this);
        timer = setTimeout(function() {
          $self.hide(e);
        }, 666);
      })
      .on("mouseenter", function() {
        if (timer) timer = clearTimeout(timer);
      });
    $(document).one("click", hide);
  }

  function setPosition(position) {
    var $viewport = $(window),
      viewportOffset = $viewport.offset() || { top: 0, left: 0 },
      borderLB = 20,
      borderBB = 120,
      width = menu
        .children()
        .first()
        .outerWidth(),
      height = menu
        .children()
        .first()
        .outerHeight();

    viewportOffset.top += $viewport.scrollTop();
    viewportOffset.left += $viewport.scrollLeft();

    if (
      (position.left + width + borderLB >
        viewportOffset.left + $viewport.width() &&
        !!menu.addClass("flyoutleft")) ||
      position.left < viewportOffset.left
    ) {
      position.left =
        viewportOffset.left + $viewport.width() - width - +borderLB;
      position.left =
        position.left < viewportOffset.left
          ? viewportOffset.left
          : position.left;
    }
    if (
      position.top + height + borderLB >
        viewportOffset.top + $viewport.outerHeight() ||
      position.top < viewportOffset.top
    ) {
      position.top =
        viewportOffset.top + $viewport.outerHeight() - height - +borderBB;
      position.top =
        position.top < viewportOffset.top ? viewportOffset.top : position.top;
    }
    return position;
  }

  function hide(e) {
    if (e.which != 1) return;
    menu.hide();
    menu.children().unbind();
    menu.unbind();
  }

  // Apply defaults
  $.contextMenu = {
    defaults: function(userDefaults) {
      $.each(userDefaults, function(i, val) {
        if (typeof val == "object" && defaults[i]) {
          $.extend(defaults[i], val);
        } else defaults[i] = val;
      });
    }
  };
})(jQuery);
;
/**
 * jQBrowser v0.2 - Extend jQuery's browser detection capabilities
 *   * http://davecardwell.co.uk/javascript/jquery/plugins/jquery-browserdetect/0.2/
 *
 * Dave Cardwell <http://davecardwell.co.uk/>
 *
 * Built on the shoulders of giants:
 *   * John Resig <http://jquery.com/>
 *   * Peter-Paul Koch <http://www.quirksmode.org/?/js/detect.html>
 *
 *
 * Copyright (c) 2006 Dave Cardwell, dual licensed under the MIT and GPL
 * licenses:
 *   * http://www.opensource.org/licenses/mit-license.php
 *   * http://www.gnu.org/licenses/gpl.txt
 */


/**
 * For the latest version of this plugin, and a discussion of its usage and
 * implementation, visit:
 *   * http://davecardwell.co.uk/javascript/jquery/plugins/jquery-browserdetect/
 */

new function() {
    /**
     * The following functions and attributes form the Public interface of the
     * jQBrowser plugin, accessed externally through the $.browser object.
     * See the relevant function definition later in the source for further
     * information.
     *
     * $.browser.browser()
     * $.browser.version.number()
     * $.browser.version.string()
     * $.browser.OS()
     *
     * $.browser.aol()
     * $.browser.camino()
     * $.browser.firefox()
     * $.browser.flock()
     * $.browser.icab()
     * $.browser.konqueror()
     * $.browser.mozilla()
     * $.browser.msie()
     * $.browser.netscape()
     * $.browser.opera()
     * $.browser.safari()
     *
     * $.browser.linux()
     * $.browser.mac()
     * $.browser.win()
     */
    var Public = {
        // The current browser, its version as a number or a string, and the
        // operating system its running on.
          'browser': function() { return Private.browser;   },
          'version': {
              'number': function() { return Private.version.number; },
              'string': function() { return Private.version.string; }
          },
               'OS': function() { return Private.OS;        },

        // A boolean value indicating whether or not the given browser was
        // detected.
              'aol': function() { return Private.aol;       },
           'camino': function() { return Private.camino;    },
          'firefox': function() { return Private.firefox;   },
            'flock': function() { return Private.flock;     },
             'icab': function() { return Private.icab;      },
        'konqueror': function() { return Private.konqueror; },
          'mozilla': function() { return Private.mozilla;   },
             'msie': function() { return Private.msie;      },
         'netscape': function() { return Private.netscape;  },
            'opera': function() { return Private.opera;     },
           'safari': function() { return Private.safari;    },

        // A boolean value indicating whether or not the given OS was
        // detected.
            'linux': function() { return Private.linux;     },
              'mac': function() { return Private.mac;       },
              'win': function() { return Private.win;       }
    };

    // Allow external access to the 'Public' interface through the $.browser
    // object.
    $.browser = Public;



    /**
     * The following functions and attributes form the internal methods and
     * state of the jQBrowser plugin.  See the relevant function definition
     * later in the source for further information.
     *
     * Private.browser
     * Private.version
     * Private.OS
     *
     * Private.aol
     * Private.camino
     * Private.firefox
     * Private.flock
     * Private.icab
     * Private.konqueror
     * Private.mozilla
     * Private.msie
     * Private.netscape
     * Private.opera
     * Private.safari
     *
     * Private.linux
     * Private.mac
     * Private.win
     */
    var Private = {
        // Initially set to 'Unknown', if detected each of these properties will
        // be updated.
          'browser': 'Unknown',
          'version': {
              'number': undefined,
              'string': 'Unknown'
          },
               'OS': 'Unknown',

        // Initially set to false, if detected one of the following browsers
        // will be updated.
              'aol': false,
           'camino': false,
          'firefox': false,
            'flock': false,
             'icab': false,
        'konqueror': false,
          'mozilla': false,
             'msie': false,
         'netscape': false,
            'opera': false,
           'safari': false,

        // Initially set to false, if detected one of the following operating
        // systems will be updated.
            'linux': false,
              'mac': false,
              'win': false
    };



    /**
     * Loop over the items in 'data' trying to find a browser match with the
     * test in data[i].browser().  Once found, attempt to determine the
     * browser version.
     *
     *       'name': A string containing the full name of the browser.
     * 'identifier': By default this is a lowercase version of 'name', but
     *               this can be overwritten by explicitly defining an
     *               'identifier'.
     *    'browser': A function that returns a boolean value indicating
     *               whether or not the given browser is detected.
     *    'version': An optional function that overwrites the default version
     *               testing.  Must return the result of a .match().
     *
     * Please note that the order of the data array is important, as some
     * browsers contain details of others in their navigator.userAgent string.
     * For example, Flock's contains 'Firefox' so much come before Firefox's
     * test to avoid false positives.
     */
    for( var  i = 0,                    // counter
             ua = navigator.userAgent,  // the navigator's user agent string
             ve = navigator.vendor,     // the navigator's vendor string
           data = [                     // browser tests and data
                { // Safari <http://www.apple.com/safari/>
                          'name': 'Safari',
                       'browser': function() { return /Apple/.test(ve) }
                },
                { // Opera <http://www.opera.com/>
                          'name': 'Opera',
                       'browser': function() {
                                      return window.opera != undefined
                                  }
                },
                { // iCab <http://www.icab.de/>
                          'name': 'iCab',
                       'browser': function() { return /iCab/.test(ve) }
                },
                { // Konqueror <http://www.konqueror.org/>
                          'name': 'Konqueror',
                       'browser': function() { return /KDE/.test(ve) }
                },
                { // AOL Explorer <http://downloads.channel.aol.com/browser>
                    'identifier': 'aol',
                          'name': 'AOL Explorer',
                       'browser': function() {
                                      return /America Online Browser/.test(ua)
                                  },
                       'version': function() {
                                      return ua.match(/rev(\d+(?:\.\d+)+)/)
                                  }
                },
                { // Flock <http://www.flock.com/>
                          'name': 'Flock',
                       'browser': function() { return /Flock/.test(ua) }
                },
                { // Camino <http://www.caminobrowser.org/>
                          'name': 'Camino',
                       'browser': function() { return /Camino/.test(ve) }
                },
                { // Firefox <http://www.mozilla.com/firefox/>
                          'name': 'Firefox',
                       'browser': function() { return /Firefox/.test(ua) }
                },
                { // Netscape <http://browser.netscape.com/>
                          'name': 'Netscape',
                       'browser': function() { return /Netscape/.test(ua) }
                },
                { // Internet Explorer <http://www.microsoft.com/windows/ie/>
                  //                   <http://www.microsoft.com/mac/ie/>
                    'identifier': 'msie',
                          'name': 'Internet Explorer',
                       'browser': function() { return /MSIE/.test(ua) },
                       'version': function() {
                                      return ua.match(
                                          /MSIE (\d+(?:\.\d+)+(?:b\d*)?)/
                                      )
                                  }
                },
                { // Mozilla <http://www.mozilla.org/products/mozilla1.x/>
                          'name': 'Mozilla',
                       'browser': function() {
                                      return /Gecko|Mozilla/.test(ua)
                                  },
                       'version': function() {
                                      return ua.match(/rv:(\d+(?:\.\d+)+)/)
                                  }
                 }
             ];
         i < data.length;
         i++
    ) {
        if( data[i].browser() ) { // we have a match
            // If the identifier is not explicitly set, use a lowercase
            // version of the given name.
            var identifier = data[i].identifier ? data[i].identifier
                                                : data[i].name.toLowerCase();

            // Make a note that this browser was detected.
            Private[ identifier ] = true;

            // $.browser.browser() will now return the correct browser.
            Private.browser = data[i].name;

            var result;
            if( data[i].version != undefined && (result = data[i].version()) ) {
                // Use the explicitly set test for browser version.
                Private.version.string = result[1];
                Private.version.number = parseFloat( result[1] );
            } else {
                // Otherwise use the default test which searches for the
                // version number after the browser name in the user agent
                // string.
                var re = new RegExp(
                    data[i].name + '(?:\\s|\\/)(\\d+(?:\\.\\d+)+(?:(?:a|b)\\d*)?)'
                );

                result = ua.match(re);
                if( result != undefined ) {
                    Private.version.string = result[1];
                    Private.version.number = parseFloat( result[1] );
                }
            }

            // Once we've detected the browser there is no need to check the
            // others.
            break;
        }
    };



    /**
     * Loop over the items in 'data' trying to find a operating system match
     * with the test in data[i].os().
     *
     *       'name': A string containing the full name of the operating
     *               system.
     * 'identifier': By default this is a lowercase version of 'name', but
     *               this can be overwritten by explicitly defining an
     *               'identifier'.
     *         'OS': A function that returns a boolean value indicating
     *               whether or not the given operating system is detected.
     */
    for( var  i = 0,                  // counter
             pl = navigator.platform, // the navigator's platform string
           data = [                   // OS data and tests
                { // Microsoft Windows <http://www.microsoft.com/windows/>
                    'identifier': 'win',
                          'name': 'Windows',
                            'OS': function() { return /Win/.test(pl) }
                },
                { // Apple Mac OS <http://www.apple.com/macos/>
                          'name': 'Mac',
                            'OS': function() { return /Mac/.test(pl) }
                },
                { // Linux <http://www.linux.org/>
                          'name': 'Linux',
                            'OS': function() { return /Linux/.test(pl) }
                }
           ];
       i < data.length;
       i++
    ) {
        if( data[i].OS() ) { // we have a match
            // If the identifier is not explicitly set, use a lowercase
            // version of the given name.
            var identifier = data[i].identifier ? data[i].identifier
                                                : data[i].name.toLowerCase();

            // Make a note that the OS was detected.
            Private[ identifier ] = true;

            // $.browser.OS() will now return the correct OS.
            Private.OS = data[i].name;

            // Once we've detected the browser there is no need to check the
            // others.
            break;
        }
    };
}();
;
/* jquery.sparkline 2.1.2 - http://omnipotent.net/jquery.sparkline/ 
** Licensed under the New BSD License - see above site for details */

(function(a,b,c){(function(a){typeof define=="function"&&define.amd?define(["jquery"],a):jQuery&&!jQuery.fn.sparkline&&a(jQuery)})(function(d){"use strict";var e={},f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=0;f=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:c,normalRangeMax:c,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:c,chartRangeMax:c,chartRangeMinX:c,chartRangeMaxX:c,tooltipFormat:new h('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:c,nullColor:c,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:c,chartRangeMin:c,chartRangeClip:!1,colorMap:c,tooltipFormat:new h('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new h('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:c,thresholdValue:0,chartRangeMax:c,chartRangeMin:c,chartRangeClip:!1,tooltipFormat:new h("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:c,tooltipFormat:new h("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new h('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:c,targetColor:"#4a2",chartRangeMax:c,chartRangeMin:c,tooltipFormat:new h("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},E='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}',g=function(){var a,b;return a=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(a.prototype=d.extend(new arguments[0],arguments[arguments.length-1]),a._super=arguments[0].prototype):a.prototype=arguments[arguments.length-1],arguments.length>2&&(b=Array.prototype.slice.call(arguments,1,-1),b.unshift(a.prototype),d.extend.apply(d,b))):a.prototype=arguments[0],a.prototype.cls=a,a},d.SPFormatClass=h=g({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(a,b){this.format=a,this.fclass=b},render:function(a,b,d){var e=this,f=a,g,h,i,j,k;return this.format.replace(this.fre,function(){var a;return h=arguments[1],i=arguments[3],g=e.precre.exec(h),g?(k=g[2],h=g[1]):k=!1,j=f[h],j===c?"":i&&b&&b[i]?(a=b[i],a.get?b[i].get(j)||j:b[i][j]||j):(n(j)&&(d.get("numberFormatter")?j=d.get("numberFormatter")(j):j=s(j,k,d.get("numberDigitGroupCount"),d.get("numberDigitGroupSep"),d.get("numberDecimalMark"))),j)})}}),d.spformat=function(a,b){return new h(a,b)},i=function(a,b,c){return a<b?b:a>c?c:a},j=function(a,c){var d;return c===2?(d=b.floor(a.length/2),a.length%2?a[d]:(a[d-1]+a[d])/2):a.length%2?(d=(a.length*c+c)/4,d%1?(a[b.floor(d)]+a[b.floor(d)-1])/2:a[d-1]):(d=(a.length*c+2)/4,d%1?(a[b.floor(d)]+a[b.floor(d)-1])/2:a[d-1])},k=function(a){var b;switch(a){case"undefined":a=c;break;case"null":a=null;break;case"true":a=!0;break;case"false":a=!1;break;default:b=parseFloat(a),a==b&&(a=b)}return a},l=function(a){var b,c=[];for(b=a.length;b--;)c[b]=k(a[b]);return c},m=function(a,b){var c,d,e=[];for(c=0,d=a.length;c<d;c++)a[c]!==b&&e.push(a[c]);return e},n=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},s=function(a,b,c,e,f){var g,h;a=(b===!1?parseFloat(a).toString():a.toFixed(b)).split(""),g=(g=d.inArray(".",a))<0?a.length:g,g<a.length&&(a[g]=f);for(h=g-c;h>0;h-=c)a.splice(h,0,e);return a.join("")},o=function(a,b,c){var d;for(d=b.length;d--;){if(c&&b[d]===null)continue;if(b[d]!==a)return!1}return!0},p=function(a){var b=0,c;for(c=a.length;c--;)b+=typeof a[c]=="number"?a[c]:0;return b},r=function(a){return d.isArray(a)?a:[a]},q=function(b){var c;a.createStyleSheet?a.createStyleSheet().cssText=b:(c=a.createElement("style"),c.type="text/css",a.getElementsByTagName("head")[0].appendChild(c),c[typeof a.body.style.WebkitAppearance=="string"?"innerText":"innerHTML"]=b)},d.fn.simpledraw=function(b,e,f,g){var h,i;if(f&&(h=this.data("_jqs_vcanvas")))return h;if(d.fn.sparkline.canvas===!1)return!1;if(d.fn.sparkline.canvas===c){var j=a.createElement("canvas");if(!j.getContext||!j.getContext("2d")){if(!a.namespaces||!!a.namespaces.v)return d.fn.sparkline.canvas=!1,!1;a.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),d.fn.sparkline.canvas=function(a,b,c,d){return new J(a,b,c)}}else d.fn.sparkline.canvas=function(a,b,c,d){return new I(a,b,c,d)}}return b===c&&(b=d(this).innerWidth()),e===c&&(e=d(this).innerHeight()),h=d.fn.sparkline.canvas(b,e,this,g),i=d(this).data("_jqs_mhandler"),i&&i.registerCanvas(h),h},d.fn.cleardraw=function(){var a=this.data("_jqs_vcanvas");a&&a.reset()},d.RangeMapClass=t=g({init:function(a){var b,c,d=[];for(b in a)a.hasOwnProperty(b)&&typeof b=="string"&&b.indexOf(":")>-1&&(c=b.split(":"),c[0]=c[0].length===0?-Infinity:parseFloat(c[0]),c[1]=c[1].length===0?Infinity:parseFloat(c[1]),c[2]=a[b],d.push(c));this.map=a,this.rangelist=d||!1},get:function(a){var b=this.rangelist,d,e,f;if((f=this.map[a])!==c)return f;if(b)for(d=b.length;d--;){e=b[d];if(e[0]<=a&&e[1]>=a)return e[2]}return c}}),d.range_map=function(a){return new t(a)},u=g({init:function(a,b){var c=d(a);this.$el=c,this.options=b,this.currentPageX=0,this.currentPageY=0,this.el=a,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!b.get("disableTooltips"),this.highlightEnabled=!b.get("disableHighlight")},registerSparkline:function(a){this.splist.push(a),this.over&&this.updateDisplay()},registerCanvas:function(a){var b=d(a.canvas);this.canvas=a,this.$canvas=b,b.mouseenter(d.proxy(this.mouseenter,this)),b.mouseleave(d.proxy(this.mouseleave,this)),b.click(d.proxy(this.mouseclick,this))},reset:function(a){this.splist=[],this.tooltip&&a&&(this.tooltip.remove(),this.tooltip=c)},mouseclick:function(a){var b=d.Event("sparklineClick");b.originalEvent=a,b.sparklines=this.splist,this.$el.trigger(b)},mouseenter:function(b){d(a.body).unbind("mousemove.jqs"),d(a.body).bind("mousemove.jqs",d.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=b.pageX,this.currentPageY=b.pageY,this.currentEl=b.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new v(this.options),this.tooltip.updatePosition(b.pageX,b.pageY)),this.updateDisplay()},mouseleave:function(){d(a.body).unbind("mousemove.jqs");var b=this.splist,c=b.length,e=!1,f,g;this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null);for(g=0;g<c;g++)f=b[g],f.clearRegionHighlight()&&(e=!0);e&&this.canvas.render()},mousemove:function(a){this.currentPageX=a.pageX,this.currentPageY=a.pageY,this.currentEl=a.target,this.tooltip&&this.tooltip.updatePosition(a.pageX,a.pageY),this.updateDisplay()},updateDisplay:function(){var a=this.splist,b=a.length,c=!1,e=this.$canvas.offset(),f=this.currentPageX-e.left,g=this.currentPageY-e.top,h,i,j,k,l;if(!this.over)return;for(j=0;j<b;j++)i=a[j],k=i.setRegionHighlight(this.currentEl,f,g),k&&(c=!0);if(c){l=d.Event("sparklineRegionChange"),l.sparklines=this.splist,this.$el.trigger(l);if(this.tooltip){h="";for(j=0;j<b;j++)i=a[j],h+=i.getCurrentRegionTooltip();this.tooltip.setContent(h)}this.disableHighlight||this.canvas.render()}k===null&&this.mouseleave()}}),v=g({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(b){var c=b.get("tooltipClassname","jqstooltip"),e=this.sizeStyle,f;this.container=b.get("tooltipContainer")||a.body,this.tooltipOffsetX=b.get("tooltipOffsetX",10),this.tooltipOffsetY=b.get("tooltipOffsetY",12),d("#jqssizetip").remove(),d("#jqstooltip").remove(),this.sizetip=d("<div/>",{id:"jqssizetip",style:e,"class":c}),this.tooltip=d("<div/>",{id:"jqstooltip","class":c}).appendTo(this.container),f=this.tooltip.offset(),this.offsetLeft=f.left,this.offsetTop=f.top,this.hidden=!0,d(window).unbind("resize.jqs scroll.jqs"),d(window).bind("resize.jqs scroll.jqs",d.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=d(window).scrollTop(),this.scrollLeft=d(window).scrollLeft(),this.scrollRight=this.scrollLeft+d(window).width(),this.updatePosition()},getSize:function(a){this.sizetip.html(a).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(a){if(!a){this.tooltip.css("visibility","hidden"),this.hidden=!0;return}this.getSize(a),this.tooltip.html(a).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())},updatePosition:function(a,b){if(a===c){if(this.mousex===c)return;a=this.mousex-this.offsetLeft,b=this.mousey-this.offsetTop}else this.mousex=a-=this.offsetLeft,this.mousey=b-=this.offsetTop;if(!this.height||!this.width||this.hidden)return;b-=this.height+this.tooltipOffsetY,a+=this.tooltipOffsetX,b<this.scrollTop&&(b=this.scrollTop),a<this.scrollLeft?a=this.scrollLeft:a+this.width>this.scrollRight&&(a=this.scrollRight-this.width),this.tooltip.css({left:a,top:b})},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=c,d(window).unbind("resize.jqs scroll.jqs")}}),F=function(){q(E)},d(F),K=[],d.fn.sparkline=function(b,e){return this.each(function(){var f=new d.fn.sparkline.options(this,e),g=d(this),h,i;h=function(){var e,h,i,j,k,l,m;if(b==="html"||b===c){m=this.getAttribute(f.get("tagValuesAttribute"));if(m===c||m===null)m=g.html();e=m.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")}else e=b;h=f.get("width")==="auto"?e.length*f.get("defaultPixelsPerValue"):f.get("width");if(f.get("height")==="auto"){if(!f.get("composite")||!d.data(this,"_jqs_vcanvas"))j=a.createElement("span"),j.innerHTML="a",g.html(j),i=d(j).innerHeight()||d(j).height(),d(j).remove(),j=null}else i=f.get("height");f.get("disableInteraction")?k=!1:(k=d.data(this,"_jqs_mhandler"),k?f.get("composite")||k.reset():(k=new u(this,f),d.data(this,"_jqs_mhandler",k)));if(f.get("composite")&&!d.data(this,"_jqs_vcanvas")){d.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),d.data(this,"_jqs_errnotify",!0));return}l=new(d.fn.sparkline[f.get("type")])(this,e,f,h,i),l.render(),k&&k.registerSparkline(l)};if(d(this).html()&&!f.get("disableHiddenCheck")&&d(this).is(":hidden")||!d(this).parents("body").length){if(!f.get("composite")&&d.data(this,"_jqs_pending"))for(i=K.length;i;i--)K[i-1][0]==this&&K.splice(i-1,1);K.push([this,h]),d.data(this,"_jqs_pending",!0)}else h.call(this)})},d.fn.sparkline.defaults=f(),d.sparkline_display_visible=function(){var a,b,c,e=[];for(b=0,c=K.length;b<c;b++)a=K[b][0],d(a).is(":visible")&&!d(a).parents().is(":hidden")?(K[b][1].call(a),d.data(K[b][0],"_jqs_pending",!1),e.push(b)):!d(a).closest("html").length&&!d.data(a,"_jqs_pending")&&(d.data(K[b][0],"_jqs_pending",!1),e.push(b));for(b=e.length;b;b--)K.splice(e[b-1],1)},d.fn.sparkline.options=g({init:function(a,b){var c,f,g,h;this.userOptions=b=b||{},this.tag=a,this.tagValCache={},f=d.fn.sparkline.defaults,g=f.common,this.tagOptionsPrefix=b.enableTagOptions&&(b.tagOptionsPrefix||g.tagOptionsPrefix),h=this.getTagSetting("type"),h===e?c=f[b.type||g.type]:c=f[h],this.mergedOptions=d.extend({},g,c,b)},getTagSetting:function(a){var b=this.tagOptionsPrefix,d,f,g,h;if(b===!1||b===c)return e;if(this.tagValCache.hasOwnProperty(a))d=this.tagValCache.key;else{d=this.tag.getAttribute(b+a);if(d===c||d===null)d=e;else if(d.substr(0,1)==="["){d=d.substr(1,d.length-2).split(",");for(f=d.length;f--;)d[f]=k(d[f].replace(/(^\s*)|(\s*$)/g,""))}else if(d.substr(0,1)==="{"){g=d.substr(1,d.length-2).split(","),d={};for(f=g.length;f--;)h=g[f].split(":",2),d[h[0].replace(/(^\s*)|(\s*$)/g,"")]=k(h[1].replace(/(^\s*)|(\s*$)/g,""))}else d=k(d);this.tagValCache.key=d}return d},get:function(a,b){var d=this.getTagSetting(a),f;return d!==e?d:(f=this.mergedOptions[a])===c?b:f}}),d.fn.sparkline._base=g({disabled:!1,init:function(a,b,e,f,g){this.el=a,this.$el=d(a),this.values=b,this.options=e,this.width=f,this.height=g,this.currentRegion=c},initTarget:function(){var a=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),a))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(a,b){},setRegionHighlight:function(a,b,d){var e=this.currentRegion,f=!this.options.get("disableHighlight"),g;return b>this.canvasWidth||d>this.canvasHeight||b<0||d<0?null:(g=this.getRegion(a,b,d),e!==g?(e!==c&&f&&this.removeHighlight(),this.currentRegion=g,g!==c&&f&&this.renderHighlight(),!0):!1)},clearRegionHighlight:function(){return this.currentRegion!==c?(this.removeHighlight(),this.currentRegion=c,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(a){},getCurrentRegionTooltip:function(){var a=this.options,b="",e=[],f,g,i,j,k,l,m,n,o,p,q,r,s,t;if(this.currentRegion===c)return"";f=this.getCurrentRegionFields(),q=a.get("tooltipFormatter");if(q)return q(this,a,f);a.get("tooltipChartTitle")&&(b+='<div class="jqs jqstitle">'+a.get("tooltipChartTitle")+"</div>\n"),g=this.options.get("tooltipFormat");if(!g)return"";d.isArray(g)||(g=[g]),d.isArray(f)||(f=[f]),m=this.options.get("tooltipFormatFieldlist"),n=this.options.get("tooltipFormatFieldlistKey");if(m&&n){o=[];for(l=f.length;l--;)p=f[l][n],(t=d.inArray(p,m))!=-1&&(o[t]=f[l]);f=o}i=g.length,s=f.length;for(l=0;l<i;l++){r=g[l],typeof r=="string"&&(r=new h(r)),j=r.fclass||"jqsfield";for(t=0;t<s;t++)if(!f[t].isNull||!a.get("tooltipSkipNull"))d.extend(f[t],{prefix:a.get("tooltipPrefix"),suffix:a.get("tooltipSuffix")}),k=r.render(f[t],a.get("tooltipValueLookups"),a),e.push('<div class="'+j+'">'+k+"</div>")}return e.length?b+e.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(a,c){var d=c.get("highlightColor"),e=c.get("highlightLighten"),f,g,h,j;if(d)return d;if(e){f=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(a);if(f){h=[],g=a.length===4?16:1;for(j=0;j<3;j++)h[j]=i(b.round(parseInt(f[j+1],16)*g*e),0,255);return"rgb("+h.join(",")+")"}}return a}}),w={changeHighlight:function(a){var b=this.currentRegion,c=this.target,e=this.regionShapes[b],f;e&&(f=this.renderRegion(b,a),d.isArray(f)||d.isArray(e)?(c.replaceWithShapes(e,f),this.regionShapes[b]=d.map(f,function(a){return a.id})):(c.replaceWithShape(e,f),this.regionShapes[b]=f.id))},render:function(){var a=this.values,b=this.target,c=this.regionShapes,e,f,g,h;if(!this.cls._super.render.call(this))return;for(g=a.length;g--;){e=this.renderRegion(g);if(e)if(d.isArray(e)){f=[];for(h=e.length;h--;)e[h].append(),f.push(e[h].id);c[g]=f}else e.append(),c[g]=e.id;else c[g]=null}b.render()}},d.fn.sparkline.line=x=g(d.fn.sparkline._base,{type:"line",init:function(a,b,c,d,e){x._super.init.call(this,a,b,c,d,e),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(a,b,d){var e,f=this.regionMap;for(e=f.length;e--;)if(f[e]!==null&&b>=f[e][0]&&b<=f[e][1])return f[e][2];return c},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.yvalues[a]===null,x:this.xvalues[a],y:this.yvalues[a],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:a}},renderHighlight:function(){var a=this.currentRegion,b=this.target,d=this.vertices[a],e=this.options,f=e.get("spotRadius"),g=e.get("highlightSpotColor"),h=e.get("highlightLineColor"),i,j;if(!d)return;f&&g&&(i=b.drawCircle(d[0],d[1],f,c,g),this.highlightSpotId=i.id,b.insertAfterShape(this.lastShapeId,i)),h&&(j=b.drawLine(d[0],this.canvasTop,d[0],this.canvasTop+this.canvasHeight,h),this.highlightLineId=j.id,b.insertAfterShape(this.lastShapeId,j))},removeHighlight:function(){var a=this.target;this.highlightSpotId&&(a.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(a.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var a=this.values,c=a.length,d=this.xvalues,e=this.yvalues,f=this.yminmax,g,h,i,j,k;for(g=0;g<c;g++)h=a[g],i=typeof a[g]=="string",j=typeof a[g]=="object"&&a[g]instanceof Array,k=i&&a[g].split(":"),i&&k.length===2?(d.push(Number(k[0])),e.push(Number(k[1])),f.push(Number(k[1]))):j?(d.push(h[0]),e.push(h[1]),f.push(h[1])):(d.push(g),a[g]===null||a[g]==="null"?e.push(null):(e.push(Number(h)),f.push(Number(h))));this.options.get("xvalues")&&(d=this.options.get("xvalues")),this.maxy=this.maxyorg=b.max.apply(b,f),this.miny=this.minyorg=b.min.apply(b,f),this.maxx=b.max.apply(b,d),this.minx=b.min.apply(b,d),this.xvalues=d,this.yvalues=e,this.yminmax=f},processRangeOptions:function(){var a=this.options,b=a.get("normalRangeMin"),d=a.get("normalRangeMax");b!==c&&(b<this.miny&&(this.miny=b),d>this.maxy&&(this.maxy=d)),a.get("chartRangeMin")!==c&&(a.get("chartRangeClip")||a.get("chartRangeMin")<this.miny)&&(this.miny=a.get("chartRangeMin")),a.get("chartRangeMax")!==c&&(a.get("chartRangeClip")||a.get("chartRangeMax")>this.maxy)&&(this.maxy=a.get("chartRangeMax")),a.get("chartRangeMinX")!==c&&(a.get("chartRangeClipX")||a.get("chartRangeMinX")<this.minx)&&(this.minx=a.get("chartRangeMinX")),a.get("chartRangeMaxX")!==c&&(a.get("chartRangeClipX")||a.get("chartRangeMaxX")>this.maxx)&&(this.maxx=a.get("chartRangeMaxX"))},drawNormalRange:function(a,d,e,f,g){var h=this.options.get("normalRangeMin"),i=this.options.get("normalRangeMax"),j=d+b.round(e-e*((i-this.miny)/g)),k=b.round(e*(i-h)/g);this.target.drawRect(a,j,f,k,c,this.options.get("normalRangeColor")).append()},render:function(){var a=this.options,e=this.target,f=this.canvasWidth,g=this.canvasHeight,h=this.vertices,i=a.get("spotRadius"),j=this.regionMap,k,l,m,n,o,p,q,r,s,u,v,w,y,z,A,B,C,D,E,F,G,H,I,J,K;if(!x._super.render.call(this))return;this.scanValues(),this.processRangeOptions(),I=this.xvalues,J=this.yvalues;if(!this.yminmax.length||this.yvalues.length<2)return;n=o=0,k=this.maxx-this.minx===0?1:this.maxx-this.minx,l=this.maxy-this.miny===0?1:this.maxy-this.miny,m=this.yvalues.length-1,i&&(f<i*4||g<i*4)&&(i=0);if(i){G=a.get("highlightSpotColor")&&!a.get("disableInteraction");if(G||a.get("minSpotColor")||a.get("spotColor")&&J[m]===this.miny)g-=b.ceil(i);if(G||a.get("maxSpotColor")||a.get("spotColor")&&J[m]===this.maxy)g-=b.ceil(i),n+=b.ceil(i);if(G||(a.get("minSpotColor")||a.get("maxSpotColor"))&&(J[0]===this.miny||J[0]===this.maxy))o+=b.ceil(i),f-=b.ceil(i);if(G||a.get("spotColor")||a.get("minSpotColor")||a.get("maxSpotColor")&&(J[m]===this.miny||J[m]===this.maxy))f-=b.ceil(i)}g--,a.get("normalRangeMin")!==c&&!a.get("drawNormalOnTop")&&this.drawNormalRange(o,n,g,f,l),q=[],r=[q],z=A=null,B=J.length;for(K=0;K<B;K++)s=I[K],v=I[K+1],u=J[K],w=o+b.round((s-this.minx)*(f/k)),y=K<B-1?o+b.round((v-this.minx)*(f/k)):f,A=w+(y-w)/2,j[K]=[z||0,A,K],z=A,u===null?K&&(J[K-1]!==null&&(q=[],r.push(q)),h.push(null)):(u<this.miny&&(u=this.miny),u>this.maxy&&(u=this.maxy),q.length||q.push([w,n+g]),p=[w,n+b.round(g-g*((u-this.miny)/l))],q.push(p),h.push(p));C=[],D=[],E=r.length;for(K=0;K<E;K++)q=r[K],q.length&&(a.get("fillColor")&&(q.push([q[q.length-1][0],n+g]),D.push(q.slice(0)),q.pop()),q.length>2&&(q[0]=[q[0][0],q[1][1]]),C.push(q));E=D.length;for(K=0;K<E;K++)e.drawShape(D[K],a.get("fillColor"),a.get("fillColor")).append();a.get("normalRangeMin")!==c&&a.get("drawNormalOnTop")&&this.drawNormalRange(o,n,g,f,l),E=C.length;for(K=0;K<E;K++)e.drawShape(C[K],a.get("lineColor"),c,a.get("lineWidth")).append();if(i&&a.get("valueSpots")){F=a.get("valueSpots"),F.get===c&&(F=new t(F));for(K=0;K<B;K++)H=F.get(J[K]),H&&e.drawCircle(o+b.round((I[K]-this.minx)*(f/k)),n+b.round(g-g*((J[K]-this.miny)/l)),i,c,H).append()}i&&a.get("spotColor")&&J[m]!==null&&e.drawCircle(o+b.round((I[I.length-1]-this.minx)*(f/k)),n+b.round(g-g*((J[m]-this.miny)/l)),i,c,a.get("spotColor")).append(),this.maxy!==this.minyorg&&(i&&a.get("minSpotColor")&&(s=I[d.inArray(this.minyorg,J)],e.drawCircle(o+b.round((s-this.minx)*(f/k)),n+b.round(g-g*((this.minyorg-this.miny)/l)),i,c,a.get("minSpotColor")).append()),i&&a.get("maxSpotColor")&&(s=I[d.inArray(this.maxyorg,J)],e.drawCircle(o+b.round((s-this.minx)*(f/k)),n+b.round(g-g*((this.maxyorg-this.miny)/l)),i,c,a.get("maxSpotColor")).append())),this.lastShapeId=e.getLastShapeId(),this.canvasTop=n,e.render()}}),d.fn.sparkline.bar=y=g(d.fn.sparkline._base,w,{type:"bar",init:function(a,e,f,g,h){var j=parseInt(f.get("barWidth"),10),n=parseInt(f.get("barSpacing"),10),o=f.get("chartRangeMin"),p=f.get("chartRangeMax"),q=f.get("chartRangeClip"),r=Infinity,s=-Infinity,u,v,w,x,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;y._super.init.call(this,a,e,f,g,h);for(A=0,B=e.length;A<B;A++){O=e[A],u=typeof O=="string"&&O.indexOf(":")>-1;if(u||d.isArray(O))J=!0,u&&(O=e[A]=l(O.split(":"))),O=m(O,null),v=b.min.apply(b,O),w=b.max.apply(b,O),v<r&&(r=v),w>s&&(s=w)}this.stacked=J,this.regionShapes={},this.barWidth=j,this.barSpacing=n,this.totalBarWidth=j+n,this.width=g=e.length*j+(e.length-1)*n,this.initTarget(),q&&(H=o===c?-Infinity:o,I=p===c?Infinity:p),z=[],x=J?[]:z;var S=[],T=[];for(A=0,B=e.length;A<B;A++)if(J){K=e[A],e[A]=N=[],S[A]=0,x[A]=T[A]=0;for(L=0,M=K.length;L<M;L++)O=N[L]=q?i(K[L],H,I):K[L],O!==null&&(O>0&&(S[A]+=O),r<0&&s>0?O<0?T[A]+=b.abs(O):x[A]+=O:x[A]+=b.abs(O-(O<0?s:r)),z.push(O))}else O=q?i(e[A],H,I):e[A],O=e[A]=k(O),O!==null&&z.push(O);this.max=G=b.max.apply(b,z),this.min=F=b.min.apply(b,z),this.stackMax=s=J?b.max.apply(b,S):G,this.stackMin=r=J?b.min.apply(b,z):F,f.get("chartRangeMin")!==c&&(f.get("chartRangeClip")||f.get("chartRangeMin")<F)&&(F=f.get("chartRangeMin")),f.get("chartRangeMax")!==c&&(f.get("chartRangeClip")||f.get("chartRangeMax")>G)&&(G=f.get("chartRangeMax")),this.zeroAxis=D=f.get("zeroAxis",!0),F<=0&&G>=0&&D?E=0:D==0?E=F:F>0?E=F:E=G,this.xaxisOffset=E,C=J?b.max.apply(b,x)+b.max.apply(b,T):G-F,this.canvasHeightEf=D&&F<0?this.canvasHeight-2:this.canvasHeight-1,F<E?(Q=J&&G>=0?s:G,P=(Q-E)/C*this.canvasHeight,P!==b.ceil(P)&&(this.canvasHeightEf-=2,P=b.ceil(P))):P=this.canvasHeight,this.yoffset=P,d.isArray(f.get("colorMap"))?(this.colorMapByIndex=f.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=f.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===c&&(this.colorMapByValue=new t(this.colorMapByValue))),this.range=C},getRegion:function(a,d,e){var f=b.floor(d/this.totalBarWidth);return f<0||f>=this.values.length?c:f},getCurrentRegionFields:function(){var a=this.currentRegion,b=r(this.values[a]),c=[],d,e;for(e=b.length;e--;)d=b[e],c.push({isNull:d===null,value:d,color:this.calcColor(e,d,a),offset:a});return c},calcColor:function(a,b,e){var f=this.colorMapByIndex,g=this.colorMapByValue,h=this.options,i,j;return this.stacked?i=h.get("stackedBarColor"):i=b<0?h.get("negBarColor"):h.get("barColor"),b===0&&h.get("zeroColor")!==c&&(i=h.get("zeroColor")),g&&(j=g.get(b))?i=j:f&&f.length>e&&(i=f[e]),d.isArray(i)?i[a%i.length]:i},renderRegion:function(a,e){var f=this.values[a],g=this.options,h=this.xaxisOffset,i=[],j=this.range,k=this.stacked,l=this.target,m=a*this.totalBarWidth,n=this.canvasHeightEf,p=this.yoffset,q,r,s,t,u,v,w,x,y,z;f=d.isArray(f)?f:[f],w=f.length,x=f[0],t=o(null,f),z=o(h,f,!0);if(t)return g.get("nullColor")?(s=e?g.get("nullColor"):this.calcHighlightColor(g.get("nullColor"),g),q=p>0?p-1:p,l.drawRect(m,q,this.barWidth-1,0,s,s)):c;u=p;for(v=0;v<w;v++){x=f[v];if(k&&x===h){if(!z||y)continue;y=!0}j>0?r=b.floor(n*(b.abs(x-h)/j))+1:r=1,x<h||x===h&&p===0?(q=u,u+=r):(q=p-r,p-=r),s=this.calcColor(v,x,a),e&&(s=this.calcHighlightColor(s,g)),i.push(l.drawRect(m,q,this.barWidth-1,r-1,s,s))}return i.length===1?i[0]:i}}),d.fn.sparkline.tristate=z=g(d.fn.sparkline._base,w,{type:"tristate",init:function(a,b,e,f,g){var h=parseInt(e.get("barWidth"),10),i=parseInt(e.get("barSpacing"),10);z._super.init.call(this,a,b,e,f,g),this.regionShapes={},this.barWidth=h,this.barSpacing=i,this.totalBarWidth=h+i,this.values=d.map(b,Number),this.width=f=b.length*h+(b.length-1)*i,d.isArray(e.get("colorMap"))?(this.colorMapByIndex=e.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=e.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===c&&(this.colorMapByValue=new t(this.colorMapByValue))),this.initTarget()},getRegion:function(a,c,d){return b.floor(c/this.totalBarWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===c,value:this.values[a],color:this.calcColor(this.values[a],a),offset:a}},calcColor:function(a,b){var c=this.values,d=this.options,e=this.colorMapByIndex,f=this.colorMapByValue,g,h;return f&&(h=f.get(a))?g=h:e&&e.length>b?g=e[b]:c[b]<0?g=d.get("negBarColor"):c[b]>0?g=d.get("posBarColor"):g=d.get("zeroBarColor"),g},renderRegion:function(a,c){var d=this.values,e=this.options,f=this.target,g,h,i,j,k,l;g=f.pixelHeight,i=b.round(g/2),j=a*this.totalBarWidth,d[a]<0?(k=i,h=i-1):d[a]>0?(k=0,h=i-1):(k=i-1,h=2),l=this.calcColor(d[a],a);if(l===null)return;return c&&(l=this.calcHighlightColor(l,e)),f.drawRect(j,k,this.barWidth-1,h-1,l,l)}}),d.fn.sparkline.discrete=A=g(d.fn.sparkline._base,w,{type:"discrete",init:function(a,e,f,g,h){A._super.init.call(this,a,e,f,g,h),this.regionShapes={},this.values=e=d.map(e,Number),this.min=b.min.apply(b,e),this.max=b.max.apply(b,e),this.range=this.max-this.min,this.width=g=f.get("width")==="auto"?e.length*2:this.width,this.interval=b.floor(g/e.length),this.itemWidth=g/e.length,f.get("chartRangeMin")!==c&&(f.get("chartRangeClip")||f.get("chartRangeMin")<this.min)&&(this.min=f.get("chartRangeMin")),f.get("chartRangeMax")!==c&&(f.get("chartRangeClip")||f.get("chartRangeMax")>this.max)&&(this.max=f.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight=f.get("lineHeight")==="auto"?b.round(this.canvasHeight*.3):f.get("lineHeight"))},getRegion:function(a,c,d){return b.floor(c/this.itemWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===c,value:this.values[a],offset:a}},renderRegion:function(a,c){var d=this.values,e=this.options,f=this.min,g=this.max,h=this.range,j=this.interval,k=this.target,l=this.canvasHeight,m=this.lineHeight,n=l-m,o,p,q,r;return p=i(d[a],f,g),r=a*j,o=b.round(n-n*((p-f)/h)),q=e.get("thresholdColor")&&p<e.get("thresholdValue")?e.get("thresholdColor"):e.get("lineColor"),c&&(q=this.calcHighlightColor(q,e)),k.drawLine(r,o,r,o+m,q)}}),d.fn.sparkline.bullet=B=g(d.fn.sparkline._base,{type:"bullet",init:function(a,d,e,f,g){var h,i,j;B._super.init.call(this,a,d,e,f,g),this.values=d=l(d),j=d.slice(),j[0]=j[0]===null?j[2]:j[0],j[1]=d[1]===null?j[2]:j[1],h=b.min.apply(b,d),i=b.max.apply(b,d),e.get("base")===c?h=h<0?h:0:h=e.get("base"),this.min=h,this.max=i,this.range=i-h,this.shapes={},this.valueShapes={},this.regiondata={},this.width=f=e.get("width")==="auto"?"4.0em":f,this.target=this.$el.simpledraw(f,g,e.get("composite")),d.length||(this.disabled=!0),this.initTarget()},getRegion:function(a,b,d){var e=this.target.getShapeAt(a,b,d);return e!==c&&this.shapes[e]!==c?this.shapes[e]:c},getCurrentRegionFields:function(){var a=this.currentRegion;return{fieldkey:a.substr(0,1),value:this.values[a.substr(1)],region:a}},changeHighlight:function(a){var b=this.currentRegion,c=this.valueShapes[b],d;delete this.shapes[c];switch(b.substr(0,1)){case"r":d=this.renderRange(b.substr(1),a);break;case"p":d=this.renderPerformance(a);break;case"t":d=this.renderTarget(a)}this.valueShapes[b]=d.id,this.shapes[d.id]=b,this.target.replaceWithShape(c,d)},renderRange:function(a,c){var d=this.values[a],e=b.round(this.canvasWidth*((d-this.min)/this.range)),f=this.options.get("rangeColors")[a-2];return c&&(f=this.calcHighlightColor(f,this.options)),this.target.drawRect(0,0,e-1,this.canvasHeight-1,f,f)},renderPerformance:function(a){var c=this.values[1],d=b.round(this.canvasWidth*((c-this.min)/this.range)),e=this.options.get("performanceColor");return a&&(e=this.calcHighlightColor(e,this.options)),this.target.drawRect(0,b.round(this.canvasHeight*.3),d-1,b.round(this.canvasHeight*.4)-1,e,e)},renderTarget:function(a){var c=this.values[0],d=b.round(this.canvasWidth*((c-this.min)/this.range)-this.options.get("targetWidth")/2),e=b.round(this.canvasHeight*.1),f=this.canvasHeight-e*2,g=this.options.get("targetColor");return a&&(g=this.calcHighlightColor(g,this.options)),this.target.drawRect(d,e,this.options.get("targetWidth")-1,f-1,g,g)},render:function(){var a=this.values.length,b=this.target,c,d;if(!B._super.render.call(this))return;for(c=2;c<a;c++)d=this.renderRange(c).append(),this.shapes[d.id]="r"+c,this.valueShapes["r"+c]=d.id;this.values[1]!==null&&(d=this.renderPerformance().append(),this.shapes[d.id]="p1",this.valueShapes.p1=d.id),this.values[0]!==null&&(d=this.renderTarget().append(),this.shapes[d.id]="t0",this.valueShapes.t0=d.id),b.render()}}),d.fn.sparkline.pie=C=g(d.fn.sparkline._base,{type:"pie",init:function(a,c,e,f,g){var h=0,i;C._super.init.call(this,a,c,e,f,g),this.shapes={},this.valueShapes={},this.values=c=d.map(c,Number),e.get("width")==="auto"&&(this.width=this.height);if(c.length>0)for(i=c.length;i--;)h+=c[i];this.total=h,this.initTarget(),this.radius=b.floor(b.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(a,b,d){var e=this.target.getShapeAt(a,b,d);return e!==c&&this.shapes[e]!==c?this.shapes[e]:c},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===c,value:this.values[a],percent:this.values[a]/this.total*100,color:this.options.get("sliceColors")[a%this.options.get("sliceColors").length],offset:a}},changeHighlight:function(a){var b=this.currentRegion,c=this.renderSlice(b,a),d=this.valueShapes[b];delete this.shapes[d],this.target.replaceWithShape(d,c),this.valueShapes[b]=c.id,this.shapes[c.id]=b},renderSlice:function(a,d){var e=this.target,f=this.options,g=this.radius,h=f.get("borderWidth"),i=f.get("offset"),j=2*b.PI,k=this.values,l=this.total,m=i?2*b.PI*(i/360):0,n,o,p,q,r;q=k.length;for(p=0;p<q;p++){n=m,o=m,l>0&&(o=m+j*(k[p]/l));if(a===p)return r=f.get("sliceColors")[p%f.get("sliceColors").length],d&&(r=this.calcHighlightColor(r,f)),e.drawPieSlice(g,g,g-h,n,o,c,r);m=o}},render:function(){var a=this.target,d=this.values,e=this.options,f=this.radius,g=e.get("borderWidth"),h,i;if(!C._super.render.call(this))return;g&&a.drawCircle(f,f,b.floor(f-g/2),e.get("borderColor"),c,g).append();for(i=d.length;i--;)d[i]&&(h=this.renderSlice(i).append(),this.valueShapes[i]=h.id,this.shapes[h.id]=i);a.render()}}),d.fn.sparkline.box=D=g(d.fn.sparkline._base,{type:"box",init:function(a,b,c,e,f){D._super.init.call(this,a,b,c,e,f),this.values=d.map(b,Number),this.width=c.get("width")==="auto"?"4.0em":e,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var a=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles
[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==c&&a.push({field:"lo",value:this.loutlier}),this.routlier!==c&&a.push({field:"ro",value:this.routlier}),this.lwhisker!==c&&a.push({field:"lw",value:this.lwhisker}),this.rwhisker!==c&&a.push({field:"rw",value:this.rwhisker}),a},render:function(){var a=this.target,d=this.values,e=d.length,f=this.options,g=this.canvasWidth,h=this.canvasHeight,i=f.get("chartRangeMin")===c?b.min.apply(b,d):f.get("chartRangeMin"),k=f.get("chartRangeMax")===c?b.max.apply(b,d):f.get("chartRangeMax"),l=0,m,n,o,p,q,r,s,t,u,v,w;if(!D._super.render.call(this))return;if(f.get("raw"))f.get("showOutliers")&&d.length>5?(n=d[0],m=d[1],p=d[2],q=d[3],r=d[4],s=d[5],t=d[6]):(m=d[0],p=d[1],q=d[2],r=d[3],s=d[4]);else{d.sort(function(a,b){return a-b}),p=j(d,1),q=j(d,2),r=j(d,3),o=r-p;if(f.get("showOutliers")){m=s=c;for(u=0;u<e;u++)m===c&&d[u]>p-o*f.get("outlierIQR")&&(m=d[u]),d[u]<r+o*f.get("outlierIQR")&&(s=d[u]);n=d[0],t=d[e-1]}else m=d[0],s=d[e-1]}this.quartiles=[p,q,r],this.lwhisker=m,this.rwhisker=s,this.loutlier=n,this.routlier=t,w=g/(k-i+1),f.get("showOutliers")&&(l=b.ceil(f.get("spotRadius")),g-=2*b.ceil(f.get("spotRadius")),w=g/(k-i+1),n<m&&a.drawCircle((n-i)*w+l,h/2,f.get("spotRadius"),f.get("outlierLineColor"),f.get("outlierFillColor")).append(),t>s&&a.drawCircle((t-i)*w+l,h/2,f.get("spotRadius"),f.get("outlierLineColor"),f.get("outlierFillColor")).append()),a.drawRect(b.round((p-i)*w+l),b.round(h*.1),b.round((r-p)*w),b.round(h*.8),f.get("boxLineColor"),f.get("boxFillColor")).append(),a.drawLine(b.round((m-i)*w+l),b.round(h/2),b.round((p-i)*w+l),b.round(h/2),f.get("lineColor")).append(),a.drawLine(b.round((m-i)*w+l),b.round(h/4),b.round((m-i)*w+l),b.round(h-h/4),f.get("whiskerColor")).append(),a.drawLine(b.round((s-i)*w+l),b.round(h/2),b.round((r-i)*w+l),b.round(h/2),f.get("lineColor")).append(),a.drawLine(b.round((s-i)*w+l),b.round(h/4),b.round((s-i)*w+l),b.round(h-h/4),f.get("whiskerColor")).append(),a.drawLine(b.round((q-i)*w+l),b.round(h*.1),b.round((q-i)*w+l),b.round(h*.9),f.get("medianColor")).append(),f.get("target")&&(v=b.ceil(f.get("spotRadius")),a.drawLine(b.round((f.get("target")-i)*w+l),b.round(h/2-v),b.round((f.get("target")-i)*w+l),b.round(h/2+v),f.get("targetColor")).append(),a.drawLine(b.round((f.get("target")-i)*w+l-v),b.round(h/2),b.round((f.get("target")-i)*w+l+v),b.round(h/2),f.get("targetColor")).append()),a.render()}}),G=g({init:function(a,b,c,d){this.target=a,this.id=b,this.type=c,this.args=d},append:function(){return this.target.appendShape(this),this}}),H=g({_pxregex:/(\d+)(px)?\s*$/i,init:function(a,b,c){if(!a)return;this.width=a,this.height=b,this.target=c,this.lastShapeId=null,c[0]&&(c=c[0]),d.data(c,"_jqs_vcanvas",this)},drawLine:function(a,b,c,d,e,f){return this.drawShape([[a,b],[c,d]],e,f)},drawShape:function(a,b,c,d){return this._genShape("Shape",[a,b,c,d])},drawCircle:function(a,b,c,d,e,f){return this._genShape("Circle",[a,b,c,d,e,f])},drawPieSlice:function(a,b,c,d,e,f,g){return this._genShape("PieSlice",[a,b,c,d,e,f,g])},drawRect:function(a,b,c,d,e,f){return this._genShape("Rect",[a,b,c,d,e,f])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(a,b){d(b).html(a)},_calculatePixelDims:function(a,b,c){var e;e=this._pxregex.exec(b),e?this.pixelHeight=e[1]:this.pixelHeight=d(c).height(),e=this._pxregex.exec(a),e?this.pixelWidth=e[1]:this.pixelWidth=d(c).width()},_genShape:function(a,b){var c=L++;return b.unshift(c),new G(this,c,a,b)},appendShape:function(a){alert("appendShape not implemented")},replaceWithShape:function(a,b){alert("replaceWithShape not implemented")},insertAfterShape:function(a,b){alert("insertAfterShape not implemented")},removeShapeId:function(a){alert("removeShapeId not implemented")},getShapeAt:function(a,b,c){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),I=g(H,{init:function(b,e,f,g){I._super.init.call(this,b,e,f),this.canvas=a.createElement("canvas"),f[0]&&(f=f[0]),d.data(f,"_jqs_vcanvas",this),d(this.canvas).css({display:"inline-block",width:b,height:e,verticalAlign:"top"}),this._insert(this.canvas,f),this._calculatePixelDims(b,e,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=g,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=c,d(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(a,b,d){var e=this.canvas.getContext("2d");return a!==c&&(e.strokeStyle=a),e.lineWidth=d===c?1:d,b!==c&&(e.fillStyle=b),e},reset:function(){var a=this._getContext();a.clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=c},_drawShape:function(a,b,d,e,f){var g=this._getContext(d,e,f),h,i;g.beginPath(),g.moveTo(b[0][0]+.5,b[0][1]+.5);for(h=1,i=b.length;h<i;h++)g.lineTo(b[h][0]+.5,b[h][1]+.5);d!==c&&g.stroke(),e!==c&&g.fill(),this.targetX!==c&&this.targetY!==c&&g.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawCircle:function(a,d,e,f,g,h,i){var j=this._getContext(g,h,i);j.beginPath(),j.arc(d,e,f,0,2*b.PI,!1),this.targetX!==c&&this.targetY!==c&&j.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a),g!==c&&j.stroke(),h!==c&&j.fill()},_drawPieSlice:function(a,b,d,e,f,g,h,i){var j=this._getContext(h,i);j.beginPath(),j.moveTo(b,d),j.arc(b,d,e,f,g,!1),j.lineTo(b,d),j.closePath(),h!==c&&j.stroke(),i&&j.fill(),this.targetX!==c&&this.targetY!==c&&j.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawRect:function(a,b,c,d,e,f,g){return this._drawShape(a,[[b,c],[b+d,c],[b+d,c+e],[b,c+e],[b,c]],f,g)},appendShape:function(a){return this.shapes[a.id]=a,this.shapeseq.push(a.id),this.lastShapeId=a.id,a.id},replaceWithShape:function(a,b){var c=this.shapeseq,d;this.shapes[b.id]=b;for(d=c.length;d--;)c[d]==a&&(c[d]=b.id);delete this.shapes[a]},replaceWithShapes:function(a,b){var c=this.shapeseq,d={},e,f,g;for(f=a.length;f--;)d[a[f]]=!0;for(f=c.length;f--;)e=c[f],d[e]&&(c.splice(f,1),delete this.shapes[e],g=f);for(f=b.length;f--;)c.splice(g,0,b[f].id),this.shapes[b[f].id]=b[f]},insertAfterShape:function(a,b){var c=this.shapeseq,d;for(d=c.length;d--;)if(c[d]===a){c.splice(d+1,0,b.id),this.shapes[b.id]=b;return}},removeShapeId:function(a){var b=this.shapeseq,c;for(c=b.length;c--;)if(b[c]===a){b.splice(c,1);break}delete this.shapes[a]},getShapeAt:function(a,b,c){return this.targetX=b,this.targetY=c,this.render(),this.currentTargetShapeId},render:function(){var a=this.shapeseq,b=this.shapes,c=a.length,d=this._getContext(),e,f,g;d.clearRect(0,0,this.pixelWidth,this.pixelHeight);for(g=0;g<c;g++)e=a[g],f=b[e],this["_draw"+f.type].apply(this,f.args);this.interact||(this.shapes={},this.shapeseq=[])}}),J=g(H,{init:function(b,c,e){var f;J._super.init.call(this,b,c,e),e[0]&&(e=e[0]),d.data(e,"_jqs_vcanvas",this),this.canvas=a.createElement("span"),d(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:b,height:c,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,e),this._calculatePixelDims(b,c,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,f='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"'+' style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",f),this.group=d(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(a,b,d,e,f){var g=[],h,i,j,k,l,m,n;for(n=0,m=b.length;n<m;n++)g[n]=""+b[n][0]+","+b[n][1];return h=g.splice(0,1),f=f===c?1:f,i=d===c?' stroked="false" ':' strokeWeight="'+f+'px" strokeColor="'+d+'" ',j=e===c?' filled="false"':' fillColor="'+e+'" filled="true" ',k=g[0]===g[g.length-1]?"x ":"",l='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" '+' id="jqsshape'+a+'" '+i+j+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;" '+' path="m '+h+" l "+g.join(", ")+" "+k+'e">'+" </v:shape>",l},_drawCircle:function(a,b,d,e,f,g,h){var i,j,k;return b-=e,d-=e,i=f===c?' stroked="false" ':' strokeWeight="'+h+'px" strokeColor="'+f+'" ',j=g===c?' filled="false"':' fillColor="'+g+'" filled="true" ',k='<v:oval  id="jqsshape'+a+'" '+i+j+' style="position:absolute;top:'+d+"px; left:"+b+"px; width:"+e*2+"px; height:"+e*2+'px"></v:oval>',k},_drawPieSlice:function(a,d,e,f,g,h,i,j){var k,l,m,n,o,p,q,r;if(g===h)return"";h-g===2*b.PI&&(g=0,h=2*b.PI),l=d+b.round(b.cos(g)*f),m=e+b.round(b.sin(g)*f),n=d+b.round(b.cos(h)*f),o=e+b.round(b.sin(h)*f);if(l===n&&m===o){if(h-g<b.PI)return"";l=n=d+f,m=o=e}return l===n&&m===o&&h-g<b.PI?"":(k=[d-f,e-f,d+f,e+f,l,m,n,o],p=i===c?' stroked="false" ':' strokeWeight="1px" strokeColor="'+i+'" ',q=j===c?' filled="false"':' fillColor="'+j+'" filled="true" ',r='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" '+' id="jqsshape'+a+'" '+p+q+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;" '+' path="m '+d+","+e+" wa "+k.join(", ")+' x e">'+" </v:shape>",r)},_drawRect:function(a,b,c,d,e,f,g){return this._drawShape(a,[[b,c],[b,c+e],[b+d,c+e],[b+d,c],[b,c]],f,g)},reset:function(){this.group.innerHTML=""},appendShape:function(a){var b=this["_draw"+a.type].apply(this,a.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",b):this.prerender+=b,this.lastShapeId=a.id,a.id},replaceWithShape:function(a,b){var c=d("#jqsshape"+a),e=this["_draw"+b.type].apply(this,b.args);c[0].outerHTML=e},replaceWithShapes:function(a,b){var c=d("#jqsshape"+a[0]),e="",f=b.length,g;for(g=0;g<f;g++)e+=this["_draw"+b[g].type].apply(this,b[g].args);c[0].outerHTML=e;for(g=1;g<a.length;g++)d("#jqsshape"+a[g]).remove()},insertAfterShape:function(a,b){var c=d("#jqsshape"+a),e=this["_draw"+b.type].apply(this,b.args);c[0].insertAdjacentHTML("afterEnd",e)},removeShapeId:function(a){var b=d("#jqsshape"+a);this.group.removeChild(b[0])},getShapeAt:function(a,b,c){var d=a.id.substr(8);return d},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})})(document,Math);;
/*
     _ _      _       _
 ___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
                   |__/

 Version: 1.6.0
  Author: Ken Wheeler
 Website: http://kenwheeler.github.io
    Docs: http://kenwheeler.github.io/slick
    Repo: http://github.com/kenwheeler/slick
  Issues: http://github.com/kenwheeler/slick/issues

 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):"undefined"!=typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";var b=window.Slick||{};b=function(){function c(c,d){var f,e=this;e.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:a(c),appendDots:a(c),arrows:!0,asNavFor:null,prevArrow:'<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>',nextArrow:'<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(b,c){return a('<button type="button" data-role="none" role="button" tabindex="0" />').text(c+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},e.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},a.extend(e,e.initials),e.activeBreakpoint=null,e.animType=null,e.animProp=null,e.breakpoints=[],e.breakpointSettings=[],e.cssTransitions=!1,e.focussed=!1,e.interrupted=!1,e.hidden="hidden",e.paused=!0,e.positionProp=null,e.respondTo=null,e.rowCount=1,e.shouldClick=!0,e.$slider=a(c),e.$slidesCache=null,e.transformType=null,e.transitionType=null,e.visibilityChange="visibilitychange",e.windowWidth=0,e.windowTimer=null,f=a(c).data("slick")||{},e.options=a.extend({},e.defaults,d,f),e.currentSlide=e.options.initialSlide,e.originalSettings=e.options,"undefined"!=typeof document.mozHidden?(e.hidden="mozHidden",e.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(e.hidden="webkitHidden",e.visibilityChange="webkitvisibilitychange"),e.autoPlay=a.proxy(e.autoPlay,e),e.autoPlayClear=a.proxy(e.autoPlayClear,e),e.autoPlayIterator=a.proxy(e.autoPlayIterator,e),e.changeSlide=a.proxy(e.changeSlide,e),e.clickHandler=a.proxy(e.clickHandler,e),e.selectHandler=a.proxy(e.selectHandler,e),e.setPosition=a.proxy(e.setPosition,e),e.swipeHandler=a.proxy(e.swipeHandler,e),e.dragHandler=a.proxy(e.dragHandler,e),e.keyHandler=a.proxy(e.keyHandler,e),e.instanceUid=b++,e.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,e.registerBreakpoints(),e.init(!0)}var b=0;return c}(),b.prototype.activateADA=function(){var a=this;a.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},b.prototype.addSlide=b.prototype.slickAdd=function(b,c,d){var e=this;if("boolean"==typeof c)d=c,c=null;else if(0>c||c>=e.slideCount)return!1;e.unload(),"number"==typeof c?0===c&&0===e.$slides.length?a(b).appendTo(e.$slideTrack):d?a(b).insertBefore(e.$slides.eq(c)):a(b).insertAfter(e.$slides.eq(c)):d===!0?a(b).prependTo(e.$slideTrack):a(b).appendTo(e.$slideTrack),e.$slides=e.$slideTrack.children(this.options.slide),e.$slideTrack.children(this.options.slide).detach(),e.$slideTrack.append(e.$slides),e.$slides.each(function(b,c){a(c).attr("data-slick-index",b)}),e.$slidesCache=e.$slides,e.reinit()},b.prototype.animateHeight=function(){var a=this;if(1===a.options.slidesToShow&&a.options.adaptiveHeight===!0&&a.options.vertical===!1){var b=a.$slides.eq(a.currentSlide).outerHeight(!0);a.$list.animate({height:b},a.options.speed)}},b.prototype.animateSlide=function(b,c){var d={},e=this;e.animateHeight(),e.options.rtl===!0&&e.options.vertical===!1&&(b=-b),e.transformsEnabled===!1?e.options.vertical===!1?e.$slideTrack.animate({left:b},e.options.speed,e.options.easing,c):e.$slideTrack.animate({top:b},e.options.speed,e.options.easing,c):e.cssTransitions===!1?(e.options.rtl===!0&&(e.currentLeft=-e.currentLeft),a({animStart:e.currentLeft}).animate({animStart:b},{duration:e.options.speed,easing:e.options.easing,step:function(a){a=Math.ceil(a),e.options.vertical===!1?(d[e.animType]="translate("+a+"px, 0px)",e.$slideTrack.css(d)):(d[e.animType]="translate(0px,"+a+"px)",e.$slideTrack.css(d))},complete:function(){c&&c.call()}})):(e.applyTransition(),b=Math.ceil(b),e.options.vertical===!1?d[e.animType]="translate3d("+b+"px, 0px, 0px)":d[e.animType]="translate3d(0px,"+b+"px, 0px)",e.$slideTrack.css(d),c&&setTimeout(function(){e.disableTransition(),c.call()},e.options.speed))},b.prototype.getNavTarget=function(){var b=this,c=b.options.asNavFor;return c&&null!==c&&(c=a(c).not(b.$slider)),c},b.prototype.asNavFor=function(b){var c=this,d=c.getNavTarget();null!==d&&"object"==typeof d&&d.each(function(){var c=a(this).slick("getSlick");c.unslicked||c.slideHandler(b,!0)})},b.prototype.applyTransition=function(a){var b=this,c={};b.options.fade===!1?c[b.transitionType]=b.transformType+" "+b.options.speed+"ms "+b.options.cssEase:c[b.transitionType]="opacity "+b.options.speed+"ms "+b.options.cssEase,b.options.fade===!1?b.$slideTrack.css(c):b.$slides.eq(a).css(c)},b.prototype.autoPlay=function(){var a=this;a.autoPlayClear(),a.slideCount>a.options.slidesToShow&&(a.autoPlayTimer=setInterval(a.autoPlayIterator,a.options.autoplaySpeed))},b.prototype.autoPlayClear=function(){var a=this;a.autoPlayTimer&&clearInterval(a.autoPlayTimer)},b.prototype.autoPlayIterator=function(){var a=this,b=a.currentSlide+a.options.slidesToScroll;a.paused||a.interrupted||a.focussed||(a.options.infinite===!1&&(1===a.direction&&a.currentSlide+1===a.slideCount-1?a.direction=0:0===a.direction&&(b=a.currentSlide-a.options.slidesToScroll,a.currentSlide-1===0&&(a.direction=1))),a.slideHandler(b))},b.prototype.buildArrows=function(){var b=this;b.options.arrows===!0&&(b.$prevArrow=a(b.options.prevArrow).addClass("slick-arrow"),b.$nextArrow=a(b.options.nextArrow).addClass("slick-arrow"),b.slideCount>b.options.slidesToShow?(b.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),b.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),b.htmlExpr.test(b.options.prevArrow)&&b.$prevArrow.prependTo(b.options.appendArrows),b.htmlExpr.test(b.options.nextArrow)&&b.$nextArrow.appendTo(b.options.appendArrows),b.options.infinite!==!0&&b.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):b.$prevArrow.add(b.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},b.prototype.buildDots=function(){var c,d,b=this;if(b.options.dots===!0&&b.slideCount>b.options.slidesToShow){for(b.$slider.addClass("slick-dotted"),d=a("<ul />").addClass(b.options.dotsClass),c=0;c<=b.getDotCount();c+=1)d.append(a("<li />").append(b.options.customPaging.call(this,b,c)));b.$dots=d.appendTo(b.options.appendDots),b.$dots.find("li").first().addClass("slick-active").attr("aria-hidden","false")}},b.prototype.buildOut=function(){var b=this;b.$slides=b.$slider.children(b.options.slide+":not(.slick-cloned)").addClass("slick-slide"),b.slideCount=b.$slides.length,b.$slides.each(function(b,c){a(c).attr("data-slick-index",b).data("originalStyling",a(c).attr("style")||"")}),b.$slider.addClass("slick-slider"),b.$slideTrack=0===b.slideCount?a('<div class="slick-track"/>').appendTo(b.$slider):b.$slides.wrapAll('<div class="slick-track"/>').parent(),b.$list=b.$slideTrack.wrap('<div aria-live="polite" class="slick-list"/>').parent(),b.$slideTrack.css("opacity",0),(b.options.centerMode===!0||b.options.swipeToSlide===!0)&&(b.options.slidesToScroll=1),a("img[data-lazy]",b.$slider).not("[src]").addClass("slick-loading"),b.setupInfinite(),b.buildArrows(),b.buildDots(),b.updateDots(),b.setSlideClasses("number"==typeof b.currentSlide?b.currentSlide:0),b.options.draggable===!0&&b.$list.addClass("draggable")},b.prototype.buildRows=function(){var b,c,d,e,f,g,h,a=this;if(e=document.createDocumentFragment(),g=a.$slider.children(),a.options.rows>1){for(h=a.options.slidesPerRow*a.options.rows,f=Math.ceil(g.length/h),b=0;f>b;b++){var i=document.createElement("div");for(c=0;c<a.options.rows;c++){var j=document.createElement("div");for(d=0;d<a.options.slidesPerRow;d++){var k=b*h+(c*a.options.slidesPerRow+d);g.get(k)&&j.appendChild(g.get(k))}i.appendChild(j)}e.appendChild(i)}a.$slider.empty().append(e),a.$slider.children().children().children().css({width:100/a.options.slidesPerRow+"%",display:"inline-block"})}},b.prototype.checkResponsive=function(b,c){var e,f,g,d=this,h=!1,i=d.$slider.width(),j=window.innerWidth||a(window).width();if("window"===d.respondTo?g=j:"slider"===d.respondTo?g=i:"min"===d.respondTo&&(g=Math.min(j,i)),d.options.responsive&&d.options.responsive.length&&null!==d.options.responsive){f=null;for(e in d.breakpoints)d.breakpoints.hasOwnProperty(e)&&(d.originalSettings.mobileFirst===!1?g<d.breakpoints[e]&&(f=d.breakpoints[e]):g>d.breakpoints[e]&&(f=d.breakpoints[e]));null!==f?null!==d.activeBreakpoint?(f!==d.activeBreakpoint||c)&&(d.activeBreakpoint=f,"unslick"===d.breakpointSettings[f]?d.unslick(f):(d.options=a.extend({},d.originalSettings,d.breakpointSettings[f]),b===!0&&(d.currentSlide=d.options.initialSlide),d.refresh(b)),h=f):(d.activeBreakpoint=f,"unslick"===d.breakpointSettings[f]?d.unslick(f):(d.options=a.extend({},d.originalSettings,d.breakpointSettings[f]),b===!0&&(d.currentSlide=d.options.initialSlide),d.refresh(b)),h=f):null!==d.activeBreakpoint&&(d.activeBreakpoint=null,d.options=d.originalSettings,b===!0&&(d.currentSlide=d.options.initialSlide),d.refresh(b),h=f),b||h===!1||d.$slider.trigger("breakpoint",[d,h])}},b.prototype.changeSlide=function(b,c){var f,g,h,d=this,e=a(b.currentTarget);switch(e.is("a")&&b.preventDefault(),e.is("li")||(e=e.closest("li")),h=d.slideCount%d.options.slidesToScroll!==0,f=h?0:(d.slideCount-d.currentSlide)%d.options.slidesToScroll,b.data.message){case"previous":g=0===f?d.options.slidesToScroll:d.options.slidesToShow-f,d.slideCount>d.options.slidesToShow&&d.slideHandler(d.currentSlide-g,!1,c);break;case"next":g=0===f?d.options.slidesToScroll:f,d.slideCount>d.options.slidesToShow&&d.slideHandler(d.currentSlide+g,!1,c);break;case"index":var i=0===b.data.index?0:b.data.index||e.index()*d.options.slidesToScroll;d.slideHandler(d.checkNavigable(i),!1,c),e.children().trigger("focus");break;default:return}},b.prototype.checkNavigable=function(a){var c,d,b=this;if(c=b.getNavigableIndexes(),d=0,a>c[c.length-1])a=c[c.length-1];else for(var e in c){if(a<c[e]){a=d;break}d=c[e]}return a},b.prototype.cleanUpEvents=function(){var b=this;b.options.dots&&null!==b.$dots&&a("li",b.$dots).off("click.slick",b.changeSlide).off("mouseenter.slick",a.proxy(b.interrupt,b,!0)).off("mouseleave.slick",a.proxy(b.interrupt,b,!1)),b.$slider.off("focus.slick blur.slick"),b.options.arrows===!0&&b.slideCount>b.options.slidesToShow&&(b.$prevArrow&&b.$prevArrow.off("click.slick",b.changeSlide),b.$nextArrow&&b.$nextArrow.off("click.slick",b.changeSlide)),b.$list.off("touchstart.slick mousedown.slick",b.swipeHandler),b.$list.off("touchmove.slick mousemove.slick",b.swipeHandler),b.$list.off("touchend.slick mouseup.slick",b.swipeHandler),b.$list.off("touchcancel.slick mouseleave.slick",b.swipeHandler),b.$list.off("click.slick",b.clickHandler),a(document).off(b.visibilityChange,b.visibility),b.cleanUpSlideEvents(),b.options.accessibility===!0&&b.$list.off("keydown.slick",b.keyHandler),b.options.focusOnSelect===!0&&a(b.$slideTrack).children().off("click.slick",b.selectHandler),a(window).off("orientationchange.slick.slick-"+b.instanceUid,b.orientationChange),a(window).off("resize.slick.slick-"+b.instanceUid,b.resize),a("[draggable!=true]",b.$slideTrack).off("dragstart",b.preventDefault),a(window).off("load.slick.slick-"+b.instanceUid,b.setPosition),a(document).off("ready.slick.slick-"+b.instanceUid,b.setPosition)},b.prototype.cleanUpSlideEvents=function(){var b=this;b.$list.off("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$list.off("mouseleave.slick",a.proxy(b.interrupt,b,!1))},b.prototype.cleanUpRows=function(){var b,a=this;a.options.rows>1&&(b=a.$slides.children().children(),b.removeAttr("style"),a.$slider.empty().append(b))},b.prototype.clickHandler=function(a){var b=this;b.shouldClick===!1&&(a.stopImmediatePropagation(),a.stopPropagation(),a.preventDefault())},b.prototype.destroy=function(b){var c=this;c.autoPlayClear(),c.touchObject={},c.cleanUpEvents(),a(".slick-cloned",c.$slider).detach(),c.$dots&&c.$dots.remove(),c.$prevArrow&&c.$prevArrow.length&&(c.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),c.htmlExpr.test(c.options.prevArrow)&&c.$prevArrow.remove()),c.$nextArrow&&c.$nextArrow.length&&(c.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),c.htmlExpr.test(c.options.nextArrow)&&c.$nextArrow.remove()),c.$slides&&(c.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){a(this).attr("style",a(this).data("originalStyling"))}),c.$slideTrack.children(this.options.slide).detach(),c.$slideTrack.detach(),c.$list.detach(),c.$slider.append(c.$slides)),c.cleanUpRows(),c.$slider.removeClass("slick-slider"),c.$slider.removeClass("slick-initialized"),c.$slider.removeClass("slick-dotted"),c.unslicked=!0,b||c.$slider.trigger("destroy",[c])},b.prototype.disableTransition=function(a){var b=this,c={};c[b.transitionType]="",b.options.fade===!1?b.$slideTrack.css(c):b.$slides.eq(a).css(c)},b.prototype.fadeSlide=function(a,b){var c=this;c.cssTransitions===!1?(c.$slides.eq(a).css({zIndex:c.options.zIndex}),c.$slides.eq(a).animate({opacity:1},c.options.speed,c.options.easing,b)):(c.applyTransition(a),c.$slides.eq(a).css({opacity:1,zIndex:c.options.zIndex}),b&&setTimeout(function(){c.disableTransition(a),b.call()},c.options.speed))},b.prototype.fadeSlideOut=function(a){var b=this;b.cssTransitions===!1?b.$slides.eq(a).animate({opacity:0,zIndex:b.options.zIndex-2},b.options.speed,b.options.easing):(b.applyTransition(a),b.$slides.eq(a).css({opacity:0,zIndex:b.options.zIndex-2}))},b.prototype.filterSlides=b.prototype.slickFilter=function(a){var b=this;null!==a&&(b.$slidesCache=b.$slides,b.unload(),b.$slideTrack.children(this.options.slide).detach(),b.$slidesCache.filter(a).appendTo(b.$slideTrack),b.reinit())},b.prototype.focusHandler=function(){var b=this;b.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*:not(.slick-arrow)",function(c){c.stopImmediatePropagation();var d=a(this);setTimeout(function(){b.options.pauseOnFocus&&(b.focussed=d.is(":focus"),b.autoPlay())},0)})},b.prototype.getCurrent=b.prototype.slickCurrentSlide=function(){var a=this;return a.currentSlide},b.prototype.getDotCount=function(){var a=this,b=0,c=0,d=0;if(a.options.infinite===!0)for(;b<a.slideCount;)++d,b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;else if(a.options.centerMode===!0)d=a.slideCount;else if(a.options.asNavFor)for(;b<a.slideCount;)++d,b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;else d=1+Math.ceil((a.slideCount-a.options.slidesToShow)/a.options.slidesToScroll);return d-1},b.prototype.getLeft=function(a){var c,d,f,b=this,e=0;return b.slideOffset=0,d=b.$slides.first().outerHeight(!0),b.options.infinite===!0?(b.slideCount>b.options.slidesToShow&&(b.slideOffset=b.slideWidth*b.options.slidesToShow*-1,e=d*b.options.slidesToShow*-1),b.slideCount%b.options.slidesToScroll!==0&&a+b.options.slidesToScroll>b.slideCount&&b.slideCount>b.options.slidesToShow&&(a>b.slideCount?(b.slideOffset=(b.options.slidesToShow-(a-b.slideCount))*b.slideWidth*-1,e=(b.options.slidesToShow-(a-b.slideCount))*d*-1):(b.slideOffset=b.slideCount%b.options.slidesToScroll*b.slideWidth*-1,e=b.slideCount%b.options.slidesToScroll*d*-1))):a+b.options.slidesToShow>b.slideCount&&(b.slideOffset=(a+b.options.slidesToShow-b.slideCount)*b.slideWidth,e=(a+b.options.slidesToShow-b.slideCount)*d),b.slideCount<=b.options.slidesToShow&&(b.slideOffset=0,e=0),b.options.centerMode===!0&&b.options.infinite===!0?b.slideOffset+=b.slideWidth*Math.floor(b.options.slidesToShow/2)-b.slideWidth:b.options.centerMode===!0&&(b.slideOffset=0,b.slideOffset+=b.slideWidth*Math.floor(b.options.slidesToShow/2)),c=b.options.vertical===!1?a*b.slideWidth*-1+b.slideOffset:a*d*-1+e,b.options.variableWidth===!0&&(f=b.slideCount<=b.options.slidesToShow||b.options.infinite===!1?b.$slideTrack.children(".slick-slide").eq(a):b.$slideTrack.children(".slick-slide").eq(a+b.options.slidesToShow),c=b.options.rtl===!0?f[0]?-1*(b.$slideTrack.width()-f[0].offsetLeft-f.width()):0:f[0]?-1*f[0].offsetLeft:0,b.options.centerMode===!0&&(f=b.slideCount<=b.options.slidesToShow||b.options.infinite===!1?b.$slideTrack.children(".slick-slide").eq(a):b.$slideTrack.children(".slick-slide").eq(a+b.options.slidesToShow+1),c=b.options.rtl===!0?f[0]?-1*(b.$slideTrack.width()-f[0].offsetLeft-f.width()):0:f[0]?-1*f[0].offsetLeft:0,c+=(b.$list.width()-f.outerWidth())/2)),c},b.prototype.getOption=b.prototype.slickGetOption=function(a){var b=this;return b.options[a]},b.prototype.getNavigableIndexes=function(){var e,a=this,b=0,c=0,d=[];for(a.options.infinite===!1?e=a.slideCount:(b=-1*a.options.slidesToScroll,c=-1*a.options.slidesToScroll,e=2*a.slideCount);e>b;)d.push(b),b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;return d},b.prototype.getSlick=function(){return this},b.prototype.getSlideCount=function(){var c,d,e,b=this;return e=b.options.centerMode===!0?b.slideWidth*Math.floor(b.options.slidesToShow/2):0,b.options.swipeToSlide===!0?(b.$slideTrack.find(".slick-slide").each(function(c,f){return f.offsetLeft-e+a(f).outerWidth()/2>-1*b.swipeLeft?(d=f,!1):void 0}),c=Math.abs(a(d).attr("data-slick-index")-b.currentSlide)||1):b.options.slidesToScroll},b.prototype.goTo=b.prototype.slickGoTo=function(a,b){var c=this;c.changeSlide({data:{message:"index",index:parseInt(a)}},b)},b.prototype.init=function(b){var c=this;a(c.$slider).hasClass("slick-initialized")||(a(c.$slider).addClass("slick-initialized"),c.buildRows(),c.buildOut(),c.setProps(),c.startLoad(),c.loadSlider(),c.initializeEvents(),c.updateArrows(),c.updateDots(),c.checkResponsive(!0),c.focusHandler()),b&&c.$slider.trigger("init",[c]),c.options.accessibility===!0&&c.initADA(),c.options.autoplay&&(c.paused=!1,c.autoPlay())},b.prototype.initADA=function(){var b=this;b.$slides.add(b.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),b.$slideTrack.attr("role","listbox"),b.$slides.not(b.$slideTrack.find(".slick-cloned")).each(function(c){a(this).attr({role:"option","aria-describedby":"slick-slide"+b.instanceUid+c})}),null!==b.$dots&&b.$dots.attr("role","tablist").find("li").each(function(c){a(this).attr({role:"presentation","aria-selected":"false","aria-controls":"navigation"+b.instanceUid+c,id:"slick-slide"+b.instanceUid+c})}).first().attr("aria-selected","true").end().find("button").attr("role","button").end().closest("div").attr("role","toolbar"),b.activateADA()},b.prototype.initArrowEvents=function(){var a=this;a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},a.changeSlide),a.$nextArrow.off("click.slick").on("click.slick",{message:"next"},a.changeSlide))},b.prototype.initDotEvents=function(){var b=this;b.options.dots===!0&&b.slideCount>b.options.slidesToShow&&a("li",b.$dots).on("click.slick",{message:"index"},b.changeSlide),b.options.dots===!0&&b.options.pauseOnDotsHover===!0&&a("li",b.$dots).on("mouseenter.slick",a.proxy(b.interrupt,b,!0)).on("mouseleave.slick",a.proxy(b.interrupt,b,!1))},b.prototype.initSlideEvents=function(){var b=this;b.options.pauseOnHover&&(b.$list.on("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$list.on("mouseleave.slick",a.proxy(b.interrupt,b,!1)))},b.prototype.initializeEvents=function(){var b=this;b.initArrowEvents(),b.initDotEvents(),b.initSlideEvents(),b.$list.on("touchstart.slick mousedown.slick",{action:"start"},b.swipeHandler),b.$list.on("touchmove.slick mousemove.slick",{action:"move"},b.swipeHandler),b.$list.on("touchend.slick mouseup.slick",{action:"end"},b.swipeHandler),b.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},b.swipeHandler),b.$list.on("click.slick",b.clickHandler),a(document).on(b.visibilityChange,a.proxy(b.visibility,b)),b.options.accessibility===!0&&b.$list.on("keydown.slick",b.keyHandler),b.options.focusOnSelect===!0&&a(b.$slideTrack).children().on("click.slick",b.selectHandler),a(window).on("orientationchange.slick.slick-"+b.instanceUid,a.proxy(b.orientationChange,b)),a(window).on("resize.slick.slick-"+b.instanceUid,a.proxy(b.resize,b)),a("[draggable!=true]",b.$slideTrack).on("dragstart",b.preventDefault),a(window).on("load.slick.slick-"+b.instanceUid,b.setPosition),a(document).on("ready.slick.slick-"+b.instanceUid,b.setPosition)},b.prototype.initUI=function(){var a=this;a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.show(),a.$nextArrow.show()),a.options.dots===!0&&a.slideCount>a.options.slidesToShow&&a.$dots.show()},b.prototype.keyHandler=function(a){var b=this;a.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===a.keyCode&&b.options.accessibility===!0?b.changeSlide({data:{message:b.options.rtl===!0?"next":"previous"}}):39===a.keyCode&&b.options.accessibility===!0&&b.changeSlide({data:{message:b.options.rtl===!0?"previous":"next"}}))},b.prototype.lazyLoad=function(){function g(c){a("img[data-lazy]",c).each(function(){var c=a(this),d=a(this).attr("data-lazy"),e=document.createElement("img");e.onload=function(){c.animate({opacity:0},100,function(){c.attr("src",d).animate({opacity:1},200,function(){c.removeAttr("data-lazy").removeClass("slick-loading")}),b.$slider.trigger("lazyLoaded",[b,c,d])})},e.onerror=function(){c.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),b.$slider.trigger("lazyLoadError",[b,c,d])},e.src=d})}var c,d,e,f,b=this;b.options.centerMode===!0?b.options.infinite===!0?(e=b.currentSlide+(b.options.slidesToShow/2+1),f=e+b.options.slidesToShow+2):(e=Math.max(0,b.currentSlide-(b.options.slidesToShow/2+1)),f=2+(b.options.slidesToShow/2+1)+b.currentSlide):(e=b.options.infinite?b.options.slidesToShow+b.currentSlide:b.currentSlide,f=Math.ceil(e+b.options.slidesToShow),b.options.fade===!0&&(e>0&&e--,f<=b.slideCount&&f++)),c=b.$slider.find(".slick-slide").slice(e,f),g(c),b.slideCount<=b.options.slidesToShow?(d=b.$slider.find(".slick-slide"),g(d)):b.currentSlide>=b.slideCount-b.options.slidesToShow?(d=b.$slider.find(".slick-cloned").slice(0,b.options.slidesToShow),g(d)):0===b.currentSlide&&(d=b.$slider.find(".slick-cloned").slice(-1*b.options.slidesToShow),g(d))},b.prototype.loadSlider=function(){var a=this;a.setPosition(),a.$slideTrack.css({opacity:1}),a.$slider.removeClass("slick-loading"),a.initUI(),"progressive"===a.options.lazyLoad&&a.progressiveLazyLoad()},b.prototype.next=b.prototype.slickNext=function(){var a=this;a.changeSlide({data:{message:"next"}})},b.prototype.orientationChange=function(){var a=this;a.checkResponsive(),a.setPosition()},b.prototype.pause=b.prototype.slickPause=function(){var a=this;a.autoPlayClear(),a.paused=!0},b.prototype.play=b.prototype.slickPlay=function(){var a=this;a.autoPlay(),a.options.autoplay=!0,a.paused=!1,a.focussed=!1,a.interrupted=!1},b.prototype.postSlide=function(a){var b=this;b.unslicked||(b.$slider.trigger("afterChange",[b,a]),b.animating=!1,b.setPosition(),b.swipeLeft=null,b.options.autoplay&&b.autoPlay(),b.options.accessibility===!0&&b.initADA())},b.prototype.prev=b.prototype.slickPrev=function(){var a=this;a.changeSlide({data:{message:"previous"}})},b.prototype.preventDefault=function(a){a.preventDefault()},b.prototype.progressiveLazyLoad=function(b){b=b||1;var e,f,g,c=this,d=a("img[data-lazy]",c.$slider);d.length?(e=d.first(),f=e.attr("data-lazy"),g=document.createElement("img"),g.onload=function(){e.attr("src",f).removeAttr("data-lazy").removeClass("slick-loading"),c.options.adaptiveHeight===!0&&c.setPosition(),c.$slider.trigger("lazyLoaded",[c,e,f]),c.progressiveLazyLoad()},g.onerror=function(){3>b?setTimeout(function(){c.progressiveLazyLoad(b+1)},500):(e.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),c.$slider.trigger("lazyLoadError",[c,e,f]),c.progressiveLazyLoad())},g.src=f):c.$slider.trigger("allImagesLoaded",[c])},b.prototype.refresh=function(b){var d,e,c=this;e=c.slideCount-c.options.slidesToShow,!c.options.infinite&&c.currentSlide>e&&(c.currentSlide=e),c.slideCount<=c.options.slidesToShow&&(c.currentSlide=0),d=c.currentSlide,c.destroy(!0),a.extend(c,c.initials,{currentSlide:d}),c.init(),b||c.changeSlide({data:{message:"index",index:d}},!1)},b.prototype.registerBreakpoints=function(){var c,d,e,b=this,f=b.options.responsive||null;if("array"===a.type(f)&&f.length){b.respondTo=b.options.respondTo||"window";for(c in f)if(e=b.breakpoints.length-1,d=f[c].breakpoint,f.hasOwnProperty(c)){for(;e>=0;)b.breakpoints[e]&&b.breakpoints[e]===d&&b.breakpoints.splice(e,1),e--;b.breakpoints.push(d),b.breakpointSettings[d]=f[c].settings}b.breakpoints.sort(function(a,c){return b.options.mobileFirst?a-c:c-a})}},b.prototype.reinit=function(){var b=this;b.$slides=b.$slideTrack.children(b.options.slide).addClass("slick-slide"),b.slideCount=b.$slides.length,b.currentSlide>=b.slideCount&&0!==b.currentSlide&&(b.currentSlide=b.currentSlide-b.options.slidesToScroll),b.slideCount<=b.options.slidesToShow&&(b.currentSlide=0),b.registerBreakpoints(),b.setProps(),b.setupInfinite(),b.buildArrows(),b.updateArrows(),b.initArrowEvents(),b.buildDots(),b.updateDots(),b.initDotEvents(),b.cleanUpSlideEvents(),b.initSlideEvents(),b.checkResponsive(!1,!0),b.options.focusOnSelect===!0&&a(b.$slideTrack).children().on("click.slick",b.selectHandler),b.setSlideClasses("number"==typeof b.currentSlide?b.currentSlide:0),b.setPosition(),b.focusHandler(),b.paused=!b.options.autoplay,b.autoPlay(),b.$slider.trigger("reInit",[b])},b.prototype.resize=function(){var b=this;a(window).width()!==b.windowWidth&&(clearTimeout(b.windowDelay),b.windowDelay=window.setTimeout(function(){b.windowWidth=a(window).width(),b.checkResponsive(),b.unslicked||b.setPosition()},50))},b.prototype.removeSlide=b.prototype.slickRemove=function(a,b,c){var d=this;return"boolean"==typeof a?(b=a,a=b===!0?0:d.slideCount-1):a=b===!0?--a:a,d.slideCount<1||0>a||a>d.slideCount-1?!1:(d.unload(),c===!0?d.$slideTrack.children().remove():d.$slideTrack.children(this.options.slide).eq(a).remove(),d.$slides=d.$slideTrack.children(this.options.slide),d.$slideTrack.children(this.options.slide).detach(),d.$slideTrack.append(d.$slides),d.$slidesCache=d.$slides,void d.reinit())},b.prototype.setCSS=function(a){var d,e,b=this,c={};b.options.rtl===!0&&(a=-a),d="left"==b.positionProp?Math.ceil(a)+"px":"0px",e="top"==b.positionProp?Math.ceil(a)+"px":"0px",c[b.positionProp]=a,b.transformsEnabled===!1?b.$slideTrack.css(c):(c={},b.cssTransitions===!1?(c[b.animType]="translate("+d+", "+e+")",b.$slideTrack.css(c)):(c[b.animType]="translate3d("+d+", "+e+", 0px)",b.$slideTrack.css(c)))},b.prototype.setDimensions=function(){var a=this;a.options.vertical===!1?a.options.centerMode===!0&&a.$list.css({padding:"0px "+a.options.centerPadding}):(a.$list.height(a.$slides.first().outerHeight(!0)*a.options.slidesToShow),a.options.centerMode===!0&&a.$list.css({padding:a.options.centerPadding+" 0px"})),a.listWidth=a.$list.width(),a.listHeight=a.$list.height(),a.options.vertical===!1&&a.options.variableWidth===!1?(a.slideWidth=Math.ceil(a.listWidth/a.options.slidesToShow),a.$slideTrack.width(Math.ceil(a.slideWidth*a.$slideTrack.children(".slick-slide").length))):a.options.variableWidth===!0?a.$slideTrack.width(5e3*a.slideCount):(a.slideWidth=Math.ceil(a.listWidth),a.$slideTrack.height(Math.ceil(a.$slides.first().outerHeight(!0)*a.$slideTrack.children(".slick-slide").length)));var b=a.$slides.first().outerWidth(!0)-a.$slides.first().width();a.options.variableWidth===!1&&a.$slideTrack.children(".slick-slide").width(a.slideWidth-b)},b.prototype.setFade=function(){var c,b=this;b.$slides.each(function(d,e){c=b.slideWidth*d*-1,b.options.rtl===!0?a(e).css({position:"relative",right:c,top:0,zIndex:b.options.zIndex-2,opacity:0}):a(e).css({position:"relative",left:c,top:0,zIndex:b.options.zIndex-2,opacity:0})}),b.$slides.eq(b.currentSlide).css({zIndex:b.options.zIndex-1,opacity:1})},b.prototype.setHeight=function(){var a=this;if(1===a.options.slidesToShow&&a.options.adaptiveHeight===!0&&a.options.vertical===!1){var b=a.$slides.eq(a.currentSlide).outerHeight(!0);a.$list.css("height",b)}},b.prototype.setOption=b.prototype.slickSetOption=function(){var c,d,e,f,h,b=this,g=!1;if("object"===a.type(arguments[0])?(e=arguments[0],g=arguments[1],h="multiple"):"string"===a.type(arguments[0])&&(e=arguments[0],f=arguments[1],g=arguments[2],"responsive"===arguments[0]&&"array"===a.type(arguments[1])?h="responsive":"undefined"!=typeof arguments[1]&&(h="single")),"single"===h)b.options[e]=f;else if("multiple"===h)a.each(e,function(a,c){b.options[a]=c});else if("responsive"===h)for(d in f)if("array"!==a.type(b.options.responsive))b.options.responsive=[f[d]];else{for(c=b.options.responsive.length-1;c>=0;)b.options.responsive[c].breakpoint===f[d].breakpoint&&b.options.responsive.splice(c,1),c--;b.options.responsive.push(f[d])}g&&(b.unload(),b.reinit())},b.prototype.setPosition=function(){var a=this;a.setDimensions(),a.setHeight(),a.options.fade===!1?a.setCSS(a.getLeft(a.currentSlide)):a.setFade(),a.$slider.trigger("setPosition",[a])},b.prototype.setProps=function(){var a=this,b=document.body.style;a.positionProp=a.options.vertical===!0?"top":"left","top"===a.positionProp?a.$slider.addClass("slick-vertical"):a.$slider.removeClass("slick-vertical"),(void 0!==b.WebkitTransition||void 0!==b.MozTransition||void 0!==b.msTransition)&&a.options.useCSS===!0&&(a.cssTransitions=!0),a.options.fade&&("number"==typeof a.options.zIndex?a.options.zIndex<3&&(a.options.zIndex=3):a.options.zIndex=a.defaults.zIndex),void 0!==b.OTransform&&(a.animType="OTransform",a.transformType="-o-transform",a.transitionType="OTransition",void 0===b.perspectiveProperty&&void 0===b.webkitPerspective&&(a.animType=!1)),void 0!==b.MozTransform&&(a.animType="MozTransform",a.transformType="-moz-transform",a.transitionType="MozTransition",void 0===b.perspectiveProperty&&void 0===b.MozPerspective&&(a.animType=!1)),void 0!==b.webkitTransform&&(a.animType="webkitTransform",a.transformType="-webkit-transform",a.transitionType="webkitTransition",void 0===b.perspectiveProperty&&void 0===b.webkitPerspective&&(a.animType=!1)),void 0!==b.msTransform&&(a.animType="msTransform",a.transformType="-ms-transform",a.transitionType="msTransition",void 0===b.msTransform&&(a.animType=!1)),void 0!==b.transform&&a.animType!==!1&&(a.animType="transform",a.transformType="transform",a.transitionType="transition"),a.transformsEnabled=a.options.useTransform&&null!==a.animType&&a.animType!==!1},b.prototype.setSlideClasses=function(a){var c,d,e,f,b=this;d=b.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),b.$slides.eq(a).addClass("slick-current"),b.options.centerMode===!0?(c=Math.floor(b.options.slidesToShow/2),b.options.infinite===!0&&(a>=c&&a<=b.slideCount-1-c?b.$slides.slice(a-c,a+c+1).addClass("slick-active").attr("aria-hidden","false"):(e=b.options.slidesToShow+a,
d.slice(e-c+1,e+c+2).addClass("slick-active").attr("aria-hidden","false")),0===a?d.eq(d.length-1-b.options.slidesToShow).addClass("slick-center"):a===b.slideCount-1&&d.eq(b.options.slidesToShow).addClass("slick-center")),b.$slides.eq(a).addClass("slick-center")):a>=0&&a<=b.slideCount-b.options.slidesToShow?b.$slides.slice(a,a+b.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):d.length<=b.options.slidesToShow?d.addClass("slick-active").attr("aria-hidden","false"):(f=b.slideCount%b.options.slidesToShow,e=b.options.infinite===!0?b.options.slidesToShow+a:a,b.options.slidesToShow==b.options.slidesToScroll&&b.slideCount-a<b.options.slidesToShow?d.slice(e-(b.options.slidesToShow-f),e+f).addClass("slick-active").attr("aria-hidden","false"):d.slice(e,e+b.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false")),"ondemand"===b.options.lazyLoad&&b.lazyLoad()},b.prototype.setupInfinite=function(){var c,d,e,b=this;if(b.options.fade===!0&&(b.options.centerMode=!1),b.options.infinite===!0&&b.options.fade===!1&&(d=null,b.slideCount>b.options.slidesToShow)){for(e=b.options.centerMode===!0?b.options.slidesToShow+1:b.options.slidesToShow,c=b.slideCount;c>b.slideCount-e;c-=1)d=c-1,a(b.$slides[d]).clone(!0).attr("id","").attr("data-slick-index",d-b.slideCount).prependTo(b.$slideTrack).addClass("slick-cloned");for(c=0;e>c;c+=1)d=c,a(b.$slides[d]).clone(!0).attr("id","").attr("data-slick-index",d+b.slideCount).appendTo(b.$slideTrack).addClass("slick-cloned");b.$slideTrack.find(".slick-cloned").find("[id]").each(function(){a(this).attr("id","")})}},b.prototype.interrupt=function(a){var b=this;a||b.autoPlay(),b.interrupted=a},b.prototype.selectHandler=function(b){var c=this,d=a(b.target).is(".slick-slide")?a(b.target):a(b.target).parents(".slick-slide"),e=parseInt(d.attr("data-slick-index"));return e||(e=0),c.slideCount<=c.options.slidesToShow?(c.setSlideClasses(e),void c.asNavFor(e)):void c.slideHandler(e)},b.prototype.slideHandler=function(a,b,c){var d,e,f,g,j,h=null,i=this;return b=b||!1,i.animating===!0&&i.options.waitForAnimate===!0||i.options.fade===!0&&i.currentSlide===a||i.slideCount<=i.options.slidesToShow?void 0:(b===!1&&i.asNavFor(a),d=a,h=i.getLeft(d),g=i.getLeft(i.currentSlide),i.currentLeft=null===i.swipeLeft?g:i.swipeLeft,i.options.infinite===!1&&i.options.centerMode===!1&&(0>a||a>i.getDotCount()*i.options.slidesToScroll)?void(i.options.fade===!1&&(d=i.currentSlide,c!==!0?i.animateSlide(g,function(){i.postSlide(d)}):i.postSlide(d))):i.options.infinite===!1&&i.options.centerMode===!0&&(0>a||a>i.slideCount-i.options.slidesToScroll)?void(i.options.fade===!1&&(d=i.currentSlide,c!==!0?i.animateSlide(g,function(){i.postSlide(d)}):i.postSlide(d))):(i.options.autoplay&&clearInterval(i.autoPlayTimer),e=0>d?i.slideCount%i.options.slidesToScroll!==0?i.slideCount-i.slideCount%i.options.slidesToScroll:i.slideCount+d:d>=i.slideCount?i.slideCount%i.options.slidesToScroll!==0?0:d-i.slideCount:d,i.animating=!0,i.$slider.trigger("beforeChange",[i,i.currentSlide,e]),f=i.currentSlide,i.currentSlide=e,i.setSlideClasses(i.currentSlide),i.options.asNavFor&&(j=i.getNavTarget(),j=j.slick("getSlick"),j.slideCount<=j.options.slidesToShow&&j.setSlideClasses(i.currentSlide)),i.updateDots(),i.updateArrows(),i.options.fade===!0?(c!==!0?(i.fadeSlideOut(f),i.fadeSlide(e,function(){i.postSlide(e)})):i.postSlide(e),void i.animateHeight()):void(c!==!0?i.animateSlide(h,function(){i.postSlide(e)}):i.postSlide(e))))},b.prototype.startLoad=function(){var a=this;a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.hide(),a.$nextArrow.hide()),a.options.dots===!0&&a.slideCount>a.options.slidesToShow&&a.$dots.hide(),a.$slider.addClass("slick-loading")},b.prototype.swipeDirection=function(){var a,b,c,d,e=this;return a=e.touchObject.startX-e.touchObject.curX,b=e.touchObject.startY-e.touchObject.curY,c=Math.atan2(b,a),d=Math.round(180*c/Math.PI),0>d&&(d=360-Math.abs(d)),45>=d&&d>=0?e.options.rtl===!1?"left":"right":360>=d&&d>=315?e.options.rtl===!1?"left":"right":d>=135&&225>=d?e.options.rtl===!1?"right":"left":e.options.verticalSwiping===!0?d>=35&&135>=d?"down":"up":"vertical"},b.prototype.swipeEnd=function(a){var c,d,b=this;if(b.dragging=!1,b.interrupted=!1,b.shouldClick=b.touchObject.swipeLength>10?!1:!0,void 0===b.touchObject.curX)return!1;if(b.touchObject.edgeHit===!0&&b.$slider.trigger("edge",[b,b.swipeDirection()]),b.touchObject.swipeLength>=b.touchObject.minSwipe){switch(d=b.swipeDirection()){case"left":case"down":c=b.options.swipeToSlide?b.checkNavigable(b.currentSlide+b.getSlideCount()):b.currentSlide+b.getSlideCount(),b.currentDirection=0;break;case"right":case"up":c=b.options.swipeToSlide?b.checkNavigable(b.currentSlide-b.getSlideCount()):b.currentSlide-b.getSlideCount(),b.currentDirection=1}"vertical"!=d&&(b.slideHandler(c),b.touchObject={},b.$slider.trigger("swipe",[b,d]))}else b.touchObject.startX!==b.touchObject.curX&&(b.slideHandler(b.currentSlide),b.touchObject={})},b.prototype.swipeHandler=function(a){var b=this;if(!(b.options.swipe===!1||"ontouchend"in document&&b.options.swipe===!1||b.options.draggable===!1&&-1!==a.type.indexOf("mouse")))switch(b.touchObject.fingerCount=a.originalEvent&&void 0!==a.originalEvent.touches?a.originalEvent.touches.length:1,b.touchObject.minSwipe=b.listWidth/b.options.touchThreshold,b.options.verticalSwiping===!0&&(b.touchObject.minSwipe=b.listHeight/b.options.touchThreshold),a.data.action){case"start":b.swipeStart(a);break;case"move":b.swipeMove(a);break;case"end":b.swipeEnd(a)}},b.prototype.swipeMove=function(a){var d,e,f,g,h,b=this;return h=void 0!==a.originalEvent?a.originalEvent.touches:null,!b.dragging||h&&1!==h.length?!1:(d=b.getLeft(b.currentSlide),b.touchObject.curX=void 0!==h?h[0].pageX:a.clientX,b.touchObject.curY=void 0!==h?h[0].pageY:a.clientY,b.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(b.touchObject.curX-b.touchObject.startX,2))),b.options.verticalSwiping===!0&&(b.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(b.touchObject.curY-b.touchObject.startY,2)))),e=b.swipeDirection(),"vertical"!==e?(void 0!==a.originalEvent&&b.touchObject.swipeLength>4&&a.preventDefault(),g=(b.options.rtl===!1?1:-1)*(b.touchObject.curX>b.touchObject.startX?1:-1),b.options.verticalSwiping===!0&&(g=b.touchObject.curY>b.touchObject.startY?1:-1),f=b.touchObject.swipeLength,b.touchObject.edgeHit=!1,b.options.infinite===!1&&(0===b.currentSlide&&"right"===e||b.currentSlide>=b.getDotCount()&&"left"===e)&&(f=b.touchObject.swipeLength*b.options.edgeFriction,b.touchObject.edgeHit=!0),b.options.vertical===!1?b.swipeLeft=d+f*g:b.swipeLeft=d+f*(b.$list.height()/b.listWidth)*g,b.options.verticalSwiping===!0&&(b.swipeLeft=d+f*g),b.options.fade===!0||b.options.touchMove===!1?!1:b.animating===!0?(b.swipeLeft=null,!1):void b.setCSS(b.swipeLeft)):void 0)},b.prototype.swipeStart=function(a){var c,b=this;return b.interrupted=!0,1!==b.touchObject.fingerCount||b.slideCount<=b.options.slidesToShow?(b.touchObject={},!1):(void 0!==a.originalEvent&&void 0!==a.originalEvent.touches&&(c=a.originalEvent.touches[0]),b.touchObject.startX=b.touchObject.curX=void 0!==c?c.pageX:a.clientX,b.touchObject.startY=b.touchObject.curY=void 0!==c?c.pageY:a.clientY,void(b.dragging=!0))},b.prototype.unfilterSlides=b.prototype.slickUnfilter=function(){var a=this;null!==a.$slidesCache&&(a.unload(),a.$slideTrack.children(this.options.slide).detach(),a.$slidesCache.appendTo(a.$slideTrack),a.reinit())},b.prototype.unload=function(){var b=this;a(".slick-cloned",b.$slider).remove(),b.$dots&&b.$dots.remove(),b.$prevArrow&&b.htmlExpr.test(b.options.prevArrow)&&b.$prevArrow.remove(),b.$nextArrow&&b.htmlExpr.test(b.options.nextArrow)&&b.$nextArrow.remove(),b.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},b.prototype.unslick=function(a){var b=this;b.$slider.trigger("unslick",[b,a]),b.destroy()},b.prototype.updateArrows=function(){var b,a=this;b=Math.floor(a.options.slidesToShow/2),a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&!a.options.infinite&&(a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),a.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===a.currentSlide?(a.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):a.currentSlide>=a.slideCount-a.options.slidesToShow&&a.options.centerMode===!1?(a.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):a.currentSlide>=a.slideCount-1&&a.options.centerMode===!0&&(a.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},b.prototype.updateDots=function(){var a=this;null!==a.$dots&&(a.$dots.find("li").removeClass("slick-active").attr("aria-hidden","true"),a.$dots.find("li").eq(Math.floor(a.currentSlide/a.options.slidesToScroll)).addClass("slick-active").attr("aria-hidden","false"))},b.prototype.visibility=function(){var a=this;a.options.autoplay&&(document[a.hidden]?a.interrupted=!0:a.interrupted=!1)},a.fn.slick=function(){var f,g,a=this,c=arguments[0],d=Array.prototype.slice.call(arguments,1),e=a.length;for(f=0;e>f;f++)if("object"==typeof c||"undefined"==typeof c?a[f].slick=new b(a[f],c):g=a[f].slick[c].apply(a[f].slick,d),"undefined"!=typeof g)return g;return a}});;
/** @preserve jQuery.floatThead 2.0.3 - http://mkoryak.github.io/floatThead/ - Copyright (c) 2012 - 2017 Misha Koryak **/
!function(t){function e(t,e){if(8==f){var o=v.width(),n=s.debounce(function(){var t=v.width();o!=t&&(o=t,e())},1);v.on(t,n)}else v.on(t,s.debounce(e,1))}function o(e){var o=e[0],n=o.parentElement;do{var r=window.getComputedStyle(n).getPropertyValue("overflow");if("visible"!=r)break}while(n=n.parentElement);return t(n==document.body?[]:n)}function n(t){window&&window.console&&window.console.error&&window.console.error("jQuery.floatThead: "+t)}function r(t){var e=t.getBoundingClientRect();return e.width||e.right-e.left}function a(){var t=document.createElement("scrolltester");t.style.cssText="width:100px;height:100px;overflow:scroll!important;position:absolute;top:-9999px;display:block",document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e}function i(t){if(t.dataTableSettings)for(var e=0;e<t.dataTableSettings.length;e++){var o=t.dataTableSettings[e].nTable;if(t[0]==o)return!0}return!1}function l(t,e,o){var n=o?"outerWidth":"width";if(p&&t.css("max-width")){var r=0;o&&(r+=parseInt(t.css("borderLeft"),10),r+=parseInt(t.css("borderRight"),10));for(var a=0;a<e.length;a++)r+=e.get(a).offsetWidth;return r}return t[n]()}t.floatThead=t.floatThead||{},t.floatThead.defaults={headerCellSelector:"tr:visible:first>*:visible",zIndex:1001,position:"auto",top:0,bottom:0,scrollContainer:function(){return t([])},responsiveContainer:function(){return t([])},getSizingRow:function(t){return t.find("tbody tr:visible:first>*:visible")},floatTableClass:"floatThead-table",floatWrapperClass:"floatThead-wrapper",floatContainerClass:"floatThead-container",copyTableClass:!0,autoReflow:!1,debug:!1,support:{bootstrap:!0,datatables:!0,jqueryUI:!0,perfectScrollbar:!0}};var s=window._||function(){var e={},o=Object.prototype.hasOwnProperty,n=["Arguments","Function","String","Number","Date","RegExp"];e.has=function(t,e){return o.call(t,e)},e.keys=Object.keys||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var o=[];for(var n in t)e.has(t,n)&&o.push(n);return o};var r=0;return e.uniqueId=function(t){var e=++r+"";return t?t+e:e},t.each(n,function(){var t=this;e["is"+t]=function(e){return Object.prototype.toString.call(e)=="[object "+t+"]"}}),e.debounce=function(t,e,o){var n,r,a,i,l;return function(){a=this,r=arguments,i=new Date;var s=function(){var d=new Date-i;e>d?n=setTimeout(s,e-d):(n=null,o||(l=t.apply(a,r)))},d=o&&!n;return n||(n=setTimeout(s,e)),d&&(l=t.apply(a,r)),l}},e}(),d="undefined"!=typeof MutationObserver,f=function(){for(var t=3,e=document.createElement("b"),o=e.all||[];t=1+t,e.innerHTML="<!--[if gt IE "+t+"]><i><![endif]-->",o[0];);return t>4?t:document.documentMode}(),c=/Gecko\//.test(navigator.userAgent),u=/WebKit\//.test(navigator.userAgent);f||c||u||(f=11);var p=function(){if(u){var e=t("<div>").css("width",0).append(t("<table>").css("max-width","100%").append(t("<tr>").append(t("<th>").append(t("<div>").css("min-width",100).text("X")))));t("body").append(e);var o=0==e.find("table").width();return e.remove(),o}return!1},h=!c&&!f,v=t(window);if(!window.matchMedia){var b=window.onbeforeprint,w=window.onafterprint;window.onbeforeprint=function(){b&&b(),v.triggerHandler("beforeprint")},window.onafterprint=function(){w&&w(),v.triggerHandler("afterprint")}}t.fn.floatThead=function(c){if(c=c||{},8>f)return this;var b=null;if(s.isFunction(p)&&(p=p()),s.isString(c)){var w=c,g=Array.prototype.slice.call(arguments,1),m=this;return this.filter("table").each(function(){var e=t(this),o=e.data("floatThead-lazy");o&&e.floatThead(o);var n=e.data("floatThead-attached");if(n&&s.isFunction(n[w])){var r=n[w].apply(this,g);void 0!==r&&(m=r)}}),m}var y=t.extend({},t.floatThead.defaults||{},c);if(t.each(c,function(e){e in t.floatThead.defaults||!y.debug||n("Used ["+e+"] key to init plugin, but that param is not an option for the plugin. Valid options are: "+s.keys(t.floatThead.defaults).join(", "))}),y.debug){var T=t.fn.jquery.split(".");1==parseInt(T[0],10)&&parseInt(T[1],10)<=7&&n("jQuery version "+t.fn.jquery+" detected! This plugin supports 1.8 or better, or 1.7.x with jQuery UI 1.8.24 -> http://jqueryui.com/resources/download/jquery-ui-1.8.24.zip")}return this.filter(":not(."+y.floatTableClass+")").each(function(){function c(t){return t+".fth-"+R+".floatTHead"}function p(){var e=0;if(k.children("tr:visible").each(function(){e+=t(this).outerHeight(!0)}),"collapse"==M.css("border-collapse")){var o=parseInt(M.css("border-top-width"),10),n=parseInt(M.find("thead tr:first").find(">*:first").css("border-top-width"),10);o>n&&(e-=o/2)}st.outerHeight(e),dt.outerHeight(e)}function w(){var t=l(M,ut,!0),e=V?P:U,o=e.width()||t,n="hidden"!=e.css("overflow-y")?o-N.vertical:o;if(at.width(n),G){var r=100*t/n;tt.css("width",r+"%")}else tt.outerWidth(t)}function g(){D=(s.isFunction(y.top)?y.top(M):y.top)||0,O=(s.isFunction(y.bottom)?y.bottom(M):y.bottom)||0}function m(){var e,o=k.find(y.headerCellSelector);if(nt?e=ot.find("col").length:(e=0,o.each(function(){e+=parseInt(t(this).attr("colspan")||1,10)})),e!=Q){Q=e;for(var n,r=[],a=[],i=[],l=0;e>l;l++)n=o.eq(l).text(),r.push('<th class="floatThead-col" aria-label="'+n+'"/>'),a.push("<col/>"),i.push(t("<fthtd>").css({display:"table-cell",height:0,width:"auto"}));a=a.join(""),r=r.join(""),h&&(rt.empty(),rt.append(i),ut=rt.find("fthtd")),st.html(r),dt=st.find("th"),nt||ot.html(a),ft=ot.find("col"),et.html(a),ct=et.find("col")}return e}function T(){if(!F){if(F=!0,X){var t=l(M,ut,!0),e=J.width();t>e&&M.css("minWidth",t)}M.css(vt),tt.css(vt),tt.append(k),E.before(lt),p()}}function C(){F&&(F=!1,X&&M.width(wt),lt.detach(),M.prepend(k),M.css(bt),tt.css(bt),M.css("minWidth",gt),M.css("minWidth",l(M,ut)))}function x(t){mt!=t&&(mt=t,M.triggerHandler("floatThead",[t,at]))}function j(t){X!=t&&(X=t,at.css({position:X?"absolute":"fixed"}))}function S(t,e,o,n){return h?o:n?y.getSizingRow(t,e,o):e}function z(){var t,e=m();return function(){var o=at.scrollLeft();ft=ot.find("col");var n=S(M,ft,ut,f);if(n.length==e&&e>0){if(!nt)for(t=0;e>t;t++)ft.eq(t).css("width","");C();var a=[];for(t=0;e>t;t++)a[t]=r(n.get(t));for(t=0;e>t;t++)ct.eq(t).width(a[t]),ft.eq(t).width(a[t]);T()}else tt.append(k),M.css(bt),tt.css(bt),p();at.scrollLeft(o),M.triggerHandler("reflowed",[at])}}function I(t){var e=U.css("border-"+t+"-width"),o=0;return e&&~e.indexOf("px")&&(o=parseInt(e,10)),o}function L(){return"auto"==P.css("overflow-x")}function W(){var t,e=U.scrollTop(),o=0,n=B?Y.outerHeight(!0):0,r=K?n:-n,a=at.height(),i=M.offset(),l=0,s=0;if(G){var d=U.offset();o=i.top-d.top+e,B&&K&&(o+=n),l=I("left"),s=I("top"),o-=s}else t=i.top-D-a+O+N.horizontal;var f=v.scrollTop(),c=v.scrollLeft(),p=function(){return(L()?P:U).scrollLeft()||0},h=p();return function(d){V=L();var b=M[0].offsetWidth<=0&&M[0].offsetHeight<=0;if(!b&&it)return it=!1,setTimeout(function(){M.triggerHandler("reflow")},1),null;if(b&&(it=!0,!X))return null;if("windowScroll"==d)f=v.scrollTop(),c=v.scrollLeft();else if("containerScroll"==d)if(P.length){if(!V)return;h=P.scrollLeft()}else e=U.scrollTop(),h=U.scrollLeft();else"init"!=d&&(f=v.scrollTop(),c=v.scrollLeft(),e=U.scrollTop(),h=p());if(!u||!(0>f||0>c)){if(Z)j("windowScrollDone"==d?!0:!1);else if("windowScrollDone"==d)return null;i=M.offset(),B&&K&&(i.top+=n);var w,g,m=M.outerHeight();if(G&&X){if(o>=e){var y=o-e+s;w=y>0?y:0,x(!1)}else w=_?s:e,x(!0);g=l}else!G&&X?(f>t+m+r?w=m-a+r:i.top>=f+D?(w=0,C(),x(!1)):(w=D+f-i.top+o+(K?n:0),T(),x(!0)),g=h):G&&!X?(o>e||e-o>m?(w=i.top-f,C(),x(!1)):(w=i.top+e-f-o,T(),x(!0)),g=i.left+h-c):G||X||(f>t+m+r?w=m+D-f+t+r:i.top>f+D?(w=i.top-f,T(),x(!1)):(w=D,x(!0)),g=i.left+h-c);return{top:Math.round(w),left:Math.round(g)}}}}function H(){var t=null,e=null,o=null;return function(n,r,a){if(null!=n&&(t!=n.top||e!=n.left)){if(8===f)at.css({top:n.top,left:n.left});else{var i="translateX("+n.left+"px) translateY("+n.top+"px)";at.css({"-webkit-transform":i,"-moz-transform":i,"-ms-transform":i,"-o-transform":i,transform:i,top:0,left:0})}t=n.top,e=n.left}r&&w(),a&&p();var l=(V?P:U).scrollLeft();X&&o==l||(at.scrollLeft(l),o=l)}}function q(){if(U.length)if(y.support&&y.support.perfectScrollbar&&U.data().perfectScrollbar)N={horizontal:0,vertical:0};else{if("scroll"==U.css("overflow-x"))N.horizontal=A;else{var t=U.width(),e=l(M,ut),o=r>n?A:0;N.horizontal=e>t-o?A:0}if("scroll"==U.css("overflow-y"))N.vertical=A;else{var n=U.height(),r=M.height(),a=e>t?A:0;N.vertical=r>n-a?A:0}}}var R=s.uniqueId(),M=t(this);if(M.data("floatThead-attached"))return!0;if(!M.is("table"))throw new Error('jQuery.floatThead must be run on a table element. ex: $("table").floatThead();');d=y.autoReflow&&d;var k=M.children("thead:first"),E=M.children("tbody:first");if(0==k.length||0==E.length)return y.debug&&n(0==k.length?"The thead element is missing.":"The tbody element is missing."),M.data("floatThead-lazy",y),void M.unbind("reflow").one("reflow",function(){M.floatThead(y)});M.data("floatThead-lazy")&&M.unbind("reflow"),M.data("floatThead-lazy",!1);var D,O,F=!0,N={vertical:0,horizontal:0},A=a(),Q=0;y.scrollContainer===!0&&(y.scrollContainer=o);var U=y.scrollContainer(M)||t([]),G=U.length>0,P=G?t([]):y.responsiveContainer(M)||t([]),V=L(),X=null;"auto"==y.position?X=null:"fixed"==y.position?X=!1:"absolute"==y.position?X=!0:y.debug&&n('Invalid value given to "position" option, valid is "fixed", "absolute" and "auto". You passed: ',y.position),null==X&&(X=G);var Y=M.find("caption"),B=1==Y.length;if(B)var K="top"===(Y.css("caption-side")||Y.attr("align")||"top");var $=t("<fthfoot>").css({display:"table-footer-group","border-spacing":0,height:0,"border-collapse":"collapse",visibility:"hidden"}),_=!1,J=t([]),Z=9>=f&&!G&&X,tt=t("<table/>"),et=t("<colgroup/>"),ot=M.children("colgroup:first"),nt=!0;0==ot.length&&(ot=t("<colgroup/>"),nt=!1);var rt=t("<fthtr>").css({display:"table-row","border-spacing":0,height:0,"border-collapse":"collapse"}),at=t("<div>").css("overflow","hidden").attr("aria-hidden","true"),it=!1,lt=t("<thead/>"),st=t('<tr class="size-row" aria-hidden="true"/>'),dt=t([]),ft=t([]),ct=t([]),ut=t([]);lt.append(st),M.prepend(ot),h&&($.append(rt),M.append($)),tt.append(et),at.append(tt),y.copyTableClass&&tt.attr("class",M.attr("class")),tt.attr({cellpadding:M.attr("cellpadding"),cellspacing:M.attr("cellspacing"),border:M.attr("border")});var pt=M.css("display");if(tt.css({borderCollapse:M.css("borderCollapse"),border:M.css("border"),display:pt}),G||tt.css("width","auto"),"none"==pt&&(it=!0),tt.addClass(y.floatTableClass).css({margin:0,"border-bottom-width":0}),X){var ht=function(e,o){var n=e.css("position"),r="relative"==n||"absolute"==n,a=e;if(!r||o){var i={paddingLeft:e.css("paddingLeft"),paddingRight:e.css("paddingRight")};at.css(i),a=e.data("floatThead-containerWrap")||e.wrap(t("<div>").addClass(y.floatWrapperClass).css({position:"relative",clear:"both"})).parent(),e.data("floatThead-containerWrap",a),_=!0}return a};G?(J=ht(U,!0),J.prepend(at)):(J=ht(M),M.before(at))}else M.before(at);at.css({position:X?"absolute":"fixed",marginTop:0,top:X?0:"auto",zIndex:y.zIndex,willChange:"transform"}),at.addClass(y.floatContainerClass),g();var vt={"table-layout":"fixed"},bt={"table-layout":M.css("tableLayout")||"auto"},wt=M[0].style.width||"",gt=M.css("minWidth")||"",mt=!1;q();var yt,Tt=function(){(yt=z())()};Tt();var Ct=W(),xt=H();xt(Ct("init"),!0);var jt,St=s.debounce(function(){xt(Ct("windowScrollDone"),!1)},1),zt=function(){xt(Ct("windowScroll"),!1),Z&&St()},It=function(){xt(Ct("containerScroll"),!1)},Lt=function(){M.is(":hidden")||(g(),q(),Tt(),Ct=W(),(xt=H())(Ct("resize"),!0,!0))},Wt=s.debounce(function(){M.is(":hidden")||(q(),g(),Tt(),Ct=W(),xt(Ct("reflow"),!0))},1),Ht=function(){C()},qt=function(){T()},Rt=function(t){t.matches?Ht():qt()};if(window.matchMedia&&window.matchMedia("print").addListener?(jt=window.matchMedia("print"),jt.addListener(Rt)):(v.on("beforeprint",Ht),v.on("afterprint",qt)),G?X?U.on(c("scroll"),It):(U.on(c("scroll"),It),v.on(c("scroll"),zt)):(P.on(c("scroll"),It),v.on(c("scroll"),zt)),v.on(c("load"),Wt),e(c("resize"),Lt),M.on("reflow",Wt),y.support&&y.support.datatables&&i(M)&&M.on("filter",Wt).on("sort",Wt).on("page",Wt),y.support&&y.support.bootstrap&&v.on(c("shown.bs.tab"),Wt),y.support&&y.support.jqueryUI&&v.on(c("tabsactivate"),Wt),d){var Mt=null;s.isFunction(y.autoReflow)&&(Mt=y.autoReflow(M,U)),Mt||(Mt=U.length?U[0]:M[0]),b=new MutationObserver(function(t){for(var e=function(t){return t&&t[0]&&("THEAD"==t[0].nodeName||"TD"==t[0].nodeName||"TH"==t[0].nodeName)},o=0;o<t.length;o++)if(!e(t[o].addedNodes)&&!e(t[o].removedNodes)){Wt();break}}),b.observe(Mt,{childList:!0,subtree:!0})}M.data("floatThead-attached",{destroy:function(){var t=".fth-"+R;return C(),M.css(bt),ot.remove(),h&&$.remove(),lt.parent().length&&lt.replaceWith(k),x(!1),d&&(b.disconnect(),b=null),M.off("reflow reflowed"),U.off(t),P.off(t),_&&(U.length?U.unwrap():M.unwrap()),G?U.data("floatThead-containerWrap",!1):M.data("floatThead-containerWrap",!1),M.css("minWidth",gt),at.remove(),M.data("floatThead-attached",!1),v.off(t),jt&&jt.removeListener(Rt),Ht=qt=function(){},function(){return M.floatThead(y)}},reflow:function(){Wt()},setHeaderHeight:function(){p()},getFloatContainer:function(){return at},getRowGroups:function(){return F?at.find(">table>thead").add(M.children("tbody,tfoot")):M.children("thead,tbody,tfoot")}})}),this}}(function(){var t=window.jQuery;return"undefined"!=typeof module&&module.exports&&!t&&(t=require("jquery")),t}());;

/*! jQuery Validation Plugin - v1.17.0 - 7/29/2017
 * https://jqueryvalidation.org/
 * Copyright (c) 2017 Jörn Zaefferer; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){a.extend(a.fn,{validate:function(b){if(!this.length)return void(b&&b.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."));
var c=a.data(this[0],"validator");return c?c:(this.attr("novalidate","novalidate"),c=new a.validator(b,this[0]),a.data(this[0],"validator",c),c.settings.onsubmit&&(this.on("click.validate",":submit",function(b){c.submitButton=b.currentTarget,a(this).hasClass("cancel")&&(c.cancelSubmit=!0),void 0!==a(this).attr("formnovalidate")&&(c.cancelSubmit=!0)}),this.on("submit.validate",function(b){function d(){var d,e;return c.submitButton&&(c.settings.submitHandler||c.formSubmitted)&&(d=a("<input type='hidden'/>").attr("name",c.submitButton.name).val(a(c.submitButton).val()).appendTo(c.currentForm)),!c.settings.submitHandler||(e=c.settings.submitHandler.call(c,c.currentForm,b),d&&d.remove(),void 0!==e&&e)}return c.settings.debug&&b.preventDefault(),c.cancelSubmit?(c.cancelSubmit=!1,d()):c.form()?c.pendingRequest?(c.formSubmitted=!0,!1):d():(c.focusInvalid(),!1)})),c)},valid:function(){var b,c,d;
return a(this[0]).is("form")?b=this.validate().form():(d=[],b=!0,c=a(this[0].form).validate(),this.each(function(){b=c.element(this)&&b,b||(d=d.concat(c.errorList))}),c.errorList=d),b},rules:function(b,c){var d,e,f,g,h,i,j=this[0];if(null!=j&&(!j.form&&j.hasAttribute("contenteditable")&&(j.form=this.closest("form")[0],j.name=this.attr("name")),null!=j.form)){if(b)switch(d=a.data(j.form,"validator").settings,e=d.rules,f=a.validator.staticRules(j),b){case"add":a.extend(f,a.validator.normalizeRule(c)),delete f.messages,e[j.name]=f,c.messages&&(d.messages[j.name]=a.extend(d.messages[j.name],c.messages));
break;case"remove":return c?(i={},a.each(c.split(/\s/),function(a,b){i[b]=f[b],delete f[b]}),i):(delete e[j.name],f)}return g=a.validator.normalizeRules(a.extend({},a.validator.classRules(j),a.validator.attributeRules(j),a.validator.dataRules(j),a.validator.staticRules(j)),j),g.required&&(h=g.required,delete g.required,g=a.extend({required:h},g)),g.remote&&(h=g.remote,delete g.remote,g=a.extend(g,{remote:h})),g}}}),a.extend(a.expr.pseudos||a.expr[":"],{blank:function(b){return!a.trim(""+a(b).val())},filled:function(b){var c=a(b).val();return null!==c&&!!a.trim(""+c)},unchecked:function(b){return!a(b).prop("checked")}}),a.validator=function(b,c){this.settings=a.extend(!0,{},a.validator.defaults,b),this.currentForm=c,this.init()},a.validator.format=function(b,c){return 1===arguments.length?function(){var c=a.makeArray(arguments);return c.unshift(b),a.validator.format.apply(this,c)}:void 0===c?b:(arguments.length>2&&c.constructor!==Array&&(c=a.makeArray(arguments).slice(1)),c.constructor!==Array&&(c=[c]),a.each(c,function(a,c){b=b.replace(new RegExp("\\{"+a+"\\}","g"),function(){return c})}),b)},a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",pendingClass:"pending",validClass:"valid",errorElement:"label",focusCleanup:!1,focusInvalid:!0,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(a){this.lastActive=a,this.settings.focusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass),this.hideThese(this.errorsFor(a)))},onfocusout:function(a){this.checkable(a)||!(a.name in this.submitted)&&this.optional(a)||this.element(a)},onkeyup:function(b,c){var d=[16,17,18,20,35,36,37,38,39,40,45,144,225];
9===c.which&&""===this.elementValue(b)||a.inArray(c.keyCode,d)!==-1||(b.name in this.submitted||b.name in this.invalid)&&this.element(b)},onclick:function(a){a.name in this.submitted?this.element(a):a.parentNode.name in this.submitted&&this.element(a.parentNode)},highlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).addClass(c).removeClass(d):a(b).addClass(c).removeClass(d)},unhighlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).removeClass(c).addClass(d):a(b).removeClass(c).addClass(d)}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",equalTo:"Please enter the same value again.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}."),step:a.validator.format("Please enter a multiple of {0}.")},autoCreateRanges:!1,prototype:{init:function(){function b(b){!this.form&&this.hasAttribute("contenteditable")&&(this.form=a(this).closest("form")[0],this.name=a(this).attr("name"));
var c=a.data(this.form,"validator"),d="on"+b.type.replace(/^validate/,""),e=c.settings;e[d]&&!a(this).is(e.ignore)&&e[d].call(c,this,b)}this.labelContainer=a(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm),this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var c,d=this.groups={};a.each(this.settings.groups,function(b,c){"string"==typeof c&&(c=c.split(/\s/)),a.each(c,function(a,c){d[c]=b})}),c=this.settings.rules,a.each(c,function(b,d){c[b]=a.validator.normalizeRule(d)}),a(this.currentForm).on("focusin.validate focusout.validate keyup.validate",":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'], [type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'], [type='radio'], [type='checkbox'], [contenteditable], [type='button']",b).on("click.validate","select, option, [type='radio'], [type='checkbox']",b),this.settings.invalidHandler&&a(this.currentForm).on("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),a.extend(this.submitted,this.errorMap),this.invalid=a.extend({},this.errorMap),this.valid()||a(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();
for(var a=0,b=this.currentElements=this.elements();b[a];a++)this.check(b[a]);return this.valid()},element:function(b){var c,d,e=this.clean(b),f=this.validationTargetFor(e),g=this,h=!0;return void 0===f?delete this.invalid[e.name]:(this.prepareElement(f),this.currentElements=a(f),d=this.groups[f.name],d&&a.each(this.groups,function(a,b){b===d&&a!==f.name&&(e=g.validationTargetFor(g.clean(g.findByName(a))),e&&e.name in g.invalid&&(g.currentElements.push(e),h=g.check(e)&&h))}),c=this.check(f)!==!1,h=h&&c,c?this.invalid[f.name]=!1:this.invalid[f.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),a(b).attr("aria-invalid",!c)),h},showErrors:function(b){if(b){var c=this;a.extend(this.errorMap,b),this.errorList=a.map(this.errorMap,function(a,b){return{message:a,element:c.findByName(b)[0]}}),this.successList=a.grep(this.successList,function(a){return!(a.name in b)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){a.fn.resetForm&&a(this.currentForm).resetForm(),this.invalid={},this.submitted={},this.prepareForm(),this.hideErrors();var b=this.elements().removeData("previousValue").removeAttr("aria-invalid");
this.resetElements(b)},resetElements:function(a){var b;if(this.settings.unhighlight)for(b=0;a[b];b++)this.settings.unhighlight.call(this,a[b],this.settings.errorClass,""),this.findByName(a[b].name).removeClass(this.settings.validClass);else a.removeClass(this.settings.errorClass).removeClass(this.settings.validClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(a){var b,c=0;for(b in a)void 0!==a[b]&&null!==a[b]&&a[b]!==!1&&c++;return c},hideErrors:function(){this.hideThese(this.toHide)},hideThese:function(a){a.not(this.containers).text(""),this.addWrapper(a).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}},findLastActive:function(){var b=this.lastActive;return b&&1===a.grep(this.errorList,function(a){return a.element.name===b.name}).length&&b},elements:function(){var b=this,c={};return a(this.currentForm).find("input, select, textarea, [contenteditable]").not(":submit, :reset, :image, :disabled").not(this.settings.ignore).filter(function(){var d=this.name||a(this).attr("name");return!d&&b.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.hasAttribute("contenteditable")&&(this.form=a(this).closest("form")[0],this.name=d),!(d in c||!b.objectLength(a(this).rules()))&&(c[d]=!0,!0)})},clean:function(b){return a(b)[0]},errors:function(){var b=this.settings.errorClass.split(" ").join(".");
return a(this.settings.errorElement+"."+b,this.errorContext)},resetInternals:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=a([]),this.toHide=a([])},reset:function(){this.resetInternals(),this.currentElements=a([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(a){this.reset(),this.toHide=this.errorsFor(a)},elementValue:function(b){var c,d,e=a(b),f=b.type;return"radio"===f||"checkbox"===f?this.findByName(b.name).filter(":checked").val():"number"===f&&"undefined"!=typeof b.validity?b.validity.badInput?"NaN":e.val():(c=b.hasAttribute("contenteditable")?e.text():e.val(),"file"===f?"C:\\fakepath\\"===c.substr(0,12)?c.substr(12):(d=c.lastIndexOf("/"),d>=0?c.substr(d+1):(d=c.lastIndexOf("\\"),d>=0?c.substr(d+1):c)):"string"==typeof c?c.replace(/\r/g,""):c)},check:function(b){b=this.validationTargetFor(this.clean(b));var c,d,e,f,g=a(b).rules(),h=a.map(g,function(a,b){return b}).length,i=!1,j=this.elementValue(b);if("function"==typeof g.normalizer?f=g.normalizer:"function"==typeof this.settings.normalizer&&(f=this.settings.normalizer),f){if(j=f.call(b,j),"string"!=typeof j)throw new TypeError("The normalizer should return a string value.");
delete g.normalizer}for(d in g){e={method:d,parameters:g[d]};try{if(c=a.validator.methods[d].call(this,j,b,e.parameters),"dependency-mismatch"===c&&1===h){i=!0;continue}if(i=!1,"pending"===c)return void(this.toHide=this.toHide.not(this.errorsFor(b)));if(!c)return this.formatAndAdd(b,e),!1}catch(k){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+b.id+", check the '"+e.method+"' method.",k),k instanceof TypeError&&(k.message+=".  Exception occurred when checking element "+b.id+", check the '"+e.method+"' method."),k}}if(!i)return this.objectLength(g)&&this.successList.push(b),!0},customDataMessage:function(b,c){return a(b).data("msg"+c.charAt(0).toUpperCase()+c.substring(1).toLowerCase())||a(b).data("msg")},customMessage:function(a,b){var c=this.settings.messages[a];return c&&(c.constructor===String?c:c[b])},findDefined:function(){for(var a=0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a]},defaultMessage:function(b,c){"string"==typeof c&&(c={method:c});var d=this.findDefined(this.customMessage(b.name,c.method),this.customDataMessage(b,c.method),!this.settings.ignoreTitle&&b.title||void 0,a.validator.messages[c.method],"<strong>Warning: No message defined for "+b.name+"</strong>"),e=/\$?\{(\d+)\}/g;return"function"==typeof d?d=d.call(this,c.parameters,b):e.test(d)&&(d=a.validator.format(d.replace(e,"{$1}"),c.parameters)),d},formatAndAdd:function(a,b){var c=this.defaultMessage(a,b);
this.errorList.push({message:c,element:a,method:b.method}),this.errorMap[a.name]=c,this.submitted[a.name]=c},addWrapper:function(a){return this.settings.wrapper&&(a=a.add(a.parent(this.settings.wrapper))),a},defaultShowErrors:function(){var a,b,c;
for(a=0;this.errorList[a];a++)c=this.errorList[a],this.settings.highlight&&this.settings.highlight.call(this,c.element,this.settings.errorClass,this.settings.validClass),this.showLabel(c.element,c.message);if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(a=0;this.successList[a];a++)this.showLabel(this.successList[a]);if(this.settings.unhighlight)for(a=0,b=this.validElements();b[a];a++)this.settings.unhighlight.call(this,b[a],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(b,c){var d,e,f,g,h=this.errorsFor(b),i=this.idOrName(b),j=a(b).attr("aria-describedby");h.length?(h.removeClass(this.settings.validClass).addClass(this.settings.errorClass),h.html(c)):(h=a("<"+this.settings.errorElement+">").attr("id",i+"-error").addClass(this.settings.errorClass).html(c||""),d=h,this.settings.wrapper&&(d=h.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.length?this.labelContainer.append(d):this.settings.errorPlacement?this.settings.errorPlacement.call(this,d,a(b)):d.insertAfter(b),h.is("label")?h.attr("for",i):0===h.parents("label[for='"+this.escapeCssMeta(i)+"']").length&&(f=h.attr("id"),j?j.match(new RegExp("\\b"+this.escapeCssMeta(f)+"\\b"))||(j+=" "+f):j=f,a(b).attr("aria-describedby",j),e=this.groups[b.name],e&&(g=this,a.each(g.groups,function(b,c){c===e&&a("[name='"+g.escapeCssMeta(b)+"']",g.currentForm).attr("aria-describedby",h.attr("id"))})))),!c&&this.settings.success&&(h.text(""),"string"==typeof this.settings.success?h.addClass(this.settings.success):this.settings.success(h,b)),this.toShow=this.toShow.add(h)},errorsFor:function(b){var c=this.escapeCssMeta(this.idOrName(b)),d=a(b).attr("aria-describedby"),e="label[for='"+c+"'], label[for='"+c+"'] *";
return d&&(e=e+", #"+this.escapeCssMeta(d).replace(/\s+/g,", #")),this.errors().filter(e)},escapeCssMeta:function(a){return a.replace(/([\\!"#$%&'()*+,.\/:;<=>?@\[\]^`{|}~])/g,"\\$1")},idOrName:function(a){return this.groups[a.name]||(this.checkable(a)?a.name:a.id||a.name)},validationTargetFor:function(b){return this.checkable(b)&&(b=this.findByName(b.name)),a(b).not(this.settings.ignore)[0]},checkable:function(a){return/radio|checkbox/i.test(a.type)},findByName:function(b){return a(this.currentForm).find("[name='"+this.escapeCssMeta(b)+"']")},getLength:function(b,c){switch(c.nodeName.toLowerCase()){case"select":return a("option:selected",c).length;case"input":if(this.checkable(c))return this.findByName(c.name).filter(":checked").length}return b.length},depend:function(a,b){return!this.dependTypes[typeof a]||this.dependTypes[typeof a](a,b)},dependTypes:{"boolean":function(a){return a},string:function(b,c){return!!a(b,c.form).length},"function":function(a,b){return a(b)}},optional:function(b){var c=this.elementValue(b)
return!a.validator.methods.required.call(this,c,b)&&"dependency-mismatch"},startRequest:function(b){this.pending[b.name]||(this.pendingRequest++,a(b).addClass(this.settings.pendingClass),this.pending[b.name]=!0)},stopRequest:function(b,c){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[b.name],a(b).removeClass(this.settings.pendingClass),c&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(a(this.currentForm).submit(),this.submitButton&&a("input:hidden[name='"+this.submitButton.name+"']",this.currentForm).remove(),this.formSubmitted=!1):!c&&0===this.pendingRequest&&this.formSubmitted&&(a(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(b,c){return c="string"==typeof c&&c||"remote",a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:!0,message:this.defaultMessage(b,{method:c})})},destroy:function(){this.resetForm(),a(this.currentForm).off(".validate").removeData("validator").find(".validate-equalTo-blur").off(".validate-equalTo").removeClass("validate-equalTo-blur")}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(b,c){b.constructor===String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(b){var c={},d=a(b).attr("class");return d&&a.each(d.split(" "),function(){this in a.validator.classRuleSettings&&a.extend(c,a.validator.classRuleSettings[this])}),c},normalizeAttributeRule:function(a,b,c,d){/min|max|step/.test(c)&&(null===b||/number|range|text/.test(b))&&(d=Number(d),isNaN(d)&&(d=void 0)),d||0===d?a[c]=d:b===c&&"range"!==b&&(a[c]=!0)},attributeRules:function(b){var c,d,e={},f=a(b),g=b.getAttribute("type");
for(c in a.validator.methods)"required"===c?(d=b.getAttribute(c),""===d&&(d=!0),d=!!d):d=f.attr(c),this.normalizeAttributeRule(e,g,c,d);return e.maxlength&&/-1|2147483647|524288/.test(e.maxlength)&&delete e.maxlength,e},dataRules:function(b){var c,d,e={},f=a(b),g=b.getAttribute("type");for(c in a.validator.methods)d=f.data("rule"+c.charAt(0).toUpperCase()+c.substring(1).toLowerCase()),this.normalizeAttributeRule(e,g,c,d);return e},staticRules:function(b){var c={},d=a.data(b.form,"validator");return d.settings.rules&&(c=a.validator.normalizeRule(d.settings.rules[b.name])||{}),c},normalizeRules:function(b,c){return a.each(b,function(d,e){if(e===!1)return void delete b[d];if(e.param||e.depends){var f=!0;switch(typeof e.depends){case"string":f=!!a(e.depends,c.form).length;break;case"function":f=e.depends.call(c,c)}f?b[d]=void 0===e.param||e.param:(a.data(c.form,"validator").resetElements(a(c)),delete b[d])}}),a.each(b,function(d,e){b[d]=a.isFunction(e)&&"normalizer"!==d?e(c):e}),a.each(["minlength","maxlength"],function(){b[this]&&(b[this]=Number(b[this]))}),a.each(["rangelength","range"],function(){var c;b[this]&&(a.isArray(b[this])?b[this]=[Number(b[this][0]),Number(b[this][1])]:"string"==typeof b[this]&&(c=b[this].replace(/[\[\]]/g,"").split(/[\s,]+/),b[this]=[Number(c[0]),Number(c[1])]))}),a.validator.autoCreateRanges&&(null!=b.min&&null!=b.max&&(b.range=[b.min,b.max],delete b.min,delete b.max),null!=b.minlength&&null!=b.maxlength&&(b.rangelength=[b.minlength,b.maxlength],delete b.minlength,delete b.maxlength)),b},normalizeRule:function(b){if("string"==typeof b){var c={};a.each(b.split(/\s/),function(){c[this]=!0}),b=c}return b},addMethod:function(b,c,d){a.validator.methods[b]=c,a.validator.messages[b]=void 0!==d?d:a.validator.messages[b],c.length<3&&a.validator.addClassRules(b,a.validator.normalizeRule(b))},methods:{required:function(b,c,d){if(!this.depend(d,c))return"dependency-mismatch";
if("select"===c.nodeName.toLowerCase()){var e=a(c).val();return e&&e.length>0}return this.checkable(c)?this.getLength(b,c)>0:b.length>0},email:function(a,b){return this.optional(b)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)},url:function(a,b){return this.optional(b)||/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(a)},date:function(a,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(a).toString())},dateISO:function(a,b){return this.optional(b)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(a)},number:function(a,b){return this.optional(b)||/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)},digits:function(a,b){return this.optional(b)||/^\d+$/.test(a)},minlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(b,c);return this.optional(c)||e>=d},maxlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(b,c);return this.optional(c)||e<=d},rangelength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(b,c);return this.optional(c)||e>=d[0]&&e<=d[1]},min:function(a,b,c){return this.optional(b)||a>=c},max:function(a,b,c){return this.optional(b)||a<=c},range:function(a,b,c){return this.optional(b)||a>=c[0]&&a<=c[1]},step:function(b,c,d){var e,f=a(c).attr("type"),g="Step attribute on input type "+f+" is not supported.",h=["text","number","range"],i=new RegExp("\\b"+f+"\\b"),j=f&&!i.test(h.join()),k=function(a){var b=(""+a).match(/(?:\.(\d+))?$/);return b&&b[1]?b[1].length:0},l=function(a){return Math.round(a*Math.pow(10,e))},m=!0;if(j)throw new Error(g)
return e=k(d),(k(b)>e||l(b)%l(d)!==0)&&(m=!1),this.optional(c)||m},equalTo:function(b,c,d){var e=a(d);return this.settings.onfocusout&&e.not(".validate-equalTo-blur").length&&e.addClass("validate-equalTo-blur").on("blur.validate-equalTo",function(){a(c).valid()}),b===e.val()},remote:function(b,c,d,e){if(this.optional(c))return"dependency-mismatch";e="string"==typeof e&&e||"remote";var f,g,h,i=this.previousValue(c,e);return this.settings.messages[c.name]||(this.settings.messages[c.name]={}),i.originalMessage=i.originalMessage||this.settings.messages[c.name][e],this.settings.messages[c.name][e]=i.message,d="string"==typeof d&&{url:d}||d,h=a.param(a.extend({data:b},d.data)),i.old===h?i.valid:(i.old=h,f=this,this.startRequest(c),g={},g[c.name]=b,a.ajax(a.extend(!0,{mode:"abort",port:"validate"+c.name,dataType:"json",data:g,context:f.currentForm,success:function(a){var d,g,h,j=a===!0||"true"===a;f.settings.messages[c.name][e]=i.originalMessage,j?(h=f.formSubmitted,f.resetInternals(),f.toHide=f.errorsFor(c),f.formSubmitted=h,f.successList.push(c),f.invalid[c.name]=!1,f.showErrors()):(d={},g=a||f.defaultMessage(c,{method:e,parameters:b}),d[c.name]=i.message=g,f.invalid[c.name]=!0,f.showErrors(d)),i.valid=j,f.stopRequest(c,j)}},d)),"pending")}}});var b,c={};return a.ajaxPrefilter?a.ajaxPrefilter(function(a,b,d){var e=a.port;"abort"===a.mode&&(c[e]&&c[e].abort(),c[e]=d)}):(b=a.ajax,a.ajax=function(d){var e=("mode"in d?d:a.ajaxSettings).mode,f=("port"in d?d:a.ajaxSettings).port;return"abort"===e?(c[f]&&c[f].abort(),c[f]=b.apply(this,arguments),c[f]):b.apply(this,arguments)}),a});;
$.validator.addMethod("dateDE", function(value, element) { return this.optional(element) || /^\d\d?\.\d\d?\.\d\d\d?\d?$/.test(value) }, 'Please enter a valid date.');
$.validator.addMethod("numberDE", function(value, element) { return this.optional(element) || /^-?\d*\,?\d*$/.test(value) }, 'Please enter a valid number.');
$.validator.addMethod("number", function(value, element) { return this.optional(element) || /^-?\d*\.?\d*$/.test(value) }, 'Please enter a valid number.');
$.validator.addMethod("selectrequired", function(value, element) { return this.optional(element) || (value = '' || !/^(\|+)$/.test(value)) }, 'Please select a value.');
$.validator.addMethod("ipcbase", function(value, element) { return this.optional(element) || /^\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){2}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b$/.test(value) }, 'Please enter a valid class C network IP base (e.g. 192.168.0 ).');
$.validator.addMethod("iplist", function(value, element) { return this.optional(element) || true }, 'Please enter a list of valid IP addresses.');
$.validator.addMethod("ipsubnet", function(value, element) { return this.optional(element) || /^\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b\/\b((3[0-1]|[12][0-9]|[1-9])|(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\b$/.test(value) }, 'Please enter a valid IP subnet (e.g. 192.168.0.0/255.255.255.0 or 192.168.0.0/24).');
$.validator.addMethod("ipoctetrange", function(value, element) { return this.optional(element) || /^(\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b|(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)-(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\.(\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b|(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)-(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\.(\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b|(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)-(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\.((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)-(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b))$/.test(value) }, 'Please enter a valid network IP octet range (e.g. 192.168.0-10.1-255 ).');
$.validator.addMethod("ipsingle", function(value, element) { return this.optional(element) || true }, 'Please enter a single valid IP address (e.g. 192.168.0.1 ).');
$.validator.addMethod("hexcolor", function(value, element) { return this.optional(element) || /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(value) }, 'Please enter a valid hex color with a leading #');
$.validator.addMethod("oid", function(value, element) { return this.optional(element) || /^[.]?1\.[0-3](\.(([0-9]+)|("[A-Za-z0-9]+")|('[A-Za-z0-9]+')))+$/.test(value) || /^norfccheck:.*/i.test(value) }, 'Enter a valid OID value (for example 1.3.6.1.2.1.1.3.0 or 1.3.6.1.4.&quot;apcupsd&quot;.2)');
$.validator.addMethod("mapsecretkey", function(value, element) { var check = true; if (value.indexOf(",") !== -1) check = false; if (value.indexOf(":") !== -1) check = false; return this.optional(element) || check }, 'The characters , and : are not allowed');
$.validator.addMethod("passwordcapital", function(value, element) { var check = false; if ($("#login_").length > 0 && $("#login_").val() === "prtgadmin" && value === "prtgadmin") check = true;
    else check = /[A-Z]/.test(value); return this.optional(element) || check }, 'Minimum 1 capital letter (A-Z)!');
$.validator.addMethod("passwordnumber", function(value, element) { var check = false; if ($("#login_").length > 0 && $("#login_").val() === "prtgadmin" && value === "prtgadmin") check = true;
    else check = /[0-9]/.test(value); return this.optional(element) || check }, 'Minimum 1 number!');
$.validator.addMethod("passwordchartimes", function(value, element) { return true; var passwordchartimescheck = false; if ($("#login_").length > 0 && $("#login_").val() === "prtgadmin" && value === "prtgadmin") passwordchartimescheck = true;
    else passwordchartimescheck = !/(.)(.*\1){3,}/.test(value); return this.optional(element) || passwordchartimescheck }, 'Not more than 3 identical characters!');
$.validator.addMethod("pwminlength", function(value, element, param) { var length = $.isArray(value) ? value.length : this.getLength($.trim(value), element); return this.optional(element) || length >= param }, $.validator.format('Please enter at least {0} characters.'));
$.validator.addMethod("asciionly", function(value, element) { return this.optional(element) || /^[\x00-\x7F]*$/.test(value) }, 'Please enter ASCII characters only!');
$.validator.addMethod("purgedate", function(value, element) { var selected = $(element).data("plugin_prtgDatetimepicker").getCurrentSelectedDate(); var arr = _Prtg.Options.lastpurgedate.split("-"); var lastpurge = new Date(arr[0], arr[1] - 1, arr[2], arr[3], arr[4], arr[5]); var result = false; if (selected.getTime() > lastpurge.getTime()) result = true; if ($(element).hasClass("orginal_input")) result = true; return this.optional(element) || result }, function() {
    var helpText = 'Warning: You cannot generate the historic data report because data is only available as of the last data purge on PURGEDATE. Please adjust the start date accordingly.';
    helpText = helpText.replace("PURGEDATE", _Prtg.Options.lastpurgedate);
    return helpText
});

// this rule checks if a passed datepicker instance has a selected date
// which is before its corresponding startpicker.
$.validator.addMethod("enddate", function(value, element) {
    var $element = $(element);
    var endDate = new Date($element.data("plugin_prtgDatetimepicker").getCurrentSelectedDate());
    var startDate = _Prtg.Util.createDate($("#" + $element.data("startpicker")).val());
    return !(endDate.getTime() <= startDate.getTime());
}, 'End date has to be after start date.');

$.validator.addMethod("requiredtablecheckbox",function(value, element) {
	var d = $(element).closest('table.dataTable')
	if(d.length == 0) return true;
	d = d.DataTable();
	return $('input.checkbox', d.rows().nodes()).toArray().some(function(e) {return e.checked;})
}, 'Please select a value.');
    
$.validator.addMethod("ticketnumber", function(value, element) { var number = value.substr(3); return this.optional(element) || number > 1E5 && /^(pae|PAE)[0-9]{6}[0-9]?$/.test(value) }, 'Please enter your ticket number in the form PAE plus seven digits');

// This rule alwaysshow an "please select a value" error. Used on objectlookup for example.
$.validator.addMethod("showrequired",function(value, element) {
    return false
}, 'Please select a value.');

jQuery.extend(jQuery.validator.messages, {
    required: 'This field is required.',
    remote: 'Please fix this field.',
    email: 'Please enter a valid email address.',
    url: 'Please enter a valid URL.',
    date: 'Please enter a valid date.',
    dateISO: 'Please enter a valid date (ISO).',
    number: 'Please enter a valid number.',
    digits: 'Please enter only digits.',
    creditcard: 'Please enter a valid credit card number.',
    equalTo: 'Please enter the same value again.',
    accept: 'Please enter a value with a valid extension.',
    maxlength: $.validator.format('Please enter no more than {0} characters.'),
    minlength: $.validator.format('Please enter at least {0} characters.'),
    rangelength: $.validator.format('Please enter a value between {0} and {1} characters long.'),
    range: $.validator.format('Please enter a value between {0} and {1}.'),
    max: $.validator.format('Please enter a value less than or equal to {0}.'),
    min: $.validator.format('Please enter a value greater than or equal to {0}.')
});

$.validator.addMethod("oneof", function(value, element) { var selected = $(element).data("plugin_prtgDatetimepicker").getCurrentSelectedDate(); var arr = _Prtg.Options.lastpurgedate.split("-"); var lastpurge = new Date(arr[0], arr[1] - 1, arr[2], arr[3], arr[4], arr[5]); var result = false; if (selected.getTime() > lastpurge.getTime()) result = true; if ($(element).hasClass("orginal_input")) result = true; return this.optional(element) || result }, function() {
    var helpText = 'Warning: You cannot generate the historic data report because data is only available as of the last data purge on PURGEDATE. Please adjust the start date accordingly.';
    helpText = helpText.replace("PURGEDATE", _Prtg.Options.lastpurgedate);
    return helpText
});

/*
 * Lets you say "at least X inputs that match selector Y must be filled."
 *
 * The end result is that neither of these inputs:
 *
 *	<input class="productinfo" name="partnumber">
 *	<input class="productinfo" name="description">
 *
 *	...will validate unless at least one of them is filled.
 *
 * partnumber:	{require_from_group: [1,".productinfo"]},
 * description: {require_from_group: [1,".productinfo"]}
 *
 * options[0]: number of fields that must be filled in the group
 * options[1]: CSS selector that defines the group of conditionally required fields
 */
$.validator.addMethod("validgroup", function( value, element, options ) {

	var $fields = $("[data-rule-validgroup='"+options+"']:visible", element.form ),
		$fieldsFirst = $fields.eq( 0 ),
		validator = $fieldsFirst.data( "valid_req_grp" ) ? $fieldsFirst.data( "valid_req_grp" ) : $.extend( {}, this ),
		isValid = $fields.filter( function() {
            if($(this).is("select") && validator.elementValue(this) == -1) return 
            return validator.elementValue( this );
        } ).length >= 1;
    
	// Store the cloned validator for future validation
	$fieldsFirst.data( "valid_req_grp", validator );

	// If element isn't being validated, run each require_from_group field's validation rules
	if ( !$( element ).data( "being_validated" ) ) {
		$fields.data( "being_validated", true );
		$fields.each( function() {
			validator.element( this );
		} );
		$fields.data( "being_validated", false );
	}
	return isValid;
}, $.validator.format('Enter a value.') );

// Override the internal validation methods
$.validator.methods.max = function(value, element, param) {
    var maxValue = parseFloat(value.toString().replace(',', '.'));
    return this.optional( element ) || maxValue <= param;
};
$.validator.methods.min = function(value, element, param) {
    var minValue = parseFloat(value.toString().replace(',', '.'));
    return this.optional( element ) || minValue >= param;
};
;
//! moment.js
//! version : 2.18.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com

;(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    global.moment = factory()
}(this, (function () { 'use strict';

var hookCallback;

function hooks () {
    return hookCallback.apply(null, arguments);
}

// This is done to register the method called with moment()
// without creating circular dependencies.
function setHookCallback (callback) {
    hookCallback = callback;
}

function isArray(input) {
    return input instanceof Array || Object.prototype.toString.call(input) === '[object Array]';
}

function isObject(input) {
    // IE8 will treat undefined and null as object if it wasn't for
    // input != null
    return input != null && Object.prototype.toString.call(input) === '[object Object]';
}

function isObjectEmpty(obj) {
    var k;
    for (k in obj) {
        // even if its not own property I'd still call it non-empty
        return false;
    }
    return true;
}

function isUndefined(input) {
    return input === void 0;
}

function isNumber(input) {
    return typeof input === 'number' || Object.prototype.toString.call(input) === '[object Number]';
}

function isDate(input) {
    return input instanceof Date || Object.prototype.toString.call(input) === '[object Date]';
}

function map(arr, fn) {
    var res = [], i;
    for (i = 0; i <arr.length; ++i) {
        res.push(fn(arr[i], i));
    }
    return res;
}

function hasOwnProp(a, b) {
    return Object.prototype.hasOwnProperty.call(a, b);
}

function extend(a, b) {
    for (var i in b) {
        if (hasOwnProp(b, i)) {
            a[i] = b[i];
        }
    }

    if (hasOwnProp(b, 'toString')) {
        a.toString = b.toString;
    }

    if (hasOwnProp(b, 'valueOf')) {
        a.valueOf = b.valueOf;
    }

    return a;
}

function createUTC (input, format, locale, strict) {
    return createLocalOrUTC(input, format, locale, strict, true).utc();
}

function defaultParsingFlags() {
    // We need to deep clone this object.
    return {
        empty           : false,
        unusedTokens    : [],
        unusedInput     : [],
        overflow        : -2,
        charsLeftOver   : 0,
        nullInput       : false,
        invalidMonth    : null,
        invalidFormat   : false,
        userInvalidated : false,
        iso             : false,
        parsedDateParts : [],
        meridiem        : null,
        rfc2822         : false,
        weekdayMismatch : false
    };
}

function getParsingFlags(m) {
    if (m._pf == null) {
        m._pf = defaultParsingFlags();
    }
    return m._pf;
}

var some;
if (Array.prototype.some) {
    some = Array.prototype.some;
} else {
    some = function (fun) {
        var t = Object(this);
        var len = t.length >>> 0;

        for (var i = 0; i <len; i++) {
            if (i in t && fun.call(this, t[i], i, t)) {
                return true;
            }
        }

        return false;
    };
}

var some$1 = some;

function isValid(m) {
    if (m._isValid == null) {
        var flags = getParsingFlags(m);
        var parsedParts = some$1.call(flags.parsedDateParts, function (i) {
            return i != null;
        });
        var isNowValid = !isNaN(m._d.getTime()) &&
            flags.overflow <0 &&
            !flags.empty &&
            !flags.invalidMonth &&
            !flags.invalidWeekday &&
            !flags.nullInput &&
            !flags.invalidFormat &&
            !flags.userInvalidated &&
            (!flags.meridiem || (flags.meridiem && parsedParts));

        if (m._strict) {
            isNowValid = isNowValid &&
                flags.charsLeftOver === 0 &&
                flags.unusedTokens.length === 0 &&
                flags.bigHour === undefined;
        }

        if (Object.isFrozen == null || !Object.isFrozen(m)) {
            m._isValid = isNowValid;
        }
        else {
            return isNowValid;
        }
    }
    return m._isValid;
}

function createInvalid (flags) {
    var m = createUTC(NaN);
    if (flags != null) {
        extend(getParsingFlags(m), flags);
    }
    else {
        getParsingFlags(m).userInvalidated = true;
    }

    return m;
}

// Plugins that add properties should also add the key here (null value),
// so we can properly clone ourselves.
var momentProperties = hooks.momentProperties = [];

function copyConfig(to, from) {
    var i, prop, val;

    if (!isUndefined(from._isAMomentObject)) {
        to._isAMomentObject = from._isAMomentObject;
    }
    if (!isUndefined(from._i)) {
        to._i = from._i;
    }
    if (!isUndefined(from._f)) {
        to._f = from._f;
    }
    if (!isUndefined(from._l)) {
        to._l = from._l;
    }
    if (!isUndefined(from._strict)) {
        to._strict = from._strict;
    }
    if (!isUndefined(from._tzm)) {
        to._tzm = from._tzm;
    }
    if (!isUndefined(from._isUTC)) {
        to._isUTC = from._isUTC;
    }
    if (!isUndefined(from._offset)) {
        to._offset = from._offset;
    }
    if (!isUndefined(from._pf)) {
        to._pf = getParsingFlags(from);
    }
    if (!isUndefined(from._locale)) {
        to._locale = from._locale;
    }

    if (momentProperties.length > 0) {
        for (i = 0; i <momentProperties.length; i++) {
            prop = momentProperties[i];
            val = from[prop];
            if (!isUndefined(val)) {
                to[prop] = val;
            }
        }
    }

    return to;
}

var updateInProgress = false;

// Moment prototype object
function Moment(config) {
    copyConfig(this, config);
    this._d = new Date(config._d != null ? config._d.getTime() : NaN);
    if (!this.isValid()) {
        this._d = new Date(NaN);
    }
    // Prevent infinite loop in case updateOffset creates new moment
    // objects.
    if (updateInProgress === false) {
        updateInProgress = true;
        hooks.updateOffset(this);
        updateInProgress = false;
    }
}

function isMoment (obj) {
    return obj instanceof Moment || (obj != null && obj._isAMomentObject != null);
}

function absFloor (number) {
    if (number <0) {
        // -0 -> 0
        return Math.ceil(number) || 0;
    } else {
        return Math.floor(number);
    }
}

function toInt(argumentForCoercion) {
    var coercedNumber = +argumentForCoercion,
        value = 0;

    if (coercedNumber !== 0 && isFinite(coercedNumber)) {
        value = absFloor(coercedNumber);
    }

    return value;
}

// compare two arrays, return the number of differences
function compareArrays(array1, array2, dontConvert) {
    var len = Math.min(array1.length, array2.length),
        lengthDiff = Math.abs(array1.length - array2.length),
        diffs = 0,
        i;
    for (i = 0; i <len; i++) {
        if ((dontConvert && array1[i] !== array2[i]) ||
            (!dontConvert && toInt(array1[i]) !== toInt(array2[i]))) {
            diffs++;
        }
    }
    return diffs + lengthDiff;
}

function warn(msg) {
    if (hooks.suppressDeprecationWarnings === false &&
            (typeof console !==  'undefined') && console.warn) {
        console.warn('Deprecation warning: ' + msg);
    }
}

function deprecate(msg, fn) {
    var firstTime = true;

    return extend(function () {
        if (hooks.deprecationHandler != null) {
            hooks.deprecationHandler(null, msg);
        }
        if (firstTime) {
            var args = [];
            var arg;
            for (var i = 0; i <arguments.length; i++) {
                arg = '';
                if (typeof arguments[i] === 'object') {
                    arg += '\n[' + i + '] ';
                    for (var key in arguments[0]) {
                        arg += key + ': ' + arguments[0][key] + ', ';
                    }
                    arg = arg.slice(0, -2); // Remove trailing comma and space
                } else {
                    arg = arguments[i];
                }
                args.push(arg);
            }
            warn(msg + '\nArguments: ' + Array.prototype.slice.call(args).join('') + '\n' + (new Error()).stack);
            firstTime = false;
        }
        return fn.apply(this, arguments);
    }, fn);
}

var deprecations = {};

function deprecateSimple(name, msg) {
    if (hooks.deprecationHandler != null) {
        hooks.deprecationHandler(name, msg);
    }
    if (!deprecations[name]) {
        warn(msg);
        deprecations[name] = true;
    }
}

hooks.suppressDeprecationWarnings = false;
hooks.deprecationHandler = null;

function isFunction(input) {
    return input instanceof Function || Object.prototype.toString.call(input) === '[object Function]';
}

function set (config) {
    var prop, i;
    for (i in config) {
        prop = config[i];
        if (isFunction(prop)) {
            this[i] = prop;
        } else {
            this['_' + i] = prop;
        }
    }
    this._config = config;
    // Lenient ordinal parsing accepts just a number in addition to
    // number + (possibly) stuff coming from _dayOfMonthOrdinalParse.
    // TODO: Remove "ordinalParse" fallback in next major release.
    this._dayOfMonthOrdinalParseLenient = new RegExp(
        (this._dayOfMonthOrdinalParse.source || this._ordinalParse.source) +
            '|' + (/\d{1,2}/).source);
}

function mergeConfigs(parentConfig, childConfig) {
    var res = extend({}, parentConfig), prop;
    for (prop in childConfig) {
        if (hasOwnProp(childConfig, prop)) {
            if (isObject(parentConfig[prop]) && isObject(childConfig[prop])) {
                res[prop] = {};
                extend(res[prop], parentConfig[prop]);
                extend(res[prop], childConfig[prop]);
            } else if (childConfig[prop] != null) {
                res[prop] = childConfig[prop];
            } else {
                delete res[prop];
            }
        }
    }
    for (prop in parentConfig) {
        if (hasOwnProp(parentConfig, prop) &&
                !hasOwnProp(childConfig, prop) &&
                isObject(parentConfig[prop])) {
            // make sure changes to properties don't modify parent config
            res[prop] = extend({}, res[prop]);
        }
    }
    return res;
}

function Locale(config) {
    if (config != null) {
        this.set(config);
    }
}

var keys;

if (Object.keys) {
    keys = Object.keys;
} else {
    keys = function (obj) {
        var i, res = [];
        for (i in obj) {
            if (hasOwnProp(obj, i)) {
                res.push(i);
            }
        }
        return res;
    };
}

var keys$1 = keys;

var defaultCalendar = {
    sameDay : '[Today at] LT',
    nextDay : '[Tomorrow at] LT',
    nextWeek : 'dddd [at] LT',
    lastDay : '[Yesterday at] LT',
    lastWeek : '[Last] dddd [at] LT',
    sameElse : 'L'
};

function calendar (key, mom, now) {
    var output = this._calendar[key] || this._calendar['sameElse'];
    return isFunction(output) ? output.call(mom, now) : output;
}

var defaultLongDateFormat = {
    LTS  : 'h:mm:ss A',
    LT   : 'h:mm A',
    L    : 'MM/DD/YYYY',
    LL   : 'MMMM D, YYYY',
    LLL  : 'MMMM D, YYYY h:mm A',
    LLLL : 'dddd, MMMM D, YYYY h:mm A'
};

function longDateFormat (key) {
    var format = this._longDateFormat[key],
        formatUpper = this._longDateFormat[key.toUpperCase()];

    if (format || !formatUpper) {
        return format;
    }

    this._longDateFormat[key] = formatUpper.replace(/MMMM|MM|DD|dddd/g, function (val) {
        return val.slice(1);
    });

    return this._longDateFormat[key];
}

var defaultInvalidDate = 'Invalid date';

function invalidDate () {
    return this._invalidDate;
}

var defaultOrdinal = '%d';
var defaultDayOfMonthOrdinalParse = /\d{1,2}/;

function ordinal (number) {
    return this._ordinal.replace('%d', number);
}

var defaultRelativeTime = {
    future : 'in %s',
    past   : '%s ago',
    s  : 'a few seconds',
    ss : '%d seconds',
    m  : 'a minute',
    mm : '%d minutes',
    h  : 'an hour',
    hh : '%d hours',
    d  : 'a day',
    dd : '%d days',
    M  : 'a month',
    MM : '%d months',
    y  : 'a year',
    yy : '%d years'
};

function relativeTime (number, withoutSuffix, string, isFuture) {
    var output = this._relativeTime[string];
    return (isFunction(output)) ?
        output(number, withoutSuffix, string, isFuture) :
        output.replace(/%d/i, number);
}

function pastFuture (diff, output) {
    var format = this._relativeTime[diff > 0 ? 'future' : 'past'];
    return isFunction(format) ? format(output) : format.replace(/%s/i, output);
}

var aliases = {};

function addUnitAlias (unit, shorthand) {
    var lowerCase = unit.toLowerCase();
    aliases[lowerCase] = aliases[lowerCase + 's'] = aliases[shorthand] = unit;
}

function normalizeUnits(units) {
    return typeof units === 'string' ? aliases[units] || aliases[units.toLowerCase()] : undefined;
}

function normalizeObjectUnits(inputObject) {
    var normalizedInput = {},
        normalizedProp,
        prop;

    for (prop in inputObject) {
        if (hasOwnProp(inputObject, prop)) {
            normalizedProp = normalizeUnits(prop);
            if (normalizedProp) {
                normalizedInput[normalizedProp] = inputObject[prop];
            }
        }
    }

    return normalizedInput;
}

var priorities = {};

function addUnitPriority(unit, priority) {
    priorities[unit] = priority;
}

function getPrioritizedUnits(unitsObj) {
    var units = [];
    for (var u in unitsObj) {
        units.push({unit: u, priority: priorities[u]});
    }
    units.sort(function (a, b) {
        return a.priority - b.priority;
    });
    return units;
}

function makeGetSet (unit, keepTime) {
    return function (value) {
        if (value != null) {
            set$1(this, unit, value);
            hooks.updateOffset(this, keepTime);
            return this;
        } else {
            return get(this, unit);
        }
    };
}

function get (mom, unit) {
    return mom.isValid() ?
        mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]() : NaN;
}

function set$1 (mom, unit, value) {
    if (mom.isValid()) {
        mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);
    }
}

// MOMENTS

function stringGet (units) {
    units = normalizeUnits(units);
    if (isFunction(this[units])) {
        return this[units]();
    }
    return this;
}


function stringSet (units, value) {
    if (typeof units === 'object') {
        units = normalizeObjectUnits(units);
        var prioritized = getPrioritizedUnits(units);
        for (var i = 0; i <prioritized.length; i++) {
            this[prioritized[i].unit](units[prioritized[i].unit]);
        }
    } else {
        units = normalizeUnits(units);
        if (isFunction(this[units])) {
            return this[units](value);
        }
    }
    return this;
}

function zeroFill(number, targetLength, forceSign) {
    var absNumber = '' + Math.abs(number),
        zerosToFill = targetLength - absNumber.length,
        sign = number >= 0;
    return (sign ? (forceSign ? '+' : '') : '-') +
        Math.pow(10, Math.max(0, zerosToFill)).toString().substr(1) + absNumber;
}

var formattingTokens = /(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;

var localFormattingTokens = /(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;

var formatFunctions = {};

var formatTokenFunctions = {};

// token:    'M'
// padded:   ['MM', 2]
// ordinal:  'Mo'
// callback: function () { this.month() + 1 }
function addFormatToken (token, padded, ordinal, callback) {
    var func = callback;
    if (typeof callback === 'string') {
        func = function () {
            return this[callback]();
        };
    }
    if (token) {
        formatTokenFunctions[token] = func;
    }
    if (padded) {
        formatTokenFunctions[padded[0]] = function () {
            return zeroFill(func.apply(this, arguments), padded[1], padded[2]);
        };
    }
    if (ordinal) {
        formatTokenFunctions[ordinal] = function () {
            return this.localeData().ordinal(func.apply(this, arguments), token);
        };
    }
}

function removeFormattingTokens(input) {
    if (input.match(/\[[\s\S]/)) {
        return input.replace(/^\[|\]$/g, '');
    }
    return input.replace(/\\/g, '');
}

function makeFormatFunction(format) {
    var array = format.match(formattingTokens), i, length;

    for (i = 0, length = array.length; i <length; i++) {
        if (formatTokenFunctions[array[i]]) {
            array[i] = formatTokenFunctions[array[i]];
        } else {
            array[i] = removeFormattingTokens(array[i]);
        }
    }

    return function (mom) {
        var output = '', i;
        for (i = 0; i <length; i++) {
            output += isFunction(array[i]) ? array[i].call(mom, format) : array[i];
        }
        return output;
    };
}

// format date using native date object
function formatMoment(m, format) {
    if (!m.isValid()) {
        return m.localeData().invalidDate();
    }

    format = expandFormat(format, m.localeData());
    formatFunctions[format] = formatFunctions[format] || makeFormatFunction(format);

    return formatFunctions[format](m);
}

function expandFormat(format, locale) {
    var i = 5;

    function replaceLongDateFormatTokens(input) {
        return locale.longDateFormat(input) || input;
    }

    localFormattingTokens.lastIndex = 0;
    while (i >= 0 && localFormattingTokens.test(format)) {
        format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);
        localFormattingTokens.lastIndex = 0;
        i -= 1;
    }

    return format;
}

var match1         = /\d/;            //       0 - 9
var match2         = /\d\d/;          //      00 - 99
var match3         = /\d{3}/;         //     000 - 999
var match4         = /\d{4}/;         //    0000 - 9999
var match6         = /[+-]?\d{6}/;    // -999999 - 999999
var match1to2      = /\d\d?/;         //       0 - 99
var match3to4      = /\d\d\d\d?/;     //     999 - 9999
var match5to6      = /\d\d\d\d\d\d?/; //   99999 - 999999
var match1to3      = /\d{1,3}/;       //       0 - 999
var match1to4      = /\d{1,4}/;       //       0 - 9999
var match1to6      = /[+-]?\d{1,6}/;  // -999999 - 999999

var matchUnsigned  = /\d+/;           //       0 - inf
var matchSigned    = /[+-]?\d+/;      //    -inf - inf

var matchOffset    = /Z|[+-]\d\d:?\d\d/gi; // +00:00 -00:00 +0000 -0000 or Z
var matchShortOffset = /Z|[+-]\d\d(?::?\d\d)?/gi; // +00 -00 +00:00 -00:00 +0000 -0000 or Z

var matchTimestamp = /[+-]?\d+(\.\d{1,3})?/; // 123456789 123456789.123

// any word (or two) characters or numbers including two/three word month in arabic.
// includes scottish gaelic two word and hyphenated months
var matchWord = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i;


var regexes = {};

function addRegexToken (token, regex, strictRegex) {
    regexes[token] = isFunction(regex) ? regex : function (isStrict, localeData) {
        return (isStrict && strictRegex) ? strictRegex : regex;
    };
}

function getParseRegexForToken (token, config) {
    if (!hasOwnProp(regexes, token)) {
        return new RegExp(unescapeFormat(token));
    }

    return regexes[token](config._strict, config._locale);
}

// Code from http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
function unescapeFormat(s) {
    return regexEscape(s.replace('\\', '').replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function (matched, p1, p2, p3, p4) {
        return p1 || p2 || p3 || p4;
    }));
}

function regexEscape(s) {
    return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
}

var tokens = {};

function addParseToken (token, callback) {
    var i, func = callback;
    if (typeof token === 'string') {
        token = [token];
    }
    if (isNumber(callback)) {
        func = function (input, array) {
            array[callback] = toInt(input);
        };
    }
    for (i = 0; i <token.length; i++) {
        tokens[token[i]] = func;
    }
}

function addWeekParseToken (token, callback) {
    addParseToken(token, function (input, array, config, token) {
        config._w = config._w || {};
        callback(input, config._w, config, token);
    });
}

function addTimeToArrayFromToken(token, input, config) {
    if (input != null && hasOwnProp(tokens, token)) {
        tokens[token](input, config._a, config, token);
    }
}

var YEAR = 0;
var MONTH = 1;
var DATE = 2;
var HOUR = 3;
var MINUTE = 4;
var SECOND = 5;
var MILLISECOND = 6;
var WEEK = 7;
var WEEKDAY = 8;

var indexOf;

if (Array.prototype.indexOf) {
    indexOf = Array.prototype.indexOf;
} else {
    indexOf = function (o) {
        // I know
        var i;
        for (i = 0; i <this.length; ++i) {
            if (this[i] === o) {
                return i;
            }
        }
        return -1;
    };
}

var indexOf$1 = indexOf;

function daysInMonth(year, month) {
    return new Date(Date.UTC(year, month + 1, 0)).getUTCDate();
}

// FORMATTING

addFormatToken('M', ['MM', 2], 'Mo', function () {
    return this.month() + 1;
});

addFormatToken('MMM', 0, 0, function (format) {
    return this.localeData().monthsShort(this, format);
});

addFormatToken('MMMM', 0, 0, function (format) {
    return this.localeData().months(this, format);
});

// ALIASES

addUnitAlias('month', 'M');

// PRIORITY

addUnitPriority('month', 8);

// PARSING

addRegexToken('M',    match1to2);
addRegexToken('MM',   match1to2, match2);
addRegexToken('MMM',  function (isStrict, locale) {
    return locale.monthsShortRegex(isStrict);
});
addRegexToken('MMMM', function (isStrict, locale) {
    return locale.monthsRegex(isStrict);
});

addParseToken(['M', 'MM'], function (input, array) {
    array[MONTH] = toInt(input) - 1;
});

addParseToken(['MMM', 'MMMM'], function (input, array, config, token) {
    var month = config._locale.monthsParse(input, token, config._strict);
    // if we didn't find a month name, mark the date as invalid.
    if (month != null) {
        array[MONTH] = month;
    } else {
        getParsingFlags(config).invalidMonth = input;
    }
});

// LOCALES

var MONTHS_IN_FORMAT = /D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;
var defaultLocaleMonths = 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_');
function localeMonths (m, format) {
    if (!m) {
        return isArray(this._months) ? this._months :
            this._months['standalone'];
    }
    return isArray(this._months) ? this._months[m.month()] :
        this._months[(this._months.isFormat || MONTHS_IN_FORMAT).test(format) ? 'format' : 'standalone'][m.month()];
}

var defaultLocaleMonthsShort = 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_');
function localeMonthsShort (m, format) {
    if (!m) {
        return isArray(this._monthsShort) ? this._monthsShort :
            this._monthsShort['standalone'];
    }
    return isArray(this._monthsShort) ? this._monthsShort[m.month()] :
        this._monthsShort[MONTHS_IN_FORMAT.test(format) ? 'format' : 'standalone'][m.month()];
}

function handleStrictParse(monthName, format, strict) {
    var i, ii, mom, llc = monthName.toLocaleLowerCase();
    if (!this._monthsParse) {
        // this is not used
        this._monthsParse = [];
        this._longMonthsParse = [];
        this._shortMonthsParse = [];
        for (i = 0; i <12; ++i) {
            mom = createUTC([2000, i]);
            this._shortMonthsParse[i] = this.monthsShort(mom, '').toLocaleLowerCase();
            this._longMonthsParse[i] = this.months(mom, '').toLocaleLowerCase();
        }
    }

    if (strict) {
        if (format === 'MMM') {
            ii = indexOf$1.call(this._shortMonthsParse, llc);
            return ii !== -1 ? ii : null;
        } else {
            ii = indexOf$1.call(this._longMonthsParse, llc);
            return ii !== -1 ? ii : null;
        }
    } else {
        if (format === 'MMM') {
            ii = indexOf$1.call(this._shortMonthsParse, llc);
            if (ii !== -1) {
                return ii;
            }
            ii = indexOf$1.call(this._longMonthsParse, llc);
            return ii !== -1 ? ii : null;
        } else {
            ii = indexOf$1.call(this._longMonthsParse, llc);
            if (ii !== -1) {
                return ii;
            }
            ii = indexOf$1.call(this._shortMonthsParse, llc);
            return ii !== -1 ? ii : null;
        }
    }
}

function localeMonthsParse (monthName, format, strict) {
    var i, mom, regex;

    if (this._monthsParseExact) {
        return handleStrictParse.call(this, monthName, format, strict);
    }

    if (!this._monthsParse) {
        this._monthsParse = [];
        this._longMonthsParse = [];
        this._shortMonthsParse = [];
    }

    // TODO: add sorting
    // Sorting makes sure if one month (or abbr) is a prefix of another
    // see sorting in computeMonthsParse
    for (i = 0; i <12; i++) {
        // make the regex if we don't have it already
        mom = createUTC([2000, i]);
        if (strict && !this._longMonthsParse[i]) {
            this._longMonthsParse[i] = new RegExp('^' + this.months(mom, '').replace('.', '') + '$', 'i');
            this._shortMonthsParse[i] = new RegExp('^' + this.monthsShort(mom, '').replace('.', '') + '$', 'i');
        }
        if (!strict && !this._monthsParse[i]) {
            regex = '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');
            this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');
        }
        // test the regex
        if (strict && format === 'MMMM' && this._longMonthsParse[i].test(monthName)) {
            return i;
        } else if (strict && format === 'MMM' && this._shortMonthsParse[i].test(monthName)) {
            return i;
        } else if (!strict && this._monthsParse[i].test(monthName)) {
            return i;
        }
    }
}

// MOMENTS

function setMonth (mom, value) {
    var dayOfMonth;

    if (!mom.isValid()) {
        // No op
        return mom;
    }

    if (typeof value === 'string') {
        if (/^\d+$/.test(value)) {
            value = toInt(value);
        } else {
            value = mom.localeData().monthsParse(value);
            // TODO: Another silent failure?
            if (!isNumber(value)) {
                return mom;
            }
        }
    }

    dayOfMonth = Math.min(mom.date(), daysInMonth(mom.year(), value));
    mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);
    return mom;
}

function getSetMonth (value) {
    if (value != null) {
        setMonth(this, value);
        hooks.updateOffset(this, true);
        return this;
    } else {
        return get(this, 'Month');
    }
}

function getDaysInMonth () {
    return daysInMonth(this.year(), this.month());
}

var defaultMonthsShortRegex = matchWord;
function monthsShortRegex (isStrict) {
    if (this._monthsParseExact) {
        if (!hasOwnProp(this, '_monthsRegex')) {
            computeMonthsParse.call(this);
        }
        if (isStrict) {
            return this._monthsShortStrictRegex;
        } else {
            return this._monthsShortRegex;
        }
    } else {
        if (!hasOwnProp(this, '_monthsShortRegex')) {
            this._monthsShortRegex = defaultMonthsShortRegex;
        }
        return this._monthsShortStrictRegex && isStrict ?
            this._monthsShortStrictRegex : this._monthsShortRegex;
    }
}

var defaultMonthsRegex = matchWord;
function monthsRegex (isStrict) {
    if (this._monthsParseExact) {
        if (!hasOwnProp(this, '_monthsRegex')) {
            computeMonthsParse.call(this);
        }
        if (isStrict) {
            return this._monthsStrictRegex;
        } else {
            return this._monthsRegex;
        }
    } else {
        if (!hasOwnProp(this, '_monthsRegex')) {
            this._monthsRegex = defaultMonthsRegex;
        }
        return this._monthsStrictRegex && isStrict ?
            this._monthsStrictRegex : this._monthsRegex;
    }
}

function computeMonthsParse () {
    function cmpLenRev(a, b) {
        return b.length - a.length;
    }

    var shortPieces = [], longPieces = [], mixedPieces = [],
        i, mom;
    for (i = 0; i <12; i++) {
        // make the regex if we don't have it already
        mom = createUTC([2000, i]);
        shortPieces.push(this.monthsShort(mom, ''));
        longPieces.push(this.months(mom, ''));
        mixedPieces.push(this.months(mom, ''));
        mixedPieces.push(this.monthsShort(mom, ''));
    }
    // Sorting makes sure if one month (or abbr) is a prefix of another it
    // will match the longer piece.
    shortPieces.sort(cmpLenRev);
    longPieces.sort(cmpLenRev);
    mixedPieces.sort(cmpLenRev);
    for (i = 0; i <12; i++) {
        shortPieces[i] = regexEscape(shortPieces[i]);
        longPieces[i] = regexEscape(longPieces[i]);
    }
    for (i = 0; i <24; i++) {
        mixedPieces[i] = regexEscape(mixedPieces[i]);
    }

    this._monthsRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
    this._monthsShortRegex = this._monthsRegex;
    this._monthsStrictRegex = new RegExp('^(' + longPieces.join('|') + ')', 'i');
    this._monthsShortStrictRegex = new RegExp('^(' + shortPieces.join('|') + ')', 'i');
}

// FORMATTING

addFormatToken('Y', 0, 0, function () {
    var y = this.year();
    return y <= 9999 ? '' + y : '+' + y;
});

addFormatToken(0, ['YY', 2], 0, function () {
    return this.year() % 100;
});

addFormatToken(0, ['YYYY',   4],       0, 'year');
addFormatToken(0, ['YYYYY',  5],       0, 'year');
addFormatToken(0, ['YYYYYY', 6, true], 0, 'year');

// ALIASES

addUnitAlias('year', 'y');

// PRIORITIES

addUnitPriority('year', 1);

// PARSING

addRegexToken('Y',      matchSigned);
addRegexToken('YY',     match1to2, match2);
addRegexToken('YYYY',   match1to4, match4);
addRegexToken('YYYYY',  match1to6, match6);
addRegexToken('YYYYYY', match1to6, match6);

addParseToken(['YYYYY', 'YYYYYY'], YEAR);
addParseToken('YYYY', function (input, array) {
    array[YEAR] = input.length === 2 ? hooks.parseTwoDigitYear(input) : toInt(input);
});
addParseToken('YY', function (input, array) {
    array[YEAR] = hooks.parseTwoDigitYear(input);
});
addParseToken('Y', function (input, array) {
    array[YEAR] = parseInt(input, 10);
});

// HELPERS

function daysInYear(year) {
    return isLeapYear(year) ? 366 : 365;
}

function isLeapYear(year) {
    return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
}

// HOOKS

hooks.parseTwoDigitYear = function (input) {
    return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);
};

// MOMENTS

var getSetYear = makeGetSet('FullYear', true);

function getIsLeapYear () {
    return isLeapYear(this.year());
}

function createDate (y, m, d, h, M, s, ms) {
    // can't just apply() to create a date:
    // https://stackoverflow.com/q/181348
    var date = new Date(y, m, d, h, M, s, ms);

    // the date constructor remaps years 0-99 to 1900-1999
    if (y <100 && y >= 0 && isFinite(date.getFullYear())) {
        date.setFullYear(y);
    }
    return date;
}

function createUTCDate (y) {
    var date = new Date(Date.UTC.apply(null, arguments));

    // the Date.UTC function remaps years 0-99 to 1900-1999
    if (y <100 && y >= 0 && isFinite(date.getUTCFullYear())) {
        date.setUTCFullYear(y);
    }
    return date;
}

// start-of-first-week - start-of-year
function firstWeekOffset(year, dow, doy) {
    var // first-week day -- which january is always in the first week (4 for iso, 1 for other)
        fwd = 7 + dow - doy,
        // first-week day local weekday -- which local weekday is fwd
        fwdlw = (7 + createUTCDate(year, 0, fwd).getUTCDay() - dow) % 7;

    return -fwdlw + fwd - 1;
}

// https://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday
function dayOfYearFromWeeks(year, week, weekday, dow, doy) {
    var localWeekday = (7 + weekday - dow) % 7,
        weekOffset = firstWeekOffset(year, dow, doy),
        dayOfYear = 1 + 7 * (week - 1) + localWeekday + weekOffset,
        resYear, resDayOfYear;

    if (dayOfYear <= 0) {
        resYear = year - 1;
        resDayOfYear = daysInYear(resYear) + dayOfYear;
    } else if (dayOfYear > daysInYear(year)) {
        resYear = year + 1;
        resDayOfYear = dayOfYear - daysInYear(year);
    } else {
        resYear = year;
        resDayOfYear = dayOfYear;
    }

    return {
        year: resYear,
        dayOfYear: resDayOfYear
    };
}

function weekOfYear(mom, dow, doy) {
    var weekOffset = firstWeekOffset(mom.year(), dow, doy),
        week = Math.floor((mom.dayOfYear() - weekOffset - 1) / 7) + 1,
        resWeek, resYear;

    if (week <1) {
        resYear = mom.year() - 1;
        resWeek = week + weeksInYear(resYear, dow, doy);
    } else if (week > weeksInYear(mom.year(), dow, doy)) {
        resWeek = week - weeksInYear(mom.year(), dow, doy);
        resYear = mom.year() + 1;
    } else {
        resYear = mom.year();
        resWeek = week;
    }

    return {
        week: resWeek,
        year: resYear
    };
}

function weeksInYear(year, dow, doy) {
    var weekOffset = firstWeekOffset(year, dow, doy),
        weekOffsetNext = firstWeekOffset(year + 1, dow, doy);
    return (daysInYear(year) - weekOffset + weekOffsetNext) / 7;
}

// FORMATTING

addFormatToken('w', ['ww', 2], 'wo', 'week');
addFormatToken('W', ['WW', 2], 'Wo', 'isoWeek');

// ALIASES

addUnitAlias('week', 'w');
addUnitAlias('isoWeek', 'W');

// PRIORITIES

addUnitPriority('week', 5);
addUnitPriority('isoWeek', 5);

// PARSING

addRegexToken('w',  match1to2);
addRegexToken('ww', match1to2, match2);
addRegexToken('W',  match1to2);
addRegexToken('WW', match1to2, match2);

addWeekParseToken(['w', 'ww', 'W', 'WW'], function (input, week, config, token) {
    week[token.substr(0, 1)] = toInt(input);
});

// HELPERS

// LOCALES

function localeWeek (mom) {
    return weekOfYear(mom, this._week.dow, this._week.doy).week;
}

var defaultLocaleWeek = {
    dow : 0, // Sunday is the first day of the week.
    doy : 6  // The week that contains Jan 1st is the first week of the year.
};

function localeFirstDayOfWeek () {
    return this._week.dow;
}

function localeFirstDayOfYear () {
    return this._week.doy;
}

// MOMENTS

function getSetWeek (input) {
    var week = this.localeData().week(this);
    return input == null ? week : this.add((input - week) * 7, 'd');
}

function getSetISOWeek (input) {
    var week = weekOfYear(this, 1, 4).week;
    return input == null ? week : this.add((input - week) * 7, 'd');
}

// FORMATTING

addFormatToken('d', 0, 'do', 'day');

addFormatToken('dd', 0, 0, function (format) {
    return this.localeData().weekdaysMin(this, format);
});

addFormatToken('ddd', 0, 0, function (format) {
    return this.localeData().weekdaysShort(this, format);
});

addFormatToken('dddd', 0, 0, function (format) {
    return this.localeData().weekdays(this, format);
});

addFormatToken('e', 0, 0, 'weekday');
addFormatToken('E', 0, 0, 'isoWeekday');

// ALIASES

addUnitAlias('day', 'd');
addUnitAlias('weekday', 'e');
addUnitAlias('isoWeekday', 'E');

// PRIORITY
addUnitPriority('day', 11);
addUnitPriority('weekday', 11);
addUnitPriority('isoWeekday', 11);

// PARSING

addRegexToken('d',    match1to2);
addRegexToken('e',    match1to2);
addRegexToken('E',    match1to2);
addRegexToken('dd',   function (isStrict, locale) {
    return locale.weekdaysMinRegex(isStrict);
});
addRegexToken('ddd',   function (isStrict, locale) {
    return locale.weekdaysShortRegex(isStrict);
});
addRegexToken('dddd',   function (isStrict, locale) {
    return locale.weekdaysRegex(isStrict);
});

addWeekParseToken(['dd', 'ddd', 'dddd'], function (input, week, config, token) {
    var weekday = config._locale.weekdaysParse(input, token, config._strict);
    // if we didn't get a weekday name, mark the date as invalid
    if (weekday != null) {
        week.d = weekday;
    } else {
        getParsingFlags(config).invalidWeekday = input;
    }
});

addWeekParseToken(['d', 'e', 'E'], function (input, week, config, token) {
    week[token] = toInt(input);
});

// HELPERS

function parseWeekday(input, locale) {
    if (typeof input !== 'string') {
        return input;
    }

    if (!isNaN(input)) {
        return parseInt(input, 10);
    }

    input = locale.weekdaysParse(input);
    if (typeof input === 'number') {
        return input;
    }

    return null;
}

function parseIsoWeekday(input, locale) {
    if (typeof input === 'string') {
        return locale.weekdaysParse(input) % 7 || 7;
    }
    return isNaN(input) ? null : input;
}

// LOCALES

var defaultLocaleWeekdays = 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_');
function localeWeekdays (m, format) {
    if (!m) {
        return isArray(this._weekdays) ? this._weekdays :
            this._weekdays['standalone'];
    }
    return isArray(this._weekdays) ? this._weekdays[m.day()] :
        this._weekdays[this._weekdays.isFormat.test(format) ? 'format' : 'standalone'][m.day()];
}

var defaultLocaleWeekdaysShort = 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_');
function localeWeekdaysShort (m) {
    return (m) ? this._weekdaysShort[m.day()] : this._weekdaysShort;
}

var defaultLocaleWeekdaysMin = 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_');
function localeWeekdaysMin (m) {
    return (m) ? this._weekdaysMin[m.day()] : this._weekdaysMin;
}

function handleStrictParse$1(weekdayName, format, strict) {
    var i, ii, mom, llc = weekdayName.toLocaleLowerCase();
    if (!this._weekdaysParse) {
        this._weekdaysParse = [];
        this._shortWeekdaysParse = [];
        this._minWeekdaysParse = [];

        for (i = 0; i <7; ++i) {
            mom = createUTC([2000, 1]).day(i);
            this._minWeekdaysParse[i] = this.weekdaysMin(mom, '').toLocaleLowerCase();
            this._shortWeekdaysParse[i] = this.weekdaysShort(mom, '').toLocaleLowerCase();
            this._weekdaysParse[i] = this.weekdays(mom, '').toLocaleLowerCase();
        }
    }

    if (strict) {
        if (format === 'dddd') {
            ii = indexOf$1.call(this._weekdaysParse, llc);
            return ii !== -1 ? ii : null;
        } else if (format === 'ddd') {
            ii = indexOf$1.call(this._shortWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
        } else {
            ii = indexOf$1.call(this._minWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
        }
    } else {
        if (format === 'dddd') {
            ii = indexOf$1.call(this._weekdaysParse, llc);
            if (ii !== -1) {
                return ii;
            }
            ii = indexOf$1.call(this._shortWeekdaysParse, llc);
            if (ii !== -1) {
                return ii;
            }
            ii = indexOf$1.call(this._minWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
        } else if (format === 'ddd') {
            ii = indexOf$1.call(this._shortWeekdaysParse, llc);
            if (ii !== -1) {
                return ii;
            }
            ii = indexOf$1.call(this._weekdaysParse, llc);
            if (ii !== -1) {
                return ii;
            }
            ii = indexOf$1.call(this._minWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
        } else {
            ii = indexOf$1.call(this._minWeekdaysParse, llc);
            if (ii !== -1) {
                return ii;
            }
            ii = indexOf$1.call(this._weekdaysParse, llc);
            if (ii !== -1) {
                return ii;
            }
            ii = indexOf$1.call(this._shortWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
        }
    }
}

function localeWeekdaysParse (weekdayName, format, strict) {
    var i, mom, regex;

    if (this._weekdaysParseExact) {
        return handleStrictParse$1.call(this, weekdayName, format, strict);
    }

    if (!this._weekdaysParse) {
        this._weekdaysParse = [];
        this._minWeekdaysParse = [];
        this._shortWeekdaysParse = [];
        this._fullWeekdaysParse = [];
    }

    for (i = 0; i <7; i++) {
        // make the regex if we don't have it already

        mom = createUTC([2000, 1]).day(i);
        if (strict && !this._fullWeekdaysParse[i]) {
            this._fullWeekdaysParse[i] = new RegExp('^' + this.weekdays(mom, '').replace('.', '\.?') + '$', 'i');
            this._shortWeekdaysParse[i] = new RegExp('^' + this.weekdaysShort(mom, '').replace('.', '\.?') + '$', 'i');
            this._minWeekdaysParse[i] = new RegExp('^' + this.weekdaysMin(mom, '').replace('.', '\.?') + '$', 'i');
        }
        if (!this._weekdaysParse[i]) {
            regex = '^' + this.weekdays(mom, '') + '|^' + this.weekdaysShort(mom, '') + '|^' + this.weekdaysMin(mom, '');
            this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');
        }
        // test the regex
        if (strict && format === 'dddd' && this._fullWeekdaysParse[i].test(weekdayName)) {
            return i;
        } else if (strict && format === 'ddd' && this._shortWeekdaysParse[i].test(weekdayName)) {
            return i;
        } else if (strict && format === 'dd' && this._minWeekdaysParse[i].test(weekdayName)) {
            return i;
        } else if (!strict && this._weekdaysParse[i].test(weekdayName)) {
            return i;
        }
    }
}

// MOMENTS

function getSetDayOfWeek (input) {
    if (!this.isValid()) {
        return input != null ? this : NaN;
    }
    var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
    if (input != null) {
        input = parseWeekday(input, this.localeData());
        return this.add(input - day, 'd');
    } else {
        return day;
    }
}

function getSetLocaleDayOfWeek (input) {
    if (!this.isValid()) {
        return input != null ? this : NaN;
    }
    var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;
    return input == null ? weekday : this.add(input - weekday, 'd');
}

function getSetISODayOfWeek (input) {
    if (!this.isValid()) {
        return input != null ? this : NaN;
    }

    // behaves the same as moment#day except
    // as a getter, returns 7 instead of 0 (1-7 range instead of 0-6)
    // as a setter, sunday should belong to the previous week.

    if (input != null) {
        var weekday = parseIsoWeekday(input, this.localeData());
        return this.day(this.day() % 7 ? weekday : weekday - 7);
    } else {
        return this.day() || 7;
    }
}

var defaultWeekdaysRegex = matchWord;
function weekdaysRegex (isStrict) {
    if (this._weekdaysParseExact) {
        if (!hasOwnProp(this, '_weekdaysRegex')) {
            computeWeekdaysParse.call(this);
        }
        if (isStrict) {
            return this._weekdaysStrictRegex;
        } else {
            return this._weekdaysRegex;
        }
    } else {
        if (!hasOwnProp(this, '_weekdaysRegex')) {
            this._weekdaysRegex = defaultWeekdaysRegex;
        }
        return this._weekdaysStrictRegex && isStrict ?
            this._weekdaysStrictRegex : this._weekdaysRegex;
    }
}

var defaultWeekdaysShortRegex = matchWord;
function weekdaysShortRegex (isStrict) {
    if (this._weekdaysParseExact) {
        if (!hasOwnProp(this, '_weekdaysRegex')) {
            computeWeekdaysParse.call(this);
        }
        if (isStrict) {
            return this._weekdaysShortStrictRegex;
        } else {
            return this._weekdaysShortRegex;
        }
    } else {
        if (!hasOwnProp(this, '_weekdaysShortRegex')) {
            this._weekdaysShortRegex = defaultWeekdaysShortRegex;
        }
        return this._weekdaysShortStrictRegex && isStrict ?
            this._weekdaysShortStrictRegex : this._weekdaysShortRegex;
    }
}

var defaultWeekdaysMinRegex = matchWord;
function weekdaysMinRegex (isStrict) {
    if (this._weekdaysParseExact) {
        if (!hasOwnProp(this, '_weekdaysRegex')) {
            computeWeekdaysParse.call(this);
        }
        if (isStrict) {
            return this._weekdaysMinStrictRegex;
        } else {
            return this._weekdaysMinRegex;
        }
    } else {
        if (!hasOwnProp(this, '_weekdaysMinRegex')) {
            this._weekdaysMinRegex = defaultWeekdaysMinRegex;
        }
        return this._weekdaysMinStrictRegex && isStrict ?
            this._weekdaysMinStrictRegex : this._weekdaysMinRegex;
    }
}


function computeWeekdaysParse () {
    function cmpLenRev(a, b) {
        return b.length - a.length;
    }

    var minPieces = [], shortPieces = [], longPieces = [], mixedPieces = [],
        i, mom, minp, shortp, longp;
    for (i = 0; i <7; i++) {
        // make the regex if we don't have it already
        mom = createUTC([2000, 1]).day(i);
        minp = this.weekdaysMin(mom, '');
        shortp = this.weekdaysShort(mom, '');
        longp = this.weekdays(mom, '');
        minPieces.push(minp);
        shortPieces.push(shortp);
        longPieces.push(longp);
        mixedPieces.push(minp);
        mixedPieces.push(shortp);
        mixedPieces.push(longp);
    }
    // Sorting makes sure if one weekday (or abbr) is a prefix of another it
    // will match the longer piece.
    minPieces.sort(cmpLenRev);
    shortPieces.sort(cmpLenRev);
    longPieces.sort(cmpLenRev);
    mixedPieces.sort(cmpLenRev);
    for (i = 0; i <7; i++) {
        shortPieces[i] = regexEscape(shortPieces[i]);
        longPieces[i] = regexEscape(longPieces[i]);
        mixedPieces[i] = regexEscape(mixedPieces[i]);
    }

    this._weekdaysRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
    this._weekdaysShortRegex = this._weekdaysRegex;
    this._weekdaysMinRegex = this._weekdaysRegex;

    this._weekdaysStrictRegex = new RegExp('^(' + longPieces.join('|') + ')', 'i');
    this._weekdaysShortStrictRegex = new RegExp('^(' + shortPieces.join('|') + ')', 'i');
    this._weekdaysMinStrictRegex = new RegExp('^(' + minPieces.join('|') + ')', 'i');
}

// FORMATTING

function hFormat() {
    return this.hours() % 12 || 12;
}

function kFormat() {
    return this.hours() || 24;
}

addFormatToken('H', ['HH', 2], 0, 'hour');
addFormatToken('h', ['hh', 2], 0, hFormat);
addFormatToken('k', ['kk', 2], 0, kFormat);

addFormatToken('hmm', 0, 0, function () {
    return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2);
});

addFormatToken('hmmss', 0, 0, function () {
    return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2) +
        zeroFill(this.seconds(), 2);
});

addFormatToken('Hmm', 0, 0, function () {
    return '' + this.hours() + zeroFill(this.minutes(), 2);
});

addFormatToken('Hmmss', 0, 0, function () {
    return '' + this.hours() + zeroFill(this.minutes(), 2) +
        zeroFill(this.seconds(), 2);
});

function meridiem (token, lowercase) {
    addFormatToken(token, 0, 0, function () {
        return this.localeData().meridiem(this.hours(), this.minutes(), lowercase);
    });
}

meridiem('a', true);
meridiem('A', false);

// ALIASES

addUnitAlias('hour', 'h');

// PRIORITY
addUnitPriority('hour', 13);

// PARSING

function matchMeridiem (isStrict, locale) {
    return locale._meridiemParse;
}

addRegexToken('a',  matchMeridiem);
addRegexToken('A',  matchMeridiem);
addRegexToken('H',  match1to2);
addRegexToken('h',  match1to2);
addRegexToken('k',  match1to2);
addRegexToken('HH', match1to2, match2);
addRegexToken('hh', match1to2, match2);
addRegexToken('kk', match1to2, match2);

addRegexToken('hmm', match3to4);
addRegexToken('hmmss', match5to6);
addRegexToken('Hmm', match3to4);
addRegexToken('Hmmss', match5to6);

addParseToken(['H', 'HH'], HOUR);
addParseToken(['k', 'kk'], function (input, array, config) {
    var kInput = toInt(input);
    array[HOUR] = kInput === 24 ? 0 : kInput;
});
addParseToken(['a', 'A'], function (input, array, config) {
    config._isPm = config._locale.isPM(input);
    config._meridiem = input;
});
addParseToken(['h', 'hh'], function (input, array, config) {
    array[HOUR] = toInt(input);
    getParsingFlags(config).bigHour = true;
});
addParseToken('hmm', function (input, array, config) {
    var pos = input.length - 2;
    array[HOUR] = toInt(input.substr(0, pos));
    array[MINUTE] = toInt(input.substr(pos));
    getParsingFlags(config).bigHour = true;
});
addParseToken('hmmss', function (input, array, config) {
    var pos1 = input.length - 4;
    var pos2 = input.length - 2;
    array[HOUR] = toInt(input.substr(0, pos1));
    array[MINUTE] = toInt(input.substr(pos1, 2));
    array[SECOND] = toInt(input.substr(pos2));
    getParsingFlags(config).bigHour = true;
});
addParseToken('Hmm', function (input, array, config) {
    var pos = input.length - 2;
    array[HOUR] = toInt(input.substr(0, pos));
    array[MINUTE] = toInt(input.substr(pos));
});
addParseToken('Hmmss', function (input, array, config) {
    var pos1 = input.length - 4;
    var pos2 = input.length - 2;
    array[HOUR] = toInt(input.substr(0, pos1));
    array[MINUTE] = toInt(input.substr(pos1, 2));
    array[SECOND] = toInt(input.substr(pos2));
});

// LOCALES

function localeIsPM (input) {
    // IE8 Quirks Mode & IE7 Standards Mode do not allow accessing strings like arrays
    // Using charAt should be more compatible.
    return ((input + '').toLowerCase().charAt(0) === 'p');
}

var defaultLocaleMeridiemParse = /[ap]\.?m?\.?/i;
function localeMeridiem (hours, minutes, isLower) {
    if (hours > 11) {
        return isLower ? 'pm' : 'PM';
    } else {
        return isLower ? 'am' : 'AM';
    }
}


// MOMENTS

// Setting the hour should keep the time, because the user explicitly
// specified which hour he wants. So trying to maintain the same hour (in
// a new timezone) makes sense. Adding/subtracting hours does not follow
// this rule.
var getSetHour = makeGetSet('Hours', true);

// months
// week
// weekdays
// meridiem
var baseConfig = {
    calendar: defaultCalendar,
    longDateFormat: defaultLongDateFormat,
    invalidDate: defaultInvalidDate,
    ordinal: defaultOrdinal,
    dayOfMonthOrdinalParse: defaultDayOfMonthOrdinalParse,
    relativeTime: defaultRelativeTime,

    months: defaultLocaleMonths,
    monthsShort: defaultLocaleMonthsShort,

    week: defaultLocaleWeek,

    weekdays: defaultLocaleWeekdays,
    weekdaysMin: defaultLocaleWeekdaysMin,
    weekdaysShort: defaultLocaleWeekdaysShort,

    meridiemParse: defaultLocaleMeridiemParse
};

// internal storage for locale config files
var locales = {};
var localeFamilies = {};
var globalLocale;

function normalizeLocale(key) {
    return key ? key.toLowerCase().replace('_', '-') : key;
}

// pick the locale from the array
// try ['en-au', 'en-gb'] as 'en-au', 'en-gb', 'en', as in move through the list trying each
// substring from most specific to least, but move to the next array item if it's a more specific variant than the current root
function chooseLocale(names) {
    var i = 0, j, next, locale, split;

    while (i <names.length) {
        split = normalizeLocale(names[i]).split('-');
        j = split.length;
        next = normalizeLocale(names[i + 1]);
        next = next ? next.split('-') : null;
        while (j > 0) {
            locale = loadLocale(split.slice(0, j).join('-'));
            if (locale) {
                return locale;
            }
            if (next && next.length >= j && compareArrays(split, next, true) >= j - 1) {
                //the next array item is better than a shallower substring of this one
                break;
            }
            j--;
        }
        i++;
    }
    return null;
}

function loadLocale(name) {
    var oldLocale = null;
    // TODO: Find a better way to register and load all the locales in Node
    if (!locales[name] && (typeof module !== 'undefined') &&
            module && module.exports) {
        try {
            oldLocale = globalLocale._abbr;
            require('./locale/' + name);
            // because defineLocale currently also sets the global locale, we
            // want to undo that for lazy loaded locales
            getSetGlobalLocale(oldLocale);
        } catch (e) { }
    }
    return locales[name];
}

// This function will load locale and then set the global locale.  If
// no arguments are passed in, it will simply return the current global
// locale key.
function getSetGlobalLocale (key, values) {
    var data;
    if (key) {
        if (isUndefined(values)) {
            data = getLocale(key);
        }
        else {
            data = defineLocale(key, values);
        }

        if (data) {
            // moment.duration._locale = moment._locale = data;
            globalLocale = data;
        }
    }

    return globalLocale._abbr;
}

function defineLocale (name, config) {
    if (config !== null) {
        var parentConfig = baseConfig;
        config.abbr = name;
        if (locales[name] != null) {
            deprecateSimple('defineLocaleOverride',
                    'use moment.updateLocale(localeName, config) to change ' +
                    'an existing locale. moment.defineLocale(localeName, ' +
                    'config) should only be used for creating a new locale ' +
                    'See http://momentjs.com/guides/#/warnings/define-locale/ for more info.');
            parentConfig = locales[name]._config;
        } else if (config.parentLocale != null) {
            if (locales[config.parentLocale] != null) {
                parentConfig = locales[config.parentLocale]._config;
            } else {
                if (!localeFamilies[config.parentLocale]) {
                    localeFamilies[config.parentLocale] = [];
                }
                localeFamilies[config.parentLocale].push({
                    name: name,
                    config: config
                });
                return null;
            }
        }
        locales[name] = new Locale(mergeConfigs(parentConfig, config));

        if (localeFamilies[name]) {
            localeFamilies[name].forEach(function (x) {
                defineLocale(x.name, x.config);
            });
        }

        // backwards compat for now: also set the locale
        // make sure we set the locale AFTER all child locales have been
        // created, so we won't end up with the child locale set.
        getSetGlobalLocale(name);


        return locales[name];
    } else {
        // useful for testing
        delete locales[name];
        return null;
    }
}

function updateLocale(name, config) {
    if (config != null) {
        var locale, parentConfig = baseConfig;
        // MERGE
        if (locales[name] != null) {
            parentConfig = locales[name]._config;
        }
        config = mergeConfigs(parentConfig, config);
        locale = new Locale(config);
        locale.parentLocale = locales[name];
        locales[name] = locale;

        // backwards compat for now: also set the locale
        getSetGlobalLocale(name);
    } else {
        // pass null for config to unupdate, useful for tests
        if (locales[name] != null) {
            if (locales[name].parentLocale != null) {
                locales[name] = locales[name].parentLocale;
            } else if (locales[name] != null) {
                delete locales[name];
            }
        }
    }
    return locales[name];
}

// returns locale data
function getLocale (key) {
    var locale;

    if (key && key._locale && key._locale._abbr) {
        key = key._locale._abbr;
    }

    if (!key) {
        return globalLocale;
    }

    if (!isArray(key)) {
        //short-circuit everything else
        locale = loadLocale(key);
        if (locale) {
            return locale;
        }
        key = [key];
    }

    return chooseLocale(key);
}

function listLocales() {
    return keys$1(locales);
}

function checkOverflow (m) {
    var overflow;
    var a = m._a;

    if (a && getParsingFlags(m).overflow === -2) {
        overflow =
            a[MONTH]       <0 || a[MONTH]       > 11  ? MONTH :
            a[DATE]        <1 || a[DATE]        > daysInMonth(a[YEAR], a[MONTH]) ? DATE :
            a[HOUR]        <0 || a[HOUR]        > 24 || (a[HOUR] === 24 && (a[MINUTE] !== 0 || a[SECOND] !== 0 || a[MILLISECOND] !== 0)) ? HOUR :
            a[MINUTE]      <0 || a[MINUTE]      > 59  ? MINUTE :
            a[SECOND]      <0 || a[SECOND]      > 59  ? SECOND :
            a[MILLISECOND] <0 || a[MILLISECOND] > 999 ? MILLISECOND :
            -1;

        if (getParsingFlags(m)._overflowDayOfYear && (overflow <YEAR || overflow > DATE)) {
            overflow = DATE;
        }
        if (getParsingFlags(m)._overflowWeeks && overflow === -1) {
            overflow = WEEK;
        }
        if (getParsingFlags(m)._overflowWeekday && overflow === -1) {
            overflow = WEEKDAY;
        }

        getParsingFlags(m).overflow = overflow;
    }

    return m;
}

// iso 8601 regex
// 0000-00-00 0000-W00 or 0000-W00-0 + T + 00 or 00:00 or 00:00:00 or 00:00:00.000 + +00:00 or +0000 or +00)
var extendedIsoRegex = /^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;
var basicIsoRegex = /^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;

var tzRegex = /Z|[+-]\d\d(?::?\d\d)?/;

var isoDates = [
    ['YYYYYY-MM-DD', /[+-]\d{6}-\d\d-\d\d/],
    ['YYYY-MM-DD', /\d{4}-\d\d-\d\d/],
    ['GGGG-[W]WW-E', /\d{4}-W\d\d-\d/],
    ['GGGG-[W]WW', /\d{4}-W\d\d/, false],
    ['YYYY-DDD', /\d{4}-\d{3}/],
    ['YYYY-MM', /\d{4}-\d\d/, false],
    ['YYYYYYMMDD', /[+-]\d{10}/],
    ['YYYYMMDD', /\d{8}/],
    // YYYYMM is NOT allowed by the standard
    ['GGGG[W]WWE', /\d{4}W\d{3}/],
    ['GGGG[W]WW', /\d{4}W\d{2}/, false],
    ['YYYYDDD', /\d{7}/]
];

// iso time formats and regexes
var isoTimes = [
    ['HH:mm:ss.SSSS', /\d\d:\d\d:\d\d\.\d+/],
    ['HH:mm:ss,SSSS', /\d\d:\d\d:\d\d,\d+/],
    ['HH:mm:ss', /\d\d:\d\d:\d\d/],
    ['HH:mm', /\d\d:\d\d/],
    ['HHmmss.SSSS', /\d\d\d\d\d\d\.\d+/],
    ['HHmmss,SSSS', /\d\d\d\d\d\d,\d+/],
    ['HHmmss', /\d\d\d\d\d\d/],
    ['HHmm', /\d\d\d\d/],
    ['HH', /\d\d/]
];

var aspNetJsonRegex = /^\/?Date\((\-?\d+)/i;

// date from iso format
function configFromISO(config) {
    var i, l,
        string = config._i,
        match = extendedIsoRegex.exec(string) || basicIsoRegex.exec(string),
        allowTime, dateFormat, timeFormat, tzFormat;

    if (match) {
        getParsingFlags(config).iso = true;

        for (i = 0, l = isoDates.length; i <l; i++) {
            if (isoDates[i][1].exec(match[1])) {
                dateFormat = isoDates[i][0];
                allowTime = isoDates[i][2] !== false;
                break;
            }
        }
        if (dateFormat == null) {
            config._isValid = false;
            return;
        }
        if (match[3]) {
            for (i = 0, l = isoTimes.length; i <l; i++) {
                if (isoTimes[i][1].exec(match[3])) {
                    // match[2] should be 'T' or space
                    timeFormat = (match[2] || ' ') + isoTimes[i][0];
                    break;
                }
            }
            if (timeFormat == null) {
                config._isValid = false;
                return;
            }
        }
        if (!allowTime && timeFormat != null) {
            config._isValid = false;
            return;
        }
        if (match[4]) {
            if (tzRegex.exec(match[4])) {
                tzFormat = 'Z';
            } else {
                config._isValid = false;
                return;
            }
        }
        config._f = dateFormat + (timeFormat || '') + (tzFormat || '');
        configFromStringAndFormat(config);
    } else {
        config._isValid = false;
    }
}

// RFC 2822 regex: For details see https://tools.ietf.org/html/rfc2822#section-3.3
var basicRfcRegex = /^((?:Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d?\d\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(?:\d\d)?\d\d\s)(\d\d:\d\d)(\:\d\d)?(\s(?:UT|GMT|[ECMP][SD]T|[A-IK-Za-ik-z]|[+-]\d{4}))$/;

// date and time from ref 2822 format
function configFromRFC2822(config) {
    var string, match, dayFormat,
        dateFormat, timeFormat, tzFormat;
    var timezones = {
        ' GMT': ' +0000',
        ' EDT': ' -0400',
        ' EST': ' -0500',
        ' CDT': ' -0500',
        ' CST': ' -0600',
        ' MDT': ' -0600',
        ' MST': ' -0700',
        ' PDT': ' -0700',
        ' PST': ' -0800'
    };
    var military = 'YXWVUTSRQPONZABCDEFGHIKLM';
    var timezone, timezoneIndex;

    string = config._i
        .replace(/\([^\)]*\)|[\n\t]/g, ' ') // Remove comments and folding whitespace
        .replace(/(\s\s+)/g, ' ') // Replace multiple-spaces with a single space
        .replace(/^\s|\s$/g, ''); // Remove leading and trailing spaces
    match = basicRfcRegex.exec(string);

    if (match) {
        dayFormat = match[1] ? 'ddd' + ((match[1].length === 5) ? ', ' : ' ') : '';
        dateFormat = 'D MMM ' + ((match[2].length > 10) ? 'YYYY ' : 'YY ');
        timeFormat = 'HH:mm' + (match[4] ? ':ss' : '');

        // TODO: Replace the vanilla JS Date object with an indepentent day-of-week check.
        if (match[1]) { // day of week given
            var momentDate = new Date(match[2]);
            var momentDay = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][momentDate.getDay()];

            if (match[1].substr(0,3) !== momentDay) {
                getParsingFlags(config).weekdayMismatch = true;
                config._isValid = false;
                return;
            }
        }

        switch (match[5].length) {
            case 2: // military
                if (timezoneIndex === 0) {
                    timezone = ' +0000';
                } else {
                    timezoneIndex = military.indexOf(match[5][1].toUpperCase()) - 12;
                    timezone = ((timezoneIndex <0) ? ' -' : ' +') +
                        (('' + timezoneIndex).replace(/^-?/, '0')).match(/..$/)[0] + '00';
                }
                break;
            case 4: // Zone
                timezone = timezones[match[5]];
                break;
            default: // UT or +/-9999
                timezone = timezones[' GMT'];
        }
        match[5] = timezone;
        config._i = match.splice(1).join('');
        tzFormat = ' ZZ';
        config._f = dayFormat + dateFormat + timeFormat + tzFormat;
        configFromStringAndFormat(config);
        getParsingFlags(config).rfc2822 = true;
    } else {
        config._isValid = false;
    }
}

// date from iso format or fallback
function configFromString(config) {
    var matched = aspNetJsonRegex.exec(config._i);

    if (matched !== null) {
        config._d = new Date(+matched[1]);
        return;
    }

    configFromISO(config);
    if (config._isValid === false) {
        delete config._isValid;
    } else {
        return;
    }

    configFromRFC2822(config);
    if (config._isValid === false) {
        delete config._isValid;
    } else {
        return;
    }

    // Final attempt, use Input Fallback
    hooks.createFromInputFallback(config);
}

hooks.createFromInputFallback = deprecate(
    'value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), ' +
    'which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are ' +
    'discouraged and will be removed in an upcoming major release. Please refer to ' +
    'http://momentjs.com/guides/#/warnings/js-date/ for more info.',
    function (config) {
        config._d = new Date(config._i + (config._useUTC ? ' UTC' : ''));
    }
);

// Pick the first defined of two or three arguments.
function defaults(a, b, c) {
    if (a != null) {
        return a;
    }
    if (b != null) {
        return b;
    }
    return c;
}

function currentDateArray(config) {
    // hooks is actually the exported moment object
    var nowValue = new Date(hooks.now());
    if (config._useUTC) {
        return [nowValue.getUTCFullYear(), nowValue.getUTCMonth(), nowValue.getUTCDate()];
    }
    return [nowValue.getFullYear(), nowValue.getMonth(), nowValue.getDate()];
}

// convert an array to a date.
// the array should mirror the parameters below
// note: all values past the year are optional and will default to the lowest possible value.
// [year, month, day , hour, minute, second, millisecond]
function configFromArray (config) {
    var i, date, input = [], currentDate, yearToUse;

    if (config._d) {
        return;
    }

    currentDate = currentDateArray(config);

    //compute day of the year from weeks and weekdays
    if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {
        dayOfYearFromWeekInfo(config);
    }

    //if the day of the year is set, figure out what it is
    if (config._dayOfYear != null) {
        yearToUse = defaults(config._a[YEAR], currentDate[YEAR]);

        if (config._dayOfYear > daysInYear(yearToUse) || config._dayOfYear === 0) {
            getParsingFlags(config)._overflowDayOfYear = true;
        }

        date = createUTCDate(yearToUse, 0, config._dayOfYear);
        config._a[MONTH] = date.getUTCMonth();
        config._a[DATE] = date.getUTCDate();
    }

    // Default to current date.
    // * if no year, month, day of month are given, default to today
    // * if day of month is given, default month and year
    // * if month is given, default only year
    // * if year is given, don't default anything
    for (i = 0; i <3 && config._a[i] == null; ++i) {
        config._a[i] = input[i] = currentDate[i];
    }

    // Zero out whatever was not defaulted, including time
    for (; i <7; i++) {
        config._a[i] = input[i] = (config._a[i] == null) ? (i === 2 ? 1 : 0) : config._a[i];
    }

    // Check for 24:00:00.000
    if (config._a[HOUR] === 24 &&
            config._a[MINUTE] === 0 &&
            config._a[SECOND] === 0 &&
            config._a[MILLISECOND] === 0) {
        config._nextDay = true;
        config._a[HOUR] = 0;
    }

    config._d = (config._useUTC ? createUTCDate : createDate).apply(null, input);
    // Apply timezone offset from input. The actual utcOffset can be changed
    // with parseZone.
    if (config._tzm != null) {
        config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);
    }

    if (config._nextDay) {
        config._a[HOUR] = 24;
    }
}

function dayOfYearFromWeekInfo(config) {
    var w, weekYear, week, weekday, dow, doy, temp, weekdayOverflow;

    w = config._w;
    if (w.GG != null || w.W != null || w.E != null) {
        dow = 1;
        doy = 4;

        // TODO: We need to take the current isoWeekYear, but that depends on
        // how we interpret now (local, utc, fixed offset). So create
        // a now version of current config (take local/utc/offset flags, and
        // create now).
        weekYear = defaults(w.GG, config._a[YEAR], weekOfYear(createLocal(), 1, 4).year);
        week = defaults(w.W, 1);
        weekday = defaults(w.E, 1);
        if (weekday <1 || weekday > 7) {
            weekdayOverflow = true;
        }
    } else {
        dow = config._locale._week.dow;
        doy = config._locale._week.doy;

        var curWeek = weekOfYear(createLocal(), dow, doy);

        weekYear = defaults(w.gg, config._a[YEAR], curWeek.year);

        // Default to current week.
        week = defaults(w.w, curWeek.week);

        if (w.d != null) {
            // weekday -- low day numbers are considered next week
            weekday = w.d;
            if (weekday <0 || weekday > 6) {
                weekdayOverflow = true;
            }
        } else if (w.e != null) {
            // local weekday -- counting starts from begining of week
            weekday = w.e + dow;
            if (w.e <0 || w.e > 6) {
                weekdayOverflow = true;
            }
        } else {
            // default to begining of week
            weekday = dow;
        }
    }
    if (week <1 || week > weeksInYear(weekYear, dow, doy)) {
        getParsingFlags(config)._overflowWeeks = true;
    } else if (weekdayOverflow != null) {
        getParsingFlags(config)._overflowWeekday = true;
    } else {
        temp = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy);
        config._a[YEAR] = temp.year;
        config._dayOfYear = temp.dayOfYear;
    }
}

// constant that refers to the ISO standard
hooks.ISO_8601 = function () {};

// constant that refers to the RFC 2822 form
hooks.RFC_2822 = function () {};

// date from string and format string
function configFromStringAndFormat(config) {
    // TODO: Move this to another part of the creation flow to prevent circular deps
    if (config._f === hooks.ISO_8601) {
        configFromISO(config);
        return;
    }
    if (config._f === hooks.RFC_2822) {
        configFromRFC2822(config);
        return;
    }
    config._a = [];
    getParsingFlags(config).empty = true;

    // This array is used to make a Date, either with `new Date` or `Date.UTC`
    var string = '' + config._i,
        i, parsedInput, tokens, token, skipped,
        stringLength = string.length,
        totalParsedInputLength = 0;

    tokens = expandFormat(config._f, config._locale).match(formattingTokens) || [];

    for (i = 0; i <tokens.length; i++) {
        token = tokens[i];
        parsedInput = (string.match(getParseRegexForToken(token, config)) || [])[0];
        // console.log('token', token, 'parsedInput', parsedInput,
        //         'regex', getParseRegexForToken(token, config));
        if (parsedInput) {
            skipped = string.substr(0, string.indexOf(parsedInput));
            if (skipped.length > 0) {
                getParsingFlags(config).unusedInput.push(skipped);
            }
            string = string.slice(string.indexOf(parsedInput) + parsedInput.length);
            totalParsedInputLength += parsedInput.length;
        }
        // don't parse if it's not a known token
        if (formatTokenFunctions[token]) {
            if (parsedInput) {
                getParsingFlags(config).empty = false;
            }
            else {
                getParsingFlags(config).unusedTokens.push(token);
            }
            addTimeToArrayFromToken(token, parsedInput, config);
        }
        else if (config._strict && !parsedInput) {
            getParsingFlags(config).unusedTokens.push(token);
        }
    }

    // add remaining unparsed input length to the string
    getParsingFlags(config).charsLeftOver = stringLength - totalParsedInputLength;
    if (string.length > 0) {
        getParsingFlags(config).unusedInput.push(string);
    }

    // clear _12h flag if hour is <= 12
    if (config._a[HOUR] <= 12 &&
        getParsingFlags(config).bigHour === true &&
        config._a[HOUR] > 0) {
        getParsingFlags(config).bigHour = undefined;
    }

    getParsingFlags(config).parsedDateParts = config._a.slice(0);
    getParsingFlags(config).meridiem = config._meridiem;
    // handle meridiem
    config._a[HOUR] = meridiemFixWrap(config._locale, config._a[HOUR], config._meridiem);

    configFromArray(config);
    checkOverflow(config);
}


function meridiemFixWrap (locale, hour, meridiem) {
    var isPm;

    if (meridiem == null) {
        // nothing to do
        return hour;
    }
    if (locale.meridiemHour != null) {
        return locale.meridiemHour(hour, meridiem);
    } else if (locale.isPM != null) {
        // Fallback
        isPm = locale.isPM(meridiem);
        if (isPm && hour <12) {
            hour += 12;
        }
        if (!isPm && hour === 12) {
            hour = 0;
        }
        return hour;
    } else {
        // this is not supposed to happen
        return hour;
    }
}

// date from string and array of format strings
function configFromStringAndArray(config) {
    var tempConfig,
        bestMoment,

        scoreToBeat,
        i,
        currentScore;

    if (config._f.length === 0) {
        getParsingFlags(config).invalidFormat = true;
        config._d = new Date(NaN);
        return;
    }

    for (i = 0; i <config._f.length; i++) {
        currentScore = 0;
        tempConfig = copyConfig({}, config);
        if (config._useUTC != null) {
            tempConfig._useUTC = config._useUTC;
        }
        tempConfig._f = config._f[i];
        configFromStringAndFormat(tempConfig);

        if (!isValid(tempConfig)) {
            continue;
        }

        // if there is any input that was not parsed add a penalty for that format
        currentScore += getParsingFlags(tempConfig).charsLeftOver;

        //or tokens
        currentScore += getParsingFlags(tempConfig).unusedTokens.length * 10;

        getParsingFlags(tempConfig).score = currentScore;

        if (scoreToBeat == null || currentScore <scoreToBeat) {
            scoreToBeat = currentScore;
            bestMoment = tempConfig;
        }
    }

    extend(config, bestMoment || tempConfig);
}

function configFromObject(config) {
    if (config._d) {
        return;
    }

    var i = normalizeObjectUnits(config._i);
    config._a = map([i.year, i.month, i.day || i.date, i.hour, i.minute, i.second, i.millisecond], function (obj) {
        return obj && parseInt(obj, 10);
    });

    configFromArray(config);
}

function createFromConfig (config) {
    var res = new Moment(checkOverflow(prepareConfig(config)));
    if (res._nextDay) {
        // Adding is smart enough around DST
        res.add(1, 'd');
        res._nextDay = undefined;
    }

    return res;
}

function prepareConfig (config) {
    var input = config._i,
        format = config._f;

    config._locale = config._locale || getLocale(config._l);

    if (input === null || (format === undefined && input === '')) {
        return createInvalid({nullInput: true});
    }

    if (typeof input === 'string') {
        config._i = input = config._locale.preparse(input);
    }

    if (isMoment(input)) {
        return new Moment(checkOverflow(input));
    } else if (isDate(input)) {
        config._d = input;
    } else if (isArray(format)) {
        configFromStringAndArray(config);
    } else if (format) {
        configFromStringAndFormat(config);
    }  else {
        configFromInput(config);
    }

    if (!isValid(config)) {
        config._d = null;
    }

    return config;
}

function configFromInput(config) {
    var input = config._i;
    if (isUndefined(input)) {
        config._d = new Date(hooks.now());
    } else if (isDate(input)) {
        config._d = new Date(input.valueOf());
    } else if (typeof input === 'string') {
        configFromString(config);
    } else if (isArray(input)) {
        config._a = map(input.slice(0), function (obj) {
            return parseInt(obj, 10);
        });
        configFromArray(config);
    } else if (isObject(input)) {
        configFromObject(config);
    } else if (isNumber(input)) {
        // from milliseconds
        config._d = new Date(input);
    } else {
        hooks.createFromInputFallback(config);
    }
}

function createLocalOrUTC (input, format, locale, strict, isUTC) {
    var c = {};

    if (locale === true || locale === false) {
        strict = locale;
        locale = undefined;
    }

    if ((isObject(input) && isObjectEmpty(input)) ||
            (isArray(input) && input.length === 0)) {
        input = undefined;
    }
    // object construction must be done this way.
    // https://github.com/moment/moment/issues/1423
    c._isAMomentObject = true;
    c._useUTC = c._isUTC = isUTC;
    c._l = locale;
    c._i = input;
    c._f = format;
    c._strict = strict;

    return createFromConfig(c);
}

function createLocal (input, format, locale, strict) {
    return createLocalOrUTC(input, format, locale, strict, false);
}

var prototypeMin = deprecate(
    'moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/',
    function () {
        var other = createLocal.apply(null, arguments);
        if (this.isValid() && other.isValid()) {
            return other <this ? this : other;
        } else {
            return createInvalid();
        }
    }
);

var prototypeMax = deprecate(
    'moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/',
    function () {
        var other = createLocal.apply(null, arguments);
        if (this.isValid() && other.isValid()) {
            return other > this ? this : other;
        } else {
            return createInvalid();
        }
    }
);

// Pick a moment m from moments so that m[fn](other) is true for all
// other. This relies on the function fn to be transitive.
//
// moments should either be an array of moment objects or an array, whose
// first element is an array of moment objects.
function pickBy(fn, moments) {
    var res, i;
    if (moments.length === 1 && isArray(moments[0])) {
        moments = moments[0];
    }
    if (!moments.length) {
        return createLocal();
    }
    res = moments[0];
    for (i = 1; i <moments.length; ++i) {
        if (!moments[i].isValid() || moments[i][fn](res)) {
            res = moments[i];
        }
    }
    return res;
}

// TODO: Use [].sort instead?
function min () {
    var args = [].slice.call(arguments, 0);

    return pickBy('isBefore', args);
}

function max () {
    var args = [].slice.call(arguments, 0);

    return pickBy('isAfter', args);
}

var now = function () {
    return Date.now ? Date.now() : +(new Date());
};

var ordering = ['year', 'quarter', 'month', 'week', 'day', 'hour', 'minute', 'second', 'millisecond'];

function isDurationValid(m) {
    for (var key in m) {
        if (!(ordering.indexOf(key) !== -1 && (m[key] == null || !isNaN(m[key])))) {
            return false;
        }
    }

    var unitHasDecimal = false;
    for (var i = 0; i <ordering.length; ++i) {
        if (m[ordering[i]]) {
            if (unitHasDecimal) {
                return false; // only allow non-integers for smallest unit
            }
            if (parseFloat(m[ordering[i]]) !== toInt(m[ordering[i]])) {
                unitHasDecimal = true;
            }
        }
    }

    return true;
}

function isValid$1() {
    return this._isValid;
}

function createInvalid$1() {
    return createDuration(NaN);
}

function Duration (duration) {
    var normalizedInput = normalizeObjectUnits(duration),
        years = normalizedInput.year || 0,
        quarters = normalizedInput.quarter || 0,
        months = normalizedInput.month || 0,
        weeks = normalizedInput.week || 0,
        days = normalizedInput.day || 0,
        hours = normalizedInput.hour || 0,
        minutes = normalizedInput.minute || 0,
        seconds = normalizedInput.second || 0,
        milliseconds = normalizedInput.millisecond || 0;

    this._isValid = isDurationValid(normalizedInput);

    // representation for dateAddRemove
    this._milliseconds = +milliseconds +
        seconds * 1e3 + // 1000
        minutes * 6e4 + // 1000 * 60
        hours * 1000 * 60 * 60; //using 1000 * 60 * 60 instead of 36e5 to avoid floating point rounding errors https://github.com/moment/moment/issues/2978
    // Because of dateAddRemove treats 24 hours as different from a
    // day when working around DST, we need to store them separately
    this._days = +days +
        weeks * 7;
    // It is impossible translate months into days without knowing
    // which months you are are talking about, so we have to store
    // it separately.
    this._months = +months +
        quarters * 3 +
        years * 12;

    this._data = {};

    this._locale = getLocale();

    this._bubble();
}

function isDuration (obj) {
    return obj instanceof Duration;
}

function absRound (number) {
    if (number <0) {
        return Math.round(-1 * number) * -1;
    } else {
        return Math.round(number);
    }
}

// FORMATTING

function offset (token, separator) {
    addFormatToken(token, 0, 0, function () {
        var offset = this.utcOffset();
        var sign = '+';
        if (offset <0) {
            offset = -offset;
            sign = '-';
        }
        return sign + zeroFill(~~(offset / 60), 2) + separator + zeroFill(~~(offset) % 60, 2);
    });
}

offset('Z', ':');
offset('ZZ', '');

// PARSING

addRegexToken('Z',  matchShortOffset);
addRegexToken('ZZ', matchShortOffset);
addParseToken(['Z', 'ZZ'], function (input, array, config) {
    config._useUTC = true;
    config._tzm = offsetFromString(matchShortOffset, input);
});

// HELPERS

// timezone chunker
// '+10:00' > ['10',  '00']
// '-1530'  > ['-15', '30']
var chunkOffset = /([\+\-]|\d\d)/gi;

function offsetFromString(matcher, string) {
    var matches = (string || '').match(matcher);

    if (matches === null) {
        return null;
    }

    var chunk   = matches[matches.length - 1] || [];
    var parts   = (chunk + '').match(chunkOffset) || ['-', 0, 0];
    var minutes = +(parts[1] * 60) + toInt(parts[2]);

    return minutes === 0 ?
      0 :
      parts[0] === '+' ? minutes : -minutes;
}

// Return a moment from input, that is local/utc/zone equivalent to model.
function cloneWithOffset(input, model) {
    var res, diff;
    if (model._isUTC) {
        res = model.clone();
        diff = (isMoment(input) || isDate(input) ? input.valueOf() : createLocal(input).valueOf()) - res.valueOf();
        // Use low-level api, because this fn is low-level api.
        res._d.setTime(res._d.valueOf() + diff);
        hooks.updateOffset(res, false);
        return res;
    } else {
        return createLocal(input).local();
    }
}

function getDateOffset (m) {
    // On Firefox.24 Date#getTimezoneOffset returns a floating point.
    // https://github.com/moment/moment/pull/1871
    return -Math.round(m._d.getTimezoneOffset() / 15) * 15;
}

// HOOKS

// This function will be called whenever a moment is mutated.
// It is intended to keep the offset in sync with the timezone.
hooks.updateOffset = function () {};

// MOMENTS

// keepLocalTime = true means only change the timezone, without
// affecting the local hour. So 5:31:26 +0300 --[utcOffset(2, true)]-->
// 5:31:26 +0200 It is possible that 5:31:26 doesn't exist with offset
// +0200, so we adjust the time as needed, to be valid.
//
// Keeping the time actually adds/subtracts (one hour)
// from the actual represented time. That is why we call updateOffset
// a second time. In case it wants us to change the offset again
// _changeInProgress == true case, then we have to adjust, because
// there is no such time in the given timezone.
function getSetOffset (input, keepLocalTime, keepMinutes) {
    var offset = this._offset || 0,
        localAdjust;
    if (!this.isValid()) {
        return input != null ? this : NaN;
    }
    if (input != null) {
        if (typeof input === 'string') {
            input = offsetFromString(matchShortOffset, input);
            if (input === null) {
                return this;
            }
        } else if (Math.abs(input) <16 && !keepMinutes) {
            input = input * 60;
        }
        if (!this._isUTC && keepLocalTime) {
            localAdjust = getDateOffset(this);
        }
        this._offset = input;
        this._isUTC = true;
        if (localAdjust != null) {
            this.add(localAdjust, 'm');
        }
        if (offset !== input) {
            if (!keepLocalTime || this._changeInProgress) {
                addSubtract(this, createDuration(input - offset, 'm'), 1, false);
            } else if (!this._changeInProgress) {
                this._changeInProgress = true;
                hooks.updateOffset(this, true);
                this._changeInProgress = null;
            }
        }
        return this;
    } else {
        return this._isUTC ? offset : getDateOffset(this);
    }
}

function getSetZone (input, keepLocalTime) {
    if (input != null) {
        if (typeof input !== 'string') {
            input = -input;
        }

        this.utcOffset(input, keepLocalTime);

        return this;
    } else {
        return -this.utcOffset();
    }
}

function setOffsetToUTC (keepLocalTime) {
    return this.utcOffset(0, keepLocalTime);
}

function setOffsetToLocal (keepLocalTime) {
    if (this._isUTC) {
        this.utcOffset(0, keepLocalTime);
        this._isUTC = false;

        if (keepLocalTime) {
            this.subtract(getDateOffset(this), 'm');
        }
    }
    return this;
}

function setOffsetToParsedOffset () {
    if (this._tzm != null) {
        this.utcOffset(this._tzm, false, true);
    } else if (typeof this._i === 'string') {
        var tZone = offsetFromString(matchOffset, this._i);
        if (tZone != null) {
            this.utcOffset(tZone);
        }
        else {
            this.utcOffset(0, true);
        }
    }
    return this;
}

function hasAlignedHourOffset (input) {
    if (!this.isValid()) {
        return false;
    }
    input = input ? createLocal(input).utcOffset() : 0;

    return (this.utcOffset() - input) % 60 === 0;
}

function isDaylightSavingTime () {
    return (
        this.utcOffset() > this.clone().month(0).utcOffset() ||
        this.utcOffset() > this.clone().month(5).utcOffset()
    );
}

function isDaylightSavingTimeShifted () {
    if (!isUndefined(this._isDSTShifted)) {
        return this._isDSTShifted;
    }

    var c = {};

    copyConfig(c, this);
    c = prepareConfig(c);

    if (c._a) {
        var other = c._isUTC ? createUTC(c._a) : createLocal(c._a);
        this._isDSTShifted = this.isValid() &&
            compareArrays(c._a, other.toArray()) > 0;
    } else {
        this._isDSTShifted = false;
    }

    return this._isDSTShifted;
}

function isLocal () {
    return this.isValid() ? !this._isUTC : false;
}

function isUtcOffset () {
    return this.isValid() ? this._isUTC : false;
}

function isUtc () {
    return this.isValid() ? this._isUTC && this._offset === 0 : false;
}

// ASP.NET json date format regex
var aspNetRegex = /^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;

// from http://docs.closure-library.googlecode.com/git/closure_goog_date_date.js.source.html
// somewhat more in line with 4.4.3.2 2004 spec, but allows decimal anywhere
// and further modified to allow for strings containing both week and day
var isoRegex = /^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;

function createDuration (input, key) {
    var duration = input,
        // matching against regexp is expensive, do it on demand
        match = null,
        sign,
        ret,
        diffRes;

    if (isDuration(input)) {
        duration = {
            ms : input._milliseconds,
            d  : input._days,
            M  : input._months
        };
    } else if (isNumber(input)) {
        duration = {};
        if (key) {
            duration[key] = input;
        } else {
            duration.milliseconds = input;
        }
    } else if (!!(match = aspNetRegex.exec(input))) {
        sign = (match[1] === '-') ? -1 : 1;
        duration = {
            y  : 0,
            d  : toInt(match[DATE])                         * sign,
            h  : toInt(match[HOUR])                         * sign,
            m  : toInt(match[MINUTE])                       * sign,
            s  : toInt(match[SECOND])                       * sign,
            ms : toInt(absRound(match[MILLISECOND] * 1000)) * sign // the millisecond decimal point is included in the match
        };
    } else if (!!(match = isoRegex.exec(input))) {
        sign = (match[1] === '-') ? -1 : 1;
        duration = {
            y : parseIso(match[2], sign),
            M : parseIso(match[3], sign),
            w : parseIso(match[4], sign),
            d : parseIso(match[5], sign),
            h : parseIso(match[6], sign),
            m : parseIso(match[7], sign),
            s : parseIso(match[8], sign)
        };
    } else if (duration == null) {// checks for null or undefined
        duration = {};
    } else if (typeof duration === 'object' && ('from' in duration || 'to' in duration)) {
        diffRes = momentsDifference(createLocal(duration.from), createLocal(duration.to));

        duration = {};
        duration.ms = diffRes.milliseconds;
        duration.M = diffRes.months;
    }

    ret = new Duration(duration);

    if (isDuration(input) && hasOwnProp(input, '_locale')) {
        ret._locale = input._locale;
    }

    return ret;
}

createDuration.fn = Duration.prototype;
createDuration.invalid = createInvalid$1;

function parseIso (inp, sign) {
    // We'd normally use ~~inp for this, but unfortunately it also
    // converts floats to ints.
    // inp may be undefined, so careful calling replace on it.
    var res = inp && parseFloat(inp.replace(',', '.'));
    // apply sign while we're at it
    return (isNaN(res) ? 0 : res) * sign;
}

function positiveMomentsDifference(base, other) {
    var res = {milliseconds: 0, months: 0};

    res.months = other.month() - base.month() +
        (other.year() - base.year()) * 12;
    if (base.clone().add(res.months, 'M').isAfter(other)) {
        --res.months;
    }

    res.milliseconds = +other - +(base.clone().add(res.months, 'M'));

    return res;
}

function momentsDifference(base, other) {
    var res;
    if (!(base.isValid() && other.isValid())) {
        return {milliseconds: 0, months: 0};
    }

    other = cloneWithOffset(other, base);
    if (base.isBefore(other)) {
        res = positiveMomentsDifference(base, other);
    } else {
        res = positiveMomentsDifference(other, base);
        res.milliseconds = -res.milliseconds;
        res.months = -res.months;
    }

    return res;
}

// TODO: remove 'name' arg after deprecation is removed
function createAdder(direction, name) {
    return function (val, period) {
        var dur, tmp;
        //invert the arguments, but complain about it
        if (period !== null && !isNaN(+period)) {
            deprecateSimple(name, 'moment().' + name  + '(period, number) is deprecated. Please use moment().' + name + '(number, period). ' +
            'See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.');
            tmp = val; val = period; period = tmp;
        }

        val = typeof val === 'string' ? +val : val;
        dur = createDuration(val, period);
        addSubtract(this, dur, direction);
        return this;
    };
}

function addSubtract (mom, duration, isAdding, updateOffset) {
    var milliseconds = duration._milliseconds,
        days = absRound(duration._days),
        months = absRound(duration._months);

    if (!mom.isValid()) {
        // No op
        return;
    }

    updateOffset = updateOffset == null ? true : updateOffset;

    if (milliseconds) {
        mom._d.setTime(mom._d.valueOf() + milliseconds * isAdding);
    }
    if (days) {
        set$1(mom, 'Date', get(mom, 'Date') + days * isAdding);
    }
    if (months) {
        setMonth(mom, get(mom, 'Month') + months * isAdding);
    }
    if (updateOffset) {
        hooks.updateOffset(mom, days || months);
    }
}

var add      = createAdder(1, 'add');
var subtract = createAdder(-1, 'subtract');

function getCalendarFormat(myMoment, now) {
    var diff = myMoment.diff(now, 'days', true);
    return diff <-6 ? 'sameElse' :
            diff <-1 ? 'lastWeek' :
            diff <0 ? 'lastDay' :
            diff <1 ? 'sameDay' :
            diff <2 ? 'nextDay' :
            diff <7 ? 'nextWeek' : 'sameElse';
}

function calendar$1 (time, formats) {
    // We want to compare the start of today, vs this.
    // Getting start-of-today depends on whether we're local/utc/offset or not.
    var now = time || createLocal(),
        sod = cloneWithOffset(now, this).startOf('day'),
        format = hooks.calendarFormat(this, sod) || 'sameElse';

    var output = formats && (isFunction(formats[format]) ? formats[format].call(this, now) : formats[format]);

    return this.format(output || this.localeData().calendar(format, this, createLocal(now)));
}

function clone () {
    return new Moment(this);
}

function isAfter (input, units) {
    var localInput = isMoment(input) ? input : createLocal(input);
    if (!(this.isValid() && localInput.isValid())) {
        return false;
    }
    units = normalizeUnits(!isUndefined(units) ? units : 'millisecond');
    if (units === 'millisecond') {
        return this.valueOf() > localInput.valueOf();
    } else {
        return localInput.valueOf() <this.clone().startOf(units).valueOf();
    }
}

function isBefore (input, units) {
    var localInput = isMoment(input) ? input : createLocal(input);
    if (!(this.isValid() && localInput.isValid())) {
        return false;
    }
    units = normalizeUnits(!isUndefined(units) ? units : 'millisecond');
    if (units === 'millisecond') {
        return this.valueOf() <localInput.valueOf();
    } else {
        return this.clone().endOf(units).valueOf() <localInput.valueOf();
    }
}

function isBetween (from, to, units, inclusivity) {
    inclusivity = inclusivity || '()';
    return (inclusivity[0] === '(' ? this.isAfter(from, units) : !this.isBefore(from, units)) &&
        (inclusivity[1] === ')' ? this.isBefore(to, units) : !this.isAfter(to, units));
}

function isSame (input, units) {
    var localInput = isMoment(input) ? input : createLocal(input),
        inputMs;
    if (!(this.isValid() && localInput.isValid())) {
        return false;
    }
    units = normalizeUnits(units || 'millisecond');
    if (units === 'millisecond') {
        return this.valueOf() === localInput.valueOf();
    } else {
        inputMs = localInput.valueOf();
        return this.clone().startOf(units).valueOf() <= inputMs && inputMs <= this.clone().endOf(units).valueOf();
    }
}

function isSameOrAfter (input, units) {
    return this.isSame(input, units) || this.isAfter(input,units);
}

function isSameOrBefore (input, units) {
    return this.isSame(input, units) || this.isBefore(input,units);
}

function diff (input, units, asFloat) {
    var that,
        zoneDelta,
        delta, output;

    if (!this.isValid()) {
        return NaN;
    }

    that = cloneWithOffset(input, this);

    if (!that.isValid()) {
        return NaN;
    }

    zoneDelta = (that.utcOffset() - this.utcOffset()) * 6e4;

    units = normalizeUnits(units);

    if (units === 'year' || units === 'month' || units === 'quarter') {
        output = monthDiff(this, that);
        if (units === 'quarter') {
            output = output / 3;
        } else if (units === 'year') {
            output = output / 12;
        }
    } else {
        delta = this - that;
        output = units === 'second' ? delta / 1e3 : // 1000
            units === 'minute' ? delta / 6e4 : // 1000 * 60
            units === 'hour' ? delta / 36e5 : // 1000 * 60 * 60
            units === 'day' ? (delta - zoneDelta) / 864e5 : // 1000 * 60 * 60 * 24, negate dst
            units === 'week' ? (delta - zoneDelta) / 6048e5 : // 1000 * 60 * 60 * 24 * 7, negate dst
            delta;
    }
    return asFloat ? output : absFloor(output);
}

function monthDiff (a, b) {
    // difference in months
    var wholeMonthDiff = ((b.year() - a.year()) * 12) + (b.month() - a.month()),
        // b is in (anchor - 1 month, anchor + 1 month)
        anchor = a.clone().add(wholeMonthDiff, 'months'),
        anchor2, adjust;

    if (b - anchor <0) {
        anchor2 = a.clone().add(wholeMonthDiff - 1, 'months');
        // linear across the month
        adjust = (b - anchor) / (anchor - anchor2);
    } else {
        anchor2 = a.clone().add(wholeMonthDiff + 1, 'months');
        // linear across the month
        adjust = (b - anchor) / (anchor2 - anchor);
    }

    //check for negative zero, return zero if negative zero
    return -(wholeMonthDiff + adjust) || 0;
}

hooks.defaultFormat = 'YYYY-MM-DDTHH:mm:ssZ';
hooks.defaultFormatUtc = 'YYYY-MM-DDTHH:mm:ss[Z]';

function toString () {
    return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');
}

function toISOString() {
    if (!this.isValid()) {
        return null;
    }
    var m = this.clone().utc();
    if (m.year() <0 || m.year() > 9999) {
        return formatMoment(m, 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
    }
    if (isFunction(Date.prototype.toISOString)) {
        // native implementation is ~50x faster, use it when we can
        return this.toDate().toISOString();
    }
    return formatMoment(m, 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
}

/**
 * Return a human readable representation of a moment that can
 * also be evaluated to get a new moment which is the same
 *
 * @link https://nodejs.org/dist/latest/docs/api/util.html#util_custom_inspect_function_on_objects
 */
function inspect () {
    if (!this.isValid()) {
        return 'moment.invalid(/* ' + this._i + ' */)';
    }
    var func = 'moment';
    var zone = '';
    if (!this.isLocal()) {
        func = this.utcOffset() === 0 ? 'moment.utc' : 'moment.parseZone';
        zone = 'Z';
    }
    var prefix = '[' + func + '("]';
    var year = (0 <= this.year() && this.year() <= 9999) ? 'YYYY' : 'YYYYYY';
    var datetime = '-MM-DD[T]HH:mm:ss.SSS';
    var suffix = zone + '[")]';

    return this.format(prefix + year + datetime + suffix);
}

function format (inputString) {
    if (!inputString) {
        inputString = this.isUtc() ? hooks.defaultFormatUtc : hooks.defaultFormat;
    }
    var output = formatMoment(this, inputString);
    return this.localeData().postformat(output);
}

function from (time, withoutSuffix) {
    if (this.isValid() &&
            ((isMoment(time) && time.isValid()) ||
             createLocal(time).isValid())) {
        return createDuration({to: this, from: time}).locale(this.locale()).humanize(!withoutSuffix);
    } else {
        return this.localeData().invalidDate();
    }
}

function fromNow (withoutSuffix) {
    return this.from(createLocal(), withoutSuffix);
}

function to (time, withoutSuffix) {
    if (this.isValid() &&
            ((isMoment(time) && time.isValid()) ||
             createLocal(time).isValid())) {
        return createDuration({from: this, to: time}).locale(this.locale()).humanize(!withoutSuffix);
    } else {
        return this.localeData().invalidDate();
    }
}

function toNow (withoutSuffix) {
    return this.to(createLocal(), withoutSuffix);
}

// If passed a locale key, it will set the locale for this
// instance.  Otherwise, it will return the locale configuration
// variables for this instance.
function locale (key) {
    var newLocaleData;

    if (key === undefined) {
        return this._locale._abbr;
    } else {
        newLocaleData = getLocale(key);
        if (newLocaleData != null) {
            this._locale = newLocaleData;
        }
        return this;
    }
}

var lang = deprecate(
    'moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.',
    function (key) {
        if (key === undefined) {
            return this.localeData();
        } else {
            return this.locale(key);
        }
    }
);

function localeData () {
    return this._locale;
}

function startOf (units) {
    units = normalizeUnits(units);
    // the following switch intentionally omits break keywords
    // to utilize falling through the cases.
    switch (units) {
        case 'year':
            this.month(0);
            /* falls through */
        case 'quarter':
        case 'month':
            this.date(1);
            /* falls through */
        case 'week':
        case 'isoWeek':
        case 'day':
        case 'date':
            this.hours(0);
            /* falls through */
        case 'hour':
            this.minutes(0);
            /* falls through */
        case 'minute':
            this.seconds(0);
            /* falls through */
        case 'second':
            this.milliseconds(0);
    }

    // weeks are a special case
    if (units === 'week') {
        this.weekday(0);
    }
    if (units === 'isoWeek') {
        this.isoWeekday(1);
    }

    // quarters are also special
    if (units === 'quarter') {
        this.month(Math.floor(this.month() / 3) * 3);
    }

    return this;
}

function endOf (units) {
    units = normalizeUnits(units);
    if (units === undefined || units === 'millisecond') {
        return this;
    }

    // 'date' is an alias for 'day', so it should be considered as such.
    if (units === 'date') {
        units = 'day';
    }

    return this.startOf(units).add(1, (units === 'isoWeek' ? 'week' : units)).subtract(1, 'ms');
}

function valueOf () {
    return this._d.valueOf() - ((this._offset || 0) * 60000);
}

function unix () {
    return Math.floor(this.valueOf() / 1000);
}

function toDate () {
    return new Date(this.valueOf());
}

function toArray () {
    var m = this;
    return [m.year(), m.month(), m.date(), m.hour(), m.minute(), m.second(), m.millisecond()];
}

function toObject () {
    var m = this;
    return {
        years: m.year(),
        months: m.month(),
        date: m.date(),
        hours: m.hours(),
        minutes: m.minutes(),
        seconds: m.seconds(),
        milliseconds: m.milliseconds()
    };
}

function toJSON () {
    // new Date(NaN).toJSON() === null
    return this.isValid() ? this.toISOString() : null;
}

function isValid$2 () {
    return isValid(this);
}

function parsingFlags () {
    return extend({}, getParsingFlags(this));
}

function invalidAt () {
    return getParsingFlags(this).overflow;
}

function creationData() {
    return {
        input: this._i,
        format: this._f,
        locale: this._locale,
        isUTC: this._isUTC,
        strict: this._strict
    };
}

// FORMATTING

addFormatToken(0, ['gg', 2], 0, function () {
    return this.weekYear() % 100;
});

addFormatToken(0, ['GG', 2], 0, function () {
    return this.isoWeekYear() % 100;
});

function addWeekYearFormatToken (token, getter) {
    addFormatToken(0, [token, token.length], 0, getter);
}

addWeekYearFormatToken('gggg',     'weekYear');
addWeekYearFormatToken('ggggg',    'weekYear');
addWeekYearFormatToken('GGGG',  'isoWeekYear');
addWeekYearFormatToken('GGGGG', 'isoWeekYear');

// ALIASES

addUnitAlias('weekYear', 'gg');
addUnitAlias('isoWeekYear', 'GG');

// PRIORITY

addUnitPriority('weekYear', 1);
addUnitPriority('isoWeekYear', 1);


// PARSING

addRegexToken('G',      matchSigned);
addRegexToken('g',      matchSigned);
addRegexToken('GG',     match1to2, match2);
addRegexToken('gg',     match1to2, match2);
addRegexToken('GGGG',   match1to4, match4);
addRegexToken('gggg',   match1to4, match4);
addRegexToken('GGGGG',  match1to6, match6);
addRegexToken('ggggg',  match1to6, match6);

addWeekParseToken(['gggg', 'ggggg', 'GGGG', 'GGGGG'], function (input, week, config, token) {
    week[token.substr(0, 2)] = toInt(input);
});

addWeekParseToken(['gg', 'GG'], function (input, week, config, token) {
    week[token] = hooks.parseTwoDigitYear(input);
});

// MOMENTS

function getSetWeekYear (input) {
    return getSetWeekYearHelper.call(this,
            input,
            this.week(),
            this.weekday(),
            this.localeData()._week.dow,
            this.localeData()._week.doy);
}

function getSetISOWeekYear (input) {
    return getSetWeekYearHelper.call(this,
            input, this.isoWeek(), this.isoWeekday(), 1, 4);
}

function getISOWeeksInYear () {
    return weeksInYear(this.year(), 1, 4);
}

function getWeeksInYear () {
    var weekInfo = this.localeData()._week;
    return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);
}

function getSetWeekYearHelper(input, week, weekday, dow, doy) {
    var weeksTarget;
    if (input == null) {
        return weekOfYear(this, dow, doy).year;
    } else {
        weeksTarget = weeksInYear(input, dow, doy);
        if (week > weeksTarget) {
            week = weeksTarget;
        }
        return setWeekAll.call(this, input, week, weekday, dow, doy);
    }
}

function setWeekAll(weekYear, week, weekday, dow, doy) {
    var dayOfYearData = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy),
        date = createUTCDate(dayOfYearData.year, 0, dayOfYearData.dayOfYear);

    this.year(date.getUTCFullYear());
    this.month(date.getUTCMonth());
    this.date(date.getUTCDate());
    return this;
}

// FORMATTING

addFormatToken('Q', 0, 'Qo', 'quarter');

// ALIASES

addUnitAlias('quarter', 'Q');

// PRIORITY

addUnitPriority('quarter', 7);

// PARSING

addRegexToken('Q', match1);
addParseToken('Q', function (input, array) {
    array[MONTH] = (toInt(input) - 1) * 3;
});

// MOMENTS

function getSetQuarter (input) {
    return input == null ? Math.ceil((this.month() + 1) / 3) : this.month((input - 1) * 3 + this.month() % 3);
}

// FORMATTING

addFormatToken('D', ['DD', 2], 'Do', 'date');

// ALIASES

addUnitAlias('date', 'D');

// PRIOROITY
addUnitPriority('date', 9);

// PARSING

addRegexToken('D',  match1to2);
addRegexToken('DD', match1to2, match2);
addRegexToken('Do', function (isStrict, locale) {
    // TODO: Remove "ordinalParse" fallback in next major release.
    return isStrict ?
      (locale._dayOfMonthOrdinalParse || locale._ordinalParse) :
      locale._dayOfMonthOrdinalParseLenient;
});

addParseToken(['D', 'DD'], DATE);
addParseToken('Do', function (input, array) {
    array[DATE] = toInt(input.match(match1to2)[0], 10);
});

// MOMENTS

var getSetDayOfMonth = makeGetSet('Date', true);

// FORMATTING

addFormatToken('DDD', ['DDDD', 3], 'DDDo', 'dayOfYear');

// ALIASES

addUnitAlias('dayOfYear', 'DDD');

// PRIORITY
addUnitPriority('dayOfYear', 4);

// PARSING

addRegexToken('DDD',  match1to3);
addRegexToken('DDDD', match3);
addParseToken(['DDD', 'DDDD'], function (input, array, config) {
    config._dayOfYear = toInt(input);
});

// HELPERS

// MOMENTS

function getSetDayOfYear (input) {
    var dayOfYear = Math.round((this.clone().startOf('day') - this.clone().startOf('year')) / 864e5) + 1;
    return input == null ? dayOfYear : this.add((input - dayOfYear), 'd');
}

// FORMATTING

addFormatToken('m', ['mm', 2], 0, 'minute');

// ALIASES

addUnitAlias('minute', 'm');

// PRIORITY

addUnitPriority('minute', 14);

// PARSING

addRegexToken('m',  match1to2);
addRegexToken('mm', match1to2, match2);
addParseToken(['m', 'mm'], MINUTE);

// MOMENTS

var getSetMinute = makeGetSet('Minutes', false);

// FORMATTING

addFormatToken('s', ['ss', 2], 0, 'second');

// ALIASES

addUnitAlias('second', 's');

// PRIORITY

addUnitPriority('second', 15);

// PARSING

addRegexToken('s',  match1to2);
addRegexToken('ss', match1to2, match2);
addParseToken(['s', 'ss'], SECOND);

// MOMENTS

var getSetSecond = makeGetSet('Seconds', false);

// FORMATTING

addFormatToken('S', 0, 0, function () {
    return ~~(this.millisecond() / 100);
});

addFormatToken(0, ['SS', 2], 0, function () {
    return ~~(this.millisecond() / 10);
});

addFormatToken(0, ['SSS', 3], 0, 'millisecond');
addFormatToken(0, ['SSSS', 4], 0, function () {
    return this.millisecond() * 10;
});
addFormatToken(0, ['SSSSS', 5], 0, function () {
    return this.millisecond() * 100;
});
addFormatToken(0, ['SSSSSS', 6], 0, function () {
    return this.millisecond() * 1000;
});
addFormatToken(0, ['SSSSSSS', 7], 0, function () {
    return this.millisecond() * 10000;
});
addFormatToken(0, ['SSSSSSSS', 8], 0, function () {
    return this.millisecond() * 100000;
});
addFormatToken(0, ['SSSSSSSSS', 9], 0, function () {
    return this.millisecond() * 1000000;
});


// ALIASES

addUnitAlias('millisecond', 'ms');

// PRIORITY

addUnitPriority('millisecond', 16);

// PARSING

addRegexToken('S',    match1to3, match1);
addRegexToken('SS',   match1to3, match2);
addRegexToken('SSS',  match1to3, match3);

var token;
for (token = 'SSSS'; token.length <= 9; token += 'S') {
    addRegexToken(token, matchUnsigned);
}

function parseMs(input, array) {
    array[MILLISECOND] = toInt(('0.' + input) * 1000);
}

for (token = 'S'; token.length <= 9; token += 'S') {
    addParseToken(token, parseMs);
}
// MOMENTS

var getSetMillisecond = makeGetSet('Milliseconds', false);

// FORMATTING

addFormatToken('z',  0, 0, 'zoneAbbr');
addFormatToken('zz', 0, 0, 'zoneName');

// MOMENTS

function getZoneAbbr () {
    return this._isUTC ? 'UTC' : '';
}

function getZoneName () {
    return this._isUTC ? 'Coordinated Universal Time' : '';
}

var proto = Moment.prototype;

proto.add               = add;
proto.calendar          = calendar$1;
proto.clone             = clone;
proto.diff              = diff;
proto.endOf             = endOf;
proto.format            = format;
proto.from              = from;
proto.fromNow           = fromNow;
proto.to                = to;
proto.toNow             = toNow;
proto.get               = stringGet;
proto.invalidAt         = invalidAt;
proto.isAfter           = isAfter;
proto.isBefore          = isBefore;
proto.isBetween         = isBetween;
proto.isSame            = isSame;
proto.isSameOrAfter     = isSameOrAfter;
proto.isSameOrBefore    = isSameOrBefore;
proto.isValid           = isValid$2;
proto.lang              = lang;
proto.locale            = locale;
proto.localeData        = localeData;
proto.max               = prototypeMax;
proto.min               = prototypeMin;
proto.parsingFlags      = parsingFlags;
proto.set               = stringSet;
proto.startOf           = startOf;
proto.subtract          = subtract;
proto.toArray           = toArray;
proto.toObject          = toObject;
proto.toDate            = toDate;
proto.toISOString       = toISOString;
proto.inspect           = inspect;
proto.toJSON            = toJSON;
proto.toString          = toString;
proto.unix              = unix;
proto.valueOf           = valueOf;
proto.creationData      = creationData;

// Year
proto.year       = getSetYear;
proto.isLeapYear = getIsLeapYear;

// Week Year
proto.weekYear    = getSetWeekYear;
proto.isoWeekYear = getSetISOWeekYear;

// Quarter
proto.quarter = proto.quarters = getSetQuarter;

// Month
proto.month       = getSetMonth;
proto.daysInMonth = getDaysInMonth;

// Week
proto.week           = proto.weeks        = getSetWeek;
proto.isoWeek        = proto.isoWeeks     = getSetISOWeek;
proto.weeksInYear    = getWeeksInYear;
proto.isoWeeksInYear = getISOWeeksInYear;

// Day
proto.date       = getSetDayOfMonth;
proto.day        = proto.days             = getSetDayOfWeek;
proto.weekday    = getSetLocaleDayOfWeek;
proto.isoWeekday = getSetISODayOfWeek;
proto.dayOfYear  = getSetDayOfYear;

// Hour
proto.hour = proto.hours = getSetHour;

// Minute
proto.minute = proto.minutes = getSetMinute;

// Second
proto.second = proto.seconds = getSetSecond;

// Millisecond
proto.millisecond = proto.milliseconds = getSetMillisecond;

// Offset
proto.utcOffset            = getSetOffset;
proto.utc                  = setOffsetToUTC;
proto.local                = setOffsetToLocal;
proto.parseZone            = setOffsetToParsedOffset;
proto.hasAlignedHourOffset = hasAlignedHourOffset;
proto.isDST                = isDaylightSavingTime;
proto.isLocal              = isLocal;
proto.isUtcOffset          = isUtcOffset;
proto.isUtc                = isUtc;
proto.isUTC                = isUtc;

// Timezone
proto.zoneAbbr = getZoneAbbr;
proto.zoneName = getZoneName;

// Deprecations
proto.dates  = deprecate('dates accessor is deprecated. Use date instead.', getSetDayOfMonth);
proto.months = deprecate('months accessor is deprecated. Use month instead', getSetMonth);
proto.years  = deprecate('years accessor is deprecated. Use year instead', getSetYear);
proto.zone   = deprecate('moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/', getSetZone);
proto.isDSTShifted = deprecate('isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information', isDaylightSavingTimeShifted);

function createUnix (input) {
    return createLocal(input * 1000);
}

function createInZone () {
    return createLocal.apply(null, arguments).parseZone();
}

function preParsePostFormat (string) {
    return string;
}

var proto$1 = Locale.prototype;

proto$1.calendar        = calendar;
proto$1.longDateFormat  = longDateFormat;
proto$1.invalidDate     = invalidDate;
proto$1.ordinal         = ordinal;
proto$1.preparse        = preParsePostFormat;
proto$1.postformat      = preParsePostFormat;
proto$1.relativeTime    = relativeTime;
proto$1.pastFuture      = pastFuture;
proto$1.set             = set;

// Month
proto$1.months            =        localeMonths;
proto$1.monthsShort       =        localeMonthsShort;
proto$1.monthsParse       =        localeMonthsParse;
proto$1.monthsRegex       = monthsRegex;
proto$1.monthsShortRegex  = monthsShortRegex;

// Week
proto$1.week = localeWeek;
proto$1.firstDayOfYear = localeFirstDayOfYear;
proto$1.firstDayOfWeek = localeFirstDayOfWeek;

// Day of Week
proto$1.weekdays       =        localeWeekdays;
proto$1.weekdaysMin    =        localeWeekdaysMin;
proto$1.weekdaysShort  =        localeWeekdaysShort;
proto$1.weekdaysParse  =        localeWeekdaysParse;

proto$1.weekdaysRegex       =        weekdaysRegex;
proto$1.weekdaysShortRegex  =        weekdaysShortRegex;
proto$1.weekdaysMinRegex    =        weekdaysMinRegex;

// Hours
proto$1.isPM = localeIsPM;
proto$1.meridiem = localeMeridiem;

function get$1 (format, index, field, setter) {
    var locale = getLocale();
    var utc = createUTC().set(setter, index);
    return locale[field](utc, format);
}

function listMonthsImpl (format, index, field) {
    if (isNumber(format)) {
        index = format;
        format = undefined;
    }

    format = format || '';

    if (index != null) {
        return get$1(format, index, field, 'month');
    }

    var i;
    var out = [];
    for (i = 0; i <12; i++) {
        out[i] = get$1(format, i, field, 'month');
    }
    return out;
}

// ()
// (5)
// (fmt, 5)
// (fmt)
// (true)
// (true, 5)
// (true, fmt, 5)
// (true, fmt)
function listWeekdaysImpl (localeSorted, format, index, field) {
    if (typeof localeSorted === 'boolean') {
        if (isNumber(format)) {
            index = format;
            format = undefined;
        }

        format = format || '';
    } else {
        format = localeSorted;
        index = format;
        localeSorted = false;

        if (isNumber(format)) {
            index = format;
            format = undefined;
        }

        format = format || '';
    }

    var locale = getLocale(),
        shift = localeSorted ? locale._week.dow : 0;

    if (index != null) {
        return get$1(format, (index + shift) % 7, field, 'day');
    }

    var i;
    var out = [];
    for (i = 0; i <7; i++) {
        out[i] = get$1(format, (i + shift) % 7, field, 'day');
    }
    return out;
}

function listMonths (format, index) {
    return listMonthsImpl(format, index, 'months');
}

function listMonthsShort (format, index) {
    return listMonthsImpl(format, index, 'monthsShort');
}

function listWeekdays (localeSorted, format, index) {
    return listWeekdaysImpl(localeSorted, format, index, 'weekdays');
}

function listWeekdaysShort (localeSorted, format, index) {
    return listWeekdaysImpl(localeSorted, format, index, 'weekdaysShort');
}

function listWeekdaysMin (localeSorted, format, index) {
    return listWeekdaysImpl(localeSorted, format, index, 'weekdaysMin');
}

getSetGlobalLocale('en', {
    dayOfMonthOrdinalParse: /\d{1,2}(th|st|nd|rd)/,
    ordinal : function (number) {
        var b = number % 10,
            output = (toInt(number % 100 / 10) === 1) ? 'th' :
            (b === 1) ? 'st' :
            (b === 2) ? 'nd' :
            (b === 3) ? 'rd' : 'th';
        return number + output;
    }
});

// Side effect imports
hooks.lang = deprecate('moment.lang is deprecated. Use moment.locale instead.', getSetGlobalLocale);
hooks.langData = deprecate('moment.langData is deprecated. Use moment.localeData instead.', getLocale);

var mathAbs = Math.abs;

function abs () {
    var data           = this._data;

    this._milliseconds = mathAbs(this._milliseconds);
    this._days         = mathAbs(this._days);
    this._months       = mathAbs(this._months);

    data.milliseconds  = mathAbs(data.milliseconds);
    data.seconds       = mathAbs(data.seconds);
    data.minutes       = mathAbs(data.minutes);
    data.hours         = mathAbs(data.hours);
    data.months        = mathAbs(data.months);
    data.years         = mathAbs(data.years);

    return this;
}

function addSubtract$1 (duration, input, value, direction) {
    var other = createDuration(input, value);

    duration._milliseconds += direction * other._milliseconds;
    duration._days         += direction * other._days;
    duration._months       += direction * other._months;

    return duration._bubble();
}

// supports only 2.0-style add(1, 's') or add(duration)
function add$1 (input, value) {
    return addSubtract$1(this, input, value, 1);
}

// supports only 2.0-style subtract(1, 's') or subtract(duration)
function subtract$1 (input, value) {
    return addSubtract$1(this, input, value, -1);
}

function absCeil (number) {
    if (number <0) {
        return Math.floor(number);
    } else {
        return Math.ceil(number);
    }
}

function bubble () {
    var milliseconds = this._milliseconds;
    var days         = this._days;
    var months       = this._months;
    var data         = this._data;
    var seconds, minutes, hours, years, monthsFromDays;

    // if we have a mix of positive and negative values, bubble down first
    // check: https://github.com/moment/moment/issues/2166
    if (!((milliseconds >= 0 && days >= 0 && months >= 0) ||
            (milliseconds <= 0 && days <= 0 && months <= 0))) {
        milliseconds += absCeil(monthsToDays(months) + days) * 864e5;
        days = 0;
        months = 0;
    }

    // The following code bubbles up values, see the tests for
    // examples of what that means.
    data.milliseconds = milliseconds % 1000;

    seconds           = absFloor(milliseconds / 1000);
    data.seconds      = seconds % 60;

    minutes           = absFloor(seconds / 60);
    data.minutes      = minutes % 60;

    hours             = absFloor(minutes / 60);
    data.hours        = hours % 24;

    days += absFloor(hours / 24);

    // convert days to months
    monthsFromDays = absFloor(daysToMonths(days));
    months += monthsFromDays;
    days -= absCeil(monthsToDays(monthsFromDays));

    // 12 months -> 1 year
    years = absFloor(months / 12);
    months %= 12;

    data.days   = days;
    data.months = months;
    data.years  = years;

    return this;
}

function daysToMonths (days) {
    // 400 years have 146097 days (taking into account leap year rules)
    // 400 years have 12 months === 4800
    return days * 4800 / 146097;
}

function monthsToDays (months) {
    // the reverse of daysToMonths
    return months * 146097 / 4800;
}

function as (units) {
    if (!this.isValid()) {
        return NaN;
    }
    var days;
    var months;
    var milliseconds = this._milliseconds;

    units = normalizeUnits(units);

    if (units === 'month' || units === 'year') {
        days   = this._days   + milliseconds / 864e5;
        months = this._months + daysToMonths(days);
        return units === 'month' ? months : months / 12;
    } else {
        // handle milliseconds separately because of floating point math errors (issue #1867)
        days = this._days + Math.round(monthsToDays(this._months));
        switch (units) {
            case 'week'   : return days / 7     + milliseconds / 6048e5;
            case 'day'    : return days         + milliseconds / 864e5;
            case 'hour'   : return days * 24    + milliseconds / 36e5;
            case 'minute' : return days * 1440  + milliseconds / 6e4;
            case 'second' : return days * 86400 + milliseconds / 1000;
            // Math.floor prevents floating point math errors here
            case 'millisecond': return Math.floor(days * 864e5) + milliseconds;
            default: throw new Error('Unknown unit ' + units);
        }
    }
}

// TODO: Use this.as('ms')?
function valueOf$1 () {
    if (!this.isValid()) {
        return NaN;
    }
    return (
        this._milliseconds +
        this._days * 864e5 +
        (this._months % 12) * 2592e6 +
        toInt(this._months / 12) * 31536e6
    );
}

function makeAs (alias) {
    return function () {
        return this.as(alias);
    };
}

var asMilliseconds = makeAs('ms');
var asSeconds      = makeAs('s');
var asMinutes      = makeAs('m');
var asHours        = makeAs('h');
var asDays         = makeAs('d');
var asWeeks        = makeAs('w');
var asMonths       = makeAs('M');
var asYears        = makeAs('y');

function get$2 (units) {
    units = normalizeUnits(units);
    return this.isValid() ? this[units + 's']() : NaN;
}

function makeGetter(name) {
    return function () {
        return this.isValid() ? this._data[name] : NaN;
    };
}

var milliseconds = makeGetter('milliseconds');
var seconds      = makeGetter('seconds');
var minutes      = makeGetter('minutes');
var hours        = makeGetter('hours');
var days         = makeGetter('days');
var months       = makeGetter('months');
var years        = makeGetter('years');

function weeks () {
    return absFloor(this.days() / 7);
}

var round = Math.round;
var thresholds = {
    ss: 44,         // a few seconds to seconds
    s : 45,         // seconds to minute
    m : 45,         // minutes to hour
    h : 22,         // hours to day
    d : 26,         // days to month
    M : 11          // months to year
};

// helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize
function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {
    return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture);
}

function relativeTime$1 (posNegDuration, withoutSuffix, locale) {
    var duration = createDuration(posNegDuration).abs();
    var seconds  = round(duration.as('s'));
    var minutes  = round(duration.as('m'));
    var hours    = round(duration.as('h'));
    var days     = round(duration.as('d'));
    var months   = round(duration.as('M'));
    var years    = round(duration.as('y'));

    var a = seconds <= thresholds.ss && ['s', seconds]  ||
            seconds <thresholds.s   && ['ss', seconds] ||
            minutes <= 1             && ['m']           ||
            minutes <thresholds.m   && ['mm', minutes] ||
            hours   <= 1             && ['h']           ||
            hours   <thresholds.h   && ['hh', hours]   ||
            days    <= 1             && ['d']           ||
            days    <thresholds.d   && ['dd', days]    ||
            months  <= 1             && ['M']           ||
            months  <thresholds.M   && ['MM', months]  ||
            years   <= 1             && ['y']           || ['yy', years];

    a[2] = withoutSuffix;
    a[3] = +posNegDuration > 0;
    a[4] = locale;
    return substituteTimeAgo.apply(null, a);
}

// This function allows you to set the rounding function for relative time strings
function getSetRelativeTimeRounding (roundingFunction) {
    if (roundingFunction === undefined) {
        return round;
    }
    if (typeof(roundingFunction) === 'function') {
        round = roundingFunction;
        return true;
    }
    return false;
}

// This function allows you to set a threshold for relative time strings
function getSetRelativeTimeThreshold (threshold, limit) {
    if (thresholds[threshold] === undefined) {
        return false;
    }
    if (limit === undefined) {
        return thresholds[threshold];
    }
    thresholds[threshold] = limit;
    if (threshold === 's') {
        thresholds.ss = limit - 1;
    }
    return true;
}

function humanize (withSuffix) {
    if (!this.isValid()) {
        return this.localeData().invalidDate();
    }

    var locale = this.localeData();
    var output = relativeTime$1(this, !withSuffix, locale);

    if (withSuffix) {
        output = locale.pastFuture(+this, output);
    }

    return locale.postformat(output);
}

var abs$1 = Math.abs;

function toISOString$1() {
    // for ISO strings we do not use the normal bubbling rules:
    //  * milliseconds bubble up until they become hours
    //  * days do not bubble at all
    //  * months bubble up until they become years
    // This is because there is no context-free conversion between hours and days
    // (think of clock changes)
    // and also not between days and months (28-31 days per month)
    if (!this.isValid()) {
        return this.localeData().invalidDate();
    }

    var seconds = abs$1(this._milliseconds) / 1000;
    var days         = abs$1(this._days);
    var months       = abs$1(this._months);
    var minutes, hours, years;

    // 3600 seconds -> 60 minutes -> 1 hour
    minutes           = absFloor(seconds / 60);
    hours             = absFloor(minutes / 60);
    seconds %= 60;
    minutes %= 60;

    // 12 months -> 1 year
    years  = absFloor(months / 12);
    months %= 12;


    // inspired by https://github.com/dordille/moment-isoduration/blob/master/moment.isoduration.js
    var Y = years;
    var M = months;
    var D = days;
    var h = hours;
    var m = minutes;
    var s = seconds;
    var total = this.asSeconds();

    if (!total) {
        // this is the same as C#'s (Noda) and python (isodate)...
        // but not other JS (goog.date)
        return 'P0D';
    }

    return (total <0 ? '-' : '') +
        'P' +
        (Y ? Y + 'Y' : '') +
        (M ? M + 'M' : '') +
        (D ? D + 'D' : '') +
        ((h || m || s) ? 'T' : '') +
        (h ? h + 'H' : '') +
        (m ? m + 'M' : '') +
        (s ? s + 'S' : '');
}

var proto$2 = Duration.prototype;

proto$2.isValid        = isValid$1;
proto$2.abs            = abs;
proto$2.add            = add$1;
proto$2.subtract       = subtract$1;
proto$2.as             = as;
proto$2.asMilliseconds = asMilliseconds;
proto$2.asSeconds      = asSeconds;
proto$2.asMinutes      = asMinutes;
proto$2.asHours        = asHours;
proto$2.asDays         = asDays;
proto$2.asWeeks        = asWeeks;
proto$2.asMonths       = asMonths;
proto$2.asYears        = asYears;
proto$2.valueOf        = valueOf$1;
proto$2._bubble        = bubble;
proto$2.get            = get$2;
proto$2.milliseconds   = milliseconds;
proto$2.seconds        = seconds;
proto$2.minutes        = minutes;
proto$2.hours          = hours;
proto$2.days           = days;
proto$2.weeks          = weeks;
proto$2.months         = months;
proto$2.years          = years;
proto$2.humanize       = humanize;
proto$2.toISOString    = toISOString$1;
proto$2.toString       = toISOString$1;
proto$2.toJSON         = toISOString$1;
proto$2.locale         = locale;
proto$2.localeData     = localeData;

// Deprecations
proto$2.toIsoString = deprecate('toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)', toISOString$1);
proto$2.lang = lang;

// Side effect imports

// FORMATTING

addFormatToken('X', 0, 0, 'unix');
addFormatToken('x', 0, 0, 'valueOf');

// PARSING

addRegexToken('x', matchSigned);
addRegexToken('X', matchTimestamp);
addParseToken('X', function (input, array, config) {
    config._d = new Date(parseFloat(input, 10) * 1000);
});
addParseToken('x', function (input, array, config) {
    config._d = new Date(toInt(input));
});

// Side effect imports


hooks.version = '2.18.1';

setHookCallback(createLocal);

hooks.fn                    = proto;
hooks.min                   = min;
hooks.max                   = max;
hooks.now                   = now;
hooks.utc                   = createUTC;
hooks.unix                  = createUnix;
hooks.months                = listMonths;
hooks.isDate                = isDate;
hooks.locale                = getSetGlobalLocale;
hooks.invalid               = createInvalid;
hooks.duration              = createDuration;
hooks.isMoment              = isMoment;
hooks.weekdays              = listWeekdays;
hooks.parseZone             = createInZone;
hooks.localeData            = getLocale;
hooks.isDuration            = isDuration;
hooks.monthsShort           = listMonthsShort;
hooks.weekdaysMin           = listWeekdaysMin;
hooks.defineLocale          = defineLocale;
hooks.updateLocale          = updateLocale;
hooks.locales               = listLocales;
hooks.weekdaysShort         = listWeekdaysShort;
hooks.normalizeUnits        = normalizeUnits;
hooks.relativeTimeRounding = getSetRelativeTimeRounding;
hooks.relativeTimeThreshold = getSetRelativeTimeThreshold;
hooks.calendarFormat        = getCalendarFormat;
hooks.prototype             = proto;

return hooks;

})));
;

(function($,sr){
  _Prtg = _Prtg || {};
  // debouncing function from John Hann
  // http://unscriptable.com/index.php/2009/03/20/debouncing-javascript-methods/
  _Prtg.debounce = function debounce(func, threshhold, execAsap, stoppropagation) {
      var timeout;

      return function _debounced (e) {
          var obj = this
          	, args = arguments;
          function delayed () {
              timeout = null;
              func.apply(obj, args);
          }
          if (execAsap)
            func.apply(obj, args);
          else{
	          clearTimeout(timeout);
          	if(stoppropagation)
							e.stopImmediatePropagation();
						timeout = setTimeout(delayed, threshhold || 100);
          }
      };
  };
  // smartresize
  jQuery.fn[sr] = function(fn){  return fn ? this.bind('resize', _Prtg.debounce(fn)) : this.trigger(sr); };

  // from Remy Sharp
  // https://remysharp.com/2010/07/21/throttling-function-calls
  _Prtg.throttle = function throttle(fn, threshhold, scope) {
  threshhold || (threshhold = 250);
  var last,
      deferTimer;
  return function throttle() {
    var context = scope || this;

    var now = +new Date,
        args = arguments;
    if (last && now < last + threshhold) {
      // hold on to it
      clearTimeout(deferTimer);
      deferTimer = setTimeout(function () {
        last = now;
        fn.apply(context, args);
      }, threshhold);
    } else {
      last = now;
      fn.apply(context, args);
    }
  };
}

})(jQuery,'debounce');
;
/*!
 * Farbtastic: jQuery color picker plug-in v1.3u
 *
 * Licensed under the GPL license:
 *   http://www.gnu.org/licenses/gpl.html
 */
(function($) {

$.fn.farbtastic = function (options) {
  $.farbtastic(this, options);
  return this;
};

$.farbtastic = function (container, callback) {
  var container = $(container).get(0);
  return container.farbtastic || (container.farbtastic = new $._farbtastic(container, callback));
};

$._farbtastic = function (container, callback) {
  // Store farbtastic object
  var fb = this;

  // Insert markup
  $(container).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');
  var e = $('.farbtastic', container);
  fb.wheel = $('.wheel', container).get(0);
  // Dimensions
  fb.radius = 84;
  fb.square = 100;
  fb.width = 194;

  // Fix background PNGs in IE6
  if (navigator.appVersion.match(/MSIE [0-6]\./)) {
    $('*', e).each(function () {
      if (this.currentStyle.backgroundImage != 'none') {
        var image = this.currentStyle.backgroundImage;
        image = this.currentStyle.backgroundImage.substring(5, image.length - 2);
        $(this).css({
          'backgroundImage': 'none',
          'filter': "progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='" + image + "')"
        });
      }
    });
  }

  /**
   * Link to the given element(s) or callback.
   */
  fb.linkTo = function (callback) {
    // Unbind previous nodes
    if (typeof fb.callback == 'object') {
      $(fb.callback).unbind('keyup', fb.updateValue);
    }

    // Reset color
    fb.color = null;

    // Bind callback or elements
    if (typeof callback == 'function') {
      fb.callback = callback;
    }
    else if (typeof callback == 'object' || typeof callback == 'string') {
      fb.callback = $(callback);
      fb.callback.bind('keyup', fb.updateValue);
      if (fb.callback.get(0).value) {
        fb.setColor(fb.callback.get(0).value);
      }
    }
    return this;
  };
  fb.updateValue = function (event) {
    if (this.value && this.value != fb.color) {
      fb.setColor(this.value);
    }
  };

  /**
   * Change color with HTML syntax #123456
   */
  fb.setColor = function (color) {
    var unpack = fb.unpack(color);
    if (fb.color != color && unpack) {
      fb.color = color;
      fb.rgb = unpack;
      fb.hsl = fb.RGBToHSL(fb.rgb);
      fb.updateDisplay();
    }
    return this;
  };

  /**
   * Change color with HSL triplet [0..1, 0..1, 0..1]
   */
  fb.setHSL = function (hsl) {
    fb.hsl = hsl;
    fb.rgb = fb.HSLToRGB(hsl);
    fb.color = fb.pack(fb.rgb);
    fb.updateDisplay();
    return this;
  };

  /////////////////////////////////////////////////////

  /**
   * Retrieve the coordinates of the given event relative to the center
   * of the widget.
   */
  fb.widgetCoords = function (event) {
    var offset = $(fb.wheel).offset();
    return { x: (event.pageX - offset.left) - fb.width / 2, y: (event.pageY - offset.top) - fb.width / 2 };
  };

  /**
   * Mousedown handler
   */
  fb.mousedown = function (event) {
    // Capture mouse
    if (!document.dragging) {
      $(document).bind('mousemove', fb.mousemove).bind('mouseup', fb.mouseup);
      document.dragging = true;
    }

    // Check which area is being dragged
    var pos = fb.widgetCoords(event);
    fb.circleDrag = Math.max(Math.abs(pos.x), Math.abs(pos.y)) * 2 > fb.square;

    // Process
    fb.mousemove(event);
    return false;
  };

  /**
   * Mousemove handler
   */
  fb.mousemove = function (event) {
    // Get coordinates relative to color picker center
    var pos = fb.widgetCoords(event);

    // Set new HSL parameters
    if (fb.circleDrag) {
      var hue = Math.atan2(pos.x, -pos.y) / 6.28;
      if (hue < 0) hue += 1;
      fb.setHSL([hue, fb.hsl[1], fb.hsl[2]]);
    }
    else {
      var sat = Math.max(0, Math.min(1, -(pos.x / fb.square) + .5));
      var lum = Math.max(0, Math.min(1, -(pos.y / fb.square) + .5));
      fb.setHSL([fb.hsl[0], sat, lum]);
    }
    return false;
  };

  /**
   * Mouseup handler
   */
  fb.mouseup = function () {
    // Uncapture mouse
    $(document).unbind('mousemove', fb.mousemove);
    $(document).unbind('mouseup', fb.mouseup);
    document.dragging = false;
  };

  /**
   * Update the markers and styles
   */
  fb.updateDisplay = function () {
    // Markers
    var angle = fb.hsl[0] * 6.28;
    $('.h-marker', e).css({
      left: Math.round(Math.sin(angle) * fb.radius + fb.width / 2) + 'px',
      top: Math.round(-Math.cos(angle) * fb.radius + fb.width / 2) + 'px'
    });

    $('.sl-marker', e).css({
      left: Math.round(fb.square * (.5 - fb.hsl[1]) + fb.width / 2) + 'px',
      top: Math.round(fb.square * (.5 - fb.hsl[2]) + fb.width / 2) + 'px'
    });

    // Saturation/Luminance gradient
    $('.color', e).css('backgroundColor', fb.pack(fb.HSLToRGB([fb.hsl[0], 1, 0.5])));

    // Linked elements or callback
    if (typeof fb.callback == 'object') {
      // Set background/foreground color
      $(fb.callback).css({
        backgroundColor: fb.color,
        color: fb.hsl[2] > 0.5 ? '#000' : '#fff'
      });

      // Change linked value
      $(fb.callback).each(function() {
        if (this.value && this.value != fb.color) {
          this.value = fb.color;
        }
      });
    }
    else if (typeof fb.callback == 'function') {
      fb.callback.call(fb, fb.color);
    }
  };

  /* Various color utility functions */
  fb.pack = function (rgb) {
    var r = Math.round(rgb[0] * 255);
    var g = Math.round(rgb[1] * 255);
    var b = Math.round(rgb[2] * 255);
    return '#' + (r < 16 ? '0' : '') + r.toString(16) +
           (g < 16 ? '0' : '') + g.toString(16) +
           (b < 16 ? '0' : '') + b.toString(16);
  };

  fb.unpack = function (color) {
    if (color.length == 7) {
      return [parseInt('0x' + color.substring(1, 3)) / 255,
        parseInt('0x' + color.substring(3, 5)) / 255,
        parseInt('0x' + color.substring(5, 7)) / 255];
    }
    else if (color.length == 4) {
      return [parseInt('0x' + color.substring(1, 2)) / 15,
        parseInt('0x' + color.substring(2, 3)) / 15,
        parseInt('0x' + color.substring(3, 4)) / 15];
    }
  };

  fb.HSLToRGB = function (hsl) {
    var m1, m2, r, g, b;
    var h = hsl[0], s = hsl[1], l = hsl[2];
    m2 = (l <= 0.5) ? l * (s + 1) : l + s - l*s;
    m1 = l * 2 - m2;
    return [this.hueToRGB(m1, m2, h+0.33333),
        this.hueToRGB(m1, m2, h),
        this.hueToRGB(m1, m2, h-0.33333)];
  };

  fb.hueToRGB = function (m1, m2, h) {
    h = (h < 0) ? h + 1 : ((h > 1) ? h - 1 : h);
    if (h * 6 < 1) return m1 + (m2 - m1) * h * 6;
    if (h * 2 < 1) return m2;
    if (h * 3 < 2) return m1 + (m2 - m1) * (0.66666 - h) * 6;
    return m1;
  };

  fb.RGBToHSL = function (rgb) {
    var min, max, delta, h, s, l;
    var r = rgb[0], g = rgb[1], b = rgb[2];
    min = Math.min(r, Math.min(g, b));
    max = Math.max(r, Math.max(g, b));
    delta = max - min;
    l = (min + max) / 2;
    s = 0;
    if (l > 0 && l < 1) {
      s = delta / (l < 0.5 ? (2 * l) : (2 - 2 * l));
    }
    h = 0;
    if (delta > 0) {
      if (max == r && max != g) h += (g - b) / delta;
      if (max == g && max != b) h += (2 + (b - r) / delta);
      if (max == b && max != r) h += (4 + (r - g) / delta);
      h /= 6;
    }
    return [h, s, l];
  };

  // Install mousedown handler (the others are set on the document on-demand)
  $('*', e).mousedown(fb.mousedown);

    // Init color
  fb.setColor('#000000');

  // Set linked elements/callback
  if (callback) {
    fb.linkTo(callback);
  }
};

})(jQuery);
;
/*! jQuery Timepicker Addon - v1.5.0 - 2014-09-01
* http://trentrichardson.com/examples/timepicker
* Copyright (c) 2014 Trent Richardson; Licensed MIT */
(function ($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.5.0"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function () {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			timeOnlyShowDate: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			maxTime: null,
			minTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			altRedirectFocus: true,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		maxTime: null,
		minTime: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour', 'minute', 'second', 'millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @param  {Object} settings  object - the new settings to use as defaults (anonymous object)
		* @return {Object} the manager object
		*/
		setDefaults: function (settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function ($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
				fns = {},
				overrides, i;

			for (var attrName in this._defaults) {
				if (this._defaults.hasOwnProperty(attrName)) {
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

			overrides = {
				beforeShow: function (input, dp_inst) {
					if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
						return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
					}
				},
				onChangeMonthYear: function (year, month, dp_inst) {
					// Update the time as well : this prevents the time from disappearing from the $input field.
					tp_inst._updateDateTime(dp_inst);
					if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
						tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
					}
				},
				onClose: function (dateText, dp_inst) {
					if (tp_inst.timeDefined === true && $input.val() !== '') {
						tp_inst._updateDateTime(dp_inst);
					}
					if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
						tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
					}
				}
			};
			for (i in overrides) {
				if (overrides.hasOwnProperty(i)) {
					fns[i] = opts[i] || null;
				}
			}

			tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
				evnts: fns,
				timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
			});
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function (val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function (val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat ? tp_inst._defaults.pickerTimeFormat : '') +
					(tp_inst._defaults.altTimeFormat ? tp_inst._defaults.altTimeFormat : ''));

			// controlType is string - key to our this._controls
			if (typeof(tp_inst._defaults.controlType) === 'string') {
				if (tp_inst._defaults.controlType === 'slider' && typeof($.ui.slider) === 'undefined') {
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else {
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720, -660, -600, -570, -540, -480, -420, -360, -300, -270, -240, -210, -180, -120, -60,
					0, 60, 120, 180, 210, 240, 270, 300, 330, 345, 360, 390, 420, 480, 525, 540, 570, 600, 630, 660, 690, 720, 765, 780, 840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl = timezoneList.length, tzi = 0, tzv = null;
			if (tzl > 0 && typeof timezoneList[0] !== 'object') {
				for (; tzi < tzl; tzi++) {
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null ? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) :
							((new Date()).getTimezoneOffset() * -1);
			tp_inst.hour = tp_inst._defaults.hour < tp_inst._defaults.hourMin ? tp_inst._defaults.hourMin :
							tp_inst._defaults.hour > tp_inst._defaults.hourMax ? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute < tp_inst._defaults.minuteMin ? tp_inst._defaults.minuteMin :
							tp_inst._defaults.minute > tp_inst._defaults.minuteMax ? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second < tp_inst._defaults.secondMin ? tp_inst._defaults.secondMin :
							tp_inst._defaults.second > tp_inst._defaults.secondMax ? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec < tp_inst._defaults.millisecMin ? tp_inst._defaults.millisecMin :
							tp_inst._defaults.millisec > tp_inst._defaults.millisecMax ? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec < tp_inst._defaults.microsecMin ? tp_inst._defaults.microsecMin :
							tp_inst._defaults.microsec > tp_inst._defaults.microsecMax ? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField);
				if (tp_inst._defaults.altRedirectFocus === true) {
					tp_inst.$altInput.css({
						cursor: 'pointer'
					}).focus(function () {
						$input.trigger("focus");
					});
				}
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined && tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined && tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined && tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined && tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function () {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function (dp_inst) {
			var currDT = (this.$altInput && this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function (timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function () {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i = 0,
				l = 0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 && o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '<div class="ui-timepicker-div' + (o.isRTL ? ' ui-timepicker-rtl' : '') + '"><dl>' + '<dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '>' + o.timeText + '</dt>' +
								'<dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '></dd>';

				// Create the markup
				for (i = 0, l = this.units.length; i < l; i++) {
					litem = this.units[i];
					uitem = litem.substr(0, 1).toUpperCase() + litem.substr(1);
					show = o['show' + uitem] !== null ? o['show' + uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem + 'Max'] - ((o[litem + 'Max'] - o[litem + 'Min']) % o['step' + uitem])), 10);
					gridSize[litem] = 0;

					html += '<dt class="ui_tpicker_' + litem + '_label"' + (show ? '' : noDisplay) + '>' + o[litem + 'Text'] + '</dt>' +
								'<dd class="ui_tpicker_' + litem + '"><div class="ui_tpicker_' + litem + '_slider"' + (show ? '' : noDisplay) + '></div>';

					if (show && o[litem + 'Grid'] > 0) {
						html += '<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';

						if (litem === 'hour') {
							for (var h = o[litem + 'Min']; h <= max[litem]; h += parseInt(o[litem + 'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm ? 'hht' : 'HH', {hour: h}, o);
								html += '<td data-for="' + litem + '">' + tmph + '</td>';
							}
						}
						else {
							for (var m = o[litem + 'Min']; m <= max[litem]; m += parseInt(o[litem + 'Grid'], 10)) {
								gridSize[litem]++;
								html += '<td data-for="' + litem + '">' + ((m < 10) ? '0' : '') + m + '</td>';
							}
						}

						html += '</tr></table></div>';
					}
					html += '</dd>';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null ? o.showTimezone : this.support.timezone;
				html += '<dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '>' + o.timezoneText + '</dt>';
				html += '<dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '></dd>';

				// Create the elements from string
				html += '</dl></div>';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all">' + '<div class="ui-datepicker-title">' + o.timeOnlyTitle + '</div>' + '</div>');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for (i = 0, l = tp_inst.units.length; i < l; i++) {
					litem = tp_inst.units[i];
					uitem = litem.substr(0, 1).toUpperCase() + litem.substr(1);
					show = o['show' + uitem] !== null ? o['show' + uitem] : this.support[litem];

					// add the slider
					tp_inst[litem + '_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_' + litem + '_slider'), litem, tp_inst[litem], o[litem + 'Min'], max[litem], o['step' + uitem]);

					// adjust the grid and add click event
					if (show && o[litem + 'Grid'] > 0) {
						size = 100 * gridSize[litem] * o[litem + 'Grid'] / (max[litem] - o[litem + 'Min']);
						$tp.find('.ui_tpicker_' + litem + ' table').css({
							width: size + "%",
							marginLeft: o.isRTL ? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL ? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function (e) {
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g), 10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if (f === 'hour') {
									if (ap.indexOf('p') !== -1 && n < 12) {
										n += 12;
									}
									else {
										if (ap.indexOf('a') !== -1 && n === 12) {
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f + '_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid > 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('<select></select>').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function (val, idx) {
					return $("<option />").val(typeof val === "object" ? val.value : val).text(typeof val === "object" ? val.label : val);
				}));
				if (typeof(this.timezone) !== "undefined" && this.timezone !== null && this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset() * -1;
					if (local_timezone === this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) !== "undefined" && this.hour !== null && this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function () {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function () { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function () {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl ? 'marginRight' : 'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl ? 'marginRight' : 'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function (dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null && $.datepicker._get(dp_inst, 'minDateTime') !== undefined && dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() === dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour <= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute <= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second <= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if (this.millisec <= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec < this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null && $.datepicker._get(dp_inst, 'maxDateTime') !== undefined && dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() === dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour >= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute >= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second >= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec >= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec > this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (dp_inst.settings.minTime!==null) {				
				var tempMinTime=new Date("01/01/1970 " + dp_inst.settings.minTime);				
				if (this.hour<tempMinTime.getHours()) {
					this.hour=this._defaults.hourMin=tempMinTime.getHours();
					this.minute=this._defaults.minuteMin=tempMinTime.getMinutes();							
				} else if (this.hour===tempMinTime.getHours() && this.minute<tempMinTime.getMinutes()) {
					this.minute=this._defaults.minuteMin=tempMinTime.getMinutes();
				} else {						
					if (this._defaults.hourMin<tempMinTime.getHours()) {
						this._defaults.hourMin=tempMinTime.getHours();
						this._defaults.minuteMin=tempMinTime.getMinutes();					
					} else if (this._defaults.hourMin===tempMinTime.getHours()===this.hour && this._defaults.minuteMin<tempMinTime.getMinutes()) {
						this._defaults.minuteMin=tempMinTime.getMinutes();						
					} else {
						this._defaults.minuteMin=0;
					}
				}				
			}
			
			if (dp_inst.settings.maxTime!==null) {				
				var tempMaxTime=new Date("01/01/1970 " + dp_inst.settings.maxTime);
				if (this.hour>tempMaxTime.getHours()) {
					this.hour=this._defaults.hourMax=tempMaxTime.getHours();						
					this.minute=this._defaults.minuteMax=tempMaxTime.getMinutes();
				} else if (this.hour===tempMaxTime.getHours() && this.minute>tempMaxTime.getMinutes()) {							
					this.minute=this._defaults.minuteMax=tempMaxTime.getMinutes();						
				} else {
					if (this._defaults.hourMax>tempMaxTime.getHours()) {
						this._defaults.hourMax=tempMaxTime.getHours();
						this._defaults.minuteMax=tempMaxTime.getMinutes();					
					} else if (this._defaults.hourMax===tempMaxTime.getHours()===this.hour && this._defaults.minuteMax>tempMaxTime.getMinutes()) {
						this._defaults.minuteMax=tempMaxTime.getMinutes();						
					} else {
						this._defaults.minuteMax=59;
					}
				}						
			}
			
			if (adjustSliders !== undefined && adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10),
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax, step: this._defaults.stepHour });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax, step: this._defaults.stepMinute });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax, step: this._defaults.stepSecond });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax, step: this._defaults.stepMillisec });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax, step: this._defaults.stepMicrosec });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function () {
			if (!this._defaults.showTimepicker) {
                                return;
			}
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) === 'object') {
				hour = false;
			}
			if (typeof(minute) === 'object') {
				minute = false;
			}
			if (typeof(second) === 'object') {
				second = false;
			}
			if (typeof(millisec) === 'object') {
				millisec = false;
			}
			if (typeof(microsec) === 'object') {
				microsec = false;
			}
			if (typeof(timezone) === 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}
			if (timezone !== false) {
				timezone = timezone.toString();
			}

			var ampm = o[hour < 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (
						hour !== parseInt(this.hour,10) || // sliders should all be numeric
						minute !== parseInt(this.minute,10) || 
						second !== parseInt(this.second,10) || 
						millisec !== parseInt(this.millisec,10) || 
						microsec !== parseInt(this.microsec,10) || 
						(this.ampm.length > 0 && (hour < 12) !== ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) || 
						(this.timezone !== null && timezone !== this.timezone.toString()) // could be numeric or "EST" format, so use toString()
					);

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if (pickerTimeFormat === o.timeFormat) {
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else {
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
				//this.$input.focus(); // may automatically open the picker on setDate
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function () {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect && inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function (dp_inst) {
			dp_inst = this.inst || dp_inst;
			var dtTmp = (dp_inst.currentYear > 0? 
							new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay) : 
							new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
				dt = $.datepicker._daylightSavingAdjust(dtTmp),
				//dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
				//dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null && this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if (dp_inst.lastVal === "") {
                dp_inst.currentYear = dp_inst.selectedYear;
                dp_inst.currentMonth = dp_inst.selectedMonth;
                dp_inst.currentDay = dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined && (dp_inst.lastVal.length > 0 && this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true && this._defaults.timeOnlyShowDate === false) {
				formattedDateTime = this.formattedTime;
			} else if ((this._defaults.timeOnly !== true && (this._defaults.alwaysSetTime || timeAvailable)) || (this._defaults.timeOnly === true && this._defaults.timeOnlyShowDate === true)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput && this._defaults.timeOnly === false && this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator !== null ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix !== null ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if (!this._defaults.timeOnly) {
					if (this._defaults.altFormat) {
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else {
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime) {
						altFormattedDateTime += altSeparator;
					}
				}

				if (this._defaults.altTimeFormat !== null) {
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else {
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function () {
			if (!this.$input.val() && this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly && (inst.input.val() !== inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function (tp_inst, obj, unit, val, min, max, step) {
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60->0 instead of 0->60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl ? val * -1 : val,
						min: rtl ? max * -1 : min,
						max: rtl ? min * -1 : max,
						step: step,
						slide: function (event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl ? ui.value * -1 : ui.value);
							tp_inst._onTimeChange();
						},
						stop: function (event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function (tp_inst, obj, unit, opts, val) {
					if (tp_inst._defaults.isRTL) {
						if (typeof(opts) === 'string') {
							if (opts === 'min' || opts === 'max') {
								if (val !== undefined) {
									return obj.slider(opts, val * -1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if (min !== undefined) {
							opts.max = min * -1;
						}
						if (max !== undefined) {
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if (typeof(opts) === 'string' && val !== undefined) {
						return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function (tp_inst, obj, unit, val) {
					if (tp_inst._defaults.isRTL) {
						if (val !== undefined) {
							return obj.slider('value', val * -1);
						}
						return Math.abs(obj.slider('value'));
					}
					if (val !== undefined) {
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function (tp_inst, obj, unit, val, min, max, step) {
					var sel = '<select class="ui-timepicker-select ui-state-default ui-corner-all" data-unit="' + unit + '" data-min="' + min + '" data-max="' + max + '" data-step="' + step + '">',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for (var i = min; i <= max; i += step) {
						sel += '<option value="' + i + '"' + (i === val ? ' selected' : '') + '>';
						if (unit === 'hour') {
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig, '')), {hour: i}, tp_inst._defaults);
						}
						else if (unit === 'millisec' || unit === 'microsec' || i >= 10) { sel += i; }
						else {sel += '0' + i.toString(); }
						sel += '</option>';
					}
					sel += '</select>';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function (e) {
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function (tp_inst, obj, unit, opts, val) {
					var o = {},
						$t = obj.children('select');
					if (typeof(opts) === 'string') {
						if (val === undefined) {
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else { o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function (tp_inst, obj, unit, val) {
					var $t = obj.children('select');
					if (val !== undefined) {
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker.
		*/
		timepicker: function (o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o === 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function () {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function (o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) === 'string') {
				if (o === 'getDate'  || (o === 'option' && tmp_args.length === 2 && typeof (tmp_args[1]) === 'string')) {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function () {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function () {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function (dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function (timeFormat, timeString, options) {
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g, '').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function (f, s, o) {

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function (amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function (val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function (timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i < finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] === -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
							case 'h':
								return ml === 1 ? '(\\d?\\d)' : '(\\d{' + ml + '})';
							case 'm':
								return ml === 1 ? '(\\d?\\d)' : '(\\d{' + ml + '})';
							case 's':
								return ml === 1 ? '(\\d?\\d)' : '(\\d{' + ml + '})';
							case 'l':
								return '(\\d?\\d?\\d)';
							case 'c':
								return '(\\d?\\d?\\d)';
							case 'z':
								return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
							case 't':
								return getPatternAmpm(o.amNames, o.pmNames);
							default:    // literal escaped in quotes
								return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm === 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm === 'AM' && treg[order.h] === '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm === 'PM' && treg[order.h] !== '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 && treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function (f, s, o) {
			try {
				var d = new Date('2012-01-01 ' + s);
				if (isNaN(d.getTime())) {
					d = new Date('2012-01-01T' + s);
					if (isNaN(d.getTime())) {
						d = new Date('01/01/2012 ' + s);
						if (isNaN(d.getTime())) {
							throw "Unable to parse time with native Date: " + s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset() * -1
				};
			}
			catch (err) {
				try {
					return strictParse(f, s, o);
				}
				catch (err2) {
					$.timepicker.log("Unable to parse \ntimeString: " + s + "\ntimeFormat: " + f);
				}				
			}
			return false;
		}; // end looseParse
		
		if (typeof o.parse === "function") {
			return o.parse(timeFormat, timeString, o);
		}
		if (o.parse === 'loose') {
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/**
	 * Public utility to format the time
	 * @param {string} format format of the time
	 * @param {Object} time Object not a Date for timezones
	 * @param {Object} [options] essentially the regional[].. amNames, pmNames, ampm
	 * @returns {string} the formatted time
	 */
	$.datepicker.formatTime = function (format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour > 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
			switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null ? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null ? options.timezone : time.timezone, true);
			case 'T':
				return ampmName.charAt(0).toUpperCase();
			case 'TT':
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/'/g, "");
			}
		});

		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesn't close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function (id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker'),
			was_inline;

		if (tp_inst && inst.settings.showTimepicker) {
			tp_inst._limitMinMaxDateTime(inst, true);
			was_inline = inst.inline;
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = was_inline;
			inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function (inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst && $.datepicker._curInst !== inst && $.datepicker._datepickerShowing && $.datepicker._lastInput !== input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function (event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null ? tp_inst._defaults.showTimezone : tp_inst.support.timezone,
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr < ' ' || !dateChars || datetimeChars.indexOf(chr) > -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	* Update any alternate field to synchronise with the main field.
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	$.datepicker._updateAlternate = function (inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if (!tp_inst._defaults.timeOnly && !tp_inst._defaults.altFieldTimeOnly && date !== null) {
					if (tp_inst._defaults.altFormat) {
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else {
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val( inst.input.val() ? altFormattedDateTime : "");
			}
		}
		else {
			$.datepicker._base_updateAlternate(inst);	
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function (event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly && (inst.input.val() !== inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function (id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		this._setDate(inst, now);
	};

	/*
	* Disable & enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function (target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			inst.settings.showTimepicker = false;
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function (target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			inst.settings.showTimepicker = true;
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function (inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function (target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date === "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() === 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function (target, _date) {
		var inst = this._getInst(target);
		var date = _date;
		if (!inst) {
			return;
		}

		if (typeof(_date) === 'string') {
			date = new Date(_date);
			if (!date.getTime()) {
				this._base_setDateDatepicker.apply(this, arguments);
				date = $(target).datepicker('getDate');
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if (tp_inst && tp_date) {
			// look out for DST if tz wasn't specified
			if (!tp_inst.support.timezone && tp_inst._defaults.timezone === null) {
				tp_inst.timezone = tp_date.getTimezoneOffset() * -1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function (target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if (inst.lastVal === undefined) {
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date && tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if (tp_inst.timezone != null) {
					// look out for DST if tz wasn't specified
					if (!tp_inst.support.timezone && tp_inst._defaults.timezone === null) {
						tp_inst.timezone = date.getTimezoneOffset() * -1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function (format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") >= 0) {
				date = this._base_parseDate(format, value.substring(0, value.length - (err.length - err.indexOf(':') - 2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function (inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function (target, name, value) {
		var inst = this._getInst(target),
			name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop,
				ret,
				oldVal,
				$target;
			if (typeof name === 'string') { // if min/max was set with the string
				if (name === 'minDate' || name === 'minDateTime') {
					min = value;
				} else if (name === 'maxDate' || name === 'maxDateTime') {
					max = value;
				} else if (name === 'onSelect') {
					onselect = value;
				} else if (overrides.hasOwnProperty(name)) {
					if (typeof (value) === 'undefined') {
						return overrides[name];
					}
					fns[name] = value;
					name_clone = {}; //empty results in exiting function after overrides updated
				}
			} else if (typeof name === 'object') { //if min/max was set with the JSON
				if (name.minDate) {
					min = name.minDate;
				} else if (name.minDateTime) {
					min = name.minDateTime;
				} else if (name.maxDate) {
					max = name.maxDate;
				} else if (name.maxDateTime) {
					max = name.maxDateTime;
				}
				for (prop in overrides) {
					if (overrides.hasOwnProperty(prop) && name[prop]) {
						fns[prop] = name[prop];
					}
				}
			}
			for (prop in fns) {
				if (fns.hasOwnProperty(prop)) {
					overrides[prop] = fns[prop];
					if (!name_clone) { name_clone = $.extend({}, name); }
					delete name_clone[prop];
				}
			}
			if (name_clone && isEmptyObject(name_clone)) { return; }
			if (min) { //if min was set
				if (min === 0) {
					min = new Date();
				} else {
					min = new Date(min);
				}
				tp_inst._defaults.minDate = min;
				tp_inst._defaults.minDateTime = min;
			} else if (max) { //if max was set
				if (max === 0) {
					max = new Date();
				} else {
					max = new Date(max);
				}
				tp_inst._defaults.maxDate = max;
				tp_inst._defaults.maxDateTime = max;
			} else if (onselect) {
				tp_inst._defaults.onSelect = onselect;
			}

			// Datepicker will override our date when we call _base_optionDatepicker when 
			// calling minDate/maxDate, so we will first grab the value, call 
			// _base_optionDatepicker, then set our value back.
			if(min || max){
				$target = $(target);
				oldVal = $target.datetimepicker('getDate');
				ret = this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
				$target.datetimepicker('setDate', oldVal);
				return ret;
			}
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function (obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(prop)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function (target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function (timeFormat) {
		var tf = timeFormat.replace(/'.*?'/g, '').toLowerCase(), // removes literals
			isIn = function (f, t) { // does the format contain the token?
					return f.indexOf(t) !== -1 ? true : false;
				};
		return {
				hour: isIn(tf, 'h'),
				minute: isIn(tf, 'm'),
				second: isIn(tf, 's'),
				millisec: isIn(tf, 'l'),
				microsec: isIn(tf, 'c'),
				timezone: isIn(tf, 'z'),
				ampm: isIn(tf, 't') && isIn(timeFormat, 'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function (hour) {
		hour %= 12;

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	var computeEffectiveSetting = function (settings, property) {
		return settings && settings[property] ? settings[property] : $.timepicker._defaults[property];
	};

	/*
	* Splits datetime string into date and time substrings.
	* Throws exception when date can't be parsed
	* Returns {dateString: dateString, timeString: timeString}
	*/
	var splitDateTime = function (dateTimeString, timeSettings) {
		// The idea is to get the number separator occurrences in datetime and the time format requested (since time has
		// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
		var separator = computeEffectiveSetting(timeSettings, 'separator'),
			format = computeEffectiveSetting(timeSettings, 'timeFormat'),
			timeParts = format.split(separator), // how many occurrences of separator may be in our format?
			timePartsLen = timeParts.length,
			allParts = dateTimeString.split(separator),
			allPartsLen = allParts.length;

		if (allPartsLen > 1) {
			return {
				dateString: allParts.splice(0, allPartsLen - timePartsLen).join(separator),
				timeString: allParts.splice(0, timePartsLen).join(separator)
			};
		}

		return {
			dateString: dateTimeString,
			timeString: ''
		};
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function (dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date,
			parts,
			parsedTime;

		parts = splitDateTime(dateTimeString, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, parts.dateString, dateSettings);

		if (parts.timeString === '') {
			return {
				date: date
			};
		}

		parsedTime = $.datepicker.parseTime(timeFormat, parts.timeString, timeSettings);

		if (!parsedTime) {
			throw 'Wrong time format';
		}

		return {
			date: date,
			timeObj: parsedTime
		};
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function (tp_inst, date) {
		if (tp_inst && tp_inst.timezone_select) {
			var now = date || new Date();
			tp_inst.timezone_select.val(-now.getTimezoneOffset());
		}
	};

	/*
	* Create a Singleton Instance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @param {number} tzMinutes if not a number, less than -720 (-1200), or greater than 840 (+1400) this value is returned
	 * @param {boolean} iso8601 if true formats in accordance to iso8601 "+12:45"
	 * @return {string}
	 */
	$.timepicker.timezoneOffsetString = function (tzMinutes, iso8601) {
		if (isNaN(tzMinutes) || tzMinutes > 840 || tzMinutes < -720) {
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601 ? ':' : '',
			tz = (off >= 0 ? '+' : '-') + ('0' + Math.abs(hours)).slice(-2) + iso + ('0' + Math.abs(minutes)).slice(-2);
		
		if (tz === '+00:00') {
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @param  {string} tzString formatted like "+0500", "-1245", "Z"
	 * @return {number} the offset minutes or the original string if it doesn't match expectations
	 */
	$.timepicker.timezoneOffsetNumber = function (tzString) {
		var normalized = tzString.toString().replace(':', ''); // excuse any iso8601, end up with "+1245"

		if (normalized.toUpperCase() === 'Z') { // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if (!/^(\-|\+)\d{4}$/.test(normalized)) { // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((normalized.substr(0, 1) === '-' ? -1 : 1) * // plus or minus
					((parseInt(normalized.substr(1, 2), 10) * 60) + // hours (converted to minutes)
					parseInt(normalized.substr(3, 2), 10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @param  {Date} date
	 * @param  {string} toTimezone formatted like "+0500", "-1245"
	 * @return {Date}
	 */
	$.timepicker.timezoneAdjust = function (date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if (!isNaN(toTz)) {
			date.setMinutes(date.getMinutes() + -date.getTimezoneOffset() - toTz);
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @param  {Element} startTime
	 * @param  {Element} endTime
	 * @param  {Object} options Options for the timepicker() call
	 * @return {jQuery}
	 */
	$.timepicker.timeRange = function (startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @param  {Element} startTime
	 * @param  {Element} endTime
	 * @param  {Object} options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @param  {string} method Can be used to specify the type of picker to be added
	 * @return {jQuery}
	 */
	$.timepicker.datetimeRange = function (startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @param  {Element} startTime
	 * @param  {Element} endTime
	 * @param  {Object} options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @return {jQuery}
	 */
	$.timepicker.dateRange = function (startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @param  {string} method Can be used to specify the type of picker to be added
	 * @param  {Element} startTime
	 * @param  {Element} endTime
	 * @param  {Object} options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @return {jQuery}
	 */
	$.timepicker.handleRange = function (method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		// for the mean time this fixes an issue with calling getDate with timepicker()
		var timeOnly = false;
		if(method === 'timepicker'){
			timeOnly = true;
			method = 'datetimepicker';
		}

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if (startdt !== null) {
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if (options.minInterval > 0 && minDate > enddt) { // minInterval check
					endTime[method]('setDate', minDate);
				}
				else if (options.maxInterval > 0 && maxDate < enddt) { // max interval check
					endTime[method]('setDate', maxDate);
				}
				else if (startdt > enddt) {
					other[method]('setDate', changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if (date !== null && options.minInterval > 0) {
				if (option === 'minDate') {
					date.setMilliseconds(date.getMilliseconds() + options.minInterval);
				}
				if (option === 'maxDate') {
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}

		$.fn[method].call(startTime, $.extend({
			timeOnly: timeOnly,
			onClose: function (dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function (selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			timeOnly: timeOnly,
			onClose: function (dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function (selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @param  {Object} err pass any type object to log to the console during error or debugging
	 * @return {void}
	 */
	$.timepicker.log = function () {
		if (window.console) {
			window.console.log.apply(window.console, Array.prototype.slice.call(arguments));
		}
	};

	/*
	 * Add util object to allow access to private methods for testability.
	 */
	$.timepicker._util = {
		_extendRemove: extendRemove,
		_isEmptyObject: isEmptyObject,
		_convert24to12: convert24to12,
		_detectSupport: detectSupport,
		_selectLocalTimezone: selectLocalTimezone,
		_computeEffectiveSetting: computeEffectiveSetting,
		_splitDateTime: splitDateTime,
		_parseDateTimeInternal: parseDateTimeInternal
	};

	/*
	* Microsecond support
	*/
	if (!Date.prototype.getMicroseconds) {
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function () { return this.microseconds; };
		Date.prototype.setMicroseconds = function (m) {
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m / 1000));
			this.microseconds = m % 1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.5.0";

})(jQuery);
;
/*
 * jQote2 - client-side Javascript templating engine
 * Copyright (C) 2010, aefxx
 * http://aefxx.com/
 *
 * Dual licensed under the WTFPL v2 or MIT (X11) licenses
 * WTFPL v2 Copyright (C) 2004, Sam Hocevar
 *
 * Date: Fri, May 4th, 2012
 * Version: 0.9.8
 */
(function($){var _=false,E1="UndefinedTemplateError",E2="TemplateCompilationError",E3="TemplateExecutionError",A="[object Array]",S="[object String]",F="[object Function]",n=1,c="%",q=/^[^<]*(<[\w\W]+>)[^>]*$/,ts=Object.prototype.toString;function r(e,x){throw ($.extend(e,x),e)}function dns(f) {var a=[];if(ts.call(f)!==A)return _;for(var i=0,l=f.length;i<l;i++)a[i]=f[i].jqote_id;return a.length?a.sort().join('.').replace(/(\b\d+\b)\.(?:\1(\.|$))+/g,"$1$2"):_}function l(s,t){var f,g=[],t=t||c,x=ts.call(s);if(x===F)return s.jqote_id?[s]:_;if(x!==A)return[$.jqotec(s,t)];if(x===A)for(var i=0,l=s.length;i<l;i++)return g.length?g:_}$.fn.extend({jqote:function(x,y){var x=ts.call(x)===A?x:[x],d="";this.each(function(i){var f=$.jqotec(this,y);for(var j=0;j<x.length;j++)d+=f.call(x[j],i,j,x,f)});return d}});$.each({app:"append",pre:"prepend",sub:"html"},function(x,y){$.fn["jqote"+x]=function(e,d,t){var p,r,s=$.jqote(e,d,t),$$=!q.test(s)?function(s){return $(document.createTextNode(s))}:$;if(!!(p=dns(l(e))))r=new RegExp("(^|\\.)"+p.split(".").join("\\.(.*)?")+"(\\.|$)");return this.each(function(){var z=$$(s);$(this)[y](z);(z[0].nodeType===3?$(this):z).trigger("jqote."+x,[z,r])})}});
$.extend({jqote:function(e,d,t){var s="",t=t||c,f=l(e,t);if(f===_)r(new Error("Empty or undefined template passed to $.jqote"),{type:E1});d=ts.call(d)!==A?[d]:d;for(var i=0,m=f.length;i<m;i++)for(var j=0;j<d.length;j++)s+=f[i].call(d[j],i,j,d,f[i]);return s},jqotec:function(x,t){var h,e,y,t=t||c,z=ts.call(x);if(z===S&&q.test(x)){e=y=x;if(h=$.jqotecache[x])return h}else{e=z===S||x.nodeType?$(x):x instanceof jQuery?x:null;if(!e[0]||!(y=e[0].innerHTML)&&!(y=e.text()))r(new Error("Empty or undefined template passed to $.jqotec"),{type:E1});if(h=$.jqotecache[$.data(e[0],"jqote_id")])return h}var s="",i,a=y.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]/g,"").split("<"+t).join(t+">\x1b").split(t+">");for(var m=0,k=a.length;m<k;m++)s+=a[m].charAt(0)!=="\x1b"?"out+='"+a[m].replace(/(\\|["'])/g,"\\$1")+"'":(a[m].charAt(1)==="="?";out+=("+a[m].substr(2)+");":(a[m].charAt(1)==="!"?";out+=$.jqotenc(("+a[m].substr(2)+"));":";"+a[m].substr(1)));s="try{"+('var out="";'+s+";return out;").split("out+='';").join("").split('var out="";out+=').join("var out=")+'}catch(e){e.type="'+E3+'";e.args=arguments;e.template=arguments.callee.toString();throw e;}';try{var f=new Function("i, j, data, fn",s)}catch(e){r(e,{type:E2})}i=e instanceof jQuery?$.data(e[0],"jqote_id",n):e;return $.jqotecache[i]=(f.jqote_id=n++,f)},
jqotefn:function(e){var t=ts.call(e),i=t===S&&q.test(e)?e:$.data($(e)[0],"jqote_id");return $.jqotecache[i]||_},jqotetag:function(s){if(ts.call(s)===S)c=s},jqotenc:function(s){return s.toString().replace(/&(?!\w+;)/g,'&#38;').split('<').join('&#60;').split('>').join('&#62;').split('"').join('&#34;').split("'").join('&#39;')},jqotecache:{}});$.event.special.jqote={add:function(o){var n,h=o.handler,d=!o.data?[]:ts.call(o.data)!==A?[o.data]:o.data;if(!o.namespace)o.namespace="app.pre.sub";if(!d.length||!(n=dns(l(d))))return;o.handler=function(e,m,r){return !r||r.test(n)?h.apply(this,[e,m]):null}}}})(jQuery);
;
window.JSON||(window.JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)d=rep[c],typeof d=="string"&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var JSON=window.JSON,cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();
/*!
  Tinycon - A small library for manipulating the Favicon
  Tom Moor, http://tommoor.com
  Copyright (c) 2012 Tom Moor
  MIT Licensed
  @version 0.5
*/
(function(){var Tinycon={};var currentFavicon=null;var originalFavicon=null;var originalTitle=document.title;var faviconImage=null;var canvas=null;var options={};var defaults={width:7,height:9,font:'10px arial',colour:'#ffffff',background:'#F03D25',fallback:true,abbreviate:true};var ua=(function(){var agent=navigator.userAgent.toLowerCase();return function(browser){return agent.indexOf(browser)!==-1}}());var browser={ie:ua('msie'),chrome:ua('chrome'),webkit:ua('chrome')||ua('safari'),safari:ua('safari')&&!ua('chrome'),mozilla:ua('mozilla')&&!ua('chrome')&&!ua('safari')};var getFaviconTag=function(){var links=document.getElementsByTagName('link');for(var i=0,len=links.length;i<len;i++){if((links[i].getAttribute('rel')||'').match(/\bicon\b/)){return links[i]}}return false};var removeFaviconTag=function(){var links=document.getElementsByTagName('link');var head=document.getElementsByTagName('head')[0];for(var i=0,len=links.length;i<len;i++){var exists=(typeof(links[i])!=='undefined');if(exists&&(links[i].getAttribute('rel')||'').match(/\bicon\b/)){head.removeChild(links[i])}}};var getCurrentFavicon=function(){if(!originalFavicon||!currentFavicon){var tag=getFaviconTag();originalFavicon=currentFavicon=tag?tag.getAttribute('href'):'/favicon.ico'}return currentFavicon};var getCanvas=function(){if(!canvas){canvas=document.createElement("canvas");canvas.width=16;canvas.height=16}return canvas};var setFaviconTag=function(url){removeFaviconTag();var link=document.createElement('link');link.type='image/x-icon';link.rel='icon';link.href=url;document.getElementsByTagName('head')[0].appendChild(link)};var log=function(message){if(window.console)window.console.log(message)};var drawFavicon=function(label,colour){if(!getCanvas().getContext||browser.ie||browser.safari||options.fallback==='force'){return updateTitle(label)}var context=getCanvas().getContext("2d");var colour=colour||'#000000';var src=getCurrentFavicon();faviconImage=new Image();faviconImage.onload=function(){context.clearRect(0,0,16,16);context.drawImage(faviconImage,0,0,faviconImage.width,faviconImage.height,0,0,16,16);if((label+'').length>0)drawBubble(context,label,colour);refreshFavicon()};if(!src.match(/^data/)){faviconImage.crossOrigin='anonymous'}faviconImage.src=src};var updateTitle=function(label){if(options.fallback){if((label+'').length>0){document.title='('+label+') '+originalTitle}else{document.title=originalTitle}}};var drawBubble=function(context,label,colour){if(typeof label=='number'&&label>99&&options.abbreviate){label=abbreviateNumber(label)}var len=(label+'').length-1;var width=options.width+(6*len);var w=16-width;var h=16-options.height;context.font=(browser.webkit?'bold ':'')+options.font;context.fillStyle=options.background;context.strokeStyle=options.background;context.lineWidth=1;context.fillRect(w,h,width-1,options.height);context.beginPath();context.moveTo(w-0.5,h+1);context.lineTo(w-0.5,15);context.stroke();context.beginPath();context.moveTo(15.5,h+1);context.lineTo(15.5,15);context.stroke();context.beginPath();context.strokeStyle="rgba(0,0,0,0.3)";context.moveTo(w,16);context.lineTo(15,16);context.stroke();context.fillStyle=options.colour;context.textAlign="right";context.textBaseline="top";context.fillText(label,15,browser.mozilla?7:6)};var refreshFavicon=function(){if(!getCanvas().getContext)return;setFaviconTag(getCanvas().toDataURL())};var abbreviateNumber=function(label){var metricPrefixes=[['G',1000000000],['M',1000000],['k',1000]];for(var i=0;i<metricPrefixes.length;++i){if(label>=metricPrefixes[i][1]){label=round(label/metricPrefixes[i][1])+metricPrefixes[i][0];break}}return label};var round=function(value,precision){var number=new Number(value);return number.toFixed(precision)};Tinycon.setOptions=function(custom){options={};for(var key in defaults){options[key]=custom.hasOwnProperty(key)?custom[key]:defaults[key]}return this};Tinycon.setImage=function(url){currentFavicon=url;refreshFavicon();return this};Tinycon.setBubble=function(label,colour){label=label||'';drawFavicon(label,colour);return this};Tinycon.reset=function(){setFaviconTag(originalFavicon)};Tinycon.setOptions(defaults);window.Tinycon=Tinycon})();
;
/*!
 * Bootstrap v3.4.1 (http://getbootstrap.com)
 * Copyright 2011-2019 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

!function($){"use strict";var DISALLOWED_ATTRIBUTES=["sanitize","whiteList","sanitizeFn"],uriAttrs=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],ARIA_ATTRIBUTE_PATTERN,DefaultWhitelist={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},SAFE_URL_PATTERN=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,DATA_URL_PATTERN=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;function allowedAttribute(attr,allowedAttributeList){var attrName=attr.nodeName.toLowerCase();if(-1!==$.inArray(attrName,allowedAttributeList))return-1===$.inArray(attrName,uriAttrs)||Boolean(attr.nodeValue.match(SAFE_URL_PATTERN)||attr.nodeValue.match(DATA_URL_PATTERN));for(var regExp=$(allowedAttributeList).filter((function(index,value){return value instanceof RegExp})),i=0,l=regExp.length;i<l;i++)if(attrName.match(regExp[i]))return!0;return!1}function sanitizeHtml(unsafeHtml,whiteList,sanitizeFn){if(0===unsafeHtml.length)return unsafeHtml;if(sanitizeFn&&"function"==typeof sanitizeFn)return sanitizeFn(unsafeHtml);if(!document.implementation||!document.implementation.createHTMLDocument)return unsafeHtml;var createdDocument=document.implementation.createHTMLDocument("sanitization");createdDocument.body.innerHTML=unsafeHtml;for(var whitelistKeys=$.map(whiteList,(function(el,i){return i})),elements=$(createdDocument.body).find("*"),i=0,len=elements.length;i<len;i++){var el=elements[i],elName=el.nodeName.toLowerCase();if(-1!==$.inArray(elName,whitelistKeys))for(var attributeList=$.map(el.attributes,(function(el){return el})),whitelistedAttributes=[].concat(whiteList["*"]||[],whiteList[elName]||[]),j=0,len2=attributeList.length;j<len2;j++)allowedAttribute(attributeList[j],whitelistedAttributes)||el.removeAttribute(attributeList[j].nodeName);else el.parentNode.removeChild(el)}return createdDocument.body.innerHTML}var Tooltip=function(element,options){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",element,options)};function Plugin(option){return this.each((function(){var $this=$(this),data=$this.data("bs.tooltip"),options="object"==typeof option&&option;!data&&/destroy|hide/.test(option)||(data||$this.data("bs.tooltip",data=new Tooltip(this,options)),"string"==typeof option&&data[option]())}))}Tooltip.VERSION="3.4.1",Tooltip.TRANSITION_DURATION=150,Tooltip.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0},sanitize:!0,sanitizeFn:null,whiteList:DefaultWhitelist},Tooltip.prototype.init=function(type,element,options){if(this.enabled=!0,this.type=type,this.$element=$(element),this.options=this.getOptions(options),this.$viewport=this.options.viewport&&$(document).find($.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var triggers=this.options.trigger.split(" "),i=triggers.length;i--;){var trigger=triggers[i];if("click"==trigger)this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this));else if("manual"!=trigger){var eventIn="hover"==trigger?"mouseenter":"focusin",eventOut="hover"==trigger?"mouseleave":"focusout";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this)),this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS},Tooltip.prototype.getOptions=function(options){var dataAttributes=this.$element.data();for(var dataAttr in dataAttributes)dataAttributes.hasOwnProperty(dataAttr)&&-1!==$.inArray(dataAttr,DISALLOWED_ATTRIBUTES)&&delete dataAttributes[dataAttr];return(options=$.extend({},this.getDefaults(),dataAttributes,options)).delay&&"number"==typeof options.delay&&(options.delay={show:options.delay,hide:options.delay}),options.sanitize&&(options.template=sanitizeHtml(options.template,options.whiteList,options.sanitizeFn)),options},Tooltip.prototype.getDelegateOptions=function(){var options={},defaults=this.getDefaults();return this._options&&$.each(this._options,(function(key,value){defaults[key]!=value&&(options[key]=value)})),options},Tooltip.prototype.enter=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data("bs."+this.type);if(self||(self=new this.constructor(obj.currentTarget,this.getDelegateOptions()),$(obj.currentTarget).data("bs."+this.type,self)),obj instanceof $.Event&&(self.inState["focusin"==obj.type?"focus":"hover"]=!0),self.tip().hasClass("in")||"in"==self.hoverState)self.hoverState="in";else{if(clearTimeout(self.timeout),self.hoverState="in",!self.options.delay||!self.options.delay.show)return self.show();self.timeout=setTimeout((function(){"in"==self.hoverState&&self.show()}),self.options.delay.show)}},Tooltip.prototype.isInStateTrue=function(){for(var key in this.inState)if(this.inState[key])return!0;return!1},Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data("bs."+this.type);if(self||(self=new this.constructor(obj.currentTarget,this.getDelegateOptions()),$(obj.currentTarget).data("bs."+this.type,self)),obj instanceof $.Event&&(self.inState["focusout"==obj.type?"focus":"hover"]=!1),!self.isInStateTrue()){if(clearTimeout(self.timeout),self.hoverState="out",!self.options.delay||!self.options.delay.hide)return self.hide();self.timeout=setTimeout((function(){"out"==self.hoverState&&self.hide()}),self.options.delay.hide)}},Tooltip.prototype.show=function(){var e=$.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var inDom=$.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!inDom)return;var that=this,$tip=this.tip(),tipId=this.getUID(this.type);this.setContent(),$tip.attr("id",tipId),this.$element.attr("aria-describedby",tipId),this.options.animation&&$tip.addClass("fade");var placement="function"==typeof this.options.placement?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement,autoToken=/\s?auto?\s?/i,autoPlace=autoToken.test(placement);autoPlace&&(placement=placement.replace(autoToken,"")||"top"),$tip.detach().css({top:0,left:0,display:"block"}).addClass(placement).data("bs."+this.type,this),this.options.container?$tip.appendTo($(document).find(this.options.container)):$tip.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var pos=this.getPosition(),actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight;if(autoPlace){var orgPlacement=placement,viewportDim=this.getPosition(this.$viewport);placement="bottom"==placement&&pos.bottom+actualHeight>viewportDim.bottom?"top":"top"==placement&&pos.top-actualHeight<viewportDim.top?"bottom":"right"==placement&&pos.right+actualWidth>viewportDim.width?"left":"left"==placement&&pos.left-actualWidth<viewportDim.left?"right":placement,$tip.removeClass(orgPlacement).addClass(placement)}var calculatedOffset=this.getCalculatedOffset(placement,pos,actualWidth,actualHeight);this.applyPlacement(calculatedOffset,placement);var complete=function(){var prevHoverState=that.hoverState;that.$element.trigger("shown.bs."+that.type),that.hoverState=null,"out"==prevHoverState&&that.leave(that)};$.support.transition&&this.$tip.hasClass("fade")?$tip.one("bsTransitionEnd",complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION):complete()}},Tooltip.prototype.applyPlacement=function(offset,placement){var $tip=this.tip(),width=$tip[0].offsetWidth,height=$tip[0].offsetHeight,marginTop=parseInt($tip.css("margin-top"),10),marginLeft=parseInt($tip.css("margin-left"),10);isNaN(marginTop)&&(marginTop=0),isNaN(marginLeft)&&(marginLeft=0),offset.top+=marginTop,offset.left+=marginLeft,$.offset.setOffset($tip[0],$.extend({using:function(props){$tip.css({top:Math.round(props.top),left:Math.round(props.left)})}},offset),0),$tip.addClass("in");var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight;"top"==placement&&actualHeight!=height&&(offset.top=offset.top+height-actualHeight);var delta=this.getViewportAdjustedDelta(placement,offset,actualWidth,actualHeight);delta.left?offset.left+=delta.left:offset.top+=delta.top;var isVertical=/top|bottom/.test(placement),arrowDelta=isVertical?2*delta.left-width+actualWidth:2*delta.top-height+actualHeight,arrowOffsetPosition=isVertical?"offsetWidth":"offsetHeight";$tip.offset(offset),this.replaceArrow(arrowDelta,$tip[0][arrowOffsetPosition],isVertical)},Tooltip.prototype.replaceArrow=function(delta,dimension,isVertical){this.arrow().css(isVertical?"left":"top",50*(1-delta/dimension)+"%").css(isVertical?"top":"left","")},Tooltip.prototype.setContent=function(){var $tip=this.tip(),title=this.getTitle();this.options.html?(this.options.sanitize&&(title=sanitizeHtml(title,this.options.whiteList,this.options.sanitizeFn)),$tip.find(".tooltip-inner").html(title)):$tip.find(".tooltip-inner").text(title),$tip.removeClass("fade in top bottom left right")},Tooltip.prototype.hide=function(callback){var that=this,$tip=$(this.$tip),e=$.Event("hide.bs."+this.type);function complete(){"in"!=that.hoverState&&$tip.detach(),that.$element&&that.$element.removeAttr("aria-describedby").trigger("hidden.bs."+that.type),callback&&callback()}if(this.$element.trigger(e),!e.isDefaultPrevented())return $tip.removeClass("in"),$.support.transition&&$tip.hasClass("fade")?$tip.one("bsTransitionEnd",complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION):complete(),this.hoverState=null,this},Tooltip.prototype.fixTitle=function(){var $e=this.$element;($e.attr("title")||"string"!=typeof $e.attr("data-original-title"))&&$e.attr("data-original-title",$e.attr("title")||"").attr("title","")},Tooltip.prototype.hasContent=function(){return this.getTitle()},Tooltip.prototype.getPosition=function($element){var el=($element=$element||this.$element)[0],isBody="BODY"==el.tagName,elRect=el.getBoundingClientRect();null==elRect.width&&(elRect=$.extend({},elRect,{width:elRect.right-elRect.left,height:elRect.bottom-elRect.top}));var isSvg=window.SVGElement&&el instanceof window.SVGElement,elOffset=isBody?{top:0,left:0}:isSvg?null:$element.offset(),scroll={scroll:isBody?document.documentElement.scrollTop||document.body.scrollTop:$element.scrollTop()},outerDims=isBody?{width:$(window).width(),height:$(window).height()}:null;return $.extend({},elRect,scroll,outerDims,elOffset)},Tooltip.prototype.getCalculatedOffset=function(placement,pos,actualWidth,actualHeight){return"bottom"==placement?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:"top"==placement?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:"left"==placement?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}},Tooltip.prototype.getViewportAdjustedDelta=function(placement,pos,actualWidth,actualHeight){var delta={top:0,left:0};if(!this.$viewport)return delta;var viewportPadding=this.options.viewport&&this.options.viewport.padding||0,viewportDimensions=this.getPosition(this.$viewport);if(/right|left/.test(placement)){var topEdgeOffset=pos.top-viewportPadding-viewportDimensions.scroll,bottomEdgeOffset=pos.top+viewportPadding-viewportDimensions.scroll+actualHeight;topEdgeOffset<viewportDimensions.top?delta.top=viewportDimensions.top-topEdgeOffset:bottomEdgeOffset>viewportDimensions.top+viewportDimensions.height&&(delta.top=viewportDimensions.top+viewportDimensions.height-bottomEdgeOffset)}else{var leftEdgeOffset=pos.left-viewportPadding,rightEdgeOffset=pos.left+viewportPadding+actualWidth;leftEdgeOffset<viewportDimensions.left?delta.left=viewportDimensions.left-leftEdgeOffset:rightEdgeOffset>viewportDimensions.right&&(delta.left=viewportDimensions.left+viewportDimensions.width-rightEdgeOffset)}return delta},Tooltip.prototype.getTitle=function(){var title,$e=this.$element,o=this.options;return title=$e.attr("data-original-title")||("function"==typeof o.title?o.title.call($e[0]):o.title)},Tooltip.prototype.getUID=function(prefix){do{prefix+=~~(1e6*Math.random())}while(document.getElementById(prefix));return prefix},Tooltip.prototype.tip=function(){if(!this.$tip&&(this.$tip=$(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},Tooltip.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},Tooltip.prototype.enable=function(){this.enabled=!0},Tooltip.prototype.disable=function(){this.enabled=!1},Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled},Tooltip.prototype.toggle=function(e){var self=this;e&&((self=$(e.currentTarget).data("bs."+this.type))||(self=new this.constructor(e.currentTarget,this.getDelegateOptions()),$(e.currentTarget).data("bs."+this.type,self))),e?(self.inState.click=!self.inState.click,self.isInStateTrue()?self.enter(self):self.leave(self)):self.tip().hasClass("in")?self.leave(self):self.enter(self)},Tooltip.prototype.destroy=function(){var that=this;clearTimeout(this.timeout),this.hide((function(){that.$element.off("."+that.type).removeData("bs."+that.type),that.$tip&&that.$tip.detach(),that.$tip=null,that.$arrow=null,that.$viewport=null,that.$element=null}))},Tooltip.prototype.sanitizeHtml=function(unsafeHtml){return sanitizeHtml(unsafeHtml,this.options.whiteList,this.options.sanitizeFn)};var old=$.fn.tooltip;$.fn.tooltip=Plugin,$.fn.tooltip.Constructor=Tooltip,$.fn.tooltip.noConflict=function(){return $.fn.tooltip=old,this}}(jQuery);;
/*!
 * Bootstrap v3.4.1 (http://getbootstrap.com)
 * Copyright 2011-2019 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

!function($){"use strict";var Popover=function(element,options){this.init("popover",element,options)};if(!$.fn.tooltip)throw new Error("Popover requires tooltip.js");function Plugin(option){return this.each((function(){var $this=$(this),data=$this.data("bs.popover"),options="object"==typeof option&&option;!data&&/destroy|hide/.test(option)||(data||$this.data("bs.popover",data=new Popover(this,options)),"string"==typeof option&&data[option]())}))}Popover.VERSION="3.4.1",Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),(Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype)).constructor=Popover,Popover.prototype.getDefaults=function(){return Popover.DEFAULTS},Popover.prototype.setContent=function(){var $tip=this.tip(),title=this.getTitle(),content=this.getContent();if(this.options.html){var typeContent=typeof content;this.options.sanitize&&(title=this.sanitizeHtml(title),"string"===typeContent&&(content=this.sanitizeHtml(content))),$tip.find(".popover-title").html(title),$tip.find(".popover-content").children().detach().end()["string"===typeContent?"html":"append"](content)}else $tip.find(".popover-title").text(title),$tip.find(".popover-content").children().detach().end().text(content);$tip.removeClass("fade top bottom left right in"),$tip.find(".popover-title").html()||$tip.find(".popover-title").hide()},Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent()},Popover.prototype.getContent=function(){var $e=this.$element,o=this.options;return $e.attr("data-content")||("function"==typeof o.content?o.content.call($e[0]):o.content)},Popover.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var old=$.fn.popover;$.fn.popover=Plugin,$.fn.popover.Constructor=Popover,$.fn.popover.noConflict=function(){return $.fn.popover=old,this}}(jQuery);;
/*
 * jsTree 1.0-rc3
 * http://jstree.com/
 *
 * Copyright (c) 2010 Ivan Bozhanov (vakata.com)
 *
 * Licensed same as jquery - under the terms of either the MIT License or the GPL Version 2 License
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * $Date: 2011-02-09 01:17:14 +0200 (ср, 09 февр 2011) $
 * $Revision: 236 $
 */

/*jslint browser: true, onevar: true, undef: true, bitwise: true, strict: true */
/*global window : false, clearInterval: false, clearTimeout: false, document: false, setInterval: false, setTimeout: false, jQuery: false, navigator: false, XSLTProcessor: false, DOMParser: false, XMLSerializer: false*/

"use strict";

// top wrapper to prevent multiple inclusion (is this OK?)
(function () { if(jQuery && jQuery.jstree) { return; }
	var is_ie6 = false, is_ie7 = false, is_ff2 = false;

/* 
 * jsTree core
 */
(function ($) {
	// Common functions not related to jsTree 
	// decided to move them to a `vakata` "namespace"
	$.vakata = {};
	// CSS related functions
	$.vakata.css = {
		get_css : function(rule_name, delete_flag, sheet) {
			rule_name = rule_name.toLowerCase();
			var css_rules = sheet.cssRules || sheet.rules,
				j = 0;
			do {
				if(css_rules.length && j > css_rules.length + 5) { return false; }
				if(css_rules[j].selectorText && css_rules[j].selectorText.toLowerCase() == rule_name) {
					if(delete_flag === true) {
						if(sheet.removeRule) { sheet.removeRule(j); }
						if(sheet.deleteRule) { sheet.deleteRule(j); }
						return true;
					}
					else { return css_rules[j]; }
				}
			}
			while (css_rules[++j]);
			return false;
		},
		add_css : function(rule_name, sheet) {
			if($.jstree.css.get_css(rule_name, false, sheet)) { return false; }
			if(sheet.insertRule) { sheet.insertRule(rule_name + ' { }', 0); } else { sheet.addRule(rule_name, null, 0); }
			return $.vakata.css.get_css(rule_name);
		},
		remove_css : function(rule_name, sheet) { 
			return $.vakata.css.get_css(rule_name, true, sheet); 
		},
		add_sheet : function(opts) {
			var tmp = false, is_new = true;
			if(opts.str) {
				if(opts.title) { tmp = $("style[id='" + opts.title + "-stylesheet']")[0]; }
				if(tmp) { is_new = false; }
				else {
					tmp = document.createElement("style");
					tmp.setAttribute('type',"text/css");
					if(opts.title) { tmp.setAttribute("id", opts.title + "-stylesheet"); }
				}
				if(tmp.styleSheet) {
					if(is_new) { 
						document.getElementsByTagName("head")[0].appendChild(tmp); 
						tmp.styleSheet.cssText = opts.str; 
					}
					else {
						tmp.styleSheet.cssText = tmp.styleSheet.cssText + " " + opts.str; 
					}
				}
				else {
					tmp.appendChild(document.createTextNode(opts.str));
					document.getElementsByTagName("head")[0].appendChild(tmp);
				}
				return tmp.sheet || tmp.styleSheet;
			}
			if(opts.url) {
				if(document.createStyleSheet) {
					try { tmp = document.createStyleSheet(opts.url); } catch (e) { }
				}
				else {
					tmp			= document.createElement('link');
					tmp.rel		= 'stylesheet';
					tmp.type	= 'text/css';
					tmp.media	= "all";
					tmp.href	= opts.url;
					document.getElementsByTagName("head")[0].appendChild(tmp);
					return tmp.styleSheet;
				}
			}
		}
	};

	// private variables 
	var instances = [],			// instance array (used by $.jstree.reference/create/focused)
		focused_instance = -1,	// the index in the instance array of the currently focused instance
		plugins = {},			// list of included plugins
		prepared_move = {};		// for the move_node function

	// jQuery plugin wrapper (thanks to jquery UI widget function)
	$.fn.jstree = function (settings) {
		var isMethodCall = (typeof settings == 'string'), // is this a method call like $().jstree("open_node")
			args = Array.prototype.slice.call(arguments, 1), 
			returnValue = this;

		// if a method call execute the method on all selected instances
		if(isMethodCall) {
			if(settings.substring(0, 1) == '_') { return returnValue; }
			this.each(function() {
				var instance = instances[$.data(this, "jstree_instance_id")],
					methodValue = (instance && $.isFunction(instance[settings])) ? instance[settings].apply(instance, args) : instance;
					if(typeof methodValue !== "undefined" && (settings.indexOf("is_") === 0 || (methodValue !== true && methodValue !== false))) { returnValue = methodValue; return false; }
			});
		}
		else {
			this.each(function() {
				// extend settings and allow for multiple hashes and $.data
				var instance_id = $.data(this, "jstree_instance_id"),
					a = [],
					b = settings ? $.extend({}, true, settings) : {},
					c = $(this), 
					s = false, 
					t = [];
				a = a.concat(args);
				if(c.data("jstree")) { a.push(c.data("jstree")); }
				b = a.length ? $.extend.apply(null, [true, b].concat(a)) : b;

				// if an instance already exists, destroy it first
				if(typeof instance_id !== "undefined" && instances[instance_id]) { instances[instance_id].destroy(); }
				// push a new empty object to the instances array
				instance_id = parseInt(instances.push({}),10) - 1;
				// store the jstree instance id to the container element
				$.data(this, "jstree_instance_id", instance_id);
				// clean up all plugins
				b.plugins = $.isArray(b.plugins) ? b.plugins : $.jstree.defaults.plugins.slice();
				b.plugins.unshift("core");
				// only unique plugins
				b.plugins = b.plugins.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",");

				// extend defaults with passed data
				s = $.extend(true, {}, $.jstree.defaults, b);
				s.plugins = b.plugins;
				$.each(plugins, function (i, val) { 
					if($.inArray(i, s.plugins) === -1) { s[i] = null; delete s[i]; } 
					else { t.push(i); }
				});
				s.plugins = t;

				// push the new object to the instances array (at the same time set the default classes to the container) and init
				instances[instance_id] = new $.jstree._instance(instance_id, $(this).addClass("jstree jstree-" + instance_id), s); 
				// init all activated plugins for this instance
				$.each(instances[instance_id]._get_settings().plugins, function (i, val) { instances[instance_id].data[val] = {}; });
				$.each(instances[instance_id]._get_settings().plugins, function (i, val) { if(plugins[val]) { plugins[val].__init.apply(instances[instance_id]); } });
				// initialize the instance
				setTimeout(function() { if(instances[instance_id]) { instances[instance_id].init(); } }, 0);
			});
		}
		// return the jquery selection (or if it was a method call that returned a value - the returned value)
		return returnValue;
	};
	// object to store exposed functions and objects
	$.jstree = {
		defaults : {
			plugins : []
		},
		_focused : function () { return instances[focused_instance] || null; },
		_reference : function (needle) { 
			// get by instance id
			if(instances[needle]) { return instances[needle]; }
			// get by DOM (if still no luck - return null
			var o = $(needle); 
			if(!o.length && typeof needle === "string") { o = $("#" + needle); }
			if(!o.length) { return null; }
			return instances[o.closest(".jstree").data("jstree_instance_id")] || null; 
		},
		_instance : function (index, container, settings) { 
			// for plugins to store data in
			this.data = { core : {} };
			this.get_settings	= function () { return $.extend(true, {}, settings); };
			this._get_settings	= function () { return settings; };
			this.get_index		= function () { return index; };
			this.get_container	= function () { return container; };
			this.get_container_ul = function () { return container.children("ul:eq(0)"); };
			this._set_settings	= function (s) { 
				settings = $.extend(true, {}, settings, s);
			};
		},
		_fn : { },
		plugin : function (pname, pdata) {
			pdata = $.extend({}, {
				__init		: $.noop, 
				__destroy	: $.noop,
				_fn			: {},
				defaults	: false
			}, pdata);
			plugins[pname] = pdata;

			$.jstree.defaults[pname] = pdata.defaults;
			$.each(pdata._fn, function (i, val) {
				val.plugin		= pname;
				val.old			= $.jstree._fn[i];
				$.jstree._fn[i] = function () {
					var rslt,
						func = val,
						args = Array.prototype.slice.call(arguments),
						evnt = new $.Event("before.jstree"),
						rlbk = false;

					if(this.data.core.locked === true && i !== "unlock" && i !== "is_locked") { return; }

					// Check if function belongs to the included plugins of this instance
					do {
						if(func && func.plugin && $.inArray(func.plugin, this._get_settings().plugins) !== -1) { break; }
						func = func.old;
					} while(func);
					if(!func) { return; }

					// context and function to trigger events, then finally call the function
					if(i.indexOf("_") === 0) {
						rslt = func.apply(this, args);
					}
					else {
						rslt = this.get_container().triggerHandler(evnt, { "func" : i, "inst" : this, "args" : args, "plugin" : func.plugin });
						if(rslt === false) { return; }
						if(typeof rslt !== "undefined") { args = rslt; }

						rslt = func.apply(
							$.extend({}, this, { 
								__callback : function (data) { 
									this.get_container().triggerHandler( i + '.jstree', { "inst" : this, "args" : args, "rslt" : data, "rlbk" : rlbk });
								},
								__rollback : function () { 
									rlbk = this.get_rollback();
									return rlbk;
								},
								__call_old : function (replace_arguments) {
									return func.old.apply(this, (replace_arguments ? Array.prototype.slice.call(arguments, 1) : args ) );
								}
							}), args);
					}

					// return the result
					return rslt;
				};
				$.jstree._fn[i].old = val.old;
				$.jstree._fn[i].plugin = pname;
			});
		},
		rollback : function (rb) {
			if(rb) {
				if(!$.isArray(rb)) { rb = [ rb ]; }
				$.each(rb, function (i, val) {
					instances[val.i].set_rollback(val.h, val.d);
				});
			}
		}
	};
	// set the prototype for all instances
	$.jstree._fn = $.jstree._instance.prototype = {};

	// load the css when DOM is ready
	$(function() {
		// code is copied from jQuery ($.browser is deprecated + there is a bug in IE)
		var u = navigator.userAgent.toLowerCase(),
			v = (u.match( /.+?(?:rv|it|ra|ie)[\/: ]([\d.]+)/ ) || [0,'0'])[1],
			css_string = '' + 
				'.jstree ul, .jstree li { display:block; margin:0 0 0 0; padding:0 0 0 0; list-style-type:none; } ' + 
				'.jstree li { display:block; min-height:18px; line-height:18px; white-space:nowrap; margin-left:18px; min-width:18px; } ' + 
				'.jstree-rtl li { margin-left:0; margin-right:18px; } ' + 
				'.jstree > ul > li { margin-left:0px; } ' + 
				'.jstree-rtl > ul > li { margin-right:0px; } ' + 
				'.jstree ins { display:inline-block; text-decoration:none; width:18px; height:18px; margin:0 0 0 0; padding:0; } ' + 
				'.jstree a { display:inline-block; line-height:16px; height:16px; color:black; white-space:nowrap; text-decoration:none; padding:1px 2px; margin:0; } ' + 
				'.jstree a:focus { outline: none; } ' + 
				'.jstree a > ins { height:16px; width:16px; } ' + 
				'.jstree a > .jstree-icon { margin-right:3px; } ' + 
				'.jstree-rtl a > .jstree-icon { margin-left:3px; margin-right:0; } ' + 
				'li.jstree-open > ul { display:block; } ' + 
				'li.jstree-closed > ul { display:none; } ';
		// Correct IE 6 (does not support the > CSS selector)
		if(/msie/.test(u) && parseInt(v, 10) == 6) { 
			is_ie6 = true;

			// fix image flicker and lack of caching
			try {
				document.execCommand("BackgroundImageCache", false, true);
			} catch (err) { }

			css_string += '' + 
				'.jstree li { height:18px; margin-left:0; margin-right:0; } ' + 
				'.jstree li li { margin-left:18px; } ' + 
				'.jstree-rtl li li { margin-left:0px; margin-right:18px; } ' + 
				'li.jstree-open ul { display:block; } ' + 
				'li.jstree-closed ul { display:none !important; } ' + 
				'.jstree li a { display:inline; border-width:0 !important; padding:0px 2px !important; } ' + 
				'.jstree li a ins { height:16px; width:16px; margin-right:3px; } ' + 
				'.jstree-rtl li a ins { margin-right:0px; margin-left:3px; } ';
		}
		// Correct IE 7 (shifts anchor nodes onhover)
		if(/msie/.test(u) && parseInt(v, 10) == 7) { 
			is_ie7 = true;
			css_string += '.jstree li a { border-width:0 !important; padding:0px 2px !important; } ';
		}
		// correct ff2 lack of display:inline-block
		if(!/compatible/.test(u) && /mozilla/.test(u) && parseFloat(v, 10) < 1.9) {
			is_ff2 = true;
			css_string += '' + 
				'.jstree ins { display:-moz-inline-box; } ' + 
				'.jstree li { line-height:12px; } ' + // WHY??
				'.jstree a { display:-moz-inline-box; } ' + 
				'.jstree .jstree-no-icons .jstree-checkbox { display:-moz-inline-stack !important; } ';
				/* this shouldn't be here as it is theme specific */
		}
		// the default stylesheet
		$.vakata.css.add_sheet({ str : css_string, title : "jstree" });
	});

	// core functions (open, close, create, update, delete)
	$.jstree.plugin("core", {
		__init : function () {
			this.data.core.locked = false;
			this.data.core.to_open = this.get_settings().core.initially_open;
			this.data.core.to_load = this.get_settings().core.initially_load;
		},
		defaults : { 
			html_titles	: false,
			animation	: 500,
			initially_open : [],
			initially_load : [],
			open_parents : true,
			notify_plugins : true,
			rtl			: false,
			load_open	: false,
			strings		: {
				loading		: "Loading ...",
				new_node	: "New node",
				multiple_selection : "Multiple selection"
			}
		},
		_fn : { 
			init	: function () { 
				this.set_focus(); 
				if(this._get_settings().core.rtl) {
					this.get_container().addClass("jstree-rtl").css("direction", "rtl");
				}
				this.get_container().html("<ul><li class='jstree-last jstree-leaf'><ins>&#160;</ins><a class='jstree-loading' href='#'><ins class='jstree-icon'>&#160;</ins>" + this._get_string("loading") + "</a></li></ul>");
				this.data.core.li_height = this.get_container_ul().find("li.jstree-closed, li.jstree-leaf").eq(0).height() || 18;

				this.get_container()
					.delegate("li > ins", "click.jstree", $.proxy(function (event) {
							var trgt = $(event.target);
							// if(trgt.is("ins") && event.pageY - trgt.offset().top < this.data.core.li_height) { this.toggle_node(trgt); }
							this.toggle_node(trgt);
						}, this))
					.bind("mousedown.jstree", $.proxy(function () { 
							this.set_focus(); // This used to be setTimeout(set_focus,0) - why?
						}, this))
					.bind("dblclick.jstree", function (event) { 
						var sel;
						if(document.selection && document.selection.empty) { document.selection.empty(); }
						else {
							if(window.getSelection) {
								sel = window.getSelection();
								try { 
									sel.removeAllRanges();
									sel.collapse();
								} catch (err) { }
							}
						}
					});
				if(this._get_settings().core.notify_plugins) {
					this.get_container()
						.bind("load_node.jstree", $.proxy(function (e, data) { 
								var o = this._get_node(data.rslt.obj),
									t = this;
								if(o === -1) { o = this.get_container_ul(); }
								if(!o.length) { return; }
								o.find("li").each(function () {
									var th = $(this);
									if(th.data("jstree")) {
										$.each(th.data("jstree"), function (plugin, values) {
											if(t.data[plugin] && $.isFunction(t["_" + plugin + "_notify"])) {
												t["_" + plugin + "_notify"].call(t, th, values);
											}
										});
									}
								});
							}, this));
				}
				if(this._get_settings().core.load_open) {
					this.get_container()
						.bind("load_node.jstree", $.proxy(function (e, data) { 
								var o = this._get_node(data.rslt.obj),
									t = this;
								if(o === -1) { o = this.get_container_ul(); }
								if(!o.length) { return; }
								o.find("li.jstree-open:not(:has(ul))").each(function () {
									t.load_node(this, $.noop, $.noop);
								});
							}, this));
				}
				this.__callback();
				this.load_node(-1, function () { this.loaded(); this.reload_nodes(); });
			},
			destroy	: function () { 
				var i,
					n = this.get_index(),
					s = this._get_settings(),
					_this = this;

				$.each(s.plugins, function (i, val) {
					try { plugins[val].__destroy.apply(_this); } catch(err) { }
				});
				this.__callback();
				// set focus to another instance if this one is focused
				if(this.is_focused()) { 
					for(i in instances) { 
						if(instances.hasOwnProperty(i) && i != n) { 
							instances[i].set_focus(); 
							break; 
						} 
					}
				}
				// if no other instance found
				if(n === focused_instance) { focused_instance = -1; }
				// remove all traces of jstree in the DOM (only the ones set using jstree*) and cleans all events
				this.get_container()
					.unbind(".jstree")
					.undelegate(".jstree")
					.removeData("jstree_instance_id")
					.find("[class^='jstree']")
						.andSelf()
						.attr("class", function () { return this.className.replace(/jstree[^ ]*|$/ig,''); });
				$(document)
					.unbind(".jstree-" + n)
					.undelegate(".jstree-" + n);
				// remove the actual data
				instances[n] = null;
				delete instances[n];
			},

			_core_notify : function (n, data) {
				if(data.opened) {
					this.open_node(n, false, true);
				}
			},

			lock : function () {
				this.data.core.locked = true;
				this.get_container().children("ul").addClass("jstree-locked").css("opacity","0.7");
				this.__callback({});
			},
			unlock : function () {
				this.data.core.locked = false;
				this.get_container().children("ul").removeClass("jstree-locked").css("opacity","1");
				this.__callback({});
			},
			is_locked : function () { return this.data.core.locked; },
			save_opened : function () {
				var _this = this;
				this.data.core.to_open = [];
				this.get_container_ul().find("li.jstree-open").each(function () { 
					if(this.id) { _this.data.core.to_open.push("#" + this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")); }
				});
				this.__callback(_this.data.core.to_open);
			},
			save_loaded : function () { },
			reload_nodes : function (is_callback) {
				var _this = this,
					done = true,
					current = [],
					remaining = [];
				if(!is_callback) { 
					this.data.core.reopen = false; 
					this.data.core.refreshing = true; 
					this.data.core.to_open = $.map($.makeArray(this.data.core.to_open), function (n) { return "#" + n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"); });
					this.data.core.to_load = $.map($.makeArray(this.data.core.to_load), function (n) { return "#" + n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"); });
					if(this.data.core.to_open.length) {
						this.data.core.to_load = this.data.core.to_load.concat(this.data.core.to_open);
					}
				}
				if(this.data.core.to_load.length) {
					$.each(this.data.core.to_load, function (i, val) {
						if(val == "#") { return true; }
						if($(val).length) { current.push(val); }
						else { remaining.push(val); }
					});
					if(current.length) {
						this.data.core.to_load = remaining;
						$.each(current, function (i, val) { 
							if(!_this._is_loaded(val)) {
								_this.load_node(val, function () { _this.reload_nodes(true); }, function () { _this.reload_nodes(true); });
								done = false;
							}
						});
					}
				}
				if(this.data.core.to_open.length) {
					$.each(this.data.core.to_open, function (i, val) {
						_this.open_node(val, false, true); 
					});
				}
				if(done) { 
					// TODO: find a more elegant approach to syncronizing returning requests
					if(this.data.core.reopen) { clearTimeout(this.data.core.reopen); }
					this.data.core.reopen = setTimeout(function () { _this.__callback({}, _this); }, 50);
					this.data.core.refreshing = false;
					this.reopen();
				}
			},
			reopen : function () {
				var _this = this;
				if(this.data.core.to_open.length) {
					$.each(this.data.core.to_open, function (i, val) {
						_this.open_node(val, false, true); 
					});
				}
				this.__callback({});
			},
			refresh : function (obj) {
				var _this = this;
				this.save_opened();
				if(!obj) { obj = -1; }
				obj = this._get_node(obj);
				if(!obj) { obj = -1; }
				if(obj !== -1) { obj.children("UL").remove(); }
				else { this.get_container_ul().empty(); }
				this.load_node(obj, function () { _this.__callback({ "obj" : obj}); _this.reload_nodes(); });
			},
			// Dummy function to fire after the first load (so that there is a jstree.loaded event)
			loaded	: function () { 
				this.__callback(); 
			},
			// deal with focus
			set_focus	: function () { 
				if(this.is_focused()) { return; }
				var f = $.jstree._focused();
				if(f) { f.unset_focus(); }

				this.get_container().addClass("jstree-focused"); 
				focused_instance = this.get_index(); 
				this.__callback();
			},
			is_focused	: function () { 
				return focused_instance == this.get_index(); 
			},
			unset_focus	: function () {
				if(this.is_focused()) {
					this.get_container().removeClass("jstree-focused"); 
					focused_instance = -1; 
				}
				this.__callback();
			},

			// traverse
			_get_node		: function (obj) { 
				var $obj = $(obj, this.get_container()); 
				if($obj.is(".jstree") || obj == -1) { return -1; } 
				$obj = $obj.closest("li", this.get_container()); 
				return $obj.length ? $obj : false; 
			},
			_get_next		: function (obj, strict) {
				obj = this._get_node(obj);
				if(obj === -1) { return this.get_container().find("> ul > li:first-child"); }
				if(!obj.length) { return false; }
				if(strict) { return (obj.nextAll("li").size() > 0) ? obj.nextAll("li:eq(0)") : false; }

				if(obj.hasClass("jstree-open")) { return obj.find("li:eq(0)"); }
				else if(obj.nextAll("li").size() > 0) { return obj.nextAll("li:eq(0)"); }
				else { return obj.parentsUntil(".jstree","li").next("li").eq(0); }
			},
			_get_prev		: function (obj, strict) {
				obj = this._get_node(obj);
				if(obj === -1) { return this.get_container().find("> ul > li:last-child"); }
				if(!obj.length) { return false; }
				if(strict) { return (obj.prevAll("li").length > 0) ? obj.prevAll("li:eq(0)") : false; }

				if(obj.prev("li").length) {
					obj = obj.prev("li").eq(0);
					while(obj.hasClass("jstree-open")) { obj = obj.children("ul:eq(0)").children("li:last"); }
					return obj;
				}
				else { var o = obj.parentsUntil(".jstree","li:eq(0)"); return o.length ? o : false; }
			},
			_get_parent		: function (obj) {
				obj = this._get_node(obj);
				if(obj == -1 || !obj.length) { return false; }
				var o = obj.parentsUntil(".jstree", "li:eq(0)");
				return o.length ? o : -1;
			},
			_get_children	: function (obj) {
				obj = this._get_node(obj);
				if(obj === -1) { return this.get_container().children("ul:eq(0)").children("li"); }
				if(!obj.length) { return false; }
				return obj.children("ul:eq(0)").children("li");
			},
			get_path		: function (obj, id_mode) {
				var p = [],
					_this = this;
				obj = this._get_node(obj);
				if(obj === -1 || !obj || !obj.length) { return false; }
				obj.parentsUntil(".jstree", "li").each(function () {
					p.push( id_mode ? this.id : _this.get_text(this) );
				});
				p.reverse();
				p.push( id_mode ? obj.attr("id") : this.get_text(obj) );
				return p;
			},

			// string functions
			_get_string : function (key) {
				return this._get_settings().core.strings[key] || key;
			},

			is_open		: function (obj) { obj = this._get_node(obj); return obj && obj !== -1 && obj.hasClass("jstree-open"); },
			is_closed	: function (obj) { obj = this._get_node(obj); return obj && obj !== -1 && obj.hasClass("jstree-closed"); },
			is_leaf		: function (obj) { obj = this._get_node(obj); return obj && obj !== -1 && obj.hasClass("jstree-leaf"); },
			correct_state	: function (obj) {
				obj = this._get_node(obj);
				if(!obj || obj === -1) { return false; }
				obj.removeClass("jstree-closed jstree-open").addClass("jstree-leaf").children("ul").remove();
				this.__callback({ "obj" : obj });
			},
			// open/close
			open_node	: function (obj, callback, skip_animation) {
				obj = this._get_node(obj);
				if(!obj.length) { return false; }
				if(!obj.hasClass("jstree-closed")) { if(callback) { callback.call(); } return false; }
				var s = skip_animation || is_ie6 ? 0 : this._get_settings().core.animation,
					t = this;
				if(!this._is_loaded(obj)) {
					obj.children("a").addClass("jstree-loading");
					this.load_node(obj, function () { t.open_node(obj, callback, skip_animation); }, callback);
				}
				else {
					if(this._get_settings().core.open_parents) {
						obj.parentsUntil(".jstree",".jstree-closed").each(function () {
							t.open_node(this, false, true);
						});
					}
					if(s) { obj.children("ul").css("display","none"); }
					obj.removeClass("jstree-closed").addClass("jstree-open").children("a").removeClass("jstree-loading");
					if(s) { obj.children("ul").stop(true, true).slideDown(s, function () { this.style.display = ""; t.after_open(obj); }); }
					else { t.after_open(obj); }
					this.__callback({ "obj" : obj });
					if(callback) { callback.call(); }
				}
			},
			after_open	: function (obj) { this.__callback({ "obj" : obj }); },
			close_node	: function (obj, skip_animation) {
				obj = this._get_node(obj);
				var s = skip_animation || is_ie6 ? 0 : this._get_settings().core.animation,
					t = this;
				if(!obj.length || !obj.hasClass("jstree-open")) { return false; }
				if(s) { obj.children("ul").attr("style","display:block !important"); }
				obj.removeClass("jstree-open").addClass("jstree-closed");
				if(s) { obj.children("ul").stop(true, true).slideUp(s, function () { this.style.display = ""; t.after_close(obj); }); }
				else { t.after_close(obj); }
				this.__callback({ "obj" : obj });
			},
			after_close	: function (obj) { this.__callback({ "obj" : obj }); },
			toggle_node	: function (obj) {
				obj = this._get_node(obj);
				if(obj.hasClass("jstree-closed")) { return this.open_node(obj); }
				if(obj.hasClass("jstree-open")) { return this.close_node(obj); }
			},
			open_all	: function (obj, do_animation, original_obj) {
				obj = obj ? this._get_node(obj) : -1;
				if(!obj || obj === -1) { obj = this.get_container_ul(); }
				if(original_obj) { 
					obj = obj.find("li.jstree-closed");
				}
				else {
					original_obj = obj;
					if(obj.is(".jstree-closed")) { obj = obj.find("li.jstree-closed").andSelf(); }
					else { obj = obj.find("li.jstree-closed"); }
				}
				var _this = this;
				obj.each(function () { 
					var __this = this; 
					if(!_this._is_loaded(this)) { _this.open_node(this, function() { _this.open_all(__this, do_animation, original_obj); }, !do_animation); }
					else { _this.open_node(this, false, !do_animation); }
				});
				// so that callback is fired AFTER all nodes are open
				if(original_obj.find('li.jstree-closed').length === 0) { this.__callback({ "obj" : original_obj }); }
			},
			close_all	: function (obj, do_animation) {
				var _this = this;
				obj = obj ? this._get_node(obj) : this.get_container();
				if(!obj || obj === -1) { obj = this.get_container_ul(); }
				obj.find("li.jstree-open").andSelf().each(function () { _this.close_node(this, !do_animation); });
				this.__callback({ "obj" : obj });
			},
			clean_node	: function (obj) {
				obj = obj && obj != -1 ? $(obj) : this.get_container_ul();
				obj = obj.is("li") ? obj.find("li").andSelf() : obj.find("li");
				obj.removeClass("jstree-last")
					.filter("li:last-child").addClass("jstree-last").end()
					.filter(":has(li)")
						.not(".jstree-open").removeClass("jstree-leaf").addClass("jstree-closed");
				obj.not(".jstree-open, .jstree-closed").addClass("jstree-leaf").children("ul").remove();
				this.__callback({ "obj" : obj });
			},
			// rollback
			get_rollback : function () { 
				this.__callback();
				return { i : this.get_index(), h : this.get_container().children("ul").clone(true), d : this.data }; 
			},
			set_rollback : function (html, data) {
				this.get_container().empty().append(html);
				this.data = data;
				this.__callback();
			},
			// Dummy functions to be overwritten by any datastore plugin included
			load_node	: function (obj, s_call, e_call) { this.__callback({ "obj" : obj }); },
			_is_loaded	: function (obj) { return true; },

			// Basic operations: create
			create_node	: function (obj, position, js, callback, is_loaded) {
				obj = this._get_node(obj);
				position = typeof position === "undefined" ? "last" : position;
				var d = $("<li />"),
					s = this._get_settings().core,
					tmp;

				if(obj !== -1 && !obj.length) { return false; }
				if(!is_loaded && !this._is_loaded(obj)) { this.load_node(obj, function () { this.create_node(obj, position, js, callback, true); }); return false; }

				this.__rollback();

				if(typeof js === "string") { js = { "data" : js }; }
				if(!js) { js = {}; }
				if(js.attr) { d.attr(js.attr); }
				if(js.metadata) { d.data(js.metadata); }
				if(js.state) { d.addClass("jstree-" + js.state); }
				if(!js.data) { js.data = this._get_string("new_node"); }
				if(!$.isArray(js.data)) { tmp = js.data; js.data = []; js.data.push(tmp); }
				$.each(js.data, function (i, m) {
					tmp = $("<a />");
					if($.isFunction(m)) { m = m.call(this, js); }
					if(typeof m == "string") { tmp.attr('href','#')[ s.html_titles ? "html" : "text" ](m); }
					else {
						if(!m.attr) { m.attr = {}; }
						if(!m.attr.href) { m.attr.href = '#'; }
						tmp.attr(m.attr)[ s.html_titles ? "html" : "text" ](m.title);
						if(m.language) { tmp.addClass(m.language); }
					}
					tmp.prepend("<ins class='jstree-icon'>&#160;</ins>");
					if(!m.icon && js.icon) { m.icon = js.icon; }
					if(m.icon) { 
						if(m.icon.indexOf("/") === -1) { tmp.children("ins").addClass(m.icon); }
						else { tmp.children("ins").css("background","url('" + m.icon + "') center center no-repeat"); }
					}
					d.append(tmp);
				});
				d.prepend("<ins class='jstree-icon'>&#160;</ins>");
				if(obj === -1) {
					obj = this.get_container();
					if(position === "before") { position = "first"; }
					if(position === "after") { position = "last"; }
				}
				switch(position) {
					case "before": obj.before(d); tmp = this._get_parent(obj); break;
					case "after" : obj.after(d);  tmp = this._get_parent(obj); break;
					case "inside":
					case "first" :
						if(!obj.children("ul").length) { obj.append("<ul />"); }
						obj.children("ul").prepend(d);
						tmp = obj;
						break;
					case "last":
						if(!obj.children("ul").length) { obj.append("<ul />"); }
						obj.children("ul").append(d);
						tmp = obj;
						break;
					default:
						if(!obj.children("ul").length) { obj.append("<ul />"); }
						if(!position) { position = 0; }
						tmp = obj.children("ul").children("li").eq(position);
						if(tmp.length) { tmp.before(d); }
						else { obj.children("ul").append(d); }
						tmp = obj;
						break;
				}
				if(tmp === -1 || tmp.get(0) === this.get_container().get(0)) { tmp = -1; }
				this.clean_node(tmp);
				this.__callback({ "obj" : d, "parent" : tmp });
				if(callback) { callback.call(this, d); }
				return d;
			},
			// Basic operations: rename (deal with text)
			get_text	: function (obj) {
				obj = this._get_node(obj);
				if(!obj.length) { return false; }
				var s = this._get_settings().core.html_titles;
				obj = obj.children("a:eq(0)");
				if(s) {
					obj = obj.clone();
					obj.children("INS").remove();
					return obj.html();
				}
				else {
					obj = obj.contents().filter(function() { return this.nodeType == 3; })[0];
					return obj.nodeValue;
				}
			},
			set_text	: function (obj, val) {
				obj = this._get_node(obj);
				if(!obj.length) { return false; }
				obj = obj.children("a:eq(0)");
				if(this._get_settings().core.html_titles) {
					var tmp = obj.children("INS").clone();
					obj.html(val).prepend(tmp);
					this.__callback({ "obj" : obj, "name" : val });
					return true;
				}
				else {
					obj = obj.contents().filter(function() { return this.nodeType == 3; })[0];
					this.__callback({ "obj" : obj, "name" : val });
					return (obj.nodeValue = val);
				}
			},
			rename_node : function (obj, val) {
				obj = this._get_node(obj);
				this.__rollback();
				if(obj && obj.length && this.set_text.apply(this, Array.prototype.slice.call(arguments))) { this.__callback({ "obj" : obj, "name" : val }); }
			},
			// Basic operations: deleting nodes
			delete_node : function (obj) {
				obj = this._get_node(obj);
				if(!obj.length) { return false; }
				this.__rollback();
				var p = this._get_parent(obj), prev = $([]), t = this;
				obj.each(function () {
					prev = prev.add(t._get_prev(this));
				});
				obj = obj.detach();
				if(p !== -1 && p.find("> ul > li").length === 0) {
					p.removeClass("jstree-open jstree-closed").addClass("jstree-leaf");
				}
				this.clean_node(p);
				this.__callback({ "obj" : obj, "prev" : prev, "parent" : p });
				return obj;
			},
			prepare_move : function (o, r, pos, cb, is_cb) {
				var p = {};

				p.ot = $.jstree._reference(o) || this;
				p.o = p.ot._get_node(o);
				p.r = r === - 1 ? -1 : this._get_node(r);
				p.p = (typeof pos === "undefined" || pos === false) ? "last" : pos; // TODO: move to a setting
				if(!is_cb && prepared_move.o && prepared_move.o[0] === p.o[0] && prepared_move.r[0] === p.r[0] && prepared_move.p === p.p) {
					this.__callback(prepared_move);
					if(cb) { cb.call(this, prepared_move); }
					return;
				}
				p.ot = $.jstree._reference(p.o) || this;
				p.rt = $.jstree._reference(p.r) || this; // r === -1 ? p.ot : $.jstree._reference(p.r) || this
				if(p.r === -1 || !p.r) {
					p.cr = -1;
					switch(p.p) {
						case "first":
						case "before":
						case "inside":
							p.cp = 0; 
							break;
						case "after":
						case "last":
							p.cp = p.rt.get_container().find(" > ul > li").length; 
							break;
						default:
							p.cp = p.p;
							break;
					}
				}
				else {
					if(!/^(before|after)$/.test(p.p) && !this._is_loaded(p.r)) {
						return this.load_node(p.r, function () { this.prepare_move(o, r, pos, cb, true); });
					}
					switch(p.p) {
						case "before":
							p.cp = p.r.index();
							p.cr = p.rt._get_parent(p.r);
							break;
						case "after":
							p.cp = p.r.index() + 1;
							p.cr = p.rt._get_parent(p.r);
							break;
						case "inside":
						case "first":
							p.cp = 0;
							p.cr = p.r;
							break;
						case "last":
							p.cp = p.r.find(" > ul > li").length; 
							p.cr = p.r;
							break;
						default: 
							p.cp = p.p;
							p.cr = p.r;
							break;
					}
				}
				p.np = p.cr == -1 ? p.rt.get_container() : p.cr;
				p.op = p.ot._get_parent(p.o);
				p.cop = p.o.index();
				if(p.op === -1) { p.op = p.ot ? p.ot.get_container() : this.get_container(); }
				if(!/^(before|after)$/.test(p.p) && p.op && p.np && p.op[0] === p.np[0] && p.o.index() < p.cp) { p.cp++; }
				//if(p.p === "before" && p.op && p.np && p.op[0] === p.np[0] && p.o.index() < p.cp) { p.cp--; }
				p.or = p.np.find(" > ul > li:nth-child(" + (p.cp + 1) + ")");
				prepared_move = p;
				this.__callback(prepared_move);
				if(cb) { cb.call(this, prepared_move); }
			},
			check_move : function () {
				var obj = prepared_move, ret = true, r = obj.r === -1 ? this.get_container() : obj.r;
				if(!obj || !obj.o || obj.or[0] === obj.o[0]) { return false; }
				if(obj.op && obj.np && obj.op[0] === obj.np[0] && obj.cp - 1 === obj.o.index()) { return false; }
				obj.o.each(function () { 
					if(r.parentsUntil(".jstree", "li").andSelf().index(this) !== -1) { ret = false; return false; }
				});
				return ret;
			},
			move_node : function (obj, ref, position, is_copy, is_prepared, skip_check) {
				if(!is_prepared) { 
					return this.prepare_move(obj, ref, position, function (p) {
						this.move_node(p, false, false, is_copy, true, skip_check);
					});
				}
				if(is_copy) { 
					prepared_move.cy = true;
				}
				if(!skip_check && !this.check_move()) { return false; }

				this.__rollback();
				var o = false;
				if(is_copy) {
					o = obj.o.clone(true);
					o.find("*[id]").andSelf().each(function () {
						if(this.id) { this.id = "copy_" + this.id; }
					});
				}
				else { o = obj.o; }

				if(obj.or.length) { obj.or.before(o); }
				else { 
					if(!obj.np.children("ul").length) { $("<ul />").appendTo(obj.np); }
					obj.np.children("ul:eq(0)").append(o); 
				}

				try { 
					obj.ot.clean_node(obj.op);
					obj.rt.clean_node(obj.np);
					if(!obj.op.find("> ul > li").length) {
						obj.op.removeClass("jstree-open jstree-closed").addClass("jstree-leaf").children("ul").remove();
					}
				} catch (e) { }

				if(is_copy) { 
					prepared_move.cy = true;
					prepared_move.oc = o; 
				}
				this.__callback(prepared_move);
				return prepared_move;
			},
			_get_move : function () { return prepared_move; }
		}
	});
})(jQuery);
//*/

/* 
 * jsTree ui plugin
 * This plugins handles selecting/deselecting/hovering/dehovering nodes
 */
(function ($) {
	var scrollbar_width, e1, e2;
	$(function() {
		if (/msie/.test(navigator.userAgent.toLowerCase())) {
			e1 = $('<textarea cols="10" rows="2"></textarea>').css({ position: 'absolute', top: -1000, left: 0 }).appendTo('body');
			e2 = $('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({ position: 'absolute', top: -1000, left: 0 }).appendTo('body');
			scrollbar_width = e1.width() - e2.width();
			e1.add(e2).remove();
		} 
		else {
			e1 = $('<div />').css({ width: 100, height: 100, overflow: 'auto', position: 'absolute', top: -1000, left: 0 })
					.prependTo('body').append('<div />').find('div').css({ width: '100%', height: 200 });
			scrollbar_width = 100 - e1.width();
			e1.parent().remove();
		}
	});
	$.jstree.plugin("ui", {
		__init : function () { 
			this.data.ui.selected = $(); 
			this.data.ui.last_selected = false; 
			this.data.ui.hovered = null;
			this.data.ui.to_select = this.get_settings().ui.initially_select;

			this.get_container()
				.delegate("a", "click.jstree", $.proxy(function (event) {
						event.preventDefault();
						event.currentTarget.blur();
						if(!$(event.currentTarget).hasClass("jstree-loading")) {
							this.select_node(event.currentTarget, true, event);
						}
					}, this))
				.delegate("a", "mouseenter.jstree", $.proxy(function (event) {
						if(!$(event.currentTarget).hasClass("jstree-loading")) {
							this.hover_node(event.target);
						}
					}, this))
				.delegate("a", "mouseleave.jstree", $.proxy(function (event) {
						if(!$(event.currentTarget).hasClass("jstree-loading")) {
							this.dehover_node(event.target);
						}
					}, this))
				.bind("reopen.jstree", $.proxy(function () { 
						this.reselect();
					}, this))
				.bind("get_rollback.jstree", $.proxy(function () { 
						this.dehover_node();
						this.save_selected();
					}, this))
				.bind("set_rollback.jstree", $.proxy(function () { 
						this.reselect();
					}, this))
				.bind("close_node.jstree", $.proxy(function (event, data) { 
						var s = this._get_settings().ui,
							obj = this._get_node(data.rslt.obj),
							clk = (obj && obj.length) ? obj.children("ul").find("a.jstree-clicked") : $(),
							_this = this;
						if(s.selected_parent_close === false || !clk.length) { return; }
						clk.each(function () { 
							_this.deselect_node(this);
							if(s.selected_parent_close === "select_parent") { _this.select_node(obj); }
						});
					}, this))
				.bind("delete_node.jstree", $.proxy(function (event, data) { 
						var s = this._get_settings().ui.select_prev_on_delete,
							obj = this._get_node(data.rslt.obj),
							clk = (obj && obj.length) ? obj.find("a.jstree-clicked") : [],
							_this = this;
						clk.each(function () { _this.deselect_node(this); });
						if(s && clk.length) { 
							data.rslt.prev.each(function () { 
								if(this.parentNode) { _this.select_node(this); return false; /* if return false is removed all prev nodes will be selected */}
							});
						}
					}, this))
				.bind("move_node.jstree", $.proxy(function (event, data) { 
						if(data.rslt.cy) { 
							data.rslt.oc.find("a.jstree-clicked").removeClass("jstree-clicked");
						}
					}, this));
		},
		defaults : {
			select_limit : -1, // 0, 1, 2 ... or -1 for unlimited
			select_multiple_modifier : "ctrl", // on, or ctrl, shift, alt
			select_range_modifier : "shift",
			selected_parent_close : "select_parent", // false, "deselect", "select_parent"
			selected_parent_open : true,
			select_prev_on_delete : true,
			disable_selecting_children : false,
			initially_select : []
		},
		_fn : { 
			_get_node : function (obj, allow_multiple) {
				if(typeof obj === "undefined" || obj === null) { return allow_multiple ? this.data.ui.selected : this.data.ui.last_selected; }
				var $obj = $(obj, this.get_container()); 
				if($obj.is(".jstree") || obj == -1) { return -1; } 
				$obj = $obj.closest("li", this.get_container()); 
				return $obj.length ? $obj : false; 
			},
			_ui_notify : function (n, data) {
				if(data.selected) {
					this.select_node(n, false);
				}
			},
			save_selected : function () {
				var _this = this;
				this.data.ui.to_select = [];
				this.data.ui.selected.each(function () { if(this.id) { _this.data.ui.to_select.push("#" + this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")); } });
				this.__callback(this.data.ui.to_select);
			},
			reselect : function () {
				var _this = this,
					s = this.data.ui.to_select;
				s = $.map($.makeArray(s), function (n) { return "#" + n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"); });
				// this.deselect_all(); WHY deselect, breaks plugin state notifier?
				$.each(s, function (i, val) { if(val && val !== "#") { _this.select_node(val); } });
				this.data.ui.selected = this.data.ui.selected.filter(function () { return this.parentNode; });
				this.__callback();
			},
			refresh : function (obj) {
				this.save_selected();
				return this.__call_old();
			},
			hover_node : function (obj) {
				obj = this._get_node(obj);
				if(!obj.length) { return false; }
				//if(this.data.ui.hovered && obj.get(0) === this.data.ui.hovered.get(0)) { return; }
				if(!obj.hasClass("jstree-hovered")) { this.dehover_node(); }
				this.data.ui.hovered = obj.children("a").addClass("jstree-hovered").parent();
				this._fix_scroll(obj);
				this.__callback({ "obj" : obj });
			},
			dehover_node : function () {
				var obj = this.data.ui.hovered, p;
				if(!obj || !obj.length) { return false; }
				p = obj.children("a").removeClass("jstree-hovered").parent();
				if(this.data.ui.hovered[0] === p[0]) { this.data.ui.hovered = null; }
				this.__callback({ "obj" : obj });
			},
			select_node : function (obj, check, e) {
				obj = this._get_node(obj);
				if(obj == -1 || !obj || !obj.length) { return false; }
				var s = this._get_settings().ui,
					is_multiple = (s.select_multiple_modifier == "on" || (s.select_multiple_modifier !== false && e && e[s.select_multiple_modifier + "Key"])),
					is_range = (s.select_range_modifier !== false && e && e[s.select_range_modifier + "Key"] && this.data.ui.last_selected && this.data.ui.last_selected[0] !== obj[0] && this.data.ui.last_selected.parent()[0] === obj.parent()[0]),
					is_selected = this.is_selected(obj),
					proceed = true,
					t = this;
				if(check) {
					if(s.disable_selecting_children && is_multiple && 
						(
							(obj.parentsUntil(".jstree","li").children("a.jstree-clicked").length) ||
							(obj.children("ul").find("a.jstree-clicked:eq(0)").length)
						)
					) {
						return false;
					}
					proceed = false;
					switch(!0) {
						case (is_range):
							this.data.ui.last_selected.addClass("jstree-last-selected");
							obj = obj[ obj.index() < this.data.ui.last_selected.index() ? "nextUntil" : "prevUntil" ](".jstree-last-selected").andSelf();
							if(s.select_limit == -1 || obj.length < s.select_limit) {
								this.data.ui.last_selected.removeClass("jstree-last-selected");
								this.data.ui.selected.each(function () {
									if(this !== t.data.ui.last_selected[0]) { t.deselect_node(this); }
								});
								is_selected = false;
								proceed = true;
							}
							else {
								proceed = false;
							}
							break;
						case (is_selected && !is_multiple): 
							this.deselect_all();
							is_selected = false;
							proceed = true;
							break;
						case (!is_selected && !is_multiple): 
							if(s.select_limit == -1 || s.select_limit > 0) {
								this.deselect_all();
								proceed = true;
							}
							break;
						case (is_selected && is_multiple): 
							this.deselect_node(obj);
							break;
						case (!is_selected && is_multiple): 
							if(s.select_limit == -1 || this.data.ui.selected.length + 1 <= s.select_limit) { 
								proceed = true;
							}
							break;
					}
				}
				if(proceed && !is_selected) {
					if(!is_range) { this.data.ui.last_selected = obj; }
					obj.children("a").addClass("jstree-clicked");
					if(s.selected_parent_open) {
						obj.parents(".jstree-closed").each(function () { t.open_node(this, false, true); });
					}
					this.data.ui.selected = this.data.ui.selected.add(obj);
					this._fix_scroll(obj.eq(0));
					this.__callback({ "obj" : obj, "e" : e });
				}
			},
			_fix_scroll : function (obj) {
				var c = this.get_container()[0], t;
				if(c.scrollHeight > c.offsetHeight) {
					obj = this._get_node(obj);
					if(!obj || obj === -1 || !obj.length || !obj.is(":visible")) { return; }
					t = obj.offset().top - this.get_container().offset().top;
					if(t < 0) { 
						c.scrollTop = c.scrollTop + t - 1; 
					}
					if(t + this.data.core.li_height + (c.scrollWidth > c.offsetWidth ? scrollbar_width : 0) > c.offsetHeight) { 
						c.scrollTop = c.scrollTop + (t - c.offsetHeight + this.data.core.li_height + 1 + (c.scrollWidth > c.offsetWidth ? scrollbar_width : 0)); 
					}
				}
			},
			deselect_node : function (obj) {
				obj = this._get_node(obj);
				if(!obj.length) { return false; }
				if(this.is_selected(obj)) {
					obj.children("a").removeClass("jstree-clicked");
					this.data.ui.selected = this.data.ui.selected.not(obj);
					if(this.data.ui.last_selected.get(0) === obj.get(0)) { this.data.ui.last_selected = this.data.ui.selected.eq(0); }
					this.__callback({ "obj" : obj });
				}
			},
			toggle_select : function (obj) {
				obj = this._get_node(obj);
				if(!obj.length) { return false; }
				if(this.is_selected(obj)) { this.deselect_node(obj); }
				else { this.select_node(obj); }
			},
			is_selected : function (obj) { return this.data.ui.selected.index(this._get_node(obj)) >= 0; },
			get_selected : function (context) { 
				return context ? $(context).find("a.jstree-clicked").parent() : this.data.ui.selected; 
			},
			deselect_all : function (context) {
				var ret = context ? $(context).find("a.jstree-clicked").parent() : this.get_container().find("a.jstree-clicked").parent();
				ret.children("a.jstree-clicked").removeClass("jstree-clicked");
				this.data.ui.selected = $([]);
				this.data.ui.last_selected = false;
				this.__callback({ "obj" : ret });
			}
		}
	});
	// include the selection plugin by default
	$.jstree.defaults.plugins.push("ui");
})(jQuery);
//*/

/* 
 * jsTree CRRM plugin
 * Handles creating/renaming/removing/moving nodes by user interaction.
 */
(function ($) {
	$.jstree.plugin("crrm", { 
		__init : function () {
			this.get_container()
				.bind("move_node.jstree", $.proxy(function (e, data) {
					if(this._get_settings().crrm.move.open_onmove) {
						var t = this;
						data.rslt.np.parentsUntil(".jstree").andSelf().filter(".jstree-closed").each(function () {
							t.open_node(this, false, true);
						});
					}
				}, this));
		},
		defaults : {
			input_width_limit : 200,
			move : {
				always_copy			: false, // false, true or "multitree"
				open_onmove			: true,
				default_position	: "last",
				check_move			: function (m) { return true; }
			}
		},
		_fn : {
			_show_input : function (obj, callback) {
				obj = this._get_node(obj);
				var rtl = this._get_settings().core.rtl,
					w = this._get_settings().crrm.input_width_limit,
					w1 = obj.children("ins").width(),
					w2 = obj.find("> a:visible > ins").width() * obj.find("> a:visible > ins").length,
					t = this.get_text(obj),
					h1 = $("<div />", { css : { "position" : "absolute", "top" : "-200px", "left" : (rtl ? "0px" : "-1000px"), "visibility" : "hidden" } }).appendTo("body"),
					h2 = obj.css("position","relative").append(
					$("<input />", { 
						"value" : t,
						"class" : "jstree-rename-input",
						// "size" : t.length,
						"css" : {
							"padding" : "0",
							"border" : "1px solid silver",
							"position" : "absolute",
							"left"  : (rtl ? "auto" : (w1 + w2 + 4) + "px"),
							"right" : (rtl ? (w1 + w2 + 4) + "px" : "auto"),
							"top" : "0px",
							"height" : (this.data.core.li_height - 2) + "px",
							"lineHeight" : (this.data.core.li_height - 2) + "px",
							"width" : "150px" // will be set a bit further down
						},
						"blur" : $.proxy(function () {
							var i = obj.children(".jstree-rename-input"),
								v = i.val();
							if(v === "") { v = t; }
							h1.remove();
							i.remove(); // rollback purposes
							this.set_text(obj,t); // rollback purposes
							this.rename_node(obj, v);
							callback.call(this, obj, v, t);
							obj.css("position","");
						}, this),
						"keyup" : function (event) {
							var key = event.keyCode || event.which;
							if(key == 27) { this.value = t; this.blur(); return; }
							else if(key == 13) { this.blur(); return; }
							else {
								h2.width(Math.min(h1.text("pW" + this.value).width(),w));
							}
						},
						"keypress" : function(event) {
							var key = event.keyCode || event.which;
							if(key == 13) { return false; }
						}
					})
				).children(".jstree-rename-input"); 
				this.set_text(obj, "");
				h1.css({
						fontFamily		: h2.css('fontFamily')		|| '',
						fontSize		: h2.css('fontSize')		|| '',
						fontWeight		: h2.css('fontWeight')		|| '',
						fontStyle		: h2.css('fontStyle')		|| '',
						fontStretch		: h2.css('fontStretch')		|| '',
						fontVariant		: h2.css('fontVariant')		|| '',
						letterSpacing	: h2.css('letterSpacing')	|| '',
						wordSpacing		: h2.css('wordSpacing')		|| ''
				});
				h2.width(Math.min(h1.text("pW" + h2[0].value).width(),w))[0].select();
			},
			rename : function (obj) {
				obj = this._get_node(obj);
				this.__rollback();
				var f = this.__callback;
				this._show_input(obj, function (obj, new_name, old_name) { 
					f.call(this, { "obj" : obj, "new_name" : new_name, "old_name" : old_name });
				});
			},
			create : function (obj, position, js, callback, skip_rename) {
				var t, _this = this;
				obj = this._get_node(obj);
				if(!obj) { obj = -1; }
				this.__rollback();
				t = this.create_node(obj, position, js, function (t) {
					var p = this._get_parent(t),
						pos = $(t).index();
					if(callback) { callback.call(this, t); }
					if(p.length && p.hasClass("jstree-closed")) { this.open_node(p, false, true); }
					if(!skip_rename) { 
						this._show_input(t, function (obj, new_name, old_name) { 
							_this.__callback({ "obj" : obj, "name" : new_name, "parent" : p, "position" : pos });
						});
					}
					else { _this.__callback({ "obj" : t, "name" : this.get_text(t), "parent" : p, "position" : pos }); }
				});
				return t;
			},
			remove : function (obj) {
				obj = this._get_node(obj, true);
				var p = this._get_parent(obj), prev = this._get_prev(obj);
				this.__rollback();
				obj = this.delete_node(obj);
				if(obj !== false) { this.__callback({ "obj" : obj, "prev" : prev, "parent" : p }); }
			},
			check_move : function () {
				if(!this.__call_old()) { return false; }
				var s = this._get_settings().crrm.move;
				if(!s.check_move.call(this, this._get_move())) { return false; }
				return true;
			},
			move_node : function (obj, ref, position, is_copy, is_prepared, skip_check) {
				var s = this._get_settings().crrm.move;
				if(!is_prepared) { 
					if(typeof position === "undefined") { position = s.default_position; }
					if(position === "inside" && !s.default_position.match(/^(before|after)$/)) { position = s.default_position; }
					return this.__call_old(true, obj, ref, position, is_copy, false, skip_check);
				}
				// if the move is already prepared
				if(s.always_copy === true || (s.always_copy === "multitree" && obj.rt.get_index() !== obj.ot.get_index() )) {
					is_copy = true;
				}
				this.__call_old(true, obj, ref, position, is_copy, true, skip_check);
			},

			cut : function (obj) {
				obj = this._get_node(obj, true);
				if(!obj || !obj.length) { return false; }
				this.data.crrm.cp_nodes = false;
				this.data.crrm.ct_nodes = obj;
				this.__callback({ "obj" : obj });
			},
			copy : function (obj) {
				obj = this._get_node(obj, true);
				if(!obj || !obj.length) { return false; }
				this.data.crrm.ct_nodes = false;
				this.data.crrm.cp_nodes = obj;
				this.__callback({ "obj" : obj });
			},
			paste : function (obj) { 
				obj = this._get_node(obj);
				if(!obj || !obj.length) { return false; }
				var nodes = this.data.crrm.ct_nodes ? this.data.crrm.ct_nodes : this.data.crrm.cp_nodes;
				if(!this.data.crrm.ct_nodes && !this.data.crrm.cp_nodes) { return false; }
				if(this.data.crrm.ct_nodes) { this.move_node(this.data.crrm.ct_nodes, obj); this.data.crrm.ct_nodes = false; }
				if(this.data.crrm.cp_nodes) { this.move_node(this.data.crrm.cp_nodes, obj, false, true); }
				this.__callback({ "obj" : obj, "nodes" : nodes });
			}
		}
	});
	// include the crr plugin by default
	// $.jstree.defaults.plugins.push("crrm");
})(jQuery);
//*/

/* 
 * jsTree themes plugin
 * Handles loading and setting themes, as well as detecting path to themes, etc.
 */
(function ($) {
	var themes_loaded = [];
	// this variable stores the path to the themes folder - if left as false - it will be autodetected
	$.jstree._themes = false;
	$.jstree.plugin("themes", {
		__init : function () { 
			this.get_container()
				.bind("init.jstree", $.proxy(function () {
						var s = this._get_settings().themes;
						this.data.themes.dots = s.dots; 
						this.data.themes.icons = s.icons; 
						this.set_theme(s.theme, s.url);
					}, this))
				.bind("loaded.jstree", $.proxy(function () {
						// bound here too, as simple HTML tree's won't honor dots & icons otherwise
						if(!this.data.themes.dots) { this.hide_dots(); }
						else { this.show_dots(); }
						if(!this.data.themes.icons) { this.hide_icons(); }
						else { this.show_icons(); }
					}, this));
		},
		defaults : { 
			theme : "default", 
			url : false,
			dots : true,
			icons : true
		},
		_fn : {
			set_theme : function (theme_name, theme_url) {
				if(!theme_name) { return false; }
				if(!theme_url) { theme_url = $.jstree._themes + theme_name + '/style.css'; }
				if($.inArray(theme_url, themes_loaded) == -1) {
					$.vakata.css.add_sheet({ "url" : theme_url });
					themes_loaded.push(theme_url);
				}
				if(this.data.themes.theme != theme_name) {
					this.get_container().removeClass('jstree-' + this.data.themes.theme);
					this.data.themes.theme = theme_name;
				}
				this.get_container().addClass('jstree-' + theme_name);
				if(!this.data.themes.dots) { this.hide_dots(); }
				else { this.show_dots(); }
				if(!this.data.themes.icons) { this.hide_icons(); }
				else { this.show_icons(); }
				this.__callback();
			},
			get_theme	: function () { return this.data.themes.theme; },

			show_dots	: function () { this.data.themes.dots = true; this.get_container().children("ul").removeClass("jstree-no-dots"); },
			hide_dots	: function () { this.data.themes.dots = false; this.get_container().children("ul").addClass("jstree-no-dots"); },
			toggle_dots	: function () { if(this.data.themes.dots) { this.hide_dots(); } else { this.show_dots(); } },

			show_icons	: function () { this.data.themes.icons = true; this.get_container().children("ul").removeClass("jstree-no-icons"); },
			hide_icons	: function () { this.data.themes.icons = false; this.get_container().children("ul").addClass("jstree-no-icons"); },
			toggle_icons: function () { if(this.data.themes.icons) { this.hide_icons(); } else { this.show_icons(); } }
		}
	});
	// autodetect themes path
	$(function () {
		if($.jstree._themes === false) {
			$("script").each(function () { 
				if(this.src.toString().match(/jquery\.jstree[^\/]*?\.js(\?.*)?$/)) { 
					$.jstree._themes = this.src.toString().replace(/jquery\.jstree[^\/]*?\.js(\?.*)?$/, "") + 'themes/'; 
					return false; 
				}
			});
		}
		if($.jstree._themes === false) { $.jstree._themes = "themes/"; }
	});
	// include the themes plugin by default
	$.jstree.defaults.plugins.push("themes");
})(jQuery);
//*/

/*
 * jsTree hotkeys plugin
 * Enables keyboard navigation for all tree instances
 * Depends on the jstree ui & jquery hotkeys plugins
 */
(function ($) {
	var bound = [];
	function exec(i, event) {
		var f = $.jstree._focused(), tmp;
		if(f && f.data && f.data.hotkeys && f.data.hotkeys.enabled) { 
			tmp = f._get_settings().hotkeys[i];
			if(tmp) { return tmp.call(f, event); }
		}
	}
	$.jstree.plugin("hotkeys", {
		__init : function () {
			if(typeof $.hotkeys === "undefined") { throw "jsTree hotkeys: jQuery hotkeys plugin not included."; }
			if(!this.data.ui) { throw "jsTree hotkeys: jsTree UI plugin not included."; }
			$.each(this._get_settings().hotkeys, function (i, v) {
				if(v !== false && $.inArray(i, bound) == -1) {
					$(document).bind("keydown", i, function (event) { return exec(i, event); });
					bound.push(i);
				}
			});
			this.get_container()
				.bind("lock.jstree", $.proxy(function () {
						if(this.data.hotkeys.enabled) { this.data.hotkeys.enabled = false; this.data.hotkeys.revert = true; }
					}, this))
				.bind("unlock.jstree", $.proxy(function () {
						if(this.data.hotkeys.revert) { this.data.hotkeys.enabled = true; }
					}, this));
			this.enable_hotkeys();
		},
		defaults : {
			"up" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected || -1;
				this.hover_node(this._get_prev(o));
				return false; 
			},
			"ctrl+up" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected || -1;
				this.hover_node(this._get_prev(o));
				return false; 
			},
			"shift+up" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected || -1;
				this.hover_node(this._get_prev(o));
				return false; 
			},
			"down" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected || -1;
				this.hover_node(this._get_next(o));
				return false;
			},
			"ctrl+down" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected || -1;
				this.hover_node(this._get_next(o));
				return false;
			},
			"shift+down" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected || -1;
				this.hover_node(this._get_next(o));
				return false;
			},
			"left" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected;
				if(o) {
					if(o.hasClass("jstree-open")) { this.close_node(o); }
					else { this.hover_node(this._get_prev(o)); }
				}
				return false;
			},
			"ctrl+left" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected;
				if(o) {
					if(o.hasClass("jstree-open")) { this.close_node(o); }
					else { this.hover_node(this._get_prev(o)); }
				}
				return false;
			},
			"shift+left" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected;
				if(o) {
					if(o.hasClass("jstree-open")) { this.close_node(o); }
					else { this.hover_node(this._get_prev(o)); }
				}
				return false;
			},
			"right" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected;
				if(o && o.length) {
					if(o.hasClass("jstree-closed")) { this.open_node(o); }
					else { this.hover_node(this._get_next(o)); }
				}
				return false;
			},
			"ctrl+right" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected;
				if(o && o.length) {
					if(o.hasClass("jstree-closed")) { this.open_node(o); }
					else { this.hover_node(this._get_next(o)); }
				}
				return false;
			},
			"shift+right" : function () { 
				var o = this.data.ui.hovered || this.data.ui.last_selected;
				if(o && o.length) {
					if(o.hasClass("jstree-closed")) { this.open_node(o); }
					else { this.hover_node(this._get_next(o)); }
				}
				return false;
			},
			"space" : function () { 
				if(this.data.ui.hovered) { this.data.ui.hovered.children("a:eq(0)").click(); } 
				return false; 
			},
			"ctrl+space" : function (event) { 
				event.type = "click";
				if(this.data.ui.hovered) { this.data.ui.hovered.children("a:eq(0)").trigger(event); } 
				return false; 
			},
			"shift+space" : function (event) { 
				event.type = "click";
				if(this.data.ui.hovered) { this.data.ui.hovered.children("a:eq(0)").trigger(event); } 
				return false; 
			},
			"f2" : function () { this.rename(this.data.ui.hovered || this.data.ui.last_selected); },
			"del" : function () { this.remove(this.data.ui.hovered || this._get_node(null)); }
		},
		_fn : {
			enable_hotkeys : function () {
				this.data.hotkeys.enabled = true;
			},
			disable_hotkeys : function () {
				this.data.hotkeys.enabled = false;
			}
		}
	});
})(jQuery);
//*/

/* 
 * jsTree JSON plugin
 * The JSON data store. Datastores are build by overriding the `load_node` and `_is_loaded` functions.
 */
(function ($) {
	$.jstree.plugin("json_data", {
		__init : function() {
			var s = this._get_settings().json_data;
			if(s.progressive_unload) {
				this.get_container().bind("after_close.jstree", function (e, data) {
					data.rslt.obj.children("ul").remove();
				});
			}
		},
		defaults : { 
			// `data` can be a function:
			//  * accepts two arguments - node being loaded and a callback to pass the result to
			//  * will be executed in the current tree's scope & ajax won't be supported
			data : false, 
			ajax : false,
			correct_state : true,
			progressive_render : false,
			progressive_unload : false
		},
		_fn : {
			load_node : function (obj, s_call, e_call) { var _this = this; this.load_node_json(obj, function () { _this.__callback({ "obj" : _this._get_node(obj) }); s_call.call(this); }, e_call); },
			_is_loaded : function (obj) { 
				var s = this._get_settings().json_data;
				obj = this._get_node(obj); 
				return obj == -1 || !obj || (!s.ajax && !s.progressive_render && !$.isFunction(s.data)) || obj.is(".jstree-open, .jstree-leaf") || obj.children("ul").children("li").length > 0;
			},
			refresh : function (obj) {
				obj = this._get_node(obj);
				var s = this._get_settings().json_data;
				if(obj && obj !== -1 && s.progressive_unload && ($.isFunction(s.data) || !!s.ajax)) {
					obj.removeData("jstree_children");
				}
				return this.__call_old();
			},
			load_node_json : function (obj, s_call, e_call) {
				var s = this.get_settings().json_data, d,
					error_func = function () {},
					success_func = function () {};
				obj = this._get_node(obj);

				if(obj && obj !== -1 && (s.progressive_render || s.progressive_unload) && !obj.is(".jstree-open, .jstree-leaf") && obj.children("ul").children("li").length === 0 && obj.data("jstree_children")) {
					d = this._parse_json(obj.data("jstree_children"), obj);
					if(d) {
						obj.append(d);
						if(!s.progressive_unload) { obj.removeData("jstree_children"); }
					}
					this.clean_node(obj);
					if(s_call) { s_call.call(this); }
					return;
				}

				if(obj && obj !== -1) {
					if(obj.data("jstree_is_loading")) { return; }
					else { obj.data("jstree_is_loading",true); }
				}
				switch(!0) {
					case (!s.data && !s.ajax): throw "Neither data nor ajax settings supplied.";
					// function option added here for easier model integration (also supporting async - see callback)
					case ($.isFunction(s.data)):
						s.data.call(this, obj, $.proxy(function (d) {
							d = this._parse_json(d, obj);
							if(!d) { 
								if(obj === -1 || !obj) {
									if(s.correct_state) { this.get_container().children("ul").empty(); }
								}
								else {
									obj.children("a.jstree-loading").removeClass("jstree-loading");
									obj.removeData("jstree_is_loading");
									if(s.correct_state) { this.correct_state(obj); }
								}
								if(e_call) { e_call.call(this); }
							}
							else {
								if(obj === -1 || !obj) { this.get_container().children("ul").empty().append(d.children()); }
								else { obj.append(d).children("a.jstree-loading").removeClass("jstree-loading"); obj.removeData("jstree_is_loading"); }
								this.clean_node(obj);
								if(s_call) { s_call.call(this); }
							}
						}, this));
						break;
					case (!!s.data && !s.ajax) || (!!s.data && !!s.ajax && (!obj || obj === -1)):
						if(!obj || obj == -1) {
							d = this._parse_json(s.data, obj);
							if(d) {
								this.get_container().children("ul").empty().append(d.children());
								this.clean_node();
							}
							else { 
								if(s.correct_state) { this.get_container().children("ul").empty(); }
							}
						}
						if(s_call) { s_call.call(this); }
						break;
					case (!s.data && !!s.ajax) || (!!s.data && !!s.ajax && obj && obj !== -1):
						error_func = function (x, t, e) {
							var ef = this.get_settings().json_data.ajax.error; 
							if(ef) { ef.call(this, x, t, e); }
							if(obj != -1 && obj.length) {
								obj.children("a.jstree-loading").removeClass("jstree-loading");
								obj.removeData("jstree_is_loading");
								if(t === "success" && s.correct_state) { this.correct_state(obj); }
							}
							else {
								if(t === "success" && s.correct_state) { this.get_container().children("ul").empty(); }
							}
							if(e_call) { e_call.call(this); }
						};
						success_func = function (d, t, x) {
							var sf = this.get_settings().json_data.ajax.success; 
							if(sf) { d = sf.call(this,d,t,x) || d; }
							if(d === "" || (d && d.toString && d.toString().replace(/^[\s\n]+$/,"") === "") || (!$.isArray(d) && !$.isPlainObject(d))) {
								return error_func.call(this, x, t, "");
							}
							d = this._parse_json(d, obj);
							if(d) {
								if(obj === -1 || !obj) { this.get_container().children("ul").empty().append(d.children()); }
								else { obj.append(d).children("a.jstree-loading").removeClass("jstree-loading"); obj.removeData("jstree_is_loading"); }
								this.clean_node(obj);
								if(s_call) { s_call.call(this); }
							}
							else {
								if(obj === -1 || !obj) {
									if(s.correct_state) { 
										this.get_container().children("ul").empty(); 
										if(s_call) { s_call.call(this); }
									}
								}
								else {
									obj.children("a.jstree-loading").removeClass("jstree-loading");
									obj.removeData("jstree_is_loading");
									if(s.correct_state) { 
										this.correct_state(obj);
										if(s_call) { s_call.call(this); } 
									}
								}
							}
						};
						s.ajax.context = this;
						s.ajax.error = error_func;
						s.ajax.success = success_func;
						if(!s.ajax.dataType) { s.ajax.dataType = "json"; }
						if($.isFunction(s.ajax.url)) { s.ajax.url = s.ajax.url.call(this, obj); }
						if($.isFunction(s.ajax.data)) { s.ajax.data = s.ajax.data.call(this, obj); }
						$.ajax(s.ajax);
						break;
				}
			},
			_parse_json : function (js, obj, is_callback) {
				var d = false, 
					p = this._get_settings(),
					s = p.json_data,
					t = p.core.html_titles,
					tmp, i, j, ul1, ul2;

				if(!js) { return d; }
				if(s.progressive_unload && obj && obj !== -1) { 
					obj.data("jstree_children", d);
				}
				if($.isArray(js)) {
					d = $();
					if(!js.length) { return false; }
					for(i = 0, j = js.length; i < j; i++) {
						tmp = this._parse_json(js[i], obj, true);
						if(tmp.length) { d = d.add(tmp); }
					}
				}
				else {
					if(typeof js == "string") { js = { data : js }; }
					if(!js.data && js.data !== "") { return d; }
					d = $("<li />");
					if(js.attr) { d.attr(js.attr); }
					if(js.metadata) { d.data(js.metadata); }
					if(js.state) { d.addClass("jstree-" + js.state); }
					if(!$.isArray(js.data)) { tmp = js.data; js.data = []; js.data.push(tmp); }
					$.each(js.data, function (i, m) {
						tmp = $("<a />");
						if($.isFunction(m)) { m = m.call(this, js); }
						if(typeof m == "string") { tmp.attr('href','#')[ t ? "html" : "text" ](m); }
						else {
							if(!m.attr) { m.attr = {}; }
							if(!m.attr.href) { m.attr.href = '#'; }
							tmp.attr(m.attr)[ t ? "html" : "text" ](m.title);
							if(m.language) { tmp.addClass(m.language); }
						}
						tmp.prepend("<ins class='jstree-icon'>&#160;</ins>");
						if(!m.icon && js.icon) { m.icon = js.icon; }
						if(m.icon) { 
							if(m.icon.indexOf("/") === -1) { tmp.children("ins").addClass(m.icon); }
							else { tmp.children("ins").css("background","url('" + m.icon + "') center center no-repeat"); }
						}
						d.append(tmp);
					});
					d.prepend("<ins class='jstree-icon'>&#160;</ins>");
					if(js.children) { 
						if(s.progressive_render && js.state !== "open") {
							d.addClass("jstree-closed").data("jstree_children", js.children);
						}
						else {
							if(s.progressive_unload) { d.data("jstree_children", js.children); }
							if($.isArray(js.children) && js.children.length) {
								tmp = this._parse_json(js.children, obj, true);
								if(tmp.length) {
									ul2 = $("<ul />");
									ul2.append(tmp);
									d.append(ul2);
								}
							}
						}
					}
				}
				if(!is_callback) {
					ul1 = $("<ul />");
					ul1.append(d);
					d = ul1;
				}
				return d;
			},
			get_json : function (obj, li_attr, a_attr, is_callback) {
				var result = [], 
					s = this._get_settings(), 
					_this = this,
					tmp1, tmp2, li, a, t, lang;
				obj = this._get_node(obj);
				if(!obj || obj === -1) { obj = this.get_container().find("> ul > li"); }
				li_attr = $.isArray(li_attr) ? li_attr : [ "id", "class" ];
				if(!is_callback && this.data.types) { li_attr.push(s.types.type_attr); }
				a_attr = $.isArray(a_attr) ? a_attr : [ ];

				obj.each(function () {
					li = $(this);
					tmp1 = { data : [] };
					if(li_attr.length) { tmp1.attr = { }; }
					$.each(li_attr, function (i, v) { 
						tmp2 = li.attr(v); 
						if(tmp2 && tmp2.length && tmp2.replace(/jstree[^ ]*/ig,'').length) {
							tmp1.attr[v] = (" " + tmp2).replace(/ jstree[^ ]*/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""); 
						}
					});
					if(li.hasClass("jstree-open")) { tmp1.state = "open"; }
					if(li.hasClass("jstree-closed")) { tmp1.state = "closed"; }
					if(li.data()) { tmp1.metadata = li.data(); }
					a = li.children("a");
					a.each(function () {
						t = $(this);
						if(
							a_attr.length || 
							$.inArray("languages", s.plugins) !== -1 || 
							t.children("ins").get(0).style.backgroundImage.length || 
							(t.children("ins").get(0).className && t.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').length)
						) { 
							lang = false;
							if($.inArray("languages", s.plugins) !== -1 && $.isArray(s.languages) && s.languages.length) {
								$.each(s.languages, function (l, lv) {
									if(t.hasClass(lv)) {
										lang = lv;
										return false;
									}
								});
							}
							tmp2 = { attr : { }, title : _this.get_text(t, lang) }; 
							$.each(a_attr, function (k, z) {
								tmp2.attr[z] = (" " + (t.attr(z) || "")).replace(/ jstree[^ ]*/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"");
							});
							if($.inArray("languages", s.plugins) !== -1 && $.isArray(s.languages) && s.languages.length) {
								$.each(s.languages, function (k, z) {
									if(t.hasClass(z)) { tmp2.language = z; return true; }
								});
							}
							if(t.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').replace(/^\s+$/ig,"").length) {
								tmp2.icon = t.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"");
							}
							if(t.children("ins").get(0).style.backgroundImage.length) {
								tmp2.icon = t.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","");
							}
						}
						else {
							tmp2 = _this.get_text(t);
						}
						if(a.length > 1) { tmp1.data.push(tmp2); }
						else { tmp1.data = tmp2; }
					});
					li = li.find("> ul > li");
					if(li.length) { tmp1.children = _this.get_json(li, li_attr, a_attr, true); }
					result.push(tmp1);
				});
				return result;
			}
		}
	});
})(jQuery);
//*/

/* 
 * jsTree languages plugin
 * Adds support for multiple language versions in one tree
 * This basically allows for many titles coexisting in one node, but only one of them being visible at any given time
 * This is useful for maintaining the same structure in many languages (hence the name of the plugin)
 */
(function ($) {
	$.jstree.plugin("languages", {
		__init : function () { this._load_css();  },
		defaults : [],
		_fn : {
			set_lang : function (i) { 
				var langs = this._get_settings().languages,
					st = false,
					selector = ".jstree-" + this.get_index() + ' a';
				if(!$.isArray(langs) || langs.length === 0) { return false; }
				if($.inArray(i,langs) == -1) {
					if(!!langs[i]) { i = langs[i]; }
					else { return false; }
				}
				if(i == this.data.languages.current_language) { return true; }
				st = $.vakata.css.get_css(selector + "." + this.data.languages.current_language, false, this.data.languages.language_css);
				if(st !== false) { st.style.display = "none"; }
				st = $.vakata.css.get_css(selector + "." + i, false, this.data.languages.language_css);
				if(st !== false) { st.style.display = ""; }
				this.data.languages.current_language = i;
				this.__callback(i);
				return true;
			},
			get_lang : function () {
				return this.data.languages.current_language;
			},
			_get_string : function (key, lang) {
				var langs = this._get_settings().languages,
					s = this._get_settings().core.strings;
				if($.isArray(langs) && langs.length) {
					lang = (lang && $.inArray(lang,langs) != -1) ? lang : this.data.languages.current_language;
				}
				if(s[lang] && s[lang][key]) { return s[lang][key]; }
				if(s[key]) { return s[key]; }
				return key;
			},
			get_text : function (obj, lang) {
				obj = this._get_node(obj) || this.data.ui.last_selected;
				if(!obj.size()) { return false; }
				var langs = this._get_settings().languages,
					s = this._get_settings().core.html_titles;
				if($.isArray(langs) && langs.length) {
					lang = (lang && $.inArray(lang,langs) != -1) ? lang : this.data.languages.current_language;
					obj = obj.children("a." + lang);
				}
				else { obj = obj.children("a:eq(0)"); }
				if(s) {
					obj = obj.clone();
					obj.children("INS").remove();
					return obj.html();
				}
				else {
					obj = obj.contents().filter(function() { return this.nodeType == 3; })[0];
					return obj.nodeValue;
				}
			},
			set_text : function (obj, val, lang) {
				obj = this._get_node(obj) || this.data.ui.last_selected;
				if(!obj.size()) { return false; }
				var langs = this._get_settings().languages,
					s = this._get_settings().core.html_titles,
					tmp;
				if($.isArray(langs) && langs.length) {
					lang = (lang && $.inArray(lang,langs) != -1) ? lang : this.data.languages.current_language;
					obj = obj.children("a." + lang);
				}
				else { obj = obj.children("a:eq(0)"); }
				if(s) {
					tmp = obj.children("INS").clone();
					obj.html(val).prepend(tmp);
					this.__callback({ "obj" : obj, "name" : val, "lang" : lang });
					return true;
				}
				else {
					obj = obj.contents().filter(function() { return this.nodeType == 3; })[0];
					this.__callback({ "obj" : obj, "name" : val, "lang" : lang });
					return (obj.nodeValue = val);
				}
			},
			_load_css : function () {
				var langs = this._get_settings().languages,
					str = "/* languages css */",
					selector = ".jstree-" + this.get_index() + ' a',
					ln;
				if($.isArray(langs) && langs.length) {
					this.data.languages.current_language = langs[0];
					for(ln = 0; ln < langs.length; ln++) {
						str += selector + "." + langs[ln] + " {";
						if(langs[ln] != this.data.languages.current_language) { str += " display:none; "; }
						str += " } ";
					}
					this.data.languages.language_css = $.vakata.css.add_sheet({ 'str' : str, 'title' : "jstree-languages" });
				}
			},
			create_node : function (obj, position, js, callback) {
				var t = this.__call_old(true, obj, position, js, function (t) {
					var langs = this._get_settings().languages,
						a = t.children("a"),
						ln;
					if($.isArray(langs) && langs.length) {
						for(ln = 0; ln < langs.length; ln++) {
							if(!a.is("." + langs[ln])) {
								t.append(a.eq(0).clone().removeClass(langs.join(" ")).addClass(langs[ln]));
							}
						}
						a.not("." + langs.join(", .")).remove();
					}
					if(callback) { callback.call(this, t); }
				});
				return t;
			}
		}
	});
})(jQuery);
//*/

/*
 * jsTree cookies plugin
 * Stores the currently opened/selected nodes in a cookie and then restores them
 * Depends on the jquery.cookie plugin
 */
(function ($) {
	$.jstree.plugin("cookies", {
		__init : function () {
			if(typeof $.cookie === "undefined") { throw "jsTree cookie: jQuery cookie plugin not included."; }

			var s = this._get_settings().cookies,
				tmp;
			if(!!s.save_loaded) {
				tmp = $.cookie(s.save_loaded);
				if(tmp && tmp.length) { this.data.core.to_load = tmp.split(","); }
			}
			if(!!s.save_opened) {
				tmp = $.cookie(s.save_opened);
				if(tmp && tmp.length) { this.data.core.to_open = tmp.split(","); }
			}
			if(!!s.save_selected) {
				tmp = $.cookie(s.save_selected);
				if(tmp && tmp.length && this.data.ui) { this.data.ui.to_select = tmp.split(","); }
			}
			this.get_container()
				.one( ( this.data.ui ? "reselect" : "reopen" ) + ".jstree", $.proxy(function () {
					this.get_container()
						.bind("open_node.jstree close_node.jstree select_node.jstree deselect_node.jstree", $.proxy(function (e) { 
								if(this._get_settings().cookies.auto_save) { this.save_cookie((e.handleObj.namespace + e.handleObj.type).replace("jstree","")); }
							}, this));
				}, this));
		},
		defaults : {
			save_loaded		: "jstree_load",
			save_opened		: "jstree_open",
			save_selected	: "jstree_select",
			auto_save		: true,
			cookie_options	: {}
		},
		_fn : {
			save_cookie : function (c) {
				if(this.data.core.refreshing) { return; }
				var s = this._get_settings().cookies;
				if(!c) { // if called manually and not by event
					if(s.save_loaded) {
						this.save_loaded();
						$.cookie(s.save_loaded, this.data.core.to_load.join(","), s.cookie_options);
					}
					if(s.save_opened) {
						this.save_opened();
						$.cookie(s.save_opened, this.data.core.to_open.join(","), s.cookie_options);
					}
					if(s.save_selected && this.data.ui) {
						this.save_selected();
						$.cookie(s.save_selected, this.data.ui.to_select.join(","), s.cookie_options);
					}
					return;
				}
				switch(c) {
					case "open_node":
					case "close_node":
						if(!!s.save_opened) { 
							this.save_opened(); 
							$.cookie(s.save_opened, this.data.core.to_open.join(","), s.cookie_options); 
						}
						if(!!s.save_loaded) { 
							this.save_loaded(); 
							$.cookie(s.save_loaded, this.data.core.to_load.join(","), s.cookie_options); 
						}
						break;
					case "select_node":
					case "deselect_node":
						if(!!s.save_selected && this.data.ui) { 
							this.save_selected(); 
							$.cookie(s.save_selected, this.data.ui.to_select.join(","), s.cookie_options); 
						}
						break;
				}
			}
		}
	});
	// include cookies by default
	// $.jstree.defaults.plugins.push("cookies");
})(jQuery);
//*/

/*
 * jsTree sort plugin
 * Sorts items alphabetically (or using any other function)
 */
(function ($) {
	$.jstree.plugin("sort", {
		__init : function () {
			this.get_container()
				.bind("load_node.jstree", $.proxy(function (e, data) {
						var obj = this._get_node(data.rslt.obj);
						obj = obj === -1 ? this.get_container().children("ul") : obj.children("ul");
						this.sort(obj);
					}, this))
				.bind("rename_node.jstree create_node.jstree create.jstree", $.proxy(function (e, data) {
						this.sort(data.rslt.obj.parent());
					}, this))
				.bind("move_node.jstree", $.proxy(function (e, data) {
						var m = data.rslt.np == -1 ? this.get_container() : data.rslt.np;
						this.sort(m.children("ul"));
					}, this));
		},
		defaults : function (a, b) { return this.get_text(a) > this.get_text(b) ? 1 : -1; },
		_fn : {
			sort : function (obj) {
				var s = this._get_settings().sort,
					t = this;
				obj.append($.makeArray(obj.children("li")).sort($.proxy(s, t)));
				obj.find("> li > ul").each(function() { t.sort($(this)); });
				this.clean_node(obj);
			}
		}
	});
})(jQuery);
//*/

/*
 * jsTree DND plugin
 * Drag and drop plugin for moving/copying nodes
 */
(function ($) {
	var o = false,
		r = false,
		m = false,
		ml = false,
		sli = false,
		sti = false,
		dir1 = false,
		dir2 = false,
		last_pos = false;
	$.vakata.dnd = {
		is_down : false,
		is_drag : false,
		helper : false,
		scroll_spd : 10,
		init_x : 0,
		init_y : 0,
		threshold : 5,
		helper_left : 5,
		helper_top : 10,
		user_data : {},

		drag_start : function (e, data, html) { 
			if($.vakata.dnd.is_drag) { $.vakata.drag_stop({}); }
			try {
				e.currentTarget.unselectable = "on";
				e.currentTarget.onselectstart = function() { return false; };
				if(e.currentTarget.style) { e.currentTarget.style.MozUserSelect = "none"; }
			} catch(err) { }
			$.vakata.dnd.init_x = e.pageX;
			$.vakata.dnd.init_y = e.pageY;
			$.vakata.dnd.user_data = data;
			$.vakata.dnd.is_down = true;
			$.vakata.dnd.helper = $("<div id='vakata-dragged' />").html(html); //.fadeTo(10,0.25);
			$(document).bind("mousemove", $.vakata.dnd.drag);
			$(document).bind("mouseup", $.vakata.dnd.drag_stop);
			return false;
		},
		drag : function (e) { 
			if(!$.vakata.dnd.is_down) { return; }
			if(!$.vakata.dnd.is_drag) {
				if(Math.abs(e.pageX - $.vakata.dnd.init_x) > 5 || Math.abs(e.pageY - $.vakata.dnd.init_y) > 5) { 
					$.vakata.dnd.helper.appendTo("body");
					$.vakata.dnd.is_drag = true;
					$(document).triggerHandler("drag_start.vakata", { "event" : e, "data" : $.vakata.dnd.user_data });
				}
				else { return; }
			}

			// maybe use a scrolling parent element instead of document?
			if(e.type === "mousemove") { // thought of adding scroll in order to move the helper, but mouse poisition is n/a
				var d = $(document), t = d.scrollTop(), l = d.scrollLeft();
				if(e.pageY - t < 20) { 
					if(sti && dir1 === "down") { clearInterval(sti); sti = false; }
					if(!sti) { dir1 = "up"; sti = setInterval(function () { $(document).scrollTop($(document).scrollTop() - $.vakata.dnd.scroll_spd); }, 150); }
				}
				else { 
					if(sti && dir1 === "up") { clearInterval(sti); sti = false; }
				}
				if($(window).height() - (e.pageY - t) < 20) {
					if(sti && dir1 === "up") { clearInterval(sti); sti = false; }
					if(!sti) { dir1 = "down"; sti = setInterval(function () { $(document).scrollTop($(document).scrollTop() + $.vakata.dnd.scroll_spd); }, 150); }
				}
				else { 
					if(sti && dir1 === "down") { clearInterval(sti); sti = false; }
				}

				if(e.pageX - l < 20) {
					if(sli && dir2 === "right") { clearInterval(sli); sli = false; }
					if(!sli) { dir2 = "left"; sli = setInterval(function () { $(document).scrollLeft($(document).scrollLeft() - $.vakata.dnd.scroll_spd); }, 150); }
				}
				else { 
					if(sli && dir2 === "left") { clearInterval(sli); sli = false; }
				}
				if($(window).width() - (e.pageX - l) < 20) {
					if(sli && dir2 === "left") { clearInterval(sli); sli = false; }
					if(!sli) { dir2 = "right"; sli = setInterval(function () { $(document).scrollLeft($(document).scrollLeft() + $.vakata.dnd.scroll_spd); }, 150); }
				}
				else { 
					if(sli && dir2 === "right") { clearInterval(sli); sli = false; }
				}
			}

			$.vakata.dnd.helper.css({ left : (e.pageX + $.vakata.dnd.helper_left) + "px", top : (e.pageY + $.vakata.dnd.helper_top) + "px" });
			$(document).triggerHandler("drag.vakata", { "event" : e, "data" : $.vakata.dnd.user_data });
		},
		drag_stop : function (e) {
			if(sli) { clearInterval(sli); }
			if(sti) { clearInterval(sti); }
			$(document).unbind("mousemove", $.vakata.dnd.drag);
			$(document).unbind("mouseup", $.vakata.dnd.drag_stop);
			$(document).triggerHandler("drag_stop.vakata", { "event" : e, "data" : $.vakata.dnd.user_data });
			$.vakata.dnd.helper.remove();
			$.vakata.dnd.init_x = 0;
			$.vakata.dnd.init_y = 0;
			$.vakata.dnd.user_data = {};
			$.vakata.dnd.is_down = false;
			$.vakata.dnd.is_drag = false;
		}
	};
	$(function() {
		var css_string = '#vakata-dragged { display:block; margin:0 0 0 0; padding:4px 4px 4px 24px; position:absolute; top:-2000px; line-height:16px; z-index:10000; } ';
		$.vakata.css.add_sheet({ str : css_string, title : "vakata" });
	});

	$.jstree.plugin("dnd", {
		__init : function () {
			this.data.dnd = {
				active : false,
				after : false,
				inside : false,
				before : false,
				off : false,
				prepared : false,
				w : 0,
				to1 : false,
				to2 : false,
				cof : false,
				cw : false,
				ch : false,
				i1 : false,
				i2 : false,
				mto : false
			};
			this.get_container()
				.bind("mouseenter.jstree", $.proxy(function (e) {
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree) {
							if(this.data.themes) {
								m.attr("class", "jstree-" + this.data.themes.theme); 
								if(ml) { ml.attr("class", "jstree-" + this.data.themes.theme); }
								$.vakata.dnd.helper.attr("class", "jstree-dnd-helper jstree-" + this.data.themes.theme);
							}
							//if($(e.currentTarget).find("> ul > li").length === 0) {
							if(e.currentTarget === e.target && $.vakata.dnd.user_data.obj && $($.vakata.dnd.user_data.obj).length && $($.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0] !== e.target) { // node should not be from the same tree
								var tr = $.jstree._reference(e.target), dc;
								if(tr.data.dnd.foreign) {
									dc = tr._get_settings().dnd.drag_check.call(this, { "o" : o, "r" : tr.get_container(), is_root : true });
									if(dc === true || dc.inside === true || dc.before === true || dc.after === true) {
										$.vakata.dnd.helper.children("ins").attr("class","jstree-ok");
									}
								}
								else {
									tr.prepare_move(o, tr.get_container(), "last");
									if(tr.check_move()) {
										$.vakata.dnd.helper.children("ins").attr("class","jstree-ok");
									}
								}
							}
						}
					}, this))
				.bind("mouseup.jstree", $.proxy(function (e) {
						//if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree && $(e.currentTarget).find("> ul > li").length === 0) {
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree && e.currentTarget === e.target && $.vakata.dnd.user_data.obj && $($.vakata.dnd.user_data.obj).length && $($.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0] !== e.target) { // node should not be from the same tree
							var tr = $.jstree._reference(e.currentTarget), dc;
							if(tr.data.dnd.foreign) {
								dc = tr._get_settings().dnd.drag_check.call(this, { "o" : o, "r" : tr.get_container(), is_root : true });
								if(dc === true || dc.inside === true || dc.before === true || dc.after === true) {
									tr._get_settings().dnd.drag_finish.call(this, { "o" : o, "r" : tr.get_container(), is_root : true });
								}
							}
							else {
								tr.move_node(o, tr.get_container(), "last", e[tr._get_settings().dnd.copy_modifier + "Key"]);
							}
						}
					}, this))
				.bind("mouseleave.jstree", $.proxy(function (e) {
						if(e.relatedTarget && e.relatedTarget.id && e.relatedTarget.id === "jstree-marker-line") {
							return false; 
						}
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree) {
							if(this.data.dnd.i1) { clearInterval(this.data.dnd.i1); }
							if(this.data.dnd.i2) { clearInterval(this.data.dnd.i2); }
							if(this.data.dnd.to1) { clearTimeout(this.data.dnd.to1); }
							if(this.data.dnd.to2) { clearTimeout(this.data.dnd.to2); }
							if($.vakata.dnd.helper.children("ins").hasClass("jstree-ok")) {
								$.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");
							}
						}
					}, this))
				.bind("mousemove.jstree", $.proxy(function (e) {
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree) {
							var cnt = this.get_container()[0];

							// Horizontal scroll
							if(e.pageX + 24 > this.data.dnd.cof.left + this.data.dnd.cw) {
								if(this.data.dnd.i1) { clearInterval(this.data.dnd.i1); }
								this.data.dnd.i1 = setInterval($.proxy(function () { this.scrollLeft += $.vakata.dnd.scroll_spd; }, cnt), 100);
							}
							else if(e.pageX - 24 < this.data.dnd.cof.left) {
								if(this.data.dnd.i1) { clearInterval(this.data.dnd.i1); }
								this.data.dnd.i1 = setInterval($.proxy(function () { this.scrollLeft -= $.vakata.dnd.scroll_spd; }, cnt), 100);
							}
							else {
								if(this.data.dnd.i1) { clearInterval(this.data.dnd.i1); }
							}

							// Vertical scroll
							if(e.pageY + 24 > this.data.dnd.cof.top + this.data.dnd.ch) {
								if(this.data.dnd.i2) { clearInterval(this.data.dnd.i2); }
								this.data.dnd.i2 = setInterval($.proxy(function () { this.scrollTop += $.vakata.dnd.scroll_spd; }, cnt), 100);
							}
							else if(e.pageY - 24 < this.data.dnd.cof.top) {
								if(this.data.dnd.i2) { clearInterval(this.data.dnd.i2); }
								this.data.dnd.i2 = setInterval($.proxy(function () { this.scrollTop -= $.vakata.dnd.scroll_spd; }, cnt), 100);
							}
							else {
								if(this.data.dnd.i2) { clearInterval(this.data.dnd.i2); }
							}

						}
					}, this))
				.bind("scroll.jstree", $.proxy(function (e) { 
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree && m && ml) {
							m.hide();
							ml.hide();
						}
					}, this))
				.delegate("a", "mousedown.jstree", $.proxy(function (e) { 
						if(e.which === 1) {
							this.start_drag(e.currentTarget, e);
							return false;
						}
					}, this))
				.delegate("a", "mouseenter.jstree", $.proxy(function (e) { 
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree) {
							this.dnd_enter(e.currentTarget);
						}
					}, this))
				.delegate("a", "mousemove.jstree", $.proxy(function (e) { 
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree) {
							if(!r || !r.length || r.children("a")[0] !== e.currentTarget) {
								this.dnd_enter(e.currentTarget);
							}
							if(typeof this.data.dnd.off.top === "undefined") { this.data.dnd.off = $(e.target).offset(); }
							this.data.dnd.w = (e.pageY - (this.data.dnd.off.top || 0)) % this.data.core.li_height;
							if(this.data.dnd.w < 0) { this.data.dnd.w += this.data.core.li_height; }
							this.dnd_show();
						}
					}, this))
				.delegate("a", "mouseleave.jstree", $.proxy(function (e) { 
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree) {
							if(e.relatedTarget && e.relatedTarget.id && e.relatedTarget.id === "jstree-marker-line") {
								return false; 
							}
								if(m) { m.hide(); }
								if(ml) { ml.hide(); }
							/*
							var ec = $(e.currentTarget).closest("li"), 
								er = $(e.relatedTarget).closest("li");
							if(er[0] !== ec.prev()[0] && er[0] !== ec.next()[0]) {
								if(m) { m.hide(); }
								if(ml) { ml.hide(); }
							}
							*/
							this.data.dnd.mto = setTimeout( 
								(function (t) { return function () { t.dnd_leave(e); }; })(this),
							0);
						}
					}, this))
				.delegate("a", "mouseup.jstree", $.proxy(function (e) { 
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree) {
							this.dnd_finish(e);
						}
					}, this));

			$(document)
				.bind("drag_stop.vakata", $.proxy(function () {
						if(this.data.dnd.to1) { clearTimeout(this.data.dnd.to1); }
						if(this.data.dnd.to2) { clearTimeout(this.data.dnd.to2); }
						if(this.data.dnd.i1) { clearInterval(this.data.dnd.i1); }
						if(this.data.dnd.i2) { clearInterval(this.data.dnd.i2); }
						this.data.dnd.after		= false;
						this.data.dnd.before	= false;
						this.data.dnd.inside	= false;
						this.data.dnd.off		= false;
						this.data.dnd.prepared	= false;
						this.data.dnd.w			= false;
						this.data.dnd.to1		= false;
						this.data.dnd.to2		= false;
						this.data.dnd.i1		= false;
						this.data.dnd.i2		= false;
						this.data.dnd.active	= false;
						this.data.dnd.foreign	= false;
						if(m) { m.css({ "top" : "-2000px" }); }
						if(ml) { ml.css({ "top" : "-2000px" }); }
					}, this))
				.bind("drag_start.vakata", $.proxy(function (e, data) {
						if(data.data.jstree) { 
							var et = $(data.event.target);
							if(et.closest(".jstree").hasClass("jstree-" + this.get_index())) {
								this.dnd_enter(et);
							}
						}
					}, this));
				/*
				.bind("keydown.jstree-" + this.get_index() + " keyup.jstree-" + this.get_index(), $.proxy(function(e) {
						if($.vakata.dnd.is_drag && $.vakata.dnd.user_data.jstree && !this.data.dnd.foreign) {
							var h = $.vakata.dnd.helper.children("ins");
							if(e[this._get_settings().dnd.copy_modifier + "Key"] && h.hasClass("jstree-ok")) {
								h.parent().html(h.parent().html().replace(/ \(Copy\)$/, "") + " (Copy)");
							} 
							else {
								h.parent().html(h.parent().html().replace(/ \(Copy\)$/, ""));
							}
						}
					}, this)); */



			var s = this._get_settings().dnd;
			if(s.drag_target) {
				$(document)
					.delegate(s.drag_target, "mousedown.jstree-" + this.get_index(), $.proxy(function (e) {
						o = e.target;
						$.vakata.dnd.drag_start(e, { jstree : true, obj : e.target }, "<ins class='jstree-icon'></ins>" + $(e.target).text() );
						if(this.data.themes) { 
							if(m) { m.attr("class", "jstree-" + this.data.themes.theme); }
							if(ml) { ml.attr("class", "jstree-" + this.data.themes.theme); }
							$.vakata.dnd.helper.attr("class", "jstree-dnd-helper jstree-" + this.data.themes.theme); 
						}
						$.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");
						var cnt = this.get_container();
						this.data.dnd.cof = cnt.offset();
						this.data.dnd.cw = parseInt(cnt.width(),10);
						this.data.dnd.ch = parseInt(cnt.height(),10);
						this.data.dnd.foreign = true;
						e.preventDefault();
					}, this));
			}
			if(s.drop_target) {
				$(document)
					.delegate(s.drop_target, "mouseenter.jstree-" + this.get_index(), $.proxy(function (e) {
							if(this.data.dnd.active && this._get_settings().dnd.drop_check.call(this, { "o" : o, "r" : $(e.target), "e" : e })) {
								$.vakata.dnd.helper.children("ins").attr("class","jstree-ok");
							}
						}, this))
					.delegate(s.drop_target, "mouseleave.jstree-" + this.get_index(), $.proxy(function (e) {
							if(this.data.dnd.active) {
								$.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");
							}
						}, this))
					.delegate(s.drop_target, "mouseup.jstree-" + this.get_index(), $.proxy(function (e) {
							if(this.data.dnd.active && $.vakata.dnd.helper.children("ins").hasClass("jstree-ok")) {
								this._get_settings().dnd.drop_finish.call(this, { "o" : o, "r" : $(e.target), "e" : e });
							}
						}, this));
			}
		},
		defaults : {
			copy_modifier	: "ctrl",
			check_timeout	: 100,
			open_timeout	: 500,
			drop_target		: ".jstree-drop",
			drop_check		: function (data) { return true; },
			drop_finish		: $.noop,
			drag_target		: ".jstree-draggable",
			drag_finish		: $.noop,
			drag_check		: function (data) { return { after : false, before : false, inside : true }; }
		},
		_fn : {
			dnd_prepare : function () {
				if(!r || !r.length) { return; }
				this.data.dnd.off = r.offset();
				if(this._get_settings().core.rtl) {
					this.data.dnd.off.right = this.data.dnd.off.left + r.width();
				}
				if(this.data.dnd.foreign) {
					var a = this._get_settings().dnd.drag_check.call(this, { "o" : o, "r" : r });
					this.data.dnd.after = a.after;
					this.data.dnd.before = a.before;
					this.data.dnd.inside = a.inside;
					this.data.dnd.prepared = true;
					return this.dnd_show();
				}
				this.prepare_move(o, r, "before");
				this.data.dnd.before = this.check_move();
				this.prepare_move(o, r, "after");
				this.data.dnd.after = this.check_move();
				if(this._is_loaded(r)) {
					this.prepare_move(o, r, "inside");
					this.data.dnd.inside = this.check_move();
				}
				else {
					this.data.dnd.inside = false;
				}
				this.data.dnd.prepared = true;
				return this.dnd_show();
			},
			dnd_show : function () {
				if(!this.data.dnd.prepared) { return; }
				var o = ["before","inside","after"],
					r = false,
					rtl = this._get_settings().core.rtl,
					pos;
				if(this.data.dnd.w < this.data.core.li_height/3) { o = ["before","inside","after"]; }
				else if(this.data.dnd.w <= this.data.core.li_height*2/3) {
					o = this.data.dnd.w < this.data.core.li_height/2 ? ["inside","before","after"] : ["inside","after","before"];
				}
				else { o = ["after","inside","before"]; }
				$.each(o, $.proxy(function (i, val) { 
					if(this.data.dnd[val]) {
						$.vakata.dnd.helper.children("ins").attr("class","jstree-ok");
						r = val;
						return false;
					}
				}, this));
				if(r === false) { $.vakata.dnd.helper.children("ins").attr("class","jstree-invalid"); }
				
				pos = rtl ? (this.data.dnd.off.right - 18) : (this.data.dnd.off.left + 10);
				switch(r) {
					case "before":
						m.css({ "left" : pos + "px", "top" : (this.data.dnd.off.top - 6) + "px" }).show();
						if(ml) { ml.css({ "left" : (pos + 8) + "px", "top" : (this.data.dnd.off.top - 1) + "px" }).show(); }
						break;
					case "after":
						m.css({ "left" : pos + "px", "top" : (this.data.dnd.off.top + this.data.core.li_height - 6) + "px" }).show();
						if(ml) { ml.css({ "left" : (pos + 8) + "px", "top" : (this.data.dnd.off.top + this.data.core.li_height - 1) + "px" }).show(); }
						break;
					case "inside":
						m.css({ "left" : pos + ( rtl ? -4 : 4) + "px", "top" : (this.data.dnd.off.top + this.data.core.li_height/2 - 5) + "px" }).show();
						if(ml) { ml.hide(); }
						break;
					default:
						m.hide();
						if(ml) { ml.hide(); }
						break;
				}
				last_pos = r;
				return r;
			},
			dnd_open : function () {
				this.data.dnd.to2 = false;
				this.open_node(r, $.proxy(this.dnd_prepare,this), true);
			},
			dnd_finish : function (e) {
				if(this.data.dnd.foreign) {
					if(this.data.dnd.after || this.data.dnd.before || this.data.dnd.inside) {
						this._get_settings().dnd.drag_finish.call(this, { "o" : o, "r" : r, "p" : last_pos });
					}
				}
				else {
					this.dnd_prepare();
					this.move_node(o, r, last_pos, e[this._get_settings().dnd.copy_modifier + "Key"]);
				}
				o = false;
				r = false;
				m.hide();
				if(ml) { ml.hide(); }
			},
			dnd_enter : function (obj) {
				if(this.data.dnd.mto) { 
					clearTimeout(this.data.dnd.mto);
					this.data.dnd.mto = false;
				}
				var s = this._get_settings().dnd;
				this.data.dnd.prepared = false;
				r = this._get_node(obj);
				if(s.check_timeout) { 
					// do the calculations after a minimal timeout (users tend to drag quickly to the desired location)
					if(this.data.dnd.to1) { clearTimeout(this.data.dnd.to1); }
					this.data.dnd.to1 = setTimeout($.proxy(this.dnd_prepare, this), s.check_timeout); 
				}
				else { 
					this.dnd_prepare(); 
				}
				if(s.open_timeout) { 
					if(this.data.dnd.to2) { clearTimeout(this.data.dnd.to2); }
					if(r && r.length && r.hasClass("jstree-closed")) { 
						// if the node is closed - open it, then recalculate
						this.data.dnd.to2 = setTimeout($.proxy(this.dnd_open, this), s.open_timeout);
					}
				}
				else {
					if(r && r.length && r.hasClass("jstree-closed")) { 
						this.dnd_open();
					}
				}
			},
			dnd_leave : function (e) {
				this.data.dnd.after		= false;
				this.data.dnd.before	= false;
				this.data.dnd.inside	= false;
				$.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");
				m.hide();
				if(ml) { ml.hide(); }
				if(r && r[0] === e.target.parentNode) {
					if(this.data.dnd.to1) {
						clearTimeout(this.data.dnd.to1);
						this.data.dnd.to1 = false;
					}
					if(this.data.dnd.to2) {
						clearTimeout(this.data.dnd.to2);
						this.data.dnd.to2 = false;
					}
				}
			},
			start_drag : function (obj, e) {
				o = this._get_node(obj);
				if(this.data.ui && this.is_selected(o)) { o = this._get_node(null, true); }
				var dt = o.length > 1 ? this._get_string("multiple_selection") : this.get_text(o),
					cnt = this.get_container();
				if(!this._get_settings().core.html_titles) { dt = dt.replace(/</ig,"&lt;").replace(/>/ig,"&gt;"); }
				$.vakata.dnd.drag_start(e, { jstree : true, obj : o }, "<ins class='jstree-icon'></ins>" + dt );
				if(this.data.themes) { 
					if(m) { m.attr("class", "jstree-" + this.data.themes.theme); }
					if(ml) { ml.attr("class", "jstree-" + this.data.themes.theme); }
					$.vakata.dnd.helper.attr("class", "jstree-dnd-helper jstree-" + this.data.themes.theme); 
				}
				this.data.dnd.cof = cnt.offset();
				this.data.dnd.cw = parseInt(cnt.width(),10);
				this.data.dnd.ch = parseInt(cnt.height(),10);
				this.data.dnd.active = true;
			}
		}
	});
	$(function() {
		var css_string = '' + 
			'#vakata-dragged ins { display:block; text-decoration:none; width:16px; height:16px; margin:0 0 0 0; padding:0; position:absolute; top:4px; left:4px; ' + 
			' -moz-border-radius:4px; border-radius:4px; -webkit-border-radius:4px; ' +
			'} ' + 
			'#vakata-dragged .jstree-ok { background:green; } ' + 
			'#vakata-dragged .jstree-invalid { background:red; } ' + 
			'#jstree-marker { padding:0; margin:0; font-size:12px; overflow:hidden; height:12px; width:8px; position:absolute; top:-30px; z-index:10001; background-repeat:no-repeat; display:none; background-color:transparent; text-shadow:1px 1px 1px white; color:black; line-height:10px; } ' + 
			'#jstree-marker-line { padding:0; margin:0; line-height:0%; font-size:1px; overflow:hidden; height:1px; width:100px; position:absolute; top:-30px; z-index:10000; background-repeat:no-repeat; display:none; background-color:#456c43; ' + 
			' cursor:pointer; border:1px solid #eeeeee; border-left:0; -moz-box-shadow: 0px 0px 2px #666; -webkit-box-shadow: 0px 0px 2px #666; box-shadow: 0px 0px 2px #666; ' + 
			' -moz-border-radius:1px; border-radius:1px; -webkit-border-radius:1px; ' +
			'}' + 
			'';
		$.vakata.css.add_sheet({ str : css_string, title : "jstree" });
		m = $("<div />").attr({ id : "jstree-marker" }).hide().html("&raquo;")
			.bind("mouseleave mouseenter", function (e) { 
				m.hide();
				ml.hide();
				e.preventDefault(); 
				e.stopImmediatePropagation(); 
				return false; 
			})
			.appendTo("body");
		ml = $("<div />").attr({ id : "jstree-marker-line" }).hide()
			.bind("mouseup", function (e) { 
				if(r && r.length) { 
					r.children("a").trigger(e); 
					e.preventDefault(); 
					e.stopImmediatePropagation(); 
					return false; 
				} 
			})
			.bind("mouseleave", function (e) { 
				var rt = $(e.relatedTarget);
				if(rt.is(".jstree") || rt.closest(".jstree").length === 0) {
					if(r && r.length) { 
						r.children("a").trigger(e); 
						m.hide();
						ml.hide();
						e.preventDefault(); 
						e.stopImmediatePropagation(); 
						return false; 
					}
				}
			})
			.appendTo("body");
		$(document).bind("drag_start.vakata", function (e, data) {
			if(data.data.jstree) { m.show(); if(ml) { ml.show(); } }
		});
		$(document).bind("drag_stop.vakata", function (e, data) {
			if(data.data.jstree) { m.hide(); if(ml) { ml.hide(); } }
		});
	});
})(jQuery);
//*/

/*
 * jsTree checkbox plugin
 * Inserts checkboxes in front of every node
 * Depends on the ui plugin
 * DOES NOT WORK NICELY WITH MULTITREE DRAG'N'DROP
 */
(function ($) {
	$.jstree.plugin("checkbox", {
		__init : function () {
			this.data.checkbox.noui = this._get_settings().checkbox.override_ui;
			if(this.data.ui && this.data.checkbox.noui) {
				this.select_node = this.deselect_node = this.deselect_all = $.noop;
				this.get_selected = this.get_checked;
			}

			this.get_container()
				.bind("open_node.jstree create_node.jstree clean_node.jstree refresh.jstree", $.proxy(function (e, data) { 
						this._prepare_checkboxes(data.rslt.obj);
					}, this))
				.bind("loaded.jstree", $.proxy(function (e) {
						this._prepare_checkboxes();
					}, this))
				.delegate( (this.data.ui && this.data.checkbox.noui ? "a" : "ins.jstree-checkbox") , "click.jstree", $.proxy(function (e) {
						e.preventDefault();
						if(this._get_node(e.target).hasClass("jstree-checked")) { this.uncheck_node(e.target); }
						else { this.check_node(e.target); }
						if(this.data.ui && this.data.checkbox.noui) {
							this.save_selected();
							if(this.data.cookies) { this.save_cookie("select_node"); }
						}
						else {
							e.stopImmediatePropagation();
							return false;
						}
					}, this));
		},
		defaults : {
			override_ui : false,
			two_state : false,
			real_checkboxes : false,
			checked_parent_open : true,
			real_checkboxes_names : function (n) { return [ ("check_" + (n[0].id || Math.ceil(Math.random() * 10000))) , 1]; }
		},
		__destroy : function () {
			this.get_container()
				.find("input.jstree-real-checkbox").removeClass("jstree-real-checkbox").end()
				.find("ins.jstree-checkbox").remove();
		},
		_fn : {
			_checkbox_notify : function (n, data) {
				if(data.checked) {
					this.check_node(n, false);
				}
			},
			_prepare_checkboxes : function (obj) {
				obj = !obj || obj == -1 ? this.get_container().find("> ul > li") : this._get_node(obj);
				if(obj === false) { return; } // added for removing root nodes
				var c, _this = this, t, ts = this._get_settings().checkbox.two_state, rc = this._get_settings().checkbox.real_checkboxes, rcn = this._get_settings().checkbox.real_checkboxes_names;
				obj.each(function () {
					t = $(this);
					c = t.is("li") && (t.hasClass("jstree-checked") || (rc && t.children(":checked").length)) ? "jstree-checked" : "jstree-unchecked";
					t.find("li").andSelf().each(function () {
						var $t = $(this), nm;
						$t.children("a" + (_this.data.languages ? "" : ":eq(0)") ).not(":has(.jstree-checkbox)").prepend("<ins class='jstree-checkbox'>&#160;</ins>").parent().not(".jstree-checked, .jstree-unchecked").addClass( ts ? "jstree-unchecked" : c );
						if(rc) {
							if(!$t.children(":checkbox").length) {
								nm = rcn.call(_this, $t);
								$t.prepend("<input type='checkbox' class='jstree-real-checkbox' id='" + nm[0] + "' name='" + nm[0] + "' value='" + nm[1] + "' />");
							}
							else {
								$t.children(":checkbox").addClass("jstree-real-checkbox");
							}
						}
						if(!ts) {
							if(c === "jstree-checked" || $t.hasClass("jstree-checked") || $t.children(':checked').length) {
								$t.find("li").andSelf().addClass("jstree-checked").children(":checkbox").prop("checked", true);
							}
						}
						else {
							if($t.hasClass("jstree-checked") || $t.children(':checked').length) {
								$t.addClass("jstree-checked").children(":checkbox").prop("checked", true);
							}
						}
					});
				});
				if(!ts) {
					obj.find(".jstree-checked").parent().parent().each(function () { _this._repair_state(this); }); 
				}
			},
			change_state : function (obj, state) {
				obj = this._get_node(obj);
				var coll = false, rc = this._get_settings().checkbox.real_checkboxes;
				if(!obj || obj === -1) { return false; }
				state = (state === false || state === true) ? state : obj.hasClass("jstree-checked");
				if(this._get_settings().checkbox.two_state) {
					if(state) { 
						obj.removeClass("jstree-checked").addClass("jstree-unchecked"); 
						if(rc) { obj.children(":checkbox").prop("checked", false); }
					}
					else { 
						obj.removeClass("jstree-unchecked").addClass("jstree-checked"); 
						if(rc) { obj.children(":checkbox").prop("checked", true); }
					}
				}
				else {
					if(state) { 
						coll = obj.find("li").andSelf();
						if(!coll.filter(".jstree-checked, .jstree-undetermined").length) { return false; }
						coll.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked"); 
						if(rc) { coll.children(":checkbox").prop("checked", false); }
					}
					else { 
						coll = obj.find("li").andSelf();
						if(!coll.filter(".jstree-unchecked, .jstree-undetermined").length) { return false; }
						coll.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked"); 
						if(rc) { coll.children(":checkbox").prop("checked", true); }
						if(this.data.ui) { this.data.ui.last_selected = obj; }
						this.data.checkbox.last_selected = obj;
					}
					obj.parentsUntil(".jstree", "li").each(function () {
						var $this = $(this);
						if(state) {
							if($this.children("ul").children("li.jstree-checked, li.jstree-undetermined").length) {
								$this.parentsUntil(".jstree", "li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");
								if(rc) { $this.parentsUntil(".jstree", "li").andSelf().children(":checkbox").prop("checked", false); }
								return false;
							}
							else {
								$this.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked");
								if(rc) { $this.children(":checkbox").prop("checked", false); }
							}
						}
						else {
							if($this.children("ul").children("li.jstree-unchecked, li.jstree-undetermined").length) {
								$this.parentsUntil(".jstree", "li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");
								if(rc) { $this.parentsUntil(".jstree", "li").andSelf().children(":checkbox").prop("checked", false); }
								return false;
							}
							else {
								$this.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked");
								if(rc) { $this.children(":checkbox").prop("checked", true); }
							}
						}
					});
				}
				if(this.data.ui && this.data.checkbox.noui) { this.data.ui.selected = this.get_checked(); }
				this.__callback(obj);
				return true;
			},
			check_node : function (obj) {
				if(this.change_state(obj, false)) { 
					obj = this._get_node(obj);
					if(this._get_settings().checkbox.checked_parent_open) {
						var t = this;
						obj.parents(".jstree-closed").each(function () { t.open_node(this, false, true); });
					}
					this.__callback({ "obj" : obj }); 
				}
			},
			uncheck_node : function (obj) {
				if(this.change_state(obj, true)) { this.__callback({ "obj" : this._get_node(obj) }); }
			},
			check_all : function () {
				var _this = this, 
					coll = this._get_settings().checkbox.two_state ? this.get_container_ul().find("li") : this.get_container_ul().children("li");
				coll.each(function () {
					_this.change_state(this, false);
				});
				this.__callback();
			},
			uncheck_all : function () {
				var _this = this,
					coll = this._get_settings().checkbox.two_state ? this.get_container_ul().find("li") : this.get_container_ul().children("li");
				coll.each(function () {
					_this.change_state(this, true);
				});
				this.__callback();
			},

			is_checked : function(obj) {
				obj = this._get_node(obj);
				return obj.length ? obj.is(".jstree-checked") : false;
			},
			get_checked : function (obj, get_all) {
				obj = !obj || obj === -1 ? this.get_container() : this._get_node(obj);
				return get_all || this._get_settings().checkbox.two_state ? obj.find(".jstree-checked") : obj.find("> ul > .jstree-checked, .jstree-undetermined > ul > .jstree-checked");
			},
			get_unchecked : function (obj, get_all) { 
				obj = !obj || obj === -1 ? this.get_container() : this._get_node(obj);
				return get_all || this._get_settings().checkbox.two_state ? obj.find(".jstree-unchecked") : obj.find("> ul > .jstree-unchecked, .jstree-undetermined > ul > .jstree-unchecked");
			},

			show_checkboxes : function () { this.get_container().children("ul").removeClass("jstree-no-checkboxes"); },
			hide_checkboxes : function () { this.get_container().children("ul").addClass("jstree-no-checkboxes"); },

			_repair_state : function (obj) {
				obj = this._get_node(obj);
				if(!obj.length) { return; }
				if(this._get_settings().checkbox.two_state) {
					obj.find('li').andSelf().not('.jstree-checked').removeClass('jstree-undetermined').addClass('jstree-unchecked').children(':checkbox').prop('checked', true);
					return;
				}
				var rc = this._get_settings().checkbox.real_checkboxes,
					a = obj.find("> ul > .jstree-checked").length,
					b = obj.find("> ul > .jstree-undetermined").length,
					c = obj.find("> ul > li").length;
				if(c === 0) { if(obj.hasClass("jstree-undetermined")) { this.change_state(obj, false); } }
				else if(a === 0 && b === 0) { this.change_state(obj, true); }
				else if(a === c) { this.change_state(obj, false); }
				else { 
					obj.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");
					if(rc) { obj.parentsUntil(".jstree", "li").andSelf().children(":checkbox").prop("checked", false); }
				}
			},
			reselect : function () {
				if(this.data.ui && this.data.checkbox.noui) { 
					var _this = this,
						s = this.data.ui.to_select;
					s = $.map($.makeArray(s), function (n) { return "#" + n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"); });
					this.deselect_all();
					$.each(s, function (i, val) { _this.check_node(val); });
					this.__callback();
				}
				else { 
					this.__call_old(); 
				}
			},
			save_loaded : function () {
				var _this = this;
				this.data.core.to_load = [];
				this.get_container_ul().find("li.jstree-closed.jstree-undetermined").each(function () {
					if(this.id) { _this.data.core.to_load.push("#" + this.id); }
				});
			}
		}
	});
	$(function() {
		var css_string = '.jstree .jstree-real-checkbox { display:none; } ';
		$.vakata.css.add_sheet({ str : css_string, title : "jstree" });
	});
})(jQuery);
//*/

/* 
 * jsTree XML plugin
 * The XML data store. Datastores are build by overriding the `load_node` and `_is_loaded` functions.
 */
(function ($) {
	$.vakata.xslt = function (xml, xsl, callback) {
		var rs = "", xm, xs, processor, support;
		// TODO: IE9 no XSLTProcessor, no document.recalc
		if(document.recalc) {
			xm = document.createElement('xml');
			xs = document.createElement('xml');
			xm.innerHTML = xml;
			xs.innerHTML = xsl;
			$("body").append(xm).append(xs);
			setTimeout( (function (xm, xs, callback) {
				return function () {
					callback.call(null, xm.transformNode(xs.XMLDocument));
					setTimeout( (function (xm, xs) { return function () { $(xm).remove(); $(xs).remove(); }; })(xm, xs), 200);
				};
			})(xm, xs, callback), 100);
			return true;
		}
		if(typeof window.DOMParser !== "undefined" && typeof window.XMLHttpRequest !== "undefined" && typeof window.XSLTProcessor === "undefined") {
			xml = new DOMParser().parseFromString(xml, "text/xml");
			xsl = new DOMParser().parseFromString(xsl, "text/xml");
			// alert(xml.transformNode());
			// callback.call(null, new XMLSerializer().serializeToString(rs));
			
		}
		if(typeof window.DOMParser !== "undefined" && typeof window.XMLHttpRequest !== "undefined" && typeof window.XSLTProcessor !== "undefined") {
			processor = new XSLTProcessor();
			support = $.isFunction(processor.transformDocument) ? (typeof window.XMLSerializer !== "undefined") : true;
			if(!support) { return false; }
			xml = new DOMParser().parseFromString(xml, "text/xml");
			xsl = new DOMParser().parseFromString(xsl, "text/xml");
			if($.isFunction(processor.transformDocument)) {
				rs = document.implementation.createDocument("", "", null);
				processor.transformDocument(xml, xsl, rs, null);
				callback.call(null, new XMLSerializer().serializeToString(rs));
				return true;
			}
			else {
				processor.importStylesheet(xsl);
				rs = processor.transformToFragment(xml, document);
				callback.call(null, $("<div />").append(rs).html());
				return true;
			}
		}
		return false;
	};
	var xsl = {
		'nest' : '<' + '?xml version="1.0" encoding="utf-8" ?>' + 
			'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" >' + 
			'<xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/html" />' + 
			'<xsl:template match="/">' + 
			'	<xsl:call-template name="nodes">' + 
			'		<xsl:with-param name="node" select="/root" />' + 
			'	</xsl:call-template>' + 
			'</xsl:template>' + 
			'<xsl:template name="nodes">' + 
			'	<xsl:param name="node" />' + 
			'	<ul>' + 
			'	<xsl:for-each select="$node/item">' + 
			'		<xsl:variable name="children" select="count(./item) &gt; 0" />' + 
			'		<li>' + 
			'			<xsl:attribute name="class">' + 
			'				<xsl:if test="position() = last()">jstree-last </xsl:if>' + 
			'				<xsl:choose>' + 
			'					<xsl:when test="@state = \'open\'">jstree-open </xsl:when>' + 
			'					<xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed </xsl:when>' + 
			'					<xsl:otherwise>jstree-leaf </xsl:otherwise>' + 
			'				</xsl:choose>' + 
			'				<xsl:value-of select="@class" />' + 
			'			</xsl:attribute>' + 
			'			<xsl:for-each select="@*">' + 
			'				<xsl:if test="name() != \'class\' and name() != \'state\' and name() != \'hasChildren\'">' + 
			'					<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>' + 
			'				</xsl:if>' + 
			'			</xsl:for-each>' + 
			'	<ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>' + 
			'			<xsl:for-each select="content/name">' + 
			'				<a>' + 
			'				<xsl:attribute name="href">' + 
			'					<xsl:choose>' + 
			'					<xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>' + 
			'					<xsl:otherwise>#</xsl:otherwise>' + 
			'					</xsl:choose>' + 
			'				</xsl:attribute>' + 
			'				<xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>' + 
			'				<xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>' + 
			'				<xsl:for-each select="@*">' + 
			'					<xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">' + 
			'						<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>' + 
			'					</xsl:if>' + 
			'				</xsl:for-each>' + 
			'					<ins>' + 
			'						<xsl:attribute name="class">jstree-icon ' + 
			'							<xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>' + 
			'						</xsl:attribute>' + 
			'						<xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>' + 
			'						<xsl:text>&#xa0;</xsl:text>' + 
			'					</ins>' + 
			'					<xsl:copy-of select="./child::node()" />' + 
			'				</a>' + 
			'			</xsl:for-each>' + 
			'			<xsl:if test="$children or @hasChildren"><xsl:call-template name="nodes"><xsl:with-param name="node" select="current()" /></xsl:call-template></xsl:if>' + 
			'		</li>' + 
			'	</xsl:for-each>' + 
			'	</ul>' + 
			'</xsl:template>' + 
			'</xsl:stylesheet>',

		'flat' : '<' + '?xml version="1.0" encoding="utf-8" ?>' + 
			'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" >' + 
			'<xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/xml" />' + 
			'<xsl:template match="/">' + 
			'	<ul>' + 
			'	<xsl:for-each select="//item[not(@parent_id) or @parent_id=0 or not(@parent_id = //item/@id)]">' + /* the last `or` may be removed */
			'		<xsl:call-template name="nodes">' + 
			'			<xsl:with-param name="node" select="." />' + 
			'			<xsl:with-param name="is_last" select="number(position() = last())" />' + 
			'		</xsl:call-template>' + 
			'	</xsl:for-each>' + 
			'	</ul>' + 
			'</xsl:template>' + 
			'<xsl:template name="nodes">' + 
			'	<xsl:param name="node" />' + 
			'	<xsl:param name="is_last" />' + 
			'	<xsl:variable name="children" select="count(//item[@parent_id=$node/attribute::id]) &gt; 0" />' + 
			'	<li>' + 
			'	<xsl:attribute name="class">' + 
			'		<xsl:if test="$is_last = true()">jstree-last </xsl:if>' + 
			'		<xsl:choose>' + 
			'			<xsl:when test="@state = \'open\'">jstree-open </xsl:when>' + 
			'			<xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed </xsl:when>' + 
			'			<xsl:otherwise>jstree-leaf </xsl:otherwise>' + 
			'		</xsl:choose>' + 
			'		<xsl:value-of select="@class" />' + 
			'	</xsl:attribute>' + 
			'	<xsl:for-each select="@*">' + 
			'		<xsl:if test="name() != \'parent_id\' and name() != \'hasChildren\' and name() != \'class\' and name() != \'state\'">' + 
			'		<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>' + 
			'		</xsl:if>' + 
			'	</xsl:for-each>' + 
			'	<ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>' + 
			'	<xsl:for-each select="content/name">' + 
			'		<a>' + 
			'		<xsl:attribute name="href">' + 
			'			<xsl:choose>' + 
			'			<xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>' + 
			'			<xsl:otherwise>#</xsl:otherwise>' + 
			'			</xsl:choose>' + 
			'		</xsl:attribute>' + 
			'		<xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>' + 
			'		<xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>' + 
			'		<xsl:for-each select="@*">' + 
			'			<xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">' + 
			'				<xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>' + 
			'			</xsl:if>' + 
			'		</xsl:for-each>' + 
			'			<ins>' + 
			'				<xsl:attribute name="class">jstree-icon ' + 
			'					<xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>' + 
			'				</xsl:attribute>' + 
			'				<xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>' + 
			'				<xsl:text>&#xa0;</xsl:text>' + 
			'			</ins>' + 
			'			<xsl:copy-of select="./child::node()" />' + 
			'		</a>' + 
			'	</xsl:for-each>' + 
			'	<xsl:if test="$children">' + 
			'		<ul>' + 
			'		<xsl:for-each select="//item[@parent_id=$node/attribute::id]">' + 
			'			<xsl:call-template name="nodes">' + 
			'				<xsl:with-param name="node" select="." />' + 
			'				<xsl:with-param name="is_last" select="number(position() = last())" />' + 
			'			</xsl:call-template>' + 
			'		</xsl:for-each>' + 
			'		</ul>' + 
			'	</xsl:if>' + 
			'	</li>' + 
			'</xsl:template>' + 
			'</xsl:stylesheet>'
	},
	escape_xml = function(string) {
		return string
			.toString()
			.replace(/&/g, '&amp;')
			.replace(/</g, '&lt;')
			.replace(/>/g, '&gt;')
			.replace(/"/g, '&quot;')
			.replace(/'/g, '&apos;');
	};
	$.jstree.plugin("xml_data", {
		defaults : { 
			data : false,
			ajax : false,
			xsl : "flat",
			clean_node : false,
			correct_state : true,
			get_skip_empty : false,
			get_include_preamble : true
		},
		_fn : {
			load_node : function (obj, s_call, e_call) { var _this = this; this.load_node_xml(obj, function () { _this.__callback({ "obj" : _this._get_node(obj) }); s_call.call(this); }, e_call); },
			_is_loaded : function (obj) { 
				var s = this._get_settings().xml_data;
				obj = this._get_node(obj);
				return obj == -1 || !obj || (!s.ajax && !$.isFunction(s.data)) || obj.is(".jstree-open, .jstree-leaf") || obj.children("ul").children("li").size() > 0;
			},
			load_node_xml : function (obj, s_call, e_call) {
				var s = this.get_settings().xml_data,
					error_func = function () {},
					success_func = function () {};

				obj = this._get_node(obj);
				if(obj && obj !== -1) {
					if(obj.data("jstree_is_loading")) { return; }
					else { obj.data("jstree_is_loading",true); }
				}
				switch(!0) {
					case (!s.data && !s.ajax): throw "Neither data nor ajax settings supplied.";
					case ($.isFunction(s.data)):
						s.data.call(this, obj, $.proxy(function (d) {
							this.parse_xml(d, $.proxy(function (d) {
								if(d) {
									d = d.replace(/ ?xmlns="[^"]*"/ig, "");
									if(d.length > 10) {
										d = $(d);
										if(obj === -1 || !obj) { this.get_container().children("ul").empty().append(d.children()); }
										else { obj.children("a.jstree-loading").removeClass("jstree-loading"); obj.append(d); obj.removeData("jstree_is_loading"); }
										if(s.clean_node) { this.clean_node(obj); }
										if(s_call) { s_call.call(this); }
									}
									else {
										if(obj && obj !== -1) { 
											obj.children("a.jstree-loading").removeClass("jstree-loading");
											obj.removeData("jstree_is_loading");
											if(s.correct_state) { 
												this.correct_state(obj);
												if(s_call) { s_call.call(this); } 
											}
										}
										else {
											if(s.correct_state) { 
												this.get_container().children("ul").empty();
												if(s_call) { s_call.call(this); } 
											}
										}
									}
								}
							}, this));
						}, this));
						break;
					case (!!s.data && !s.ajax) || (!!s.data && !!s.ajax && (!obj || obj === -1)):
						if(!obj || obj == -1) {
							this.parse_xml(s.data, $.proxy(function (d) {
								if(d) {
									d = d.replace(/ ?xmlns="[^"]*"/ig, "");
									if(d.length > 10) {
										d = $(d);
										this.get_container().children("ul").empty().append(d.children());
										if(s.clean_node) { this.clean_node(obj); }
										if(s_call) { s_call.call(this); }
									}
								}
								else { 
									if(s.correct_state) { 
										this.get_container().children("ul").empty(); 
										if(s_call) { s_call.call(this); }
									}
								}
							}, this));
						}
						break;
					case (!s.data && !!s.ajax) || (!!s.data && !!s.ajax && obj && obj !== -1):
						error_func = function (x, t, e) {
							var ef = this.get_settings().xml_data.ajax.error; 
							if(ef) { ef.call(this, x, t, e); }
							if(obj !== -1 && obj.length) {
								obj.children("a.jstree-loading").removeClass("jstree-loading");
								obj.removeData("jstree_is_loading");
								if(t === "success" && s.correct_state) { this.correct_state(obj); }
							}
							else {
								if(t === "success" && s.correct_state) { this.get_container().children("ul").empty(); }
							}
							if(e_call) { e_call.call(this); }
						};
						success_func = function (d, t, x) {
							d = x.responseText;
							var sf = this.get_settings().xml_data.ajax.success; 
							if(sf) { d = sf.call(this,d,t,x) || d; }
							if(d === "" || (d && d.toString && d.toString().replace(/^[\s\n]+$/,"") === "")) {
								return error_func.call(this, x, t, "");
							}
							this.parse_xml(d, $.proxy(function (d) {
								if(d) {
									d = d.replace(/ ?xmlns="[^"]*"/ig, "");
									if(d.length > 10) {
										d = $(d);
										if(obj === -1 || !obj) { this.get_container().children("ul").empty().append(d.children()); }
										else { obj.children("a.jstree-loading").removeClass("jstree-loading"); obj.append(d); obj.removeData("jstree_is_loading"); }
										if(s.clean_node) { this.clean_node(obj); }
										if(s_call) { s_call.call(this); }
									}
									else {
										if(obj && obj !== -1) { 
											obj.children("a.jstree-loading").removeClass("jstree-loading");
											obj.removeData("jstree_is_loading");
											if(s.correct_state) { 
												this.correct_state(obj);
												if(s_call) { s_call.call(this); } 
											}
										}
										else {
											if(s.correct_state) { 
												this.get_container().children("ul").empty();
												if(s_call) { s_call.call(this); } 
											}
										}
									}
								}
							}, this));
						};
						s.ajax.context = this;
						s.ajax.error = error_func;
						s.ajax.success = success_func;
						if(!s.ajax.dataType) { s.ajax.dataType = "xml"; }
						if($.isFunction(s.ajax.url)) { s.ajax.url = s.ajax.url.call(this, obj); }
						if($.isFunction(s.ajax.data)) { s.ajax.data = s.ajax.data.call(this, obj); }
						$.ajax(s.ajax);
						break;
				}
			},
			parse_xml : function (xml, callback) {
				var s = this._get_settings().xml_data;
				$.vakata.xslt(xml, xsl[s.xsl], callback);
			},
			get_xml : function (tp, obj, li_attr, a_attr, is_callback) {
				var result = "", 
					s = this._get_settings(), 
					_this = this,
					tmp1, tmp2, li, a, lang;
				if(!tp) { tp = "flat"; }
				if(!is_callback) { is_callback = 0; }
				obj = this._get_node(obj);
				if(!obj || obj === -1) { obj = this.get_container().find("> ul > li"); }
				li_attr = $.isArray(li_attr) ? li_attr : [ "id", "class" ];
				if(!is_callback && this.data.types && $.inArray(s.types.type_attr, li_attr) === -1) { li_attr.push(s.types.type_attr); }

				a_attr = $.isArray(a_attr) ? a_attr : [ ];

				if(!is_callback) { 
					if(s.xml_data.get_include_preamble) { 
						result += '<' + '?xml version="1.0" encoding="UTF-8"?' + '>'; 
					}
					result += "<root>"; 
				}
				obj.each(function () {
					result += "<item";
					li = $(this);
					$.each(li_attr, function (i, v) { 
						var t = li.attr(v);
						if(!s.xml_data.get_skip_empty || typeof t !== "undefined") {
							result += " " + v + "=\"" + escape_xml((" " + (t || "")).replace(/ jstree[^ ]*/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"")) + "\""; 
						}
					});
					if(li.hasClass("jstree-open")) { result += " state=\"open\""; }
					if(li.hasClass("jstree-closed")) { result += " state=\"closed\""; }
					if(tp === "flat") { result += " parent_id=\"" + escape_xml(is_callback) + "\""; }
					result += ">";
					result += "<content>";
					a = li.children("a");
					a.each(function () {
						tmp1 = $(this);
						lang = false;
						result += "<name";
						if($.inArray("languages", s.plugins) !== -1) {
							$.each(s.languages, function (k, z) {
								if(tmp1.hasClass(z)) { result += " lang=\"" + escape_xml(z) + "\""; lang = z; return false; }
							});
						}
						if(a_attr.length) { 
							$.each(a_attr, function (k, z) {
								var t = tmp1.attr(z);
								if(!s.xml_data.get_skip_empty || typeof t !== "undefined") {
									result += " " + z + "=\"" + escape_xml((" " + t || "").replace(/ jstree[^ ]*/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"")) + "\"";
								}
							});
						}
						if(tmp1.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').replace(/^\s+$/ig,"").length) {
							result += ' icon="' + escape_xml(tmp1.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"")) + '"';
						}
						if(tmp1.children("ins").get(0).style.backgroundImage.length) {
							result += ' icon="' + escape_xml(tmp1.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","").replace(/'/ig,"").replace(/"/ig,"")) + '"';
						}
						result += ">";
						result += "<![CDATA[" + _this.get_text(tmp1, lang) + "]]>";
						result += "</name>";
					});
					result += "</content>";
					tmp2 = li[0].id || true;
					li = li.find("> ul > li");
					if(li.length) { tmp2 = _this.get_xml(tp, li, li_attr, a_attr, tmp2); }
					else { tmp2 = ""; }
					if(tp == "nest") { result += tmp2; }
					result += "</item>";
					if(tp == "flat") { result += tmp2; }
				});
				if(!is_callback) { result += "</root>"; }
				return result;
			}
		}
	});
})(jQuery);
//*/

/*
 * jsTree search plugin
 * Enables both sync and async search on the tree
 * DOES NOT WORK WITH JSON PROGRESSIVE RENDER
 */
(function ($) {
	$.expr[':'].jstree_contains = function(a,i,m){
		return (a.textContent || a.innerText || "").toLowerCase().indexOf(m[3].toLowerCase())>=0;
	};
	$.expr[':'].jstree_title_contains = function(a,i,m) {
		return (a.getAttribute("title") || "").toLowerCase().indexOf(m[3].toLowerCase())>=0;
	};
	$.jstree.plugin("search", {
		__init : function () {
			this.data.search.str = "";
			this.data.search.result = $();
			if(this._get_settings().search.show_only_matches) {
				this.get_container()
					.bind("search.jstree", function (e, data) {
						$(this).children("ul").find("li").hide().removeClass("jstree-last");
						data.rslt.nodes.parentsUntil(".jstree").andSelf().show()
							.filter("ul").each(function () { $(this).children("li:visible").eq(-1).addClass("jstree-last"); });
					})
					.bind("clear_search.jstree", function () {
						$(this).children("ul").find("li").css("display","").end().end().jstree("clean_node", -1);
					});
			}
		},
		defaults : {
			ajax : false,
			search_method : "jstree_contains", // for case insensitive - jstree_contains
			show_only_matches : false
		},
		_fn : {
			search : function (str, skip_async) {
				if($.trim(str) === "") { this.clear_search(); return; }
				var s = this.get_settings().search, 
					t = this,
					error_func = function () { },
					success_func = function () { };
				this.data.search.str = str;

				if(!skip_async && s.ajax !== false && this.get_container_ul().find("li.jstree-closed:not(:has(ul)):eq(0)").length > 0) {
					this.search.supress_callback = true;
					error_func = function () { };
					success_func = function (d, t, x) {
						var sf = this.get_settings().search.ajax.success; 
						if(sf) { d = sf.call(this,d,t,x) || d; }
						this.data.search.to_open = d;
						this._search_open();
					};
					s.ajax.context = this;
					s.ajax.error = error_func;
					s.ajax.success = success_func;
					if($.isFunction(s.ajax.url)) { s.ajax.url = s.ajax.url.call(this, str); }
					if($.isFunction(s.ajax.data)) { s.ajax.data = s.ajax.data.call(this, str); }
					if(!s.ajax.data) { s.ajax.data = { "search_string" : str }; }
					if(!s.ajax.dataType || /^json/.exec(s.ajax.dataType)) { s.ajax.dataType = "json"; }
					$.ajax(s.ajax);
					return;
				}
				if(this.data.search.result.length) { this.clear_search(); }
				this.data.search.result = this.get_container().find("a" + (this.data.languages ? "." + this.get_lang() : "" ) + ":" + (s.search_method) + "(" + this.data.search.str + ")");
				this.data.search.result.addClass("jstree-search").parent().parents(".jstree-closed").each(function () {
					t.open_node(this, false, true);
				});
				this.__callback({ nodes : this.data.search.result, str : str });
			},
			clear_search : function (str) {
				this.data.search.result.removeClass("jstree-search");
				this.__callback(this.data.search.result);
				this.data.search.result = $();
			},
			_search_open : function (is_callback) {
				var _this = this,
					done = true,
					current = [],
					remaining = [];
				if(this.data.search.to_open.length) {
					$.each(this.data.search.to_open, function (i, val) {
						if(val == "#") { return true; }
						if($(val).length && $(val).is(".jstree-closed")) { current.push(val); }
						else { remaining.push(val); }
					});
					if(current.length) {
						this.data.search.to_open = remaining;
						$.each(current, function (i, val) { 
							_this.open_node(val, function () { _this._search_open(true); }); 
						});
						done = false;
					}
				}
				if(done) { this.search(this.data.search.str, true); }
			}
		}
	});
})(jQuery);
//*/

/* 
 * jsTree contextmenu plugin
 */
(function ($) {
	$.vakata.context = {
		hide_on_mouseleave : false,

		cnt		: $("<div id='vakata-contextmenu' />"),
		vis		: false,
		tgt		: false,
		par		: false,
		func	: false,
		data	: false,
		rtl		: false,
		show	: function (s, t, x, y, d, p, rtl) {
			$.vakata.context.rtl = !!rtl;
			var html = $.vakata.context.parse(s), h, w;
			if(!html) { return; }
			$.vakata.context.vis = true;
			$.vakata.context.tgt = t;
			$.vakata.context.par = p || t || null;
			$.vakata.context.data = d || null;
			$.vakata.context.cnt
				.html(html)
				.css({ "visibility" : "hidden", "display" : "block", "left" : 0, "top" : 0 });

			if($.vakata.context.hide_on_mouseleave) {
				$.vakata.context.cnt
					.one("mouseleave", function(e) { $.vakata.context.hide(); });
			}

			h = $.vakata.context.cnt.height();
			w = $.vakata.context.cnt.width();
			if(x + w > $(document).width()) { 
				x = $(document).width() - (w + 5); 
				$.vakata.context.cnt.find("li > ul").addClass("right"); 
			}
			if(y + h > $(document).height()) { 
				y = y - (h + t[0].offsetHeight); 
				$.vakata.context.cnt.find("li > ul").addClass("bottom"); 
			}

			$.vakata.context.cnt
				.css({ "left" : x, "top" : y })
				.find("li:has(ul)")
					.bind("mouseenter", function (e) { 
						var w = $(document).width(),
							h = $(document).height(),
							ul = $(this).children("ul").show(); 
						if(w !== $(document).width()) { ul.toggleClass("right"); }
						if(h !== $(document).height()) { ul.toggleClass("bottom"); }
					})
					.bind("mouseleave", function (e) { 
						$(this).children("ul").hide(); 
					})
					.end()
				.css({ "visibility" : "visible" })
				.show();
			$(document).triggerHandler("context_show.vakata");
		},
		hide	: function () {
			$.vakata.context.vis = false;
			$.vakata.context.cnt.attr("class","").css({ "visibility" : "hidden" });
			$(document).triggerHandler("context_hide.vakata");
		},
		parse	: function (s, is_callback) {
			if(!s) { return false; }
			var str = "",
				tmp = false,
				was_sep = true;
			if(!is_callback) { $.vakata.context.func = {}; }
			str += "<ul>";
			$.each(s, function (i, val) {
				if(!val) { return true; }
				$.vakata.context.func[i] = val.action;
				if(!was_sep && val.separator_before) {
					str += "<li class='vakata-separator vakata-separator-before'></li>";
				}
				was_sep = false;
				str += "<li class='" + (val._class || "") + (val._disabled ? " jstree-contextmenu-disabled " : "") + "'><ins ";
				if(val.icon && val.icon.indexOf("/") === -1) { str += " class='" + val.icon + "' "; }
				if(val.icon && val.icon.indexOf("/") !== -1) { str += " style='background:url(" + val.icon + ") center center no-repeat;' "; }
				str += ">&#160;</ins><a href='#' rel='" + i + "'>";
				if(val.submenu) {
					str += "<span style='float:" + ($.vakata.context.rtl ? "left" : "right") + ";'>&raquo;</span>";
				}
				str += val.label + "</a>";
				if(val.submenu) {
					tmp = $.vakata.context.parse(val.submenu, true);
					if(tmp) { str += tmp; }
				}
				str += "</li>";
				if(val.separator_after) {
					str += "<li class='vakata-separator vakata-separator-after'></li>";
					was_sep = true;
				}
			});
			str = str.replace(/<li class\='vakata-separator vakata-separator-after'\><\/li\>$/,"");
			str += "</ul>";
			$(document).triggerHandler("context_parse.vakata");
			return str.length > 10 ? str : false;
		},
		exec	: function (i) {
			if($.isFunction($.vakata.context.func[i])) {
				// if is string - eval and call it!
				$.vakata.context.func[i].call($.vakata.context.data, $.vakata.context.par);
				return true;
			}
			else { return false; }
		}
	};
	$(function () {
		var css_string = '' + 
			'#vakata-contextmenu { display:block; visibility:hidden; left:0; top:-200px; position:absolute; margin:0; padding:0; min-width:180px; background:#ebebeb; border:1px solid silver; z-index:10000; *width:180px; } ' + 
			'#vakata-contextmenu ul { min-width:180px; *width:180px; } ' + 
			'#vakata-contextmenu ul, #vakata-contextmenu li { margin:0; padding:0; list-style-type:none; display:block; } ' + 
			'#vakata-contextmenu li { line-height:20px; min-height:20px; position:relative; padding:0px; } ' + 
			'#vakata-contextmenu li a { padding:1px 6px; line-height:17px; display:block; text-decoration:none; margin:1px 1px 0 1px; } ' + 
			'#vakata-contextmenu li ins { float:left; width:16px; height:16px; text-decoration:none; margin-right:2px; } ' + 
			'#vakata-contextmenu li a:hover, #vakata-contextmenu li.vakata-hover > a { background:gray; color:white; } ' + 
			'#vakata-contextmenu li ul { display:none; position:absolute; top:-2px; left:100%; background:#ebebeb; border:1px solid gray; } ' + 
			'#vakata-contextmenu .right { right:100%; left:auto; } ' + 
			'#vakata-contextmenu .bottom { bottom:-1px; top:auto; } ' + 
			'#vakata-contextmenu li.vakata-separator { min-height:0; height:1px; line-height:1px; font-size:1px; overflow:hidden; margin:0 2px; background:silver; /* border-top:1px solid #fefefe; */ padding:0; } ';
		$.vakata.css.add_sheet({ str : css_string, title : "vakata" });
		$.vakata.context.cnt
			.delegate("a","click", function (e) { e.preventDefault(); })
			.delegate("a","mouseup", function (e) {
				if(!$(this).parent().hasClass("jstree-contextmenu-disabled") && $.vakata.context.exec($(this).attr("rel"))) {
					$.vakata.context.hide();
				}
				else { $(this).blur(); }
			})
			.delegate("a","mouseover", function () {
				$.vakata.context.cnt.find(".vakata-hover").removeClass("vakata-hover");
			})
			.appendTo("body");
		$(document).bind("mousedown", function (e) { if($.vakata.context.vis && !$.contains($.vakata.context.cnt[0], e.target)) { $.vakata.context.hide(); } });
		if(typeof $.hotkeys !== "undefined") {
			$(document)
				.bind("keydown", "up", function (e) { 
					if($.vakata.context.vis) { 
						var o = $.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").prevAll("li:not(.vakata-separator)").first();
						if(!o.length) { o = $.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").last(); }
						o.addClass("vakata-hover");
						e.stopImmediatePropagation(); 
						e.preventDefault();
					} 
				})
				.bind("keydown", "down", function (e) { 
					if($.vakata.context.vis) { 
						var o = $.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").nextAll("li:not(.vakata-separator)").first();
						if(!o.length) { o = $.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").first(); }
						o.addClass("vakata-hover");
						e.stopImmediatePropagation(); 
						e.preventDefault();
					} 
				})
				.bind("keydown", "right", function (e) { 
					if($.vakata.context.vis) { 
						$.vakata.context.cnt.find(".vakata-hover").children("ul").show().children("li:not(.vakata-separator)").removeClass("vakata-hover").first().addClass("vakata-hover");
						e.stopImmediatePropagation(); 
						e.preventDefault();
					} 
				})
				.bind("keydown", "left", function (e) { 
					if($.vakata.context.vis) { 
						$.vakata.context.cnt.find(".vakata-hover").children("ul").hide().children(".vakata-separator").removeClass("vakata-hover");
						e.stopImmediatePropagation(); 
						e.preventDefault();
					} 
				})
				.bind("keydown", "esc", function (e) { 
					$.vakata.context.hide(); 
					e.preventDefault();
				})
				.bind("keydown", "space", function (e) { 
					$.vakata.context.cnt.find(".vakata-hover").last().children("a").click();
					e.preventDefault();
				});
		}
	});

	$.jstree.plugin("contextmenu", {
		__init : function () {
			this.get_container()
				.delegate("a", "contextmenu.jstree", $.proxy(function (e) {
						e.preventDefault();
						if(!$(e.currentTarget).hasClass("jstree-loading")) {
							this.show_contextmenu(e.currentTarget, e.pageX, e.pageY);
						}
					}, this))
				.delegate("a", "click.jstree", $.proxy(function (e) {
						if(this.data.contextmenu) {
							$.vakata.context.hide();
						}
					}, this))
				.bind("destroy.jstree", $.proxy(function () {
						// TODO: move this to descruct method
						if(this.data.contextmenu) {
							$.vakata.context.hide();
						}
					}, this));
			$(document).bind("context_hide.vakata", $.proxy(function () { this.data.contextmenu = false; }, this));
		},
		defaults : { 
			select_node : false, // requires UI plugin
			show_at_node : true,
			items : { // Could be a function that should return an object like this one
				"create" : {
					"separator_before"	: false,
					"separator_after"	: true,
					"label"				: "Create",
					"action"			: function (obj) { this.create(obj); }
				},
				"rename" : {
					"separator_before"	: false,
					"separator_after"	: false,
					"label"				: "Rename",
					"action"			: function (obj) { this.rename(obj); }
				},
				"remove" : {
					"separator_before"	: false,
					"icon"				: false,
					"separator_after"	: false,
					"label"				: "Delete",
					"action"			: function (obj) { if(this.is_selected(obj)) { this.remove(); } else { this.remove(obj); } }
				},
				"ccp" : {
					"separator_before"	: true,
					"icon"				: false,
					"separator_after"	: false,
					"label"				: "Edit",
					"action"			: false,
					"submenu" : { 
						"cut" : {
							"separator_before"	: false,
							"separator_after"	: false,
							"label"				: "Cut",
							"action"			: function (obj) { this.cut(obj); }
						},
						"copy" : {
							"separator_before"	: false,
							"icon"				: false,
							"separator_after"	: false,
							"label"				: "Copy",
							"action"			: function (obj) { this.copy(obj); }
						},
						"paste" : {
							"separator_before"	: false,
							"icon"				: false,
							"separator_after"	: false,
							"label"				: "Paste",
							"action"			: function (obj) { this.paste(obj); }
						}
					}
				}
			}
		},
		_fn : {
			show_contextmenu : function (obj, x, y) {
				obj = this._get_node(obj);
				var s = this.get_settings().contextmenu,
					a = obj.children("a:visible:eq(0)"),
					o = false,
					i = false;
				if(s.select_node && this.data.ui && !this.is_selected(obj)) {
					this.deselect_all();
					this.select_node(obj, true);
				}
				if(s.show_at_node || typeof x === "undefined" || typeof y === "undefined") {
					o = a.offset();
					x = o.left;
					y = o.top + this.data.core.li_height;
				}
				i = obj.data("jstree") && obj.data("jstree").contextmenu ? obj.data("jstree").contextmenu : s.items;
				if($.isFunction(i)) { i = i.call(this, obj); }
				this.data.contextmenu = true;
				$.vakata.context.show(i, a, x, y, this, obj, this._get_settings().core.rtl);
				if(this.data.themes) { $.vakata.context.cnt.attr("class", "jstree-" + this.data.themes.theme + "-context"); }
			}
		}
	});
})(jQuery);
//*/

/* 
 * jsTree types plugin
 * Adds support types of nodes
 * You can set an attribute on each li node, that represents its type.
 * According to the type setting the node may get custom icon/validation rules
 */
(function ($) {
	$.jstree.plugin("types", {
		__init : function () {
			var s = this._get_settings().types;
			this.data.types.attach_to = [];
			this.get_container()
				.bind("init.jstree", $.proxy(function () { 
						var types = s.types, 
							attr  = s.type_attr, 
							icons_css = "", 
							_this = this;

						$.each(types, function (i, tp) {
							$.each(tp, function (k, v) { 
								if(!/^(max_depth|max_children|icon|valid_children)$/.test(k)) { _this.data.types.attach_to.push(k); }
							});
							if(!tp.icon) { return true; }
							if( tp.icon.image || tp.icon.position) {
								if(i == "default")	{ icons_css += '.jstree-' + _this.get_index() + ' a > .jstree-icon { '; }
								else				{ icons_css += '.jstree-' + _this.get_index() + ' li[' + attr + '="' + i + '"] > a > .jstree-icon { '; }
								if(tp.icon.image)	{ icons_css += ' background-image:url(' + tp.icon.image + '); '; }
								if(tp.icon.position){ icons_css += ' background-position:' + tp.icon.position + '; '; }
								else				{ icons_css += ' background-position:0 0; '; }
								icons_css += '} ';
							}
						});
						if(icons_css !== "") { $.vakata.css.add_sheet({ 'str' : icons_css, title : "jstree-types" }); }
					}, this))
				.bind("before.jstree", $.proxy(function (e, data) { 
						var s, t, 
							o = this._get_settings().types.use_data ? this._get_node(data.args[0]) : false, 
							d = o && o !== -1 && o.length ? o.data("jstree") : false;
						if(d && d.types && d.types[data.func] === false) { e.stopImmediatePropagation(); return false; }
						if($.inArray(data.func, this.data.types.attach_to) !== -1) {
							if(!data.args[0] || (!data.args[0].tagName && !data.args[0].jquery)) { return; }
							s = this._get_settings().types.types;
							t = this._get_type(data.args[0]);
							if(
								( 
									(s[t] && typeof s[t][data.func] !== "undefined") || 
									(s["default"] && typeof s["default"][data.func] !== "undefined") 
								) && this._check(data.func, data.args[0]) === false
							) {
								e.stopImmediatePropagation();
								return false;
							}
						}
					}, this));
			if(is_ie6) {
				this.get_container()
					.bind("load_node.jstree set_type.jstree", $.proxy(function (e, data) {
							var r = data && data.rslt && data.rslt.obj && data.rslt.obj !== -1 ? this._get_node(data.rslt.obj).parent() : this.get_container_ul(),
								c = false,
								s = this._get_settings().types;
							$.each(s.types, function (i, tp) {
								if(tp.icon && (tp.icon.image || tp.icon.position)) {
									c = i === "default" ? r.find("li > a > .jstree-icon") : r.find("li[" + s.type_attr + "='" + i + "'] > a > .jstree-icon");
									if(tp.icon.image) { c.css("backgroundImage","url(" + tp.icon.image + ")"); }
									c.css("backgroundPosition", tp.icon.position || "0 0");
								}
							});
						}, this));
			}
		},
		defaults : {
			// defines maximum number of root nodes (-1 means unlimited, -2 means disable max_children checking)
			max_children		: -1,
			// defines the maximum depth of the tree (-1 means unlimited, -2 means disable max_depth checking)
			max_depth			: -1,
			// defines valid node types for the root nodes
			valid_children		: "all",

			// whether to use $.data
			use_data : false, 
			// where is the type stores (the rel attribute of the LI element)
			type_attr : "rel",
			// a list of types
			types : {
				// the default type
				"default" : {
					"max_children"	: -1,
					"max_depth"		: -1,
					"valid_children": "all"

					// Bound functions - you can bind any other function here (using boolean or function)
					//"select_node"	: true
				}
			}
		},
		_fn : {
			_types_notify : function (n, data) {
				if(data.type && this._get_settings().types.use_data) {
					this.set_type(data.type, n);
				}
			},
			_get_type : function (obj) {
				obj = this._get_node(obj);
				return (!obj || !obj.length) ? false : obj.attr(this._get_settings().types.type_attr) || "default";
			},
			set_type : function (str, obj) {
				obj = this._get_node(obj);
				var ret = (!obj.length || !str) ? false : obj.attr(this._get_settings().types.type_attr, str);
				if(ret) { this.__callback({ obj : obj, type : str}); }
				return ret;
			},
			_check : function (rule, obj, opts) {
				obj = this._get_node(obj);
				var v = false, t = this._get_type(obj), d = 0, _this = this, s = this._get_settings().types, data = false;
				if(obj === -1) { 
					if(!!s[rule]) { v = s[rule]; }
					else { return; }
				}
				else {
					if(t === false) { return; }
					data = s.use_data ? obj.data("jstree") : false;
					if(data && data.types && typeof data.types[rule] !== "undefined") { v = data.types[rule]; }
					else if(!!s.types[t] && typeof s.types[t][rule] !== "undefined") { v = s.types[t][rule]; }
					else if(!!s.types["default"] && typeof s.types["default"][rule] !== "undefined") { v = s.types["default"][rule]; }
				}
				if($.isFunction(v)) { v = v.call(this, obj); }
				if(rule === "max_depth" && obj !== -1 && opts !== false && s.max_depth !== -2 && v !== 0) {
					// also include the node itself - otherwise if root node it is not checked
					obj.children("a:eq(0)").parentsUntil(".jstree","li").each(function (i) {
						// check if current depth already exceeds global tree depth
						if(s.max_depth !== -1 && s.max_depth - (i + 1) <= 0) { v = 0; return false; }
						d = (i === 0) ? v : _this._check(rule, this, false);
						// check if current node max depth is already matched or exceeded
						if(d !== -1 && d - (i + 1) <= 0) { v = 0; return false; }
						// otherwise - set the max depth to the current value minus current depth
						if(d >= 0 && (d - (i + 1) < v || v < 0) ) { v = d - (i + 1); }
						// if the global tree depth exists and it minus the nodes calculated so far is less than `v` or `v` is unlimited
						if(s.max_depth >= 0 && (s.max_depth - (i + 1) < v || v < 0) ) { v = s.max_depth - (i + 1); }
					});
				}
				return v;
			},
			check_move : function () {
				if(!this.__call_old()) { return false; }
				var m  = this._get_move(),
					s  = m.rt._get_settings().types,
					mc = m.rt._check("max_children", m.cr),
					md = m.rt._check("max_depth", m.cr),
					vc = m.rt._check("valid_children", m.cr),
					ch = 0, d = 1, t;

				if(vc === "none") { return false; } 
				if($.isArray(vc) && m.ot && m.ot._get_type) {
					m.o.each(function () {
						if($.inArray(m.ot._get_type(this), vc) === -1) { d = false; return false; }
					});
					if(d === false) { return false; }
				}
				if(s.max_children !== -2 && mc !== -1) {
					ch = m.cr === -1 ? this.get_container().find("> ul > li").not(m.o).length : m.cr.find("> ul > li").not(m.o).length;
					if(ch + m.o.length > mc) { return false; }
				}
				if(s.max_depth !== -2 && md !== -1) {
					d = 0;
					if(md === 0) { return false; }
					if(typeof m.o.d === "undefined") {
						// TODO: deal with progressive rendering and async when checking max_depth (how to know the depth of the moved node)
						t = m.o;
						while(t.length > 0) {
							t = t.find("> ul > li");
							d ++;
						}
						m.o.d = d;
					}
					if(md - m.o.d < 0) { return false; }
				}
				return true;
			},
			create_node : function (obj, position, js, callback, is_loaded, skip_check) {
				if(!skip_check && (is_loaded || this._is_loaded(obj))) {
					var p  = (typeof position == "string" && position.match(/^before|after$/i) && obj !== -1) ? this._get_parent(obj) : this._get_node(obj),
						s  = this._get_settings().types,
						mc = this._check("max_children", p),
						md = this._check("max_depth", p),
						vc = this._check("valid_children", p),
						ch;
					if(typeof js === "string") { js = { data : js }; }
					if(!js) { js = {}; }
					if(vc === "none") { return false; } 
					if($.isArray(vc)) {
						if(!js.attr || !js.attr[s.type_attr]) { 
							if(!js.attr) { js.attr = {}; }
							js.attr[s.type_attr] = vc[0]; 
						}
						else {
							if($.inArray(js.attr[s.type_attr], vc) === -1) { return false; }
						}
					}
					if(s.max_children !== -2 && mc !== -1) {
						ch = p === -1 ? this.get_container().find("> ul > li").length : p.find("> ul > li").length;
						if(ch + 1 > mc) { return false; }
					}
					if(s.max_depth !== -2 && md !== -1 && (md - 1) < 0) { return false; }
				}
				return this.__call_old(true, obj, position, js, callback, is_loaded, skip_check);
			}
		}
	});
})(jQuery);
//*/

/* 
 * jsTree HTML plugin
 * The HTML data store. Datastores are build by replacing the `load_node` and `_is_loaded` functions.
 */
(function ($) {
	$.jstree.plugin("html_data", {
		__init : function () { 
			// this used to use html() and clean the whitespace, but this way any attached data was lost
			this.data.html_data.original_container_html = this.get_container().find(" > ul > li").clone(true);
			// remove white space from LI node - otherwise nodes appear a bit to the right
			this.data.html_data.original_container_html.find("li").andSelf().contents().filter(function() { return this.nodeType == 3; }).remove();
		},
		defaults : { 
			data : false,
			ajax : false,
			correct_state : true
		},
		_fn : {
			load_node : function (obj, s_call, e_call) { var _this = this; this.load_node_html(obj, function () { _this.__callback({ "obj" : _this._get_node(obj) }); s_call.call(this); }, e_call); },
			_is_loaded : function (obj) { 
				obj = this._get_node(obj); 
				return obj == -1 || !obj || (!this._get_settings().html_data.ajax && !$.isFunction(this._get_settings().html_data.data)) || obj.is(".jstree-open, .jstree-leaf") || obj.children("ul").children("li").size() > 0;
			},
			load_node_html : function (obj, s_call, e_call) {
				var d,
					s = this.get_settings().html_data,
					error_func = function () {},
					success_func = function () {};
				obj = this._get_node(obj);
				if(obj && obj !== -1) {
					if(obj.data("jstree_is_loading")) { return; }
					else { obj.data("jstree_is_loading",true); }
				}
				switch(!0) {
					case ($.isFunction(s.data)):
						s.data.call(this, obj, $.proxy(function (d) {
							if(d && d !== "" && d.toString && d.toString().replace(/^[\s\n]+$/,"") !== "") {
								d = $(d);
								if(!d.is("ul")) { d = $("<ul />").append(d); }
								if(obj == -1 || !obj) { this.get_container().children("ul").empty().append(d.children()).find("li, a").filter(function () { return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"; }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"); }
								else { obj.children("a.jstree-loading").removeClass("jstree-loading"); obj.append(d).children("ul").find("li, a").filter(function () { return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"; }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"); obj.removeData("jstree_is_loading"); }
								this.clean_node(obj);
								if(s_call) { s_call.call(this); }
							}
							else {
								if(obj && obj !== -1) {
									obj.children("a.jstree-loading").removeClass("jstree-loading");
									obj.removeData("jstree_is_loading");
									if(s.correct_state) { 
										this.correct_state(obj);
										if(s_call) { s_call.call(this); } 
									}
								}
								else {
									if(s.correct_state) { 
										this.get_container().children("ul").empty();
										if(s_call) { s_call.call(this); } 
									}
								}
							}
						}, this));
						break;
					case (!s.data && !s.ajax):
						if(!obj || obj == -1) {
							this.get_container()
								.children("ul").empty()
								.append(this.data.html_data.original_container_html)
								.find("li, a").filter(function () { return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"; }).prepend("<ins class='jstree-icon'>&#160;</ins>").end()
								.filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");
							this.clean_node();
						}
						if(s_call) { s_call.call(this); }
						break;
					case (!!s.data && !s.ajax) || (!!s.data && !!s.ajax && (!obj || obj === -1)):
						if(!obj || obj == -1) {
							d = $(s.data);
							if(!d.is("ul")) { d = $("<ul />").append(d); }
							this.get_container()
								.children("ul").empty().append(d.children())
								.find("li, a").filter(function () { return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"; }).prepend("<ins class='jstree-icon'>&#160;</ins>").end()
								.filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");
							this.clean_node();
						}
						if(s_call) { s_call.call(this); }
						break;
					case (!s.data && !!s.ajax) || (!!s.data && !!s.ajax && obj && obj !== -1):
						obj = this._get_node(obj);
						error_func = function (x, t, e) {
							var ef = this.get_settings().html_data.ajax.error; 
							if(ef) { ef.call(this, x, t, e); }
							if(obj != -1 && obj.length) {
								obj.children("a.jstree-loading").removeClass("jstree-loading");
								obj.removeData("jstree_is_loading");
								if(t === "success" && s.correct_state) { this.correct_state(obj); }
							}
							else {
								if(t === "success" && s.correct_state) { this.get_container().children("ul").empty(); }
							}
							if(e_call) { e_call.call(this); }
						};
						success_func = function (d, t, x) {
							var sf = this.get_settings().html_data.ajax.success; 
							if(sf) { d = sf.call(this,d,t,x) || d; }
							if(d === "" || (d && d.toString && d.toString().replace(/^[\s\n]+$/,"") === "")) {
								return error_func.call(this, x, t, "");
							}
							if(d) {
								d = $(d);
								if(!d.is("ul")) { d = $("<ul />").append(d); }
								if(obj == -1 || !obj) { this.get_container().children("ul").empty().append(d.children()).find("li, a").filter(function () { return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"; }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"); }
								else { obj.children("a.jstree-loading").removeClass("jstree-loading"); obj.append(d).children("ul").find("li, a").filter(function () { return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"; }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"); obj.removeData("jstree_is_loading"); }
								this.clean_node(obj);
								if(s_call) { s_call.call(this); }
							}
							else {
								if(obj && obj !== -1) {
									obj.children("a.jstree-loading").removeClass("jstree-loading");
									obj.removeData("jstree_is_loading");
									if(s.correct_state) { 
										this.correct_state(obj);
										if(s_call) { s_call.call(this); } 
									}
								}
								else {
									if(s.correct_state) { 
										this.get_container().children("ul").empty();
										if(s_call) { s_call.call(this); } 
									}
								}
							}
						};
						s.ajax.context = this;
						s.ajax.error = error_func;
						s.ajax.success = success_func;
						if(!s.ajax.dataType) { s.ajax.dataType = "html"; }
						if($.isFunction(s.ajax.url)) { s.ajax.url = s.ajax.url.call(this, obj); }
						if($.isFunction(s.ajax.data)) { s.ajax.data = s.ajax.data.call(this, obj); }
						$.ajax(s.ajax);
						break;
				}
			}
		}
	});
	// include the HTML data plugin by default
	$.jstree.defaults.plugins.push("html_data");
})(jQuery);
//*/

/* 
 * jsTree themeroller plugin
 * Adds support for jQuery UI themes. Include this at the end of your plugins list, also make sure "themes" is not included.
 */
(function ($) {
	$.jstree.plugin("themeroller", {
		__init : function () {
			var s = this._get_settings().themeroller;
			this.get_container()
				.addClass("ui-widget-content")
				.addClass("jstree-themeroller")
				.delegate("a","mouseenter.jstree", function (e) {
					if(!$(e.currentTarget).hasClass("jstree-loading")) {
						$(this).addClass(s.item_h);
					}
				})
				.delegate("a","mouseleave.jstree", function () {
					$(this).removeClass(s.item_h);
				})
				.bind("init.jstree", $.proxy(function (e, data) { 
						data.inst.get_container().find("> ul > li > .jstree-loading > ins").addClass("ui-icon-refresh");
						this._themeroller(data.inst.get_container().find("> ul > li"));
					}, this))
				.bind("open_node.jstree create_node.jstree", $.proxy(function (e, data) { 
						this._themeroller(data.rslt.obj);
					}, this))
				.bind("loaded.jstree refresh.jstree", $.proxy(function (e) {
						this._themeroller();
					}, this))
				.bind("close_node.jstree", $.proxy(function (e, data) {
						this._themeroller(data.rslt.obj);
					}, this))
				.bind("delete_node.jstree", $.proxy(function (e, data) {
						this._themeroller(data.rslt.parent);
					}, this))
				.bind("correct_state.jstree", $.proxy(function (e, data) {
						data.rslt.obj
							.children("ins.jstree-icon").removeClass(s.opened + " " + s.closed + " ui-icon").end()
							.find("> a > ins.ui-icon")
								.filter(function() { 
									return this.className.toString()
										.replace(s.item_clsd,"").replace(s.item_open,"").replace(s.item_leaf,"")
										.indexOf("ui-icon-") === -1; 
								}).removeClass(s.item_open + " " + s.item_clsd).addClass(s.item_leaf || "jstree-no-icon");
					}, this))
				.bind("select_node.jstree", $.proxy(function (e, data) {
						data.rslt.obj.children("a").addClass(s.item_a);
					}, this))
				.bind("deselect_node.jstree deselect_all.jstree", $.proxy(function (e, data) {
						this.get_container()
							.find("a." + s.item_a).removeClass(s.item_a).end()
							.find("a.jstree-clicked").addClass(s.item_a);
					}, this))
				.bind("dehover_node.jstree", $.proxy(function (e, data) {
						data.rslt.obj.children("a").removeClass(s.item_h);
					}, this))
				.bind("hover_node.jstree", $.proxy(function (e, data) {
						this.get_container()
							.find("a." + s.item_h).not(data.rslt.obj).removeClass(s.item_h);
						data.rslt.obj.children("a").addClass(s.item_h);
					}, this))
				.bind("move_node.jstree", $.proxy(function (e, data) {
						this._themeroller(data.rslt.o);
						this._themeroller(data.rslt.op);
					}, this));
		},
		__destroy : function () {
			var s = this._get_settings().themeroller,
				c = [ "ui-icon" ];
			$.each(s, function (i, v) {
				v = v.split(" ");
				if(v.length) { c = c.concat(v); }
			});
			this.get_container()
				.removeClass("ui-widget-content")
				.find("." + c.join(", .")).removeClass(c.join(" "));
		},
		_fn : {
			_themeroller : function (obj) {
				var s = this._get_settings().themeroller;
				obj = !obj || obj == -1 ? this.get_container_ul() : this._get_node(obj).parent();
				obj
					.find("li.jstree-closed")
						.children("ins.jstree-icon").removeClass(s.opened).addClass("ui-icon " + s.closed).end()
						.children("a").addClass(s.item)
							.children("ins.jstree-icon").addClass("ui-icon")
								.filter(function() { 
									return this.className.toString()
										.replace(s.item_clsd,"").replace(s.item_open,"").replace(s.item_leaf,"")
										.indexOf("ui-icon-") === -1; 
								}).removeClass(s.item_leaf + " " + s.item_open).addClass(s.item_clsd || "jstree-no-icon")
								.end()
							.end()
						.end()
					.end()
					.find("li.jstree-open")
						.children("ins.jstree-icon").removeClass(s.closed).addClass("ui-icon " + s.opened).end()
						.children("a").addClass(s.item)
							.children("ins.jstree-icon").addClass("ui-icon")
								.filter(function() { 
									return this.className.toString()
										.replace(s.item_clsd,"").replace(s.item_open,"").replace(s.item_leaf,"")
										.indexOf("ui-icon-") === -1; 
								}).removeClass(s.item_leaf + " " + s.item_clsd).addClass(s.item_open || "jstree-no-icon")
								.end()
							.end()
						.end()
					.end()
					.find("li.jstree-leaf")
						.children("ins.jstree-icon").removeClass(s.closed + " ui-icon " + s.opened).end()
						.children("a").addClass(s.item)
							.children("ins.jstree-icon").addClass("ui-icon")
								.filter(function() { 
									return this.className.toString()
										.replace(s.item_clsd,"").replace(s.item_open,"").replace(s.item_leaf,"")
										.indexOf("ui-icon-") === -1; 
								}).removeClass(s.item_clsd + " " + s.item_open).addClass(s.item_leaf || "jstree-no-icon");
			}
		},
		defaults : {
			"opened"	: "ui-icon-triangle-1-se",
			"closed"	: "ui-icon-triangle-1-e",
			"item"		: "ui-state-default",
			"item_h"	: "ui-state-hover",
			"item_a"	: "ui-state-active",
			"item_open"	: "ui-icon-folder-open",
			"item_clsd"	: "ui-icon-folder-collapsed",
			"item_leaf"	: "ui-icon-document"
		}
	});
	$(function() {
		var css_string = '' + 
			'.jstree-themeroller .ui-icon { overflow:visible; } ' + 
			'.jstree-themeroller a { padding:0 2px; } ' + 
			'.jstree-themeroller .jstree-no-icon { display:none; }';
		$.vakata.css.add_sheet({ str : css_string, title : "jstree" });
	});
})(jQuery);
//*/

/* 
 * jsTree unique plugin
 * Forces different names amongst siblings (still a bit experimental)
 * NOTE: does not check language versions (it will not be possible to have nodes with the same title, even in different languages)
 */
(function ($) {
	$.jstree.plugin("unique", {
		__init : function () {
			this.get_container()
				.bind("before.jstree", $.proxy(function (e, data) { 
						var nms = [], res = true, p, t;
						if(data.func == "move_node") {
							// obj, ref, position, is_copy, is_prepared, skip_check
							if(data.args[4] === true) {
								if(data.args[0].o && data.args[0].o.length) {
									data.args[0].o.children("a").each(function () { nms.push($(this).text().replace(/^\s+/g,"")); });
									res = this._check_unique(nms, data.args[0].np.find("> ul > li").not(data.args[0].o), "move_node");
								}
							}
						}
						if(data.func == "create_node") {
							// obj, position, js, callback, is_loaded
							if(data.args[4] || this._is_loaded(data.args[0])) {
								p = this._get_node(data.args[0]);
								if(data.args[1] && (data.args[1] === "before" || data.args[1] === "after")) {
									p = this._get_parent(data.args[0]);
									if(!p || p === -1) { p = this.get_container(); }
								}
								if(typeof data.args[2] === "string") { nms.push(data.args[2]); }
								else if(!data.args[2] || !data.args[2].data) { nms.push(this._get_string("new_node")); }
								else { nms.push(data.args[2].data); }
								res = this._check_unique(nms, p.find("> ul > li"), "create_node");
							}
						}
						if(data.func == "rename_node") {
							// obj, val
							nms.push(data.args[1]);
							t = this._get_node(data.args[0]);
							p = this._get_parent(t);
							if(!p || p === -1) { p = this.get_container(); }
							res = this._check_unique(nms, p.find("> ul > li").not(t), "rename_node");
						}
						if(!res) {
							e.stopPropagation();
							return false;
						}
					}, this));
		},
		defaults : { 
			error_callback : $.noop
		},
		_fn : { 
			_check_unique : function (nms, p, func) {
				var cnms = [];
				p.children("a").each(function () { cnms.push($(this).text().replace(/^\s+/g,"")); });
				if(!cnms.length || !nms.length) { return true; }
				cnms = cnms.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",");
				if((cnms.length + nms.length) != cnms.concat(nms).sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",").length) {
					this._get_settings().unique.error_callback.call(null, nms, p, func);
					return false;
				}
				return true;
			},
			check_move : function () {
				if(!this.__call_old()) { return false; }
				var p = this._get_move(), nms = [];
				if(p.o && p.o.length) {
					p.o.children("a").each(function () { nms.push($(this).text().replace(/^\s+/g,"")); });
					return this._check_unique(nms, p.np.find("> ul > li").not(p.o), "check_move");
				}
				return true;
			}
		}
	});
})(jQuery);
//*/

/*
 * jsTree wholerow plugin
 * Makes select and hover work on the entire width of the node
 * MAY BE HEAVY IN LARGE DOM
 */
(function ($) {
	$.jstree.plugin("wholerow", {
		__init : function () {
			if(!this.data.ui) { throw "jsTree wholerow: jsTree UI plugin not included."; }
			this.data.wholerow.html = false;
			this.data.wholerow.to = false;
			this.get_container()
				.bind("init.jstree", $.proxy(function (e, data) { 
						this._get_settings().core.animation = 0;
					}, this))
				.bind("open_node.jstree create_node.jstree clean_node.jstree loaded.jstree", $.proxy(function (e, data) { 
						this._prepare_wholerow_span( data && data.rslt && data.rslt.obj ? data.rslt.obj : -1 );
					}, this))
				.bind("search.jstree clear_search.jstree reopen.jstree after_open.jstree after_close.jstree create_node.jstree delete_node.jstree clean_node.jstree", $.proxy(function (e, data) { 
						if(this.data.to) { clearTimeout(this.data.to); }
						this.data.to = setTimeout( (function (t, o) { return function() { t._prepare_wholerow_ul(o); }; })(this,  data && data.rslt && data.rslt.obj ? data.rslt.obj : -1), 0);
					}, this))
				.bind("deselect_all.jstree", $.proxy(function (e, data) { 
						this.get_container().find(" > .jstree-wholerow .jstree-clicked").removeClass("jstree-clicked " + (this.data.themeroller ? this._get_settings().themeroller.item_a : "" ));
					}, this))
				.bind("select_node.jstree deselect_node.jstree ", $.proxy(function (e, data) { 
						data.rslt.obj.each(function () { 
							var ref = data.inst.get_container().find(" > .jstree-wholerow li:visible:eq(" + ( parseInt((($(this).offset().top - data.inst.get_container().offset().top + data.inst.get_container()[0].scrollTop) / data.inst.data.core.li_height),10)) + ")");
							// ref.children("a")[e.type === "select_node" ? "addClass" : "removeClass"]("jstree-clicked");
							ref.children("a").attr("class",data.rslt.obj.children("a").attr("class"));
						});
					}, this))
				.bind("hover_node.jstree dehover_node.jstree", $.proxy(function (e, data) { 
						this.get_container().find(" > .jstree-wholerow .jstree-hovered").removeClass("jstree-hovered " + (this.data.themeroller ? this._get_settings().themeroller.item_h : "" ));
						if(e.type === "hover_node") {
							var ref = this.get_container().find(" > .jstree-wholerow li:visible:eq(" + ( parseInt(((data.rslt.obj.offset().top - this.get_container().offset().top + this.get_container()[0].scrollTop) / this.data.core.li_height),10)) + ")");
							// ref.children("a").addClass("jstree-hovered");
							ref.children("a").attr("class",data.rslt.obj.children(".jstree-hovered").attr("class"));
						}
					}, this))
				.delegate(".jstree-wholerow-span, ins.jstree-icon, li", "click.jstree", function (e) {
						var n = $(e.currentTarget);
						if(e.target.tagName === "A" || (e.target.tagName === "INS" && n.closest("li").is(".jstree-open, .jstree-closed"))) { return; }
						n.closest("li").children("a:visible:eq(0)").click();
						e.stopImmediatePropagation();
					})
				.delegate("li", "mouseover.jstree", $.proxy(function (e) {
						e.stopImmediatePropagation();
						if($(e.currentTarget).children(".jstree-hovered, .jstree-clicked").length) { return false; }
						this.hover_node(e.currentTarget);
						return false;
					}, this))
				.delegate("li", "mouseleave.jstree", $.proxy(function (e) {
						if($(e.currentTarget).children("a").hasClass("jstree-hovered").length) { return; }
						this.dehover_node(e.currentTarget);
					}, this));
			if(is_ie7 || is_ie6) {
				$.vakata.css.add_sheet({ str : ".jstree-" + this.get_index() + " { position:relative; } ", title : "jstree" });
			}
		},
		defaults : {
		},
		__destroy : function () {
			this.get_container().children(".jstree-wholerow").remove();
			this.get_container().find(".jstree-wholerow-span").remove();
		},
		_fn : {
			_prepare_wholerow_span : function (obj) {
				obj = !obj || obj == -1 ? this.get_container().find("> ul > li") : this._get_node(obj);
				if(obj === false) { return; } // added for removing root nodes
				obj.each(function () {
					$(this).find("li").andSelf().each(function () {
						var $t = $(this);
						if($t.children(".jstree-wholerow-span").length) { return true; }
						$t.prepend("<span class='jstree-wholerow-span' style='width:" + ($t.parentsUntil(".jstree","li").length * 18) + "px;'>&#160;</span>");
					});
				});
			},
			_prepare_wholerow_ul : function () {
				var o = this.get_container().children("ul").eq(0), h = o.html();
				o.addClass("jstree-wholerow-real");
				if(this.data.wholerow.last_html !== h) {
					this.data.wholerow.last_html = h;
					this.get_container().children(".jstree-wholerow").remove();
					this.get_container().append(
						o.clone().removeClass("jstree-wholerow-real")
							.wrapAll("<div class='jstree-wholerow' />").parent()
							.width(o.parent()[0].scrollWidth)
							.css("top", (o.height() + ( is_ie7 ? 5 : 0)) * -1 )
							.find("li[id]").each(function () { this.removeAttribute("id"); }).end()
					);
				}
			}
		}
	});
	$(function() {
		var css_string = '' + 
			'.jstree .jstree-wholerow-real { position:relative; z-index:1; } ' + 
			'.jstree .jstree-wholerow-real li { cursor:pointer; } ' + 
			'.jstree .jstree-wholerow-real a { border-left-color:transparent !important; border-right-color:transparent !important; } ' + 
			'.jstree .jstree-wholerow { position:relative; z-index:0; height:0; } ' + 
			'.jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { width:100%; } ' + 
			'.jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li, .jstree .jstree-wholerow a { margin:0 !important; padding:0 !important; } ' + 
			'.jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { background:transparent !important; }' + 
			'.jstree .jstree-wholerow ins, .jstree .jstree-wholerow span, .jstree .jstree-wholerow input { display:none !important; }' + 
			'.jstree .jstree-wholerow a, .jstree .jstree-wholerow a:hover { text-indent:-9999px; !important; width:100%; padding:0 !important; border-right-width:0px !important; border-left-width:0px !important; } ' + 
			'.jstree .jstree-wholerow-span { position:absolute; left:0; margin:0px; padding:0; height:18px; border-width:0; padding:0; z-index:0; }';
		if(is_ff2) {
			css_string += '' + 
				'.jstree .jstree-wholerow a { display:block; height:18px; margin:0; padding:0; border:0; } ' + 
				'.jstree .jstree-wholerow-real a { border-color:transparent !important; } ';
		}
		if(is_ie7 || is_ie6) {
			css_string += '' + 
				'.jstree .jstree-wholerow, .jstree .jstree-wholerow li, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow a { margin:0; padding:0; line-height:18px; } ' + 
				'.jstree .jstree-wholerow a { display:block; height:18px; line-height:18px; overflow:hidden; } ';
		}
		$.vakata.css.add_sheet({ str : css_string, title : "jstree" });
	});
})(jQuery);
//*/

/*
* jsTree model plugin
* This plugin gets jstree to use a class model to retrieve data, creating great dynamism
*/
(function ($) {
	var nodeInterface = ["getChildren","getChildrenCount","getAttr","getName","getProps"],
		validateInterface = function(obj, inter) {
			var valid = true;
			obj = obj || {};
			inter = [].concat(inter);
			$.each(inter, function (i, v) {
				if(!$.isFunction(obj[v])) { valid = false; return false; }
			});
			return valid;
		};
	$.jstree.plugin("model", {
		__init : function () {
			if(!this.data.json_data) { throw "jsTree model: jsTree json_data plugin not included."; }
			this._get_settings().json_data.data = function (n, b) {
				var obj = (n == -1) ? this._get_settings().model.object : n.data("jstree_model");
				if(!validateInterface(obj, nodeInterface)) { return b.call(null, false); }
				if(this._get_settings().model.async) {
					obj.getChildren($.proxy(function (data) {
						this.model_done(data, b);
					}, this));
				}
				else {
					this.model_done(obj.getChildren(), b);
				}
			};
		},
		defaults : {
			object : false,
			id_prefix : false,
			async : false
		},
		_fn : {
			model_done : function (data, callback) {
				var ret = [], 
					s = this._get_settings(),
					_this = this;

				if(!$.isArray(data)) { data = [data]; }
				$.each(data, function (i, nd) {
					var r = nd.getProps() || {};
					r.attr = nd.getAttr() || {};
					if(nd.getChildrenCount()) { r.state = "closed"; }
					r.data = nd.getName();
					if(!$.isArray(r.data)) { r.data = [r.data]; }
					if(_this.data.types && $.isFunction(nd.getType)) {
						r.attr[s.types.type_attr] = nd.getType();
					}
					if(r.attr.id && s.model.id_prefix) { r.attr.id = s.model.id_prefix + r.attr.id; }
					if(!r.metadata) { r.metadata = { }; }
					r.metadata.jstree_model = nd;
					ret.push(r);
				});
				callback.call(null, ret);
			}
		}
	});
})(jQuery);
//*/

})();;
/*
 * This combined file was created by the DataTables downloader builder:
 *   https://datatables.net/download
 *
 * To rebuild or modify this file with the latest versions of the included
 * software please visit:
 *   https://datatables.net/download/#dt/dt-1.10.16/sc-1.4.3
 *
 * Included libraries:
 *   DataTables 1.10.16, Scroller 1.4.3
 */

/*!
 DataTables 1.10.16
 ©2008-2017 SpryMedia Ltd - datatables.net/license
*/
(function(h){"function"===typeof define&&define.amd?define(["jquery"],function(E){return h(E,window,document)}):"object"===typeof exports?module.exports=function(E,G){E||(E=window);G||(G="undefined"!==typeof window?require("jquery"):require("jquery")(E));return h(G,E,E.document)}:h(jQuery,window,document)})(function(h,E,G,k){function X(a){var b,c,d={};h.each(a,function(e){if((b=e.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(b[1]+" "))c=e.replace(b[0],b[2].toLowerCase()),
d[c]=e,"o"===b[1]&&X(a[e])});a._hungarianMap=d}function I(a,b,c){a._hungarianMap||X(a);var d;h.each(b,function(e){d=a._hungarianMap[e];if(d!==k&&(c||b[d]===k))"o"===d.charAt(0)?(b[d]||(b[d]={}),h.extend(!0,b[d],b[e]),I(a[d],b[d],c)):b[d]=b[e]})}function Ca(a){var b=m.defaults.oLanguage,c=a.sZeroRecords;!a.sEmptyTable&&(c&&"No data available in table"===b.sEmptyTable)&&F(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&(c&&"Loading..."===b.sLoadingRecords)&&F(a,a,"sZeroRecords","sLoadingRecords");
a.sInfoThousands&&(a.sThousands=a.sInfoThousands);(a=a.sDecimal)&&cb(a)}function db(a){A(a,"ordering","bSort");A(a,"orderMulti","bSortMulti");A(a,"orderClasses","bSortClasses");A(a,"orderCellsTop","bSortCellsTop");A(a,"order","aaSorting");A(a,"orderFixed","aaSortingFixed");A(a,"paging","bPaginate");A(a,"pagingType","sPaginationType");A(a,"pageLength","iDisplayLength");A(a,"searching","bFilter");"boolean"===typeof a.sScrollX&&(a.sScrollX=a.sScrollX?"100%":"");"boolean"===typeof a.scrollX&&(a.scrollX=
a.scrollX?"100%":"");if(a=a.aoSearchCols)for(var b=0,c=a.length;b<c;b++)a[b]&&I(m.models.oSearch,a[b])}function eb(a){A(a,"orderable","bSortable");A(a,"orderData","aDataSort");A(a,"orderSequence","asSorting");A(a,"orderDataType","sortDataType");var b=a.aDataSort;"number"===typeof b&&!h.isArray(b)&&(a.aDataSort=[b])}function fb(a){if(!m.__browser){var b={};m.__browser=b;var c=h("<div/>").css({position:"fixed",top:0,left:-1*h(E).scrollLeft(),height:1,width:1,overflow:"hidden"}).append(h("<div/>").css({position:"absolute",
top:1,left:1,width:100,overflow:"scroll"}).append(h("<div/>").css({width:"100%",height:10}))).appendTo("body"),d=c.children(),e=d.children();b.barWidth=d[0].offsetWidth-d[0].clientWidth;b.bScrollOversize=100===e[0].offsetWidth&&100!==d[0].clientWidth;b.bScrollbarLeft=1!==Math.round(e.offset().left);b.bBounding=c[0].getBoundingClientRect().width?!0:!1;c.remove()}h.extend(a.oBrowser,m.__browser);a.oScroll.iBarWidth=m.__browser.barWidth}function gb(a,b,c,d,e,f){var g,j=!1;c!==k&&(g=c,j=!0);for(;d!==
e;)a.hasOwnProperty(d)&&(g=j?b(g,a[d],d,a):a[d],j=!0,d+=f);return g}function Da(a,b){var c=m.defaults.column,d=a.aoColumns.length,c=h.extend({},m.models.oColumn,c,{nTh:b?b:G.createElement("th"),sTitle:c.sTitle?c.sTitle:b?b.innerHTML:"",aDataSort:c.aDataSort?c.aDataSort:[d],mData:c.mData?c.mData:d,idx:d});a.aoColumns.push(c);c=a.aoPreSearchCols;c[d]=h.extend({},m.models.oSearch,c[d]);ja(a,d,h(b).data())}function ja(a,b,c){var b=a.aoColumns[b],d=a.oClasses,e=h(b.nTh);if(!b.sWidthOrig){b.sWidthOrig=
e.attr("width")||null;var f=(e.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);f&&(b.sWidthOrig=f[1])}c!==k&&null!==c&&(eb(c),I(m.defaults.column,c),c.mDataProp!==k&&!c.mData&&(c.mData=c.mDataProp),c.sType&&(b._sManualType=c.sType),c.className&&!c.sClass&&(c.sClass=c.className),c.sClass&&e.addClass(c.sClass),h.extend(b,c),F(b,c,"sWidth","sWidthOrig"),c.iDataSort!==k&&(b.aDataSort=[c.iDataSort]),F(b,c,"aDataSort"));var g=b.mData,j=Q(g),i=b.mRender?Q(b.mRender):null,c=function(a){return"string"===
typeof a&&-1!==a.indexOf("@")};b._bAttrSrc=h.isPlainObject(g)&&(c(g.sort)||c(g.type)||c(g.filter));b._setter=null;b.fnGetData=function(a,b,c){var d=j(a,b,k,c);return i&&b?i(d,b,a,c):d};b.fnSetData=function(a,b,c){return R(g)(a,b,c)};"number"!==typeof g&&(a._rowReadObject=!0);a.oFeatures.bSort||(b.bSortable=!1,e.addClass(d.sSortableNone));a=-1!==h.inArray("asc",b.asSorting);c=-1!==h.inArray("desc",b.asSorting);!b.bSortable||!a&&!c?(b.sSortingClass=d.sSortableNone,b.sSortingClassJUI=""):a&&!c?(b.sSortingClass=
d.sSortableAsc,b.sSortingClassJUI=d.sSortJUIAscAllowed):!a&&c?(b.sSortingClass=d.sSortableDesc,b.sSortingClassJUI=d.sSortJUIDescAllowed):(b.sSortingClass=d.sSortable,b.sSortingClassJUI=d.sSortJUI)}function Y(a){if(!1!==a.oFeatures.bAutoWidth){var b=a.aoColumns;Ea(a);for(var c=0,d=b.length;c<d;c++)b[c].nTh.style.width=b[c].sWidth}b=a.oScroll;(""!==b.sY||""!==b.sX)&&ka(a);r(a,null,"column-sizing",[a])}function Z(a,b){var c=la(a,"bVisible");return"number"===typeof c[b]?c[b]:null}function $(a,b){var c=
la(a,"bVisible"),c=h.inArray(b,c);return-1!==c?c:null}function aa(a){var b=0;h.each(a.aoColumns,function(a,d){d.bVisible&&"none"!==h(d.nTh).css("display")&&b++});return b}function la(a,b){var c=[];h.map(a.aoColumns,function(a,e){a[b]&&c.push(e)});return c}function Fa(a){var b=a.aoColumns,c=a.aoData,d=m.ext.type.detect,e,f,g,j,i,h,l,q,t;e=0;for(f=b.length;e<f;e++)if(l=b[e],t=[],!l.sType&&l._sManualType)l.sType=l._sManualType;else if(!l.sType){g=0;for(j=d.length;g<j;g++){i=0;for(h=c.length;i<h;i++){t[i]===
k&&(t[i]=B(a,i,e,"type"));q=d[g](t[i],a);if(!q&&g!==d.length-1)break;if("html"===q)break}if(q){l.sType=q;break}}l.sType||(l.sType="string")}}function hb(a,b,c,d){var e,f,g,j,i,n,l=a.aoColumns;if(b)for(e=b.length-1;0<=e;e--){n=b[e];var q=n.targets!==k?n.targets:n.aTargets;h.isArray(q)||(q=[q]);f=0;for(g=q.length;f<g;f++)if("number"===typeof q[f]&&0<=q[f]){for(;l.length<=q[f];)Da(a);d(q[f],n)}else if("number"===typeof q[f]&&0>q[f])d(l.length+q[f],n);else if("string"===typeof q[f]){j=0;for(i=l.length;j<
i;j++)("_all"==q[f]||h(l[j].nTh).hasClass(q[f]))&&d(j,n)}}if(c){e=0;for(a=c.length;e<a;e++)d(e,c[e])}}function M(a,b,c,d){var e=a.aoData.length,f=h.extend(!0,{},m.models.oRow,{src:c?"dom":"data",idx:e});f._aData=b;a.aoData.push(f);for(var g=a.aoColumns,j=0,i=g.length;j<i;j++)g[j].sType=null;a.aiDisplayMaster.push(e);b=a.rowIdFn(b);b!==k&&(a.aIds[b]=f);(c||!a.oFeatures.bDeferRender)&&Ga(a,e,c,d);return e}function ma(a,b){var c;b instanceof h||(b=h(b));return b.map(function(b,e){c=Ha(a,e);return M(a,
c.data,e,c.cells)})}function B(a,b,c,d){var e=a.iDraw,f=a.aoColumns[c],g=a.aoData[b]._aData,j=f.sDefaultContent,i=f.fnGetData(g,d,{settings:a,row:b,col:c});if(i===k)return a.iDrawError!=e&&null===j&&(J(a,0,"Requested unknown parameter "+("function"==typeof f.mData?"{function}":"'"+f.mData+"'")+" for row "+b+", column "+c,4),a.iDrawError=e),j;if((i===g||null===i)&&null!==j&&d!==k)i=j;else if("function"===typeof i)return i.call(g);return null===i&&"display"==d?"":i}function ib(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,
d,{settings:a,row:b,col:c})}function Ia(a){return h.map(a.match(/(\\.|[^\.])+/g)||[""],function(a){return a.replace(/\\\./g,".")})}function Q(a){if(h.isPlainObject(a)){var b={};h.each(a,function(a,c){c&&(b[a]=Q(c))});return function(a,c,f,g){var j=b[c]||b._;return j!==k?j(a,c,f,g):a}}if(null===a)return function(a){return a};if("function"===typeof a)return function(b,c,f,g){return a(b,c,f,g)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var c=function(a,
b,f){var g,j;if(""!==f){j=Ia(f);for(var i=0,n=j.length;i<n;i++){f=j[i].match(ba);g=j[i].match(U);if(f){j[i]=j[i].replace(ba,"");""!==j[i]&&(a=a[j[i]]);g=[];j.splice(0,i+1);j=j.join(".");if(h.isArray(a)){i=0;for(n=a.length;i<n;i++)g.push(c(a[i],b,j))}a=f[0].substring(1,f[0].length-1);a=""===a?g:g.join(a);break}else if(g){j[i]=j[i].replace(U,"");a=a[j[i]]();continue}if(null===a||a[j[i]]===k)return k;a=a[j[i]]}}return a};return function(b,e){return c(b,e,a)}}return function(b){return b[a]}}function R(a){if(h.isPlainObject(a))return R(a._);
if(null===a)return function(){};if("function"===typeof a)return function(b,d,e){a(b,"set",d,e)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var b=function(a,d,e){var e=Ia(e),f;f=e[e.length-1];for(var g,j,i=0,n=e.length-1;i<n;i++){g=e[i].match(ba);j=e[i].match(U);if(g){e[i]=e[i].replace(ba,"");a[e[i]]=[];f=e.slice();f.splice(0,i+1);g=f.join(".");if(h.isArray(d)){j=0;for(n=d.length;j<n;j++)f={},b(f,d[j],g),a[e[i]].push(f)}else a[e[i]]=d;return}j&&(e[i]=e[i].replace(U,
""),a=a[e[i]](d));if(null===a[e[i]]||a[e[i]]===k)a[e[i]]={};a=a[e[i]]}if(f.match(U))a[f.replace(U,"")](d);else a[f.replace(ba,"")]=d};return function(c,d){return b(c,d,a)}}return function(b,d){b[a]=d}}function Ja(a){return D(a.aoData,"_aData")}function na(a){a.aoData.length=0;a.aiDisplayMaster.length=0;a.aiDisplay.length=0;a.aIds={}}function oa(a,b,c){for(var d=-1,e=0,f=a.length;e<f;e++)a[e]==b?d=e:a[e]>b&&a[e]--; -1!=d&&c===k&&a.splice(d,1)}function ca(a,b,c,d){var e=a.aoData[b],f,g=function(c,d){for(;c.childNodes.length;)c.removeChild(c.firstChild);
c.innerHTML=B(a,b,d,"display")};if("dom"===c||(!c||"auto"===c)&&"dom"===e.src)e._aData=Ha(a,e,d,d===k?k:e._aData).data;else{var j=e.anCells;if(j)if(d!==k)g(j[d],d);else{c=0;for(f=j.length;c<f;c++)g(j[c],c)}}e._aSortData=null;e._aFilterData=null;g=a.aoColumns;if(d!==k)g[d].sType=null;else{c=0;for(f=g.length;c<f;c++)g[c].sType=null;Ka(a,e)}}function Ha(a,b,c,d){var e=[],f=b.firstChild,g,j,i=0,n,l=a.aoColumns,q=a._rowReadObject,d=d!==k?d:q?{}:[],t=function(a,b){if("string"===typeof a){var c=a.indexOf("@");
-1!==c&&(c=a.substring(c+1),R(a)(d,b.getAttribute(c)))}},m=function(a){if(c===k||c===i)j=l[i],n=h.trim(a.innerHTML),j&&j._bAttrSrc?(R(j.mData._)(d,n),t(j.mData.sort,a),t(j.mData.type,a),t(j.mData.filter,a)):q?(j._setter||(j._setter=R(j.mData)),j._setter(d,n)):d[i]=n;i++};if(f)for(;f;){g=f.nodeName.toUpperCase();if("TD"==g||"TH"==g)m(f),e.push(f);f=f.nextSibling}else{e=b.anCells;f=0;for(g=e.length;f<g;f++)m(e[f])}if(b=b.firstChild?b:b.nTr)(b=b.getAttribute("id"))&&R(a.rowId)(d,b);return{data:d,cells:e}}
function Ga(a,b,c,d){var e=a.aoData[b],f=e._aData,g=[],j,i,n,l,q;if(null===e.nTr){j=c||G.createElement("tr");e.nTr=j;e.anCells=g;j._DT_RowIndex=b;Ka(a,e);l=0;for(q=a.aoColumns.length;l<q;l++){n=a.aoColumns[l];i=c?d[l]:G.createElement(n.sCellType);i._DT_CellIndex={row:b,column:l};g.push(i);if((!c||n.mRender||n.mData!==l)&&(!h.isPlainObject(n.mData)||n.mData._!==l+".display"))i.innerHTML=B(a,b,l,"display");n.sClass&&(i.className+=" "+n.sClass);n.bVisible&&!c?j.appendChild(i):!n.bVisible&&c&&i.parentNode.removeChild(i);
n.fnCreatedCell&&n.fnCreatedCell.call(a.oInstance,i,B(a,b,l),f,b,l)}r(a,"aoRowCreatedCallback",null,[j,f,b])}e.nTr.setAttribute("role","row")}function Ka(a,b){var c=b.nTr,d=b._aData;if(c){var e=a.rowIdFn(d);e&&(c.id=e);d.DT_RowClass&&(e=d.DT_RowClass.split(" "),b.__rowc=b.__rowc?qa(b.__rowc.concat(e)):e,h(c).removeClass(b.__rowc.join(" ")).addClass(d.DT_RowClass));d.DT_RowAttr&&h(c).attr(d.DT_RowAttr);d.DT_RowData&&h(c).data(d.DT_RowData)}}function jb(a){var b,c,d,e,f,g=a.nTHead,j=a.nTFoot,i=0===
h("th, td",g).length,n=a.oClasses,l=a.aoColumns;i&&(e=h("<tr/>").appendTo(g));b=0;for(c=l.length;b<c;b++)f=l[b],d=h(f.nTh).addClass(f.sClass),i&&d.appendTo(e),a.oFeatures.bSort&&(d.addClass(f.sSortingClass),!1!==f.bSortable&&(d.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),La(a,f.nTh,b))),f.sTitle!=d[0].innerHTML&&d.html(f.sTitle),Ma(a,"header")(a,d,f,n);i&&da(a.aoHeader,g);h(g).find(">tr").attr("role","row");h(g).find(">tr>th, >tr>td").addClass(n.sHeaderTH);h(j).find(">tr>th, >tr>td").addClass(n.sFooterTH);
if(null!==j){a=a.aoFooter[0];b=0;for(c=a.length;b<c;b++)f=l[b],f.nTf=a[b].cell,f.sClass&&h(f.nTf).addClass(f.sClass)}}function ea(a,b,c){var d,e,f,g=[],j=[],i=a.aoColumns.length,n;if(b){c===k&&(c=!1);d=0;for(e=b.length;d<e;d++){g[d]=b[d].slice();g[d].nTr=b[d].nTr;for(f=i-1;0<=f;f--)!a.aoColumns[f].bVisible&&!c&&g[d].splice(f,1);j.push([])}d=0;for(e=g.length;d<e;d++){if(a=g[d].nTr)for(;f=a.firstChild;)a.removeChild(f);f=0;for(b=g[d].length;f<b;f++)if(n=i=1,j[d][f]===k){a.appendChild(g[d][f].cell);
for(j[d][f]=1;g[d+i]!==k&&g[d][f].cell==g[d+i][f].cell;)j[d+i][f]=1,i++;for(;g[d][f+n]!==k&&g[d][f].cell==g[d][f+n].cell;){for(c=0;c<i;c++)j[d+c][f+n]=1;n++}h(g[d][f].cell).attr("rowspan",i).attr("colspan",n)}}}}function N(a){var b=r(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==h.inArray(!1,b))C(a,!1);else{var b=[],c=0,d=a.asStripeClasses,e=d.length,f=a.oLanguage,g=a.iInitDisplayStart,j="ssp"==y(a),i=a.aiDisplay;a.bDrawing=!0;g!==k&&-1!==g&&(a._iDisplayStart=j?g:g>=a.fnRecordsDisplay()?0:g,a.iInitDisplayStart=
-1);var g=a._iDisplayStart,n=a.fnDisplayEnd();if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++,C(a,!1);else if(j){if(!a.bDestroying&&!kb(a))return}else a.iDraw++;if(0!==i.length){f=j?a.aoData.length:n;for(j=j?0:g;j<f;j++){var l=i[j],q=a.aoData[l];null===q.nTr&&Ga(a,l);l=q.nTr;if(0!==e){var t=d[c%e];q._sRowStripe!=t&&(h(l).removeClass(q._sRowStripe).addClass(t),q._sRowStripe=t)}r(a,"aoRowCallback",null,[l,q._aData,c,j]);b.push(l);c++}}else c=f.sZeroRecords,1==a.iDraw&&"ajax"==y(a)?c=f.sLoadingRecords:
f.sEmptyTable&&0===a.fnRecordsTotal()&&(c=f.sEmptyTable),b[0]=h("<tr/>",{"class":e?d[0]:""}).append(h("<td />",{valign:"top",colSpan:aa(a),"class":a.oClasses.sRowEmpty}).html(c))[0];r(a,"aoHeaderCallback","header",[h(a.nTHead).children("tr")[0],Ja(a),g,n,i]);r(a,"aoFooterCallback","footer",[h(a.nTFoot).children("tr")[0],Ja(a),g,n,i]);d=h(a.nTBody);d.children().detach();d.append(h(b));r(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1}}function S(a,b){var c=a.oFeatures,d=c.bFilter;
c.bSort&&lb(a);d?fa(a,a.oPreviousSearch):a.aiDisplay=a.aiDisplayMaster.slice();!0!==b&&(a._iDisplayStart=0);a._drawHold=b;N(a);a._drawHold=!1}function mb(a){var b=a.oClasses,c=h(a.nTable),c=h("<div/>").insertBefore(c),d=a.oFeatures,e=h("<div/>",{id:a.sTableId+"_wrapper","class":b.sWrapper+(a.nTFoot?"":" "+b.sNoFooter)});a.nHolding=c[0];a.nTableWrapper=e[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var f=a.sDom.split(""),g,j,i,n,l,q,k=0;k<f.length;k++){g=null;j=f[k];if("<"==j){i=h("<div/>")[0];
n=f[k+1];if("'"==n||'"'==n){l="";for(q=2;f[k+q]!=n;)l+=f[k+q],q++;"H"==l?l=b.sJUIHeader:"F"==l&&(l=b.sJUIFooter);-1!=l.indexOf(".")?(n=l.split("."),i.id=n[0].substr(1,n[0].length-1),i.className=n[1]):"#"==l.charAt(0)?i.id=l.substr(1,l.length-1):i.className=l;k+=q}e.append(i);e=h(i)}else if(">"==j)e=e.parent();else if("l"==j&&d.bPaginate&&d.bLengthChange)g=nb(a);else if("f"==j&&d.bFilter)g=ob(a);else if("r"==j&&d.bProcessing)g=pb(a);else if("t"==j)g=qb(a);else if("i"==j&&d.bInfo)g=rb(a);else if("p"==
j&&d.bPaginate)g=sb(a);else if(0!==m.ext.feature.length){i=m.ext.feature;q=0;for(n=i.length;q<n;q++)if(j==i[q].cFeature){g=i[q].fnInit(a);break}}g&&(i=a.aanFeatures,i[j]||(i[j]=[]),i[j].push(g),e.append(g))}c.replaceWith(e);a.nHolding=null}function da(a,b){var c=h(b).children("tr"),d,e,f,g,j,i,n,l,q,k;a.splice(0,a.length);f=0;for(i=c.length;f<i;f++)a.push([]);f=0;for(i=c.length;f<i;f++){d=c[f];for(e=d.firstChild;e;){if("TD"==e.nodeName.toUpperCase()||"TH"==e.nodeName.toUpperCase()){l=1*e.getAttribute("colspan");
q=1*e.getAttribute("rowspan");l=!l||0===l||1===l?1:l;q=!q||0===q||1===q?1:q;g=0;for(j=a[f];j[g];)g++;n=g;k=1===l?!0:!1;for(j=0;j<l;j++)for(g=0;g<q;g++)a[f+g][n+j]={cell:e,unique:k},a[f+g].nTr=d}e=e.nextSibling}}}function ra(a,b,c){var d=[];c||(c=a.aoHeader,b&&(c=[],da(c,b)));for(var b=0,e=c.length;b<e;b++)for(var f=0,g=c[b].length;f<g;f++)if(c[b][f].unique&&(!d[f]||!a.bSortCellsTop))d[f]=c[b][f].cell;return d}function sa(a,b,c){r(a,"aoServerParams","serverParams",[b]);if(b&&h.isArray(b)){var d={},
e=/(.*?)\[\]$/;h.each(b,function(a,b){var c=b.name.match(e);c?(c=c[0],d[c]||(d[c]=[]),d[c].push(b.value)):d[b.name]=b.value});b=d}var f,g=a.ajax,j=a.oInstance,i=function(b){r(a,null,"xhr",[a,b,a.jqXHR]);c(b)};if(h.isPlainObject(g)&&g.data){f=g.data;var n=h.isFunction(f)?f(b,a):f,b=h.isFunction(f)&&n?n:h.extend(!0,b,n);delete g.data}n={data:b,success:function(b){var c=b.error||b.sError;c&&J(a,0,c);a.json=b;i(b)},dataType:"json",cache:!1,type:a.sServerMethod,error:function(b,c){var d=r(a,null,"xhr",
[a,null,a.jqXHR]);-1===h.inArray(!0,d)&&("parsererror"==c?J(a,0,"Invalid JSON response",1):4===b.readyState&&J(a,0,"Ajax error",7));C(a,!1)}};a.oAjaxData=b;r(a,null,"preXhr",[a,b]);a.fnServerData?a.fnServerData.call(j,a.sAjaxSource,h.map(b,function(a,b){return{name:b,value:a}}),i,a):a.sAjaxSource||"string"===typeof g?a.jqXHR=h.ajax(h.extend(n,{url:g||a.sAjaxSource})):h.isFunction(g)?a.jqXHR=g.call(j,b,i,a):(a.jqXHR=h.ajax(h.extend(n,g)),g.data=f)}function kb(a){return a.bAjaxDataGet?(a.iDraw++,C(a,
!0),sa(a,tb(a),function(b){ub(a,b)}),!1):!0}function tb(a){var b=a.aoColumns,c=b.length,d=a.oFeatures,e=a.oPreviousSearch,f=a.aoPreSearchCols,g,j=[],i,n,l,k=V(a);g=a._iDisplayStart;i=!1!==d.bPaginate?a._iDisplayLength:-1;var t=function(a,b){j.push({name:a,value:b})};t("sEcho",a.iDraw);t("iColumns",c);t("sColumns",D(b,"sName").join(","));t("iDisplayStart",g);t("iDisplayLength",i);var pa={draw:a.iDraw,columns:[],order:[],start:g,length:i,search:{value:e.sSearch,regex:e.bRegex}};for(g=0;g<c;g++)n=b[g],
l=f[g],i="function"==typeof n.mData?"function":n.mData,pa.columns.push({data:i,name:n.sName,searchable:n.bSearchable,orderable:n.bSortable,search:{value:l.sSearch,regex:l.bRegex}}),t("mDataProp_"+g,i),d.bFilter&&(t("sSearch_"+g,l.sSearch),t("bRegex_"+g,l.bRegex),t("bSearchable_"+g,n.bSearchable)),d.bSort&&t("bSortable_"+g,n.bSortable);d.bFilter&&(t("sSearch",e.sSearch),t("bRegex",e.bRegex));d.bSort&&(h.each(k,function(a,b){pa.order.push({column:b.col,dir:b.dir});t("iSortCol_"+a,b.col);t("sSortDir_"+
a,b.dir)}),t("iSortingCols",k.length));b=m.ext.legacy.ajax;return null===b?a.sAjaxSource?j:pa:b?j:pa}function ub(a,b){var c=ta(a,b),d=b.sEcho!==k?b.sEcho:b.draw,e=b.iTotalRecords!==k?b.iTotalRecords:b.recordsTotal,f=b.iTotalDisplayRecords!==k?b.iTotalDisplayRecords:b.recordsFiltered;if(d){if(1*d<a.iDraw)return;a.iDraw=1*d}na(a);a._iRecordsTotal=parseInt(e,10);a._iRecordsDisplay=parseInt(f,10);d=0;for(e=c.length;d<e;d++)M(a,c[d]);a.aiDisplay=a.aiDisplayMaster.slice();a.bAjaxDataGet=!1;N(a);a._bInitComplete||
ua(a,b);a.bAjaxDataGet=!0;C(a,!1)}function ta(a,b){var c=h.isPlainObject(a.ajax)&&a.ajax.dataSrc!==k?a.ajax.dataSrc:a.sAjaxDataProp;return"data"===c?b.aaData||b[c]:""!==c?Q(c)(b):b}function ob(a){var b=a.oClasses,c=a.sTableId,d=a.oLanguage,e=a.oPreviousSearch,f=a.aanFeatures,g='<input type="search" class="'+b.sFilterInput+'"/>',j=d.sSearch,j=j.match(/_INPUT_/)?j.replace("_INPUT_",g):j+g,b=h("<div/>",{id:!f.f?c+"_filter":null,"class":b.sFilter}).append(h("<label/>").append(j)),f=function(){var b=!this.value?
"":this.value;b!=e.sSearch&&(fa(a,{sSearch:b,bRegex:e.bRegex,bSmart:e.bSmart,bCaseInsensitive:e.bCaseInsensitive}),a._iDisplayStart=0,N(a))},g=null!==a.searchDelay?a.searchDelay:"ssp"===y(a)?400:0,i=h("input",b).val(e.sSearch).attr("placeholder",d.sSearchPlaceholder).on("keyup.DT search.DT input.DT paste.DT cut.DT",g?Na(f,g):f).on("keypress.DT",function(a){if(13==a.keyCode)return!1}).attr("aria-controls",c);h(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{i[0]!==G.activeElement&&i.val(e.sSearch)}catch(d){}});
return b[0]}function fa(a,b,c){var d=a.oPreviousSearch,e=a.aoPreSearchCols,f=function(a){d.sSearch=a.sSearch;d.bRegex=a.bRegex;d.bSmart=a.bSmart;d.bCaseInsensitive=a.bCaseInsensitive};Fa(a);if("ssp"!=y(a)){vb(a,b.sSearch,c,b.bEscapeRegex!==k?!b.bEscapeRegex:b.bRegex,b.bSmart,b.bCaseInsensitive);f(b);for(b=0;b<e.length;b++)wb(a,e[b].sSearch,b,e[b].bEscapeRegex!==k?!e[b].bEscapeRegex:e[b].bRegex,e[b].bSmart,e[b].bCaseInsensitive);xb(a)}else f(b);a.bFiltered=!0;r(a,null,"search",[a])}function xb(a){for(var b=
m.ext.search,c=a.aiDisplay,d,e,f=0,g=b.length;f<g;f++){for(var j=[],i=0,n=c.length;i<n;i++)e=c[i],d=a.aoData[e],b[f](a,d._aFilterData,e,d._aData,i)&&j.push(e);c.length=0;h.merge(c,j)}}function wb(a,b,c,d,e,f){if(""!==b){for(var g=[],j=a.aiDisplay,d=Oa(b,d,e,f),e=0;e<j.length;e++)b=a.aoData[j[e]]._aFilterData[c],d.test(b)&&g.push(j[e]);a.aiDisplay=g}}function vb(a,b,c,d,e,f){var d=Oa(b,d,e,f),f=a.oPreviousSearch.sSearch,g=a.aiDisplayMaster,j,e=[];0!==m.ext.search.length&&(c=!0);j=yb(a);if(0>=b.length)a.aiDisplay=
g.slice();else{if(j||c||f.length>b.length||0!==b.indexOf(f)||a.bSorted)a.aiDisplay=g.slice();b=a.aiDisplay;for(c=0;c<b.length;c++)d.test(a.aoData[b[c]]._sFilterRow)&&e.push(b[c]);a.aiDisplay=e}}function Oa(a,b,c,d){a=b?a:Pa(a);c&&(a="^(?=.*?"+h.map(a.match(/"[^"]+"|[^ ]+/g)||[""],function(a){if('"'===a.charAt(0))var b=a.match(/^"(.*)"$/),a=b?b[1]:a;return a.replace('"',"")}).join(")(?=.*?")+").*$");return RegExp(a,d?"i":"")}function yb(a){var b=a.aoColumns,c,d,e,f,g,j,i,h,l=m.ext.type.search;c=!1;
d=0;for(f=a.aoData.length;d<f;d++)if(h=a.aoData[d],!h._aFilterData){j=[];e=0;for(g=b.length;e<g;e++)c=b[e],c.bSearchable?(i=B(a,d,e,"filter"),l[c.sType]&&(i=l[c.sType](i)),null===i&&(i=""),"string"!==typeof i&&i.toString&&(i=i.toString())):i="",i.indexOf&&-1!==i.indexOf("&")&&(va.innerHTML=i,i=Wb?va.textContent:va.innerText),i.replace&&(i=i.replace(/[\r\n]/g,"")),j.push(i);h._aFilterData=j;h._sFilterRow=j.join("  ");c=!0}return c}function zb(a){return{search:a.sSearch,smart:a.bSmart,regex:a.bRegex,
caseInsensitive:a.bCaseInsensitive}}function Ab(a){return{sSearch:a.search,bSmart:a.smart,bRegex:a.regex,bCaseInsensitive:a.caseInsensitive}}function rb(a){var b=a.sTableId,c=a.aanFeatures.i,d=h("<div/>",{"class":a.oClasses.sInfo,id:!c?b+"_info":null});c||(a.aoDrawCallback.push({fn:Bb,sName:"information"}),d.attr("role","status").attr("aria-live","polite"),h(a.nTable).attr("aria-describedby",b+"_info"));return d[0]}function Bb(a){var b=a.aanFeatures.i;if(0!==b.length){var c=a.oLanguage,d=a._iDisplayStart+
1,e=a.fnDisplayEnd(),f=a.fnRecordsTotal(),g=a.fnRecordsDisplay(),j=g?c.sInfo:c.sInfoEmpty;g!==f&&(j+=" "+c.sInfoFiltered);j+=c.sInfoPostFix;j=Cb(a,j);c=c.fnInfoCallback;null!==c&&(j=c.call(a.oInstance,a,d,e,f,g,j));h(b).html(j)}}function Cb(a,b){var c=a.fnFormatNumber,d=a._iDisplayStart+1,e=a._iDisplayLength,f=a.fnRecordsDisplay(),g=-1===e;return b.replace(/_START_/g,c.call(a,d)).replace(/_END_/g,c.call(a,a.fnDisplayEnd())).replace(/_MAX_/g,c.call(a,a.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(a,
f)).replace(/_PAGE_/g,c.call(a,g?1:Math.ceil(d/e))).replace(/_PAGES_/g,c.call(a,g?1:Math.ceil(f/e)))}function ga(a){var b,c,d=a.iInitDisplayStart,e=a.aoColumns,f;c=a.oFeatures;var g=a.bDeferLoading;if(a.bInitialised){mb(a);jb(a);ea(a,a.aoHeader);ea(a,a.aoFooter);C(a,!0);c.bAutoWidth&&Ea(a);b=0;for(c=e.length;b<c;b++)f=e[b],f.sWidth&&(f.nTh.style.width=v(f.sWidth));r(a,null,"preInit",[a]);S(a);e=y(a);if("ssp"!=e||g)"ajax"==e?sa(a,[],function(c){var f=ta(a,c);for(b=0;b<f.length;b++)M(a,f[b]);a.iInitDisplayStart=
d;S(a);C(a,!1);ua(a,c)},a):(C(a,!1),ua(a))}else setTimeout(function(){ga(a)},200)}function ua(a,b){a._bInitComplete=!0;(b||a.oInit.aaData)&&Y(a);r(a,null,"plugin-init",[a,b]);r(a,"aoInitComplete","init",[a,b])}function Qa(a,b){var c=parseInt(b,10);a._iDisplayLength=c;Ra(a);r(a,null,"length",[a,c])}function nb(a){for(var b=a.oClasses,c=a.sTableId,d=a.aLengthMenu,e=h.isArray(d[0]),f=e?d[0]:d,d=e?d[1]:d,e=h("<select/>",{name:c+"_length","aria-controls":c,"class":b.sLengthSelect}),g=0,j=f.length;g<j;g++)e[0][g]=
new Option("number"===typeof d[g]?a.fnFormatNumber(d[g]):d[g],f[g]);var i=h("<div><label/></div>").addClass(b.sLength);a.aanFeatures.l||(i[0].id=c+"_length");i.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",e[0].outerHTML));h("select",i).val(a._iDisplayLength).on("change.DT",function(){Qa(a,h(this).val());N(a)});h(a.nTable).on("length.dt.DT",function(b,c,d){a===c&&h("select",i).val(d)});return i[0]}function sb(a){var b=a.sPaginationType,c=m.ext.pager[b],d="function"===typeof c,e=function(a){N(a)},
b=h("<div/>").addClass(a.oClasses.sPaging+b)[0],f=a.aanFeatures;d||c.fnInit(a,b,e);f.p||(b.id=a.sTableId+"_paginate",a.aoDrawCallback.push({fn:function(a){if(d){var b=a._iDisplayStart,i=a._iDisplayLength,h=a.fnRecordsDisplay(),l=-1===i,b=l?0:Math.ceil(b/i),i=l?1:Math.ceil(h/i),h=c(b,i),k,l=0;for(k=f.p.length;l<k;l++)Ma(a,"pageButton")(a,f.p[l],l,h,b,i)}else c.fnUpdate(a,e)},sName:"pagination"}));return b}function Sa(a,b,c){var d=a._iDisplayStart,e=a._iDisplayLength,f=a.fnRecordsDisplay();0===f||-1===
e?d=0:"number"===typeof b?(d=b*e,d>f&&(d=0)):"first"==b?d=0:"previous"==b?(d=0<=e?d-e:0,0>d&&(d=0)):"next"==b?d+e<f&&(d+=e):"last"==b?d=Math.floor((f-1)/e)*e:J(a,0,"Unknown paging action: "+b,5);b=a._iDisplayStart!==d;a._iDisplayStart=d;b&&(r(a,null,"page",[a]),c&&N(a));return b}function pb(a){return h("<div/>",{id:!a.aanFeatures.r?a.sTableId+"_processing":null,"class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function C(a,b){a.oFeatures.bProcessing&&h(a.aanFeatures.r).css("display",
b?"block":"none");r(a,null,"processing",[a,b])}function qb(a){var b=h(a.nTable);b.attr("role","grid");var c=a.oScroll;if(""===c.sX&&""===c.sY)return a.nTable;var d=c.sX,e=c.sY,f=a.oClasses,g=b.children("caption"),j=g.length?g[0]._captionSide:null,i=h(b[0].cloneNode(!1)),n=h(b[0].cloneNode(!1)),l=b.children("tfoot");l.length||(l=null);i=h("<div/>",{"class":f.sScrollWrapper}).append(h("<div/>",{"class":f.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:d?!d?null:v(d):"100%"}).append(h("<div/>",
{"class":f.sScrollHeadInner}).css({"box-sizing":"content-box",width:c.sXInner||"100%"}).append(i.removeAttr("id").css("margin-left",0).append("top"===j?g:null).append(b.children("thead"))))).append(h("<div/>",{"class":f.sScrollBody}).css({position:"relative",overflow:"auto",width:!d?null:v(d)}).append(b));l&&i.append(h("<div/>",{"class":f.sScrollFoot}).css({overflow:"hidden",border:0,width:d?!d?null:v(d):"100%"}).append(h("<div/>",{"class":f.sScrollFootInner}).append(n.removeAttr("id").css("margin-left",
0).append("bottom"===j?g:null).append(b.children("tfoot")))));var b=i.children(),k=b[0],f=b[1],t=l?b[2]:null;if(d)h(f).on("scroll.DT",function(){var a=this.scrollLeft;k.scrollLeft=a;l&&(t.scrollLeft=a)});h(f).css(e&&c.bCollapse?"max-height":"height",e);a.nScrollHead=k;a.nScrollBody=f;a.nScrollFoot=t;a.aoDrawCallback.push({fn:ka,sName:"scrolling"});return i[0]}function ka(a){var b=a.oScroll,c=b.sX,d=b.sXInner,e=b.sY,b=b.iBarWidth,f=h(a.nScrollHead),g=f[0].style,j=f.children("div"),i=j[0].style,n=j.children("table"),
j=a.nScrollBody,l=h(j),q=j.style,t=h(a.nScrollFoot).children("div"),m=t.children("table"),o=h(a.nTHead),p=h(a.nTable),s=p[0],r=s.style,u=a.nTFoot?h(a.nTFoot):null,x=a.oBrowser,T=x.bScrollOversize,Xb=D(a.aoColumns,"nTh"),O,K,P,w,Ta=[],y=[],z=[],A=[],B,C=function(a){a=a.style;a.paddingTop="0";a.paddingBottom="0";a.borderTopWidth="0";a.borderBottomWidth="0";a.height=0};K=j.scrollHeight>j.clientHeight;if(a.scrollBarVis!==K&&a.scrollBarVis!==k)a.scrollBarVis=K,Y(a);else{a.scrollBarVis=K;p.children("thead, tfoot").remove();
u&&(P=u.clone().prependTo(p),O=u.find("tr"),P=P.find("tr"));w=o.clone().prependTo(p);o=o.find("tr");K=w.find("tr");w.find("th, td").removeAttr("tabindex");c||(q.width="100%",f[0].style.width="100%");h.each(ra(a,w),function(b,c){B=Z(a,b);c.style.width=a.aoColumns[B].sWidth});u&&H(function(a){a.style.width=""},P);f=p.outerWidth();if(""===c){r.width="100%";if(T&&(p.find("tbody").height()>j.offsetHeight||"scroll"==l.css("overflow-y")))r.width=v(p.outerWidth()-b);f=p.outerWidth()}else""!==d&&(r.width=
v(d),f=p.outerWidth());H(C,K);H(function(a){z.push(a.innerHTML);Ta.push(v(h(a).css("width")))},K);H(function(a,b){if(h.inArray(a,Xb)!==-1)a.style.width=Ta[b]},o);h(K).height(0);u&&(H(C,P),H(function(a){A.push(a.innerHTML);y.push(v(h(a).css("width")))},P),H(function(a,b){a.style.width=y[b]},O),h(P).height(0));H(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+z[b]+"</div>";a.style.width=Ta[b]},K);u&&H(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+
A[b]+"</div>";a.style.width=y[b]},P);if(p.outerWidth()<f){O=j.scrollHeight>j.offsetHeight||"scroll"==l.css("overflow-y")?f+b:f;if(T&&(j.scrollHeight>j.offsetHeight||"scroll"==l.css("overflow-y")))r.width=v(O-b);(""===c||""!==d)&&J(a,1,"Possible column misalignment",6)}else O="100%";q.width=v(O);g.width=v(O);u&&(a.nScrollFoot.style.width=v(O));!e&&T&&(q.height=v(s.offsetHeight+b));c=p.outerWidth();n[0].style.width=v(c);i.width=v(c);d=p.height()>j.clientHeight||"scroll"==l.css("overflow-y");e="padding"+
(x.bScrollbarLeft?"Left":"Right");i[e]=d?b+"px":"0px";u&&(m[0].style.width=v(c),t[0].style.width=v(c),t[0].style[e]=d?b+"px":"0px");p.children("colgroup").insertBefore(p.children("thead"));l.scroll();if((a.bSorted||a.bFiltered)&&!a._drawHold)j.scrollTop=0}}function H(a,b,c){for(var d=0,e=0,f=b.length,g,j;e<f;){g=b[e].firstChild;for(j=c?c[e].firstChild:null;g;)1===g.nodeType&&(c?a(g,j,d):a(g,d),d++),g=g.nextSibling,j=c?j.nextSibling:null;e++}}function Ea(a){var b=a.nTable,c=a.aoColumns,d=a.oScroll,
e=d.sY,f=d.sX,g=d.sXInner,j=c.length,i=la(a,"bVisible"),n=h("th",a.nTHead),l=b.getAttribute("width"),k=b.parentNode,t=!1,m,o,p=a.oBrowser,d=p.bScrollOversize;(m=b.style.width)&&-1!==m.indexOf("%")&&(l=m);for(m=0;m<i.length;m++)o=c[i[m]],null!==o.sWidth&&(o.sWidth=Db(o.sWidthOrig,k),t=!0);if(d||!t&&!f&&!e&&j==aa(a)&&j==n.length)for(m=0;m<j;m++)i=Z(a,m),null!==i&&(c[i].sWidth=v(n.eq(m).width()));else{j=h(b).clone().css("visibility","hidden").removeAttr("id");j.find("tbody tr").remove();var s=h("<tr/>").appendTo(j.find("tbody"));
j.find("thead, tfoot").remove();j.append(h(a.nTHead).clone()).append(h(a.nTFoot).clone());j.find("tfoot th, tfoot td").css("width","");n=ra(a,j.find("thead")[0]);for(m=0;m<i.length;m++)o=c[i[m]],n[m].style.width=null!==o.sWidthOrig&&""!==o.sWidthOrig?v(o.sWidthOrig):"",o.sWidthOrig&&f&&h(n[m]).append(h("<div/>").css({width:o.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(a.aoData.length)for(m=0;m<i.length;m++)t=i[m],o=c[t],h(Eb(a,t)).clone(!1).append(o.sContentPadding).appendTo(s);h("[name]",
j).removeAttr("name");o=h("<div/>").css(f||e?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(j).appendTo(k);f&&g?j.width(g):f?(j.css("width","auto"),j.removeAttr("width"),j.width()<k.clientWidth&&l&&j.width(k.clientWidth)):e?j.width(k.clientWidth):l&&j.width(l);for(m=e=0;m<i.length;m++)k=h(n[m]),g=k.outerWidth()-k.width(),k=p.bBounding?Math.ceil(n[m].getBoundingClientRect().width):k.outerWidth(),e+=k,c[i[m]].sWidth=v(k-g);b.style.width=v(e);o.remove()}l&&(b.style.width=
v(l));if((l||f)&&!a._reszEvt)b=function(){h(E).on("resize.DT-"+a.sInstance,Na(function(){Y(a)}))},d?setTimeout(b,1E3):b(),a._reszEvt=!0}function Db(a,b){if(!a)return 0;var c=h("<div/>").css("width",v(a)).appendTo(b||G.body),d=c[0].offsetWidth;c.remove();return d}function Eb(a,b){var c=Fb(a,b);if(0>c)return null;var d=a.aoData[c];return!d.nTr?h("<td/>").html(B(a,c,b,"display"))[0]:d.anCells[b]}function Fb(a,b){for(var c,d=-1,e=-1,f=0,g=a.aoData.length;f<g;f++)c=B(a,f,b,"display")+"",c=c.replace(Yb,
""),c=c.replace(/&nbsp;/g," "),c.length>d&&(d=c.length,e=f);return e}function v(a){return null===a?"0px":"number"==typeof a?0>a?"0px":a+"px":a.match(/\d$/)?a+"px":a}function V(a){var b,c,d=[],e=a.aoColumns,f,g,j,i;b=a.aaSortingFixed;c=h.isPlainObject(b);var n=[];f=function(a){a.length&&!h.isArray(a[0])?n.push(a):h.merge(n,a)};h.isArray(b)&&f(b);c&&b.pre&&f(b.pre);f(a.aaSorting);c&&b.post&&f(b.post);for(a=0;a<n.length;a++){i=n[a][0];f=e[i].aDataSort;b=0;for(c=f.length;b<c;b++)g=f[b],j=e[g].sType||
"string",n[a]._idx===k&&(n[a]._idx=h.inArray(n[a][1],e[g].asSorting)),d.push({src:i,col:g,dir:n[a][1],index:n[a]._idx,type:j,formatter:m.ext.type.order[j+"-pre"]})}return d}function lb(a){var b,c,d=[],e=m.ext.type.order,f=a.aoData,g=0,j,i=a.aiDisplayMaster,h;Fa(a);h=V(a);b=0;for(c=h.length;b<c;b++)j=h[b],j.formatter&&g++,Gb(a,j.col);if("ssp"!=y(a)&&0!==h.length){b=0;for(c=i.length;b<c;b++)d[i[b]]=b;g===h.length?i.sort(function(a,b){var c,e,g,j,i=h.length,k=f[a]._aSortData,m=f[b]._aSortData;for(g=
0;g<i;g++)if(j=h[g],c=k[j.col],e=m[j.col],c=c<e?-1:c>e?1:0,0!==c)return"asc"===j.dir?c:-c;c=d[a];e=d[b];return c<e?-1:c>e?1:0}):i.sort(function(a,b){var c,g,j,i,k=h.length,m=f[a]._aSortData,o=f[b]._aSortData;for(j=0;j<k;j++)if(i=h[j],c=m[i.col],g=o[i.col],i=e[i.type+"-"+i.dir]||e["string-"+i.dir],c=i(c,g),0!==c)return c;c=d[a];g=d[b];return c<g?-1:c>g?1:0})}a.bSorted=!0}function Hb(a){for(var b,c,d=a.aoColumns,e=V(a),a=a.oLanguage.oAria,f=0,g=d.length;f<g;f++){c=d[f];var j=c.asSorting;b=c.sTitle.replace(/<.*?>/g,
"");var i=c.nTh;i.removeAttribute("aria-sort");c.bSortable&&(0<e.length&&e[0].col==f?(i.setAttribute("aria-sort","asc"==e[0].dir?"ascending":"descending"),c=j[e[0].index+1]||j[0]):c=j[0],b+="asc"===c?a.sSortAscending:a.sSortDescending);i.setAttribute("aria-label",b)}}function Ua(a,b,c,d){var e=a.aaSorting,f=a.aoColumns[b].asSorting,g=function(a,b){var c=a._idx;c===k&&(c=h.inArray(a[1],f));return c+1<f.length?c+1:b?null:0};"number"===typeof e[0]&&(e=a.aaSorting=[e]);c&&a.oFeatures.bSortMulti?(c=h.inArray(b,
D(e,"0")),-1!==c?(b=g(e[c],!0),null===b&&1===e.length&&(b=0),null===b?e.splice(c,1):(e[c][1]=f[b],e[c]._idx=b)):(e.push([b,f[0],0]),e[e.length-1]._idx=0)):e.length&&e[0][0]==b?(b=g(e[0]),e.length=1,e[0][1]=f[b],e[0]._idx=b):(e.length=0,e.push([b,f[0]]),e[0]._idx=0);S(a);"function"==typeof d&&d(a)}function La(a,b,c,d){var e=a.aoColumns[c];Va(b,{},function(b){!1!==e.bSortable&&(a.oFeatures.bProcessing?(C(a,!0),setTimeout(function(){Ua(a,c,b.shiftKey,d);"ssp"!==y(a)&&C(a,!1)},0)):Ua(a,c,b.shiftKey,d))})}
function wa(a){var b=a.aLastSort,c=a.oClasses.sSortColumn,d=V(a),e=a.oFeatures,f,g;if(e.bSort&&e.bSortClasses){e=0;for(f=b.length;e<f;e++)g=b[e].src,h(D(a.aoData,"anCells",g)).removeClass(c+(2>e?e+1:3));e=0;for(f=d.length;e<f;e++)g=d[e].src,h(D(a.aoData,"anCells",g)).addClass(c+(2>e?e+1:3))}a.aLastSort=d}function Gb(a,b){var c=a.aoColumns[b],d=m.ext.order[c.sSortDataType],e;d&&(e=d.call(a.oInstance,a,b,$(a,b)));for(var f,g=m.ext.type.order[c.sType+"-pre"],j=0,i=a.aoData.length;j<i;j++)if(c=a.aoData[j],
c._aSortData||(c._aSortData=[]),!c._aSortData[b]||d)f=d?e[j]:B(a,j,b,"sort"),c._aSortData[b]=g?g(f):f}function xa(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var b={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:h.extend(!0,[],a.aaSorting),search:zb(a.oPreviousSearch),columns:h.map(a.aoColumns,function(b,d){return{visible:b.bVisible,search:zb(a.aoPreSearchCols[d])}})};r(a,"aoStateSaveParams","stateSaveParams",[a,b]);a.oSavedState=b;a.fnStateSaveCallback.call(a.oInstance,a,
b)}}function Ib(a,b,c){var d,e,f=a.aoColumns,b=function(b){if(b&&b.time){var g=r(a,"aoStateLoadParams","stateLoadParams",[a,b]);if(-1===h.inArray(!1,g)&&(g=a.iStateDuration,!(0<g&&b.time<+new Date-1E3*g)&&!(b.columns&&f.length!==b.columns.length))){a.oLoadedState=h.extend(!0,{},b);b.start!==k&&(a._iDisplayStart=b.start,a.iInitDisplayStart=b.start);b.length!==k&&(a._iDisplayLength=b.length);b.order!==k&&(a.aaSorting=[],h.each(b.order,function(b,c){a.aaSorting.push(c[0]>=f.length?[0,c[1]]:c)}));b.search!==
k&&h.extend(a.oPreviousSearch,Ab(b.search));if(b.columns){d=0;for(e=b.columns.length;d<e;d++)g=b.columns[d],g.visible!==k&&(f[d].bVisible=g.visible),g.search!==k&&h.extend(a.aoPreSearchCols[d],Ab(g.search))}r(a,"aoStateLoaded","stateLoaded",[a,b])}}c()};if(a.oFeatures.bStateSave){var g=a.fnStateLoadCallback.call(a.oInstance,a,b);g!==k&&b(g)}else c()}function ya(a){var b=m.settings,a=h.inArray(a,D(b,"nTable"));return-1!==a?b[a]:null}function J(a,b,c,d){c="DataTables warning: "+(a?"table id="+a.sTableId+
" - ":"")+c;d&&(c+=". For more information about this error, please see http://datatables.net/tn/"+d);if(b)E.console&&console.log&&console.log(c);else if(b=m.ext,b=b.sErrMode||b.errMode,a&&r(a,null,"error",[a,d,c]),"alert"==b)alert(c);else{if("throw"==b)throw Error(c);"function"==typeof b&&b(a,d,c)}}function F(a,b,c,d){h.isArray(c)?h.each(c,function(c,d){h.isArray(d)?F(a,b,d[0],d[1]):F(a,b,d)}):(d===k&&(d=c),b[c]!==k&&(a[d]=b[c]))}function Jb(a,b,c){var d,e;for(e in b)b.hasOwnProperty(e)&&(d=b[e],
h.isPlainObject(d)?(h.isPlainObject(a[e])||(a[e]={}),h.extend(!0,a[e],d)):a[e]=c&&"data"!==e&&"aaData"!==e&&h.isArray(d)?d.slice():d);return a}function Va(a,b,c){h(a).on("click.DT",b,function(b){a.blur();c(b)}).on("keypress.DT",b,function(a){13===a.which&&(a.preventDefault(),c(a))}).on("selectstart.DT",function(){return!1})}function z(a,b,c,d){c&&a[b].push({fn:c,sName:d})}function r(a,b,c,d){var e=[];b&&(e=h.map(a[b].slice().reverse(),function(b){return b.fn.apply(a.oInstance,d)}));null!==c&&(b=h.Event(c+
".dt"),h(a.nTable).trigger(b,d),e.push(b.result));return e}function Ra(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),d=a._iDisplayLength;b>=c&&(b=c-d);b-=b%d;if(-1===d||0>b)b=0;a._iDisplayStart=b}function Ma(a,b){var c=a.renderer,d=m.ext.renderer[b];return h.isPlainObject(c)&&c[b]?d[c[b]]||d._:"string"===typeof c?d[c]||d._:d._}function y(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function ha(a,b){var c=[],c=Kb.numbers_length,d=Math.floor(c/2);b<=c?c=W(0,b):a<=d?(c=W(0,
c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-d?c=W(b-(c-2),b):(c=W(a-d+2,a+d-1),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el="span";return c}function cb(a){h.each({num:function(b){return za(b,a)},"num-fmt":function(b){return za(b,a,Wa)},"html-num":function(b){return za(b,a,Aa)},"html-num-fmt":function(b){return za(b,a,Aa,Wa)}},function(b,c){x.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(x.type.search[b+a]=x.type.search.html)})}function Lb(a){return function(){var b=
[ya(this[m.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return m.ext.internal[a].apply(this,b)}}var m=function(a){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,b){return this.api(!0).rows(a,b).data()};this.api=function(a){return a?new s(ya(this[x.iApiIndex])):new s(this)};this.fnAddData=function(a,b){var c=this.api(!0),d=h.isArray(a)&&(h.isArray(a[0])||h.isPlainObject(a[0]))?c.rows.add(a):c.row.add(a);(b===k||b)&&c.draw();return d.flatten().toArray()};this.fnAdjustColumnSizing=
function(a){var b=this.api(!0).columns.adjust(),c=b.settings()[0],d=c.oScroll;a===k||a?b.draw(!1):(""!==d.sX||""!==d.sY)&&ka(c)};this.fnClearTable=function(a){var b=this.api(!0).clear();(a===k||a)&&b.draw()};this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(a,b,c){var d=this.api(!0),a=d.rows(a),e=a.settings()[0],h=e.aoData[a[0][0]];a.remove();b&&b.call(this,e,h);(c===k||c)&&d.draw();return h};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(a)};
this.fnFilter=function(a,b,c,d,e,h){e=this.api(!0);null===b||b===k?e.search(a,c,d,h):e.column(b).search(a,c,d,h);e.draw()};this.fnGetData=function(a,b){var c=this.api(!0);if(a!==k){var d=a.nodeName?a.nodeName.toLowerCase():"";return b!==k||"td"==d||"th"==d?c.cell(a,b).data():c.row(a).data()||null}return c.data().toArray()};this.fnGetNodes=function(a){var b=this.api(!0);return a!==k?b.row(a).node():b.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();
return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=function(a,b){var c=this.api(!0).page(a);(b===k||b)&&c.draw(!1)};this.fnSetColumnVis=function(a,b,c){a=this.api(!0).column(a).visible(b);(c===k||c)&&a.columns.adjust().draw()};this.fnSettings=function(){return ya(this[x.iApiIndex])};
this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(a,b,c,d,e){var h=this.api(!0);c===k||null===c?h.row(b).data(a):h.cell(b,c).data(a);(e===k||e)&&h.columns.adjust();(d===k||d)&&h.draw();return 0};this.fnVersionCheck=x.fnVersionCheck;var b=this,c=a===k,d=this.length;c&&(a={});this.oApi=this.internal=x.internal;for(var e in m.ext.internal)e&&(this[e]=Lb(e));this.each(function(){var e={},g=1<d?Jb(e,a,!0):
a,j=0,i,e=this.getAttribute("id"),n=!1,l=m.defaults,q=h(this);if("table"!=this.nodeName.toLowerCase())J(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{db(l);eb(l.column);I(l,l,!0);I(l.column,l.column,!0);I(l,h.extend(g,q.data()));var t=m.settings,j=0;for(i=t.length;j<i;j++){var o=t[j];if(o.nTable==this||o.nTHead.parentNode==this||o.nTFoot&&o.nTFoot.parentNode==this){var s=g.bRetrieve!==k?g.bRetrieve:l.bRetrieve;if(c||s)return o.oInstance;if(g.bDestroy!==k?g.bDestroy:l.bDestroy){o.oInstance.fnDestroy();
break}else{J(o,0,"Cannot reinitialise DataTable",3);return}}if(o.sTableId==this.id){t.splice(j,1);break}}if(null===e||""===e)this.id=e="DataTables_Table_"+m.ext._unique++;var p=h.extend(!0,{},m.models.oSettings,{sDestroyWidth:q[0].style.width,sInstance:e,sTableId:e});p.nTable=this;p.oApi=b.internal;p.oInit=g;t.push(p);p.oInstance=1===b.length?b:q.dataTable();db(g);g.oLanguage&&Ca(g.oLanguage);g.aLengthMenu&&!g.iDisplayLength&&(g.iDisplayLength=h.isArray(g.aLengthMenu[0])?g.aLengthMenu[0][0]:g.aLengthMenu[0]);
g=Jb(h.extend(!0,{},l),g);F(p.oFeatures,g,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));F(p,g,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],
["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"]]);F(p.oScroll,g,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);F(p.oLanguage,g,"fnInfoCallback");z(p,"aoDrawCallback",g.fnDrawCallback,"user");z(p,"aoServerParams",g.fnServerParams,"user");z(p,"aoStateSaveParams",g.fnStateSaveParams,"user");z(p,"aoStateLoadParams",g.fnStateLoadParams,"user");z(p,"aoStateLoaded",g.fnStateLoaded,"user");z(p,"aoRowCallback",
g.fnRowCallback,"user");z(p,"aoRowCreatedCallback",g.fnCreatedRow,"user");z(p,"aoHeaderCallback",g.fnHeaderCallback,"user");z(p,"aoFooterCallback",g.fnFooterCallback,"user");z(p,"aoInitComplete",g.fnInitComplete,"user");z(p,"aoPreDrawCallback",g.fnPreDrawCallback,"user");p.rowIdFn=Q(g.rowId);fb(p);var u=p.oClasses;h.extend(u,m.ext.classes,g.oClasses);q.addClass(u.sTable);p.iInitDisplayStart===k&&(p.iInitDisplayStart=g.iDisplayStart,p._iDisplayStart=g.iDisplayStart);null!==g.iDeferLoading&&(p.bDeferLoading=
!0,e=h.isArray(g.iDeferLoading),p._iRecordsDisplay=e?g.iDeferLoading[0]:g.iDeferLoading,p._iRecordsTotal=e?g.iDeferLoading[1]:g.iDeferLoading);var v=p.oLanguage;h.extend(!0,v,g.oLanguage);v.sUrl&&(h.ajax({dataType:"json",url:v.sUrl,success:function(a){Ca(a);I(l.oLanguage,a);h.extend(true,v,a);ga(p)},error:function(){ga(p)}}),n=!0);null===g.asStripeClasses&&(p.asStripeClasses=[u.sStripeOdd,u.sStripeEven]);var e=p.asStripeClasses,x=q.children("tbody").find("tr").eq(0);-1!==h.inArray(!0,h.map(e,function(a){return x.hasClass(a)}))&&
(h("tbody tr",this).removeClass(e.join(" ")),p.asDestroyStripes=e.slice());e=[];t=this.getElementsByTagName("thead");0!==t.length&&(da(p.aoHeader,t[0]),e=ra(p));if(null===g.aoColumns){t=[];j=0;for(i=e.length;j<i;j++)t.push(null)}else t=g.aoColumns;j=0;for(i=t.length;j<i;j++)Da(p,e?e[j]:null);hb(p,g.aoColumnDefs,t,function(a,b){ja(p,a,b)});if(x.length){var w=function(a,b){return a.getAttribute("data-"+b)!==null?b:null};h(x[0]).children("th, td").each(function(a,b){var c=p.aoColumns[a];if(c.mData===
a){var d=w(b,"sort")||w(b,"order"),e=w(b,"filter")||w(b,"search");if(d!==null||e!==null){c.mData={_:a+".display",sort:d!==null?a+".@data-"+d:k,type:d!==null?a+".@data-"+d:k,filter:e!==null?a+".@data-"+e:k};ja(p,a)}}})}var T=p.oFeatures,e=function(){if(g.aaSorting===k){var a=p.aaSorting;j=0;for(i=a.length;j<i;j++)a[j][1]=p.aoColumns[j].asSorting[0]}wa(p);T.bSort&&z(p,"aoDrawCallback",function(){if(p.bSorted){var a=V(p),b={};h.each(a,function(a,c){b[c.src]=c.dir});r(p,null,"order",[p,a,b]);Hb(p)}});
z(p,"aoDrawCallback",function(){(p.bSorted||y(p)==="ssp"||T.bDeferRender)&&wa(p)},"sc");var a=q.children("caption").each(function(){this._captionSide=h(this).css("caption-side")}),b=q.children("thead");b.length===0&&(b=h("<thead/>").appendTo(q));p.nTHead=b[0];b=q.children("tbody");b.length===0&&(b=h("<tbody/>").appendTo(q));p.nTBody=b[0];b=q.children("tfoot");if(b.length===0&&a.length>0&&(p.oScroll.sX!==""||p.oScroll.sY!==""))b=h("<tfoot/>").appendTo(q);if(b.length===0||b.children().length===0)q.addClass(u.sNoFooter);
else if(b.length>0){p.nTFoot=b[0];da(p.aoFooter,p.nTFoot)}if(g.aaData)for(j=0;j<g.aaData.length;j++)M(p,g.aaData[j]);else(p.bDeferLoading||y(p)=="dom")&&ma(p,h(p.nTBody).children("tr"));p.aiDisplay=p.aiDisplayMaster.slice();p.bInitialised=true;n===false&&ga(p)};g.bStateSave?(T.bStateSave=!0,z(p,"aoDrawCallback",xa,"state_save"),Ib(p,g,e)):e()}});b=null;return this},x,s,o,u,Xa={},Mb=/[\r\n]/g,Aa=/<.*?>/g,Zb=/^\d{2,4}[\.\/\-]\d{1,2}[\.\/\-]\d{1,2}([T ]{1}\d{1,2}[:\.]\d{2}([\.:]\d{2})?)?$/,$b=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)",
"g"),Wa=/[',$£€¥%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,L=function(a){return!a||!0===a||"-"===a?!0:!1},Nb=function(a){var b=parseInt(a,10);return!isNaN(b)&&isFinite(a)?b:null},Ob=function(a,b){Xa[b]||(Xa[b]=RegExp(Pa(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace(Xa[b],"."):a},Ya=function(a,b,c){var d="string"===typeof a;if(L(a))return!0;b&&d&&(a=Ob(a,b));c&&d&&(a=a.replace(Wa,""));return!isNaN(parseFloat(a))&&isFinite(a)},Pb=function(a,b,c){return L(a)?!0:!(L(a)||"string"===
typeof a)?null:Ya(a.replace(Aa,""),b,c)?!0:null},D=function(a,b,c){var d=[],e=0,f=a.length;if(c!==k)for(;e<f;e++)a[e]&&a[e][b]&&d.push(a[e][b][c]);else for(;e<f;e++)a[e]&&d.push(a[e][b]);return d},ia=function(a,b,c,d){var e=[],f=0,g=b.length;if(d!==k)for(;f<g;f++)a[b[f]][c]&&e.push(a[b[f]][c][d]);else for(;f<g;f++)e.push(a[b[f]][c]);return e},W=function(a,b){var c=[],d;b===k?(b=0,d=a):(d=b,b=a);for(var e=b;e<d;e++)c.push(e);return c},Qb=function(a){for(var b=[],c=0,d=a.length;c<d;c++)a[c]&&b.push(a[c]);
return b},qa=function(a){var b;a:{if(!(2>a.length)){b=a.slice().sort();for(var c=b[0],d=1,e=b.length;d<e;d++){if(b[d]===c){b=!1;break a}c=b[d]}}b=!0}if(b)return a.slice();b=[];var e=a.length,f,g=0,d=0;a:for(;d<e;d++){c=a[d];for(f=0;f<g;f++)if(b[f]===c)continue a;b.push(c);g++}return b};m.util={throttle:function(a,b){var c=b!==k?b:200,d,e;return function(){var b=this,g=+new Date,j=arguments;d&&g<d+c?(clearTimeout(e),e=setTimeout(function(){d=k;a.apply(b,j)},c)):(d=g,a.apply(b,j))}},escapeRegex:function(a){return a.replace($b,
"\\$1")}};var A=function(a,b,c){a[b]!==k&&(a[c]=a[b])},ba=/\[.*?\]$/,U=/\(\)$/,Pa=m.util.escapeRegex,va=h("<div>")[0],Wb=va.textContent!==k,Yb=/<.*?>/g,Na=m.util.throttle,Rb=[],w=Array.prototype,ac=function(a){var b,c,d=m.settings,e=h.map(d,function(a){return a.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return b=h.inArray(a,e),-1!==b?[d[b]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?c=h(a):a instanceof
h&&(c=a)}else return[];if(c)return c.map(function(){b=h.inArray(this,e);return-1!==b?d[b]:null}).toArray()};s=function(a,b){if(!(this instanceof s))return new s(a,b);var c=[],d=function(a){(a=ac(a))&&(c=c.concat(a))};if(h.isArray(a))for(var e=0,f=a.length;e<f;e++)d(a[e]);else d(a);this.context=qa(c);b&&h.merge(this,b);this.selector={rows:null,cols:null,opts:null};s.extend(this,this,Rb)};m.Api=s;h.extend(s.prototype,{any:function(){return 0!==this.count()},concat:w.concat,context:[],count:function(){return this.flatten().length},
each:function(a){for(var b=0,c=this.length;b<c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new s(b[a],this[a]):null},filter:function(a){var b=[];if(w.filter)b=w.filter.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new s(this.context,b)},flatten:function(){var a=[];return new s(this.context,a.concat.apply(a,this.toArray()))},join:w.join,indexOf:w.indexOf||function(a,b){for(var c=b||0,
d=this.length;c<d;c++)if(this[c]===a)return c;return-1},iterator:function(a,b,c,d){var e=[],f,g,j,h,n,l=this.context,m,o,u=this.selector;"string"===typeof a&&(d=c,c=b,b=a,a=!1);g=0;for(j=l.length;g<j;g++){var r=new s(l[g]);if("table"===b)f=c.call(r,l[g],g),f!==k&&e.push(f);else if("columns"===b||"rows"===b)f=c.call(r,l[g],this[g],g),f!==k&&e.push(f);else if("column"===b||"column-rows"===b||"row"===b||"cell"===b){o=this[g];"column-rows"===b&&(m=Ba(l[g],u.opts));h=0;for(n=o.length;h<n;h++)f=o[h],f=
"cell"===b?c.call(r,l[g],f.row,f.column,g,h):c.call(r,l[g],f,g,h,m),f!==k&&e.push(f)}}return e.length||d?(a=new s(l,a?e.concat.apply([],e):e),b=a.selector,b.rows=u.rows,b.cols=u.cols,b.opts=u.opts,a):this},lastIndexOf:w.lastIndexOf||function(a,b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(w.map)b=w.map.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)b.push(a.call(this,this[c],c));return new s(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},
pop:w.pop,push:w.push,reduce:w.reduce||function(a,b){return gb(this,a,b,0,this.length,1)},reduceRight:w.reduceRight||function(a,b){return gb(this,a,b,this.length-1,-1,-1)},reverse:w.reverse,selector:null,shift:w.shift,slice:function(){return new s(this.context,this)},sort:w.sort,splice:w.splice,toArray:function(){return w.slice.call(this)},to$:function(){return h(this)},toJQuery:function(){return h(this)},unique:function(){return new s(this.context,qa(this))},unshift:w.unshift});s.extend=function(a,
b,c){if(c.length&&b&&(b instanceof s||b.__dt_wrapper)){var d,e,f,g=function(a,b,c){return function(){var d=b.apply(a,arguments);s.extend(d,d,c.methodExt);return d}};d=0;for(e=c.length;d<e;d++)f=c[d],b[f.name]="function"===typeof f.val?g(a,f.val,f):h.isPlainObject(f.val)?{}:f.val,b[f.name].__dt_wrapper=!0,s.extend(a,b[f.name],f.propExt)}};s.register=o=function(a,b){if(h.isArray(a))for(var c=0,d=a.length;c<d;c++)s.register(a[c],b);else for(var e=a.split("."),f=Rb,g,j,c=0,d=e.length;c<d;c++){g=(j=-1!==
e[c].indexOf("()"))?e[c].replace("()",""):e[c];var i;a:{i=0;for(var n=f.length;i<n;i++)if(f[i].name===g){i=f[i];break a}i=null}i||(i={name:g,val:{},methodExt:[],propExt:[]},f.push(i));c===d-1?i.val=b:f=j?i.methodExt:i.propExt}};s.registerPlural=u=function(a,b,c){s.register(a,c);s.register(b,function(){var a=c.apply(this,arguments);return a===this?this:a instanceof s?a.length?h.isArray(a[0])?new s(a.context,a[0]):a[0]:k:a})};o("tables()",function(a){var b;if(a){b=s;var c=this.context;if("number"===
typeof a)a=[c[a]];else var d=h.map(c,function(a){return a.nTable}),a=h(d).filter(a).map(function(){var a=h.inArray(this,d);return c[a]}).toArray();b=new b(a)}else b=this;return b});o("table()",function(a){var a=this.tables(a),b=a.context;return b.length?new s(b[0]):a});u("tables().nodes()","table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});u("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});u("tables().header()",
"table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});u("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});u("tables().containers()","table().container()",function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});o("draw()",function(a){return this.iterator("table",function(b){"page"===a?N(b):("string"===typeof a&&(a="full-hold"===a?!1:!0),S(b,!1===a))})});o("page()",function(a){return a===
k?this.page.info().page:this.iterator("table",function(b){Sa(b,a)})});o("page.info()",function(){if(0===this.context.length)return k;var a=this.context[0],b=a._iDisplayStart,c=a.oFeatures.bPaginate?a._iDisplayLength:-1,d=a.fnRecordsDisplay(),e=-1===c;return{page:e?0:Math.floor(b/c),pages:e?1:Math.ceil(d/c),start:b,end:a.fnDisplayEnd(),length:c,recordsTotal:a.fnRecordsTotal(),recordsDisplay:d,serverSide:"ssp"===y(a)}});o("page.len()",function(a){return a===k?0!==this.context.length?this.context[0]._iDisplayLength:
k:this.iterator("table",function(b){Qa(b,a)})});var Sb=function(a,b,c){if(c){var d=new s(a);d.one("draw",function(){c(d.ajax.json())})}if("ssp"==y(a))S(a,b);else{C(a,!0);var e=a.jqXHR;e&&4!==e.readyState&&e.abort();sa(a,[],function(c){na(a);for(var c=ta(a,c),d=0,e=c.length;d<e;d++)M(a,c[d]);S(a,b);C(a,!1)})}};o("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});o("ajax.params()",function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});o("ajax.reload()",function(a,
b){return this.iterator("table",function(c){Sb(c,!1===b,a)})});o("ajax.url()",function(a){var b=this.context;if(a===k){if(0===b.length)return k;b=b[0];return b.ajax?h.isPlainObject(b.ajax)?b.ajax.url:b.ajax:b.sAjaxSource}return this.iterator("table",function(b){h.isPlainObject(b.ajax)?b.ajax.url=a:b.ajax=a})});o("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Sb(c,!1===b,a)})});var Za=function(a,b,c,d,e){var f=[],g,j,i,n,l,m;i=typeof b;if(!b||"string"===i||"function"===
i||b.length===k)b=[b];i=0;for(n=b.length;i<n;i++){j=b[i]&&b[i].split&&!b[i].match(/[\[\(:]/)?b[i].split(","):[b[i]];l=0;for(m=j.length;l<m;l++)(g=c("string"===typeof j[l]?h.trim(j[l]):j[l]))&&g.length&&(f=f.concat(g))}a=x.selector[a];if(a.length){i=0;for(n=a.length;i<n;i++)f=a[i](d,e,f)}return qa(f)},$a=function(a){a||(a={});a.filter&&a.search===k&&(a.search=a.filter);return h.extend({search:"none",order:"current",page:"all"},a)},ab=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=
a[b],a[0].length=1,a.length=1,a.context=[a.context[b]],a;a.length=0;return a},Ba=function(a,b){var c,d,e,f=[],g=a.aiDisplay;c=a.aiDisplayMaster;var j=b.search;d=b.order;e=b.page;if("ssp"==y(a))return"removed"===j?[]:W(0,c.length);if("current"==e){c=a._iDisplayStart;for(d=a.fnDisplayEnd();c<d;c++)f.push(g[c])}else if("current"==d||"applied"==d)f="none"==j?c.slice():"applied"==j?g.slice():h.map(c,function(a){return-1===h.inArray(a,g)?a:null});else if("index"==d||"original"==d){c=0;for(d=a.aoData.length;c<
d;c++)"none"==j?f.push(c):(e=h.inArray(c,g),(-1===e&&"removed"==j||0<=e&&"applied"==j)&&f.push(c))}return f};o("rows()",function(a,b){a===k?a="":h.isPlainObject(a)&&(b=a,a="");var b=$a(b),c=this.iterator("table",function(c){var e=b,f;return Za("row",a,function(a){var b=Nb(a);if(b!==null&&!e)return[b];f||(f=Ba(c,e));if(b!==null&&h.inArray(b,f)!==-1)return[b];if(a===null||a===k||a==="")return f;if(typeof a==="function")return h.map(f,function(b){var e=c.aoData[b];return a(b,e._aData,e.nTr)?b:null});
b=Qb(ia(c.aoData,f,"nTr"));if(a.nodeName){if(a._DT_RowIndex!==k)return[a._DT_RowIndex];if(a._DT_CellIndex)return[a._DT_CellIndex.row];b=h(a).closest("*[data-dt-row]");return b.length?[b.data("dt-row")]:[]}if(typeof a==="string"&&a.charAt(0)==="#"){var i=c.aIds[a.replace(/^#/,"")];if(i!==k)return[i.idx]}return h(b).filter(a).map(function(){return this._DT_RowIndex}).toArray()},c,e)},1);c.selector.rows=a;c.selector.opts=b;return c});o("rows().nodes()",function(){return this.iterator("row",function(a,
b){return a.aoData[b].nTr||k},1)});o("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return ia(a.aoData,b,"_aData")},1)});u("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var d=b.aoData[c];return"search"===a?d._aFilterData:d._aSortData},1)});u("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){ca(b,c,a)})});u("rows().indexes()","row().index()",function(){return this.iterator("row",function(a,
b){return b},1)});u("rows().ids()","row().id()",function(a){for(var b=[],c=this.context,d=0,e=c.length;d<e;d++)for(var f=0,g=this[d].length;f<g;f++){var h=c[d].rowIdFn(c[d].aoData[this[d][f]]._aData);b.push((!0===a?"#":"")+h)}return new s(c,b)});u("rows().remove()","row().remove()",function(){var a=this;this.iterator("row",function(b,c,d){var e=b.aoData,f=e[c],g,h,i,n,l;e.splice(c,1);g=0;for(h=e.length;g<h;g++)if(i=e[g],l=i.anCells,null!==i.nTr&&(i.nTr._DT_RowIndex=g),null!==l){i=0;for(n=l.length;i<
n;i++)l[i]._DT_CellIndex.row=g}oa(b.aiDisplayMaster,c);oa(b.aiDisplay,c);oa(a[d],c,!1);0<b._iRecordsDisplay&&b._iRecordsDisplay--;Ra(b);c=b.rowIdFn(f._aData);c!==k&&delete b.aIds[c]});this.iterator("table",function(a){for(var c=0,d=a.aoData.length;c<d;c++)a.aoData[c].idx=c});return this});o("rows.add()",function(a){var b=this.iterator("table",function(b){var c,f,g,h=[];f=0;for(g=a.length;f<g;f++)c=a[f],c.nodeName&&"TR"===c.nodeName.toUpperCase()?h.push(ma(b,c)[0]):h.push(M(b,c));return h},1),c=this.rows(-1);
c.pop();h.merge(c,b);return c});o("row()",function(a,b){return ab(this.rows(a,b))});o("row().data()",function(a){var b=this.context;if(a===k)return b.length&&this.length?b[0].aoData[this[0]]._aData:k;b[0].aoData[this[0]]._aData=a;ca(b[0],this[0],"data");return this});o("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});o("row.add()",function(a){a instanceof h&&a.length&&(a=a[0]);var b=this.iterator("table",function(b){return a.nodeName&&
"TR"===a.nodeName.toUpperCase()?ma(b,a)[0]:M(b,a)});return this.row(b[0])});var bb=function(a,b){var c=a.context;if(c.length&&(c=c[0].aoData[b!==k?b:a[0]])&&c._details)c._details.remove(),c._detailsShow=k,c._details=k},Tb=function(a,b){var c=a.context;if(c.length&&a.length){var d=c[0].aoData[a[0]];if(d._details){(d._detailsShow=b)?d._details.insertAfter(d.nTr):d._details.detach();var e=c[0],f=new s(e),g=e.aoData;f.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<D(g,
"_details").length&&(f.on("draw.dt.DT_details",function(a,b){e===b&&f.rows({page:"current"}).eq(0).each(function(a){a=g[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),f.on("column-visibility.dt.DT_details",function(a,b){if(e===b)for(var c,d=aa(b),f=0,h=g.length;f<h;f++)c=g[f],c._details&&c._details.children("td[colspan]").attr("colspan",d)}),f.on("destroy.dt.DT_details",function(a,b){if(e===b)for(var c=0,d=g.length;c<d;c++)g[c]._details&&bb(f,c)}))}}};o("row().child()",function(a,b){var c=this.context;
if(a===k)return c.length&&this.length?c[0].aoData[this[0]]._details:k;if(!0===a)this.child.show();else if(!1===a)bb(this);else if(c.length&&this.length){var d=c[0],c=c[0].aoData[this[0]],e=[],f=function(a,b){if(h.isArray(a)||a instanceof h)for(var c=0,k=a.length;c<k;c++)f(a[c],b);else a.nodeName&&"tr"===a.nodeName.toLowerCase()?e.push(a):(c=h("<tr><td/></tr>").addClass(b),h("td",c).addClass(b).html(a)[0].colSpan=aa(d),e.push(c[0]))};f(a,b);c._details&&c._details.detach();c._details=h(e);c._detailsShow&&
c._details.insertAfter(c.nTr)}return this});o(["row().child.show()","row().child().show()"],function(){Tb(this,!0);return this});o(["row().child.hide()","row().child().hide()"],function(){Tb(this,!1);return this});o(["row().child.remove()","row().child().remove()"],function(){bb(this);return this});o("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var bc=/^([^:]+):(name|visIdx|visible)$/,Ub=function(a,b,c,d,e){for(var c=
[],d=0,f=e.length;d<f;d++)c.push(B(a,e[d],b));return c};o("columns()",function(a,b){a===k?a="":h.isPlainObject(a)&&(b=a,a="");var b=$a(b),c=this.iterator("table",function(c){var e=a,f=b,g=c.aoColumns,j=D(g,"sName"),i=D(g,"nTh");return Za("column",e,function(a){var b=Nb(a);if(a==="")return W(g.length);if(b!==null)return[b>=0?b:g.length+b];if(typeof a==="function"){var e=Ba(c,f);return h.map(g,function(b,f){return a(f,Ub(c,f,0,0,e),i[f])?f:null})}var k=typeof a==="string"?a.match(bc):"";if(k)switch(k[2]){case "visIdx":case "visible":b=
parseInt(k[1],10);if(b<0){var m=h.map(g,function(a,b){return a.bVisible?b:null});return[m[m.length+b]]}return[Z(c,b)];case "name":return h.map(j,function(a,b){return a===k[1]?b:null});default:return[]}if(a.nodeName&&a._DT_CellIndex)return[a._DT_CellIndex.column];b=h(i).filter(a).map(function(){return h.inArray(this,i)}).toArray();if(b.length||!a.nodeName)return b;b=h(a).closest("*[data-dt-column]");return b.length?[b.data("dt-column")]:[]},c,f)},1);c.selector.cols=a;c.selector.opts=b;return c});u("columns().header()",
"column().header()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});u("columns().footer()","column().footer()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTf},1)});u("columns().data()","column().data()",function(){return this.iterator("column-rows",Ub,1)});u("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});u("columns().cache()","column().cache()",
function(a){return this.iterator("column-rows",function(b,c,d,e,f){return ia(b.aoData,f,"search"===a?"_aFilterData":"_aSortData",c)},1)});u("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(a,b,c,d,e){return ia(a.aoData,e,"anCells",b)},1)});u("columns().visible()","column().visible()",function(a,b){var c=this.iterator("column",function(b,c){if(a===k)return b.aoColumns[c].bVisible;var f=b.aoColumns,g=f[c],j=b.aoData,i,n,l;if(a!==k&&g.bVisible!==a){if(a){var m=
h.inArray(!0,D(f,"bVisible"),c+1);i=0;for(n=j.length;i<n;i++)l=j[i].nTr,f=j[i].anCells,l&&l.insertBefore(f[c],f[m]||null)}else h(D(b.aoData,"anCells",c)).detach();g.bVisible=a;ea(b,b.aoHeader);ea(b,b.aoFooter);xa(b)}});a!==k&&(this.iterator("column",function(c,e){r(c,null,"column-visibility",[c,e,a,b])}),(b===k||b)&&this.columns.adjust());return c});u("columns().indexes()","column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?$(b,c):c},1)});o("columns.adjust()",
function(){return this.iterator("table",function(a){Y(a)},1)});o("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return Z(c,b);if("fromData"===a||"toVisible"===a)return $(c,b)}});o("column()",function(a,b){return ab(this.columns(a,b))});o("cells()",function(a,b,c){h.isPlainObject(a)&&(a.row===k?(c=a,a=null):(c=b,b=null));h.isPlainObject(b)&&(c=b,b=null);if(null===b||b===k)return this.iterator("table",function(b){var d=a,e=$a(c),f=
b.aoData,g=Ba(b,e),j=Qb(ia(f,g,"anCells")),i=h([].concat.apply([],j)),l,n=b.aoColumns.length,m,o,u,s,r,v;return Za("cell",d,function(a){var c=typeof a==="function";if(a===null||a===k||c){m=[];o=0;for(u=g.length;o<u;o++){l=g[o];for(s=0;s<n;s++){r={row:l,column:s};if(c){v=f[l];a(r,B(b,l,s),v.anCells?v.anCells[s]:null)&&m.push(r)}else m.push(r)}}return m}if(h.isPlainObject(a))return[a];c=i.filter(a).map(function(a,b){return{row:b._DT_CellIndex.row,column:b._DT_CellIndex.column}}).toArray();if(c.length||
!a.nodeName)return c;v=h(a).closest("*[data-dt-row]");return v.length?[{row:v.data("dt-row"),column:v.data("dt-column")}]:[]},b,e)});var d=this.columns(b,c),e=this.rows(a,c),f,g,j,i,n,l=this.iterator("table",function(a,b){f=[];g=0;for(j=e[b].length;g<j;g++){i=0;for(n=d[b].length;i<n;i++)f.push({row:e[b][g],column:d[b][i]})}return f},1);h.extend(l.selector,{cols:b,rows:a,opts:c});return l});u("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(a,b,c){return(a=a.aoData[b])&&
a.anCells?a.anCells[c]:k},1)});o("cells().data()",function(){return this.iterator("cell",function(a,b,c){return B(a,b,c)},1)});u("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,d){return b.aoData[c][a][d]},1)});u("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,d){return B(b,c,d,a)},1)});u("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(a,
b,c){return{row:b,column:c,columnVisible:$(a,c)}},1)});u("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,d){ca(b,c,a,d)})});o("cell()",function(a,b,c){return ab(this.cells(a,b,c))});o("cell().data()",function(a){var b=this.context,c=this[0];if(a===k)return b.length&&c.length?B(b[0],c[0].row,c[0].column):k;ib(b[0],c[0].row,c[0].column,a);ca(b[0],c[0].row,"data",c[0].column);return this});o("order()",function(a,b){var c=this.context;if(a===k)return 0!==
c.length?c[0].aaSorting:k;"number"===typeof a?a=[[a,b]]:a.length&&!h.isArray(a[0])&&(a=Array.prototype.slice.call(arguments));return this.iterator("table",function(b){b.aaSorting=a.slice()})});o("order.listener()",function(a,b,c){return this.iterator("table",function(d){La(d,a,b,c)})});o("order.fixed()",function(a){if(!a){var b=this.context,b=b.length?b[0].aaSortingFixed:k;return h.isArray(b)?{pre:b}:b}return this.iterator("table",function(b){b.aaSortingFixed=h.extend(!0,{},a)})});o(["columns().order()",
"column().order()"],function(a){var b=this;return this.iterator("table",function(c,d){var e=[];h.each(b[d],function(b,c){e.push([c,a])});c.aaSorting=e})});o("search()",function(a,b,c,d){var e=this.context;return a===k?0!==e.length?e[0].oPreviousSearch.sSearch:k:this.iterator("table",function(e){e.oFeatures.bFilter&&fa(e,h.extend({},e.oPreviousSearch,{sSearch:a+"",bRegex:null===b?!1:b,bSmart:null===c?!0:c,bCaseInsensitive:null===d?!0:d}),1)})});u("columns().search()","column().search()",function(a,
b,c,d){return this.iterator("column",function(e,f){var g=e.aoPreSearchCols;if(a===k)return g[f].sSearch;e.oFeatures.bFilter&&(h.extend(g[f],{sSearch:a+"",bRegex:null===b?!1:b,bSmart:null===c?!0:c,bCaseInsensitive:null===d?!0:d}),fa(e,e.oPreviousSearch,1))})});o("state()",function(){return this.context.length?this.context[0].oSavedState:null});o("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});o("state.loaded()",function(){return this.context.length?
this.context[0].oLoadedState:null});o("state.save()",function(){return this.iterator("table",function(a){xa(a)})});m.versionCheck=m.fnVersionCheck=function(a){for(var b=m.version.split("."),a=a.split("."),c,d,e=0,f=a.length;e<f;e++)if(c=parseInt(b[e],10)||0,d=parseInt(a[e],10)||0,c!==d)return c>d;return!0};m.isDataTable=m.fnIsDataTable=function(a){var b=h(a).get(0),c=!1;if(a instanceof m.Api)return!0;h.each(m.settings,function(a,e){var f=e.nScrollHead?h("table",e.nScrollHead)[0]:null,g=e.nScrollFoot?
h("table",e.nScrollFoot)[0]:null;if(e.nTable===b||f===b||g===b)c=!0});return c};m.tables=m.fnTables=function(a){var b=!1;h.isPlainObject(a)&&(b=a.api,a=a.visible);var c=h.map(m.settings,function(b){if(!a||a&&h(b.nTable).is(":visible"))return b.nTable});return b?new s(c):c};m.camelToHungarian=I;o("$()",function(a,b){var c=this.rows(b).nodes(),c=h(c);return h([].concat(c.filter(a).toArray(),c.find(a).toArray()))});h.each(["on","one","off"],function(a,b){o(b+"()",function(){var a=Array.prototype.slice.call(arguments);
a[0]=h.map(a[0].split(/\s/),function(a){return!a.match(/\.dt\b/)?a+".dt":a}).join(" ");var d=h(this.tables().nodes());d[b].apply(d,a);return this})});o("clear()",function(){return this.iterator("table",function(a){na(a)})});o("settings()",function(){return new s(this.context,this.context)});o("init()",function(){var a=this.context;return a.length?a[0].oInit:null});o("data()",function(){return this.iterator("table",function(a){return D(a.aoData,"_aData")}).flatten()});o("destroy()",function(a){a=a||
!1;return this.iterator("table",function(b){var c=b.nTableWrapper.parentNode,d=b.oClasses,e=b.nTable,f=b.nTBody,g=b.nTHead,j=b.nTFoot,i=h(e),f=h(f),k=h(b.nTableWrapper),l=h.map(b.aoData,function(a){return a.nTr}),o;b.bDestroying=!0;r(b,"aoDestroyCallback","destroy",[b]);a||(new s(b)).columns().visible(!0);k.off(".DT").find(":not(tbody *)").off(".DT");h(E).off(".DT-"+b.sInstance);e!=g.parentNode&&(i.children("thead").detach(),i.append(g));j&&e!=j.parentNode&&(i.children("tfoot").detach(),i.append(j));
b.aaSorting=[];b.aaSortingFixed=[];wa(b);h(l).removeClass(b.asStripeClasses.join(" "));h("th, td",g).removeClass(d.sSortable+" "+d.sSortableAsc+" "+d.sSortableDesc+" "+d.sSortableNone);f.children().detach();f.append(l);g=a?"remove":"detach";i[g]();k[g]();!a&&c&&(c.insertBefore(e,b.nTableReinsertBefore),i.css("width",b.sDestroyWidth).removeClass(d.sTable),(o=b.asDestroyStripes.length)&&f.children().each(function(a){h(this).addClass(b.asDestroyStripes[a%o])}));c=h.inArray(b,m.settings);-1!==c&&m.settings.splice(c,
1)})});h.each(["column","row","cell"],function(a,b){o(b+"s().every()",function(a){var d=this.selector.opts,e=this;return this.iterator(b,function(f,g,h,i,n){a.call(e[b](g,"cell"===b?h:d,"cell"===b?d:k),g,h,i,n)})})});o("i18n()",function(a,b,c){var d=this.context[0],a=Q(a)(d.oLanguage);a===k&&(a=b);c!==k&&h.isPlainObject(a)&&(a=a[c]!==k?a[c]:a._);return a.replace("%d",c)});m.version="1.10.16";m.settings=[];m.models={};m.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};m.models.oRow=
{nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};m.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,
sWidthOrig:null};m.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,
this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+
"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",
sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:h.extend({},m.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null,rowId:"DT_RowId"};
X(m.defaults);m.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};X(m.defaults.column);m.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,
bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aIds:{},aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],
aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:k,oAjaxData:k,fnServerData:null,
aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==y(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==y(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,
b=this._iDisplayStart,c=b+a,d=this.aiDisplay.length,e=this.oFeatures,f=e.bPaginate;return e.bServerSide?!1===f||-1===a?b+d:Math.min(b+a,this._iRecordsDisplay):!f||c>d||-1===a?d:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};m.ext=x={buttons:{},classes:{},build:"dt/dt-1.10.16/sc-1.4.3",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},
order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:m.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:m.version};h.extend(x,{afnFiltering:x.search,aTypes:x.type.detect,ofnSearch:x.type.search,oSort:x.type.order,afnSortData:x.order,aoFeatures:x.feature,oApi:x.internal,oStdClasses:x.classes,oPagination:x.pager});h.extend(m.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",
sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",
sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Kb=m.ext.pager;h.extend(Kb,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},numbers:function(a,b){return[ha(a,
b)]},simple_numbers:function(a,b){return["previous",ha(a,b),"next"]},full_numbers:function(a,b){return["first","previous",ha(a,b),"next","last"]},first_last_numbers:function(a,b){return["first",ha(a,b),"last"]},_numbers:ha,numbers_length:7});h.extend(!0,m.ext.renderer,{pageButton:{_:function(a,b,c,d,e,f){var g=a.oClasses,j=a.oLanguage.oPaginate,i=a.oLanguage.oAria.paginate||{},n,l,m=0,o=function(b,d){var k,s,u,r,v=function(b){Sa(a,b.data.action,true)};k=0;for(s=d.length;k<s;k++){r=d[k];if(h.isArray(r)){u=
h("<"+(r.DT_el||"div")+"/>").appendTo(b);o(u,r)}else{n=null;l="";switch(r){case "ellipsis":b.append('<span class="ellipsis">&#x2026;</span>');break;case "first":n=j.sFirst;l=r+(e>0?"":" "+g.sPageButtonDisabled);break;case "previous":n=j.sPrevious;l=r+(e>0?"":" "+g.sPageButtonDisabled);break;case "next":n=j.sNext;l=r+(e<f-1?"":" "+g.sPageButtonDisabled);break;case "last":n=j.sLast;l=r+(e<f-1?"":" "+g.sPageButtonDisabled);break;default:n=r+1;l=e===r?g.sPageButtonActive:""}if(n!==null){u=h("<a>",{"class":g.sPageButton+
" "+l,"aria-controls":a.sTableId,"aria-label":i[r],"data-dt-idx":m,tabindex:a.iTabIndex,id:c===0&&typeof r==="string"?a.sTableId+"_"+r:null}).html(n).appendTo(b);Va(u,{action:r},v);m++}}}},s;try{s=h(b).find(G.activeElement).data("dt-idx")}catch(u){}o(h(b).empty(),d);s!==k&&h(b).find("[data-dt-idx="+s+"]").focus()}}});h.extend(m.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return Ya(a,c)?"num"+c:null},function(a){if(a&&!(a instanceof Date)&&!Zb.test(a))return null;var b=Date.parse(a);
return null!==b&&!isNaN(b)||L(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return Ya(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Pb(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Pb(a,c,!0)?"html-num-fmt"+c:null},function(a){return L(a)||"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);h.extend(m.ext.type.search,{html:function(a){return L(a)?a:"string"===typeof a?a.replace(Mb," ").replace(Aa,""):""},string:function(a){return L(a)?
a:"string"===typeof a?a.replace(Mb," "):a}});var za=function(a,b,c,d){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Ob(a,b));a.replace&&(c&&(a=a.replace(c,"")),d&&(a=a.replace(d,"")));return 1*a};h.extend(x.type.order,{"date-pre":function(a){return Date.parse(a)||-Infinity},"html-pre":function(a){return L(a)?"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return L(a)?"":"string"===typeof a?a.toLowerCase():!a.toString?"":a.toString()},"string-asc":function(a,b){return a<
b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});cb("");h.extend(!0,m.ext.renderer,{header:{_:function(a,b,c,d){h(a.nTable).on("order.dt.DT",function(e,f,g,h){if(a===f){e=c.idx;b.removeClass(c.sSortingClass+" "+d.sSortAsc+" "+d.sSortDesc).addClass(h[e]=="asc"?d.sSortAsc:h[e]=="desc"?d.sSortDesc:c.sSortingClass)}})},jqueryui:function(a,b,c,d){h("<div/>").addClass(d.sSortJUIWrapper).append(b.contents()).append(h("<span/>").addClass(d.sSortIcon+" "+c.sSortingClassJUI)).appendTo(b);
h(a.nTable).on("order.dt.DT",function(e,f,g,h){if(a===f){e=c.idx;b.removeClass(d.sSortAsc+" "+d.sSortDesc).addClass(h[e]=="asc"?d.sSortAsc:h[e]=="desc"?d.sSortDesc:c.sSortingClass);b.find("span."+d.sSortIcon).removeClass(d.sSortJUIAsc+" "+d.sSortJUIDesc+" "+d.sSortJUI+" "+d.sSortJUIAscAllowed+" "+d.sSortJUIDescAllowed).addClass(h[e]=="asc"?d.sSortJUIAsc:h[e]=="desc"?d.sSortJUIDesc:c.sSortingClassJUI)}})}}});var Vb=function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;"):a};m.render={number:function(a,b,c,d,e){return{display:function(f){if("number"!==typeof f&&"string"!==typeof f)return f;var g=0>f?"-":"",h=parseFloat(f);if(isNaN(h))return Vb(f);h=h.toFixed(c);f=Math.abs(h);h=parseInt(f,10);f=c?b+(f-h).toFixed(c).substring(2):"";return g+(d||"")+h.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+f+(e||"")}}},text:function(){return{display:Vb}}};h.extend(m.ext.internal,{_fnExternApiFunc:Lb,_fnBuildAjax:sa,_fnAjaxUpdate:kb,_fnAjaxParameters:tb,_fnAjaxUpdateDraw:ub,
_fnAjaxDataSrc:ta,_fnAddColumn:Da,_fnColumnOptions:ja,_fnAdjustColumnSizing:Y,_fnVisibleToColumnIndex:Z,_fnColumnIndexToVisible:$,_fnVisbleColumns:aa,_fnGetColumns:la,_fnColumnTypes:Fa,_fnApplyColumnDefs:hb,_fnHungarianMap:X,_fnCamelToHungarian:I,_fnLanguageCompat:Ca,_fnBrowserDetect:fb,_fnAddData:M,_fnAddTr:ma,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==k?b._DT_RowIndex:null},_fnNodeToColumnIndex:function(a,b,c){return h.inArray(c,a.aoData[b].anCells)},_fnGetCellData:B,_fnSetCellData:ib,
_fnSplitObjNotation:Ia,_fnGetObjectDataFn:Q,_fnSetObjectDataFn:R,_fnGetDataMaster:Ja,_fnClearTable:na,_fnDeleteIndex:oa,_fnInvalidate:ca,_fnGetRowElements:Ha,_fnCreateTr:Ga,_fnBuildHead:jb,_fnDrawHead:ea,_fnDraw:N,_fnReDraw:S,_fnAddOptionsHtml:mb,_fnDetectHeader:da,_fnGetUniqueThs:ra,_fnFeatureHtmlFilter:ob,_fnFilterComplete:fa,_fnFilterCustom:xb,_fnFilterColumn:wb,_fnFilter:vb,_fnFilterCreateSearch:Oa,_fnEscapeRegex:Pa,_fnFilterData:yb,_fnFeatureHtmlInfo:rb,_fnUpdateInfo:Bb,_fnInfoMacros:Cb,_fnInitialise:ga,
_fnInitComplete:ua,_fnLengthChange:Qa,_fnFeatureHtmlLength:nb,_fnFeatureHtmlPaginate:sb,_fnPageChange:Sa,_fnFeatureHtmlProcessing:pb,_fnProcessingDisplay:C,_fnFeatureHtmlTable:qb,_fnScrollDraw:ka,_fnApplyToChildren:H,_fnCalculateColumnWidths:Ea,_fnThrottle:Na,_fnConvertToWidth:Db,_fnGetWidestNode:Eb,_fnGetMaxLenString:Fb,_fnStringToCss:v,_fnSortFlatten:V,_fnSort:lb,_fnSortAria:Hb,_fnSortListener:Ua,_fnSortAttachListener:La,_fnSortingClasses:wa,_fnSortData:Gb,_fnSaveState:xa,_fnLoadState:Ib,_fnSettingsFromNode:ya,
_fnLog:J,_fnMap:F,_fnBindAction:Va,_fnCallbackReg:z,_fnCallbackFire:r,_fnLengthOverflow:Ra,_fnRenderer:Ma,_fnDataSource:y,_fnRowAttributes:Ka,_fnCalculateEnd:function(){}});h.fn.dataTable=m;m.$=h;h.fn.dataTableSettings=m.settings;h.fn.dataTableExt=m.ext;h.fn.DataTable=function(a){return h(this).dataTable(a).api()};h.each(m,function(a,b){h.fn.DataTable[a]=b});return h.fn.dataTable});


/*!
 Scroller 1.4.3
 ©2011-2017 SpryMedia Ltd - datatables.net/license
*/
(function(e){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(g){return e(g,window,document)}):"object"===typeof exports?module.exports=function(g,j){g||(g=window);if(!j||!j.fn.dataTable)j=require("datatables.net")(g,j).$;return e(j,g,g.document)}:e(jQuery,window,document)})(function(e,g,j,l){var m=e.fn.dataTable,h=function(a,b){this instanceof h?(b===l&&(b={}),this.s={dt:e.fn.dataTable.Api(a).settings()[0],tableTop:0,tableBottom:0,redrawTop:0,redrawBottom:0,autoHeight:!0,
viewportRows:0,stateTO:null,drawTO:null,heights:{jump:null,page:null,virtual:null,scroll:null,row:null,viewport:null},topRowFloat:0,scrollDrawDiff:null,loaderVisible:!1,forceReposition:!1},this.s=e.extend(this.s,h.oDefaults,b),this.s.heights.row=this.s.rowHeight,this.dom={force:j.createElement("div"),scroller:null,table:null,loader:null},this.s.dt.oScroller||(this.s.dt.oScroller=this,this._fnConstruct())):alert("Scroller warning: Scroller must be initialised with the 'new' keyword.")};e.extend(h.prototype,
{fnRowToPixels:function(a,b,c){a=c?this._domain("virtualToPhysical",a*this.s.heights.row):this.s.baseScrollTop+(a-this.s.baseRowTop)*this.s.heights.row;return b||b===l?parseInt(a,10):a},fnPixelsToRow:function(a,b,c){var d=a-this.s.baseScrollTop,a=c?this._domain("physicalToVirtual",a)/this.s.heights.row:d/this.s.heights.row+this.s.baseRowTop;return b||b===l?parseInt(a,10):a},fnScrollToRow:function(a,b){var c=this,d=!1,f=this.fnRowToPixels(a),i=a-(this.s.displayBuffer-1)/2*this.s.viewportRows;0>i&&
(i=0);if((f>this.s.redrawBottom||f<this.s.redrawTop)&&this.s.dt._iDisplayStart!==i)d=!0,f=this.fnRowToPixels(a,!1,!0),this.s.redrawTop<f&&f<this.s.redrawBottom&&(this.s.forceReposition=!0,b=!1);"undefined"==typeof b||b?(this.s.ani=d,e(this.dom.scroller).animate({scrollTop:f},function(){setTimeout(function(){c.s.ani=!1},25)})):e(this.dom.scroller).scrollTop(f)},fnMeasure:function(a){this.s.autoHeight&&this._fnCalcRowHeight();var b=this.s.heights;b.row&&(b.viewport=e.contains(j,this.dom.scroller)?e(this.dom.scroller).height():
this._parseHeight(e(this.dom.scroller).css("height")),b.viewport||(b.viewport=this._parseHeight(e(this.dom.scroller).css("max-height"))),this.s.viewportRows=parseInt(b.viewport/b.row,10)+1,this.s.dt._iDisplayLength=this.s.viewportRows*this.s.displayBuffer);(a===l||a)&&this.s.dt.oInstance.fnDraw(!1)},fnPageInfo:function(){var a=this.dom.scroller.scrollTop,b=this.s.dt.fnRecordsDisplay(),c=Math.ceil(this.fnPixelsToRow(a+this.s.heights.viewport,!1,this.s.ani));return{start:Math.floor(this.fnPixelsToRow(a,
!1,this.s.ani)),end:b<c?b-1:c-1}},_fnConstruct:function(){var a=this;if(this.s.dt.oFeatures.bPaginate){this.dom.force.style.position="relative";this.dom.force.style.top="0px";this.dom.force.style.left="0px";this.dom.force.style.width="1px";this.dom.scroller=e("div."+this.s.dt.oClasses.sScrollBody,this.s.dt.nTableWrapper)[0];this.dom.scroller.appendChild(this.dom.force);this.dom.scroller.style.position="relative";this.dom.table=e(">table",this.dom.scroller)[0];this.dom.table.style.position="absolute";
this.dom.table.style.top="0px";this.dom.table.style.left="0px";e(this.s.dt.nTableWrapper).addClass("DTS");this.s.loadingIndicator&&(this.dom.loader=e('<div class="dataTables_processing DTS_Loading">'+this.s.dt.oLanguage.sLoadingRecords+"</div>").css("display","none"),e(this.dom.scroller.parentNode).css("position","relative").append(this.dom.loader));this.s.heights.row&&"auto"!=this.s.heights.row&&(this.s.autoHeight=!1);this.fnMeasure(!1);this.s.ingnoreScroll=!0;this.s.stateSaveThrottle=this.s.dt.oApi._fnThrottle(function(){a.s.dt.oApi._fnSaveState(a.s.dt)},
500);e(this.dom.scroller).on("scroll.DTS",function(){a._fnScroll.call(a)});e(this.dom.scroller).on("touchstart.DTS",function(){a._fnScroll.call(a)});this.s.dt.aoDrawCallback.push({fn:function(){a.s.dt.bInitialised&&a._fnDrawCallback.call(a)},sName:"Scroller"});e(g).on("resize.DTS",function(){a.fnMeasure(false);a._fnInfo()});var b=!0;this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(c,d){if(b&&a.s.dt.oLoadedState){d.iScroller=a.s.dt.oLoadedState.iScroller;d.iScrollerTopRow=a.s.dt.oLoadedState.iScrollerTopRow;
b=false}else{d.iScroller=a.dom.scroller.scrollTop;d.iScrollerTopRow=a.s.topRowFloat}},"Scroller_State");this.s.dt.oLoadedState&&(this.s.topRowFloat=this.s.dt.oLoadedState.iScrollerTopRow||0);e(this.s.dt.nTable).one("init.dt",function(){a.fnMeasure()});this.s.dt.aoDestroyCallback.push({sName:"Scroller",fn:function(){e(g).off("resize.DTS");e(a.dom.scroller).off("touchstart.DTS scroll.DTS");e(a.s.dt.nTableWrapper).removeClass("DTS");e("div.DTS_Loading",a.dom.scroller.parentNode).remove();e(a.s.dt.nTable).off("init.dt");
a.dom.table.style.position="";a.dom.table.style.top="";a.dom.table.style.left=""}})}else this.s.dt.oApi._fnLog(this.s.dt,0,"Pagination must be enabled for Scroller")},_fnScroll:function(){var a=this,b=this.s.heights,c=this.dom.scroller.scrollTop,d;if(!this.s.skip&&!this.s.ingnoreScroll)if(this.s.dt.bFiltered||this.s.dt.bSorted)this.s.lastScrollTop=0;else{this._fnInfo();clearTimeout(this.s.stateTO);this.s.stateTO=setTimeout(function(){a.s.dt.oApi._fnSaveState(a.s.dt)},250);if(this.s.forceReposition||
c<this.s.redrawTop||c>this.s.redrawBottom){var f=Math.ceil((this.s.displayBuffer-1)/2*this.s.viewportRows);Math.abs(c-this.s.lastScrollTop)>b.viewport||this.s.ani||this.s.forceReposition?(d=parseInt(this._domain("physicalToVirtual",c)/b.row,10)-f,this.s.topRowFloat=this._domain("physicalToVirtual",c)/b.row):(d=this.fnPixelsToRow(c)-f,this.s.topRowFloat=this.fnPixelsToRow(c,!1));this.s.forceReposition=!1;0>=d?d=0:d+this.s.dt._iDisplayLength>this.s.dt.fnRecordsDisplay()?(d=this.s.dt.fnRecordsDisplay()-
this.s.dt._iDisplayLength,0>d&&(d=0)):0!==d%2&&d++;if(d!=this.s.dt._iDisplayStart&&(this.s.tableTop=e(this.s.dt.nTable).offset().top,this.s.tableBottom=e(this.s.dt.nTable).height()+this.s.tableTop,b=function(){if(a.s.scrollDrawReq===null)a.s.scrollDrawReq=c;a.s.dt._iDisplayStart=d;a.s.dt.oApi._fnDraw(a.s.dt)},this.s.dt.oFeatures.bServerSide?(clearTimeout(this.s.drawTO),this.s.drawTO=setTimeout(b,this.s.serverWait)):b(),this.dom.loader&&!this.s.loaderVisible))this.dom.loader.css("display","block"),
this.s.loaderVisible=!0}else this.s.topRowFloat=this._domain("physicalToVirtual",c)/b.row;this.s.lastScrollTop=c;this.s.stateSaveThrottle()}},_domain:function(a,b){var c=this.s.heights,d;if(c.virtual===c.scroll)return b;var e=(c.scroll-c.viewport)/2,i=(c.virtual-c.viewport)/2;d=i/(e*e);if("virtualToPhysical"===a){if(b<i)return Math.pow(b/d,0.5);b=2*i-b;return 0>b?c.scroll:2*e-Math.pow(b/d,0.5)}if("physicalToVirtual"===a){if(b<e)return b*b*d;b=2*e-b;return 0>b?c.virtual:2*i-b*b*d}},_parseHeight:function(a){var b,
c=/^([+-]?(?:\d+(?:\.\d+)?|\.\d+))(px|em|rem|vh)$/.exec(a);if(null===c)return 0;a=parseFloat(c[1]);c=c[2];"px"===c?b=a:"vh"===c?b=a/100*e(g).height():"rem"===c?b=a*parseFloat(e(":root").css("font-size")):"em"===c&&(b=a*parseFloat(e("body").css("font-size")));return b?b:0},_fnDrawCallback:function(){var a=this,b=this.s.heights,c=this.dom.scroller.scrollTop,d=e(this.s.dt.nTable).height(),f=this.s.dt._iDisplayStart,i=this.s.dt._iDisplayLength,h=this.s.dt.fnRecordsDisplay();this.s.skip=!0;this._fnScrollForce();
c=0===f?this.s.topRowFloat*b.row:f+i>=h?b.scroll-(h-this.s.topRowFloat)*b.row:this._domain("virtualToPhysical",this.s.topRowFloat*b.row);this.dom.scroller.scrollTop=c;this.s.baseScrollTop=c;this.s.baseRowTop=this.s.topRowFloat;var g=c-(this.s.topRowFloat-f)*b.row;0===f?g=0:f+i>=h&&(g=b.scroll-d);this.dom.table.style.top=g+"px";this.s.tableTop=g;this.s.tableBottom=d+this.s.tableTop;d=(c-this.s.tableTop)*this.s.boundaryScale;this.s.redrawTop=c-d;this.s.redrawBottom=c+d>b.scroll-b.viewport-b.row?b.scroll-
b.viewport-b.row:c+d;this.s.skip=!1;this.s.dt.oFeatures.bStateSave&&null!==this.s.dt.oLoadedState&&"undefined"!=typeof this.s.dt.oLoadedState.iScroller?((c=(this.s.dt.sAjaxSource||a.s.dt.ajax)&&!this.s.dt.oFeatures.bServerSide?!0:!1)&&2==this.s.dt.iDraw||!c&&1==this.s.dt.iDraw)&&setTimeout(function(){e(a.dom.scroller).scrollTop(a.s.dt.oLoadedState.iScroller);a.s.redrawTop=a.s.dt.oLoadedState.iScroller-b.viewport/2;setTimeout(function(){a.s.ingnoreScroll=!1},0)},0):a.s.ingnoreScroll=!1;this.s.dt.oFeatures.bInfo&&
setTimeout(function(){a._fnInfo.call(a)},0);this.dom.loader&&this.s.loaderVisible&&(this.dom.loader.css("display","none"),this.s.loaderVisible=!1)},_fnScrollForce:function(){var a=this.s.heights;a.virtual=a.row*this.s.dt.fnRecordsDisplay();a.scroll=a.virtual;1E6<a.scroll&&(a.scroll=1E6);this.dom.force.style.height=a.scroll>this.s.heights.row?a.scroll+"px":this.s.heights.row+"px"},_fnCalcRowHeight:function(){var a=this.s.dt,b=a.nTable,c=b.cloneNode(!1),d=e("<tbody/>").appendTo(c),f=e('<div class="'+
a.oClasses.sWrapper+' DTS"><div class="'+a.oClasses.sScrollWrapper+'"><div class="'+a.oClasses.sScrollBody+'"></div></div></div>');for(e("tbody tr:lt(4)",b).clone().appendTo(d);3>e("tr",d).length;)d.append("<tr><td>&nbsp;</td></tr>");e("div."+a.oClasses.sScrollBody,f).append(c);a=this.s.dt.nHolding||b.parentNode;e(a).is(":visible")||(a="body");f.appendTo(a);this.s.heights.row=e("tr",d).eq(1).outerHeight();f.remove()},_fnInfo:function(){if(this.s.dt.oFeatures.bInfo){var a=this.s.dt,b=a.oLanguage,c=
this.dom.scroller.scrollTop,d=Math.floor(this.fnPixelsToRow(c,!1,this.s.ani)+1),f=a.fnRecordsTotal(),i=a.fnRecordsDisplay(),c=Math.ceil(this.fnPixelsToRow(c+this.s.heights.viewport,!1,this.s.ani)),c=i<c?i:c,g=a.fnFormatNumber(d),h=a.fnFormatNumber(c),j=a.fnFormatNumber(f),k=a.fnFormatNumber(i),g=0===a.fnRecordsDisplay()&&a.fnRecordsDisplay()==a.fnRecordsTotal()?b.sInfoEmpty+b.sInfoPostFix:0===a.fnRecordsDisplay()?b.sInfoEmpty+" "+b.sInfoFiltered.replace("_MAX_",j)+b.sInfoPostFix:a.fnRecordsDisplay()==
a.fnRecordsTotal()?b.sInfo.replace("_START_",g).replace("_END_",h).replace("_MAX_",j).replace("_TOTAL_",k)+b.sInfoPostFix:b.sInfo.replace("_START_",g).replace("_END_",h).replace("_MAX_",j).replace("_TOTAL_",k)+" "+b.sInfoFiltered.replace("_MAX_",a.fnFormatNumber(a.fnRecordsTotal()))+b.sInfoPostFix;(b=b.fnInfoCallback)&&(g=b.call(a.oInstance,a,d,c,f,i,g));d=a.aanFeatures.i;if("undefined"!=typeof d){f=0;for(i=d.length;f<i;f++)e(d[f]).html(g)}e(a.nTable).triggerHandler("info.dt")}}});h.defaults={trace:!1,
rowHeight:"auto",serverWait:200,displayBuffer:9,boundaryScale:0.5,loadingIndicator:!1};h.oDefaults=h.defaults;h.version="1.4.3";"function"==typeof e.fn.dataTable&&"function"==typeof e.fn.dataTableExt.fnVersionCheck&&e.fn.dataTableExt.fnVersionCheck("1.10.0")?e.fn.dataTableExt.aoFeatures.push({fnInit:function(a){var b=a.oInit;new h(a,b.scroller||b.oScroller||{})},cFeature:"S",sFeature:"Scroller"}):alert("Warning: Scroller requires DataTables 1.10.0 or greater - www.datatables.net/download");e(j).on("preInit.dt.dtscroller",
function(a,b){if("dt"===a.namespace){var c=b.oInit.scroller,d=m.defaults.scroller;if(c||d)d=e.extend({},c,d),!1!==c&&new h(b,d)}});e.fn.dataTable.Scroller=h;e.fn.DataTable.Scroller=h;var k=e.fn.dataTable.Api;k.register("scroller()",function(){return this});k.register("scroller().rowToPixels()",function(a,b,c){var d=this.context;if(d.length&&d[0].oScroller)return d[0].oScroller.fnRowToPixels(a,b,c)});k.register("scroller().pixelsToRow()",function(a,b,c){var d=this.context;if(d.length&&d[0].oScroller)return d[0].oScroller.fnPixelsToRow(a,
b,c)});k.register("scroller().scrollToRow()",function(a,b){this.iterator("table",function(c){c.oScroller&&c.oScroller.fnScrollToRow(a,b)});return this});k.register("row().scrollTo()",function(a){var b=this;this.iterator("row",function(c,d){if(c.oScroller){var e=b.rows({order:"applied",search:"applied"}).indexes().indexOf(d);c.oScroller.fnScrollToRow(e,a)}});return this});k.register("scroller.measure()",function(a){this.iterator("table",function(b){b.oScroller&&b.oScroller.fnMeasure(a)});return this});
k.register("scroller.page()",function(){var a=this.context;if(a.length&&a[0].oScroller)return a[0].oScroller.fnPageInfo()});return h});


;
/**
 * Copyright (c) 2007-2012 Ariel Flesler - aflesler(at)gmail(dot)com | http://flesler.blogspot.com
 * Dual licensed under MIT and GPL.
 * @author Ariel Flesler
 * @version 1.4.3.1
 */
;(function($){var h=$.scrollTo=function(a,b,c){$(window).scrollTo(a,b,c)};h.defaults={axis:'xy',duration:parseFloat($.fn.jquery)>=1.3?0:1,limit:true};h.window=function(a){return $(window)._scrollable()};$.fn._scrollable=function(){return this.map(function(){var a=this,isWin=!a.nodeName||$.inArray(a.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)return a;var b=(a.contentWindow||a).document||a.ownerDocument||a;return/webkit/i.test(navigator.userAgent)||b.compatMode=='BackCompat'?b.body:b.documentElement})};$.fn.scrollTo=function(e,f,g){if(typeof f=='object'){g=f;f=0}if(typeof g=='function')g={onAfter:g};if(e=='max')e=9e9;g=$.extend({},h.defaults,g);f=f||g.duration;g.queue=g.queue&&g.axis.length>1;if(g.queue)f/=2;g.offset=both(g.offset);g.over=both(g.over);return this._scrollable().each(function(){if(e==null)return;var d=this,$elem=$(d),targ=e,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break}targ=$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)toff=(targ=$(targ)).offset()}$.each(g.axis.split(''),function(i,a){var b=a=='x'?'Left':'Top',pos=b.toLowerCase(),key='scroll'+b,old=d[key],max=h.max(d,a);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(g.margin){attr[key]-=parseInt(targ.css('margin'+b))||0;attr[key]-=parseInt(targ.css('border'+b+'Width'))||0}attr[key]+=g.offset[pos]||0;if(g.over[pos])attr[key]+=targ[a=='x'?'width':'height']()*g.over[pos]}else{var c=targ[pos];attr[key]=c.slice&&c.slice(-1)=='%'?parseFloat(c)/100*max:c}if(g.limit&&/^\d+$/.test(attr[key]))attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&g.queue){if(old!=attr[key])animate(g.onAfterFirst);delete attr[key]}});animate(g.onAfter);function animate(a){$elem.animate(attr,f,g.easing,a&&function(){a.call(this,e,g)})}}).end()};h.max=function(a,b){var c=b=='x'?'Width':'Height',scroll='scroll'+c;if(!$(a).is('html,body'))return a[scroll]-$(a)[c.toLowerCase()]();var d='client'+c,html=a.ownerDocument.documentElement,body=a.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[d],body[d])};function both(a){return typeof a=='object'?a:{top:a,left:a}}})(jQuery);;
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery)
;
/*
 * jQuery UI Touch Punch 0.2.2
 *
 * Copyright 2011, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
(function(b){b.support.touch="ontouchend" in document;if(!b.support.touch){return;}var c=b.ui.mouse.prototype,e=c._mouseInit,a;function d(g,h){if(g.originalEvent.touches.length>1){return;}g.preventDefault();var i=g.originalEvent.changedTouches[0],f=document.createEvent("MouseEvents");f.initMouseEvent(h,true,true,window,1,i.screenX,i.screenY,i.clientX,i.clientY,false,false,false,false,0,null);g.target.dispatchEvent(f);}c._touchStart=function(g){var f=this;if(a||!f._mouseCapture(g.originalEvent.changedTouches[0])){return;}a=true;f._touchMoved=false;d(g,"mouseover");d(g,"mousemove");d(g,"mousedown");};c._touchMove=function(f){if(!a){return;}this._touchMoved=true;d(f,"mousemove");};c._touchEnd=function(f){if(!a){return;}d(f,"mouseup");d(f,"mouseout");if(!this._touchMoved){d(f,"click");}a=false;};c._mouseInit=function(){var f=this;f.element.bind("touchstart",b.proxy(f,"_touchStart")).bind("touchmove",b.proxy(f,"_touchMove")).bind("touchend",b.proxy(f,"_touchEnd"));e.call(f);};})(jQuery);;
(function( $ ) {
	/**
	 * @attribute destroyed
	 * @parent specialevents
	 * @download  http://jmvcsite.heroku.com/pluginify?plugins[]=jquery/dom/destroyed/destroyed.js
	 * @test jquery/event/destroyed/qunit.html
	 * Provides a destroyed event on an element.
	 * <p>
	 * The destroyed event is called when the element
	 * is removed as a result of jQuery DOM manipulators like remove, html,
	 * replaceWith, etc. Destroyed events do not bubble, so make sure you don't use live or delegate with destroyed
	 * events.
	 * </p>
	 * <h2>Quick Example</h2>
	 * @codestart
	 * $(".foo").bind("destroyed", function(){
	 *    //clean up code
	 * })
	 * @codeend
	 * <h2>Quick Demo</h2>
	 * @demo jquery/event/destroyed/destroyed.html 
	 * <h2>More Involved Demo</h2>
	 * @demo jquery/event/destroyed/destroyed_menu.html 
	 */

	var oldClean = jQuery.cleanData;

	$.cleanData = function( elems ) {
		for ( var i = 0, elem;
		(elem = elems[i]) !== undefined; i++ ) {
			$(elem).triggerHandler("destroyed");
			//$.event.remove( elem, 'destroyed' );
		}
		oldClean(elems);
	};

})(jQuery);;
/*
* Placeholder plugin for jQuery
* ---
* Copyright 2010, Daniel Stocks (http://webcloud.se)
* Released under the MIT, BSD, and GPL Licenses.
*/

(function(b){function d(a){this.input=a;a.attr("type")=="password"&&this.handlePassword();b(a[0].form).submit(function(){if(a.hasClass("placeholder")&&a[0].value==a.attr("placeholder"))a[0].value=""})}d.prototype={show:function(a){if(this.input[0].value===""||a&&this.valueIsPlaceholder()){if(this.isPassword)try{this.input[0].setAttribute("type","text")}catch(b){this.input.before(this.fakePassword.show()).hide()}this.input.addClass("placeholder");this.input[0].value=this.input.attr("placeholder")}},
hide:function(){if(this.valueIsPlaceholder()&&this.input.hasClass("placeholder")&&(this.input.removeClass("placeholder"),this.input[0].value="",this.isPassword)){try{this.input[0].setAttribute("type","password")}catch(a){}this.input.show();this.input[0].focus()}},valueIsPlaceholder:function(){return this.input[0].value==this.input.attr("placeholder")},handlePassword:function(){var a=this.input;a.attr("realType","password");this.isPassword=!0;if(b.browser.msie&&a[0].outerHTML){var c=b(a[0].outerHTML.replace(/type=(['"])?password\1/gi,
"type=$1text$1"));this.fakePassword=c.val(a.attr("placeholder")).addClass("placeholder").focus(function(){a.trigger("focus");b(this).hide()});b(a[0].form).submit(function(){c.remove();a.show()})}}};var e=!!("placeholder"in document.createElement("input"));b.fn.placeholder=function(){return e?this:this.each(function(){var a=b(this),c=new d(a);c.show(!0);a.focus(function(){c.hide()});a.blur(function(){c.show(!1)});b.browser.msie&&(b(window).load(function(){a.val()&&a.removeClass("placeholder");c.show(!0)}),
a.focus(function(){if(this.value==""){var a=this.createTextRange();a.collapse(!0);a.moveStart("character",0);a.select()}}))})}})(jQuery);
;
/*
Copyright (c) 2011 Jerome Etienne, http://jetienne.com

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function(r){r.fn.qrcode=function(h){var s;function u(a){this.mode=s;this.data=a}function o(a,c){this.typeNumber=a;this.errorCorrectLevel=c;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}function q(a,c){if(void 0==a.length)throw Error(a.length+"/"+c);for(var d=0;d<a.length&&0==a[d];)d++;this.num=Array(a.length-d+c);for(var b=0;b<a.length-d;b++)this.num[b]=a[b+d]}function p(a,c){this.totalCount=a;this.dataCount=c}function t(){this.buffer=[];this.length=0}u.prototype={getLength:function(){return this.data.length},
write:function(a){for(var c=0;c<this.data.length;c++)a.put(this.data.charCodeAt(c),8)}};o.prototype={addData:function(a){this.dataList.push(new u(a));this.dataCache=null},isDark:function(a,c){if(0>a||this.moduleCount<=a||0>c||this.moduleCount<=c)throw Error(a+","+c);return this.modules[a][c]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>this.typeNumber){for(var a=1,a=1;40>a;a++){for(var c=p.getRSBlocks(a,this.errorCorrectLevel),d=new t,b=0,e=0;e<c.length;e++)b+=c[e].dataCount;
for(e=0;e<this.dataList.length;e++)c=this.dataList[e],d.put(c.mode,4),d.put(c.getLength(),j.getLengthInBits(c.mode,a)),c.write(d);if(d.getLengthInBits()<=8*b)break}this.typeNumber=a}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17;this.modules=Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=Array(this.moduleCount);for(var b=0;b<this.moduleCount;b++)this.modules[d][b]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-
7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(a,c);7<=this.typeNumber&&this.setupTypeNumber(a);null==this.dataCache&&(this.dataCache=o.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,c){for(var d=-1;7>=d;d++)if(!(-1>=a+d||this.moduleCount<=a+d))for(var b=-1;7>=b;b++)-1>=c+b||this.moduleCount<=c+b||(this.modules[a+d][c+b]=
0<=d&&6>=d&&(0==b||6==b)||0<=b&&6>=b&&(0==d||6==d)||2<=d&&4>=d&&2<=b&&4>=b?!0:!1)},getBestMaskPattern:function(){for(var a=0,c=0,d=0;8>d;d++){this.makeImpl(!0,d);var b=j.getLostPoint(this);if(0==d||a>b)a=b,c=d}return c},createMovieClip:function(a,c,d){a=a.createEmptyMovieClip(c,d);this.make();for(c=0;c<this.modules.length;c++)for(var d=1*c,b=0;b<this.modules[c].length;b++){var e=1*b;this.modules[c][b]&&(a.beginFill(0,100),a.moveTo(e,d),a.lineTo(e+1,d),a.lineTo(e+1,d+1),a.lineTo(e,d+1),a.endFill())}return a},
setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(a=8;a<this.moduleCount-8;a++)null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},setupPositionAdjustPattern:function(){for(var a=j.getPatternPosition(this.typeNumber),c=0;c<a.length;c++)for(var d=0;d<a.length;d++){var b=a[c],e=a[d];if(null==this.modules[b][e])for(var f=-2;2>=f;f++)for(var i=-2;2>=i;i++)this.modules[b+f][e+i]=-2==f||2==f||-2==i||2==i||0==f&&0==i?!0:!1}},setupTypeNumber:function(a){for(var c=
j.getBCHTypeNumber(this.typeNumber),d=0;18>d;d++){var b=!a&&1==(c>>d&1);this.modules[Math.floor(d/3)][d%3+this.moduleCount-8-3]=b}for(d=0;18>d;d++)b=!a&&1==(c>>d&1),this.modules[d%3+this.moduleCount-8-3][Math.floor(d/3)]=b},setupTypeInfo:function(a,c){for(var d=j.getBCHTypeInfo(this.errorCorrectLevel<<3|c),b=0;15>b;b++){var e=!a&&1==(d>>b&1);6>b?this.modules[b][8]=e:8>b?this.modules[b+1][8]=e:this.modules[this.moduleCount-15+b][8]=e}for(b=0;15>b;b++)e=!a&&1==(d>>b&1),8>b?this.modules[8][this.moduleCount-
b-1]=e:9>b?this.modules[8][15-b-1+1]=e:this.modules[8][15-b-1]=e;this.modules[this.moduleCount-8][8]=!a},mapData:function(a,c){for(var d=-1,b=this.moduleCount-1,e=7,f=0,i=this.moduleCount-1;0<i;i-=2)for(6==i&&i--;;){for(var g=0;2>g;g++)if(null==this.modules[b][i-g]){var n=!1;f<a.length&&(n=1==(a[f]>>>e&1));j.getMask(c,b,i-g)&&(n=!n);this.modules[b][i-g]=n;e--; -1==e&&(f++,e=7)}b+=d;if(0>b||this.moduleCount<=b){b-=d;d=-d;break}}}};o.PAD0=236;o.PAD1=17;o.createData=function(a,c,d){for(var c=p.getRSBlocks(a,
c),b=new t,e=0;e<d.length;e++){var f=d[e];b.put(f.mode,4);b.put(f.getLength(),j.getLengthInBits(f.mode,a));f.write(b)}for(e=a=0;e<c.length;e++)a+=c[e].dataCount;if(b.getLengthInBits()>8*a)throw Error("code length overflow. ("+b.getLengthInBits()+">"+8*a+")");for(b.getLengthInBits()+4<=8*a&&b.put(0,4);0!=b.getLengthInBits()%8;)b.putBit(!1);for(;!(b.getLengthInBits()>=8*a);){b.put(o.PAD0,8);if(b.getLengthInBits()>=8*a)break;b.put(o.PAD1,8)}return o.createBytes(b,c)};o.createBytes=function(a,c){for(var d=
0,b=0,e=0,f=Array(c.length),i=Array(c.length),g=0;g<c.length;g++){var n=c[g].dataCount,h=c[g].totalCount-n,b=Math.max(b,n),e=Math.max(e,h);f[g]=Array(n);for(var k=0;k<f[g].length;k++)f[g][k]=255&a.buffer[k+d];d+=n;k=j.getErrorCorrectPolynomial(h);n=(new q(f[g],k.getLength()-1)).mod(k);i[g]=Array(k.getLength()-1);for(k=0;k<i[g].length;k++)h=k+n.getLength()-i[g].length,i[g][k]=0<=h?n.get(h):0}for(k=g=0;k<c.length;k++)g+=c[k].totalCount;d=Array(g);for(k=n=0;k<b;k++)for(g=0;g<c.length;g++)k<f[g].length&&
(d[n++]=f[g][k]);for(k=0;k<e;k++)for(g=0;g<c.length;g++)k<i[g].length&&(d[n++]=i[g][k]);return d};s=4;for(var j={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,
78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var c=a<<10;0<=j.getBCHDigit(c)-j.getBCHDigit(j.G15);)c^=j.G15<<j.getBCHDigit(c)-j.getBCHDigit(j.G15);return(a<<10|c)^j.G15_MASK},getBCHTypeNumber:function(a){for(var c=a<<12;0<=j.getBCHDigit(c)-
j.getBCHDigit(j.G18);)c^=j.G18<<j.getBCHDigit(c)-j.getBCHDigit(j.G18);return a<<12|c},getBCHDigit:function(a){for(var c=0;0!=a;)c++,a>>>=1;return c},getPatternPosition:function(a){return j.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,c,d){switch(a){case 0:return 0==(c+d)%2;case 1:return 0==c%2;case 2:return 0==d%3;case 3:return 0==(c+d)%3;case 4:return 0==(Math.floor(c/2)+Math.floor(d/3))%2;case 5:return 0==c*d%2+c*d%3;case 6:return 0==(c*d%2+c*d%3)%2;case 7:return 0==(c*d%3+(c+d)%2)%2;default:throw Error("bad maskPattern:"+
a);}},getErrorCorrectPolynomial:function(a){for(var c=new q([1],0),d=0;d<a;d++)c=c.multiply(new q([1,l.gexp(d)],0));return c},getLengthInBits:function(a,c){if(1<=c&&10>c)switch(a){case 1:return 10;case 2:return 9;case s:return 8;case 8:return 8;default:throw Error("mode:"+a);}else if(27>c)switch(a){case 1:return 12;case 2:return 11;case s:return 16;case 8:return 10;default:throw Error("mode:"+a);}else if(41>c)switch(a){case 1:return 14;case 2:return 13;case s:return 16;case 8:return 12;default:throw Error("mode:"+
a);}else throw Error("type:"+c);},getLostPoint:function(a){for(var c=a.getModuleCount(),d=0,b=0;b<c;b++)for(var e=0;e<c;e++){for(var f=0,i=a.isDark(b,e),g=-1;1>=g;g++)if(!(0>b+g||c<=b+g))for(var h=-1;1>=h;h++)0>e+h||c<=e+h||0==g&&0==h||i==a.isDark(b+g,e+h)&&f++;5<f&&(d+=3+f-5)}for(b=0;b<c-1;b++)for(e=0;e<c-1;e++)if(f=0,a.isDark(b,e)&&f++,a.isDark(b+1,e)&&f++,a.isDark(b,e+1)&&f++,a.isDark(b+1,e+1)&&f++,0==f||4==f)d+=3;for(b=0;b<c;b++)for(e=0;e<c-6;e++)a.isDark(b,e)&&!a.isDark(b,e+1)&&a.isDark(b,e+
2)&&a.isDark(b,e+3)&&a.isDark(b,e+4)&&!a.isDark(b,e+5)&&a.isDark(b,e+6)&&(d+=40);for(e=0;e<c;e++)for(b=0;b<c-6;b++)a.isDark(b,e)&&!a.isDark(b+1,e)&&a.isDark(b+2,e)&&a.isDark(b+3,e)&&a.isDark(b+4,e)&&!a.isDark(b+5,e)&&a.isDark(b+6,e)&&(d+=40);for(e=f=0;e<c;e++)for(b=0;b<c;b++)a.isDark(b,e)&&f++;a=Math.abs(100*f/c/c-50)/5;return d+10*a}},l={glog:function(a){if(1>a)throw Error("glog("+a+")");return l.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;256<=a;)a-=255;return l.EXP_TABLE[a]},EXP_TABLE:Array(256),
LOG_TABLE:Array(256)},m=0;8>m;m++)l.EXP_TABLE[m]=1<<m;for(m=8;256>m;m++)l.EXP_TABLE[m]=l.EXP_TABLE[m-4]^l.EXP_TABLE[m-5]^l.EXP_TABLE[m-6]^l.EXP_TABLE[m-8];for(m=0;255>m;m++)l.LOG_TABLE[l.EXP_TABLE[m]]=m;q.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var c=Array(this.getLength()+a.getLength()-1),d=0;d<this.getLength();d++)for(var b=0;b<a.getLength();b++)c[d+b]^=l.gexp(l.glog(this.get(d))+l.glog(a.get(b)));return new q(c,0)},mod:function(a){if(0>
this.getLength()-a.getLength())return this;for(var c=l.glog(this.get(0))-l.glog(a.get(0)),d=Array(this.getLength()),b=0;b<this.getLength();b++)d[b]=this.get(b);for(b=0;b<a.getLength();b++)d[b]^=l.gexp(l.glog(a.get(b))+c);return(new q(d,0)).mod(a)}};p.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],
[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,
116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,
43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,
3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,
55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,
45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];p.getRSBlocks=function(a,c){var d=p.getRsBlockTable(a,c);if(void 0==d)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+c);for(var b=d.length/3,e=[],f=0;f<b;f++)for(var h=d[3*f+0],g=d[3*f+1],j=d[3*f+2],l=0;l<h;l++)e.push(new p(g,j));return e};p.getRsBlockTable=function(a,c){switch(c){case 1:return p.RS_BLOCK_TABLE[4*(a-1)+0];case 0:return p.RS_BLOCK_TABLE[4*(a-1)+1];case 3:return p.RS_BLOCK_TABLE[4*
(a-1)+2];case 2:return p.RS_BLOCK_TABLE[4*(a-1)+3]}};t.prototype={get:function(a){return 1==(this.buffer[Math.floor(a/8)]>>>7-a%8&1)},put:function(a,c){for(var d=0;d<c;d++)this.putBit(1==(a>>>c-d-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var c=Math.floor(this.length/8);this.buffer.length<=c&&this.buffer.push(0);a&&(this.buffer[c]|=128>>>this.length%8);this.length++}};"string"===typeof h&&(h={text:h});h=r.extend({},{render:"canvas",width:256,height:256,typeNumber:-1,
correctLevel:2,background:"#ffffff",foreground:"#000000"},h);return this.each(function(){var a;if("canvas"==h.render){a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();var c=document.createElement("canvas");c.width=h.width;c.height=h.height;for(var d=c.getContext("2d"),b=h.width/a.getModuleCount(),e=h.height/a.getModuleCount(),f=0;f<a.getModuleCount();f++)for(var i=0;i<a.getModuleCount();i++){d.fillStyle=a.isDark(f,i)?h.foreground:h.background;var g=Math.ceil((i+1)*b)-Math.floor(i*b),
j=Math.ceil((f+1)*b)-Math.floor(f*b);d.fillRect(Math.round(i*b),Math.round(f*e),g,j)}}else{a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();c=r("<table></table>").css("width",h.width+"px").css("height",h.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",h.background);d=h.width/a.getModuleCount();b=h.height/a.getModuleCount();for(e=0;e<a.getModuleCount();e++){f=r("<tr></tr>").css("height",b+"px").appendTo(c);for(i=0;i<a.getModuleCount();i++)r("<td></td>").css("width",
d+"px").css("background-color",a.isDark(e,i)?h.foreground:h.background).appendTo(f)}}a=c;jQuery(a).appendTo(this)})}})(jQuery);;

/* _Prtg.Api.js */
(function($, window, document, undefined) {
	var privatePrefix = "_";
	var api = {
    "acknowledgeAlarm": {
        "ajax": {},
        "optional": [
            "ackmsg",
            "duration"
        ],
        "required": [
            "id"
        ],
        "url": "/api/acknowledgealarm.htm"
    },
    "acknowledgeToDo": {
        "ajax": {},
        "optional": [
            "id"
        ],
        "url": "/api/acktodo.htm"
    },
    "addGroup": {
        "optional": [
            "windowsconnection",
            "windowslogindomain_",
            "windowsloginusername_",
            "windowsloginpassword_",
            "vmwareconnection",
            "esxuser_",
            "esxpassword_"
        ],
        "required": [
            "id",
            "name_"
        ],
        "url": "/api/addgroup.htm"
    },
    "addLibrary": {
        "ajax": {},
        "optional": [
            "id='new'",
            "target='root'",
            "accessrights_='1'",
            "objecttype='library'"
        ],
        "required": [
            "name_"
        ],
        "url": "/editsettings"
    },
    "addRecommendedSensors": {
        "required": [
            "id",
            "createid"
        ],
        "url": "/api/recommendedconvert.htm"
    },
    "addReport": {
        "ajax": {},
        "optional": [
            "timezone_='W. Europe Standard Time|(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna'",
            "sensorlist_='1'",
            "scheduletype_='0'",
            "specifichour_='0'",
            "dayweek_='1'",
            "daymonth_='1'",
            "maildisk_='1'",
            "emailgroup_='-1'",
            "usecompression_='0'",
            "dataperiod_='1'",
            "reporttype_='1'",
            "reportday_='0'",
            "reportweek_='1'",
            "reportmonth_='1'",
            "reportyear_='1'",
            "schedule_='-1'",
            "percentileshow_='0'",
            "percentile_='95'",
            "percentileaverage_='300'",
            "percentilemode_='1'",
            "accessrights_='1'",
            "accessrights_201='0'",
            "objecttype='report'",
            "id='new'"
        ],
        "required": [
            "name_",
            "template_",
            "ownerid_"
        ],
        "url": "/editsettings"
    },
    "addSchedule": {
         "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "description": "Add Schedule to PRTG",
        "optional": [
            "id='new'",
            "objecttype='schedule'",
            "accessrights_=1",
            "name_",
            "comments_"
        ],
        "required": [
        ],
        "url": "/editsettings"
    },
    "addUser": {
        "ajax": {},
        "description": "Add User to PRTG",
        "optional": [
            "id='new'",
            "objecttype='user'",
            "password_=''",
            "passwordradio='1'",
            "primarygroup_='201'"
        ],
        "required": [
            "login_",
            "name_",
            "password1",
            "password2",
            "usertype_",
            "email_"
        ],
        "url": "/editsettings"
    },
    "addUsers": {
        "ajax": {},
        "description": "Add Users by mail to PRTG",
        "required": [
            "id",
            "users"
        ],
        "url": "/api/addusers.htm"
    },
    "addMap": {
         "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "description": "Add a map to PRTG",
         "optional": [
            "width_",
             "height_",
             "name_"
        ],
        "required": [
        ],
        "url": "/addmap2.htm"
    },
    "addUserGroup": {
        "ajax": {},
        "optional": [
            "id='new'",
            "isadmingroup_='0'",
            "isadgroup_='0'",
            "adusertype_='0'",
            "allowedsensorsmode_='0'",
            "ticketmode_='1'",
            "objecttype='usergroup'",
            "adgroup_=''"
        ],
        "required": [
            "name_"
        ],
        "url": "/editsettings"
    },
     "getChartLegend": {
        "ajax": {},
        "required": [
            "id"
        ],
        "url": "/api/chartlegend.json"
    },
    "changeDNSName": {
        "_comment": "added by Enrico Weigler for POD API Tests",
        "ajax": {},
        "url": "/editsettings",
        "required": [
        "dnsname_"
        ],
        "optional": [
        "id='810'"
        ]
    },
    "checkNow": {
        "ajax": {},
        "required": [
            "id"
        ],
        "url": "/api/scannow.htm"
    },
    "clearCaches": {
        "ajax": {},
        "url": "/api/clearcache.htm"
    },
    "createDatabaseSnapshot": {
        "ajax": {},
        "url": "/api/savenow.htm"
    },
    "deleteObj": {
        "ajax": {},
        "optional": [
            "approve=1"
        ],
        "required": [
            "id"
        ],
        "url": "/api/deleteobject.htm"
    },
    "deleteSubObj": {
        "ajax": {},
        "required": [
            "id",
            "subid"
        ],
        "url": "/api/deletesubobject.htm"
    },
    "discover": {
        "ajax": {},
        "optional": [
            "template"
        ],
        "required": [
            "id"
        ],
        "url": "/api/discovernow.htm"
    },
    "doLogin": {
        "_comment": "Added by AS",
        "ajax": {},
        "required": [
            "username",
            "password"
        ],
        "url": "/checklogin.htm"
    },
	"addComment": {
        "_comment": "Added by AS",
        "ajax": {},
        "required": [
            "id",
            "comments_"
        ],
        "url": "/editsettings"
    },
    "duplicateObj": {
        "ajax": {},
        "required": [
            "id"
        ],
        "url": "/api/duplicateobject.htm"
    },
    "editSetup": {
        "_comment": "Added by AS",
        "ajax": {},
        "optional": [
            "addomainname_=''",
            "addomainuser_=''",
            "addomainpass_=''",
            "adaccesstype_=''"
        ],
        "required": [
            "id"
        ],
        "url": "/editsettings"
    },
    "addProxySettingsToObject": {
        "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "optional": [
            "proxy_",
            "proxyport_",
            "proxyuser_",
            "proxypassword_"
        ],
        "required": [
            "id"
        ],
        "url": "/editsettings"
},
    "addProxyToSystemsetup": {
        "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "optional": [
            "useproxy_='1'",
            "proxyserver_=''",
            "proxyport_='8080'",
            "useproxycredentials_='1'",
            "proxyuser_=''",
            "proxypass_=''",
            "id='810'"
        ],
        "required": [
        ],
        "url": "/editsettings"
},
    "addSmtpToNotificationDelivery": {
        "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "optional": [
            "smtpconfig_",
            "smtpfrom_",
            "smtpfromname_",
            "smtpheloident_",
            "smtpserver_",
            "smtpport_='25'",
            "smtpauthtype_",
            "smtpusername_",
            "smtppassword_",
            "smtpusetls_='1'",
            "smtpssl_='sslvSSLv23'",
            "smtpserver2_",
            "smtpport2_='25'",
            "smtpauthtype2_='1'",
            "smtpusername2_",
            "smtppassword2_",
            "smtpusetls2_='1'",
            "smtpssl2_='sslvSSLv23'"
        ],
        "required": [
            "id"
        ],
        "url": "/editsettings"
    },
    "addSmsToNotificationDelivery": {
        "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "optional": [
            "smsselect_=''",
            "smsservice_=''",
            "smscustom_=''",
            "smscustomsni_=''",
            "smscustomsniname_=''",
            "smsencoding_=''",
            "smsusername_=''",
            "smspassword_=''",
            "smsappid_=''",
            "smsmaxlength_=''"
        ],
        "required": [
            "id"
        ],
        "url": "/editsettings"
    },
    "addDbSettingsToObject": {
        "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "optional": [
            "dbauth_",
            "dbuser_",
            "dbpassword_"
        ],
        "required": [
            "id"
        ],
        "url": "/editsettings"
},
    "addAwsskToObject": {
        "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "optional": [
            "awsak_",
            "awssk_"
        ],
        "required": [
            "id"
        ],
        "url": "/editsettings"
},
    "addSnmpSettingsToObject": {
        "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "optional": [
            "snmpversiongroup",
            "snmpversion_",
            "snmpcommv1_",
            "snmpcommv2_",
            "snmpauthmode_",
            "snmpuser_",
            "snmpauthpass_",
            "snmpencmode_",
            "snmpencpass_",
            "snmpcontext_",
            "snmpport_",
            "snmptimeout_"
        ],
        "required": [
            "id"
        ],
        "url": "/editsettings"
},
    "addVmwareSettingsToObject": {
        "_comment": "Added by AS for encryption testing",
        "required": [
            "id",
            "vmwareconnection",
            "esxuser_",
            "esxpassword_"
        ],
        "url": "/editsettings"
},
     "addWindowsloginSettingsToObject": {
        "_comment": "Added by AS for encryption testing",
        "required": [
            "id",
            "windowsconnection",
            "windowslogindomain_",
            "windowsloginusername_",
            "windowsloginpassword_"
        ],
        "url": "/editsettings"
},
    "addLinuxLoginSettingsToObject": {
        "_comment": "Added by AS for encryption testing",
        "ajax": {},
        "optional": [
            "linuxconnection='1'",
            "linuxloginusername_",
            "linuxloginmode_",
            "linuxloginpassword_",
            "privatekey_",
            "wbemprotocol_='https'",
            "wbemportmode_='0'",
            "wbemport_='5989'",
            "sshport_='22'",
            "sshelevatedrights_",
            "elevationnamesudo_",
            "elevationnamesu_",
            "elevationpass_",
            "sshversion_devicegroup_='2'"
        ],
        "required": [
            "id"
        ],
        "url": "/editsettings"
},
    "EditUserPassword":
    {
        "_comment": "added by Enrico Weigler for POD API Tests",
        "ajax": {},
        "required": [
            "id",
            "oldpassword",
            "password1",
            "password2"
        ],
        "optional": [
            "passwordradio='1'",
            "password_=''"
        ],
        "url": "/editsettings"
    },

    "rename_notification": {
        "_comment": "Added by AS",
        "ajax": {},
        "required": [
            "id",
            "name_"
        ],
        "url": "/editsettings"
    },

    "favorite": {
        "ajax": {},
        "required": [
            "id",
            "action"
        ],
        "url": "/api/fave.htm"
    },
    "findDuplicates": {
        "ajax": {},
        "required": [
            "id"
        ],
        "url": "/api/findduplicates.htm"
    },
    "fold": {
        "ajax": {},
        "required": [
            "id",
            "fold"
        ],
        "url": "/api/foldobject.htm"
    },
    "getObjectProperty": {
        "optional": [
            "show"
        ],
        "required": [
            "id",
            "name"
        ],
        "url": "/api/getobjectproperty.htm"
    },
    "getObjectPropertySensorChannel": {
        "optional": [
            "show"
        ],
        "required": [
            "id",
            "subtype",
            "subid",
            "name"
        ],
        "url": "/api/getobjectproperty.htm"
    },
    "getObjectStatus": {
        "_comment": "Added by AS",
        "ajax": {},
        "required": [
            "id",
            "objecttype",
            "name"
        ],
        "url": "/api/getobjectstatus.htm"
    },
    "getObjectStatusPlain": {
        "_comment": "Added by AS",
        "ajax": {},
        "optional": [
            "objecttype"
        ],
        "required": [
            "id",
            "name"
        ],
        "url": "/api/getobjectstatus.htm"
    },
    "getPasshash": {
        "_comment": "Added by AS",
        "ajax": {},
        "optional": [
            "username",
            "password"
        ],
        "url": "/api/getpasshash.htm"
    },
    "getStatus": {
        "_comment": "Added by AS",
        "ajax": {},
        "required": [
            "id",
            "username",
            "passhash",
            "password"
        ],
        "url": "/api/getstatus.htm"
    },
    "initialMailAcknowledge": {
        "url": "/api/initialmailacknowledge.htm"
    },
    "loadLookUp": {
        "ajax": {},
        "url": "/api/loadlookups.htm"
    },
    "logError": {
        "ajax": {},
        "required": [
            "msg"
        ],
        "url": "/api/logajax.htm"
    },
    "maintenanceWindow": {
        "ajax": {},
        "optional": [
            "scheduledependency=0",
            "maintenable_=1"
        ],
        "required": [
            "id",
            "maintstart_",
            "maintend_"
        ],
        "url": "/editsettings"
    },
    "maildelivery":{
        "ajax": {},
        "required": [
            "address",
            "subject"
        ],
        "url": "api/maildelivery.htm"
    },
     "mapShow": {
        "_comment": "Added by AS",
        "ajax": {},
        "required": [
            "id"
        ],
        "url": "/mapshow.htm"
    },
    "move": {
        "ajax": {},
        "required": [
            "id",
            "targetid"
        ],
        "url": "/api/moveobjectsimple.htm"
    },
    "pause": {
        "ajax": {},
        "description": "",
        "optional": [
            "action=0",
            "pausemsg"
        ],
        "required": [
            "id"
        ],
        "url": "/api/pause.htm"
    },
    "pausefor": {
        "ajax": {},
        "optional": [
            "pausemsg"
        ],
        "required": [
            "id",
            "duration"
        ],
        "url": "/api/pauseobjectfor.htm"
    },
    "position": {
        "ajax": {},
        "required": [
            "id",
            "newpos"
        ],
        "url": "/api/setposition.htm"
    },
    "primaryChannel": {
        "ajax": {},
        "required": [
            "id",
            "primarychannel_"
        ],
        "url": "/editsettings"
    },
    "priority": {
        "ajax": {},
        "required": [
            "id",
            "prio"
        ],
        "url": "/api/setpriority.htm"
    },
    "recalcCache": {
        "ajax": {},
        "optional": [
            "id"
        ],
        "url": "/api/recalccache.htm"
    },
    "recommendNow": {
        "required": [
            "id"
        ],
        "url": "/api/recommendnow.htm"
    },
    "redisCoverWithCredentials": {
        "ajax": {},
        "optional": [
            "nodeid"
        ],
        "url": "/api/rediscoverwithcredentials.htm"
    },
    "reloadFileLists": {
        "ajax": {},
        "optional": [
            "id"
        ],
        "url": "/api/reloadfilelists.htm"
    },
    "restartProbes": {
        "ajax": {},
        "optional": [
            "id"
        ],
        "url": "/api/restartprobes.htm"
    },
    "restartServer": {
        "ajax": {},
        "optional": [
            "id"
        ],
        "url": "/api/restartserver.htm"
    },
    "resume": {
        "ajax": {},
        "optional": [
            "action=1"
        ],
        "required": [
            "id"
        ],
        "url": "/api/pause.htm"
    },
    "setClusterNodeState": {
        "ajax": {},
        "optional": [
            "type='setstatus'"
        ],
        "required": [
            "clid",
            "state"
        ],
        "url": "/api/setclusterproperty.htm"
    },
    "setLocation": {
        "optional": [
            "location",
            "lonlat"
        ],
        "required": [
            "id"
        ],
        "url": "/api/setlonlat.htm"
    },
    "setObjectProperty": {
        "required": [
            "id",
            "name",
            "value"
        ],
        "url": "/api/setobjectproperty.htm"
    },
    "setObjectPropertySensorChannel": {
        "required": [
            "id",
            "subtype",
            "subid",
            "name",
            "value"
        ],
        "url": "/api/setobjectproperty.htm"
    },
    "setProbeState": {
        "ajax": {},
        "optional": [
            "action='deny'"
        ],
        "required": [
            "id"
        ],
        "url": "/api/probestate.htm"
    },
    "setShowHelp": {
        "required": [
            "action",
            "page"
        ],
        "url": "/api/setshowhelpstatus.htm"
    },
    "settings": {
        "url": "/editsettings"
    },
    "simulateError": {
        "ajax": {},
        "required": [
            "id",
            "action"
        ],
        "url": "/api/simulate.htm"
    },
    "smsdelivery": {
        "ajax": {},
        "required": [
            "number",
            "message"
        ],
        "url": "api/smsdelivery.htm"
    },
    "sort": {
        "ajax": {},
        "required": [
            "id"
        ],
        "url": "/api/sortsubobjects.htm"
    },
    "startActivation": {
        "ajax": {},
        "url": "/api/allowactivation.htm"
    },
    "status": {
        "url": "/api/status.json"
    },
    "sysinfo": {
        "ajax": {},
        "optional": [],
        "required": [
            "id",
            "kind"
        ],
        "url": "/api/sysinfo.json"
    },
    "sysinfoCheckNow": {
        "ajax": {},
        "optional": [],
        "required": [
            "id",
            "kind"
        ],
        "url": "/api/sysinfochecknow.json"
    },
    "tctAction": {
        "optional": [
            "action",
            "page",
            "eventtype",
            "key",
            "data"
        ],
        "url": "/api/tctAction.htm"
    },
    "testNotification": {
        "ajax": {},
        "required": [
            "id"
        ],
        "url": "/api/notificationtest.htm"
    },
    "ticketAdd": {
        "required": [
            "id"
        ],
        "url": "/api/addticket.htm"
    },
    "ticketAssign": {
        "required": [
            "id",
            "assigned",
            "content"
        ],
        "url": "/api/assignticket.htm"
    },
    "ticketClose": {
        "required": [
            "id",
            "content"
        ],
        "url": "/api/closeticket.htm"
    },
    "ticketEdit": {
        "optional": [
            "subject",
            "assigned",
            "priority"
        ],
        "required": [
            "id",
            "content"
        ],
        "url": "/api/editticket.htm"
    },
    "ticketPriority": {
        "required": [
            "id",
            "priority"
        ],
        "url": "/api/setticketpriority.htm"
    },
    "ticketReopen": {
        "required": [
            "id",
            "assigned",
            "content"
        ],
        "url": "/api/addticket.htm"
    },
    "ticketResolve": {
        "required": [
            "id",
            "content"
        ],
        "url": "/api/resolveticket.htm"
    },
    "ticketStatus": {
        "required": [
            "id",
            "status"
        ],
        "url": "/api/editticket.htm"
    },
    "writeCoreStatus": {
        "ajax": {},
        "url": "/api/writecorestatus.htm"
    },
    "writeProbeState": {
        "ajax": {},
        "url": "/api/writeprobestatus.htm"
    },
    "reconfigureLogging":{
        "ajax": {},
        "url": "/api/reconfigurelogging.htm"        
    }
};

	function createArgList(req, opt) {
		var result = Array.isArray(req) ? req.slice(0) : [];

    Array.isArray(opt) && opt.forEach(function(value) {
      var values = value.split('=');
      result.push(privatePrefix + values[0]);
    });

    result.push('_ajaxOptions');

    return result.join(',');
	}

	function createDataObjString(reqArgs, optArgs) {
		var result = '';

    Array.isArray(reqArgs) && reqArgs.forEach(function(value) {
      if(result !== '') result += ',';
      result += '"' +  value + '": ' + value;
    });

    Array.isArray(optArgs) && optArgs.forEach(function(value) {
      var values = value.split('=');
      var defaultvalue =  privatePrefix + values[0] + (values.length > 1 ? ' || ' + values[1] : '');
      if(result !== '') result += ',';
      result += '"' + values[0] + '": ' + defaultvalue;
    });
		return '{' + result + '}';
	}

	function createDefaultCall(callObj) {
		return new Function(createArgList(callObj.required, callObj.optional), 'return _Prtg.api.send("' + callObj.url + '", ' + createDataObjString(callObj.required, callObj.optional) + ', _ajaxOptions);');
	}

	function callsFactory() {
		var calls = {};

		Object.keys(api).forEach(function(key) {
      var apicall = api[key];
      if(!!apicall.url) calls[key] = createDefaultCall(api[key]);
    });

    return calls;
	}

  _Prtg = !!_Prtg ? _Prtg : {};
	_Prtg.api = callsFactory();
	_Prtg.api.send = function apiCall(url, data, options) {
		var ajax = $.extend(true, {
				url: url,
				data: data,
				method: 'POST',
        beforeSend: function(jqXHR){
          jqXHR.ignoreManager = true;
        }
			},
			options || {});
		return $.ajax(ajax);
	};

})(jQuery, window, document);

;
var loadingicon = '<div class="loadspinner"></div>';
_Prtg.objectTools = {
  update: function update(elm) {
    var $elm = $(elm || this);
    var plugin = ($elm.attr('callerid') !== undefined
      ? $('#' + $elm.attr('callerid'))
      : ($elm = $elm.parents('.refreshable-initialized, .prtg-plugin-initialized').first(),
        $elm.parents('.refreshable-initialized, .prtg-plugin-initialized, .prtg-events-container')));

    _Prtg.Tip.killPopups();
    plugin = $.makeArray(plugin);
    if (!!$elm.length) plugin.unshift($elm[0]);
    if (plugin.length > 0) {
      $.each(plugin, function(i, e) {
        var self = $(e);
        var data = self.data();
        var ret = true;
        (function() {
          var plugins = Array.apply(null, arguments);
          var data = this;
          $.each(plugins, function(i, e) {
            var plugin = data['plugin_' + e.camelCase()];
            if (plugin && plugin['refresh']) {
              plugin.refresh($elm, {lastRefresh:0, refreshInterval:0});
              ret = false;
            }
          });
        }).apply(data, ((data.plugin && data.plugin.split(' ')) || ['refreshable']));
        return ret;
      });
    }
  },
  reloadMainMenu: function reloadMainMenu() {
    _Prtg.Events.publish('prtg.reload.menu');
  },
  refreshLater: function refreshLater($disp, wait, effect, options) {
    var self = this;
    var me = $disp.length ? $disp : $(this);
    me.effect(effect || 'pulsate', {times:1}, options || (wait || 3000), function() {_Prtg.objectTools.update.call(self);});
  },
  addNotificationTemplate: function addNotificationTemplate(dialogurl, data, options) {
    return _Prtg.Dialogs.defaultDialog(dialogurl, data, options || {}).then(function(result, action) {
      if (Object.keys(result).length) {
        var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.multieditdialogtitle);
        return $.when(
          $.ajax({
            url: "/editsettings",
            data: result,
            type: "POST",
            dataType: "json"
          })
        ).always(function() {
          loader.dialog('destroy').remove();
        }).then(function(apiResponse) {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
          _Prtg.objectTools.reloadMainMenu();
          return {
            id: apiResponse.objid,
            name: result.name_
          }
        });
      }
    })
  },
  refreshAfterRestart: function() {
    var REFRESH_TIMEOUT = 5000;
    setTimeout(function() {
      $.ajax({
        url: '/',
        type: "GET",
      })
      .done(function() {
        location.replace("/");
      })
      .fail(function() {
        _Prtg.objectTools.refreshAfterRestart();
      })
    }, REFRESH_TIMEOUT);
  },
  appserverActivateDialog: function appserverActivateDialog(dialogUrl) {
    var options = {
      width: 800,
      buttons: [{
        text: _Prtg.Lang.common.strings['ok'],
        'class': 'submit',
        'style': 'margin-bottom: 0.5em;',
        click: function () {
          var $form = $(this).find('form.prtg-form');
          if (!$form.valid()) {
            return;
          };
          var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.appserverinstallinprogress);
          $.ajax({
            url: "/api/appserverinstall.json",
            type: "POST",
            dataType: "json"
          }).done(function (result) {
            if(result.result === false) {
              var alertTitle = _Prtg.Lang.Dialogs.strings.error;
              _Prtg.Dialogs.alert(
                $('<div class="message">' + result.reason + '</div>'), 
                alertTitle,
                {
                  buttonText0: _Prtg.Lang.Dialogs.strings.close, 
                  dialogClass: "no-close"
                });
              loader.dialog('destroy').remove();
              
            } else {
              _Prtg.Events.pause();
              _Prtg.objectTools.refreshAfterRestart();
            }
          });
          $(this).dialog("close");
          
        }
      }, {
        text: _Prtg.Lang.Dialogs.strings.cancel,
        'class': 'button btngrey',
        click: function () {
          var self = $(this);
          self.dialog("close");
        }
      }]
    }

   return _Prtg.Dialogs.defaultDialog(dialogUrl, {}, options);
  },
  appserverDeactivateDialog: function appserverDeactivateDialog(dialogUrl) {
    var options = {
      width: 800,
      buttons: [{
        text: _Prtg.Lang.common.strings['ok'],
        'class': 'submit',
        'style': 'margin-bottom: 0.5em;',
        click: function () {
          var $form = $(this).find('form.prtg-form');
          if (!$form.valid()) {
            return;
          };
          var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.appserveruninstallinprogress);
          $.ajax({
            url: "/api/appserveruninstall.json",
            type: "POST",
            dataType: "json"
          }).done(function (result) {
            if(result.result === false) {
              var alertTitle = _Prtg.Lang.Dialogs.strings.error;
              _Prtg.Dialogs.alert(
                $('<div class="message">' + result.reason + '</div>'), 
                alertTitle,
                {
                  buttonText0: _Prtg.Lang.Dialogs.strings.close, 
                  dialogClass: "no-close"
                });
              loader.dialog('destroy').remove();
            } else {
              _Prtg.Events.pause();
              _Prtg.objectTools.refreshAfterRestart();
            }
          });
          $(this).dialog("close");
        }
      }, {
        text: _Prtg.Lang.Dialogs.strings.cancel,
        'class': 'button btngrey',
        click: function () {
          var self = $(this);
          self.dialog("close");
        }
      }]
    }

    return _Prtg.Dialogs.defaultDialog(dialogUrl, {}, options);
  },
  editSettingsDialog: function editSettingsDialog(dialogurl, data, options) {
    return _Prtg.Dialogs.defaultDialog(dialogurl, data, options || {}).then(function(result, action) {
      if (Object.keys(result).length) {
        var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.multieditdialogtitle);
        $.ajax({
          url: "/editsettings",
          data: result,
          type: "POST",
          dataType: "html"
        }).always(function() {
            loader.dialog('destroy').remove();
          }).done(function() {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
          _Prtg.objectTools.reloadMainMenu();
        });
      }
    });
  },
  channelEditDialog: function channelEditDialog(id, channel) {
    _Prtg.objectTools.editSettingsDialog("/controls/channeledit.htm",
      {'id': id, 'channel': channel},
      {
        width: 430,
        buttons: [{
          text: _Prtg.Lang.common.strings['apply'],
          'class': 'actionbutton noentersubmit',
          click: function() {
            var $form = $(this).find('form.prtg-form');
            $form.addClass('dialogform').trigger('submit');
            if (!$form.valid()) return;
          }
        }, {
          text: _Prtg.Lang.common.strings['ok'],
          'class': 'actionbutton',
          click: function() {
            var $form = $(this).find('form.prtg-form');
            $form.addClass('dialogform').trigger('submit');
            if (!$form.valid()) return;
            $(this).dialog("close");
          }
        }, {
          text: _Prtg.Lang.Dialogs.strings['cancel'],
          'class': 'button btngrey',
          click: function() {
            var $form = $(this).find('form.prtg-form');
            var self = $(this);
            if ($form.hasClass('formchanged')) {
              _Prtg.Dialogs.confirmDialog(_Prtg.Lang.Dialogs.strings['savewarningtitle'], _Prtg.Lang.Dialogs.strings['savewarning'], _Prtg.Lang.common.strings['save'], _Prtg.Lang.common.strings['discardchanges']).done(function() {
                  $form.addClass('dialogform').trigger('submit');
                  self.dialog("close");
                }).fail(function() {
                  self.dialog("close");
                });
            } else {
              self.dialog("close");
            }
          }
        }
      ]}
    );
  },
  createTemplate: function createTemplate(objectid) {
    if (!_Prtg.Options.userIsReadOnly)
      return _Prtg.Dialogs.defaultDialog('createtemplate.htm', objectid, {maxWidth:895})
        .then(function(result, action) {
          var loader = _Prtg.Dialogs.loader();
          return $.ajax({
            url:  action,
            data: result,
            type: "POST",
            dataType: 'json'
          }).always(function() {
            loader.dialog('destroy').remove();
          }).done(function(result){
            var list = '';
            if(!!result.templatesensors){
              result.templatesensors.forEach(function(sensor){
                  list += '<li>' + sensor +  '</li>';
              });
              list = '<ul>' + list + '</ul>';
            }
            _Prtg.Dialogs.alert($('<div class="message">' + _Prtg.Lang.Dialogs.strings.createTemplateMessage + list + '</div>'), _Prtg.Lang.Dialogs.strings.createTemplateResults);
          }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
            _Prtg.Dialogs.alert($('<div class="message">' + $(XMLHttpRequest.responseText).find("error").text() + '</div>'), _Prtg.Lang.Dialogs.strings.createTemplateResults);
          });
        });
    else return $.when({});
  },
  addRemoteProbe: function addRemoteProbe(id, dialogurl, step) {
    var splitter = String.fromCharCode(10);
    var waitforconnect = false;
    var currentstep = 0;
    var rpconnect = function($dlg){
    if(!waitforconnect){
      waitforconnect = true;
      var intervalId = window.setInterval(function(){
        $.ajax({
          type: 'GET',
          url: '/api/table.json',
          data: {
            count: '*',
            content: 'sensorxref',
            noraw: 1,
            subcheck: 1,
            filter_basetype: ['probe'],
            sortby: 'probegroupdevice',
            columns: 'objid,name=treejson,message=textraw,info,priority'
          }
          }).done(function(data) {
            var returnedData = JSON.parse(data);
            $.each(returnedData.sensorxref, function(index, element) {
              if(/unapproved/.test(element.info) === true ){
                $('.approvediscover').attr('objid', element.objid);
                $('.approvesimple').attr('objid', element.objid);
                $('.approvediscover, .approvesimple').show();
                $dlg.find('.probeconnwait, .probeconnsuccess').toggle();
                $dlg.find('#loadcircle').hide();
                $dlg.find("#rpconnectsuccess").css("display", "block");
                clearInterval(intervalId);
                if(currentstep == 1){
                  $('.next').trigger('click');
                }
                waitforconnect = false;
                return true;
              }
          });
        });
      }, 3000);
    }
    };
    var callbacks = {
        1: function(steps){
          var $dlg = this
            , allowedips = $dlg.find('#probeallowips').contents()
            , allowips = []
          ;
          currentstep = 1;
          allowedips
            .filter(function() {
              return this.nodeType === 3;
            })
            .each(function(){
              allowips.push($.trim($(this).text()));
            });
          if(allowips.indexOf('any') === -1){
            allowips.push('any');
            $.ajax({
              url: "/editsettings",
              type: "POST",
              data: {
                "id": 810,
                "allowips_": $.trim(allowips.join(splitter))
              }
            });
          }

          $('<iframe id="download">').hide().prop("src", "/public/PRTG_Remote_Probe_Installer.exe?filetype=.exe&"+_Prtg.Options.cachebreaker+"&_="+Date.now()).appendTo($dlg);

          if($('isremote').text().toLowerCase() === "false"){
            $dlg.find('.installrpi').hide();
            $dlg.find('.portchecksuccess').hide();
            $dlg.find('.coremachine').show();
          }

          rpconnect($dlg);

          return true;
        },
        2: function(steps){
          var $dlg = this;
          currentstep = 2;
          $('.next').hide();
          rpconnect($dlg);
          return true;
        }
    };

    return _Prtg.Dialogs.wizardDialog(dialogurl, id, step, callbacks,{
        open: function(){
          var probeip = $.trim(this.find('#probebindings').html()).split(splitter)[0];
          var txt1 = this.find('.portchecksuccess');

          if(probeip === '0.0.0.0:23560'){
            probeip = location.host + ':23560';
          }

          if(probeip.indexOf('127.0.0.1') > -1){
            $(this).find('.prepconnrp').hide();
            $(this).parent().parent().find("button.next").hide();
            $(this).find('.remoteprobedisabled').show();

          }

          txt1.html(txt1.html().replace(/\@dnsname/,probeip.split(':')[0]));

          if(!(navigator.platform.toLowerCase().indexOf('win')>=0)){
            $('.winsystem').css("display", "block");
            $('.destpc').css("display", "none");
          }

          if(typeof InstallTrigger !== 'undefined'){
            $("#downloadbrowser").attr("src","/images/download_ff.png");
          }

          var isIE = false || !!document.documentMode;
          if(!isIE && !!window.StyleMedia){
            $("#downloadbrowser").attr("src","/images/download_edge.png");
          }
        },
        buttons: [{
          text: _Prtg.Lang.Dialogs.strings.approve,
          position: 'right',
          class: 'button btngrey approvesimple',
          style: 'display: none;',
          click: function () {
            $dlg = this;
            var objid = $('.approvesimple').attr('objid');
            _Prtg.objectTools.setProbeState(objid,'allow', true);
            destroyDialog();
            dfd.reject(null);
            return dfd.promise();
          }
        },
        {
          text: _Prtg.Lang.Dialogs.strings.approvediscover,
          position: 'right',
          class: 'actionbutton approvediscover',
          style: 'display: none;',
          click: function () {
            $dlg = this;
            var objid = $('.approvediscover').attr('objid');
            _Prtg.objectTools.setProbeState(objid,'allowanddiscover', true);
            destroyDialog();
            dfd.reject(null);
            return dfd.promise();
          }
        }]
      })
      .then(function(result, action) {
      // TODO
    });
  },
  addNotificationContact: function addNotificationContact(id, contacttype) {
    return _Prtg.Dialogs.defaultDialog('/controls/addcontact.htm', {id: id, contacttype: contacttype})
    .then(function(result, action) {
      var loader = _Prtg.Dialogs.loader();
      $.ajax({
          url:  action,
          data: result,
          type: "POST"
        }).always(function() {
          loader.dialog('destroy').remove();
        }).done(function(repsone) {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
        });
    });
  },
  editNotificationContact: function editNotificationContact(id, subid) {
    //onclick events müssen weg, tablebuttonbox buttons mit delegates = besser.
    return _Prtg.Dialogs.defaultDialog('/controls/editcontact.htm', {id: id, subid: subid})
    .then(function(result, action) {
      var loader = _Prtg.Dialogs.loader();
      $.ajax({
          url:  action,
          data: result,
          type: "POST"
        }).always(function() {
          loader.dialog('destroy').remove();
        }).done(function(repsone) {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
        });
    }, function() {
      _Prtg.Events.publish('refresh.events.prtg', [true]); //duck tape.
    });
  },
  setNotificationContactStatus: function setNotificationContactStatus(id, subid, value) {
    var loader = _Prtg.Dialogs.loader();
    $.ajax({
      url: '/api/setobjectproperty.htm',
      data: {
        'id': id,
        'subid': subid,
        'value': value,
        'name': 'status'
      },
      type: 'GET'
    }).always(function() {
      loader.dialog('destroy').remove();
    }).done(function(repsone) {
      _Prtg.Events.publish('refresh.events.prtg', [true]);
    });
  },
  deleteSubObject: function deleteSubObject(id, subid) {
    _Prtg.Dialogs.confirmDialog(_Prtg.Lang.Dialogs.strings['deleteobjecttitle'],
                                _Prtg.Lang.Dialogs.strings['deleteobjecttext'],
                                _Prtg.Lang.Dialogs.strings['deleteObject'],
                                _Prtg.Lang.Dialogs.strings['cancelDeleteObject'])
    .done(function() {
      var loader = _Prtg.Dialogs.loader();
      _Prtg.api.deleteSubObj(id, subid)
      .always(function() {
        loader.dialog('destroy').remove();
      }).done(function(url) {
        _Prtg.Events.publish('refresh.events.prtg', [true]);
      });
    });
  },
  sortSubObjects: function sortSubObjects(objectid) {
    var me = this;
    return $.when(_Prtg.api.sort(objectid)).done(function(html) {
      _Prtg.Events.publish('refresh.events.prtg', [true]);
      _Prtg.objectTools.reloadMainMenu();
    });
  },
  checkObjectNow: function checkObjectNow(objectid) {
    var me = this;
    var disp = $($(me).attr('target') || '.refreshlink');
    return $.when(_Prtg.api.checkNow(objectid)).done(function(html) {
      _Prtg.Events.publish('refresh.events.prtg', [true]);
    });
  },
  simulateObject: function simulateObject(objectid, action) {
    var me = this;
    return $.when(_Prtg.api.simulateError(objectid, action)).done(function(html) {
      _Prtg.Events.publish('refresh.events.prtg', [true]);
      setTimeout(function() {
        _Prtg.objectTools.checkObjectNow.call(me, objectid);
      }, 5000);
    });
  },
  faveObject: function faveObject(objectid, action) {
    var me = this;
    if (!_Prtg.Options.userIsReadOnly)
      return $.when(_Prtg.api.favorite(objectid, action)).done(function(html) {
        _Prtg.Events.publish('refresh.events.prtg', [true]);
      });
    else return $.when({});
  },
  primaryChannel: function primaryChannel(objectid, channelid) {
    var me = this;
    if (!_Prtg.Options.userIsReadOnly)
      return $.when(_Prtg.api.primaryChannel(objectid, channelid)).always(function(html) {
        _Prtg.Events.publish('refresh.events.prtg', [true]);
      });
    else return $.when({});
  },
  testNotification: function testNotification(objectid) {
    var me = this;
    return $.when(_Prtg.api.testNotification(objectid)).done(function(html) {
      var $html = $(html);
      if ($(html).text() === 'OK')
        $html = $('<div>' + _Prtg.Lang.Dialogs.strings.nonotifytestmessage + '</div>');
      else
        $html = $('<div><form class="prtg-form prtg-plugin" data-plugin="prtg-form"><div class="oskhelpbox"><p>' + _Prtg.Lang.Dialogs.strings.notifytestmessage + '</p></div><div>' + html + '</div></form></div>');
      $(me).find('.ajax-loader-small').remove();
      _Prtg.Dialogs.alert($html, _Prtg.Lang.Dialogs.strings.notifytesttitle);
    });
  },
  loadLookups: function loadLookups() {
    var me = $(this);
    var txt = me.html();
    me.html("<span class='ajax-loader-very-small-inline'></span> " + _Prtg.Lang.common.strings.working);
    return $.when(_Prtg.api.loadLookUp(), _Prtg.api.reloadFileLists()).done(function(response) {
      setTimeout(function() {me.html(txt);}, 3000);
    });
  },
  createDatabaseSnapshot: function createDatabaseSnapshot() {
    var me = this;
    var txt = $(me).html();
    $(me).html("<span class='ajax-loader-very-small-inline'></span> " + _Prtg.Lang.common.strings.working);
    $(me).after('<br><span class="deletemeafterwards">' + _Prtg.Lang.common.strings.snapshotworking + '</span>');
    return $.when(_Prtg.api.createDatabaseSnapshot()).done(function(html) {
        $(me).html(txt);
        $(".deletemeafterwards").remove();
    });
  },
  writeCoreStatus: function writeCoreStatus() {
    var me = this;
    var txt = $(me).html();
    $(me).html("<span class='ajax-loader-very-small-inline'></span> " + _Prtg.Lang.common.strings.working);
    return $.when(_Prtg.api.writeCoreStatus()).done(function(html) {
      setTimeout(function() {$(me).html(txt);}, 3000);
    });
  },
  writeProbeStatus: function writeProbeStatus() {
    var me = this;
    var txt = $(me).html();
    $(me).html("<span class='ajax-loader-very-small-inline'></span> " + _Prtg.Lang.common.strings.working);
    return $.when(_Prtg.api.writeProbeState()).done(function(html) {
      setTimeout(function() {$(me).html(txt);}, 3000);
    });
  },
  clearCaches: function clearCaches() {
    var me = this;
    var txt = $(me).html();
    $(me).html("<span class='ajax-loader-very-small-inline'></span> " + _Prtg.Lang.common.strings.working);
    return $.when(_Prtg.api.clearCaches()).done(function(html) {
      setTimeout(function() {$(me).html(txt);}, 3000);
    });
  },
  setProbeState: function setProbeState(objectid, action, skipConfirm) {
    var me = this;
    var txt = $(me).html();
    if (!_Prtg.Options.userIsReadOnly) {
      if ($('#' + objectid + '.prtg_growl').length)
        $('#' + objectid + '.prtg_growl').fadeOut(700, function() {$(this).remove();});
      var loader = _Prtg.Dialogs.loader(action === 'deny' ? _Prtg.Lang.Dialogs.strings.denying : _Prtg.Lang.Dialogs.strings.approving, {
        resizable: true,
        width: '200px',
        buttons:[{
          html: _Prtg.Lang.Dialogs.strings.hidethiswindow,
          'class': "actionbutton",
          click: function() {
            loader.dialog('destroy').remove();
            loader = null;
            _Prtg.Events.publish('refresh.events.prtg', [true]);
            return false;
          }
        }]});
      return $.when(_Prtg.api.setProbeState(objectid, action))
        .always(function() {
          $(me).html(txt);
          if (!!loader && action === 'allow')
            loader.dialog('destroy').remove();
        })
        .done(function(html) {
          if (action === 'allow' || skipConfirm) {
            location.href = "/probenode.htm?id=" + objectid;
          } else {
            loader.html(html).dialog({position:'center', width:350}).next().find('.ui-button-text').text(_Prtg.Lang.Dialogs.strings.ok);
          }

        });
    } else return $.when({});
  },
  restartProbe: function restartProbe(objectid) {
    var me = $(this);
    var txt = me.html();
    me.html("<span class='ajax-loader-very-small-inline'></span> " + _Prtg.Lang.common.strings.working);
    return $.when(_Prtg.api.restartProbes(objectid)).done(function(html) {
      setTimeout(function() {me.html(txt);}, 3000);
    });
  },
  restartProbes: function restartProbes() {
    var me = $(this);
    var txt = me.html();
    me.html("<span class='ajax-loader-very-small-inline'></span> " + _Prtg.Lang.common.strings.working);
    return $.when(_Prtg.api.restartProbes()).done(function(html) {
      setTimeout(function() {me.html(txt);}, 3000);
    });
  },
  restartServer: function restartServer() {
    var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.serverrestarting)
    return $.when(_Prtg.api.restartServer()).always(function(html) {
      loader.dialog('destroy').remove()
      location.replace("/start.htm");
    });
  
  },
  recalcCache: function recalcCache(objectid) {
    var me = this;
    var txt = $(me).html();
    _Prtg.Dialogs.serverRestartNeededDialog().done(function() {
      $.when(_Prtg.api.recalcCache()).done(function(html) {
        _Prtg.objectTools.restartServer();
      });
    });
  },
  reconfigureLogging: function reconfigureLogging() {
    var me = this;
    var txt = $(me).html();
    $(me).html("<span class='ajax-loader-very-small-inline'></span> " + _Prtg.Lang.common.strings.working);
    return $.when(_Prtg.api.reconfigureLogging()).done(function(html) {
      setTimeout(function() {$(me).html(txt);}, 3000);
    });
  },
  acknowledgeToDo: function acknowledgeToDo(objectid) {
    var me = this;
    if (!_Prtg.Options.userIsReadOnly || _Prtg.Options.allowAcknowledge) {
      $(this).text(_Prtg.Lang.common.strings["working"] + '...');
      return _Prtg.api.acknowledgeToDo(objectid).done(function() {
        _Prtg.Events.publish('refresh.events.prtg', [true]);
      });
    } else return $.when({});
  },
  acknowledgeAllTodos: function acknowledgeAllTodos() {
    var me = this;
    if (!_Prtg.Options.userIsReadOnly || _Prtg.Options.allowAcknowledge) {
      return _Prtg.Dialogs.defaultDialog("/controls/acknowledgealltodosdialog.htm", '', {
        buttonText0: _Prtg.Lang.common.strings.ok,
        buttonText1: _Prtg.Lang.common.strings.cancel
      }).pipe(function(result) {
        var loader = _Prtg.Dialogs.loader();
        return _Prtg.api.acknowledgeToDo().done(function() {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
        }).always(function() {
          loader.dialog('destroy').remove();
        });
      });
    } else return $.when({});
  },
  acknowledgeErrorUntil: function acknowledgeErrorUntil(objectid, action) {
    var me = this;
    objectid = (objectid instanceof Array ? objectid.join(',') : objectid);
    if (!_Prtg.Options.userIsReadOnly || _Prtg.Options.allowAcknowledge)
      return _Prtg.Dialogs.defaultDialog("/controls/acknowledgealarmuntil.htm", objectid, {
        buttonText0: _Prtg.Lang.common.strings.ok,
        buttonText1: _Prtg.Lang.common.strings.cancel
      }).pipe(function(result) {
        var sds = result.untiltime.split('-');
        var duration = (new Date(sds[0], sds[1] - 1, sds[2], sds[3], sds[4], sds[5])).getTime() - (new Date()). getTime();
        duration = (duration / 1000) / 60;
        duration = duration.toFixed();
        if (duration > 0) {
          var loader = _Prtg.Dialogs.loader();
          return _Prtg.api.acknowledgeAlarm(objectid, result.message, duration).done(function() {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          }).always(function() {
            loader.dialog('destroy').remove();
          });
        } else {
          var df = $.Deferred();
          df.reject();
          return df.promise();
        }
      });
    else return $.when({});
  },

  acknowledgeError: function acknowledgeError(objectid, duration, elm) {
    var me = this;
    var parm = $(elm || me).contents().eq(1).text();

    if (parm.length) parm = '?title=%20(' + parm + ')';

    if (objectid instanceof Array)
      objectid = objectid.join(",");

    if (!_Prtg.Options.userIsReadOnly || _Prtg.Options.allowAcknowledge) {
      return _Prtg.Dialogs.defaultDialog("/controls/acknowledgealarm.htm" + parm, objectid, {maxWidth:550}
      ).pipe(function(result) {
        var loader = _Prtg.Dialogs.loader();
        return _Prtg.api.acknowledgeAlarm.apply(this, [objectid, result.message, duration]).done(function(html) {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
        }).always(function() {
          loader.dialog('destroy').remove();
        });
      });
    } else return $.when({});
  },
  setClusterNodeState: function setClusterNodeState(clid, state) {
    var me = this;
    $(this).replaceWith(_Prtg.Lang.common.strings.working);
    return _Prtg.api.setClusterNodeState(clid, state);
  },
  pauseUntil: function pauseUntil(objectid, action) {
    var me = this;
    objectid = (objectid instanceof Array ? objectid.join(',') : objectid);

    if (!_Prtg.Options.userIsReadOnly)
      return _Prtg.Dialogs.defaultDialog("/controls/pauseuntil.htm", objectid, {
        buttonText0: _Prtg.Lang.common.strings.ok,
        buttonText1: _Prtg.Lang.common.strings.cancel
      }).pipe(function(result) {
        var sds = result.untiltime.split('-');
        var duration = (new Date(sds[0], sds[1] - 1, sds[2], sds[3], sds[4], sds[5])).getTime() - (new Date()). getTime();
        duration = (duration / 1000) / 60;
        duration = duration.toFixed();
        if (duration > 0) {
          var loader = _Prtg.Dialogs.loader();
          return _Prtg.api.pausefor(objectid, duration, result.message).done(function() {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          }).always(function() {
            loader.dialog('destroy').remove();
          });
        } else {
          var df = $.Deferred();
          df.reject();
          return df.promise();
        }
      });
    else return $.when({});
  },
  setMaintenanceWindow: function setMaintenanceWindow(objectid) {
    var me = this;
    objectid = (objectid instanceof Array ? objectid.join(',') : objectid);

    if (!_Prtg.Options.userIsReadOnly)
      return _Prtg.Dialogs.defaultDialog("/controls/maintenance.htm", objectid, {
        buttonText0: _Prtg.Lang.common.strings.ok,
        buttonText1: _Prtg.Lang.common.strings.cancel
      }).done(function(result) {
        var loader = _Prtg.Dialogs.loader();
        return _Prtg.api.maintenanceWindow(objectid, result.maintstart_, result.maintend_).done(function() {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          }).always(function() {
            loader.dialog('destroy').remove();
          });
      });
    else return $.when({});
  },
  pauseObject: function pauseObject(objectid, action) {
    var me = this;
    if (objectid instanceof Array) {
      objectid = objectid.join(",");
    }

    if (!_Prtg.Options.userIsReadOnly)
      return $.when(_Prtg.api.pause(objectid, action)).done(function(html) {
        _Prtg.Events.publish('refresh.events.prtg', [true]);
        _Prtg.objectTools.checkObjectNow.call(me, objectid);
        // setTimeout(function() {
          // _Prtg.objectTools.checkObjectNow.call(me, objectid);
        // }, 1000);
      });
    else return $.when({});
  },
  pauseWithComment: function pauseWithComment(objectid, pausefor, elm) {
    var me = this;
    var parm = $(elm || me).contents().eq(1).text();
    var apicall = !!pausefor ? 'pausefor' : 'pause';
    if (parm.length) parm = '?title=%20(' + parm + ')';
    if (objectid instanceof Array) {
      objectid = objectid.join(",");
    }

    if (!_Prtg.Options.userIsReadOnly)
      return _Prtg.Dialogs.defaultDialog("/controls/pausewithcomment.htm" + parm, objectid, {maxWidth:550}).pipe(function(result) {
        var loader = _Prtg.Dialogs.loader();
        return _Prtg.api[apicall](objectid, pausefor, result.message).done(function(html) {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
        }).always(function() {
          loader.dialog('destroy').remove();
        });
      });
    else return $.when({});
  },
  setObjectPosition: function setObjectPosition(objectid, pos) {
    var me = this;
    if (!_Prtg.Options.userIsReadOnly)
      return $.when(_Prtg.api.position(objectid, pos)).done(function(html) {
        _Prtg.objectTools.reloadMainMenu();
        _Prtg.Events.publish('refresh.events.prtg', [true]);
      });
    else return $.when({});
  },
  setObjectCollapse: function setObjectCollapse(objectid, fold) {
    var me = this;
    if (!_Prtg.Options.userIsReadOnly)
      return $.when(_Prtg.api.fold(objectid, fold)).done(function(html) {
        _Prtg.objectTools.update.call(me);
      });
    else return $.when({});
  },
  setObjectPriority: function setObjectPriority(objectid, prio) {
    var me = this;
    if (objectid instanceof Array) {
      objectid = objectid.join(",");
    }

    if (!_Prtg.Options.userIsReadOnly) {
      $(me).parents('.priority').addClass('ajax-loader-very-small');
      return $.when(_Prtg.api.priority(objectid, prio)).done(function(html) {
        _Prtg.Events.publish('refresh.events.prtg', [true]);

      });
    } else {
      return $.when({});
    }
  },
  discoverObjectNow: function discoverObjectNow(objectid) {
    var me = this;
    objectid = objectid || $("input[name='id']").val()

    return $.when(_Prtg.api.discover(objectid)).done(function(html) {
      _Prtg.Events.publish('refresh.events.prtg', [true]);
    });
  },

  discoverObjectTemplate: function discoverObjectTemplate(objectid) {
    if (!_Prtg.Options.userIsReadOnly) {
        var multi = '';
        if (objectid instanceof Array) {
          if (objectid.length > 1) multi = 'multi';
          objectid = objectid.join(",");
        }

        return _Prtg.Dialogs.defaultDialog("/autodiscoverytemplate"+multi+".htm?objid="+objectid, objectid, {}).done(function (result, action) {
          var templates = $.isArray(result.devicetemplate__check) ? result.devicetemplate__check : [result.devicetemplate__check];
          var loader = _Prtg.Dialogs.loader();
          var objectid = result.id || objectid;

          _Prtg.api.discover(objectid, templates.map(function (e) {
            if (e) {
              return '"' + e.split('|')[0] + '"';
            } else {
              return '';
            }
          }).join(',')).done(function () {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
            loader.dialog('destroy').remove();
          });
        });
    }
    else return $.when({});
  },

  disableGeoMaps: function disableGeoMaps() {
    return $.ajax({
      url: "/editsettings",
      data: {
        'geomapserviceprovider_': 'disabled',
        'id': 800
      },
      type: "POST",
      dataType: "html"
    }).always(function() {
      location.reload();
    });
  },
  copyClipBoard: function copyClipBoard($form, text) {
    var txt =  text || '{\n\'' + $form.serialize().replace(/=/g, '\':\'').replace(/&/g, '\',\n\'') + '\'\n}';
    txt = $("<div id='formcopyresults' title='" + _Prtg.Lang.common.strings.copy + "'=><textarea style='width:100%;height:340px' id='formcopytext'>" + txt + "</textarea></div>");
    _Prtg.Dialogs.alert(txt, "", {open:function(dlg) {$('#formcopytext').focus().select();}});
  },
  quickeditObject: function quickeditObject(objectid, type) {
    var me = this;
    var dialogurl = (parseInt(type, 10) === 2) ? "/controls/quickeditdevice.htm" : "/controls/quickedit.htm";

    if (!_Prtg.Options.userIsReadOnly)
      return _Prtg.objectTools.editSettingsDialog.call(me, dialogurl, objectid);
    else return $.when({});
  },
  deleteObject: function deleteObject(objectid, refresh) {
    var me = this;
    var multi = '';
    if (objectid instanceof Array) {
      if (objectid.length > 1) multi = 's';
      objectid = objectid.join(",");
    }

    if (!_Prtg.Options.userIsReadOnly) {
      return _Prtg.Dialogs.defaultDialog('/deleteobject' + multi + ".htm", objectid, {
        buttonText0: _Prtg.Lang.Dialogs.strings['deleteObject' + multi],
        buttonText1: _Prtg.Lang.Dialogs.strings['cancelDeleteObject' + multi]
      }).then(function(result, action) {
        var loader = _Prtg.Dialogs.loader();
        return _Prtg.api.deleteObj(objectid)
          .always(function() {
            loader.dialog('destroy').remove();
          }).done(function(url) {
            if ((!refresh || document.location.search.indexOf('id=' + objectid) > -1) && !!url) {
              _Prtg.Hjax.loadLink(url);
            } else {
              _Prtg.Events.publish('refresh.events.prtg', [true]);
              _Prtg.Events.publish('prtg.object.deleted');
            }
            _Prtg.objectTools.reloadMainMenu();
          });
      });
    } else return $.when({});
  },
  usedbyObject: function usedbyObject(objectid) {
    return _Prtg.Dialogs.loadAlert('/objectusedby.htm', {id:objectid}, {width:parseInt($(window).width() * 0.75, 10)});
  },
  duplicateObject: function duplicateObject(objectid) {
    if (!_Prtg.Options.userIsReadOnly)
      return _Prtg.api.duplicateObj(objectid).done(function() {
        _Prtg.Events.publish('refresh.events.prtg', [true]);
        _Prtg.objectTools.reloadMainMenu();
      });
    else return $.when({});
  },
  findDuplicates: function findDuplicates(objectid) {
    if (!_Prtg.Options.userIsReadOnly) {
      var loader = _Prtg.Dialogs.loader(_Prtg.Lang.common.strings.working);
      return _Prtg.api.findDuplicates(objectid, {timeout: 10 * _Prtg.Options.ajaxTimeout}).done(function(resp) {
        loader.dialog("destroy").remove();
        var div = $('<div class="findduplicatesdialog"></div>').append(resp);
        _Prtg.Dialogs.alert(div, _Prtg.Lang.common.strings.findduplicatesresult);
      });
    } else {
      return $.when({});
    }
  },
  cloneObject: function cloneObject(objectid, objecttype, gotoobject) {
    var me = this;
    var data = {
          id: objectid
        };
    if (!_Prtg.Options.userIsReadOnly) {
      return _Prtg.Dialogs.defaultDialog("/duplicate" + objecttype + ".htm", objectid, {
        maxWidth: 600,
        buttonText0: _Prtg.Lang.Dialogs.strings["continue"]
      }).done(function(result, action) {
        data = $.extend(data, result);
        return $.ajax({
          url: action,
          type: "POST",
          data: data
        }).done(function(url) {
          if (!!gotoobject && !!url)
            _Prtg.Hjax.loadLink(url);
          else
        _Prtg.Events.publish('refresh.events.prtg', [true]);
          _Prtg.objectTools.reloadMainMenu();
        });
      });
    } else {
      return $.when({});
    }
  },
  moveObject: function moveObject(objectid) {
    var me = this;
    var data = {
          id: objectid
        };
    if (!_Prtg.Options.userIsReadOnly) {
      return _Prtg.Dialogs.defaultDialog("/moveobject.htm", objectid, {
      }).done(function(result, action) {
        data = $.extend(data, result);
        return $.ajax({
          url: action,
          type: "POST",
          data: data
        }).done(function(html) {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
          _Prtg.objectTools.reloadMainMenu();
        });
      });
    } else return $.when({});
  },
  'addObject0': function addObject0(objecttype, data, init) {
    var self = this;

    if(!!data && data.preselect === 0){
      data.preselect = 1;
    }
    if(objecttype === "autodiscovery" && _Prtg.lastStats.EditionType[0] === "P"){
    		data =  {preselect: null, disabled: 1};
    }
    if (!_Prtg.Options.userIsReadOnly) {
      _Prtg.Dialogs.defaultDialog("/add" + objecttype + "0.htm", data || {preselect:1}).done(function(result, action) {
        _Prtg.objectTools.addObject.apply(self, [result.id, objecttype, {}]);
      });
    }
  },

  addObject: function addObject(objectid, objecttype, extra) {
    var me = this;
    var data = {
          id: objectid
        };
    if (!_Prtg.Options.userIsReadOnly) {
      return _Prtg.Dialogs.defaultDialog("/add" + objecttype + ".htm", $.extend(true, data, extra), {
      }).done(function(result, action) {
        data = $.extend(data, result);
        return $.ajax({
          url: action,
          type: "POST",
          dataType: 'text',
          data: data
        }).done(function(ret) {
          var objid = ret.indexOf(':') > 0 ? parseInt(ret.split(': "')[1], 10) : parseInt(ret, 10);
          if (!!extra && !!extra.redirect && !!objid) {
            var sep = extra.redirect.indexOf('?') > 0 ? '&' : '?';
            _Prtg.Hjax.loadLink(extra.redirect + sep + 'id=' + objid);
          } else
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          _Prtg.objectTools.reloadMainMenu();
        });
      });

    } else {
      return $.when({});
    }
  },
  addRecommendedSensors: function addRecommendedSensors(objectid, data) {
    var me = $(this);
    if (!_Prtg.Options.userIsReadOnly && data.length > 0) {
      var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.addingsensors);
      return _Prtg.api.addRecommendedSensors(objectid, data.join(','))
        .always(function(html) {
          loader.dialog('destroy').remove();
        })
        .fail(function(html) {
          _Prtg.Dialogs.alert($('<div>' + html + '</div>'));
        })
        .done(function() {
          _Prtg.Dialogs.alert($('<div>' + _Prtg.Lang.Dialogs.strings.recommedermessage + '</div>'), _Prtg.Lang.Dialogs.strings.recommedermessagetitle);
          _Prtg.Events.publish('refresh.events.prtg', [true]);
        });
    }else return $.when({});
  },
  recommendNow: function recommendNow(objectid) {
    var me = $(this);
    if (!_Prtg.Options.userIsReadOnly && objectid) {
      var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.recommederservice);
      _Prtg.api.recommendNow(objectid).done(function(txt) {
        loader.dialog('destroy').remove();
        _Prtg.Dialogs.alert($('<div>' + (txt || _Prtg.Lang.Dialogs.strings.recommedenowmessage) + '</div>'), _Prtg.Lang.Dialogs.strings.recommedermessagetitle)
          .done(function() {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          });
      });
    }else return $.when({});
  },
  startActivation: function startActivation(button) {
    $(button).fadeTo("slow", 0, function() {
      $(button).parent().parent().addClass(_Prtg.Lang.common.strings.working);
      $('.EMailActivation').removeClass('InitialDisplayNone');
      $('.EMailActivationNode').hide();
    });
    return _Prtg.api.startActivation()
      .done(function() {
        _Prtg.Events.publish('refresh.events.prtg', [true]);
      });
  },
  hideFollowButton: function hideFollowButton() {
    $(".hidefollowbutton").hide();
    return $.ajax({
      type: "POST",
      url: "/editsettings",
      data: "showfollowlinks_=0&id=810"
    }).done(function(response) {
      $("#followprtg").remove();
    });
  },
  openReleaseDialog: function openReleaseDialog($element, options) {
      var dialogHtml = $element,
          dialogWidth = $( window ).width() * 0.6,
          dialogHeight = $( window ).height() * 0.75,
          minHeightSlides = dialogHtml.find('.js-adjustToHeight'),
          slider = dialogHtml.find('.js-slider');

      var dialogOptions= {
          width: dialogWidth,
          height: dialogHeight,
          open: function(){
              slider.slick({
                  dots: true,
                  infinite: false,
                  speed: 300,
                  adaptiveHeight: false
              });

              minHeightSlides.css('height', slider.height() );
          },
          close: function (e, ui) {
              dfd.resolve();
              $(this).dialog('destroy').remove();
          }
      };
      dialogOptions = $.extend( dialogOptions, options );

      var dfd = _Prtg.Dialogs.alert(dialogHtml, dialogHtml.data('dialogTitle'), dialogOptions);

      return dfd;
  },
  sendFeedback: function sendFeedback(url, data) {
    return _Prtg.Dialogs.defaultDialog(url, {})
      .done(function(result, action) {
        var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.sendFeedback, {
          resizable: true,
          width: '200px',
          buttons:[{
            html: _Prtg.Lang.Dialogs.strings.hidethiswindow,
            'class': "actionbutton",
            click: function() {
              loader.dialog('destroy').remove();
              loader = null;
              return false;
            }
        }]});

        result._hjax = true;
        result.subject = data.subject;

        $.ajax({
          url: action,
          data: result,
          type: "POST",
          timeout: 100000,
          dataType: "html",
          beforeSend: function(jqXHR) {
            jqXHR.ignoreManager = true;
          }
        }).fail(function() {
        }).done(function(htm) {
          if (!!loader)
            loader.html($(htm).find('.controls-info').html()).dialog({position:'center', width:500}).next().find('.ui-button-text').text(_Prtg.Lang.Dialogs.strings.ok);
        });
      }).fail(function(){});
  },
  hidechanneltabtip: function hidechanneltabtip() {
    $.ajax({
      url: "/api/hidechanneltabtip.htm",
      type: "GET",
      dataType: "html"
    }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
      _Prtg.Growls.add('growlalarms', _Prtg.Lang.common.strings['channeltabtiperror1'], '', 10000, '', '');
      return false;
    }).done(function(response, status, xmlHttpRequest) {
      _Prtg.Growls.add('growlalarms', _Prtg.Lang.common.strings['channeltabtiperror2'], '', 10000, '', '');
      $("#channeltab").hide();
      _Prtg.Plugins['prtg-tabs'].plugin.activateTab(1, true);
    });
  },
  'ticketAdd0': function ticketAdd0(data, init){
     var self = this;
    if (!_Prtg.Options.userIsReadOnly) {
      _Prtg.Dialogs.defaultDialog("/addticket0.htm", data || {preselect:0}).done(function(result, action) {
        _Prtg.objectTools.ticketAdd.apply(self, ['new', result.objectid]);
      });
    }
  },
  ticketAdd: function ticketAdd(id, objid) {
    if (!_Prtg.Options.userIsReadOnly) {
      return _Prtg.Dialogs.defaultDialog('/addticket.htm', {
        id: id,
        objectid: objid
      }).then(function(result, action) {
        var loader = _Prtg.Dialogs.loader();
        return _Prtg.api.ticketAdd('new', {data: result})
          .always(function() {
            loader.dialog('destroy').remove();
          }).done(function(url) {
            _Prtg.Events.publish('refresh.events.prtg');
          });
      });
    } else return $.when({});
  },
  ticketEdit: function ticketEdit(ids) {
    var me = this;
    var ignore = [];
    ids = typeof (ids) === "object" ? $.map(ids, function(ids) {return ids.status < "3" ? ids.objid : (ignore.push(ids.objid), null);}) : [ids];
    if (!_Prtg.Options.userIsReadOnly && ids.length) {
      return _Prtg.Dialogs.defaultDialog('/editticket.htm',
        {
          id: ids.join(','),
          ignore: ignore.join(',')
        }
      ).then(function(result, action) {
        ids.forEach(function(el, ix, ar) {
          ar[ix] = _Prtg.api.ticketEdit(el, result.content, result.subject, result.assigned, result.priority);
        });
        var loader = _Prtg.Dialogs.loader();
        $.when.apply($, ids)
        .always(function() {
          loader.dialog('destroy').remove();
        })
        .done(function() {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
        });
      }, function() {_Prtg.Events.publish('refresh.events.prtg', [true]);});
    } else return $.when({});
  },
  ticketAssign: function ticketAssign(ids, assignedto) {
    var me = this;
    var ignore = [];
    ids = typeof (ids) === "object" ? $.map(ids, function(ids) {return ids.status < "3" ? ids.objid : (ignore.push(ids.objid), null);}) : [ids];
    if (!_Prtg.Options.userIsReadOnly) {
      return _Prtg.Dialogs.defaultDialog(
        '/controls/ticket_assign.htm?action=assign',
        {
          id: ids.join(','),
          assignedto: assignedto || 100,
          ignore: ignore.join(',')
        }
      ).done(function(result, action) {
        var timeout = _Prtg.Options.ajaxTimeout * ids.length;
        ids.forEach(function(el, ix, ar) {
          ar[ix] = _Prtg.api.ticketAssign(el, result.assigned, result.content, {timeout: timeout});
        });
        var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings['ticketassigning']);
        $.when.apply($, ids)
          .always(function() {
            loader.dialog('destroy').remove();
          })
          .done(function() {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          });
      });
    } else return $.when({});

  },
  ticketResolve: function ticketResolve(ids) {
    var me = this;
    var ignore = [];
    ids = typeof (ids) === "object" ? $.map(ids, function(ids) {return ids.status < "2" ? ids.objid : (ignore.push(ids.objid), null);}) : [ids];
    if (!_Prtg.Options.userIsReadOnly) {
      return _Prtg.Dialogs.defaultDialog(
        '/controls/ticket_change.htm?action=resolve',
        {
          id:ids.join(','),
          ignore: ignore.join(',')
        }
      ).done(function(result, action) {
        var timeout = _Prtg.Options.ajaxTimeout * ids.length;
        ids.forEach(function(el, ix, ar) {
          ar[ix] = _Prtg.api.ticketResolve(el, result.content, {timeout: timeout});
        });
        var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings['ticketresolving']);
        $.when.apply($, ids)
          .always(function() {
            loader.dialog('destroy').remove();
          })
          .done(function() {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          });
      });
    }else return $.when({});
  },
  ticketClose: function ticketClose(ids) {
    var me = this;
    var ignore = [];
    ids = typeof (ids) === "object" ? $.map(ids, function(ids) {return ids.status < "3" ? ids.objid : (ignore.push(ids.objid), null);}) : [ids];
    if (!_Prtg.Options.userIsReadOnly) {
      return _Prtg.Dialogs.defaultDialog(
        '/controls/ticket_change.htm?action=close',
        {
          id:ids.join(','),
          ignore: ignore.join(',')
        }
      ).done(function(result, action) {
        var timeout = _Prtg.Options.ajaxTimeout * ids.length;
        ids.forEach(function(el, ix, ar) {
          ar[ix] = _Prtg.api.ticketClose(el, result.content, {timeout: timeout});
        });
        var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings['ticketclosing']);
        $.when.apply($, ids)
          .always(function() {
            loader.dialog('destroy').remove();
          })
          .done(function() {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          });
      });
    }else return $.when({});
  },
  ticketReopen: function ticketReopen(ids) {
    var me = this;
    var ignore = [];
    ids = typeof (ids) === "object" ? $.map(ids, function(ids) {return ids.status >= "2" ? ids.objid : (ignore.push(ids.objid), null);}) : [ids];
    if (!_Prtg.Options.userIsReadOnly) {
      return _Prtg.Dialogs.defaultDialog(
        '/controls/ticket_assign.htm?action=' + _Prtg.Lang.Dialogs.strings['ticketreopen'],
        {
          id:ids.join(','),
          ignore: ignore.join(',')
        }
      ).done(function(result, action) {
        var timeout = _Prtg.Options.ajaxTimeout * ids.length;
        ids.forEach(function(el, ix, ar) {
          ar[ix] = _Prtg.api.ticketReopen(el, result.assigned, result.content, {timeout: timeout});
        });
        var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings['onemoment']);
        $.when.apply($, ids)
          .always(function() {
            loader.dialog('destroy').remove();
          })
          .done(function() {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          });
      });
    } else return $.when({});
  },
  ticketPriority: function ticketPriority(ids, prio) {
    var me = this;
    var timeout = _Prtg.Options.ajaxTimeout;

    ids = typeof (ids) === "object" ? $.map(ids, function(ids) {return ids.objid;}) : [ids];
    if (!_Prtg.Options.userIsReadOnly) {
      timeout = _Prtg.Options.ajaxTimeout * ids.length;
      ids.forEach(function(el, ix, ar) {
        ar[ix] = _Prtg.api.ticketPriority(el, prio, {timeout: timeout});
      });
      var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings['onemoment']);
      return $.when.apply($, ids)
        .always(function() {
          loader.dialog('destroy').remove();
        })
        .done(function() {
          _Prtg.Events.publish('refresh.events.prtg', [true]);
        });
    } else return $.when({});
  },
  testdelivery: function testdelivery(url, settingsData) {
    return $.ajax({
      url: url,
      data: settingsData,
      method: 'POST',
      beforeSend: function (jqXHR) {
        jqXHR.ignoreManager = true;
      }
    })
  },
  windows: {
    openWindow: function openWindow(objectid, action) {
      var mywin = window.open("/openwindow.htm?id=" + objectid + "&action=" + action, "PRTG_Window_" + objectid + action, "width=600,height=500,resizable=yes,status=yes,menubar=yes,scrollbars=yes");
      mywin.focus();
    },
    openServiceURLWindow: function openServiceURLWindow(objectid) {
      var serviceUrl;
      var mywin;

      _Prtg.api.getObjectProperty(objectid, 'serviceurl','xml').done(function(response) {
        serviceUrl = $($.parseXML(response)).find('result').text();
        if (serviceUrl !== '') {
          openServiceUrl();
        }
        else {
          _Prtg.Dialogs.defaultDialog('/controls/editserviceurl.htm', {id:objectid}).done(function(response) {
            _Prtg.api.setObjectProperty(objectid, 'serviceurl', response.content).done(function() {
              openServiceUrl();
            });
          });
        }

        function openServiceUrl() {
          mywin = window.open("/gotoserviceurl.htm?id=" + objectid, "PRTG_Window_" + objectid, "width=600,height=500,resizable=yes,status=yes,menubar=yes,scrollbars=yes");
          mywin.focus();
        }
      });
    },
    traceRoute: function traceRoute(objectid, ip) {
      var mywin = window.open("/traceroute.htm?" + (!!ip ? "id=1&ip=" + ip : 'id=' + objectid), "PRTG_Window_trace_route", "width=600,height=500,resizable=yes,status=yes,menubar=yes,scrollbars=yes");
      mywin.focus();
    },
    openRDPWindow: function openRDPWindow(objectid, action) {
      window.top.location.href = "/remotedesktop.rdp?id=" + objectid;
    }
  },
  licenseDeactivation: function licenseDeactivation(){
    if (!_Prtg.Options.userIsReadOnly) {
      _Prtg.Dialogs.confirmDialog(
        _Prtg.Lang.Dialogs.strings.deactivatinglicensetitle,
        _Prtg.Lang.Dialogs.strings.deactivatinglicensequestion)
      .done(function(){
        var loader = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.deactivatinglicense, {
          resizable: true,
          width: '200px',
          buttons:[{
            html: _Prtg.Lang.Dialogs.strings.ok,
            'class': "actionbutton hidden",
            click: function() {
              loader.dialog('destroy').remove();
              loader = null;
              document.location.reload();
              return false;
            }
          }]});
        return $.ajax({
          url: '/editlicense',
          data: {
            licenseaction: 'deactivate',
            _hjax: true
          },
          type: "POST",
          timeout: 100000,
          dataType: "text",
          beforeSend: function(jqXHR) {
            jqXHR.ignoreManager = true;
          }
        })
        .always(function(txt) {
          loader.html('<div class="errormessage">'+txt+'</div>').dialog({position:'center', width:500}).next().find('button.actionbutton').removeClass('hidden');
        });
      });
    } else return $.when({});  },
  sslSwitchTo: function sslSwitchTo(){
    $('<div style="text-align: left;" id="switchtossldialog" title="Loading..." style="display: none"><div class="loadspinner"></div></div>')
    .dialog({
    	closeText: "",
      draggable: false,
      resizable: false,
      modal: true,
      width: 500,
      height: 'auto',
      open: function () {
        $("#switchtossldialog").load("controls/switchtossl.htm", function () {
          switch (_Prtg.Options.browser) {
            case "chrome":
              $("#sslnagscreen_sslwarnimg").attr("src", "images/sslwarn_chrome.png");
              $("#sslnagscreen_sslwarnhelplink").attr("href", "/help/ssl_certificate_warning.htm#chrome");
              break;
            case "firefox":
              $("#sslnagscreen_sslwarnimg").attr("src", "images/sslwarn_firefox.png");
              $("#sslnagscreen_sslwarnhelplink").attr("href", "/help/ssl_certificate_warning.htm#firefox");
              break;
            case "msie":
              $("#sslnagscreen_sslwarnimg").attr("src", "images/sslwarn_ie.png");
              $("#sslnagscreen_sslwarnhelplink").attr("href", "/help/ssl_certificate_warning.htm#ie");
              break;
            default:
              $("#sslnagscreen_sslwarnimg").attr("src", "images/sslwarn_ie.png");
              $("#sslnagscreen_sslwarnhelplink").attr("href", "/help/ssl_certificate_warning.htm#chrome");
              break;
          }
          $(this)
          .dialog('option', 'title', _Prtg.Lang.Dialogs.strings.sslTitle)
          .dialog('option', 'buttons', [{
            text: _Prtg.Lang.Dialogs.strings.sslButton,
            class: "actionbutton",
            click: function () {
              $(this).dialog('option', 'buttons', {}).dialog('option', 'title', _Prtg.Lang.Dialogs.strings.sslRestart);
              if(window.location.port === undefined ||  window.location.port === "80" || window.location.port === 80 || window.location.port === "") {
                $("#switchtossldialog").html('<center><div class="loading"><div class="loadspinner small"></div></div></center><br/>' + _Prtg.Lang.Dialogs.strings.sslMessageA + '<br/>');
              } else {
                $("#switchtossldialog").html('<center><div class="loading"><div class="loadspinner small"></div></div></center><br/>'+_Prtg.Lang.Dialogs.strings.sslMessageB+' <a href="' + 'https://' + window.location.hostname + '">'+'https://' + window.location.hostname +'<a><br/>');
              }
              $(this).dialog('option', 'height', 210);
              if(_Prtg) if(_Prtg.Events) _Prtg.Events.stop();
              $.ajax({
                url: "api/switchtossl.htm",
                type: "GET",
                timeout: 10000,
                success: function () {
                  connectionTestRequestSent = true;
                  $(document).off("ajaxError");
                  if(window.location.port === undefined ||  window.location.port === "80" || window.location.port === 80 || window.location.port === "") {
                    setTimeout(checkConnection, 30000);
                  }
                },
                error: function () {
                  $("#switchtossldialog")
                  .html('Error')
                  .dialog('option', 'buttons', [{
                    text: _Prtg.Lang.Dialogs.strings.cancel,
                    click: function () {
                      $(this).dialog("close");
                      $("#switchtossldialog").remove();
                    }
                  }
                  ]);
                }
              });

              var reconnectTrys = 0;
              var checkConnection = function () {
                $.ajax({
                  url: "http://" + window.location.hostname + "/checkrunning",
                  dataType: "html",
                  success: function () {
                    if (reconnectTrys < 5) {
                      setTimeout(checkConnection, 1000);
                    } else {
                      $("#switchtossldialog").dialog("close");
                      window.location.href = "https://" + window.location.hostname
                    }
                  },
                  error: function (xhr, text, error) {
                    $("#switchtossldialog").append(".");
                    setTimeout(checkConnection, 2000);
                  },
                  complete: function (xhr, text) {
                    reconnectTrys = reconnectTrys + 1;
                  }
                });
              }
            }
          },
          {
            text: _Prtg.Lang.Dialogs.strings.cancel,
            class: "button btngrey",
            click: function () {
              $(this).dialog("close").remove();
            }
          }]);
        });
      },
      close: function () {
        $(this).remove();
      }
    });
  },
  sslHideNagscreen: function sslHideNagscreen(){
    $.ajax({
      url: "/api/hidesslnagscreen.htm",
      type: "GET",
      dataType: "html",
      error: function error(XMLHttpRequest, textStatus, errorThrown) {
        _Prtg.Growls.add('growlalarms',_Prtg.Lang.Dialogs.strings.sslGrowlA,'',10000,'','');
        return false;
      },
      success: function success(response, status, xmlHttpRequest) {
        _Prtg.Growls.add('growlalarms',_Prtg.Lang.Dialogs.strings.sslGrowlB,'',10000,'','');
      }
    });
  }
};
;
(function($) {
  window._Prtg = window._Prtg || {};
  _Prtg.Util = {
    createNamespace: function() {
      var obj, ns;
      $.each(arguments, function(num) { ns = arguments[1].split(".");
        obj = window[ns[0]] = window[ns[0]] || {};
        $.each(ns.slice(1), function(num2) { obj = obj[arguments[1]] = obj[arguments[1]] || {} }) });
      return obj },
    getUrlParameters: function(url) {
      var vars = {},
        hash, temp;
      var hashes = url.slice(url.indexOf("?") + 1).split("&");
      for (var i = 0; i < hashes.length; i++) {
        if (hashes[i] === "") continue;
        hash = hashes[i].split("=");
        if (hash[0] === "") continue;
        if (vars[hash[0]] !==
          undefined)
          if (vars[hash[0]] instanceof Array) vars[hash[0]].push(unescape(hash[1]));
          else { temp = vars[hash[0]];
            vars[hash[0]] = [temp, unescape(hash[1])] }
        else vars[hash[0]] = unescape(hash[1])
      }
      return vars
    },
    getFormData: function(form, data) {
      var $form = !(form instanceof jQuery) ? $(form) : form;
      var o = data || {};
      var valid = false;
      $form.each(function() {
      	valid = $(this).valid();
      });
      if (valid) {
        $form.each(function(i, elm) {
          jQuery.each(
            $(this).serializeArray(), 
            function(){
              if (o[this.name] !== undefined) {
                if (!o[this.name].push) 
                  o[this.name] = [o[this.name]];
                o[this.name].push(this.value || "");
              } else o[this.name] = this.value || "";
            }
          );
          $(this).find('.dataTable').each(function(i, table){
            jQuery.each(
              $('input.checkbox:checked, select', $(table).DataTable().rows().nodes()).serializeArray(),
              function(){
                var value=this.value.replace(/\r?\n/g, "\r\n");
                if (o[this.name] !== undefined) {
                  if (!o[this.name].push) 
                    o[this.name] = [o[this.name]];
                  if(!~o[this.name].indexOf(value))
                    o[this.name].push(value || "");
                } else o[this.name] = value || "";
              }
            );
          });
        });
      } else o = null;
      return o;
    },
    getUrlVars: function() {
      return this.getUrlParameters(window.location.href)
    },
    /**
     * Normalizes a date (time) string,
     * so new Date() can handle it properly
     * 
     * @param {string} dateTimeString 
     */
    normalizeDate: function(dateTimeString) {
      if (typeof dateTimeString !== 'string') {
        return dateTimeString
      }
      var dateTimeParts = dateTimeString.split(' ');

      // If we have a date like 16.03.2018
      if (dateTimeParts[0].indexOf('.') > -1) {
        var dateParts = dateTimeParts[0].split('.')
        if (dateParts.length > 2) {
          dateTimeParts[0] = dateParts[1] + '/' + dateParts[0] + '/' + dateParts[2];
        }
      }
      return dateTimeParts.join(' ');
    },
    /**
     * Create a date from a date (time) string consistently
     * 
     * @param {string} dateTimeString 
     */
    createDate: function(dateTimeString) {
      return new Date(_Prtg.Util.normalizeDate(dateTimeString));
    },
    getTimeString: function() {
      var curtime = new Date;
      return curtime.getHours() + ":" + curtime.getMinutes() + ":" + curtime.getSeconds() },
    GetPropertyByString: function(stringRepresentation) {
      var properties = stringRepresentation.split("."),
        myTempObject = window[properties[0]];
      for (var i = 1, length = properties.length; i < length; i++) myTempObject =
        myTempObject[properties[i]];
      return myTempObject
    },
    urlDecodeString: function(string) {
      return unescape(decodeURI(string.replace(/\+/g, " "))) },
    endsWithSuffix: function(str, suffix) {
      return str.indexOf(suffix, str.length - suffix.length) !== -1 },
    padNumber: function(num, size) {
      var r = "" + num;
      while (r.length < size) r = "0" + r;
      return r },
    daysInMonth: function(month, year) {
      return 32 - (new Date(year, month, 32)).getDate() },
    secondsAsTime: function(sec) {
      var sec_num = parseInt(sec, 10);
      var hours = _Prtg.Util.padNumber(Math.floor(sec_num / 3600), 2);
      var minutes =
        _Prtg.Util.padNumber(Math.floor((sec_num - hours * 3600) / 60), 2);
      var seconds = _Prtg.Util.padNumber(sec_num - hours * 3600 - minutes * 60, 2);
      if (hours > 0) return hours + ":" + minutes + ":" + seconds;
      else return minutes + ":" + seconds
    },
    calcLimit: function(x, min, max, percentage) {
      var p = percentage || 1,
        w = Math.round(x * p);
      w = w < min ? min : w;
      return w > max ? max : w },
    uniqueIdCounter: 0,
    uniqueId: function(prefix) {
      var id = ++this.uniqueIdCounter + "";
      return prefix ? prefix + id : id },
    b64ToUint6: function(nChr) {
      return nChr > 64 && nChr < 91 ? nChr - 65 : nChr > 96 && nChr < 123 ?
        nChr - 71 : nChr > 47 && nChr < 58 ? nChr + 4 : nChr === 43 ? 62 : nChr === 47 ? 63 : 0
    },
    base64DecToArr: function(sBase64, nBlocksSize) {
      var sB64Enc = sBase64.replace(/[^A-Za-z0-9\+\/]/g, ""),
        nInLen = sB64Enc.length,
        nOutLen = nBlocksSize ? Math.ceil((nInLen * 3 + 1 >> 2) / nBlocksSize) * nBlocksSize : nInLen * 3 + 1 >> 2,
        taBytes = new Uint8Array(nOutLen);
      for (var nMod3, nMod4, nUint24 = 0, nOutIdx = 0, nInIdx = 0; nInIdx < nInLen; nInIdx++) {
        nMod4 = nInIdx & 3;
        nUint24 |= this.b64ToUint6(sB64Enc.charCodeAt(nInIdx)) << 18 - 6 * nMod4;
        if (nMod4 === 3 || nInLen - nInIdx === 1) {
          for (nMod3 = 0; nMod3 <
            3 && nOutIdx < nOutLen; nMod3++, nOutIdx++) taBytes[nOutIdx] = nUint24 >>> (16 >>> nMod3 & 24) & 255;
          nUint24 = 0
        }
      }
      return taBytes
    },
    uint6ToB64: function(nUint6) {
      return nUint6 < 26 ? nUint6 + 65 : nUint6 < 52 ? nUint6 + 71 : nUint6 < 62 ? nUint6 - 4 : nUint6 === 62 ? 43 : nUint6 === 63 ? 47 : 65 },
    base64EncArr: function(aBytes) {
      var nMod3 = 2,
        sB64Enc = "";
      for (var nLen = aBytes.length, nUint24 = 0, nIdx = 0; nIdx < nLen; nIdx++) {
        nMod3 = nIdx % 3;
        if (nIdx > 0 && nIdx * 4 / 3 % 76 === 0) sB64Enc += "\r\n";
        nUint24 |= aBytes[nIdx] << (16 >>> nMod3 & 24);
        if (nMod3 === 2 || aBytes.length - nIdx === 1) {
          sB64Enc += String.fromCharCode(this.uint6ToB64(nUint24 >>>
            18 & 63), this.uint6ToB64(nUint24 >>> 12 & 63), this.uint6ToB64(nUint24 >>> 6 & 63), this.uint6ToB64(nUint24 & 63));
          nUint24 = 0
        }
      }
      return sB64Enc.substr(0, sB64Enc.length - 2 + nMod3) + (nMod3 === 2 ? "" : nMod3 === 1 ? "=" : "==")
    },
    UTF8ArrToStr: function(aBytes) {
      var sView = "";
      for (var nPart, nLen = aBytes.length, nIdx = 0; nIdx < nLen; nIdx++) {
        nPart = aBytes[nIdx];
        sView += String.fromCharCode(nPart > 251 && nPart < 254 && nIdx + 5 < nLen ? (nPart - 252) * 1073741824 + (aBytes[++nIdx] - 128 << 24) + (aBytes[++nIdx] - 128 << 18) + (aBytes[++nIdx] - 128 << 12) + (aBytes[++nIdx] - 128 << 6) + aBytes[++nIdx] -
          128 : nPart > 247 && nPart < 252 && nIdx + 4 < nLen ? (nPart - 248 << 24) + (aBytes[++nIdx] - 128 << 18) + (aBytes[++nIdx] - 128 << 12) + (aBytes[++nIdx] - 128 << 6) + aBytes[++nIdx] - 128 : nPart > 239 && nPart < 248 && nIdx + 3 < nLen ? (nPart - 240 << 18) + (aBytes[++nIdx] - 128 << 12) + (aBytes[++nIdx] - 128 << 6) + aBytes[++nIdx] - 128 : nPart > 223 && nPart < 240 && nIdx + 2 < nLen ? (nPart - 224 << 12) + (aBytes[++nIdx] - 128 << 6) + aBytes[++nIdx] - 128 : nPart > 191 && nPart < 224 && nIdx + 1 < nLen ? (nPart - 192 << 6) + aBytes[++nIdx] - 128 : nPart)
      }
      return sView
    },
    strToUTF8Arr: function(sDOMStr) {
      var aBytes, nChr, nStrLen =
        sDOMStr.length,
        nArrLen = 0;
      for (var nMapIdx = 0; nMapIdx < nStrLen; nMapIdx++) { nChr = sDOMStr.charCodeAt(nMapIdx);
        nArrLen += nChr < 128 ? 1 : nChr < 2048 ? 2 : nChr < 65536 ? 3 : nChr < 2097152 ? 4 : nChr < 67108864 ? 5 : 6 }
      aBytes = new Uint8Array(nArrLen);
      for (var nIdx = 0, nChrIdx = 0; nIdx < nArrLen; nChrIdx++) {
        nChr = sDOMStr.charCodeAt(nChrIdx);
        if (nChr < 128) aBytes[nIdx++] = nChr;
        else if (nChr < 2048) { aBytes[nIdx++] = 192 + (nChr >>> 6);
          aBytes[nIdx++] = 128 + (nChr & 63) } else if (nChr < 65536) {
          aBytes[nIdx++] = 224 + (nChr >>> 12);
          aBytes[nIdx++] = 128 + (nChr >>> 6 & 63);
          aBytes[nIdx++] =
            128 + (nChr & 63)
        } else if (nChr < 2097152) { aBytes[nIdx++] = 240 + (nChr >>> 18);
          aBytes[nIdx++] = 128 + (nChr >>> 12 & 63);
          aBytes[nIdx++] = 128 + (nChr >>> 6 & 63);
          aBytes[nIdx++] = 128 + (nChr & 63) } else if (nChr < 67108864) { aBytes[nIdx++] = 248 + (nChr >>> 24);
          aBytes[nIdx++] = 128 + (nChr >>> 18 & 63);
          aBytes[nIdx++] = 128 + (nChr >>> 12 & 63);
          aBytes[nIdx++] = 128 + (nChr >>> 6 & 63);
          aBytes[nIdx++] = 128 + (nChr & 63) } else {
          aBytes[nIdx++] = 252 + nChr / 1073741824;
          aBytes[nIdx++] = 128 + (nChr >>> 24 & 63);
          aBytes[nIdx++] = 128 + (nChr >>> 18 & 63);
          aBytes[nIdx++] = 128 + (nChr >>> 12 & 63);
          aBytes[nIdx++] =
            128 + (nChr >>> 6 & 63);
          aBytes[nIdx++] = 128 + (nChr & 63)
        }
      }
      return aBytes
    }
  }
})(jQuery);
;
// _Prtg.Events.js
(function($, window, document, undefined) {
	var pluginName = "Events"
		,	domain = '.' + pluginName.toLowerCase() + '.prtg'
		, defaults = {
			refreshInterval: 5
		};

	function Events(element, options) {
		this.id = $.now();
		this.$ = $({});
		this.element = element;
		this.options = $.extend({}, defaults, options);
		this._defaults = defaults;
		this.master = _Prtg.Events;

		this.timerId = null;
    this.refreshCounter = 0;
		this.running = false;
		this.currentTime = this.options.refreshInterval;
		if(this.options.refreshType === "none") {
			if(!this.master)
				$('#quickbar .icon-refresh').on('click', function(e) {
					e.stopImmediatePropagation();
					window.location.reload();
				});
		} else if(typeof(options) === "object" ) this.init();
	}

	Events.prototype.init = function() {
		var self = this;
		if (!this.master) {
			this.master = this;
			this.clockContainer = document.getElementById("footerrefreshclock");
			this.$serverClock = $("footer .serverclock");
			this.start(this.options.refreshInterval);
		} else {
			this.master.subscribe('refresh'+domain, $.proxy(this.refresh, this));
			this.master.subscribe('navigate.prtg', $.proxy(this.refresh, this));
		}
	};

	Events.prototype.refresh = function triggersubevents(e) {
		var args = Array.prototype.slice.call(arguments);
		args.shift();
		this.$.triggerHandler(e.type, args);
	};

	Events.prototype.start = function(refreshTime) {
		var self = this;
    if(this.refreshCounter >= 120
    && $('form.prtg-form,#mapeditor,tct[data-role="guru"]').length === 0)
    	document.location.reload();
    if(!!refreshTime){
		  this.currentTime = parseInt(refreshTime, 10) || 30;
      this.options.refreshInterval = this.currentTime;
    }
		if (!this.running) {
			this.running = true;
			if(this.clockContainer) this.clockContainer.innerHTML = this.currentTime;
			this.publish("start" + domain);
			this.timerId = setInterval(function() {
				self.tick.call(self);
			}, 1000);
		}
		return this;
	};

	Events.prototype.pause = function(trigger) {
		if (this.running) {
			this.running = false;
			clearInterval(this.timerId);
			this.publish((trigger || "pause") + domain);
		}
		return this;
	};

	Events.prototype.stop = function(trigger) {
		if (this.running) {
			this.running = false;
			clearInterval(this.timerId);
			if(trigger != undefined && this.options.refreshType === "wholepage") {
				document.location.reload();
			} else {
        this.publish.call(this,(trigger || "stop") + domain);
      }
		}
		return this;
	};

	Events.prototype.resume = function() {
    var self = this;
    if (!this.running) {
      this.running = true;
     if(this.clockContainer) this.clockContainer.innerHTML = this.currentTime;
      this.publish("start" + domain);
      this.timerId = setInterval(function() {
        self.tick.call(self);
      }, 1000);
    }
    return this;
	};

  Events.prototype.tick = function() {
		if(this.clockContainer) this.clockContainer.innerHTML = --this.currentTime;
		if (this.currentTime === 0) {
      this.publish('playalarm.events.prtg');
			this.stop('refresh');
      this.refreshCounter = this.refreshCounter + 1;
		}
		return this;
	};

  Events.prototype.reset = function() {
		this.currentTime = this.options.refreshInterval;
		return this;
	};

	Events.prototype.subscribe = function() {
		this.$.on.apply(this.$, arguments);
		return this;
	};

  Events.prototype.unsubscribe = function() {
		this.$.off.apply(this.$, arguments);
		return this;
	};

  Events.prototype.publish = function() {
		this.$.trigger.apply(this.$, arguments);
		return this;
	};

  Events.prototype.subscribeOnce = function() {
		this.$.one.apply(this.$, arguments);
		return this;
	};

	$.fn[pluginName] = function(options, parent) {
		var me = this[0]
			, ret = $.data(me, "plugin_" + pluginName);
		if (!ret) {
			ret = new Events(me, options, parent);
			$.data(me, "plugin_" + pluginName, ret);
		}
		return ret;
	};

})(jQuery, window, document);
;
//_Prtg.ChannelGauges.Plugin.js
(function($, window, undefined) {
	var connectionTrys = 0,
		maxConnectionTrys = 2,
		pluginName = 'refreshable',
		pipe = null,
		parent = null;

	function Refreshable(elements, parent) {
		$.each(elements,function(){
			var data = $(this).data();
			if(!data.hasOwnProperty('refreshInterval'))
				data.refreshInterval = 0;
			if(!data.hasOwnProperty('lastRefresh'))
				data.lastRefresh = 0;
			data.refreshing = false;
		});
		this.elements = elements;
		this.$parent = $(parent);
		this.timer = this.$parent.Events();
		this.init(this);
	}

	Refreshable.prototype.init = function(me) {
		this.timer.subscribe('refresh.events.prtg',$.proxy(this.refreshables, this));
		if(this.timer !== _Prtg.Events)
			this.timer.subscribeOnce('navigate.prtg', $.proxy(function(e){
				if ( !!pipe && pipe.abort)
					pipe.abort();
				this.timer.unsubscribe('refresh.events.prtg',$.proxy(this.refreshables, this));
			}, this));
	};

	Refreshable.prototype.add = function add(elements) {
		$.each(elements,function(){
			var data = $(this).data();
			if(!data.hasOwnProperty('refreshInterval'))
				data.refreshInterval = 0;
			if(!data.hasOwnProperty('lastRefresh'))
				data.lastRefresh = 0;
			data.refreshing = false;
		});
		$.merge(this.elements,elements);
	};

	Refreshable.prototype.refreshables = function refreshables(e) {
		var me = this
			, t = (new Date()).getTime();
		// if ((_Prtg.Options.connectionCheck.getTime() + _Prtg.Options.refreshInterval * 1000) <= t - t%100) {
				connectionTrys = 0;
				$("#footerrefresh").find(".refreshclock").hide().end().find(".refreshinglable").show();
				if(!pipe)
					pipe = me.connectionCheck();
				// else
					// pipe = pipe.pipe(function(){return me.connectionCheck();});
		// }
		pipe = (pipe || $.when(me.$parent)).pipe(
			function refreshAll() {
				var deferreds = $.map(me.elements, function(e,i){
					var $elm = $(e)
						, data = $elm.data();
          if(data.hasOwnProperty('lastRefresh') && !data.refreshing){
            data.lastRefresh += _Prtg.Options.refreshInterval;
            if(e && data.lastRefresh >= data.refreshInterval) return me.refresh($elm, data, me, i);
          }
          data = null;
          $elm = null;
				});

				if(!!pipe || deferreds.length !== 0)
					return $.when.apply($,
						deferreds
					).then(
						function allDone(){
							$('body .tooltip, body .popover').remove();
							pipe = null;
              _Prtg.Events.reset().resume();
							$("#footerrefresh").find(".refreshclock").show().end().find(".refreshinglable").hide();
						},
						function oneFailed(){
							$('body .tooltip, body .popover').remove();
							pipe = null;
              _Prtg.Events.reset().resume();
							$("#footerrefresh").find(".refreshclock").show().end().find(".refreshinglable").hide();
						}
					);
				else pipe = null;
			},
			function connectionCheckFailed(){
				pipe = null;
			}).always(function(){pipe=null;});
	};

	Refreshable.prototype.refresh = function refresh(o, d ,me , index) {
		var $obj = o,
			data = d,
			url = $obj.attr("refreshurl");

		if (!url) return $.when(o);
		else{
			data.refreshing = true;
			return $.ajax({
					url: url,
					type: 'GET',
		      dataType: 'html',
					beforeSend: function(jqXHR, settings) {
						_Prtg.Tip.killPopups();
						jqXHR.peNumber = 'PE1114';
					}
				}).done(function success(content, textStatus, jqXHR) {
		      content = $($.parseHTML(content));
					if(content.eq(0).is('.refreshable')) content = content.html();
					$obj.html(content).triggerHandler('refreshed');
					content=null;
					_Prtg.initPlugins($obj);
					data.lastRefresh = 0;
					data.refreshing = false;
				}).fail(function error(jqXHR, textStatus, errorThrown) {
					if(jqXHR.status === 404) me.elements.splice(index,1); //remove from refreshables if not found
				});
		}
	};

	Refreshable.prototype.connectionCheck = function connectionCheck() {
		var me = this;
		return $.ajax({
			url: "/api/public/testlogin.htm",
			type: "GET",
			timeout: 25000,
			global: false,
			beforeSend: function(jqXHR, settings) {
				connectionTrys++;
				jqXHR.peNumber = 'PE1014';
			}
		}).done(function success(data, textStatus, jqXHR) {
			data = data || "";
			if (data.length === 0 || $.trim(data) === "NOTOK") {
				if (connectionTrys < maxConnectionTrys) {
					me.connectionCheck();
					return;
				}
        if(!_Prtg.Options.connectionLost){
          _Prtg.Options.connectionLost = window.connectionLost = true;
          setTimeout(function(){
				    _Prtg.Dialogs.connectionLost('/api/public/testlogin.htm failed twice (Timeout PE1014)');
          },500);
        }
			} else {
				_Prtg.Options.connectionCheck = new Date();
			}
		}).fail(function error(jqXHR, textStatus, errorThrown) {
			if (connectionTrys < maxConnectionTrys) {
				me.connectionCheck();
				return;
			} else {
        if(!_Prtg.Options.connectionLost){
          _Prtg.Options.connectionLost = window.connectionLost = true;
          setTimeout(function(){
  				  _Prtg.Dialogs.connectionLost('/api/public/testlogin.htm failed twice (PE1114, ' + textStatus + ', ' + errorThrown + ')');
          },500);
        }
			}
		});
	};
	Refreshable.prototype.now = function now() {
		_Prtg.Events.reset();
	};

	$.fn[pluginName] = function(parent) {
		var elements = $.makeArray(this);
		if(elements.length)
			if (!$.data(parent, "plugin_" + pluginName)) {
				$.data(parent, "plugin_" + pluginName, new Refreshable(elements, parent));
			} else {
				$.data(parent, "plugin_" + pluginName).add(elements);
			}
	};
})(jQuery, window, document);
;
// _Prtg.Hjax.js //
(function(_Prtg, $, window, document, undefined) {
  var module_name = "prtg_hjax"
    , namespaces = {}
    , timeout = null
    , sitename = $('<div>'+_Prtg.Options.sitename+'</div>').text();
  // moved to webserver keep here for testing
  //   , url =  document.createElement('a')
  //   , urlStripOff = [
  //         'mapid'
  //       , 'tmpid'
  //       , 'subid'
  //       , 'topnumber'
  //       , 'username'
  //       , 'password'
  //       , 'email_address'
  //   ]
  // ;

  // window.__gaStripOrigin = function(urlString){
  //   var param = [];
  //   url.href = (""+urlString);
  //   param = url.search.replace('?','').split('&');
  //   param = param.filter(function(value){
  //     return (value !== "" && urlStripOff.indexOf(value.split('=')[0]) === -1)
  //   });
  //   return url.pathname + (param.length === 0 ? '' : '?' +  param.join('&'));
  // };


  History.Adapter.bind(window, 'statechange', function(e) {
    var State = History.getState();
    e.stopImmediatePropagation(); // Für was?
    if (State.data.namespace && namespaces[State.data.namespace]) {
      var namespace = namespaces[State.data.namespace];
      namespace.handler.call(namespace.context, namespace.data, State, e);
    } else {
      loadLink(State.url, State.data);
    }
  });

  function bind(namespace, handler, context, data) {
    if (typeof(handler) !== "function") throw new Error("State handler must be a function!");
    namespaces[namespace] = {
      handler: handler,
      data: data || {},
      context: context || null
    };
  }

  function unbind(namespace) {
    delete namespaces[namespace];
  }
  /*
    Call navigate({
      url: "myurl",
      container: "selector",
      namespace: "meinnamespace fuer handler",
      data: {
        myadditional: data
      }
    })
   */
  function navigate() {
    var url;
    var container;
    var namespace;
    var data;

    _Prtg.xhrManager.xhrabort();

    if(typeof arguments[0] === 'object') {
      url = arguments[0].url || "";
      container = arguments[0].container || "#container";
      namespace = arguments[0].namespace || "linkloader.prtg";
      data = arguments[0].data || {};
    } else return;
    History.pushState({
      container: container,
      namespace: namespace,
      data: data
    }, window.title, url.split('#')[0]);

  }


  function loadLink(url, stateData) {
    var $container;
    var edata = stateData.data;
    var dataurl;
    var data = {_hjax: true};

    if(_Prtg.Util.getUrlVars()['showtiming'] === '1') _Prtg.Options['showtiming'] = 1;
    if(!!_Prtg.Options.showtiming) data['showtiming'] = 1;

    _Prtg.Events.publish('navigate.prtg', stateData.container);

    // Wenn kein container übergeben -> default #container verwenden.
    // Wenn container übergeben -> zu jquery objekt machen, wenn es noch keins sein sollte.
    $container = (!stateData.container) ? $("#container") // container nicht gesetzt -> default (#container)
    :(!(stateData.container instanceof jQuery)) ? $(stateData.container) : stateData.container; // container gesetzt, jquery check

    if(!!edata && edata.url) {
      //extract data-url and propably new container from hash
      dataurl = edata.url.split('#');
      dataurl = dataurl[0] + '?' + url.split('?')[1] + (dataurl.length <= 1 ? '&' : ($container=$('#'+dataurl[1]), '#'+dataurl[1]));
    } else {
      dataurl = url;
      try { 
        _Prtg.Plugins["crumblerSensorStats"].plugin.id = (_Prtg.Util.getUrlParameters(dataurl)['id'] || null);
      } catch(e) {}
    }

    _Prtg.Tip.killPopups();

    $(window).scrollTop(0);
    if($container.find('.loadspinner').length == 0) {
      
      $container.html('<div class="loadspinner"></div>')
    }
    $container.addClass('loading');

    
    return $.ajax({
      url: dataurl,
      dataType: "html",
      data: data,
      beforeSend: function(jqXHR) {
        jqXHR.peNumber = 'PE1113';
      },
      success: function(data, textStatus, jqXHR) {
        var $data = $('<div/>');
        $container.removeClass('loading').removeData().children().remove();
        if(!!edata && edata.url) {
          $data.html($(data).html());
        } else {
          $data.html(data);
        }
        timeout = null;

        var CurrentTitle = window.title = document.title;
        window.title = document.title = $data.find("[data-title]").attr("data-title") + ' | ' +  sitename;
        _Prtg.Events.publish('refresh.events.prtg');
        $container.empty().append($data);
        _Prtg.SetupPage($container);
        !!window.__ga && window.__ga('send','pageview', window.__gaStripOrigin(dataurl));
        _Prtg.Events.publish('loaded.events.prtg', $container, stateData.data);

        if (inIframe()) {
          $('footer').remove();
          $('header').remove();
          $('#header_breadcrumbs').remove();
        }
          
      }
    });
  }

  function inIframe () {
    try {
      return window !== window.top;
    } catch (e) {
      return true;
    }
  }

  window.onmessage = function (event){
    navigate({
      url: event.data.url
    })
  }

  function linkClickHandler(e) {
    var $me = $(this);
    var data = (!!$me.data() && !!$me.data().url && {url:$me.data().url}) || {};

    if (inIframe()) {
      var navTo = {
        url: $me.attr('href'),
        data: data
      }
      window.top.postMessage(navTo, '*')
    }

    if ((e.ctrlKey||e.metaKey)) return; // Wenn strg gedrückt, den default handler ausführen (neuer browsertab)
    if ($me.hasClass("logout") || $me.attr('href') === undefined || $me.attr('href')==="/home") return;
    if (window.winGUI === true) {
      window.location.href = e.currentTarget.href;
      return;
    }
    if(!!timeout) return;
    timeout = e;
    e.preventDefault();
    if (!e.data) throw new Error("Hjax.linkHandler: event.data missing namespace and container");
    else navigate({
      url: $me.attr('href'),
      container: e.data.container,
      namespace: e.data.namespace,
      data: data
    });
    return false;
  }

  $.extend(true, window, {
    _Prtg: {
      Hjax: {
        loadLink: function(url, namespace, container, data) {
          return navigate.call(null, {
            url: url || "",
            namespace: namespace || "linkloader.prtg",
            container: container || "#container",
            data: data || null
          });
        },
        bind: bind,
        unbind: unbind,
        navigate: navigate
      }
    }
  });

  $(document).on('click.hjax.prtg', '#header_menu a:not(.nohjax,[href*=":"]), #crumblersensorstats a:not(.nohjax,[href*=":"]), #main a:not([href^="#"], [href*=":"], [target], [onclick], .nohjax, .as-dialog), #header_breadcrumbs a:not(.nohjax), #mainstuff a:not([href^="#"], [href*=":"], [target], [onclick], .nohjax, .as-dialog)', {
    namespace: "linkloader.prtg",
    container: "#container"
  }, linkClickHandler);

})(_Prtg, jQuery, window, document);

/* prtg-tabs plugin */
/* Handling of Tabs with Ajax and History support. */

// TODO: Wenn ein tab geklickt wird wärend ein anderer noch lädt, das laden abbrechen!
// TODO: wenn element jquery object, das erkennen und damit umgehen.
(function ($, window, document, undefined) {
  var module_name = Plugin.module_name = 'prtg-tabs';

  function Plugin(element, data, parent) {
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.data = data;
    this.$tabs = this.$el.find('.nav-tabs').find('li:not(.inline)');
    this.$tabcontainer = (this.$el.find('.tab-container').length <= 0) ? this.createTabContainer() : this.$el.find('.tab-container');
    this.$parent = (!(parent instanceof jQuery)) ? $(parent) : parent;
    this.currentTab = 0;
    this.namespace = module_name + window.location.pathname;
    this.history = !(this.$el.data() || { noHistory:false }).noHistory;
    this.$tabs.find('a').addClass('nohjax'); // inline tabs eg sensor settings dialog
    if (this.$tabs.length > 0)
      if (this.data.noHistory) {
        this.activateTab(1);
        this.initEvents();
      } else {
        this.init();
      }
  }

  Plugin.prototype.init = function () {
    var urlTabid = parseInt(_Prtg.Util.getUrlVars()['tabid'], 10), urlCache = window.location.href;

    if (this.history)_Prtg.Hjax.bind(this.namespace, this.historyHandler, this, { self: this });

    // Wenn die tabid aus der url im dom nicht vorhanden ist oder die tabid fehlt: den ersten laden.
    if ((isNaN(urlTabid) || this.$tabs.filter('[tabid="' + urlTabid + '"]').length < 1)) {
      urlCache = urlCache.replace(/&tabid=[a-zA-Z0-9]+/, '').replace(/tabid=[a-zA-Z0-9]+&/, '').replace(/\?tabid=[a-zA-Z0-9]+$/, '');
      urlCache += (urlCache.indexOf('?') > -1 ? '&' : '?') + 'tabid=' + 1;

      // Ersetzt die falsche tabid in der url und in der History.
      if (window.title === undefined) window.title = document.title;
      History.replaceState({
        tabid: 1,
        namespace: this.namespace
      }, window.title, urlCache.split('#')[0]);
    }

    this.activateTab(urlTabid);
    this.initEvents();
  };

  Plugin.prototype.destroy = function () {
    if (this.history)_Prtg.Hjax.unbind(this.namespace);
  };

  Plugin.prototype.initEvents = function () {
    var self = this;
    this.$tabs
      .off('click', this.tabClick)
      .on('click', { self: this }, this.tabClick);
    this.$el
      .on('destroyed', $.proxy(self.destroy, self));
  };

  Plugin.prototype.historyHandler = function (data, state, e) {
    var self = data.self;
    if (state.data.tabid !== self.currentTab) {
      self.activateTab(state.data.tabid);
    } else if (!self.$el.is(':visible')) {
      _Prtg.Hjax.loadLink(state.cleanUrl, this.namespace);
    }
  };

  // Click event Handler
  Plugin.prototype.tabClick = function tabClick(e) {
    e.stopImmediatePropagation();
    e.preventDefault();

    var $tab = $(e.currentTarget);
    e.data.self.activateTab($(this).attr('tabid'), true);

    return false;
  };

  Plugin.prototype.createTabContainer = function () {
    var tab = $('<div />', {class: 'tab-container loading'});

    return $('<div />', {
      class: 'loadspinner'
    }).appendTo(tab).appendTo(this.$el);
  };

  Plugin.prototype.activateTab = function (tabindex, push) {
    var tab = this.$tabs.filter('[tabid="' + tabindex + '"]');
    var cld = this.$tabcontainer.children();

    if (tab.length <= 0) return;
    this.currentTab = tabindex;

    // PushState - History/Backbutton Handling
    // Nur wenn push true, damit nur bei klicks ein history eintrag erzeugt wird.
    // Verhindert beim laden mit tabid in der url, das tab 1 in die history geschrieben wird.
    if (this.history && push) {
      var argumentsCache = window.location.href;
      if (_Prtg.Util.getUrlParameters(argumentsCache)['tabid'] !== undefined) {
        // TODO: tabid=abc geht nicht wenn in der URl;
        argumentsCache = argumentsCache.replace(/tabid=[a-zA-Z0-9]+/, 'tabid=' + tabindex);
      } else {
        argumentsCache = argumentsCache + (argumentsCache.indexOf('?') > -1 ? '&' : '?') + 'tabid=' + tabindex;
      }

      if (window.title === undefined) window.title = document.title;
      History.pushState({
        namespace: this.namespace,
        tabid: tabindex
      }, window.title, argumentsCache.split('#')[0]);
    }

    this.$tabs.filter('.tab-active').removeClass('tab-active');
    tab.addClass('tab-active');

    if (cld.length) {
      this.$tabcontainer.find('#loadedcontent').Events().publish('navigate.prtg', parseInt(tabindex, 10));
      cld.remove(); 
    }

    if (tab.find('a').attr('href') && tab.find('a').attr('href') !== '') {
      var self = this;
      var loadurl = tab.find('a').attr('href');
      var hash = loadurl.split('#');
      if (hash.length === 2) hash = '#' + hash[1];
      else hash = false;

      if (!!_Prtg.Options.showtiming) {
        loadurl += (loadurl.indexOf('?') > -1 ? '&' : '?')  + 'showtiming=1';
      }

      _Prtg.Tip.killPopups();
      _Prtg.xhrManager.xhrabort(true);
        self.$tabcontainer.append('<div class="loadspinner"></div>');
      self.$tabcontainer.addClass('loading');
      _Prtg.Events.publish('navigate.tab.prtg');
      $.ajax({
        url: loadurl,
        dataType: 'html',
        beforeSend: function (jqXHR) {
          jqXHR.peNumber = 'PE1111';
        },

        success: function (data, textStatus, jqXHR) {
          self.$tabcontainer.removeClass('loading');
          if (!hash) {
            self.$tabcontainer.html('<div id="loadedcontent">' + data + '</div>');
          } else {
            self.$tabcontainer.html('<div id="loadedcontent">' + $(data).find(hash).html() + '</div>');
          }

          _Prtg.SetupPage(self.$tabcontainer.find('#loadedcontent')); // Entkoppeln
          !!window.__ga && window.__ga('send', 'pageview', window.__gaStripOrigin(loadurl));
          _Prtg.Events.publish('tabloaded.events.prtg', self.$tabcontainer);
          var tabName = tab.attr('tab-name');
          if(tabName)
            _Prtg.decorateWitchPageIdentifier(tabName, self.$tabcontainer, 'tab-content');
          else
            _Prtg.removePageIdentifiers(self.$tabcontainer, "tab-content");
        }
      });
    }
  };

  _Prtg.Plugins.registerPlugin(module_name, Plugin);
})(jQuery, window, document);

/*
  Call with: _Prtg.Growls.add(options)
  Options:
    type: info/... ---> css .prtg_growl_ + type
    title: the title of the growl.
    message: message th growl wil show.
    time: time in seconds for how long the growl shows.
*/
(function(_Prtg, $, window, document, undefined) {

  var growls = [],
    $growl_container;

  function growlInit() {
    $growl_container = $("#prtg_growls");

    if ($growl_container.length === 0) {
      $growl_container = $("<div />", {
        id: "prtg_growls"
      });
      $("body").append($growl_container);
    }
    $growl_container.on("click", ".prtg_growl", function() {
      $(this).fadeOut(700, function() {
        $(this).remove();
      });
    });
  }

  function addGrowl(options) {
    if ($growl_container === undefined) growlInit();
    var type = options.type || "info",
      title = options.title || "",
      message = options.message || "",
      time = options.time || parseInt((_Prtg.Options.refreshInterval / 3), 10),
      id = options.id || null,
      $growl = $("<div/>", {
        "id": id || '',
        "class": "prtg_growl prtg_growl_" + type
      });

      if(!!id && $growl_container.find('#'+id).length > 0) {
        $growl = $growl_container.find('#'+id);
        clearTimeout($growl.data('timer'));
        $growl.find('.prtg_growl_content')
        .html(message)
        .end()
        .data('timer',
          setTimeout(function() {
            destroyGrowl($growl);
            $growl = null;
          }, time * 1000)
        );
        return $growl;
      } else {
        if (title !== "") {
          $growl.append('<div class="prtg_growl_title">' + title + '<i id="closehelp" class="flr icon-dark ui-button-icon-primary ui-icon ui-icon-closethick"></i></div>');
        }
        $growl.append('<div class="prtg_growl_content">' + message + '</div>')
        .data('timer',
          setTimeout(function() {
            destroyGrowl($growl);
            $growl = null;
          }, time * 1000)
        );
      $growl_container.prepend($growl);
      return $growl_container.find('#'+id);
    }
  }

  function destroyGrowl($growl) {
    $growl.fadeOut(700, function() {
      $(this).remove();
    });
  }

  growlInit();
  $.extend(true, window, {
    _Prtg: {
      Growls: {
        add: addGrowl
      }
    }
  });
})(_Prtg, jQuery, window, document);

(function($) {
    var $ptip = null,
        hoveredA = null,
        activeA = null,
        showTimer = 0,
        loadurl = "",
        animating = false,
        position = null,
        settings = null,
        defaultSettings = {
            "delayShow": 333,
            "timeAnimation": 250,
            "width": 700,
            "height": 550,
            "parent": window
        },
        customSettings;

    $(document).keyup(function(e) {
        if (e.which == 27)
            $.fn.ptip.kill();
    });
    var self;
    if (!$.fn.ptip) {
        self = $.fn.ptip = {
            install: function() {
                settings = $.extend(true, {}, defaultSettings, customSettings || {});
                $ptip = $('<div id="ptip"><div class="body"></div></div>');
                $ptip
                    .hide()
                    .mouseleave(this.hide)
                    .appendTo($('body'))
                    .on('click', '.buttonbox a', self.onToolbarClick);

                $('body')
                    .on({
                        "mouseenter": self.onEnterA,
                        "mouseleave": self.onLeaveA
                    }, "a.sensormenu:not('.nopopup'),a.locationlist,a.devicemenu:not('.nopopup'),a.groupmenu:not('.nopopup'),a.rootgroupmenu:not('.nopopup'),a.probemenu:not('.nopopup')")
                    .on('navigate.prtg', function() { self.kill(); });
            },
            onEnterA: function(e) {
                if (animating || (!!_Prtg.Contextmenu.menu && _Prtg.Contextmenu.menu.children().first().is(':visible'))) // || $(this).is(".menuleft"))
                    return false;
                else
                    self.stopShowTimer();
                position = { left: e.pageX - 10, top: e.pageY - 10, width: 0, height: 0 };
                hoveredA = this;
                $(hoveredA).on('mousemove.ptip', function(e) {
                    position = { left: e.pageX - 10, top: e.pageY - 10, width: 0, height: 0 };
                });
                showTimer = setTimeout(function() {
                    $(hoveredA).off('.ptip');
                    self.show.apply(hoveredA, [position]);
                }, settings.delayShow * ((e.offsetX || e.originalEvent.layerX) > 16 ? 10 : 1));
            },
            onLeaveA: function() {
                // if (showTimer)
                self.stopShowTimer();
                $(hoveredA).off('mousemove.ptip');
            },
            onToolbarClick: function(e) {
                e.preventDefault();
                $ptip.hide();
                _Prtg.Contextmenu.bindings[$(this).attr("href")].call(activeA, activeA);
            },
            onScaleComplete: function() {
                animating = false;
                $('body').off('mousemove.ptip');
            },
            stopShowTimer: function() {
                clearTimeout(showTimer);
                showTimer = 0;
            },
            setPosition: function(position) {
                var $viewport = $(settings.parent),
                    viewportOffset = $viewport.offset() || { top: -10, left: -10 };

                viewportOffset.top += $viewport.scrollTop();
                viewportOffset.left += $viewport.scrollLeft();

                if(position.left + settings.width > viewportOffset.left + $viewport.outerWidth()
				|| position.left < viewportOffset.left){
					position.left =  viewportOffset.left + $viewport.outerWidth() - settings.width;
					position.left = position.left  < viewportOffset.left ? viewportOffset.left : position.left;
				}
				if(position.top + settings.height > viewportOffset.top + $viewport.outerHeight()
				|| position.top < viewportOffset.top)
				{
					position.top = viewportOffset.top + $viewport.outerHeight() - settings.height;
					position.top = position.top < viewportOffset.top ? viewportOffset.top : position.top;
				}
            },
            getBody: function($object) {
                var myurl = "";
                var type = 0;
                var myid = $object.attr('id') || $object.attr('objid') || $object.attr('data-id');
                var graph = '';
                var title = '';
                var fixed = $object.is(".fixed") || '';
                var html;
                var tooltipContext;

                if ($object.is(".sensormenu")) {
                    type = 1;
                    cmdPrefix = 'sensor';
                    myurl = '/controls/sensortooltip.htm?id=' + myid;
                    tooltipContext = 'sensor';
                } else if ($object.is(".locationlist")) {
                    type = 0;
                    cmdPrefix = '';
                    myurl = $object.attr('href').replace(/device/g, 'geomapdevice');
                    title = $object.parent().attr('data-title') || $object.parent().attr('title');
                    tooltipContext = 'locationlist';
                } else if ($object.is(".devicemenu")) {
                    type = 2;
                    cmdPrefix = 'device';
                    myurl = '/controls/devicetooltip.htm?id=' + myid;
                    tooltipContext = 'device';
                } else if ($object.is(".sensorsmenu")) {
                    type = 0;
                    cmdPrefix = '';
                    myurl = '/controls/devicestooltip.htm?id=' + myid;
                    tooltipContext = 'sensor';
                } else if ($object.is(".filtermenu")) {
                    type = 0;
                    cmdPrefix = '';
                    myurl = $object.attr('href').replace(/filter.htm/g, '/controls/libraryfiltertooltip.htm');
                    tooltipContext = 'filtermenu';
                } else if ($object.is(".groupmenu")) {
                    type = 3;
                    cmdPrefix = 'group';
                    myurl = '/controls/grouptooltip.htm?id=' + myid;
                    tooltipContext = 'group';
                } else if ($object.is(".probemenu")) {
                    type = 4;
                    cmdPrefix = 'probe';
                    myurl = '/controls/grouptooltip.htm?id=' + myid;
                    tooltipContext = 'probe';
                } else if ($object.is(".rootgroupmenu")) {
                    type = 4;
                    cmdPrefix = 'rootgroup';
                    myurl = '/controls/groupdata.htm?id=' + myid;
                    tooltipContext = 'root-group';
                }
                var toolbar = "<div class='ptip-toolbar'><a class='tab'>" + title + "</a><div class='buttonbox'>";

                if (type > 0) {
                    if (!_Prtg.Options.userIsReadOnly) {
                        var ids = [cmdPrefix + "detail", cmdPrefix + "edit", cmdPrefix + "notifications", cmdPrefix + "rename", "pausenowcomment", "resumenow", fixed + "dodelete", "check", "addfavorite", "removefavorite"];
                        for (var i = 0; i < ids.length; i++) {
                            var itm = _Prtg.Contextmenu.menuCommands[ids[i]];
                            if (!!itm)
                                toolbar += "<a href='" + itm.id + "' class='" + itm.id + "' title='" + itm.caption + "'><i class='icon-dark " + itm.ui + "'/></a>";
                        }
                    }
                }
                toolbar += "</div></div>";
                html = toolbar + '<div class="content"><div class="ptip-loaded-content loading ' + (tooltipContext ? tooltipContext + '-context' : '') + '" loadurl="' + myurl + '"><div class="loadspinner"></div></div></div>';
                loadurl = myurl;
                return html;
            },
            hide: function() {
                !!$ptip && $ptip.hide();
            },
            show: function(position) {
                var a = $(this),
                    x = position.left,
                    y = position.top;

                self.stopShowTimer();
                hoveredA = null;
                if (a.parents("#ptip").length > 0 || _Prtg.Options.connectionLost) return;
                $ptip
                    .css("opacity", 0)
                    .attr("class", a.attr("class"))
                    .children()
                    .first()
                    .html(self.getBody(a))
                    .end()
                    .find(".tab")
                    .attr("href", a.attr("href"))
                    .html(a.text() || undefined)
                    .css('cssText',
                        "background-image:" + a.css("background-image") + ";"
                    )
                    .addClass('newtree');
                if ($ptip.find(".tab").css("background-position").indexOf('%') > -1)
                    $ptip.find(".tab").css("background-position", "");
                $ptip.find('.loading').load(loadurl, { _hjax: true },
                    function() {
                        $(this).removeClass('loading');
                        _Prtg.initPlugins($ptip);
                    });
                self.setPosition(position);

                $('body').on('mousemove.ptip', function(e) {
                    if (e.pageX < position.left ||
                        e.pageY < position.top)
                        self.kill();
                });

                animating = true;
                $ptip
                    .show()
                    .css("top", y)
                    .css("left", x)
                    .animate({
                            top: position.top,
                            left: position.left,
                            opacity: 1
                        },
                        settings.timeAnimation,
                        self.onScaleComplete);
                activeA = a;
            },
            kill: function() {
                self.hide();
                self.stopShowTimer();
                $(hoveredA).off('.ptip');
                $('body').off('.ptip');
                hoveredA = null;
            },
            killPopups: function() {
                $.fn.ptip.kill();
                $('body .tooltip, body .popover').remove();
                $('#jqContextMenu').hide();
            },
            setCustomOptions: function(options) {
                customSettings = options || {};
            }
        };
    }
    _Prtg.Tip = self;
})(jQuery);
//TODO: bind only when window has focus?;
// _Prtg.ContentList.Plugin.js
(function ($, window, document, undefined) {

    function formSchedule(element) {
        var $element = (!(element instanceof jQuery)) ? $(element) : element;
        var table,
            buttons,
            actionTypes;

        this.init($element);
    }

    formSchedule.prototype.init = function ($el) {
        var Schedule = this;

        Schedule.table = $el;
        Schedule.buttons =  Schedule.table.find('.schedulebutton');
        Schedule.actionTypes = {
            on: 'ON',
            off: 'OFF'
        };

        Schedule.bindToggleElements(Schedule);
        Schedule.determineDefaultState(Schedule);
        Schedule.determineCheckboxesState(Schedule);
    };

    formSchedule.prototype.determineDefaultState = function (Schedule) {
        Schedule.buttons.each(function(i,elem) {
            var button = $(elem),
                targetClass = button.data('targets'),
                checkboxes = Schedule.table.find('input.' + targetClass + ':checked');

            var action = (checkboxes.length > 0) ? Schedule.actionTypes.off : Schedule.actionTypes.on;

            Schedule.switchButtonText(button, action);

            if(targetClass == 'scheduleAll') {
                button.html(_Prtg.Lang.common.strings.scheduleAll[action]);
            }
        });
    };

    formSchedule.prototype.determineCheckboxesState = function (Schedule) {
        Schedule.table.find('input[type="checkbox"]').change(function(event) {
            var classList = $(event.target).attr('class').split(/\s+/);

            $.each(classList, function(index, classname) {
                if ($('input.'+classname+':not(:checked)').length === 0 ){
                    Schedule.switchButtonText($('[data-targets="'+classname+'"]'), Schedule.actionTypes.off);
                }
                else if ($('input.'+classname+':checked').length  === 0 ) {
                    Schedule.switchButtonText($('[data-targets="'+classname+'"]'), Schedule.actionTypes.on);
                }
            });

        });
    };

    formSchedule.prototype.bindToggleElements = function (Schedule) {

        Schedule.buttons.click(function(e) {
            var button = $(e.target),
                targetClass = button.data('targets'),
                action = button.data('toggle'),
                checkboxes = Schedule.table.find('.' + targetClass);

            if (action == Schedule.actionTypes.on) {
                // need to click, just setting the property won't work
                checkboxes.each(function (i, elem) {
                    if (!$(elem).is(':checked')) {
                        $(elem).click();
                    }
                });
                action = Schedule.actionTypes.off;
            }
            else if (action == Schedule.actionTypes.off) {
                checkboxes.each(function (i, elem) {
                    if ($(elem).is(':checked')) {
                        $(elem).click();
                    }
                });
                action = Schedule.actionTypes.on;
            }

            Schedule.switchButtonText(button, action);

            if(button.data('targets') == 'scheduleAll') {
                button.html(_Prtg.Lang.common.strings.scheduleAll[action]);

                Schedule.buttons.each(function(i, elem){
                    Schedule.switchButtonText($(elem), action);
                });
            }
        });
    };

    formSchedule.prototype.switchButtonText = function(button, action) {
        button.removeClass('OFF');
        button.removeClass('ON');
        button.addClass(action);
        button.data('toggle', action);

        if(button.data('targets') !== 'scheduleAll') {
            button.attr('data-original-title', button.text() + ' ' + _Prtg.Lang.common.strings.buttonstate[action])
        }
    };


    _Prtg.Plugins.registerPlugin("form-schedule", formSchedule);

})(jQuery, window, document);
;
/* _Prtg.Forms.js */
(function ($, window, document, undefined) {
    var pluginName = "prtg-form";

    function prtgForm(element, data, parent) {
        this.data = data;
        this.el = (!(element instanceof jQuery)) ? element : element[0];
        this.$el = (!(element instanceof jQuery)) ? $(element) : element;
        this.namespace = _Prtg.Util.uniqueId('prtgform');
        this.needsserverrestart = false;
        this.dorestart = false;
        this.floatButtonProperties = {};
        this.dataTables = [];
        this.init();
    }
    // PRTG-5769 Disable Browser-Autocomplete for Sensor authentication credentials
    // This method selects all input fields for credentials set them only readonly initially.
    // When the user clicks on one of those fiels they are writable again.
    // This workaround fixes the issue, that the Browser fills credential fiels automatically,
    // regardless of th autocomplete attribute. For more info see here:
    // https://developer.mozilla.org/en-US/docs/Web/Security/Securing_your_site/Turning_off_form_autocompletion#Disabling_autocompletion
    prtgForm.prototype.preventAutocomplete = function() {
        var self = this;
        var setWritable = function (event) {
            var el = $(event.target);
            el.next().css("color", "");
            el.attr("readonly", false);
            event.stopImmediatePropagation();
            // after focus event is fired once it shouldn't get envoked again
            el.unbind("focus");
        }
        var focusOnInput = function(event) {
            var el = $(event.target);
            el.children()[0].focus();
            event.stopImmediatePropagation();
            // after click event is fired once it shouldn't get envoked again
            el.unbind("click");

        }
        var passwordInputs = [].concat(self.$el.find("input[type='password'][data-rule-required='true']"));
        var userNameInputs = [].concat(self.$el.find("input[name*='username'][data-rule-required='true']"));
        var inputs = passwordInputs.concat(userNameInputs);

        var initialValueExists = function(el) {
            return !!el.val();
        }

        for (var i = 0; i < inputs.length; i++) {
            var elementId = "#" + inputs[i].id;
            var element = $(elementId);
            if(!initialValueExists(element)) {
                var parent = element.parent();
                parent.css("cursor", "text");
                parent.on("click", focusOnInput);
                element.attr("readonly", true);
                element.on("focus", setWritable);
            }
        }    
    }
  prtgForm.prototype.init = function() {
    var self = this;
    self.preventAutocomplete();
    this.$el.find('fieldset').wrapInner("<div></div>");
      this.moveHelptext(this.$el);
      this.$el.attr('autocomplete',"off");

    //remove anoying title tip and bind fieldset toggler
    this.$el.removeAttr('title').find('input[type="checkbox"]').not('.data-table').prtgFieldsetToggler();

        // TODO this is only a "fast fix" move output to webserver!!!!
        this.$el.find("textarea.fieldrequired, select.fieldrequired").each(function () {
            var $this = $(this);
            var $icon = $this.next(".required-icon").detach();
            $icon.addClass("textarea-required");
            $this.before($icon);
            $this.addClass("textarea-fieldrequired");
            $this.wrap('<span class="inputfield" />');
        });

        var theme = this.$el.find('#theme2');
        if(theme.length) {
	        var label = this.$el.find('[for="theme2"]');
	        if (!theme.is(':checked')) {
	            var option = theme.clone().add(label.clone());
	            theme.remove();
	            label.siblings().first().addClass('js-insertAnchorelem');
	            label.remove();
	        }
	        this.$el.find('[for^="theme"]').contextmenu(function (e) {
	            e.stopPropagation();
	            if (self.$el.find('#theme2').length == 0) {
	                $('.js-insertAnchorelem').first().before(option.hide());
	                option.fadeIn("slow");
	            }
	        });
        }
        this.$el.find('button[prop]').on('click', function () {
            $(this).replaceWith('<input id="mypasshash" type="text" readonly="readonly" value="' + $(this).attr('prop') + '"></div>');
        });
        this.$el.find('button#newpasshash').on('click', function (event) {
            var userID = $('#objectdataform input[name=id]').val() || location.search.split('id=')[1].split('&')[0], $newpasshashBtn = $(this);

            event.preventDefault();
            $.ajax({
                url: 'api/newpasshash.htm?id=' + userID,
                type: "POST",
                dataType: "html",
                success: function (res) {
                    var msg = _Prtg.Lang.common.strings.newpasshashfail;

                    if (!isNaN(res)) {
                        if ($('#mypasshash').length) {
                            $('#mypasshash').val(res);
                            $('#mypasshash').stop().css("background-color", "#ffffcc").animate({backgroundColor: "#f3f2f2"}, 500, 'easeInCubic');
                        } else {
							$('#showpasshash').click();
                            $('#mypasshash').val(res);
                        }
                        msg = _Prtg.Lang.common.strings.newpasshashsuccess;
                    }

                    $newpasshashBtn.replaceWith('<input disabled="disabled" id="newpasshash" type="text" readonly="readonly" value="' + msg + '"></div>');
                }
            });
        });
        // bind the farbtastic color picker
        this.$el.find('.colorselector').each(function () {
            var $this = $(this);            
            var color = $this.val();
            var pickerElement = $this.parent().append('<div />').children().last();            
                        
            var picker = $.farbtastic(pickerElement, function(color) {                
                var invertColor = function invertColor(hexColor) {
                    var hexValue = hexColor.slice(1); //remove '#'
                    var colorAsInt = parseInt(hexValue, 16);
                    var invertedColorAsInt = 0xFFFFFF ^ colorAsInt;
                    var newHexColor = "#" + invertedColorAsInt.toString(16);
                    return newHexColor;
                };
                
                $this.css("background-color", color);
                $this.css("color", invertColor(color));
                $this.val(color).trigger("change");
            });
            
            $this.on('change.' + self.namespace, function () {                
                picker.setColor($(this).val());
            });

            if ($this.val().length === 0) {                
                $this.val('#000000').trigger('change');
            } else {
                $this.val(color).trigger('change');
            }
        });        
        // Favstars plugin binding
        this.$el.find('#priority_,#priority,input[name="priority_"]').favstarsinput();

        this.$el.find('#tags_,input[name="tags_"],#tagfilter_,#filtertag_,#libtagfilter_').tagsinput({
            "tags": self.getUserTags
        });

        this.$el.find('input[name="parenttags_"]').tagsinput({
            "readonly": true,
            "autocomplete": false
        });

        // Datatables
        var dt = this.$el.find('table.datatables, table.hoverable').not('.prevent-datatables');
        dt.each(function initDataTable() {            
            var rows = $(this).find('tbody tr').length;
            var $me = $(this);            
            var $parent = $me.parent();
            var shouldCollapseHeaders = $me.hasClass('snmptable_');
            var caption = ($me.parent(".controls").data() && $me.parent(".controls").data()['caption'] ? $me.parent(".controls").data()['caption'] : '');
            var options = $.extend(true, self.getDataTableOptions(self,caption, shouldCollapseHeaders, rows), $me.data().options || {});
            if(rows < 1 || $parent.hasClass('readonlyproperty')) return;

            $('.step-3 .add-sensor-box').css('max-width', '100vw');
                
            $me.find('thead th').each(function checkSort(i, elem) {
                var columnOptions = {"contentPadding": "m"};
                if ($(elem).is('.no_sort') || rows > _Prtg.Core.objects.dataTableBigMode) {
                    columnOptions.bSortable = false;                    
                } 
                options.aoColumns.push(columnOptions);

                if (shouldCollapseHeaders && i > 0) {
                    var text = $(elem).text();
                    var cut = text.split(".");

                    $(elem).attr('title', text);

                    if (cut.length > 1){
                    	$(elem).html('..' + cut[cut.length - 2] + '.' + cut[cut.length - 1]);
                  	}
                }
            });

            if(self.$el.data('noscroll')){
                options.scrollX = false
                options.scrollY = false
            }

            $me.on("change", "checkbox", function() {
            	$(this).toggleClass("icon-check");
            })
            if(!$me.is(':visible')) {  //initializing the dataTable before it's visible will reduce it to 40px width
                var interval = setInterval(function waitforVisible() {
                    if($me.is(':visible')) {
                        clearInterval(interval);
                        $me.dataTable().resize();                                 
                    }
                }, 500);
            }
            self.dataTables.push($me.dataTable(options));            
            self.manipulateDataTable(self, $me, options, caption);                              
            $me.removeClass('loading-box');
        });

        if (!this.$el.hasClass('assistent')) {
            this.$el.parents('.ui-dialog').find('.ui-dialog-buttonpane .actionbutton').addClass("button btngrey submit").removeClass("actionbutton ");
        }

        this.initEvents();

        this.$el.find(".fieldrequired").addClass("required");

        this.$el.find("input[editable]").each(function () {
            var $me = $(this);
            $me
                .parent()
                .append('<i class="locked icon-locked">')
                .attr('title', _Prtg.Lang.common.strings.editrequest)
                .attr('data-original-title', _Prtg.Lang.common.strings.editrequest)
                .find('i')
                .on('click.' + self.namespace, function () {
                    var that = $(this);
                    if (that.hasClass('icon-locked')) {
                        if (confirm(_Prtg.Lang.common.strings.editrequest)) {
                            $me.removeAttr('disabled readonly').focus();
                            that.removeClass('icon-locked').addClass('icon-unlocked');
                        }
                    }
                });
        });

        // Focus first input on form
        if (!!!this.data.inline) {
            this.focusFirstInput(this.$el);
        }
        _Prtg.Events.publish("forminitialized.prtg");
    };

    prtgForm.prototype.manipulateDataTable = function manipulateDataTable(self, $me, options, caption, rows) {
    	var currentTable = self.dataTables[self.dataTables.length - 1];
        $me.closest('fieldset,.groupshowhideelement').one('groupshow.' + self.namespace, function (e) {
            var meHeight = $me.height() - 15;
            options.scrollY = meHeight < 1024 ? meHeight + 'px' : "1024px";            
            currentTable.fnAdjustColumnSizing();
        });
        $me.parents('.dataTables_wrapper').find('.dataTables_filter').prepend(caption);

        if ($me.find('input[type="checkbox"]').length) {

        	$me.closest('.control-group').find('.datatablecontrols')
        		.on('click.' + self.namespace, 'a.button', function(event) {
                    event.preventDefault();
        			var type  = "tr";
        			var check = false;
        			if($(event.target).hasClass('table-select-all-connected')){
        				type = '.connected';
                        check = true;
        			} else if ($(event.target).hasClass('table-select-all-not-connected')){
        				type = '.notconnected';
        				check = true;
                    }
                    currentTable.api().rows().nodes().to$().filter(type).find('input').prop("checked", check).trigger("change");
        	});

            $me.on('click.' + self.namespace, 'tr', function (event) {
                var $this = $(this);
                var $checkbox = $this.find("input.checkbox:first");

                if ($(event.target).is('th')) return;
                $checkbox.prop("checked", !$checkbox.is(':checked')).trigger("change");
                $me
                    .parent()
                    .prev()
                    .find('tr th:first-child input:checkbox')
                    .prop('checked', ($me.find('tbody tr td:first-child input').not(":checked").length === 0));

            });
        }
        if ($me.find("tbody tr td:first-child input").not(":checked").length === 0)
        	$me.parent().prev().find('tr th:first-child input:checkbox').prop('checked', true);
    };

    prtgForm.prototype.getDataTableSelectableOptions = function () {
        return {
            create: function (event, ui) {
                $(this).find('td input[type="checkbox"]:checked').each(function (i, elm) {
                    $(elm).parents('tr').addClass('ui-selected');
                });
            },
            start: function () {
                $(this).parents('.dataTables_wrapper').find(".checkboxtoggler").prop("checked", false).trigger("change");
            },
            selecting: function (event, ui) {
                $(ui.selecting).find("input.checkbox:first").prop("checked", true).triggerHandler("change");
            },
            unselecting: function (event, ui) {
                $(ui.unselecting).find("input.checkbox:first").prop("checked", false).triggerHandler("change");
            },
            selected: function (e, ui) {
                $(ui.selected).find("input.checkbox:first").prop("checked", true).trigger("change");
                if ($(this).find("tbody tr td:first-child input").not(":checked").length === 0)
                	$(this).parent().prev().find('tr th:first-child input:checkbox').prop('checked', true);
            },
            filter: "tr",
            distance: 15,
            cancel: "a, input, option, .notselectable, select"
        };
    };

    prtgForm.prototype.getDataTableOptions = function (self,caption,shouldCollapseHeaders, rows) {
        var maxRowsBeforePaging = self.data.issettingsview ? 20 : _Prtg.Core.objects.dataTableBigMode;
        return {
            "paginate": rows > maxRowsBeforePaging,
            "pagingType": "full_numbers",
            "pageLength": 20,
            "lengthChange": false,
            "autoWidth": true,
            "filter": true,
            "sort": rows < _Prtg.Core.objects.dataTableBigMode,
            "order": [],
            "info": false,
            "scrollY": "1024px",
            "scrollX": true,
            "scrollCollapse": true,            
            "aoColumns": [],
            "language": {
           		"paginate": {
           			"first": "",
            		"previous": "",
            		"next": "",
            		"last": ""
            	}
            },
            "fnInitComplete": function () {
                var $me = $(this);
                var $parent = $me.parents('.dataTables_wrapper');
                var $filter = $parent.find(".dataTables_filter");
                var input = $filter.find('label').children('input').addClass('ignore-on-validation');
                if (rows > 5) {
                    input.attr("placeholder", _Prtg.Lang.common.strings.search).detach();
                    $filter.find('label').text('').append('<i class="icon-gray icon-search"></i>').append(input).find('i').on('click.' + self.namespace, function () {
                        $(this).next().val('').trigger((new $.Event('keyup')));
                    });
                } else if (!!caption) {
                    $filter.children().hide();
                } else {
                    $filter.hide();
                }
                $('input:radio[checked="checked"]', this).prop('checked', true);
                $parent.find('.dataTables_scrollHeadInner').css('width', '');

                if (shouldCollapseHeaders) {
                    $('#main.add-sensor-main-container.step-3 .add-sensor-box').css('max-width', 'none')
                }
            },
            'fnDrawCallback': function(){
                var $wrapper = $(this).parents('.dataTables_wrapper');
                var dataTablesScrollContainer = $wrapper.find('.dataTables_scroll')
                var scrollHead = $wrapper.find('.dataTables_scrollHead');
                var scrollBody = $wrapper.find('.dataTables_scrollBody');

                scrollBody.css('width', scrollBody.outerWidth()); //setting a fixed with to prevent width:100%
                
                dataTablesScrollContainer.css('overflow-x', 'auto') // make whole table scrollable on x-axis
                scrollBody.css('overflow', 'unset');
                scrollHead.css('overflow', 'unset');
            }
        }
    };

    prtgForm.prototype.moveHelptext = function($form) {
        var helptexts = $form.find('[data-helptext]');
        helptexts.each(function(i, elem){
            var infoIcon = $('<span class="input-info glyph-info-circled" tabindex="-1"></span>');
            var targetInput =  $(elem).find('input, select, textarea').not('[type=hidden]').first();
            var targetLabel = $form.find('label[for="'+targetInput.attr('name')+'"]');

            if(targetLabel.length == 0 &&
                targetInput.attr('type')!='radio' &&
                targetInput.attr('type')!='checkbox') {
                targetLabel = $form.find('label[for="'+targetInput.attr('id')+'"]');
            }

            if(
                targetLabel.length == 0 &&
                ($(elem).prev().is('label') || $(elem).prev().hasClass('control-label'))
            ) {
                targetLabel = $(elem).prev();
            }

            infoIcon.popover({
                "animation": false,
                "trigger": 'hover focus',
                "container": 'body',
                "placement": "top",
                "title": _Prtg.Lang.common.strings['help'],
                "content": $(elem).data('helptext'),
                "delay": { show: 400, hide: 400 },
                "html": true
            });
            if(targetLabel.length > 0) {
                targetLabel.append(infoIcon);
                $(elem).removeAttr('data-helptext');
            }
        });
    };

    prtgForm.prototype.bindValidator = function (form) {
        var highlight_ = $.validator.defaults.highlight;
        var unhighlight_ = $.validator.defaults.unhighlight;
        /*
            checkForMultipleValidateError
            Helper-Function which checks, if the error element 
            with the same id is rendered multiple times.
        */
        checkForMultipleValidateErrors = function (formElement) {
            if (!formElement) {
                return false;
            }
            var form = formElement.closest('form');
            var errorElements = $(form).find('#' + formElement.attr('name') + '-error');
            return !!errorElements.length;
        }


        return form.validate({
            errorClass: "validateerror",
            errorElement: "div",
            ignore: '.ignore-on-validation, fieldset.collapsed *, :hidden:not(.validateme), .datatables:hidden tbody .checkboxholder [type="checkbox"]:hidden',
            errorPlacement: function (label, $element) {
                // NOTE: Prevents the rendering of multiple error elements. 
                // This happens if a element, which is already validated, rerenders. 
                // After another validation another error element with the same id is rendered.
                // For more information see PRTG-6107
                if (checkForMultipleValidateErrors($element)) {
                    return;
                }
                if ($element.hasClass("checkbox")) {
                    $element.parents('.dataTables_wrapper').append(label);
                } else {
                    // PRTG-5769 Disable Browser-Autocomplete for Sensor authentication credentials
                    // setting the error color because readonly fields will turn gray
                    if ($element.attr("readonly"))
                        label = $(label).attr("style", "color: #e30613 !important");
                    $element.parent().append(label);
                }
            },
            focusInvalid: true,
            highlight: function (element, errorClass, validClass) {
                highlight_(element, errorClass, validClass);
                if (!!$(element).data('validateRelated'))
                    highlight_($($(element).data('validateRelated')), 'validateerror2', validClass);
            },
            unhighlight: function (element, errorClass, validClass) {
                unhighlight_(element, errorClass, validClass);
                if (!!$(element).data('validateRelated'))
                    unhighlight_($($(element).data('validateRelated')), 'validateerror2', validClass);
            }
        });
    }

    prtgForm.prototype.focusFirstInput = function (form) {
        form.find("input:visible:not(.ui-autocomplete-input), textarea:visible").eq(0).focus();
    }

    prtgForm.prototype.initEvents = function () {
        var self = this;
        var testSettings = {
          sms: {
            button: this.$el.find('.js-testsmssettings'),
            formUrl: '/includes/test_sms_settings_form.htm',
            endpoint: 'api/smsdelivery.htm',
            confirmText:_Prtg.Lang.Dialogs.strings.testDelivery.sms.confirmText,
            confirmHeadline:_Prtg.Lang.Dialogs.strings.testDelivery.sms.confirmHeadline
          },
          email:{
            button: this.$el.find('.js-testsmtpsettings'),
            formUrl: '/includes/test_email_settings_form.htm',
            endpoint: 'api/maildelivery.htm',
            confirmText:_Prtg.Lang.Dialogs.strings.testDelivery.email.confirmText,
            confirmHeadline:_Prtg.Lang.Dialogs.strings.testDelivery.email.confirmHeadline
          },
          sso:{
            button: this.$el.find('.js-testssosettings'),
            formUrl: '/includes/test_sso_settings_form.htm',
            endpoint: '',
            confirmText:'',
            confirmHeadline: 'tralalalala'
          },
        };

        if (self.$el.hasClass('clusterselector')) {
            this.$el.on('change.' + self.namespace, 'input[name="clgid"]', function (e) {
                var url = $(".tab-active").find('a').attr('href');
                if (url) {
                    $(".tab-active").find('a').attr('href', url.split('?')[0] + '?' + self.$el.serialize());
                    _Prtg.Plugins['prtg-tabs']['plugin'].activateTab($(".tab-active").attr("tabid"));
                    $(".tab-active").find('a').attr('href', url);
                } else {
                    url = _Prtg.Util.getUrlParameters(window.location.href);
                    url.clgid = $(this).val();
                    window.location.href = window.location.href.split('?')[0] + '?' + Object.keys(url).map(function (e) {
                            return e + '=' + encodeURIComponent(url[e]);
                        }).join('&');
                }
            });
            return;
        }

        self.$el.on('destroyed.' + self.namespace, {"self": self}, self.destroy);

        this.$el.find("textarea").on('focus.' + self.namespace, function () {
            // if textarea set the cursor at end of text
            var val = this.value;
            this.value = "";
            this.value = val;
        });

        this.$el.off('click.' + self.namespace + ' change.' + self.namespace, ".GroupShowHide", this.groupShowHideHandler);
        this.$el.on('click.' + self.namespace + ' change.' + self.namespace, ".GroupShowHide", {
            self: this
        }, this.groupShowHideHandler);

        var scrollTimer = null;

        // NOTE: Fix for PRTG-961 Adding SNMP Traffic monitor fails because of unmet dependencies
        // We need a form ID because the same checkbox classes connectedAll/notconnectedAll are used in Core&Probes settings form
        if (self.$el.attr('id') === 'addobjectdialogform') {
            self.$el.find('input.notconnectedAll[data-rule-required="true"]').addClass('validateme');
            self.$el.find('input.connectedAll[data-rule-required="true"]').addClass('validateme');
        }

        this.bindValidator(self.$el);

        this.$el.on('change.' + self.namespace + ' keyup.' + self.namespace, '[needsserverrestart="true"], [needsserverrestart="true"]>*', function (e) {
            self.needsserverrestart = true;
        });

        this.$el.on('change.' + self.namespace + ' keyup.' + self.namespace + ' formchange.' + self.namespace, function (e) {
        	var $elm = $(e.target)
            if ($elm.hasClass('initilizing') || $elm.hasClass('ignore-on-validation')) {
                return false;
            }
            self.highLightSave();
            self.$el.valid();
            self.$el.addClass("formchanged");
        });

        if (this.data.historyform) {
            this.$el.on('click.' + self.namespace, '.submit', {
                self: this
            }, this.runhistoryform);
        }

        this.$el.find('input[name="name_"]').each(function () {
            self.$name_ = $(this);
            self.$name_.data().oldValue = self.$name_.val();
        });
        this.$el.on('submit.' + self.namespace, {'self': self}, self.submitFormHandler);

        this.$el.on('click.' + self.namespace, '.checkboxtoggler', function (e) {
            var $this = $(this);
            var $table = $this.closest(".dataTables_wrapper").find('table.datatables');
            var check = $this.is(':checked');

          	$('input.checkbox', $table.dataTable().api().rows( { filter: 'applied'} ).nodes()).prop("checked", check).triggerHandler('change');
        });

        if(testSettings.sms.button.length > 0){
            this.bindTestFunction(testSettings.sms)
        }

        if(testSettings.email.button.length > 0){
          this.bindTestFunction(testSettings.email)
        }

        if(testSettings.sso.button.length > 0){
          this.bindDisplayFunction(testSettings.sso)
        }

        setTimeout(function () {
            self.$el.valid();
        }, 1);
    };

    prtgForm.prototype.highLightSave = function () {
        this.$el.find(".submit").addClass("actionbutton").removeClass("btngrey button");
        this.$el.parents('.ui-dialog').find('.ui-dialog-buttonpane .submit').addClass("actionbutton").removeClass("btngrey button");
    };

    // Tags könnten auch als PRTG platzhalter eingebunden werden,
    // dann cachen die Browser das aber und neue tags sind erst nach
    // cache leeren/cache free realod mit im autocomplete des tags controls
    prtgForm.prototype.getUserTags = function ($elm) {
        $.getJSON("/api/usertags.json", function (data, status, xhr) {
            $elm.autocomplete({
                source: data['tags']
            });
        });
    };

    prtgForm.prototype.bindDisplayFunction = function (testSettings) {
        var prtgFormPlugin = this;
        var inputs = testSettings.button.closest('fieldset').find(":input");
        testSettings.button.click(function (event) {
            event.preventDefault();
            event.stopPropagation();
            prtgFormPlugin.showDialog(inputs, testSettings);
        });
    };

    prtgForm.prototype.showDialog = function($inputs, testSettings) {
        var closeButton = {
            html: _Prtg.Lang.Dialogs.strings.close,
            class: 'button btnlink',
            click: function() {
                $(this).dialog('close');
            }
          };

          var testData = {};

          $.each($inputs.serializeArray(), function () {
              testData[this.name] = this.value;
          });

          _Prtg.Dialogs.defaultDialog(testSettings.formUrl, testData, {buttons: [closeButton]}).done( function () {
            _Prtg.Events.publish('refresh.events.prtg', [true]);
          });
    }

    prtgForm.prototype.bindTestFunction = function (testSettings) {
        var prtgFormPlugin = this;
        var inputs = testSettings.button.closest('fieldset').find(":input");
        testSettings.button.click(function (event) {
            event.preventDefault();
            event.stopPropagation();
            prtgFormPlugin.sendTestDelivery(inputs, testSettings);
        });
    };

    prtgForm.prototype.sendTestDelivery = function ($inputs, testSettings) {
        var prtgFormPlugin = this;
        var testData = {};

        $.each($inputs.serializeArray(), function () {
            testData[this.name] = this.value;
        });

        var bindFormValidation = function () {
            var form = this.find('.form');
            prtgFormPlugin.focusFirstInput(form);
            prtgFormPlugin.bindValidator(form);
            form.valid();
        }

        _Prtg.Dialogs.defaultDialog(testSettings.formUrl, null, {
            open: bindFormValidation
        }).done(function (formdata) {
            testData = $.extend({}, testData, formdata);
            _Prtg.objectTools.testdelivery(testSettings.endpoint, testData).done(function () {
                _Prtg.Dialogs.alert($('<p>' + testSettings.confirmText + '</p>'), testSettings.confirmHeadline).done(function () {
                    _Prtg.Events.publish('refresh.events.prtg', [true]);
                });
            });
        });
    };

    prtgForm.prototype.submitFormHandler = function (event, donotsend) {
        var self = event.data.self;
        var pageLength = [];
        var search = []

        if (!self.$el.valid()) {
            event.preventDefault();
            return;
        }

        if (donotsend != undefined) {
            event.preventDefault();
            return;
        }

        if (self.needsserverrestart) {
            event.preventDefault();
            _Prtg.Dialogs.serverRestartNeededDialog().done(function () {
                self.needsserverrestart = false;
                self.dorestart = true;
                self.submitForm.call(self, event); 
            });
        } else {
            self.submitForm(event);    
        }
    };

  prtgForm.prototype.submitForm = function(event) {
    var $submitButton = $(event.target).find('button[type=submit]').first()
    var $quickButton = $submitButton.parent().find('button[type=submit].quick-action-badge')

    $submitButton.addClass('button-disabled')
    $quickButton.addClass('button-disabled')

    var reenable = function(){
        $submitButton.removeClass('button-disabled')
        $quickButton.removeClass('button-disabled')
    }
    
    if($(event.target).data('reenable')){
        $(event.target).find('button,a,input').click(reenable)
    }
    
    var self = event.data.self;
    //desktop client sets this value optionally if they want us to use ajax to submit the form
    var isDesktopClient = self.$el.data('desktop') || false
    var formAction = self.$el.attr('action');
    var loadingDialog = null;

    if (self.$el.is("#reportrunnerform")) {
        if ($("#report_html").prop("checked") === true) {
            $("#reportrunnerform").attr("target", "prtg_" + Math.floor(Math.random() * 10000000));
            if(loadingDialog) loadingDialog.dialog('destroy').remove(); // Remove loading dialog.
        } else {
            $("#reportrunnerform").attr("target", "");
        }
    }

    if ($('#mainstuff').hasClass('wingui') && !isDesktopClient) return;

    if (self.data['ajaxsubmit'] !== undefined && self.data['ajaxsubmit'] ) {
        event.preventDefault();

        /*
            Formdata handles linebreaks differently through all existing browsers.
            While in chrome linebreaks will be interpreted as CR+LF, Firefox and Edge interprets linebreaks as LF
            This leads to different results when it comes to string comparison.
        */
         var convertCRLFtoLF = function(stringToConvert) {
            return stringToConvert.replace(/\r\n/g, '\n');
        }
        var formData = new FormData(self.$el[0])
        var foundValue = false;
        for (var tableI = 0; tableI < this.dataTables.length; tableI++) {
            var datarr = this.dataTables[tableI].$('input, select').serializeArray()
            for(var i = 0; i < datarr.length; i++) {
                foundValue = false
                var allValues = formData.getAll(datarr[i].name)
                for (var ii = 0; ii < allValues.length; ii++) {
                    if (convertCRLFtoLF(allValues[ii]) == convertCRLFtoLF(datarr[i].value)) {
                        foundValue = true;
                        break;
                    }    
                }
                if(!formData.has(datarr[i].name) || !foundValue) {
                    formData.append(datarr[i].name, datarr[i].value)
                } 
            }
        }

        loadingDialog = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.multieditdialogtitle);

        $.ajax({
            url: formAction,
            data: formData,
            type: "POST",
            processData: false,
            contentType: false,
            beforeSend: function(jqXHR) {
                jqXHR.gotoAfterError = false;
                jqXHR.peNumber = "03456";
            },
        }).done(function(resp) {
            if(self.dorestart) {
              if(window.winGUI) {
                alert("restartserver"); //Spezial for Wingui - do not change
              } else {
                _Prtg.objectTools.restartServer();
              }
            } else if(isDesktopClient) {
              //redirect so that desktop client can detect new destination and close loading window
              location.href = formAction
            } else if(self.data.hasOwnProperty('redirect') && self.data['redirect'] === false) {
              _Prtg.Events.publish('refresh.events.prtg',[true]);
              if (( !! self.$name_ && self.$name_.val() !== self.$name_.data().oldValue && /editsettings/.test(formAction) === true)  || /deleteobject|addgroup2|adddevice2|addmap2|duplicateobject|moveobjectnow|deletesub/.test(formAction) === true) {
                $('#main_menu').parent().load('/controls/menu.htm');
              }
            } else {
              if(self.$el.hasClass('dialogform')) {
                self.$el.parents('.ui-dialog').find('.ui-dialog-buttonpane .submit').addClass("btngrey button").removeClass(" actionbutton");
              } else {
                if(formAction === 'addsensor5.htm') {
                	var urlVars = _Prtg.Util.getUrlVars();
                	
				          self.Poll(
											"/api/getaddsensorprogress.htm?id={id}&tmpid={tmpid}&step=3&targeturl=/device.htm?id={id}".printf(urlVars),
											"/device.htm?id={id}".printf(urlVars)
				            ).done(function(response){
					            if(window.winGUI)
					              window.location.href = 'wingui.htm?action=' + encodeURIComponent(resposne.targeturl);
					            else
	                 	 		location.href = response.targeturl;
				            }).fail(function(response){
				            	var url = response.targeturl
				            	var title = _Prtg.Lang.addSensor.strings.addsensorfailed;
				            	response.dialog.dialog("destroy").remove();
				            	_Prtg.Dialogs.alert($("<div>"+response.error+"</div>"),title).always(function(){
				            		if(url !== "/device.htm?id={id}".printf(urlVars)) location.href = url;
				            	});
				            });
                } else {
                  if(formData.get('targeturl')) {
                    location.href = formData.get('targeturl');
                  } else {
                    var objid;
                    try {
                        objid = JSON.parse(resp);
                    } catch(e) {
                        objid = undefined
                    }
                    if(objid != undefined && objid.objid != undefined && self.data['targeturl'] != undefined) {
                        location.href = self.data['targeturl'].replace("%objid%", objid.objid);
                    } 
                    else if (location.pathname != '/systemsetup.htm') {
                        location.href = location.href.replace(/&tabid=[a-zA-Z0-9]+/,'').replace(/tabid=[a-zA-Z0-9]+&/, '').replace(/\?tabid=[a-zA-Z0-9]+$/, '');
                    }
                  }
                  loadingDialog.dialog('destroy').remove();
                }
              }
            }
        }).always(function() {
	          if(!!loadingDialog && loadingDialog.hasClass('ui-dialog-content')) {
	            loadingDialog.dialog('destroy').remove();
	        }
	        self.$el.removeClass('formchanged');
            reenable()
        });
    }
  };

  prtgForm.prototype.Poll = function Poll(url, target){
    _Prtg.Tip.killPopups();
    var response = {progress:0, targeturl: target, dialog: null};
    var dfd = $.Deferred();
    var progress = {};
    response.dialog = $(
         '<div>'
          + '<p>' + _Prtg.Lang.addSensor.strings.addingSensor + '</p>'
          + '<div id="newprogressbar"></div></center>'
          + '<div id="progressinfo"></div>'
          + '</div>'
      ).dialog({
        modal: true,
        resizable: false,
        draggable: false,
        position: 'center',
        maxHeight: parseInt($(window).height() * 0.95, 10),
        maxWidth:  parseInt($(window).width() * 0.95, 10),
        width: 400,
        height: 200,
        zIndex: 8999,
        title: $("<div/>").html(_Prtg.Lang.Dialogs.strings.working).text(),
        buttons: [{
          'html': _Prtg.Lang.Dialogs.strings.continue,
          'class': "button btngrey",
          'click': function() {
            clearInterval(progress.interval);
            dfd.resolve(response);
          }
        }]
    });
		progress.bar = response.dialog.find('#newprogressbar');
		progress.info = response.dialog.find('#progressinfo');

	 	progress.interval = function() {
			$.ajax({
			  global: false,
			  dataType: "json",
        beforeSend: function(jqXHR){
          jqXHR.ignoreManager = true;
        },
			  url: url
			}).done(function(json) {
			  $.extend(true, response, json);
			  !!response.info && progress.info.text(response.info);
			    progress.bar.progressbar({
			      value: Math.max(0,Math.min(response.progress, 100))
			    });
			  if(response.progress < 0){
			    clearInterval(progress.interval);
			    dfd.reject(response, response.error);
			    return;
			  }else if(response.progress >= 100){
			    clearInterval(progress.interval);
			    dfd.resolve(response);
			    return;
			  }
				setTimeout(progress.interval, 300);
			}).fail(function(){
				setTimeout(progress.interval, 300);
			});
		};

		setTimeout(progress.interval, 300);

	  progress.bar.progressbar({
	    value: response.progress
	  });
	  return dfd.promise(progress);
	};

  prtgForm.prototype.initUpdateFloatingButtons = function() {
    var $submitbox = this.$el.find(".submitbuttonbox");
    var $anchor = $submitbox.closest(".submitbuttonboxanchor");
    var $scrollContainer = $anchor.scrollParent().not("html").add(window).slice(0,1);
    var submitBoxHeight = $submitbox.outerHeight();

    this.floatButtonProperties = {
      '$submitbox': $submitbox,
      '$anchor': $anchor,
      '$scrollContainer': $scrollContainer,
      'submitBoxHeight': $submitbox.outerHeight() + 35
    };
    return $anchor;
  };

  prtgForm.prototype.updateFloatingButtons = function() {
    var self = this;
    if (self.floatButtonProperties['$submitbox'].length < 1 || self.floatButtonProperties['$anchor'].length < 1) return;
    var docViewTop = self.floatButtonProperties['$scrollContainer'].scrollTop();
      docViewBottom = docViewTop + self.floatButtonProperties['$scrollContainer'].height() + (self.floatButtonProperties['$scrollContainer'].offset()||{top:0}).top,
      elemTop = self.floatButtonProperties['$anchor'].offset().top + (self.floatButtonProperties['$scrollContainer'].offset() ? self.floatButtonProperties['$scrollContainer'].scrollTop() : 0),
      elemBottom = elemTop + self.floatButtonProperties['submitBoxHeight'];
    if (!((docViewTop < elemTop) && (docViewBottom > elemBottom))) {
      self.floatButtonProperties['$submitbox'].toggleClass("float", true);
    } else {
      self.floatButtonProperties['$submitbox'].toggleClass("float", false);
    }
  };

  prtgForm.prototype.groupShowHideHandler = function(e, forceHide) {
    var $this = $(this);
    var self = e.data.self;
    var thisId = ($this.is("select")) ? $this.children(":selected").attr("id") : $this.attr("id");
    var $hideId = $(".Hide" + thisId +":not(.multieditactivecheckbox)");
    var $showId = $(".Show" + thisId +":not(.multieditactivecheckbox)");

        if ($this.prop("checked") || $this.is("select") || forceHide) {
            if (forceHide) {
                $showId = $();
            }
            $hideId.removeClass("InitialDisplayNone hide").addClass("hidden");
            $showId.css('display', '').removeClass("InitialDisplayNone hidden hide");

            if ($hideId.is("visible")) {
                $(".Hide" + thisId + ":visible").addClass("hidden");
                $hideId.trigger('grouphide.' + self.namespace);
            } else {
                $showId.trigger('groupshow.' + self.namespace);
            }

            var $gsh;
            $hideId.each(function (i, elm) {
                $gsh = $(elm).find('.GroupShowHide');
                if ($gsh.length) {
                    $gsh.each(function (index, elm2) {
                        self.groupShowHideHandler.call(elm2, {"data": {"self": self}}, true);
                    });
                }
            });

            $showId.each(function (i, elm) {
                $gsh = $(elm).find('.GroupShowHide');
                if ($gsh.length) {
                    $gsh.each(function (index, elm2) {
                        self.groupShowHideHandler.call(elm2, {"data": {"self": self}});
                    });
                }
            });

        } else {
            $(".HideNot" + thisId + ":visible").addClass("hidden");
            $(".ShowNot" + thisId).removeClass("InitialDisplayNone hidden hide");
        }
    };

    prtgForm.prototype.runhistoryform = function (e) {
        var self = e.data.self;
        if (!self.$el.valid() || self.$el.find('.validateerror2').length > 0) {
            e.preventDefault();
            return;
        }
        var myid;
        if (typeof(myid) == 'undefined') {
            myid = $("#myid").val();
        }
        if (typeof(myid) == 'undefined') {
            myid = $(".sensorlookupnew").attr("selid");
        }
        if (typeof(myid) == 'undefined') {
            myid = $('input[name="id"]:hidden').val();
        }


        var params = "?id=" + myid
            + "&sdate=" + $("#sdate").val()
            + "&edate=" + $("#edate").val()
            + "&avg=" + $("#avg").val()
            + "&pctavg=" + $("#pctavg").val()
            + "&pctshow=" + $("#pctshow").prop("checked")
            + "&pct=" + $("#pct").val()
            + "&pctmode=" + $("#pctmode1").prop("checked");
        var clusterid = $('input[name="clgid"]:checked').val();
        if (clusterid) {
            params = params + "&clgid=" + clusterid;
        }

        if ($('#hiddenchannels').length > 0 && $('#hiddenchannels').val() !== '')
            params += '&hide=' + $('#hiddenchannels').val();

        if ($("#formathtml").prop("checked")) {
            var windowname = 'HistoricDataWindow' + parseInt(Math.random() * (1000000), 10);
            var mywindow = window.open("/generatehistoricdata.htm?id=" + myid + "&generate=" + encodeURIComponent('/historicdata_html.htm' + params), windowname, 'width=900,height=600,scrollbars=yes,toolbar=yes,location=yes,status=yes,menubar=yes,resizable=yes');
            mywindow.focus();
        } else if ($("#formatxml").prop("checked") === true) {
            window.top.location.href = "/api/historicdata.xml" + params;
        } else if ($("#formatcsv").prop("checked") === true) {
            window.top.location.href = "/api/historicdata.csv" + params;
        }
        e.preventDefault();
    };

    prtgForm.prototype.destroy = function (event) {
        var self = event.data.self;
        $(document).off('.' + self.namespace);
        self.$el.off('.' + self.namespace);
        self.$el.off('.' + self.namespace);
    };

    $.fn[pluginName] = function (data, parent) {
        return this.each(function () {
            if (!$.data(this, 'plugin_' + pluginName)) {
                $.data(this, 'plugin_' + pluginName, new prtgForm(this, data, parent));
            }
        });
    };

})(jQuery, window, document);
;
// _Prtg.TableFilterToggle.Plugin.js
(function ($, window, document, undefined) {

  function tableFilterToggle(self, element) {
    var $element = (!(element instanceof jQuery)) ? $(element) : element;
    this.$filterLink = $();
    this.init($element);
  }

  tableFilterToggle.prototype.init = function ($el) {
    this.$filterLink = $el.find('.js-filterToggle');

    if (this.$filterLink.hasClass('js-datepicker-filter')) {
      this.$filterLink.closest('.tableflyout').addClass('filterpanel');
    }

    this.$filterLink.closest('.prtg-plugin-initialized, .prtg-plugin-initializing, .prtg-plugin').hasClass('filteractive') ? this.$filterLink.html(_Prtg.Lang.common.strings.hideFilter + '&nbsp;') : this.$filterLink.html(_Prtg.Lang.common.strings.showFilter + '&nbsp;');
    this.$filterLink.on('click', this.toggleFilters);
  };

  tableFilterToggle.prototype.toggleFilters = function (e) {
    var filterLink = $(e.target),
      filterPanel = filterLink.closest('.prtg-plugin-initialized, .prtg-plugin, .prtg-plugin-initializing');

    filterPanel.toggleClass('filteractive');
    filterPanel.hasClass('filteractive') ? filterLink.html(_Prtg.Lang.common.strings.hideFilter + '&nbsp;') : filterLink.html(_Prtg.Lang.common.strings.showFilter + '&nbsp;');
  };

  tableFilterToggle.prototype.initialyOpenFilters = function (params) {
    if(params['tableid']=='tickettable') this.$filterLink.triggerHandler('click');
  };

  _Prtg.Plugins.registerPlugin("table-filter-toggle", tableFilterToggle);

})(jQuery, window, document);
;
// _Prtg.Tables.TicketMenu.js
(function ($, window, document, undefined) {

  function tablesTicketMenu(self, element) {
    var $element = (!(element instanceof jQuery)) ? $(element) : element;
    this.isTicketTable = true;
    this.ticketstatuses = [1, 2, 3];
    this.statusDisabledMap = {
      1: ['reopen'],
      2: ['resolve'],
      3: ['edit', 'assign', 'resolve', 'close', 'prio']
    };

    this.init($element);
  }

  tablesTicketMenu.prototype.init = function ($el) {
    this.$element = $el;
    this.isTicketTable = $el.find('.form-tickets').length > 0;
  };


  tablesTicketMenu.prototype.filterMenu = function ($checked, $menu) {
    var TicketMenu = this;
    var statuses = TicketMenu.getSelectedStatuses($checked);
    var disabledOptions = [];

    $menu.find('[class*="js-ticket"]').show();

    if(statuses.length === 1){
      disabledOptions = TicketMenu.statusDisabledMap[statuses[0]];
    }

    disabledOptions.forEach(function(optionName){
      $menu.find('.js-ticket-'+optionName).hide();
    })

  };

  tablesTicketMenu.prototype.getSelectedStatuses = function (checks) {
    var existingStatuses = [];

    this.ticketstatuses.forEach(function(elem){
      if(checks.filter('[data-status="'+elem+'"]').length > 0) {
        existingStatuses.push(elem);
      }
    });

    return existingStatuses;
  };


  _Prtg.Plugins.registerPlugin("tables-ticket-menu", tablesTicketMenu);

})(jQuery, window, document);
;
/* _Prtg.Table.js */
(function ($, window, document, undefined) {
    var pluginName = 'prtg-table';

    function prtgTable(element, data, parent) {
        this.data = data;
        this.el = (!(element instanceof jQuery)) ? element : element[0];
        this.$el = (!(element instanceof jQuery)) ? $(element) : element;
        this.parent = parent;
        this.$parent = $(parent);
        this.timer = this.$parent.Events();
        this.$refresh = this.$el.find('[refreshurl]');
        this.$form = this.$el.find('form');
        this.refreshurl = null;
        this.FilterToggle = _Prtg.Plugins['table-filter-toggle'];
        this.TicketsMenu = _Prtg.Plugins['tables-ticket-menu'];
        this.hasCheckboxes = this.$el.find('.tablemultiselectcheckbox').length > 0;

        if (this.$form.length) {
            this.refreshurl = this.$refresh.attr('refreshurl');
            this.params = _Prtg.Util.getUrlParameters(window.decodeURI(this.refreshurl));
            this.refreshurl = this.refreshurl.split('?')[0];
            this.initEvents();
            this.$form.attr('callerid', this.$form.attr('id'));
            this.enableSelectable(this.$el.find('tbody'));
            if (!this.params.tabletitle || this.params.tabletitle === 'AUTO') {
                var currentTableTitle = this.$el.find('.tabletitle th').text();
                if (currentTableTitle !== '') {
                    this.params.tabletitle = this.$el.find('.tabletitle th').text();
                }
            }
        }
        
        this.scrollEventHandler = (function() {
            this.repositionTableMenu();
        }).bind(this);

        if (!!this.data.sortable) this.sortable = this.$el.prtgsortable(data, parent, true)[0].refresh();
    }

    prtgTable.prototype.initEvents = function () {
        var self = this;

        if (!self.$refresh.data().hasOwnProperty('noAutoRefresh')) {
            this.timer.subscribe('refresh.events.prtg', null, self, self.refresh);
            this.timer.subscribeOnce('navigate.prtg', null, self, function (e) {
                self.timer.unsubscribe('refresh.events.prtg', self.refresh);
            });
        }

        this.$el.closest('#displaytable').off('click').on('click', 'tbody tr', function (event) {
            event.stopImmediatePropagation();
            _Prtg.objectTools.channelEditDialog($(this).find('.editchannelsettings').data().sensorid, $(this).find('.editchannelsettings').data().channelid);
        });

        if (self.hasCheckboxes) {
            this.$el.on('click', 'tbody.ui-selectable tr', function (event) {
                if ($(event.target).is('input, .favstar, .favempty, a, .actionbutton, .icon') || $(this).is('.notselectable')) return;
                var $this = $(this);
                var $tcheckbox = $this.find('.tablemultiselectcheckbox');
                var checked;

                if ($tcheckbox.length > 0) {
                    checked = $tcheckbox.prop('checked');
                    $tcheckbox.prop('checked', !checked);
                    if (checked) {
                        $this.removeClass('ui-selected');
                    } else {
                        $this.addClass('ui-selected');
                    }

                    self.updateMultiCheckbox();
                    self.updateTableMenu();
                }
            });
        }

        this.$el.find('#tagfilter').each(function () {
            var $elm = $(this);
            $elm.tagsinput({
                tags: function ($elm) {
                    $.getJSON('/api/usertags.json', function (data, status, xhr) {
                        self.tags = data.tags;
                        $elm.autocomplete({
                            source: self.tags
                        });
                    });
                }
            })
            .on('change', function (e) {
                var tags = this.value || null;
                tags = !!tags ? '@tag(' + tags + ')' : null;
                e.stopImmediatePropagation();
                $elm.trigger('changed', {
                    filters: [
                        {
                            name: 'filter_tags',
                            value: tags
                        },
                        {
                            name: 'tags',
                            value: this.value
                        },
                        {
                            name: 'start',
                            value: '0'
                        }
                    ]
                });
            });
        });

        this.$el.on('click.prtgtable tab.prtgtable', '.tablemenu a', {self: this}, self.handleTableMenu)
            .on('change.prtgtable', '.selectallasmultiedit', {self: this}, self.toggleSelectAll)
            .on('change.prtgtable', '.tablemultiselectcheckbox', {self: this}, self.selectColumn)
            .on('click.prtgtable', 'td.col-properties a', {self: this}, self.moreInfo)
            .on('click.prtgtable', '.tablebuttonbox .actionbutton', {self: this}, self.tablebuttonclickhandler)
            .on('change.prtgtable changed.prtgtable', 'div.sensorlookupnew,.select-reloadtablelink:not(.disabled),#tagfilter', $.proxy(self.reloadTableLink, this))
            .on('click.prtgtable', '.reloadtablelink:not(.disabled)', $.proxy(self.reloadTableLink, this))
            .on('destroyed', function () {
                _Prtg.Events.unsubscribe('datetimpicker.change', $.proxy(self.datetimepickerChangeHandler, self));
                _Prtg.Events.unsubscribe('newstats.prtg', $.proxy(self.datetimepickerChangeHandler, self));
                $(window).off('.prtgtable');
                $(document).off('.prtgtable');
                self.$el.off('.prtgtable');
            });

        if (!!self.data.tabletitle) {
            _Prtg.Events.subscribe('newstats.prtg', $.proxy(self.updateTableTitle, self));
        }

        _Prtg.Events.subscribe('datetimpicker.change', $.proxy(self.datetimepickerChangeHandler, self));
        _Prtg.Events.subscribe('loaded.events.prtg', $.proxy(self.afterRefresh, self));


        self.TicketsMenu.init(this.$el);
        self.FilterToggle.init(this.$el);
        self.initScrollTable(this.$el);
        self.bindHandleLabelClick();
        self.bindUpdateTableMenu();
        self.addTitleAttribute();
        self.updateTableAddPosition();
        self.FilterToggle.plugin.initialyOpenFilters(this.params);
    };

    prtgTable.prototype.bindHandleLabelClick = function (e) {
        this.$el.on('click', '.col-checkbox label' ,function (event) {
            var id = $(event.target).attr('for');
            $('input#' + id).click();
        });
    };

    prtgTable.prototype.initScrollTable = function () {
      var $el = this.$el;
      var $table = $el.find('table');

      if ($el.hasClass('scrollabletablecontainer')) {
        $table.floatThead('destroy');
        $table.floatThead({
          position: 'absolute',
          responsiveContainer: function ($el) {
            return $el.closest('form');
          },
          top: $('.js-header .menu-wrapper').outerHeight(),
          zIndex: 90
        });
        $el.find('.floatThead-container table').css('margin', 'auto');
      }
    };

    prtgTable.prototype.updateTableTitle = function (e) {
        this.params.tabletitle = this.data.tabletitle.printf(_Prtg.lastStats);
        this.$el.find('.tabletitle th>a').text(this.params.tabletitle);
        // self.addTitleAttribute();
    };

    prtgTable.prototype.addTitleAttribute = function (e){
        var $moveups = this.$el.find('tfoot.pagenavigation a.tablezoomlink, thead.pagenavigation span.table_itemcount_selector').detach(),
            $buttonbox = this.$el.siblings('.buttonbox');

        $buttonbox.find('a.tablezoomlink, span.table_itemcount_selector').remove();
        if($moveups.length > 0 && $buttonbox.length === 1)
            $buttonbox.prepend($moveups);
    };

    prtgTable.prototype.tablebuttonclickhandler = function (e) {
        $(this).append($('<div/>', {
            class: 'ajax-loader-small ajax-loader-small-inline'
        }));
    };

    prtgTable.prototype.moreInfo = function (e) {
        var $self = $(this);
        $self.parents('td').find('ul.property-list').toggleClass('hidden');
        $self.toggleClass('folded');
        $self.hasClass('folded') ? $self.text($self.data('hide')) : $self.text($self.data('show'));
    };

    prtgTable.prototype.datetimepickerChangeHandler = function (e) {
        var self = this;
        var update = false;
        var startpicker = this.$el.find('.table_datepicker_fromtodate input.table_datepicker_dstart.orginal_input');
        var endpicker = this.$el.find('.table_datepicker_fromtodate input.table_datepicker_dend.orginal_input');
        if (!startpicker.length && !endpicker.length) return;
        startpicker = startpicker.data('plugin_prtgDatetimepicker');
        endpicker = endpicker.data('plugin_prtgDatetimepicker');
        var startdate = startpicker.$el.val();
        var enddate = endpicker.$el.val();
        // self.$el.find('.pagenavigation ').first().addClass('ajax-loader-small');

        if (this.params['filter_drel']) {
            update = true;
            delete this.params['filter_drel'];
        }

        if (!!startdate) {
            update = true;
            this.params['filter_dstart'] = startdate;
        } else {
            update = update || this.params.hasOwnProperty('filter_dstart');
            delete this.params['filter_dstart'];
        }

        if (!!enddate) {
            update = true;
            this.params['filter_dend'] = enddate;
        } else {
            update = update || this.params.hasOwnProperty('filter_dend');
            delete this.params['filter_dend'];
        }

        if (update) {
            delete this.params['start'];
            this.refresh({data: this}, true);
        }
    };

    prtgTable.prototype.reloadTableLink = function (e, filter) {
        var self = this;
        var data;
        var force = true;
        // self.$parent.find('.buttonbox .table_itemcount_selector ').addClass('ajax-loader-small');
        if (e.type === 'change') {
            data = $(e.target).find(':selected').data().reload;
        } else if (e.type === 'changed') {
            data = filter.filters;
        } else {
            e.preventDefault();
            if ($(e.target).is('.ui-icon,i')) {
                data = $(e.target).parent('a').data().reload;
            } else {
            	if($(e.target).parent().is('.table_itemcount_selector')){
            		$(e.target).parent().find('.reloadtablelink.selected').removeClass('selected');
            		$(e.target).addClass('selected');
            		force = false;
            	}
              data = $(e.target).data().reload;
            }
        }

        if (!!data)
            $.each(data, function () {
                if (this.value === null && self.params.hasOwnProperty(this.name))
                    delete self.params[this.name];
                else
                    self.params[this.name] = this.value;
            });
        this.refresh({data: this}, force);
    };

    prtgTable.prototype.refresh = function (e, force) {
        var prtgTable = e.data;
        var nothingIsSelected = prtgTable.$el.find('.tablemultiselectcheckbox:checked').length === 0;
        var itemSelectorData = prtgTable.$el.find('.table_itemcount_selector a.selected').data()||{};
        var isBelowItemTreshold = true;

        if(itemSelectorData.reload) {
          isBelowItemTreshold = itemSelectorData.reload[0].value < 1000 || prtgTable.$el.find('tbody tr').length <= 500;
        }

        if (e.force || force || (nothingIsSelected && isBelowItemTreshold)) {
            $.ajax({
                url: prtgTable.refreshurl,
                data: prtgTable.params
            }).done(function (data) {
								var $data = $($.parseHTML(data));
								var $table = $data.find('table.table');
                // prtgTable.disableSelectable();
                prtgTable.$refresh = $data.find('[refreshurl]').attr('refreshurl');
                prtgTable.$el.find('[refreshurl]').attr('refreshurl', prtgTable.$refresh);

                prtgTable.enableSelectable($table.find('tbody'));

                _Prtg.initPlugins(prtgTable.$el.find('table.table').html($table.contents()));
                _Prtg.Events.publish('loaded.events.prtg', prtgTable.$el);
            });
        }
    };

    prtgTable.prototype.afterRefresh = function afterRefresh(e){
    	  var prtgTable = this;
	        !!prtgTable.sortable && prtgTable.sortable.refresh();
	        prtgTable.updateTableMenu();
	        prtgTable.initScrollTable();
    };

    prtgTable.prototype.handleTableMenu = function (e) {

        var $this = $(this),
            me = this,
            self = e.data.self,
            action = $this.data('action') || '',
            filter = (/^ack/.test(action) == true ? '[status="5"]' : ''),
            selected = e.data.self.$el.find('.tablemultiselectcheckbox' + filter + ':checked').not('.selectallasmultiedit'),
            ids = [];

        if (selected.is('[data-status]')) {
            selected.each(function () {
                ids.push({objid: $(this).val(), status: $(this).attr('data-status')});
            });
        } else {
            selected.each(function () {
                ids.push($(this).val());
            });
        }

        function refresh() {
            self.refresh({data: self, force: true});
        }
        function closemenu(e){
        		$this.closest('.tablemenu').addClass('invisible');
        }

        if (action === 'stop') {
            _Prtg.objectTools.pauseObject.call(me, ids, 0).always(closemenu);
        } else if (action === 'pause') {
            _Prtg.objectTools.pauseWithComment.call(me, ids).always(closemenu);
        } else if (action === 'pausefor') {
            _Prtg.objectTools.pauseWithComment.call(me, ids, $this.data('pausefor')).always(closemenu);
        } else if (action === 'pauseuntil') {
            _Prtg.objectTools.pauseUntil(ids).always(closemenu);
        } else if (action === 'resume') {
            _Prtg.objectTools.pauseObject(ids.join(','), 1).always(closemenu);
        } else if (action === 'checknow') {
            _Prtg.objectTools.checkObjectNow(ids.join(',')).always(closemenu);
        } else if (action === 'delete') {
            _Prtg.objectTools.deleteObject(ids, true)
	            .done(function(){
                    closemenu()
	                $('#' + ids.join(',#')).filter('a').closest('tr').remove();
	            });
        } else if (action === 'clone') {
            _Prtg.objectTools.duplicateObject.call(me, ids);
        } else if (action === 'ack') {
            _Prtg.objectTools.acknowledgeError.call(me, ids);
        } else if (action === 'ackfor') {
            _Prtg.objectTools.acknowledgeError.call(me, ids.join(','), $this.data('ackfor'));
        } else if (action === 'ackuntil') {
            _Prtg.objectTools.acknowledgeErrorUntil.call(me, ids.join(','));
        } else if (action === 'simulateerror') {
            _Prtg.objectTools.simulateObject(ids.join(','), 1).always(closemenu);
        } else if (action === 'prio') {
            _Prtg.objectTools.setObjectPriority(ids.join(','), $this.data('prio'));
        } else if (action === 'addfav') {
            _Prtg.objectTools.faveObject(ids.join(','), 1);
        } else if (action === 'removefav') {
            _Prtg.objectTools.faveObject(ids.join(','), 0);
        } else if (action === 'edit') {
            if (ids.length) _Prtg.objectTools.editSettingsDialog('/multiedit.htm', ids.join(','), {});
        } else if (action === 'move') {
            _Prtg.objectTools.setObjectPosition.call(me, ids.join(','), $this.data('move'));
        } else if (action === 'discover') {
            _Prtg.objectTools.discoverObjectNow.call(me, ids.join(','));
        } else if (action === 'autodiscovertemplate') {
          _Prtg.objectTools.discoverObjectTemplate.call(me, ids);
        } else if (action === 'maprotation') {
            window.location.replace('/mapshow.htm?ids=' + ids.join(','));
        } else if (action === 'maintenace') {
            _Prtg.objectTools.setMaintenanceWindow.call(me, ids);
        } else if (action === 'ticket-new') {
            _Prtg.objectTools.ticketAdd.call(me, 'new');
        } else if (action === 'ticket-edit') {
            _Prtg.objectTools.ticketEdit.call(me, ids);
        } else if (action === 'ticket-assign') {
            _Prtg.objectTools.ticketAssign.call(me, ids);
        } else if (action === 'ticket-resolve') {
            _Prtg.objectTools.ticketResolve.call(me, ids);
        } else if (action === 'ticket-close') {
            _Prtg.objectTools.ticketClose.call(me, ids);
        } else if (action === 'ticket-reopen') {
            _Prtg.objectTools.ticketReopen.call(me, ids);
        } else if (action === 'ticket-prio') {
            _Prtg.objectTools.ticketPriority.call(me, ids, $this.data('prio'));
        } else if (action === 'noti-test') {
            _Prtg.objectTools.testNotification(ids);
        } else if (action == 'usedby'){
            _Prtg.objectTools.usedbyObject(ids);
        }

        return false;
    };

    prtgTable.prototype.toggleSelectAll = function (e) {
        var self = e.data.self;
        if (!$(this).prop('checked')) {
            self.$el.find('.tablemultiselectcheckbox').prop('checked', false);
            self.$el.find('.ui-selected').removeClass('ui-selected');
        } else {
            self.$el.find('.tablemultiselectcheckbox').prop('checked', true).closest('tr').addClass('ui-selected');
        }

        self.updateTableMenu();
    };

    prtgTable.prototype.updateMultiCheckbox = function () {
        var $multicheckbox = this.$el.find('.selectallasmultiedit');
        var $checkboxes = this.$el.find('.ui-selectee');
        var $selectedcheckboxes = $checkboxes.filter('.ui-selected');

        if ($checkboxes.length === $selectedcheckboxes.length) {
            $multicheckbox.prop('checked', true).closest('tr').addClass('ui-selected');
        } else {
            $multicheckbox.prop('checked', false).closest('tr').removeClass('ui-selected');
        }
    };

    prtgTable.prototype.disableSelectable = function disableSelectable() {
        var prtgTable = this;
        if (!prtgTable.hasCheckboxes) {
            prtgTable.$el.find('tbody.selectable-initialized').removeClass('selectable-initialized').selectable('destroy');
        }
    }
    prtgTable.prototype.enableSelectable = function ($selectable) {
        var prtgTable = this;

        // necessary for e.g. sysinfo so sb. can copy text
        if(!prtgTable.hasCheckboxes)
             return;

        $selectable.selectable({
            start: function () {
                prtgTable.$el.find('.selectallasmultiedit').prop('checked', false);
            },

            stop: function () {
                prtgTable.updateTableMenu();
            },

            selecting: function (event, ui) {
                $(ui.selecting).find('.tablemultiselectcheckbox').prop('checked', true);
            },

            unselecting: function (event, ui) {
                $(ui.unselecting).find('.tablemultiselectcheckbox').prop('checked', false);
            },

            selected: function (event, ui) {
                $(ui.selected).find('.tablemultiselectcheckbox').prop('checked', true);
            },
            distance: 15,
            filter: 'tr:not(.notselectable)',
            cancel: 'a, input, option, .notselectable, .detailpageoverview>tr, .tablewithstyles, .sorter'
        }).addClass('selectable-initialized');
    };

    prtgTable.prototype.selectColumn = function (e) {
        var $this = $(this);
        if ($this.hasClass('selectallasmultiedit')) return;
        if ($this.is(':checked')) {
            $this.closest('tr').addClass('ui-selected');
        } else {
            $this.closest('tr').removeClass('ui-selected');
        }
        e.data.self.updateMultiCheckbox();
        e.data.self.updateTableMenu();
    };

    prtgTable.prototype.updateTableAddPosition = function () {        
        var container = $('.js-fixedtableadd');
        container.attr('style','');

        if (container && container.length > 0) {
            var tableRightPos = $(document).outerWidth() -  (container.offset().left + container.outerWidth());
            container.css({
                'position': 'fixed',
                'top': container.offset().top,
                'right': tableRightPos + 'px',
                'left': 'auto'
            });
        }
    };

    prtgTable.prototype.updateTableMenu = function () {
        var $menu = this.$el.find('.js-fixedtablemenu .jd_menu')
          , container = $menu.parent()
          , $checked = this.$el.find('.tablemultiselectcheckbox:checked').not('#selectall_2_notificationtable');
        if ($checked.length > 0) {            
            if (this.TicketsMenu.plugin.isTicketTable) {
                this.TicketsMenu.plugin.filterMenu($checked, $menu);
            }
            // Init for moving table menu
            $(window).on('scroll', this.scrollEventHandler)
            this.repositionTableMenu();           

            if ($checked.length >  1) {
                $menu.find('li[single]').hide();
            }
            else {
                $menu.find('li[single]').show();
            }

            if(container.hasClass('invisible')) {
                container.removeClass('invisible');                
            }

            if (this.$el.find('.tablemultiselectcheckbox[status="5"]:checked').length === 0) {
                $menu.find('[ack]').hide();
            } else {
                $menu.find('[ack]').show();
            }
        } else {
            $menu.removeClass('flyoutleft').parent().addClass('invisible');                                
            
            // Resets for moving table menu
            this.scrollTimer = null;
            $(window).off('scroll', this.scrollEventHandler);
            if(container[0]) {
                container[0].style.transform = '';
            }
        }
    };    

    prtgTable.prototype.repositionTableMenu = function() {        
        var self = this;
        if (this.scrollTimer) {
            clearTimeout(this.scrollTimer);
        }
        this.scrollTimer = setTimeout(function() {            
            var tableMenu = self.$el.find('.tablemenu')[0];                                            

            var translateY = '';
            if(self.$el[0].getBoundingClientRect().top < 0) {                       
                // Use window.parseInt, because IE does not support Number.parseInt
                var maxOffset = self.$el[0].offsetHeight - tableMenu.offsetHeight - window.parseInt(window.getComputedStyle(tableMenu).top);                            
                var tableOffset = Math.min(Math.abs(self.$el[0].getBoundingClientRect().top), maxOffset);
                translateY = 'translateY(' + tableOffset + 'px)';
            }
            tableMenu.style.transform = translateY;
        }, 250);        
    }    

    prtgTable.prototype.bindUpdateTableMenu = function () {        
    	var  self = this;
        $(window).debounce(function () {						
		    self.updateTableAddPosition();
        }, 250);
    };

    _Prtg.Plugins.registerPlugin(pluginName, prtgTable);

})(jQuery, window, document);
;
// _Prtg.prtgSortable.Plugin.js
(function($, window, document, undefined) {
	var pluginName = "prtgsortable";

	function prtgsortable(element, data, parent, noautorefresh) {
		this.data = data;
		this.$el = $(element);
		this.timer = $(parent).Events();
		if(!noautorefresh)
			this.init(this);
	};

	prtgsortable.prototype.init = function(me){
		me.timer.subscribe('refresh.events.prtg', $.proxy(me.refresh, me));
		me.$el.on('destroyed', function(){
			me.timer.unsubscribe('refresh.events.prtg',$.proxy(me.refresh, me));
		});
		me.refresh();
	};

	prtgsortable.prototype.refresh = function(){
		var me = this
			, $dragrow = null
			, oldposition = null
			, newposition = null;
	
		me.$el.find(me.data.sortable).draggable({
			handle: '.sorter',
			cursor: 'move',
			zIndex: 2700,
			cursorAt: { left: 1, top: 1 },
			containment: "parent",
			helper: 'clone',
			opacity: 0.5,
			start: function(event, ui) { 
				$dragrow = $(this);
				oldposition = $dragrow.find(".sorter").data()
			}
		}).droppable({
			accept: me.data.sortable,
			tolerance: 'touch',
			over: function(event, ui) {
				newposition = $(this).find(".sorter").data();
				if(newposition.position > oldposition.position)
					$dragrow.detach().insertAfter($(event.target));
				else if(newposition.position < oldposition.position)
					$dragrow.detach().insertBefore($(event.target));
			},
			drop: function(event, ui) {
				if(!!newposition){
					if(newposition.position > oldposition.position) 
						newposition.position++;
					else
						newposition.position--;
					_Prtg.objectTools.setObjectPosition(oldposition.id,newposition.position);
				}
				$dragrow = null;
				newposition = null;
			}
		});
		return me;
	};

	$.fn[pluginName] = function(data, parent, noautorefresh) {
		return this.map(function() {
			var ret = $.data(this, 'plugin_' + pluginName);
			if (!ret) {
				ret = new prtgsortable(this, data, parent, noautorefresh);
				$.data(this, 'plugin_' + pluginName, ret);
			}
			return ret;
		});
	};

})(jQuery, window, document);
;
/* _Prtg.Inputs.js */
(function($, window, document, undefined) {

	function prtgFieldsetToggler(element, options) {
		this.el = (!(element instanceof jQuery)) ? element : element[0];
		this.$el = (!(element instanceof jQuery)) ? $(element) : element;
		this.$checkicon = $('<i class="icon-dark prtg-checkbox"></i>');
		if(this.$el.is(':checked'))
			this.$checkicon.toggleClass("icon-check");
		this.init();
	}

	prtgFieldsetToggler.prototype.init = function() {
		var me = this,
            $fieldset = me.$el.closest("fieldset");

        me.$el.closest("legend").addClass('switchcheckbox');

		this.$el.hide()
			.on("change", function(){
                    if (me.$el.hasClass("toggleFieldset")) {
                        $fieldset.toggleClass("collapsed");
                        if(!$fieldset.is('.collapsed')) $fieldset.trigger('groupshow');
                    }
                    me.$checkicon.toggleClass("icon-check");
			})
			.parent()
			.find('label[for="' + this.$el.attr("id") + '"]')
			.prepend(this.$checkicon);
	};

	$.fn['prtgFieldsetToggler'] = function(options) {
		return this.each(function() {
			if (!$.data(this, 'plugin_prtgFieldsetToggler')) {
				var type = $(this).attr("type");
				if (type === "checkbox") {
					$.data(this, 'plugin_prtgFieldsetToggler', new prtgFieldsetToggler(this, options));
				}
			}
		});
	};


  function Country(element, data, parent){
    this.element = element;
    this.data = data;
    this.parent = parent;
    this.phonefield = null;
    this.countrynamefield = null;
    if(this.data.phoneFieldId)
      this.phonefield = document.getElementById(this.data.phoneFieldId);
    if(this.data.countryNameId)
      this.countrynamefield = document.getElementById(this.data.countryNameId);
    this.init(this);
  }

  Country.prototype.init = function init(_this){
      var currentcountry = _this.data.country;
      var options = '';
      Object.keys(countries).sort()
        .forEach(function(key){
          var country = countries[key];
          options += '<option value="' + key + '" data-country="' + JSON.stringify(country) + '" '+ (key===currentcountry ? ' selected' : '') + '>' + country.name + '</option>';
        });
      _this.element.insertAdjacentHTML('beforeend', options);

      if(_this.phonefield){
        if(currentcountry.length)
          _this.phonefield.value = '+' + countries[currentcountry].code;
        else
          _this.phonefield.value = '+' + countries[_this.element.options[_this.element.selectedIndex].value].code;
        _this.element.addEventListener('change', function(){
          _this.phonefield.value = '+' + countries[_this.element.options[_this.element.selectedIndex].value].code;
        });
      }
      if(_this.countrynamefield){
        if(currentcountry.length)
          _this.countrynamefield.value = currentcountry + ': ' + countries[currentcountry].name;
        else
          _this.countrynamefield.value = _this.element.options[_this.element.selectedIndex].value + ': ' + countries[_this.element.options[_this.element.selectedIndex].value].name;
        _this.element.addEventListener('change', function(){
          _this.countrynamefield.value = _this.element.options[_this.element.selectedIndex].value + ': ' + countries[_this.element.options[_this.element.selectedIndex].value].name;
        });
      }
  };

  _Prtg.Plugins.registerPlugin('country-select', Country);

  var countries = {
    "BD": {
        "code": "880",
        "name": "\u09ac\u09be\u0982\u09b2\u09be\u09a6\u09c7\u09b6 \u0997\u09a3\u09aa\u09cd\u09b0\u099c\u09be\u09a4\u09a8\u09cd\u09a4\u09cd\u09b0\u09c0 (Bangladesh)"
    },
    "BF": {
        "code": "226",
        "name": "Burkina Faso"
    },
    "BG": {
        "code": "359",
        "name": "\u0411\u044a\u043b\u0433\u0430\u0440\u0438\u044f (Bulgaria)"
    },
    "BA": {
        "code": "387",
        "name": "Bosna i Hercegovina (Bosnia and Herzegovina)"
    },
    "BB": {
        "code": "1246",
        "name": "Barbados"
    },
    "BE": {
        "code": "32",
        "name": "Belgi\u00eb (Belgium)"
    },
    "BL": {
        "code": "590",
        "name": "Saint-Barth\u00e9lemy (Saint Barth\u00e9lemy)"
    },
    "BM": {
        "code": "1441",
        "name": "Bermuda"
    },
    "BN": {
        "code": "673",
        "name": "Negara Brunei Darussalam (Brunei)"
    },
    "BO": {
        "code": "591",
        "name": "Estado Plurinacional de Bolivia (Bolivia)"
    },
    "BH": {
        "code": "973",
        "name": "\u200f\u0627\u0644\u0628\u062d\u0631\u064a\u0646 (Bahrain)"
    },
    "BI": {
        "code": "257",
        "name": "R\u00e9publique du Burundi (Burundi)"
    },
    "BJ": {
        "code": "229",
        "name": "B\u00e9nin (Benin)"
    },
    "BT": {
        "code": "975",
        "name": "\u0f60\u0f56\u0fb2\u0f74\u0f42\u0f0b\u0f61\u0f74\u0f63\u0f0b (Bhutan)"
    },
    "JM": {
        "code": "1876",
        "name": "Jamaica"
    },
    "BV": {
        "code": "47",
        "name": "Bouvet\u00f8ya (Bouvet Island)"
    },
    "BW": {
        "code": "267",
        "name": "Republic of Botswana (Botswana)"
    },
    "WS": {
        "code": "685",
        "name": "S\u0101moa (Samoa)"
    },
    "BR": {
        "code": "55",
        "name": "Brasil (Brazil)"
    },
    "BS": {
        "code": "1242",
        "name": "Commonwealth of the Bahamas (Bahamas)"
    },
    "JE": {
        "code": "44",
        "name": "Bailiwick of Jersey (Jersey)"
    },
    "BZ": {
        "code": "501",
        "name": "Belize"
    },
    "RU": {
        "code": "7",
        "name": "\u0420\u043e\u0441\u0441\u0438\u044f (Russia)"
    },
    "RW": {
        "code": "250",
        "name": "Rwanda"
    },
    "RS": {
        "code": "381",
        "name": "\u0421\u0440\u0431\u0438\u0458\u0430 (Serbia)"
    },
    "TL": {
        "code": "670",
        "name": "Rep\u00fablica Democr\u00e1tica de Timor-Leste (Timor-Leste)"
    },
    "RE": {
        "code": "262",
        "name": "La R\u00e9union (R\u00e9union)"
    },
    "TM": {
        "code": "993",
        "name": "T\u00fcrkmenistan (Turkmenistan)"
    },
    "TJ": {
        "code": "992",
        "name": "\u0422\u043e\u04b7\u0438\u043a\u0438\u0441\u0442\u043e\u043d (Tajikistan)"
    },
    "RO": {
        "code": "40",
        "name": "Rom\u00e2nia (Romania)"
    },
    "TK": {
        "code": "690",
        "name": "Tokelau"
    },
    "GW": {
        "code": "245",
        "name": "Guin\u00e9-Bissau (Guinea-Bissau)"
    },
    "GU": {
        "code": "1671",
        "name": "Guam"
    },
    "GT": {
        "code": "502",
        "name": "Rep\u00fablica de Guatemala (Guatemala)"
    },
    "GS": {
        "code": "500",
        "name": "South Georgia and the South Sandwich Islands (South Georgia)"
    },
    "GR": {
        "code": "30",
        "name": "\u0395\u03bb\u03bb\u03ac\u03b4\u03b1 (Greece)"
    },
    "GQ": {
        "code": "240",
        "name": "Guinea Ecuatorial (Equatorial Guinea)"
    },
    "GP": {
        "code": "590",
        "name": "Guadeloupe"
    },
    "JP": {
        "code": "81",
        "name": "\u65e5\u672c (Japan)"
    },
    "GY": {
        "code": "592",
        "name": "Co-operative Republic of Guyana (Guyana)"
    },
    "GG": {
        "code": "44",
        "name": "Bailiwick of Guernsey (Guernsey)"
    },
    "GF": {
        "code": "594",
        "name": "Guyane fran\u00e7aise (French Guiana)"
    },
    "GE": {
        "code": "995",
        "name": "\u10e1\u10d0\u10e5\u10d0\u10e0\u10d7\u10d5\u10d4\u10da\u10dd (Georgia)"
    },
    "GD": {
        "code": "1473",
        "name": "Grenada"
    },
    "GB": {
        "code": "44",
        "name": "United Kingdom of Great Britain and Northern Ireland (United Kingdom)"
    },
    "GA": {
        "code": "241",
        "name": "R\u00e9publique gabonaise (Gabon)"
    },
    "SV": {
        "code": "503",
        "name": "Rep\u00fablica de El Salvador (El Salvador)"
    },
    "GM": {
        "code": "220",
        "name": "Republic of the Gambia (Gambia)"
    },
    "GL": {
        "code": "299",
        "name": "Kalaallit Nunaat (Greenland)"
    },
    "GI": {
        "code": "350",
        "name": "Gibraltar"
    },
    "GH": {
        "code": "233",
        "name": "Republic of Ghana (Ghana)"
    },
    "OM": {
        "code": "968",
        "name": "\u0639\u0645\u0627\u0646 (Oman)"
    },
    "TN": {
        "code": "216",
        "name": "\u062a\u0648\u0646\u0633 (Tunisia)"
    },
    "JO": {
        "code": "962",
        "name": "\u0627\u0644\u0623\u0631\u062f\u0646 (Jordan)"
    },
    "WF": {
        "code": "681",
        "name": "Wallis et Futuna (Wallis and Futuna)"
    },
    "HR": {
        "code": "385",
        "name": "Hrvatska (Croatia)"
    },
    "HT": {
        "code": "509",
        "name": "Ha\u00efti (Haiti)"
    },
    "HU": {
        "code": "36",
        "name": "Magyarorsz\u00e1g (Hungary)"
    },
    "HK": {
        "code": "852",
        "name": "\u9999\u6e2f (Hong Kong)"
    },
    "HN": {
        "code": "504",
        "name": "Rep\u00fablica de Honduras (Honduras)"
    },
    "HM": {
        "code": "672",
        "name": "Heard Island and McDonald Islands"
    },
    "VE": {
        "code": "58",
        "name": "Rep\u00fablica Bolivariana de Venezuela (Venezuela)"
    },
    "PR": {
        "code": "1",
        "name": "Estado Libre Asociado de Puerto Rico (Puerto Rico)"
    },
    "PS": {
        "code": "970",
        "name": "\u0641\u0644\u0633\u0637\u064a\u0646 (Palestine)"
    },
    "PW": {
        "code": "680",
        "name": "Republic of Palau (Palau)"
    },
    "PT": {
        "code": "351",
        "name": "Rep\u00fablica portugu\u00eas (Portugal)"
    },
    "SJ": {
        "code": "4779",
        "name": "Svalbard og Jan Mayen (Svalbard and Jan Mayen)"
    },
    "PY": {
        "code": "595",
        "name": "Rep\u00fablica de Paraguay (Paraguay)"
    },
    "IQ": {
        "code": "964",
        "name": "\u0627\u0644\u0639\u0631\u0627\u0642 (Iraq)"
    },
    "PA": {
        "code": "507",
        "name": "Panam\u00e1 (Panama)"
    },
    "PF": {
        "code": "689",
        "name": "Polyn\u00e9sie fran\u00e7aise (French Polynesia)"
    },
    "PG": {
        "code": "675",
        "name": "Papua Niugini (Papua New Guinea)"
    },
    "PE": {
        "code": "51",
        "name": "Per\u00fa (Peru)"
    },
    "PK": {
        "code": "92",
        "name": "Islamic Republic of Pakistan (Pakistan)"
    },
    "PH": {
        "code": "63",
        "name": "Pilipinas (Philippines)"
    },
    "PN": {
        "code": "64",
        "name": "Pitcairn Group of Islands (Pitcairn Islands)"
    },
    "PL": {
        "code": "48",
        "name": "Polska (Poland)"
    },
    "PM": {
        "code": "508",
        "name": "Saint-Pierre-et-Miquelon (Saint Pierre and Miquelon)"
    },
    "ZM": {
        "code": "260",
        "name": "Republic of Zambia (Zambia)"
    },
    "EH": {
        "code": "212",
        "name": "\u0627\u0644\u0635\u062d\u0631\u0627\u0621 \u0627\u0644\u063a\u0631\u0628\u064a\u0629 (Western Sahara)"
    },
    "EE": {
        "code": "372",
        "name": "Eesti (Estonia)"
    },
    "EG": {
        "code": "20",
        "name": "\u0645\u0635\u0631 (Egypt)"
    },
    "ZA": {
        "code": "27",
        "name": "Republiek van Suid-Afrika (South Africa)"
    },
    "EC": {
        "code": "593",
        "name": "Rep\u00fablica del Ecuador (Ecuador)"
    },
    "IT": {
        "code": "39",
        "name": "Italia (Italy)"
    },
    "VN": {
        "code": "84",
        "name": "Vi\u1ec7t Nam (Vietnam)"
    },
    "SB": {
        "code": "677",
        "name": "Solomon Islands"
    },
    "ET": {
        "code": "251",
        "name": "\u12a2\u1275\u12ee\u1335\u12eb (Ethiopia)"
    },
    "SA": {
        "code": "966",
        "name": "\u0627\u0644\u0639\u0631\u0628\u064a\u0629 \u0627\u0644\u0633\u0639\u0648\u062f\u064a\u0629 (Saudi Arabia)"
    },
    "ES": {
        "code": "34",
        "name": "Espa\u00f1a (Spain)"
    },
    "ME": {
        "code": "382",
        "name": "\u0426\u0440\u043d\u0430 \u0413\u043e\u0440\u0430 (Montenegro)"
    },
    "MD": {
        "code": "373",
        "name": "Republica Moldova (Moldova)"
    },
    "MG": {
        "code": "261",
        "name": "Madagasikara (Madagascar)"
    },
    "MF": {
        "code": "590",
        "name": "Saint-Martin (Saint Martin)"
    },
    "MA": {
        "code": "212",
        "name": "\u0627\u0644\u0645\u063a\u0631\u0628 (Morocco)"
    },
    "MC": {
        "code": "377",
        "name": "Principaut\u00e9 de Monaco (Monaco)"
    },
    "UZ": {
        "code": "998",
        "name": "O\u2018zbekiston (Uzbekistan)"
    },
    "ML": {
        "code": "223",
        "name": "R\u00e9publique du Mali (Mali)"
    },
    "MO": {
        "code": "853",
        "name": "\u6fb3\u9580 (Macau)"
    },
    "MN": {
        "code": "976",
        "name": "\u041c\u043e\u043d\u0433\u043e\u043b \u0443\u043b\u0441 (Mongolia)"
    },
    "MH": {
        "code": "692",
        "name": "M\u0327aje\u013c (Marshall Islands)"
    },
    "MK": {
        "code": "389",
        "name": "\u041c\u0430\u043a\u0435\u0434\u043e\u043d\u0438\u0458\u0430 (Macedonia)"
    },
    "MU": {
        "code": "230",
        "name": "Maurice (Mauritius)"
    },
    "MT": {
        "code": "356",
        "name": "Malta"
    },
    "MW": {
        "code": "265",
        "name": "Mala\u0175i (Malawi)"
    },
    "MV": {
        "code": "960",
        "name": "\u078b\u07a8\u0788\u07ac\u0780\u07a8\u0783\u07a7\u0787\u07b0\u0796\u07ad\u078e\u07ac (Maldives)"
    },
    "MQ": {
        "code": "596",
        "name": "Martinique"
    },
    "MP": {
        "code": "1670",
        "name": "Commonwealth of the Northern Mariana Islands (Northern Mariana Islands)"
    },
    "MS": {
        "code": "1664",
        "name": "Montserrat"
    },
    "MR": {
        "code": "222",
        "name": "\u0645\u0648\u0631\u064a\u062a\u0627\u0646\u064a\u0627 (Mauritania)"
    },
    "IM": {
        "code": "44",
        "name": "Isle of Man"
    },
    "UG": {
        "code": "256",
        "name": "Republic of Uganda (Uganda)"
    },
    "MY": {
        "code": "60",
        "name": "\u0645\u0644\u064a\u0633\u064a\u0627 (Malaysia)"
    },
    "MX": {
        "code": "52",
        "name": "M\u00e9xico (Mexico)"
    },
    "IL": {
        "code": "972",
        "name": "\u05d9\u05e9\u05e8\u05d0\u05dc (Israel)"
    },
    "FR": {
        "code": "33",
        "name": "R\u00e9publique fran\u00e7aise (France)"
    },
    "IO": {
        "code": "246",
        "name": "British Indian Ocean Territory"
    },
    "FX": {
        "code": "33",
        "name": "R\u00e9publique fran\u00e7aise (France)"
    },
    "SH": {
        "code": "290",
        "name": "Saint Helena, Ascension and Tristan da Cunha"
    },
    "AX": {
        "code": "358",
        "name": "\u00c5land (\u00c5land Islands)"
    },
    "FI": {
        "code": "358",
        "name": "Suomi (Finland)"
    },
    "FJ": {
        "code": "679",
        "name": "Republic of Fiji (Fiji)"
    },
    "FK": {
        "code": "500",
        "name": "Falkland Islands"
    },
    "FM": {
        "code": "691",
        "name": "Federated States of Micronesia (Micronesia)"
    },
    "FO": {
        "code": "298",
        "name": "F\u00f8royar (Faroe Islands)"
    },
    "NI": {
        "code": "505",
        "name": "Rep\u00fablica de Nicaragua (Nicaragua)"
    },
    "NL": {
        "code": "31",
        "name": "Nederland (Netherlands)"
    },
    "NO": {
        "code": "47",
        "name": "Norge (Norway)"
    },
    "NA": {
        "code": "264",
        "name": "Republic of Namibia (Namibia)"
    },
    "VU": {
        "code": "678",
        "name": "Ripablik blong Vanuatu (Vanuatu)"
    },
    "NC": {
        "code": "687",
        "name": "Nouvelle-Cal\u00e9donie (New Caledonia)"
    },
    "NE": {
        "code": "227",
        "name": "R\u00e9publique du Niger (Niger)"
    },
    "NF": {
        "code": "672",
        "name": "Territory of Norfolk Island (Norfolk Island)"
    },
    "NG": {
        "code": "234",
        "name": "Federal Republic of Nigeria (Nigeria)"
    },
    "NZ": {
        "code": "64",
        "name": "New Zealand"
    },
    "NP": {
        "code": "977",
        "name": "\u0928\u092a\u0932 (Nepal)"
    },
    "NR": {
        "code": "674",
        "name": "Republic of Nauru (Nauru)"
    },
    "NU": {
        "code": "683",
        "name": "Niu\u0113 (Niue)"
    },
    "CK": {
        "code": "682",
        "name": "Cook Islands"
    },
    "CH": {
        "code": "41",
        "name": "Schweiz (Switzerland)"
    },
    "CO": {
        "code": "57",
        "name": "Rep\u00fablica de Colombia (Colombia)"
    },
    "CN": {
        "code": "86",
        "name": "\u4e2d\u56fd (China)"
    },
    "CM": {
        "code": "237",
        "name": "Cameroun (Cameroon)"
    },
    "CL": {
        "code": "56",
        "name": "Rep\u00fablica de Chile (Chile)"
    },
    "CC": {
        "code": "61",
        "name": "Territory of the Cocos (Keeling) Islands (Cocos (Keeling) Islands)"
    },
    "CA": {
        "code": "1",
        "name": "Canada"
    },
    "CG": {
        "code": "242",
        "name": "R\u00e9publique du Congo (Republic of the Congo)"
    },
    "CF": {
        "code": "236",
        "name": "B\u00eaafr\u00eeka (Central African Republic)"
    },
    "CZ": {
        "code": "420",
        "name": "\u010cesk\u00e1 republika (Czech Republic)"
    },
    "CY": {
        "code": "357",
        "name": "\u039a\u03cd\u03c0\u03c1\u03bf\u03c2 (Cyprus)"
    },
    "CX": {
        "code": "61",
        "name": "Territory of Christmas Island (Christmas Island)"
    },
    "CR": {
        "code": "506",
        "name": "Rep\u00fablica de Costa Rica (Costa Rica)"
    },
    "CV": {
        "code": "238",
        "name": "Cabo Verde (Cape Verde)"
    },
    "CU": {
        "code": "53",
        "name": "Rep\u00fablica de Cuba (Cuba)"
    },
    "SZ": {
        "code": "268",
        "name": "Kingdom of Swaziland (Swaziland)"
    },
    "KG": {
        "code": "996",
        "name": "\u041a\u044b\u0440\u0433\u044b\u0437\u0441\u0442\u0430\u043d (Kyrgyzstan)"
    },
    "KE": {
        "code": "254",
        "name": "Republic of Kenya (Kenya)"
    },
    "SR": {
        "code": "597",
        "name": "Republiek Suriname (Suriname)"
    },
    "KI": {
        "code": "686",
        "name": "Independent and Sovereign Republic of Kiribati (Kiribati)"
    },
    "KH": {
        "code": "855",
        "name": "K\u00e2mp\u016dch\u00e9a (Cambodia)"
    },
    "KN": {
        "code": "1869",
        "name": "Federation of Saint Christopher and Nevisa (Saint Kitts and Nevis)"
    },
    "KM": {
        "code": "269",
        "name": "Komori (Comoros)"
    },
    "ST": {
        "code": "239",
        "name": "S\u00e3o Tom\u00e9 e Pr\u00edncipe (S\u00e3o Tom\u00e9 and Pr\u00edncipe)"
    },
    "SK": {
        "code": "421",
        "name": "Slovensko (Slovakia)"
    },
    "KR": {
        "code": "82",
        "name": "\ub300\ud55c\ubbfc\uad6d (South Korea)"
    },
    "SI": {
        "code": "386",
        "name": "Slovenija (Slovenia)"
    },
    "KW": {
        "code": "965",
        "name": "\u0627\u0644\u0643\u0648\u064a\u062a (Kuwait)"
    },
    "SN": {
        "code": "221",
        "name": "S\u00e9n\u00e9gal (Senegal)"
    },
    "SM": {
        "code": "378",
        "name": "Serenissima Repubblica di San Marino (San Marino)"
    },
    "SL": {
        "code": "232",
        "name": "Republic of Sierra Leone (Sierra Leone)"
    },
    "SC": {
        "code": "248",
        "name": "R\u00e9publique des Seychelles (Seychelles)"
    },
    "KZ": {
        "code": "7",
        "name": "\u049a\u0430\u0437\u0430\u049b\u0441\u0442\u0430\u043d (Kazakhstan)"
    },
    "KY": {
        "code": "1345",
        "name": "Cayman Islands"
    },
    "SG": {
        "code": "65",
        "name": "Republic of Singapore (Singapore)"
    },
    "SE": {
        "code": "46",
        "name": "Sverige (Sweden)"
    },
    "DO": {
        "code": "1",
        "name": "Rep\u00fablica Dominicana (Dominican Republic)"
    },
    "DM": {
        "code": "1767",
        "name": "Commonwealth of Dominica (Dominica)"
    },
    "DJ": {
        "code": "253",
        "name": "R\u00e9publique de Djibouti (Djibouti)"
    },
    "DK": {
        "code": "45",
        "name": "Danmark (Denmark)"
    },
    "VG": {
        "code": "1284",
        "name": "Virgin Islands (British Virgin Islands)"
    },
    "DE": {
        "code": "49",
        "name": "Deutschland (Germany)"
    },
    "YE": {
        "code": "967",
        "name": "\u0627\u0644\u064a\u064e\u0645\u064e\u0646 (Yemen)"
    },
    "DZ": {
        "code": "213",
        "name": "\u0627\u0644\u062c\u0632\u0627\u0626\u0631 (Algeria)"
    },
    "US": {
        "code": "1",
        "name": "United States of America (United States)"
    },
    "UY": {
        "code": "598",
        "name": "Rep\u00fablica Oriental del Uruguay (Uruguay)"
    },
    "YT": {
        "code": "262",
        "name": "D\u00e9partement de Mayotte (Mayotte)"
    },
    "UM": {
        "code": "1",
        "name": "United States Minor Outlying Islands"
    },
    "LC": {
        "code": "1758",
        "name": "Saint Lucia"
    },
    "LA": {
        "code": "856",
        "name": "\u0eaa\u0e9b\u0e9b\u0ea5\u0eb2\u0ea7 (Laos)"
    },
    "TV": {
        "code": "688",
        "name": "Tuvalu"
    },
    "TW": {
        "code": "886",
        "name": "\u81fa\u7063 (Taiwan)"
    },
    "TT": {
        "code": "1868",
        "name": "Republic of Trinidad and Tobago (Trinidad and Tobago)"
    },
    "TR": {
        "code": "90",
        "name": "T\u00fcrkiye (Turkey)"
    },
    "LK": {
        "code": "94",
        "name": "\u0dc1\u0dca\u200d\u0dbb\u0dd3 \u0dbd\u0d82\u0d9a\u0dcf\u0dc0 (Sri Lanka)"
    },
    "LI": {
        "code": "423",
        "name": "F\u00fcrstentum Liechtenstein (Liechtenstein)"
    },
    "LV": {
        "code": "371",
        "name": "Latvija (Latvia)"
    },
    "TO": {
        "code": "676",
        "name": "Kingdom of Tonga (Tonga)"
    },
    "LT": {
        "code": "370",
        "name": "Lietuva (Lithuania)"
    },
    "LU": {
        "code": "352",
        "name": "Grand-Duch\u00e9 de Luxembourg (Luxembourg)"
    },
    "LS": {
        "code": "266",
        "name": "Kingdom of Lesotho (Lesotho)"
    },
    "TH": {
        "code": "66",
        "name": "\u0e1b\u0e23\u0e30\u0e40\u0e17\u0e28\u0e44\u0e17\u0e22 (Thailand)"
    },
    "TF": {
        "code": "262",
        "name": "Territoire des Terres australes et antarctiques fran\u00e7aises"
    },
    "TG": {
        "code": "228",
        "name": "R\u00e9publique togolaise (Togo)"
    },
    "TD": {
        "code": "235",
        "name": "Tchad (Chad)"
    },
    "TC": {
        "code": "1649",
        "name": "Turks and Caicos Islands"
    },
    "VA": {
        "code": "379",
        "name": "Vaticano (Vatican City)"
    },
    "VC": {
        "code": "1784",
        "name": "Saint Vincent and the Grenadines"
    },
    "AE": {
        "code": "971",
        "name": "\u062f\u0648\u0644\u0629 \u0627\u0644\u0625\u0645\u0627\u0631\u0627\u062a \u0627\u0644\u0639\u0631\u0628\u064a\u0629 \u0627\u0644\u0645\u062a\u062d\u062f\u0629 (United Arab Emirates)"
    },
    "AD": {
        "code": "376",
        "name": "Andorra"
    },
    "AG": {
        "code": "1268",
        "name": "Antigua and Barbuda"
    },
    "AF": {
        "code": "93",
        "name": "\u0627\u0641\u063a\u0627\u0646\u0633\u062a\u0627\u0646 (Afghanistan)"
    },
    "AI": {
        "code": "1264",
        "name": "Anguilla"
    },
    "VI": {
        "code": "1340",
        "name": "Virgin Islands of the United States (United States Virgin Islands)"
    },
    "IS": {
        "code": "354",
        "name": "\u00cdsland (Iceland)"
    },
    "AM": {
        "code": "374",
        "name": "\u0540\u0561\u0575\u0561\u057d\u057f\u0561\u0576 (Armenia)"
    },
    "AL": {
        "code": "355",
        "name": "Shqip\u00ebria (Albania)"
    },
    "AO": {
        "code": "244",
        "name": "Rep\u00fablica de Angola (Angola)"
    },
    "AN": {
        "code": "599",
        "name": "Antia Hulandes (Netherlands Antilles)"
    },
    "AQ": {
        "code": "672",
        "name": "Antarctica"
    },
    "AS": {
        "code": "1684",
        "name": "American Samoa"
    },
    "AR": {
        "code": "54",
        "name": "Rep\u00fablica Argentina (Argentina)"
    },
    "AU": {
        "code": "61",
        "name": "Commonwealth of Australia (Australia)"
    },
    "AT": {
        "code": "43",
        "name": "\u00d6sterreich (Austria)"
    },
    "AW": {
        "code": "297",
        "name": "Aruba"
    },
    "IN": {
        "code": "91",
        "name": "\u092d\u093e\u0930\u0924 (India)"
    },
    "TZ": {
        "code": "255",
        "name": "Jamhuri ya Muungano wa Tanzania (Tanzania)"
    },
    "AZ": {
        "code": "994",
        "name": "Az\u0259rbaycan (Azerbaijan)"
    },
    "IE": {
        "code": "353",
        "name": "\u00c9ire (Ireland)"
    },
    "ID": {
        "code": "62",
        "name": "Republik Indonesia (Indonesia)"
    },
    "UA": {
        "code": "380",
        "name": "\u0423\u043a\u0440\u0430\u0457\u043d\u0430 (Ukraine)"
    },
    "QA": {
        "code": "974",
        "name": "\u0642\u0637\u0631 (Qatar)"
    },
    "MZ": {
        "code": "258",
        "name": "Mo\u00e7ambique (Mozambique)"
    }
  };
  countries.sort


})(jQuery, window, document);
;
//_Prtg.QRCode.Plugin.js
(function($, window, document, undefined) {
  var pluginName = "prtgqrcode";

  function Plugin(element, data, parent) {
    var phash = $("button[prop]").attr("prop");
    var $element = $(element);
    if(data.myaccountqr) {
      data.url = document.location.origin + data.url;
      if(!!phash)
        data.url += '&passhash=' + phash;
      if(data.sitename)
        data.url += '&sitename=' + data.sitename;
        console.log(data.url)
    }

    var preferredWidth = $element.data('qrwidth') || 200;
      var preferredHeight = $element.data('qrheight') || 200;

    var qrcode = {
        text: data.url
          || (window.action && window.action
              .replace(/\/controls/,location.origin)
              .replace(/overview/,''))
          || document.location.href,
         width: preferredWidth * (data.zoom || 1),
         height: preferredHeight * (data.zoom || 1) - ($element.is('.onmap')?40:0)
      };
    qrcode.text = qrcode.text.replace(location.origin, location.origin)
      .replace(document.location.hostname,(_Prtg.Options.dnsname||document.location.hostname));

    $element.qrcode(qrcode);
    var canvas = $element.find('canvas')[0];
    var x = canvas.width / 2;
    var y = canvas.height + 40;
    var tempCanvas = document.createElement('canvas');
    tempCanvas.width = canvas.width;
    tempCanvas.height = canvas.height;
    try {
      tempCanvas.getContext('2d').drawImage(canvas, 0, 0);
    } catch (e) {
      // throw "_Prtg.QRCode.Plugin.js 2d canvas has no height or width, something seems to be wrong with css";
    }
    canvas.height = y;
    var context = canvas.getContext('2d');
    context.fillStyle = "white";
    context.fill();
    context.drawImage(tempCanvas, 0, 8);
    context.font = '13px Calibri';
    context.textAlign = 'center';
    context.fillStyle = 'black';
    context.fillText(data.name, x, y - 12);
    if (data.name !== data.host) context.fillText(data.host, x, y);
    context.font = '8px Calibri';
    context.fillText(qrcode.text, x, y - 24);
    context.textAlign = 'left';
    context.fillText("PRTG Network Monitor", 1, 6);
    context.textAlign = 'right';
    context.fillText("Paessler AG", x * 2 - 1, 6);

    $element.on('click', function() {
      _Prtg.Dialogs.alert($('<div class="qrcode-image"><img src="'+canvas.toDataURL()+'" style="margin:15px auto;display: block;"></div>'),
        data.name,
        {
          height:300,
          width:300
        }
        );
    });
  }
  _Prtg.Plugins.registerPlugin(pluginName, Plugin);
})(jQuery, window, document);
;
//_Prtg.Feedbackform.Plugin.js
(function($, window, document, undefined) {
		var pluginName = 'feedback';

		function Plugin(element, data, parent) {
			this.element = $(element);
			this.data = data;
			this.parent = parent;
			this.init(this);
		}

		Plugin.prototype.init = function(me) {
      var screenshot = $('#screenshot',me.element),
          buttons = null,
          uiButtons = null;
      me.element 
      .on('click','#includescreenshotradio',function() {
          if (screenshot.find('.loadspinner').length == 0){
              screenshot.append('<div class="loadspinner"></div>')
          }
        screenshot.addClass('loading');
    		if(!!window.winGUI)
    			alert('includescreenshot');
    		else
          $.ajax({
            url: '/controls/screenshot.htm',
      		  timeout: 60000,
            data:{
              what: encodeURI(document.location.pathname + document.location.search),
              width: window.innerWidth,
              height: window.innerHeight,
              delay: 5
            },
            beforeSend: function(jqXHR){
              jqXHR.ignoreManager = true;
              buttons = me.element.find('button');
              uiButtons = me.element.closest('#feedbackform').siblings('.ui-dialog-buttonpane').find('button');
              uiButtons.button('disable');
              buttons.attr("disabled",'disabled');
            }
          }).always(function(){
            uiButtons.button('enable');
            buttons.removeAttr("disabled");
          }).done(function(data){
            screenshot.html(data).removeClass('loading');
          })
      })
      .on('click','#includescreenshotradio',function() {
  			screenshot.show();
      })
      .on('click','#donotincludescreenshotradio',function() {
	   		screenshot.hide();
      })
      .find('#textarea2').each(function() {
        $(this).val($('<div>' + $(this).val() + '</div>').text());
      });

    };

		$.fn[pluginName] = function(options, parent) {
			return this.each(function() {
				if (!$.data(this, "plugin_" + pluginName)) {
					$.data(this, "plugin_" + pluginName, new Plugin(this, options, parent));
				}
			});
		};
})(jQuery, window, document);
;
/* _Prtg.Ausiblealarm.js */
(function ($, window, document, undefined) {
  _Prtg.AudibleAlarm = {
    playAlarm: function() {
      if(_Prtg.Options.playAlarmSound === 0) return;
      if(_Prtg.Options.playAlarmSound === 1 && !($('#dashboard1').length || $('#dashboard2').length || $('#dashboard3').length)) return;

      if($('#audiblealarm').length <= 0) {
        $("#alarmsound").empty().append('<audio id="audiblealarm"><source src="/sounds/beep.ogg" type="audio/ogg" /><source src="/sounds/beep.mp3" type="audio/mpeg3" /></audio>');
      }
      var audiblealarm = document.getElementById("audiblealarm");
      audiblealarm.load();
      audiblealarm.play();
    }
  };
})(jQuery, window, document);
;
//_Prtg.UserAndGroups.js
(function($, window, document, undefined) {

  function userandgroups(element, data, parent) {
    this.data = data;
    this.$element = $(element);
    this.$parent = $(parent);
    this.timer = this.$parent.Events && this.$parent.Events();
    this.initTicketUserAndGroup(this, data.ticketid, data.objectid);
    // else
    //   this.initUserAndGroup(this);
  }
  userandgroups.prototype.initTicketUserAndGroup = function(me, ticketid, objectid){
    var insert = me.$element.parent();
    me.$element.detach();
    me.$element.append('<option data-reload=\'[{"name":"filter_user","value":"'+_Prtg.Options.currentUserId+'"},{"name":"start","value":"0"}]\' value="' + _Prtg.Options.currentUserId +'"' + (_Prtg.Options.currentUserId==me.data.selector?' selected':'') + '>' + _Prtg.Lang.Dialogs.strings.assignedtome + '</option>');
    me.$element.append('<optgroup group label="'+_Prtg.Lang.common.strings['Groups']+'">');
    me.$element.append('<optgroup users label="'+_Prtg.Lang.common.strings['Users']+'">');
    me.$element.append('<optgroup disallowed label="'+_Prtg.Lang.common.strings['Disallowed']+'">');

    $.ajax({
      url: "/api/userlist.json",
      data: {
        id: ticketid,
        objectid: objectid
      },
      dataType: "json",
      type: "GET"
    }).done(function(data){
        var list = data["userlist"]
          , dest = null
          , group = me.$element.find("optgroup[group]")
          , users = me.$element.find("optgroup[users]")
          , disal = me.$element.find("optgroup[disallowed]");
        if(!!list)
          for(var i = 0; i < list.length; i++) {
            if(!list[i].access)
              dest = disal;
            else if(!list[i].isgroup)
              dest = users;
            else
              dest = group;
            dest.append('<option'+(!list[i].access?' disabled ':' ')+'data-reload=\'[{"name":"filter_user","value":"'+list[i]["objid"]+'"},{"name":"start","value":"0"}]\' value="' + list[i]["objid"] +'"'+ (me.data.selector==list[i]["objid"] && me.data.selector!=_Prtg.Options.currentUserId? ' selected':'') + '>' + list[i]["name"] + '</option>');
          }
    }).always(function(){
      insert.append(me.$element);
      !!me.$element.selectmenu && me.$element.selectmenu('refresh',true);
    });
  }
  userandgroups.prototype.initUserAndGroup = function(me) {
    
    me.$element.append('<optgroup label="'+_Prtg.Lang.common.strings['Groups']+'">');
    me.$element.append('<optgroup label="'+_Prtg.Lang.common.strings['Users']+'">');

    $.ajax({
      url: "/api/table.json",
      data: {
        "content": "usergroups",
        "output": "json",
        "columns": "name,objid",
        "sortby": "name"
      },
      dataType: "json",
      type: "GET"
    }).done(function(data){
        var groupList = data["usergroups"]
          , $group = me.$element.find('optgroup[label="'+_Prtg.Lang.common.strings['Groups']+'"]');
        if(!!groupList)
        for(var i = 0; i < groupList.length; i++) {
          $group.append('<option class="group" data-reload=\'[{"name":"filter_user","value":"'+groupList[i]["objid"]+'"}]\' value="' + groupList[i]["objid"] +'"'+ (me.data.selector===groupList[i]["objid"] ? ' selected':'') + '>' + groupList[i]["name"] + '</option>');
        }
    });

      $.ajax({
        url: "/api/table.json",
        data: {
          "content": "users",
          "output": "json",
          "columns": "name,objid",
          "sortby": "name"
        },
        dataType: "json",
        type: "GET"
      }).done(function(data){
        var groupList = data['users']
          , $group = me.$element.find('optgroup[label="'+_Prtg.Lang.common.strings['Users']+'"]');
        if(!!groupList)
        for(var i = 0; i < groupList.length; i++) {
          $group.append('<option class="user" data-reload=\'[{"name":"filter_user","value":"'+groupList[i]["objid"]+'"}]\' value="' + groupList[i]["objid"] +'"'+ (me.data.selector===groupList[i]["objid"] ? ' selected="selected"':'') + '>' + groupList[i]["name"] + '</option>');
        }
      });
  };

  userandgroups.prototype.refresh = function() {

  };

  _Prtg.Plugins.registerPlugin("userandgroups", userandgroups);

})(jQuery, window, document);
;
(function ($, window, document, undefined) {
  var EVENT = "navigate.prtg,navigate.tab.prtg";
  var pluginName = "ToggleUiButton";
  
  function ToggleUiButton(element, data, parent) {
    this.port = data.appserverport;
    this.$element = $(element);
    this.init(this);
  }

  /**
   * returns an URL
   * @param {String} port - valid appserver port
   * @returns {String} example 'https://itmans-prtg.de:8443/monitoring/group/0/overview'
   */
  function buildURL(port) {
    return (
      location.protocol +
      "//" +
      location.hostname +
      ":" +
      port +
      location.pathname +
      location.search
    );
  }

  /**
   * initialize Plugin data
   * @param {ToggleUiButton} context
   */
  ToggleUiButton.prototype.init = function (context) {
    context.$element.on("destroyed", context, context.destroy);
    context.setUrl = context._setUrl.bind(context);
    // initially set url
    context.setUrl();
    _Prtg.Events.subscribe(EVENT, context.setUrl);
  };

  /**
   * unsubscribes from Route Event
   * @param {*} event
   */
  ToggleUiButton.prototype.destroy = function destroyEvent(event) {
    var context = event.data;
    _Prtg.Events.unsubscribe(EVENT, context.setUrl);
  };

  /**
   * finds the current button url
   */
  ToggleUiButton.prototype._setUrl = function () {
    var url = buildURL(this.port);
    this.$element.find("a").attr("href", url);
  };

  _Prtg.Plugins.registerPlugin(pluginName, ToggleUiButton);
})(jQuery, window, document);
;

// _Prtg.Core.js
(function ($) {
	var prtgTemplates;
	function Helper() {
		return {
			loadjstemplates: function() {
				var templates = {
"_prtg.channel.gauge.js":"<*var info = this.info.data[0];var pinclass = this.primary ? 'glyph-pin' : 'glyph-pin glyph-unpinned';*><div class=\"achannel<*=this.primary*> channeledit\" data-channel=\"<*=info.id*>\" id=\"channelbox<*=info.id*>\" title=\"<*=info.name.replace(/\"/g, \"&quot;\")+this.channelidtxt.replace(/\"/g, \"&quot;\")+this.minimumtxt.replace(/\"/g, \"&quot;\")+this.maximumtxt.replace(/\"/g, \"&quot;\")*>\"><span class=\"channelname\"><*=info.name*></span><span class=\"channelgauge\" id=\"channelgauge<*=info.id*>\"></span><span class=\"channelvalue\"><*=this.lastvalue*></span><span class=\"channelsettings <*=_Prtg.Options.userIsReadOnly?' hidden':''*>\" data-channel=\"<*=info.id*>\"><i title=\"<*=_Prtg.Lang.objectoverview.strings.editChannel*>\" class=\"glyph-cog editsetting hideforreadonly\"></i><i title=\"<*=_Prtg.Lang.objectoverview.strings.setPrimaryChannel*>\" class=\"setprimarychannel <*=pinclass*> hideforreadonly\"></i></span></div>",
"_prtg.core.channel.js":"<div class=\"channelItem cell-inner\" idx=\"<*=this._idx*>\" objid=\"<*=this.objid*>\"><div class=\"cell-main\" style=\"margin-left:<*=this._level*2 *>ex\"><b><*=this.name*></b></div></div>",
"_prtg.core.device.js":"<div class=\"treeItem deviceItem cell-inner <*=this._classes.join(' ').trim()*>\"  idx=\"<*=this._idx*>\" level=\"<*=this._level*>\" objid=\"<*=this.objid*>\" type=\"<*=this.basetype.toLowerCase()*>\" path=\"<*=this._id*>\" template=\"_Prtg.Core.device.js\"><*var level, chain = this._siblings.chain(),regexName=/\"/g;for(var k=1; k < this._level; ++k){level = chain.shift() <= this._idx;*><level last=\"<*=level*>\"></level><*}level = chain.shift() <= this._idx;*><level lastX=\"<*=level*>\"><level><toggler></toggler></level></level><div class=\"indent level<*= this._level*>\"><level class=\"device\"><icon <*=(this._access >= 100) ? 'popup=\"333\"' : ''*> style=\"background-image:url(<*=this.icon*>)\"></icon></level><device title=\"<*=_Prtg.Lang.sensorTree.strings.DeviceTitle.printf(this).replace(/\"/g,'&quot;')*>\"><name  <*=(this._access >= 100) ? 'popup=\"3333\" goto=\"true\"' : ''*>><*=this.name*></name><condition><*=this.condition*></condition><favorit><*=this.favorite*></favorit><*if(this.message !== _Prtg.Lang.common.strings.OK){*><message><*=this.message*></message><*}else{*><status></status><*}*></device></div></div>",
"_prtg.core.group.js":"<*var librarymenu = (this._classes.indexOf('librarymenu') > -1);*><div class=\"treeItem cell-inner groupItem <*=this._classes.join(' ')*>\" idx=\"<*=this._idx*>\" level=\"<*=this._level*>\" objid=\"<*=this.objid*>\" type=\"<*=this.basetype.toLowerCase()*>\" path=\"<*=this._id*>\" template=\"_Prtg.Core.group.js\"><*var level, chain = this._siblings.chain(), regexName=/\"/g;for(var k=1; k < this._level; ++k){level = chain.shift() <= this._idx;*><level last=\"<*=level*>\"></level><*}level = chain.shift();*><level lastX=\"<*=level<=this._idx*>\"><level class=\"group\"><toggler></toggler></level></level><div class=\"indent level<*=this._level*>\"><level class=\"group\" last=\"<*=this._children.length===0*>\"><icon <*=(this._access >= 100) ? 'popup=\"333\"' : ''*> style=\"background-image:url(<*=this.icon*>)\"></icon></level><group ><name <*=(this._access >= 100) ? 'popup=\"3333\" goto=\"true\"' : ''*> title=\"<*=!!this._collapsed?_Prtg.Lang.sensorTree.strings.GroupsAndDeviceCount.printf(this).replace(/\"/g,'&quot;'):''*>\"><*=this.name*></name><condition><*=this.condition*></condition><*if(this.message !== _Prtg.Lang.common.strings.OK){*><message><*=this.message*></message><*}else{*><message></message><*}*><*if(!this.smallprobe && this._collapsed === false && this.groupnum === 0 && this.devicenum === 0  && !_Prtg.Options.userIsReadOnly && this._access == 200 && !librarymenu){*><span><a class=\"treeminilink actionbutton\" href=\"#\" onclick=\"_Prtg.objectTools.addObject(<*=this.objid*>,'device');return false;\"><*=_Prtg.Lang.sensorTree.strings.AddDevice*></a></span><*}*></group></div></div>",
"_prtg.core.library.js":"<div class=\"treeItem cell-inner <*=this.libkind==='filter'?'device':'group'*>Item  <*=this._classes.join(' ').trim()*>\" idx=\"<*=this._idx*>\" level=\"<*=this._level*>\" objid=\"<*=this.objid*>\" type=\"<*=this.libkind.toLowerCase()*>\" path=\"<*=this._id*>\" template=\"_Prtg.Core.library.js\"><*var level, chain = this._siblings.chain(),editmode = $('.libTree').parents('#dropTarget').hasClass('treeiseditable');for(var k=1; k < this._level; ++k){level = chain.shift() <= this._idx;*><level last=\"<*=level*>\"></level><*}level = chain.shift();*><level lastX=\"<*=level<= this._idx*>\"><level class=\"library\"> <toggler></toggler></level></level><div class=\"indent level<*=this._level*><*=this._level>1?' library-'+this.libkind:''*><*=this._isroot ? ' libraryroot': ''*>\" type=\"<*=(this.libkind === 'node'? 'library' :'libraryobject')*>\" objid=\"<*=this.objid*>\"><level class=\"library\" goto=\"true\" last=\"<*=this._children.length===0*>\"><icon style=\"background-image:url(<*=_Prtg.Core.objects.icons.icon(this)*>)\"></icon></level><library libkind=\"<*=this.libkind*>\"><* if(this._access >= 100) { *><name goto=\"true\"><*=this.name*></name><* } else { *><name><*=this.name*></name><* } if(editmode){ if(this.libkind === 'node') { *><div class=\"droptarget\"><i class=\"icon-dark icon-lightbulb\"></i><*= _Prtg.Lang.common.strings.DropTarget*></div><* }}else{if(this.libkind === 'node' && this._children.length === 0 && !_Prtg.Options.userIsReadOnly && this._access == 200){ *><span class=\"approve\"><a class=\"treeminilink actionbutton\" href=\"#\" onclick=\"_Prtg.objectTools.addObject('new','library', {targetid:<*=this.objid*>,addid:<*=this.objid*>});return false;\"><*=_Prtg.Lang.sensorTree.strings.AddLibraynode*></a><a class=\"treeminilink actionbutton\" href=\"#\" onclick=\"var lib = $('.libTree').data('sensortree');lib.dataview.addLibrary(lib.grid,<*=this.objid*>,-1);return false;\"><*=_Prtg.Lang.sensorTree.strings.AddGroup*></a></span><* }} *></library></div></div>",
"_prtg.core.probe.js":"<div class=\"treeItem cell-inner groupItem <*=this._classes.join(' ')*>\" idx=\"<*=this._idx*>\" level=\"<*=this._level*>\" objid=\"<*=this.objid*>\" type=\"<*=this.basetype.toLowerCase()*>\" path=\"<*=this._id*>\"><*var level, chain = this._siblings.chain()  , offLine = (this.condition !== _Prtg.Lang.sensorTree.strings.Connected)  , message = this.message  , regexName=/\"/g;for(var k=1; k < this._level; ++k){level = chain.shift() <= this._idx;*><level last=\"<*=level*>\"></level><*}level = chain.shift();*><level lastX=\"<*=level<= this._idx*>\"><level class=\"probe\"><toggler></toggler></level></level><div class=\"indent level<*=this._level*>\"><*if(/unapproved/.test(this.info) === false){*><level class=\"probe\" last=\"<*=this._children.length===0*>\"><icon <*=(this._access >= 100) ? 'popup=\"333\"' : ''*> style=\"background-image:url(<*= this.icon.replace('.png', (!!offLine ? 'offline.png?svg' :'.png?svg'))*>)\"></icon></level><probe title=\"<*=!!this._collapsed?_Prtg.Lang.sensorTree.strings.GroupsAndDeviceCount.printf(this).replace(/\"/g,'&quot;'):''*>\"<*=!!offLine?' class=\"offline\"':''*>><* if(this._access >= 100) { *><name  popup=\"3333\" goto=\"<*=this.objid*>\"><*=this.name*></name><* } else {*><name><*=this.name*> </name><* } *><condition><*= offLine ? this.condition : (message !== _Prtg.Lang.common.strings.OK ? message : '') *></condition><*} else {*><level class=\"probe\" last=\"true\"><icon style=\"background-image:url(<*=this.icon*>)\"></icon></level><probe title=\"<*=!!this._collapsed?_Prtg.Lang.sensorTree.strings.GroupsAndDeviceCount.printf(this).replace(/\"/g,'&quot;'):''*>\"<*=!!offLine?' class=\"offline unapproved\"':'class=\"unapproved\"'*>><name><*=this.name*> </name><condition><*= offLine ? this.condition : (message !== _Prtg.Lang.common.strings.OK ? message : '') *></condition><* if(!this._collapsed && !_Prtg.Options.userIsReadOnly){ *><span class=\"approve\">                    <a class=\"actionbutton approvebutton\" onclick=\"_Prtg.objectTools.setProbeState.call(this,<*=this.objid*>,'allowanddiscover');return false;\"><span class=\"ui-icon ui-icon-check\"></span><*=_Prtg.Lang.sensorTree.strings.ApprovenewprobeDisco*></a><a class=\"actionbutton button btngrey\" onclick=\"_Prtg.objectTools.setProbeState.call(this,<*=this.objid*>,'allow');return false;\"><*=_Prtg.Lang.sensorTree.strings.Approvenewprobe*></a><a class=\"actionbutton button btngrey\" onclick=\"_Prtg.objectTools.setProbeState.call(this,<*=this.objid*>,'deny');return false;\"><*=_Prtg.Lang.sensorTree.strings.Denynewprobe*></a></span><*}}*></probe></div></div>",
"_prtg.core.sensor.device.collapsed.js":"<div class=\"sensorItem cell-inner c1 drop level-<*=this._level*> <*=this._classes.join(' ').trim()*>\" idx=\"<*=this._idx*>\" objid=\"<*=this.objid*>\" type=\"<*=this.basetype.toLowerCase()*>\"  path=\"<*=this._id*>\" template=\"_Prtg.Core.sensor.device.collapsed.js\"><*var self = this, librarymenu = (jQuery.inArray('librarymenu',this._classes) > -1), regexName=/\"/g;(function($,device){function printSensor(idx, objid, status, type, classes, name, title, value, favorite, access, alttype, filter){*><sensor<*=idx>-1?' idx=\"'+idx+'\"':' '*>objid=\"<*=objid*>\" type=\"<*=type*>\" <*=!alttype?'':'altType=\"'+alttype+'\"'*><*=!filter?'':'filter=\"'+filter+'\"'*>class=\"<*=classes*> status<*=status*>\"title=\"<*=title*>\"<*=!access?'':'goto=\"true\"'*>><icon <*=!access?'':'popup=\"333\"'*> ></icon><name <*=!access?'':'popup=\"3333\"'*> ><*=name*></name><value><*=value*></value><favorit><span class=\"<*=favorite*> ui-icon ui-icon-flag\" onclick=\"var e = arguments[0] || window.event; e.stopPropagation(); _Prtg.objectTools.faveObject.call(this,<*=objid*>,'toggle');return false;\"></span></favorit></sensor><*}function findSensors(kind){var sensors = [];$.each(device.leafs, function(i, sensor){if($.inArray(sensor.status, kind) !== -1)sensors.push({'idx':i,'sensor':sensor});});return sensors;}function processSensors(count, kind, key){switch(count){case -1:printSensor(-1,device.objid, kind[0],self.basetype==='library'?self.libkind:'device','noContextMenu','','','','hidden',false);break;case 0:break;case 1:var sensors = findSensors(kind);$.each(sensors, function(i,s){var sensor = s.sensor,simulated = (/simulated/.test(sensor.info) === true),paused = (jQuery.inArray(sensor.status, [7,8,9,11,12]) !== -1) || simulated,pausedbyparent = paused && (/paused/.test(sensor.info) === false),classes = [];if(!sensor.access) classes.push('noContextMenu');if(librarymenu) classes.push('librarymenu');classes.push((/fixed/.test(sensor.info) === true ? 'dragable fixed' : 'dragable'));classes.push((jQuery.inArray(sensor.status, [5,13,14]) > -1?'sensorred':''));classes.push((paused ? (pausedbyparent && !simulated ? 'ispausedbyparent' : 'ispaused') : 'isnotpaused'));classes.push((sensor.favorite ?'isfavorite':'isnotfavorite'));printSensor(s.idx,sensor.objid, kind[0],'sensor',classes.join(' ').trim(),sensor.name,'',sensor.lastvalue,('object' +(sensor.favorite ?'isfavorite':'isnotfavorite icon-gray')),sensor.access);});break;default:printSensor(-1,device.objid, kind[0],self.basetype==='library'?self.libkind:'device','noContextMenu',Math.abs(count) + ' '+ _Prtg.Lang.sensorTree.strings.ColumnHeaderSensors,'','','hidden',true,self.basetype==='library' && self.libkind==='filter'?self.libkind:'sensors','&filter_status='+kind.slice(0).sort().join('&filter_status='));break;}}var leafsloaded = device.leafs && device.leafs.length === device.totalsens ? 1 : -1;$.each(_Prtg.Core.objects.sensor.sensorTypesValuesCollapsed, function(key,val){var sum=0;if($.isPlainObject(val)){$.each(val, function(k,v){sum += device[k+'sens']; });}else{sum = device[key+'sens'];}if($.isPlainObject(val)){if(sum > 0){if(sum <=  _Prtg.Core.objects.sensor.collapseSensorsCount[key]){if(leafsloaded === -1){for(var l=0,m=sum; l < m; ++l)processSensors(leafsloaded, val['down']);}else{$.each(val, function(k,v){device[k+'sens'] > 0 && processSensors(1, v);});}}else{$.each(val,function(k,v){processSensors(leafsloaded * device[k+'sens'],v);});}}}else{processSensors(leafsloaded*sum, val);}});})(jQuery, this);*></div>",
"_prtg.core.sensor.group.collapsed.js":"<div class=\"sensorItem cell-inner c1 level-<*=this._level*> <*=this._classes.join(' ').trim()*>\" idx=\"<*=this._idx*>\" objid=\"<*=this.objid*>\" type=\"<*=this.basetype.toLowerCase()*>\"  path=\"<*=this._id*>\" template=\"_Prtg.Core.sensor.group.collapsed.js\"><*(function($,group){function printSensor(idx, objid, status, type, classes, name, title, value, favorite, access, alttype, filter){*><sensor<*=idx>-1?' idx=\"'+idx+'\"':' '*>objid=\"<*=objid*>\"type=\"<*=type*>\"<*=!alttype?'':'altType=\"'+alttype+'\"'*><*=!filter?'':'filter=\"'+filter+'\"'*>class=\"<*=classes*> status<*=status*>\"title=\"<*=title*>\"<*=!access?'':'goto=\"true\"'*>><icon <*=!access?'':'popup=\"333\"'*> ></icon><name <*=!access?'':'popup=\"3333\"'*> ><*=name*></name><value><*=value*></value><favorit><span class=\"<*=favorite*> ui-icon ui-icon-flag\" onclick=\"var e = arguments[0] || window.event; e.stopPropagation(); _Prtg.objectTools.faveObject.call(this,<*=objid*>,'toggle');return false;\"></span></favorit></sensor><*}if(!!group.basetype && group.basetype !== 'library' && group.groupnum === 0 && group.devicenum === 0){if(/unapproved/.test(group.info) === false){*><span><a class=\"treeminilink actionbutton\" onclick=\"_Prtg.objectTools.addObject(<*=group.objid*>,'device');return false;\" href=\"#\"><*=_Prtg.Lang.sensorTree.strings.AddDevice*></a></span><*} else if(!_Prtg.Options.userIsReadOnly) {*><span class=\"approve\" style=\"margin-left:3px;margin-top:-4px;\">                    <a class=\"actionbutton approvebutton\" onclick=\"_Prtg.objectTools.setProbeState.call(this,<*=group.objid*>,'allowanddiscover');return false;\"><span class=\"ui-icon ui-icon-check\"></span><*=_Prtg.Lang.sensorTree.strings.ApprovenewprobeDisco*></a>                    <a class=\"actionbutton button btngrey\" onclick=\"_Prtg.objectTools.setProbeState.call(this,<*=group.objid*>,'allow');return false;\"><span class=\"ui-icon ui-icon-check\"></span><*=_Prtg.Lang.sensorTree.strings.Approvenewprobe*></a><a class=\"actionbutton button btngrey\" onclick=\"_Prtg.objectTools.setProbeState.call(this,<*=group.objid*>,'deny');return false;\"><span class=\"ui-icon ui-icon-closethick\"></span><*=_Prtg.Lang.sensorTree.strings.Denynewprobe*></a></span><*}}else{var librarymenu = ($.inArray('librarymenu',group._classes) > -1)        , objid = (!!group.liblinkedid ? group.libkind === 'filter' ? group.objid : group.liblinkedid : group.objid)        , errors = group._loaderrors;$.each({'downs':{'downsens':[5],'partialdownsens':[14],'downacksens':[13]},'warnsens':[4],'pausedsens':[7,8,9,11,12],'upsens':[3,2],'unusualsens':[10],'undefinedsens':[1,6,0]}, function(key,val){var sum=0,printed=0;if($.isPlainObject(val)){$.each(val, function(k,v){sum += group[k];});}else{sum = group[key];}if($.isPlainObject(val)){if(sum > 0){if(group.basetype != \"library\" && !!_Prtg.Events && sum <= _Prtg.Core.objects.sensor.collapseSensorsCount[key]){$.each(val, function(k,v){for(var l=0, m=group[k]; l<m && printed<sum; ++printed, ++l){      if(!!group.errors && group.errors.length){var sensor = group.errors[printed],simulated = (/simulated/.test(sensor.info) === true),paused = (jQuery.inArray(sensor.status, [7,8,9,11,12]) !== -1) || simulated,pausedbyparent = paused && (/paused/.test(sensor.info) === false),classes = ['group'];if(!sensor.access) classes.push('noContextMenu');if(librarymenu) classes.push('librarymenu');classes.push((/fixed/.test(sensor.info) === true ? 'dragable fixed' : 'dragable'));classes.push((jQuery.inArray(sensor.status, [5,13,14]) > -1?'sensorred':''));classes.push((paused ? (pausedbyparent && !simulated ? 'ispausedbyparent' : 'ispaused') : 'isnotpaused'));classes.push((sensor.favorite ?'isfavorite':'isnotfavorite'));printSensor(printed,sensor.objid,sensor.status,'sensor',classes.join(' ').trim(),sensor.name.replace(/\"/,'&quot;'),'',sensor.lastvalue,('object' +(sensor.favorite ?'isfavorite':'isnotfavorite icon-gray')),sensor.access);      }else{*><sensor objid=\"<*=objid*>\" class=\"replace<*=group.objid*> group status<*=v[0]*>\" title=\"\"><icon></icon><name></name><value></value></sensor><*}}});}else{$.each(val,function(k,v){if(group[k] > 0){*><sensor objid=\"<*=objid*>\" class=\"group status<*=v[0]*>\" type=\"<*=group.basetype==='library' && group.libkind==='filter'?'filter':'sensors'*>\" filter=\"&filter_status=<*=v.join('&filter_status=')*>\" goto=\"true\" title=\"\"><icon popup=\"333\"></icon><name popup=\"3333\"><*=group[k] + ' ' +_Prtg.Lang.sensorTree.strings.ColumnHeaderSensors*></name><value></value></sensor><*}});}}}else if(sum>0){*><sensor objid=\"<*=objid*>\" class=\"group status<*=val[0]*>\" type=\"<*=group.basetype==='library' && group.libkind==='filter'?'filter':'sensors'*>\" filter=\"&filter_status=<*=val.join('&filter_status=')*>\" goto=\"true\" title=\"\"><icon popup=\"333\"></icon><name popup=\"3333\"><*=sum + ' ' +_Prtg.Lang.sensorTree.strings.ColumnHeaderSensors*></name><value></value></sensor><*    }    });      if(!!errors && !!_Prtg.Events){      (function(group, librarymenu, objid, errors){      _Prtg.Events.subscribeOnce('leafs.refreshed.prtg', function(e,res){      _Prtg.ObjectTree.printErrors(group, res, objid, errors, librarymenu);});})(group, librarymenu, objid, errors);}}})(jQuery, this);*></div>",
"_prtg.core.sensor.js":"<*var librarymenu = (this._classes.indexOf('librarymenu') > -1), simulatedRegex = /simulated/, disconnectedRegex = /disconnected/, pausedRegex = /paused/, fixedRegex = /fixed/, fixName = /\"/g, smallprobe = (this._classes.indexOf('smallprobe') > -1);*><div class=\"sensorItem cell-inner c1 drop level-<*=this._level*> <*=this._classes.join(' ').trim()*>\" idx=\"<*=this._idx*>\" objid=\"<*=this.objid*>\" type=\"<*=this.basetype.toLowerCase()*>\" path=\"<*=this._id*>\" template=\"_Prtg.Core.sensor.js\"><div><*if(!!this.leafs && this.leafs.length > 0){for(var x=0,l=this.leafs.length; x < l; ++x){var sensor = this.leafs[x],simulated = (simulatedRegex.test(sensor.info) === true),paused = (jQuery.inArray(sensor.status, [7,8,9,11,12]) !== -1) || simulated,pausedbyparent = paused && (pausedRegex.test(sensor.info) === false),classes = [];if(!sensor.access) classes.push('noContextMenu');if(librarymenu) classes.push('librarymenu');if(smallprobe) classes.push('smallprobe');if(jQuery.inArray(\"clusterprobedevice\", this._classes ) != -1) classes.push(\"clusterprobedevice\");classes.push((fixedRegex.test(sensor.info) === true ? 'dragable fixed' : 'dragable'));classes.push((jQuery.inArray(sensor.status, [5,13,14]) > -1?'sensorred':''));classes.push((paused ? (pausedbyparent && !simulated ? 'ispausedbyparent' : 'ispaused') : 'isnotpaused'));classes.push((sensor.favorite ? 'isfavorite':'isnotfavorite'));*><sensor idx=\"<*=x*>\"objid=\"<*=sensor.objid*>\" type=\"sensor\" class=\"sensor <*=classes.join(' ').trim()*> status<*=sensor.status*>\" title=\"<*=(''+sensor.name).replace(fixName,'&quot;')+' (' + (sensor.lastvalue === '-' ? '?' : sensor.lastvalue) +')'*>\"><icon <*=sensor.access ? 'popup=\"333\"' : ''*> goto=\"true\"></icon><name <*=sensor.access ? 'popup=\"3333\"' : ''*> goto=\"true\"><*=sensor.name*></name><value goto=\"true\"><*=sensor.lastvalue==='-'?'':sensor.lastvalue*></value><favorit><span class=\"objectis<*=sensor.favorite?'':'not'*>favorite <*=sensor.favorite?'':'icon-gray'*> ui-icon ui-icon-flag\" onclick=\"_Prtg.objectTools.faveObject.call(this,<*=sensor.objid*>,'toggle');return false;\"></span></favorit></sensor><*} *>  <* if(parseInt(this.objid) !== 41) { *><sensor class=\"sensor addSensorButton hideforreadonly\" title=\"<*=_Prtg.Lang.sensorTree.strings.AddSensor*>\" <* if(jQuery.inArray('isautonomous', this._classes) !== -1) { *>style=\"display:none\"<* } *>>            <a href=\"/addsensor.htm?id=<*=this.objid*>\"><icon></icon><name class=\"text\"><*=_Prtg.Lang.sensorTree.strings.AddSensor*></span>          </a></sensor>    <* }}else{var device = this;$.each(_Prtg.Core.objects.sensor.sensorTypesValues, function(key,kind){for(var x=0,l= device._collapsed ? device[key+'sens'] >0 ? 1 : 0 : device[key+'sens']; x < l; ++x){*><sensor class='status<*=kind[0]*>'><icon></icon></sensor><*}});}*></div></div>",
"_prtg.core.treemap.device.js":"<*var status = 'none', device = this;jQuery.each(_Prtg.Core.objects.group.sensorTypes, function (i,key) {if (device[key + 'sens'] > 0) {status = key;return false;}});*><div <*=(this._access >= 100) ? 'goto=\"true\"' : ''*> class=\"treeItem deviceItem cell-inner level-<*=this._level*> <*=this._classes.join(' ').trim()*>\"idx=\"<*=this._idx*>\"  objid=\"<*=this.objid*>\" type=\"<*=this.basetype.toLowerCase()*>\" path=\"<*=this._id*>\"><device  status=\"<*=status*>\"><icon <*=(this._access >= 100) ? 'popup=\"1000\" goto=\"true\"' : ''*> style=\"background-image:url(<*=_Prtg.Core.objects.icons.icon(this)*>)\"></icon><name  title=\"<*=this.name*>\" <*=(this._access >= 100) ? 'popup=\"1000\" goto=\"true\"' : ''*>><*=this.name*></name><favorit title=\"<*=this.name*>\"><*=this.favorite*></favorit></device></div>",
"_prtg.core.treemap.group.js":"<*var status = this.downsens + this.partialdownsens > 0? 'error': this.downacksens + this.warnsens > 0? 'warn': 'ok';*><div class=\"treeItem cell-inner groupItem <*=this._classes.join(' ')*>\" title=\"<*=this.name*>\" idx=\"<*=this._idx*>\" level=\"<*=this._level*>\" objid=\"<*=this.objid*>\" type=\"<*=this.basetype.toLowerCase()*>\" path=\"<*=this._id*>\"><group class=\"<*=status*>\"><icon style=\"background-image:url(<*=this.icon!==''?this.icon:_Prtg.Core.objects.icons.defaults[this.basetype.toLowerCase()]*>)\"></icon><name <*=(this._access >= 100) ? 'popup=\"3333\" goto=\"true\"' : ''*>><*=this.name*></name></group></div>",
"_prtg.core._default.js":"<div class=\"defaultItem cell-inner\" style=\"margin-left:<*=this._level*2*>ex\" idx=\"<*=this._idx*>\" objid=\"<*=this.objid*>\"><div class=\"cell-main\"><node><*=this.name*></node></div></div>",
"_prtg.device.gauge.js":"<*var info = this.info.data[0];var pinclass = this.primary ? 'icon-pin-s' : 'icon-pin-w setprimarychannel';*><div class=\"margin\"><div class=\"achannel<*=this.primary*> status<*=info.status*> sensormenu\" contextmenu data-id=\"<*=this.objid*>\" id=\"channelbox<*=info.id*>\" title=\"<*=info.name.replace(/\"/g, \"&quot;\")+this.channelidtxt.replace(/\"/g, \"&quot;\")+this.minimumtxt+this.maximumtxt*>\">  <a href=\"/sensor.htm?id=<*=this.objid*>\"><span class=\"channelname\"><*=this.sensor*></span><span class=\"channelsubname\"><*=info.name*></span><span class='channelmessage'><*=this.message*></span><span class=\"channelgauge\" id=\"channelgauge<*=info.id*>\"></span><span class=\"channelvalue\"><*=info.lastvalue||this.lastvalue*></span><div class='sensoricon'></div>  </a></div></div>",
"_prtg.flowmessagetable.js":"<* if(!this.preview) { *>  <thead class=\"pagenavigation\">    <tr>      <th colspan=\"<*= this.header.names.length + 1 *>\">        <div class=\"buttons\"><ul class=\"jd_menu\"><li><span class=\"icon ui-icon ui-icon-carat-1-s\"></span><span>Select Range</span><ul class=\"table_daterange_selector\"><li><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;start&quot;,&quot;value&quot;:&quot;0&quot;},{&quot;name&quot;:&quot;filter_dstart&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_dend&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_drel&quot;,&quot;value&quot;:&quot;today&quot;}]\">Today</a></li> <li><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;start&quot;,&quot;value&quot;:&quot;0&quot;},{&quot;name&quot;:&quot;filter_dstart&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_dend&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_drel&quot;,&quot;value&quot;:&quot;yesterday&quot;}]\">Yesterday</a></li> <li><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;start&quot;,&quot;value&quot;:&quot;0&quot;},{&quot;name&quot;:&quot;filter_dstart&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_dend&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_drel&quot;,&quot;value&quot;:&quot;7days&quot;}]\">7 days</a></li> <li><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;start&quot;,&quot;value&quot;:&quot;0&quot;},{&quot;name&quot;:&quot;filter_dstart&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_dend&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_drel&quot;,&quot;value&quot;:&quot;30days&quot;}]\">30 days</a></li> <li><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;start&quot;,&quot;value&quot;:&quot;0&quot;},{&quot;name&quot;:&quot;filter_dstart&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_dend&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_drel&quot;,&quot;value&quot;:&quot;6months&quot;}]\">6 months</a></li> <li><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;start&quot;,&quot;value&quot;:&quot;0&quot;},{&quot;name&quot;:&quot;filter_dstart&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_dend&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_drel&quot;,&quot;value&quot;:&quot;12months&quot;}]\">12 Months</a></li> <li><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;start&quot;,&quot;value&quot;:&quot;0&quot;},{&quot;name&quot;:&quot;filter_dstart&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_dend&quot;,&quot;value&quot;:&quot;&quot;},{&quot;name&quot;:&quot;filter_drel&quot;,&quot;value&quot;:&quot;eternity&quot;}]\">Unlimited</a></li> </ul></li></ul>        </div>        <div class=\"buttons\">          <span data-format=\"dd/mm/yyyy\" class=\"table_datepicker_fromtodate\">            <label>Date Range:</label>            <input type=\"text\" name=\"datepicker_dstart\" class=\"table_datepicker_dstart prtg-plugin\" data-plugin=\"prtg-datetimepicker\" data-timepicker=\"true\" value=\"2015-02-07-11-13-00\">            - <input type=\"text\" name=\"datepicker_dend\" class=\"table_datepicker_dend  prtg-plugin\" data-plugin=\"prtg-datetimepicker\" data-timepicker=\"true\" value=\"2015-05-18-11-13-00\">          </span>        </div>        <a href=\"#\" class=\"reloadtablelink disabled arrow a_first_off \"></a>        <a href=\"#\" class=\"reloadtablelink disabled arrow a_left_off \"></a>        <span class=\"table_fromcount\">0</span> to        <span class=\"table_tocount\">50</span>        <a href=\"#\" class=\"reloadtablelink arrow a_right_on \" data-reload=\"[{&quot;name&quot;:&quot;start&quot;,&quot;value&quot;:&quot;0&quot;}]\"></a>        <span class=\"loading_indicator\">Loading</span>        <span class=\"percent_loading\">0%</span>        <span class=\"table_itemcount_selector\">          Items: <a href=\"#\" class=\"reloadtablelink selected\" data-reload=\"[{&quot;name&quot;:&quot;count&quot;,&quot;value&quot;:&quot;50&quot;}]\">50</a>          <a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;count&quot;,&quot;value&quot;:&quot;100&quot;}]\">100</a>          <a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;count&quot;,&quot;value&quot;:&quot;500&quot;}]\">500</a>          <a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;count&quot;,&quot;value&quot;:&quot;1000&quot;}]\">1000</a>        </span>      </th>    </tr>  </thead>  <* } *>  <thead class=\"headersnolink\">    <tr>      <* for(d=0;d<this.header.names.length;d++) { *>      <th><*=this.header.displaynames[d]*></th>       <* if(this.preview && d==this.previewconf.rows) { break; }*>      <* } *>    </tr>  </thead><tbody class=\"data\"><* for(d=0;d<this.data.length;d++) { *>  <tr class=\"even\">    <* for(i=0;i<this.header.names.length;i++) { *>    <td class=\"col-<*=this.header.names[i]*>\"><*=this.data[d][i]*></td>      <* if(this.preview && i==this.previewconf.rows) { break; }*>    <* } *>  </tr>  <* if(this.preview && d==this.previewconf.columns) { break; }*><* } *></tbody><* if(!this.preview) { *>  <tfoot class=\"pagenavigation\"><tr><th colspan=\"<*= this.header.names.length + 1 *>\"><a href=\"#\" class=\"reloadtablelink disabled arrow a_first_off \"></a> <a href=\"#\" class=\"reloadtablelink disabled arrow a_left_off \"></a> <span class=\"table_fromcount\">0</span> to <span class=\"table_tocount\">50</span><a href=\"#\" class=\"reloadtablelink arrow a_right_on \" data-reload=\"[{&quot;name&quot;:&quot;start&quot;,&quot;value&quot;:&quot;0&quot;}]\"></a> <span class=\"loading_indicator\">Loading</span> <span class=\"percent_loading\">0%</span><span class=\"table_itemcount_selector\">Items: <a href=\"#\" class=\"reloadtablelink selected\" data-reload=\"[{&quot;name&quot;:&quot;count&quot;,&quot;value&quot;:&quot;50&quot;}]\">50</a><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;count&quot;,&quot;value&quot;:&quot;100&quot;}]\">100</a><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;count&quot;,&quot;value&quot;:&quot;500&quot;}]\">500</a><a href=\"#\" class=\"reloadtablelink \" data-reload=\"[{&quot;name&quot;:&quot;count&quot;,&quot;value&quot;:&quot;1000&quot;}]\">1000</a></span>  </th></tr></tfoot><* } *>  </table></form>",
"_prtg.flowmessagetableheader.js":"<colgroup>      <* for(d=0;d<this.header.names.length;d++) { *>        <col class=\"col-<*=this.header.names[d]*>\">      <* } *>      </colgroup>      <thead class=\"headersnolink\">        <tr class=\"udpfilterheader\">        <th colspan=\"2\"></th>        <* for(d=0;d<this.header.names.length;d++) { *>          <* if((this.header.names[d] == 'FromDate') || (this.header.names[d] == 'ToDate')) { *>            continue;          <* } else { *>          <th><*=this.header.displaynames[d]*></th>          <* } *>        <* } *>        </tr>        <tr class=\"udpadvancedfilterheader\">          <th colspan=\"<*= this.header.names.length + 1 *>\">Advanced Filter</th>        </tr>      </thead>      <tbody>        <tr class=\"filters\">          <* for(d=0;d<this.header.names.length;d++) { *>            <* if(this.header.names[d] == 'FromDate') { *>              <td class=\"filterinput\" filtertype=\"\">                <span class=\"udpmessages-morefilter\" title=\"\" data-original-title=\"Click for advanced filter settings\">Filter<i class=\"icon-gray icon-hovertodark ui-icon ui-icon-gear\"></i></span>              </td>            <* } else if(this.header.names[d] == 'ToDate') { *>               <td class=\"filterinput\" filtertype=\"\"></td>            <* } else { *>              <td class=\"filterinput\" filtertype=\"<*=this.header.names[d]*>\" data-original-title=\"\">                <input class=\"udpmessages-filter-<*=this.header.names[d]*> udpmessages-filterfield\" filtername=\"<*=this.header.names[d]*>\" id=\"udpmessages-filter-<*=this.header.names[d]*>\">              </td>            <* } *>          <* } *>        </tr>        <tr class=\"advancedfilterinputrow\" style=\"display: none;\"><td colspan=\"<*= this.header.names.length + 1 *>\" class=\"advancedfilterinputcolumn\"><i class=\"icon-dark float-right icon-close icon-hovertored\"></i></td></tr>      </tbody>",
"_prtg.objectselector.objects.js":"<div  title=\"<*=this.mytitle.trim()*>\"><input id=\"radio<*=this.objid*>\" <* if(this.disabled) { *>disabled=\"disabled\"<* } *>type=\"radio\" name=\"<*=this.parametername*>\" value=\"<*=this.objid*>\" class=\"hidden\"><label class=\"withicon sens<*=['x','x','g','g','y','r','x','b','b','b','p','b','b','o','q'][this.status]*>\"  style=\"<*=this.mystyle*>\" for=\"radio<*=this.objid*>\"><span class=\"type\">(<*=this.type*>)</span><span class=\"name\"><*=this.name*></span></label></div>",
"_prtg.reports.channellistitem.js":"<div class=\"channelItem ui-widget-content\"status=\"<*=this.status*>\" objid=\"<*=this.objid*>\"data-node-idx=\"<*=j*>\"  data-report-node-id='<*=this.reportminussensor*>'data-basetype='<*=this.basetype*>'data-objid='<*=this.objid*>'><div class=\"container\"><div class=\"col1\">  <*=this.name*><*=this.probegroupdevice*></div><div class=\"col2\"><*var id='', checked='',channel=null;for(var ii=0, l=this.reportconfigchannels.length; ii < l; ++ii){channel = this.reportconfigchannels[ii];if(typeof(channel) === 'object'){id = this.reportminussensor+'-'+channel.channelid+'-'+ii;checked = channel.selected ? ' checked=\"checked\" ' : '';*><div class=\"checkbox-control\" title=\"<*=channel.name*>\"><input type=\"checkbox\" <*=checked*> class=\"checkbox hidden\" id=\"<*=id*>\"data-channel-id =\"<*=channel.channelid*>\"data-report-node-id =\"<*=this.reportminussensor*>\"><label for=\"<*=id*>\" class=\"checkbox-control-label\"><i class=\"icon-dark prtg-checkbox\"></i><*=channel.name*></label></div><*}else{*><*=channel*><* }} *></div></div><div class=\"actions\"><span class=\"reorder\" title=\"<*=_Prtg.Lang.reportchannels.strings.reorder*>\"><i class=\"icon-white icon-shuffle\"/></span><span class=\"deleteItem prtg-icon icon-dark icon-trash\" title=\"<*=_Prtg.Lang.common.strings.delete*>\"></span>    </div></div>",
"_prtg.sensortree.buttons.js":"<div id=\"sensortreelinks\"><p class=\"\"><a class=\"actionbutton ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\" href=\"/help/add_remote_probe.htm\" target=\"_blank\" role=\"button\"><span class=\"ui-button-text\"><span class=\"ui-icon ui-icon-circle-plus\"></span><*=_Prtg.Lang.sensorTree.strings.AddRemoteProbe*></span></a><a class=\"actionbutton ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\" href=\"/addgroup0.htm?preselect=0\" role=\"button\"><span class=\"ui-button-text\"><span class=\"ui-icon ui-icon-circle-plus\"></span><*=_Prtg.Lang.sensorTree.strings.AddGroup*></span></a><a class=\"actionbutton ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\" href=\"/addautodiscovery0.htm?preselect=0\" role=\"button\"><span class=\"ui-button-text\"><span class=\"ui-icon ui-icon-circle-plus\"></span><*=_Prtg.Lang.sensorTree.strings.AddAutodiscoveryGroup*></span></a><a class=\"actionbutton ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\" href=\"/adddevice0.htm?preselect=0\" role=\"button\"><span class=\"ui-button-text\"><span class=\"ui-icon ui-icon-circle-plus\"></span><*=_Prtg.Lang.sensorTree.strings.AddDevice*></span></a><a class=\"actionbutton ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover\" href=\"/addsensor0.htm\" role=\"button\"><span class=\"ui-button-text\"><span class=\"ui-icon ui-icon-circle-plus\"></span><*=_Prtg.Lang.sensorTree.strings.AddSensor*></span></a></p></div>",
"_prtg.sensortree.buttons.sunburst.js":"<div class=\"sunburst controls\"><input type=\"checkbox\" name=\"sunburstSizeSensors\" class=\"hidden\" id=\"sunburstSizeSensors\"<*= (this.sizeSensors ? ' checked=\"checked\"' : '')*> ><label for=\"sunburstSizeSensors\" class=\"bold-text\"><i class=\"icon-gray prtg-checkbox light\"></i><*= _Prtg.Lang.sensorTree.strings.SizeBySensors*></label><input type=\"checkbox\" name=\"sunburstSizePriority\" class=\"hidden\" id=\"sunburstSizePriority\"<*= (this.sizePriority ? ' checked=\"checked\"' : '')*> ><label for=\"sunburstSizePriority\" class=\"bold-text\"><i class=\"icon-gray prtg-checkbox light\"></i><*= _Prtg.Lang.sensorTree.strings.SizeByPriority*></label></div>",
"_prtg.sensortree.buttons.treemap.js":"<div class=\"treemap controls\"><input type=\"checkbox\" name=\"treemapSizeSensors\" class=\"hidden\" id=\"treemapSizeSensors\"<*= (this.sizeSensors ? ' checked=\"checked\"' : '')*> ><label for=\"treemapSizeSensors\" class=\"bold-text\"><i class=\"icon-gray prtg-checkbox light\"></i><*= _Prtg.Lang.sensorTree.strings.SizeBySensors*></label><input type=\"checkbox\" name=\"treemapSizePriority\" class=\"hidden\" id=\"treemapSizePriority\"<*= (this.sizePriority ? ' checked=\"checked\"' : '')*> ><label for=\"treemapSizePriority\" class=\"bold-text\"><i class=\"icon-gray prtg-checkbox light\"></i><*= _Prtg.Lang.sensorTree.strings.SizeByPriority*></label></div>",
"_prtg.toplisttimeline.js":"<*  if(!!j && data[j-1].datetime.date !== this.datetime.date){*>    </ul><*  }  if(j===0 || data[j-1].datetime.date !== this.datetime.date){*>    <ul data-unix=<*=this.datetime.unix*>><*=this.datetime.date*><*}*><li id=\"topnumber_<*=this.datetime.topnumber*>\" query=\"<*='id='+this.datetime.objid+'&topnumber='+this.datetime.topnumber*>\"><*=this.datetime.start*> &minus; <*=this.datetime.stop*></li>",
"_prtg.trigger.stateitem.js":"<div class=\"triggeritem cell-inner\" idx=\"<*=this._idx*>\" level=\"<*=this._level*>\"><div class=\"cell-main\"><*for(var i=1; i < this._level; ++i){*><level></level><*}*><level level=\"<*=this._level*>\"><level type=\"item\"><toggler level=\"<*=this._level-1*>\" expand=\"true\"></toggler></level></level><group id=\"<*=this.objid*>\"><*=this.name*></group></div></div>"
};
				for(var tmplname in templates) {
					templates[tmplname] = $.jqotec(templates[tmplname].replace(/&apos;/g,"'").replace(/\\"/g,"'"), '*');
				}
				return templates;
			},
			compileJsTemplates: function(currentObject, propertyName) {
				var propname = propertyName || 'template';
				var obj = currentObject || this;
				var tmpl = "";

				for (var prop in obj) {
					if (typeof obj[prop] === 'object') {
						_Prtg.Helper.compileJsTemplates.call(obj[prop], obj[prop], propname);
					} else if (prop === propname ) {
						tmpl = obj[prop].toLowerCase();
						obj[propname] = prtgTemplates[tmpl];
					}
				}
			},
			___: '_Prtg.Helper' // end
		};
	}
	$.extend(true, window, { _Prtg: { Helper: Helper()} });

	function Core() {

		this.objects = {
        flowlist: {
          data: {
            template: '_Prtg.FlowMessageTable.js'
          },
          header: {
            template: '_Prtg.FlowMessageTableHeader.js'
          }
        },
				sensorTree: {
					type: 'GET',
					url: '/api/table.json',
					data: {
						count: '*',
						content: 'sensorxref',
						noraw: 1,
						subcheck: 1,
						filter_basetype: ['probe', 'group', 'device'],
						sortby: 'probegroupdevice',
						columns: 'objid,name,access=treejson,probegroupdevice=treejson,basetype,icon=treejson,favorite,fold,devicenum=textraw,groupnum=textraw,totalsens=textraw,upsens=textraw,downsens=textraw,partialdownsens=textraw,warnsens=textraw,pausedsens=textraw,unusualsens=textraw,undefinedsens=textraw,downacksens=textraw,condition,status=textraw,message=textraw,info,priority'
					},
					dataType: 'json',
					cached: false,
					traditional: true,
					levelIndentCssWidth: '19px',
					template: '_Prtg.Core.group.js',
					buttons: {
						template: '_Prtg.SensorTree.Buttons.js'
					},
					treemap: {
					 	template: '_Prtg.SensorTree.Buttons.TreeMap.js'
						//sunburst:  '_Prtg.SensorTree.Buttons.Sunburst.js'
					},
					sunburst: {
					 	template: '_Prtg.SensorTree.Buttons.Sunburst.js'
					}
				},
				libraries: {
					type: 'GET',
					url: '/api/table.json',
					data: {
						content: 'library',
						noraw: 1,
						subcheck: 1,
						filter_basetype:['@ntxt(sensor)'],
						sortby:'probegroupdevice',
						columns:'objid,name,access=treejson,probegroupdevice=treejson,basetype,icon=treejson,favorite,fold,devicenum=textraw,groupnum=textraw,totalsens=textraw,upsens=textraw,downsens=textraw,partialdownsens=textraw,warnsens=textraw,pausedsens=textraw,unusualsens=textraw,undefinedsens=textraw,downacksens=textraw,condition,status=textraw,message=textraw,info,priority,libkind,liblinkedid'
					},
					dataType: 'json'
				},
				library: {
					type: 'GET',
					url: '/api/table.json',
					data: {
						content: 'library',
						count: '*',
						noraw: 1,
						subcheck: 1,
						filter_basetype:['@ntxt(sensor)'],
						sortby:'probegroupdevice',
						columns:'objid,name,access=treejson,probegroupdevice=treejson,basetype,icon=treejson,favorite,fold,devicenum=textraw,groupnum=textraw,totalsens=textraw,upsens=textraw,downsens=textraw,partialdownsens=textraw,warnsens=textraw,pausedsens=textraw,unusualsens=textraw,undefinedsens=textraw,downacksens=textraw,condition,status=textraw,message=textraw,info,priority,libkind,liblinkedid'
					},
					dataType: 'json',
					cached: false,
					traditional: true,
					levelIndentCssWidth: '19px',
					template: '_Prtg.Core.library.js',
					treemap: {
						libObjects: { template: '_Prtg.Core.TreeMap.device.js' },
						filter: { template: '_Prtg.Core.TreeMap.device.js' },
						linked: { template: '_Prtg.Core.TreeMap.device.js' },
						node: { template: '_Prtg.Core.TreeMap.group.js' }
					}
				},
				probe: {
					template: '_Prtg.Core.probe.js',
					treemap: {
						template: '_Prtg.Core.TreeMap.group.js'
					}
				},
				group: {
					template: '_Prtg.Core.group.js',
					treemap: {
						template: '_Prtg.Core.TreeMap.group.js'
					},
					sensorTypes:['down','partialdown','downack','warn','unusual','up','paused','undefined'],
					sensorTypeNames:['down','partialdown','warn','downack','unusual','up','paused','undefined','total'],
					sensorTypesValues: {
						'down': [5],
						'downack': [13],
						'partialdown': [14],
						'warn': [4],
						'up': [3,2],
						'paused': [7, 8, 9, 11, 12],
						'unusual': [10],
						'undefined': [1,6,0],
						'total': 0
					}
				},
				device: {
					template: '_Prtg.Core.device.js',
					treemap: {
						template: '_Prtg.Core.TreeMap.device.js'
					},
					channelTemplates: {
						gauge: {
							data: {
								noraw:1,
								content:'sensors',
								sortby:'-position',
								count:'100',
								filter_priority:[4,5],
								columns:'objid,position=treejson,sensor=textraw,info=treejson,minimum,maximum,lastvalue,status=textraw,priority=raw,message=textraw'
							},
							template: '_Prtg.Device.Gauge.js'
						}
					}
				},
				sensor: {
					collapseSensorsCount: {
						downs: 10
					},
					type: 'POST',
					url: '/api/table.json',
					data: {
						count: '*',
						content: 'sensorxref',
						noraw: 1,
						filter_basetype: ['sensor'],
						sortby: 'probegroupdevice',
						columns: 'objid,name,access=treejson,probegroupdevice=treejson,status=textraw,lastvalue,favorite=treejson,info'
					},
					fullSize: false,
					dataType: 'json',
					cached: false,
					traditional: true,
					template: '_Prtg.Core.sensor.js',
					deviceCollapsed: {
						template: '_Prtg.Core.sensor.device.collapsed.js'
					},
					groupCollapsed: {
						template: '_Prtg.Core.sensor.group.collapsed.js'
					},
					channelTemplates: {
						gauge: {
							data: {
								noraw:1,
								content:'channels',
								sortby:'name',
								columns:'name=textraw,info=treejson,minimum,maximum,condition,lastvalue'
							},
							template: '_Prtg.Channel.Gauge.js'
						}
					},
					sensorTypesValues: {
						'down': [5],
						'downack': [13],
						'partialdown': [14],
						'warn': [4],
						'up': [3,2],
						'paused': [7, 8, 9, 11, 12],
						'unusual': [10],
						'undefined': [1,6,0]
					},
					sensorTypesValuesCollapsed: {
						'downs': {
							'down': [5],
							'downack': [13],
							'partialdown': [14]
						},
						'warn': [4],
						'up': [3,2],
						'paused': [7, 8, 9, 11, 12],
						'unusual': [10],
						'undefined': [1,6,0]
					}
				},
				libObjects: {
					type: 'GET',
					url: '/api/table.json',
					dataType: 'text json',
					timeout: 60000,
					data: {
						count: '*',
						content: 'libobjects',
						noraw: 1,
						subcheck: 1,
						sortby:'probegroupdevice',
						columns: 'objid,name,access=treejson,probegroupdevice=treejson,status=textraw,lastvalue,favorite=treejson,basetype,info'
					},
					cached: false,
					traditional: true
				},
				channelLisItems: {
					url: '/api/table.json',
					data: {
						tableid: 'reportchanneltable',
						content: 'reportnodes',
						noraw: 1,
						sortby: 'reportminussensor',
						columns: 'reportminussensor=treejson,objid,basetype,probegroupdevice=htmllong,name=htmllong,reportconfigchannels=treejson,status=textraw'
					},
					template: '_Prtg.Reports.ChannelListItem.js'
				},
				objectSelector: {
					template:'_Prtg.ObjectSelector.Objects.js'
				},
				toplistTimeline: {
					url: '/api/table.json',
					data: {
			      content:"topidx",
			      output:"json",
			      columns:"datetime=treejson",
			      count:"*",
			      noraw:"1" ,
			      sortby:"-datetime"
			    },
					template: "_Prtg.ToplistTimeline.js"
				},
				icons: {
					icon: function(d) {
						var ret =
							d.icon!==''
							? d.icon
							: _Prtg.Core.objects.icons.defaults[
								!d.libkind
								? (d.basetype||d.type)
								: (d.libkind.toLowerCase() +
									(!!d.leafs
							 		? d.leafs.length === 1 && d.libkind !== 'filter'
					  				? 'sensor'
					  				: 'sensors'
					 				: d.leafs===null
					 					? 'sensors'
					 					:''
					 					)
					 				)
								];
						return ret;
					},
					defaults: {
						query: '/images/ajax-loader-small.gif',
						probe: '/icons/probe.png?svg',
						probeoffline: '/icons/probeoffline.png?svg',
						group: '/icons/group.png?svg',
						device: '/icons/device.png?svg',
						node: '/icons/library.png?svg',
						nodesensors: '/icons/library.png?svg',
						linked: '/icons/libraryobject.png?svg',
						linkedsensor: '/icons/libraryobject_sensor.png?svg',
						linkedsensors: '/icons/libraryobject.png?svg',
						filter: '/images/ajax-loader-small.gif',
						filtersensor: '/icons/libraryobject_sensor.png?svg',
						filtersensors: '/icons/libraryobject_sensors.png?svg'
					}
				},
				nodeStateMap: {
					'0':  'undefined',
					'1':  'undefined',
					'2': 	'undefined',
					'3':  'up',
					'4':  'warn',
					'5':  'down',
					'6':  'undefined',
					'7':  'paused',
					'8':  'paused',
					'9':  'paused',
					'10': 'unusual',
					'11': 'paused',
					'12': 'paused',
					'13': 'downack',
					'14': 'partialdown'
				},
				nodeStates: {
					None: 0,
					Unknown: 1,
					Collecting: 2,
					Up: 3,
					Warning: 4,
					Down: 5,
					NoProbe: 6,
					PausedUser: 7,
					PausedDependency: 8,
					PausedSchedule: 9,
					Unusual: 10,
					PausedLicense: 11,
					PausedUntil: 12,
					DownAck: 13,
					PartialDown: 14
				},
				maxSensorFullSize:1,
				nameColumnWidth: 150,
				dndSensitivity: 2,
				deviceCache: 40,
				geomapMaxZoomLevel: 15,
				geomapIconSize:24,
				sunburstZoomDeviceCount:100,
				dataTableBigMode: 100,
				___: '_Prtg.Core' // end
			};
	};
	// Core.prototype.objects = function() {return this._objects};
	Core.prototype.getObject=function (oType) {
		var ob;
		if (typeof oType !== 'string') throw new Error('This is not valid object type name');
		if (this.objects[oType] !== undefined) ob = this.objects[oType];
		else ob = this.objects['_default'];
		return ob;
	};

	$.extend(true, window, { _Prtg: { Core: new Core()} });

	prtgTemplates = _Prtg.Helper.loadjstemplates();
	_Prtg.Helper.compileJsTemplates(_Prtg.Core.objects);

	$(function measureScrollbar() {
		_Prtg.scrollbarDimensions = (function measureScrollbar() {
			var $c = $("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body");
			var dim = { width: $c.width() - $c[0].clientWidth, height: $c.height() - $c[0].clientHeight };
			$c.remove();
			return dim;
		})();
	});

})(jQuery);

;
// _Prtg.Core.lang.js

_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
	common: {
		strings: {
			"OK":	'OK',
			"ZoomGraph": 'Zoom graph in new window',
			"Groups": 'Groups',
			"Other": 'Other'
		},
    roots:{
      root: {
        name: 'Root',
        basetype: 'group',
        objid: 0,
        icon: '/icons/group.png?svg'
      },
      libraries: {
        name: 'Libraries',
        basetype: 'libraries',
        objid: -6,
        icon: '/icons/library.png?svg'
      },
      maps: {
        name: 'Maps',
        basetype: 'maps',
        objid: -5,
        icon: '/icons/map.png?svg'
      },
      notifications: {
        name: 'Notification Templates',
        basetype: 'notifications',
        objid: -3,
        icon: '/css/images/Glocke_003596_14x14.png'
      },
      reports: {
        name: 'Reports',
        basetype: 'reports',
        objid: -4,
        icon: '/icons/report.png?svg'
      },
      schedules: {
        name: 'Schedules',
        basetype: 'schedules',
        objid: -7,
        icon: '/icons/schedule.png?svg'
      },
      usergroups: {
        name: 'User Groups',
        basetype: '',
        objid: -2,
        icon: '/icons/usergroup.png?svg'
      },
      users: {
        name: 'Users',
        basetype: '',
        objid: -1,
        icon: '/icons/useraccount.png?svg'
      }
    }
	}
});
;
// _Prtg.Colors.js
_Prtg.Colors = _Prtg.Colors || { ___: '_Prtg.Colors' };
$.extend(true, _Prtg.Colors, {
	lightgray: '#f3f2f2',
	mousegray: '#b7b7b7',
	midgray: '#d6d7d8',
	darkgray: '#606362',
	tabletitles: '#fff',
	tableborders: '#818285',
	tableheaders1: '#ccc',
	tableheaders2: '#c8c8c8',
	tabsdark1: '#999999',
	tabsdark2: '#555555',
	linkcolor: '#00235D',
	menucolor: '#212C52',
  tct: 'rgb(249,157,28)',
  tctinput: 'rgba(249,157,28,0.8)',

	graph1: '#d71920',
	graph2: '#5bc4bf',
	graph3: '#00245d',
	graph4: '#f173ac',
	graph5: '#78743d',
	graph6: '#d09b52',
	graph7: '#a0c9ec',
	graph8: '#d5cfa3',

	statusup: '#b4cc38',
	statusdown: '#d71920',
	statusdownack: '#e77579',
	statuspartialdown: '#d71920',
	statusunusual: '#f99d1c',
	statuswarn: '#ffcb05',
	statuswarning: '#ffcb05',
	statuspaused: '#447fc1',
	statusunknown: '#808282',
	statusundefined: '#808282',
	none: 'white'
});
;
_Prtg.Lang = _Prtg.Lang || {___: '_Prtg.Lang'};
$.extend(true, _Prtg.Lang, {
    common: {
        strings: {
            "OK": 'OK',
            "ok": 'OK',
            "yes": 'Yes',
            "no": 'No',
            "cancel": 'Cancel',
            "save": 'Save',
            "apply": 'Apply',
            "discardchanges": 'Discard Changes',
            "search": 'Search...',
            "searchtitle": 'Object Search:<br>You can search an object by its<br>ID, name or tag.',
            "noresult": 'No Result',
            "add": 'Add',
            "working": 'Working...',
            "delete": 'Delete',
            "tryagain": 'Try Again',
            "server": 'Server',
            "url": 'URL',
            "Group": 'Group',
            "Device": 'Device',
            "DropTarget": 'Drop objects here',
            "snapshotworking": 'PRTG creates a snapshot of your configuration in the folder <b>Configuration Auto-Backups</b>. Depending on the size of your PRTG installation, this may take some time.',
            "copy": 'You can now copy the content to the clipboard using CTRL-C',
            "ajaxerror": 'Ajax Error',
            "ZoomGraph": 'Zoom graph in new window',
            "Groups": 'Groups',
            "Users": 'Users',
            "Disallowed": 'Disallowed',
            "feedbacksendthank": 'Thank you, your feedback has been sent!',
            "feedbacksendthanktitle": 'Thank you, your feedback has been sent!',
            "editrequest": 'Warning! Only edit this field if the Paessler support team asks you to do so. Unauthorized use can lead to false monitoring data!',
            "channeltabtiperror1": 'Could not hide the Channel Tabs tip',
            "channeltabtiperror2": 'Channel Tabs tip is now hidden',
            "findduplicatesresult": 'Find Duplicates Result',
            "loading": 'Loading',
            "hideall": 'Hide all',
            "showall": 'Show all',
            "choose": null,
            "udpmessageprobeconn": 'Probe must be connected to display messages!',
            "unknownsensor": 'Sensor was deleted',
            "zoomin": 'Zoom in',
            "zoomout": 'Zoom out',
            "masterdependencies": 'Show Master Dependencies',
            "dependenciestitle": '{name}: showing {childrencount} sub-elements out of {childcount}',
            "highlight": 'Highlight Connection',
            "login": 'Login',
            "defaultLogin": 'Default Login',
            "help": 'Help',
            "error": 'Error',
            "advancedinfo": 'Error details',
            "newchannels": 'New Channels',
            "newpasshashsuccess": 'New passhash successfully created!',
            "newpasshashfail": 'There was an error creating the new passhash!',
            "showFilter": 'Show Filters',
            "hideFilter": 'Hide Filters',
            "settings": 'Settings',
			"selectalibraryfile": 'Please select a library file',
            "scheduleAll": {
                'OFF':'All off',
                'ON':'All on'
            },
            "buttonstate":{
                'OFF':'off',
                'ON':'on'
            }
        }
    },
    TCT: {
        "gotit": 'OK, got it!',
        "dontshowagain": 'Do not show again'
    }
});
;


(function(yesorno) {
	var dialogs = yesorno;
  var myobject = null;
	var self = {
		bindings: {
			/**************************************************/
			/** Contextmenu for sensors **/
			/**************************************************/
			"sensordetail": function (t) { _Prtg.Hjax.loadLink.call(t,"/sensor.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=1"); },
			"sensoredit": function (t) { _Prtg.objectTools.editSettingsDialog.call(t, '/multiedit.htm', {id:(t.attr('data-id')||t.attr('id')),objecttype:'sensor'}); },
			"sensorrename": function (t) { self.setWorkingClass(t); _Prtg.objectTools.quickeditObject.call(t, (t.attr('data-id')||t.attr('id')), 1).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"sensornotifications": function (t) { _Prtg.Hjax.loadLink("/sensor.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=9"); },
			"sensorgraph0": function (t) { _Prtg.Hjax.loadLink.call(t,"/sensor.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=2"); },
			"sensorgraph1": function (t) { _Prtg.Hjax.loadLink.call(t,"/sensor.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=3"); },
			"sensorgraph2": function (t) { _Prtg.Hjax.loadLink.call(t,"/sensor.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=4"); },
			"sensorgraph3": function (t) { _Prtg.Hjax.loadLink.call(t,"/sensor.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=5"); },
			"sensorclone": function (t) { _Prtg.objectTools.cloneObject.apply(t,[(t.attr('data-id')||t.attr('id')),'sensor', true]); },
			"sensoracknowledge": function (t) { },
			"sensoracknowledgenow": function (t) { self.setWorkingClass(t); _Prtg.objectTools.acknowledgeError.call(t,(t.attr('data-id')||t.attr('id')), undefined,this).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"sensoracknowledgefor5": function (t) { self.setWorkingClass(t); _Prtg.objectTools.acknowledgeError.call(t,(t.attr('data-id')||t.attr('id')), 5, this).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"sensoracknowledgefor15": function (t) { self.setWorkingClass(t); _Prtg.objectTools.acknowledgeError.call(t,(t.attr('data-id')||t.attr('id')), 15,this).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"sensoracknowledgefor60": function (t) { self.setWorkingClass(t); _Prtg.objectTools.acknowledgeError.call(t,(t.attr('data-id')||t.attr('id')), 60,this).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"sensoracknowledgefor180": function (t) { self.setWorkingClass(t); _Prtg.objectTools.acknowledgeError.call(t,(t.attr('data-id')||t.attr('id')), 180,this).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"sensoracknowledgefor1440": function (t) { self.setWorkingClass(t); _Prtg.objectTools.acknowledgeError.call(t,(t.attr('data-id')||t.attr('id')), 1440,this).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"sensoracknowledgeuntil": function (t) { self.setWorkingClass(t); _Prtg.objectTools.acknowledgeErrorUntil.call(t,(t.attr('data-id')||t.attr('id'))).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"sensorhistoric": function (t) { _Prtg.Hjax.loadLink.call(t,"/sensor.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=6"); },
			"sensorsendlinkpermail": function (t) { window.top.location.href = self.buildMailtoLink(t,"sensor"); },

			/**************************************************/
			/** Contextmenu for devices **/
			/**************************************************/
			"devicedetail": function (t) { _Prtg.Hjax.loadLink("/device.htm?id=" + (t.attr('data-id')||t.attr('id'))); },
			"deviceaddsensor": function (t) { window.top.location.href = "/addsensor.htm?id=" + (t.attr('data-id')||t.attr('id')); },
			"deviceedit": function (t) { _Prtg.objectTools.editSettingsDialog.call(t, '/multiedit.htm', {id:(t.attr('data-id')||t.attr('id')),objecttype:'device'}); },
			"devicerename": function (t) { self.setWorkingClass(t); _Prtg.objectTools.quickeditObject.call(t, (t.attr('data-id')||t.attr('id')), 2).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"recommendnow": function (t) { _Prtg.objectTools.recommendNow.apply(t, [(t.attr('data-id')||t.attr('id'))]); },
			"devicenotifications": function (t) { _Prtg.Hjax.loadLink("/device.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=8"); },
			"devicegraph1": function (t) { _Prtg.Hjax.loadLink("/device.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=2"); },
			"devicegraph2": function (t) { _Prtg.Hjax.loadLink("/device.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=3"); },
			"devicegraph3": function (t) { _Prtg.Hjax.loadLink("/device.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=4"); },
			"deviceclone": function (t) { if(dialogs) _Prtg.objectTools.cloneObject.apply(t,[(t.attr('data-id')||t.attr('id')),'device']); else  _Prtg.Hjax.loadLink("/duplicatedevice.htm?id=" + (t.attr('data-id')||t.attr('id'))); },
			"devicemove": function (t) { _Prtg.objectTools.moveObject.apply(t, [(t.attr('data-id')||t.attr('id'))]); },
			"devicerdp": function (t) { _Prtg.objectTools.windows.openRDPWindow((t.attr('data-id')||t.attr('id')), "http"); },
			"openvnc": function (t) { _Prtg.objectTools.windows.openVNCWindow((t.attr('data-id')||t.attr('id')), "http"); },
			"openssh": function (t) { _Prtg.objectTools.windows.openSSHWindow((t.attr('data-id')||t.attr('id')), "http"); },
			"opentelnet": function (t) { _Prtg.objectTools.windows.openTelnetWindow((t.attr('data-id')||t.attr('id')), "http"); },
			"openhttp": function (t) { _Prtg.objectTools.windows.openWindow((t.attr('data-id')||t.attr('id')), "http"); return false; },
			"openhttps": function (t) { _Prtg.objectTools.windows.openWindow((t.attr('data-id')||t.attr('id')), "https"); },
			"serviceurl": function (t) { _Prtg.objectTools.windows.openServiceURLWindow((t.attr('data-id')||t.attr('id'))); },
			"openftp": function (t) { _Prtg.objectTools.windows.openWindow((t.attr('data-id')||t.attr('id')), "ftp"); },
			"devicetracert": function (t) { _Prtg.objectTools.windows.traceRoute((t.attr('data-id')||t.attr('id'))); },
			"devicecreatetemplate": function (t) { _Prtg.objectTools.createTemplate.apply(t,[(t.attr('data-id')||t.attr('id'))]);},
			"devicefindduplicates": function (t) { _Prtg.objectTools.findDuplicates.apply(t,[(t.attr('data-id')||t.attr('id'))]);},
			"devicesendlinkpermail": function (t) { window.top.location.href = self.buildMailtoLink(t,"device"); },
			"deviceinstallprobe": function (t) { window.top.location.href="/deviceprobeinstall.htm?id=" + (t.attr('data-id')||t.attr('id')); },

			/**************************************************/
			/** Contextmenu for libraries  **/
			/**************************************************/
			"libdetail": function (t) { _Prtg.Hjax.loadLink("/library.htm?id=" + (t.attr('data-id')||t.attr('id'))); },
			"libaddnode": function (t) { _Prtg.objectTools.addObject.apply(t, ['new', "library",{'linkedid_': 0, 'targetid': (t.attr('data-id')||t.attr('id')||_Prtg.Util.getUrlVars()['id']), 'addid':(t.attr('data-id')||t.attr('id'))}]); },
			"libaddlib": function (t) {/*dummy*/ },
			"libedit": function (t) { _Prtg.objectTools.editSettingsDialog.call(t, '/multiedit.htm', {id:(t.attr('data-id')||t.attr('id')),objecttype:'library'}); },
			"libmanage": function (t) { _Prtg.Hjax.loadLink("/library.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=2"); },
			"librename": function (t) { self.setWorkingClass(t); _Prtg.objectTools.quickeditObject.call(t, (t.attr('data-id')||t.attr('id')), 3).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"libsendlinkpermail": function (t) { window.top.location.href = self.buildMailtoLink(t, "library"); },
			"libobjectdetail": function (t) { _Prtg.Hjax.loadLink("/libraryobject.htm?id=" + (t.attr('data-id')||t.attr('id'))); },
			"libobjectedit": function (t) { _Prtg.objectTools.editSettingsDialog.call(t, '/multiedit.htm', {id:(t.attr('data-id')||t.attr('id')),objecttype:'library'}); },
			"libdodelete": function (t) { _Prtg.objectTools.deleteObject.apply(t,[(t.attr('data-id')||t.attr('id')),!!t.closest('[callerid]').andSelf().attr('callerid')]); },

			/**************************************************/
			/** Contextmenu for Groups  **/
			/**************************************************/
			"groupdetail": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id'))); },
			"groupadddevice": function (t) { _Prtg.objectTools.addObject.apply(t, [(t.attr('data-id')||t.attr('id')), "device"]); },
			"groupaddgroup": function (t) {  _Prtg.objectTools.addObject.apply(t, [(t.attr('data-id')||t.attr('id')), "group"]); },
			"groupaddautogroup": function (t) { _Prtg.objectTools.addObject.apply(t, [(t.attr('data-id')||t.attr('id')), "autodiscovery"]); },
			"groupedit": function (t) { _Prtg.objectTools.editSettingsDialog.call(t, '/multiedit.htm', {id:(t.attr('data-id')||t.attr('id')),objecttype:'group'}); },
			"grouprename": function (t) { self.setWorkingClass(t); _Prtg.objectTools.quickeditObject.call(t, (t.attr('data-id')||t.attr('id')), 3).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"groupnotifications": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=9"); },
			"groupgraph1": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=2"); },
			"groupgraph2": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=3"); },
			"groupgraph3": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=4"); },
			"groupclone": function (t) { if(dialogs) _Prtg.objectTools.cloneObject.apply(t,[(t.attr('data-id')||t.attr('id')),'group']); else  _Prtg.Hjax.loadLink("/duplicategroup.htm?id=" + (t.attr('data-id')||t.attr('id'))); },
			"groupmove": function (t) { _Prtg.objectTools.moveObject.apply(t, [(t.attr('data-id')||t.attr('id'))]); },
			"groupmanage": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=7"); },
			"groupsendlinkpermail": function (t) { window.top.location.href = self.buildMailtoLink(t,"group"); },

			/**************************************************/
			/** Contextmenu for the root group  **/
			/**************************************************/
			"rootgroupdetail": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id'))); },
			"rootgroupedit": function (t) { _Prtg.objectTools.editSettingsDialog.call(t, '/multiedit.htm', {id:(t.attr('data-id')||t.attr('id')),objecttype:'group'}); },
			"rootgroupmanage": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=7"); },
			"rootgrouprename": function (t) { self.setWorkingClass(t); _Prtg.objectTools.quickeditObject.call(t, (t.attr('data-id')||t.attr('id')), 4).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"rootgroupnotifications": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=9"); },
			"rootgroupgraph1": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=2"); },
			"rootgroupgraph2": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=3"); },
			"rootgroupgraph3": function (t) { _Prtg.Hjax.loadLink("/group.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=4"); },
			"rootsendlinkpermail": function (t) { window.top.location.href = self.buildMailtoLink(t,"group"); },

			/**************************************************/
			/** Contextmenu for Probes  **/
			/**************************************************/
			"probedetail": function (t) { _Prtg.Hjax.loadLink("/probenode.htm?id=" + (t.attr('data-id')||t.attr('id'))); },
			"probeadddevice": function (t) { _Prtg.objectTools.addObject.apply(t, [(t.attr('data-id')||t.attr('id')), "device"]); },
			"probeaddgroup": function (t) { _Prtg.objectTools.addObject.apply(t, [(t.attr('data-id')||t.attr('id')), "group"]); },
			"probeaddautogroup": function (t) { _Prtg.objectTools.addObject.apply(t, [(t.attr('data-id')||t.attr('id')), "autodiscovery"]); },
			"probeedit": function (t) { _Prtg.objectTools.editSettingsDialog.call(t, '/multiedit.htm', {id:(t.attr('data-id')||t.attr('id')),objecttype:'probenode'}); },
			"proberename": function (t) { self.setWorkingClass(t); _Prtg.objectTools.quickeditObject.call(t, (t.attr('data-id')||t.attr('id')), 4).fail(function(){self.unsetWorkingClass(t);}); return false; },
			"probenotifications": function (t) { _Prtg.Hjax.loadLink("/probenode.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=9"); },
			"probegraph1": function (t) { _Prtg.Hjax.loadLink("/probenode.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=2"); },
			"probegraph2": function (t) { _Prtg.Hjax.loadLink("/probenode.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=3"); },
			"probegraph3": function (t) { _Prtg.Hjax.loadLink("/probenode.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=4"); },
			"probemanage": function (t) { _Prtg.Hjax.loadLink("/probenode.htm?id=" + (t.attr('data-id')||t.attr('id')) + "&tabid=7"); },
			"probesendlinkpermail": function (t) { window.top.location.href = self.buildMailtoLink(t,"probenode"); },

			/**************************************************/
			/** Contextmenu for Moving Objects  **/
			/**************************************************/
			"movetop": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setObjectPosition.apply(t, [(t.attr('data-id')||t.attr('id')), "top"]).then(function(){self.unsetWorkingClass(t);}); },
			"moveup": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setObjectPosition.apply(t, [(t.attr('data-id')||t.attr('id')), "up"]).then(function(){self.unsetWorkingClass(t);}); },
			"movedown": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setObjectPosition.apply(t, [(t.attr('data-id')||t.attr('id')), "down"]).then(function(){self.unsetWorkingClass(t);}); },
			"movebottom": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setObjectPosition.apply(t, [(t.attr('data-id')||t.attr('id')), "bottom"]).then(function(){self.unsetWorkingClass(t);}); },

			/**************************************************/
			/** other Contextmenuentries **/
			/**************************************************/
			"autodiscover": function (t) { _Prtg.objectTools.discoverObjectNow.apply(t, [(t.attr('data-id')||t.attr('id'))]); },
			"autodiscovertemplate": function (t) { _Prtg.objectTools.discoverObjectTemplate.apply(t, [(t.attr('data-id')||t.attr('id'))]); },
			"prio1": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setObjectPriority.apply(t, [(t.attr('data-id')||t.attr('id')), "1"]); },
			"prio2": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setObjectPriority.apply(t, [(t.attr('data-id')||t.attr('id')), "2"]); },
			"prio3": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setObjectPriority.apply(t, [(t.attr('data-id')||t.attr('id')), "3"]); },
			"prio4": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setObjectPriority.apply(t, [(t.attr('data-id')||t.attr('id')), "4"]); },
			"prio5": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setObjectPriority.apply(t, [(t.attr('data-id')||t.attr('id')), "5"]); },
			"instantreport": function (t) { _Prtg.Hjax.loadLink("/addreport.htm?id=new&addid=" + (t.attr('data-id')||t.attr('id'))); },
			"addfavorite": function (t) { self.setWorkingClass(t); _Prtg.objectTools.faveObject.apply(t, [(t.attr('data-id')||t.attr('id')), "1"]); },
			"removefavorite": function (t) { self.setWorkingClass(t); _Prtg.objectTools.faveObject.apply(t, [(t.attr('data-id')||t.attr('id')), "0"]); },
			"check": function (t) { self.setWorkingClass(t); _Prtg.objectTools.checkObjectNow.apply(t, [(t.attr('data-id')||t.attr('id'))]).then(function(){self.unsetWorkingClass(t);}); },
			"pause": function (t) { self.setWorkingClass(t);  _Prtg.objectTools.pauseObject.apply(t, [(t.attr('data-id')||t.attr('id')), "toggle"]).fail(function(){self.unsetWorkingClass(t);}); },
			"pausenow": function (t) { self.setWorkingClass(t);  _Prtg.objectTools.pauseObject.apply(t, [(t.attr('data-id')||t.attr('id')), "0"]).fail(function(){self.unsetWorkingClass(t);}); },
			"pausenowcomment": function (t) { self.setWorkingClass(t); _Prtg.objectTools.pauseWithComment.apply(t, [(t.attr('data-id')||t.attr('id')), 0, this]).fail(function(){self.unsetWorkingClass(t);}); },
			"resumenow": function (t) { self.setWorkingClass(t);  _Prtg.objectTools.pauseObject.apply(t, [(t.attr('data-id')||t.attr('id')), "1", this]).fail(function(){self.unsetWorkingClass(t);}); },
			"pausefor5": function (t) { self.setWorkingClass(t); _Prtg.objectTools.pauseWithComment.apply(t, [(t.attr('data-id')||t.attr('id')), 5, this]).fail(function(){self.unsetWorkingClass(t);}); },
			"pausefor15": function (t) { self.setWorkingClass(t); _Prtg.objectTools.pauseWithComment.apply(t, [(t.attr('data-id')||t.attr('id')), 15, this]).fail(function(){self.unsetWorkingClass(t);}); },
			"pausefor60": function (t) { self.setWorkingClass(t); _Prtg.objectTools.pauseWithComment.apply(t, [(t.attr('data-id')||t.attr('id')),60, this]).fail(function(){self.unsetWorkingClass(t);}); },
			"pausefor180": function (t) { self.setWorkingClass(t); _Prtg.objectTools.pauseWithComment.apply(t, [(t.attr('data-id')||t.attr('id')),180, this]).fail(function(){self.unsetWorkingClass(t);}); },
			"pausefor1440": function (t) { self.setWorkingClass(t); _Prtg.objectTools.pauseWithComment.apply(t, [(t.attr('data-id')||t.attr('id')), 1440, this]).fail(function(){self.unsetWorkingClass(t);}); },
			"pauseuntil": function (t) { self.setWorkingClass(t); _Prtg.objectTools.pauseUntil.call(t, (t.attr('data-id')||t.attr('id'))).fail(function(){ self.unsetWorkingClass(t);}); },
      		"pauseanderror": function (t) { self.setWorkingClass(t); _Prtg.objectTools.simulateObject.apply(t, [(t.attr('data-id')||t.attr('id')), "1"]); },
      		"maintenance": function (t) { self.setWorkingClass(t); _Prtg.objectTools.setMaintenanceWindow.apply(t, [(t.attr('data-id')||t.attr('id')), "1"]).fail(function(){self.unsetWorkingClass(t);}); },
			"dodelete": function (t) { _Prtg.objectTools.deleteObject.apply(t,[(t.attr('data-id')||t.attr('id')),!!t.closest('[callerid]').andSelf().attr('callerid')]);},
			"editaccessrights": function (t) { _Prtg.objectTools.editSettingsDialog.call(t, "/editrights.htm", (t.attr('data-id')||t.attr('id')));},
      		"sortsub": function (t) { self.setWorkingClass(t); _Prtg.objectTools.sortSubObjects.call(t, (t.attr('data-id')||t.attr('id'))); },
      		"newticket": function(t){_Prtg.objectTools.ticketAdd.call(t, 'new', (t.attr('data-id')||t.attr('id')));},
			/**************************************************/
			/** Contextmenu for Others**/
			/**************************************************/
			"refresh": function (t) { _Prtg.Events.publish('refresh.events.prtg'); },
			"makehomepage": function (t) { self.makeThisMyHomepage(); },
			"logout": function (t) { document.location.href = '/index.htm?logout=1'; }
		},
		menuItems: [
		// SYSTEM MENU ------------------------------------------------------------------------------------------------------------------------------------------------
			{ cls:'system menuhead', id:'', caption:'PRTG System Menu'},
			{ cls:'system', id:'refresh', ui:'glyph-spin3', caption:'Refresh'},
			{ cls:'system hideforreadonlyuser makemyhomelink', ui:'glyph-home', id:'makehomepage', caption:'Make This My Home Page'},
			{ cls:'system separator', id:'logout', ui:'glyph-power',caption:'Log Out'},
			{ cls:'system separator browsermenu', id:'' , caption:'Hold CTRL or Shift for browser menu'},
		// SENSOR MENU ------------------------------------------------------------------------------------------------------------------------------------------------
			{ cls:'sensor menuhead', id:'', caption:'Sensor Context Menu'},
			{ cls:'sensor hideforreadonlyuser', id:'check', ui:'glyph-arrows-cw', caption:'Scan Now'},
			{ cls:'sensor', id:'sensordetail',  ui:'glyph-search2', caption:'Details&hellip;'},
			{ cls:'sensor hideforreadonlyuser', id:'', ui:'glyph-edit', caption:'Edit'},
			[
				{ cls:'sensor', id:'sensoredit', ui:'glyph-wrench2', caption:'Settings&hellip;'},
				{ cls:'sensor', id:'sensornotifications', ui:'glyph-bell-alt', caption:'Notification Triggers&hellip;'},
				{ cls: 'sensor', id: 'editaccessrights', ui: 'glyph-lock2', caption: 'Access Rights&hellip;' },
				{ cls:'sensor', id:'sensorrename', ui:'glyph-doc', caption:'Rename&hellip;'}
			],
		// DEVICE MENU ------------------------------------------------------------------------------------------------------------------------------------------------
			{ cls:'device menuhead', id:'', caption:'Device Context Menu'},
			{ cls:'device hideforreadonlyuser disableifpaused disableifpausedbyparent', id:'check', ui:'glyph-arrows-cw', caption:'Scan Now'},
			{ cls:'device', id:'devicedetail', ui:'glyph-search2', caption:'Details&hellip;'},
			{ cls:'device hideforreadonlyuser', id:'', ui:'glyph-edit', caption:'Edit'},
			[
				{ cls:'device', id:'deviceedit', ui:'glyph-wrench2', caption:'Settings&hellip;'},
				{ cls: 'device', id: 'devicenotifications', ui: 'glyph-bell-alt', caption: 'Notification Triggers&hellip;' },
				{ cls: 'device disableforreadonlygroup', id: 'editaccessrights', ui: 'glyph-lock2', caption: 'Access Rights&hellip;' },
				{ cls:'device disableforreadonlygroup', id:'devicerename', ui:'glyph-doc', caption:'Rename&hellip;'}
			],
			{ cls:'device disableforreadonlygroup hideforreadonlyuser hideforclusterprobe separator', id:'deviceaddsensor', ui:'glyph-plus-circled',  caption:'Add Sensor&hellip;'},
			{ cls:'device disableforreadonlygroup hideforreadonlyuser autodiscoverable isnotautodiscoverable hideforclusterprobe hideforsmallprobe disableifpaused disableifpausedbyparent', ui:'glyph-spin6', id:'', caption:'Auto-Discovery'},
			[
				{ cls:'device hideforreadonlyuser hideforclusterprobe isnotautodiscoverable hideforsmallprobe disableifpaused disableifpausedbyparent', ui:'glyph-spin6', id:'autodiscover', caption:'Run Auto-Discovery'},
				{ cls:'device hideforreadonlyuser hideforclusterprobe isnotautodiscoverable hideforsmallprobe disableifpaused disableifpausedbyparent', ui:'glyph-spin6', id:'autodiscovertemplate', caption:'Run Auto-Discovery with Template'}
      		],
			{ cls:'device disableforreadonlygroup hideforreadonlyuser hideifisautonomous hideforclusterprobe hideforsmallprobe', id:'devicecreatetemplate', ui:'glyph-docs', caption:'Create Device Template&hellip;'},
			{ cls:'device disableforreadonlygroup hideforreadonlyuser hideifisautonomous hideforclusterprobe hideforsmallprobe hideforprobedevice hideonpodlocalprobe', id:'recommendnow', ui:'glyph-info-circled', caption:'Recommend Now'},
      		{ cls:'device hideforreadonlyuser hideforclusterprobe', id:'sortsub', ui:'glyph-sort-name-up', caption:'Sort Alphabetically'},

		// LIBRARY MENU ------------------------------------------------------------------------------------------------------------------------------------------------
			{ cls:'library menuhead', id:'', caption:'Library Context Menu'},
			{ cls:'libraryobject menuhead', id:'', caption:'Library Node Menu'},
			{ cls:'library hideinwingui', id:'libdetail',  ui:'glyph-search2', caption:'Details&hellip;'},
			{ cls:'libraryobject', id:'libobjectdetail',  ui:'glyph-search2', caption:'Details&hellip;'},
			{ cls: 'library libraryroot libraryobject hideforreadonlyuser', id: '', ui: 'glyph-edit', caption: 'Edit' },
			[
				{ cls: 'library disablefornonrootlibrary', id: 'libedit', ui: 'glyph-wrench2', caption: 'Settings&hellip;' },
				{ cls:'libraryobject', id:'libobjectedit', ui:'glyph-wrench2', caption:'Settings&hellip;'},
				{ cls: 'library disablefornonrootlibrary', id: 'libmanage', ui: 'glyph-cog2', caption: 'Management&hellip;' },
				{ cls:'library libraryobject', id:'librename', ui:'glyph-doc', caption:'Rename&hellip;'}
			],
			{ cls: 'hideforreadonlyuser library library-node separator', ui: 'glyph-trash-empty', id: 'libdodelete', caption: 'Delete&hellip;' },
			{ cls: 'library hideforreadonlyuser separator', id: 'libaddnode', ui: 'glyph-plus-circled', caption: 'Add Library Node&hellip;' },
			{ cls: 'library hideforreadonlyuser', id: 'libaddlib', ui: 'glyph-plus-circled', caption: 'Add Group&hellip;' },
		// GROUP MENU ------------------------------------------------------------------------------------------------------------------------------------------------
			{ cls:'group menuhead', id:'', caption:'Group Context Menu'},
			{ cls:'group hideforreadonlyuser disableifpaused disableifpausedbyparent', id:'check', ui:'glyph-arrows-cw', caption:'Scan Now'},
			{ cls:'group', id:'groupdetail',  ui:'glyph-search2', caption:'Details&hellip;'},
			{ cls:'group hideforreadonlyuser', id:'', ui:'glyph-edit', caption:'Edit'},
			[
				{ cls:'group', id: 'groupedit', ui:'glyph-wrench2', caption:'Settings&hellip;'},
				{ cls:'group', id: 'groupnotifications', ui: 'glyph-bell-alt', caption: 'Notification Triggers&hellip;' },
				{ cls:'group disableforreadonlygroup', id: 'editaccessrights', ui: 'glyph-lock2', caption: 'Access Rights&hellip;' },
				{ cls:'group disableforreadonlygroup', id: 'grouprename', ui:'glyph-doc', caption:'Rename&hellip;'},
				{ cls: 'group hideforreadonlyuser separator disableforlibrary', id: 'groupmanage', ui: 'glyph-cog2', caption: 'Management...' }
			],
			{ cls:'group disableforreadonlygroup hideforreadonlyuser separator', id:'groupaddgroup', ui:'glyph-plus-circled', caption:'Add Group&hellip;'},
			{ cls:'group disableforreadonlygroup hideforreadonlyuser hideforsmallprobe hideonpodlocalprobe', id:'groupaddautogroup', ui:'glyph-plus-circled', caption:'Add Auto-Discovery Group&hellip;'},
			{ cls:'group disableforreadonlygroup hideforreadonlyuser', id:'groupadddevice', ui:'glyph-plus-circled', caption:'Add Device&hellip;'},
			{ cls:'group disableforreadonlygroup autodiscoverable hideforreadonlyuser hideforsmallprobe disableifpaused disableifpausedbyparent hideonpodlocalprobe', id:'', ui:'glyph-binoculars2', caption:'Auto-Discovery'},
      		[
					{ cls:'group hideforreadonlyuser hideforsmallprobe disableifpaused disableifpausedbyparent', ui:'glyph-spin6', id:'autodiscover', caption:'Run Auto-Discovery'},
					{ cls:'group hideforreadonlyuser hideforsmallprobe disableifpaused disableifpausedbyparent', ui:'glyph-spin6', id:'autodiscovertemplate', caption:'Run Auto-Discovery with Template'}
      		],
      		{ cls:'group hideforreadonlyuser', id:'sortsub', ui:'glyph-sort-name-up', caption:'Sort Alphabetically'},

		// ROOTGROUP MENU ------------------------------------------------------------------------------------------------------------------------------------------------
			{ cls:'rootgroup menuhead', id:'', caption:'Group Context Menu'},
			{ cls:'rootgroup hideforreadonlyuser disbleifpaused disableifpausedbyparent', id:'check', ui:'glyph-arrows-cw', caption:'Scan Now'},
			{ cls:'rootgroup', id:'rootgroupdetail',  ui:'glyph-search2', caption:'Details&hellip;'},
			{ cls:'rootgroup hideforreadonlyuser', id:'', ui:'glyph-edit', caption:'Edit'},
			[
				{ cls:'rootgroup', id:'rootgroupedit', ui:'glyph-wrench2', caption:'Settings&hellip;'},
				{ cls:'rootgroup', id:'rootgroupnotifications', ui:'glyph-bell-alt', caption:'Notification Triggers&hellip;'},
				{ cls:'rootgroup disableforreadonlygroup', id: 'editaccessrights', ui: 'glyph-lock2', caption: 'Access Rights&hellip;' },
				{ cls:'rootgroup disableforreadonlygroup', id:'rootgrouprename', ui:'glyph-doc', caption:'Rename&hellip;'},
				{ cls:'rootgroup separator', id:'rootgroupmanage', ui:'glyph-cog2', caption:'Management&hellip;'}
			],
		// PROBE MENU ------------------------------------------------------------------------------------------------------------------------------------------------
			{ cls:'probe menuhead', id:'', caption:'Probe Context Menu'},
			{ cls:'probe hideforreadonlyuser disableifpausedbyparent', id:'check', ui:'glyph-arrows-cw', caption:'Scan Now'},
			{ cls:'probe', id:'probedetail',  ui:'glyph-search2', caption:'Details&hellip;'},
			{ cls:'probe hideforreadonlyuser', id:'', ui:'glyph-edit', caption:'Edit'},
			[
				{ cls:'probe', id:'probeedit', ui:'glyph-wrench2', caption:'Settings&hellip;'},
				{ cls:'group', id:'probemanage', ui:'glyph-wrench2', caption:'Management&hellip;'},
				{ cls:'probe', id: 'probenotifications', ui: 'glyph-bell-alt', caption: 'Notification Triggers&hellip;' },
				{ cls:'probe disableforreadonlygroup', id: 'editaccessrights', ui: 'glyph-lock2', caption: 'Access Rights&hellip;' },
				{ cls:'probe disableforreadonlygroup', id:'proberename', ui:'glyph-doc', caption:'Rename&hellip;'},
				{ cls:'probe hideforreadonlyuser separator disableforlibrary', id: 'probemanage', ui: 'glyph-cog2', caption: 'Management...' }
			],
			{ cls:'probe disableforreadonlygroup hideforreadonlyuser separator', id:'probeaddgroup', ui:'glyph-plus-circled', caption:'Add Group&hellip;'},
			{ cls:'probe disableforreadonlygroup hideforreadonlyuser hideforsmallprobe hideonpodlocalprobe', id:'probeaddautogroup', ui:'glyph-plus-circled', caption:'Add Auto-Discovery Group&hellip;'},
			{ cls:'probe disableforreadonlygroup hideforreadonlyuser', id:'probeadddevice', ui:'glyph-plus-circled', caption:'Add Device&hellip;'},
      		{ cls:'probe hideforreadonlyuser', id:'sortsub', ui:'glyph-sort-name-up', caption:'Sort Alphabetically'},
			{ cls:'disableforreadonlygroup hideforreadonlyuser allowackuser sensor sensorred hideforclusterprobe', id:'sensoracknowledge', ui:'glyph-ok', caption:'Acknowledge Alarm...'},
			[
				{ cls: 'sensor rootgroup device group probe hideforreadonlyuser allowackuser', id: 'sensoracknowledgenow', ui: 'glyph-ok', caption: 'Acknowledge Indefinitely&hellip;' },
				{ cls: 'sensor rootgroup hideforreadonlyuser allowackuser device group probe separator', id: 'sensoracknowledgefor5', ui:'glyph-clock', caption: 'For 5 Minutes&hellip;' },
				{ cls: 'sensor rootgroup hideforreadonlyuser allowackuser device group probe', id: 'sensoracknowledgefor15', ui:'glyph-clock', caption: 'For 15 Minutes&hellip;' },
				{ cls: 'sensor rootgroup hideforreadonlyuser allowackuser device group probe', id: 'sensoracknowledgefor60', ui:'glyph-clock', caption: 'For 1 Hour&hellip;' },
				{ cls: 'sensor rootgroup hideforreadonlyuser allowackuser device group probe', id: 'sensoracknowledgefor180', ui:'glyph-clock', caption: 'For 3 Hours&hellip;' },
				{ cls: 'sensor rootgroup hideforreadonlyuser allowackuser device group probe', id: 'sensoracknowledgefor1440', ui:'glyph-clock', caption: 'For 1 Day&hellip;' },
				{ cls: 'sensor rootgroup hideforreadonlyuser allowackuser device group probe', id: 'sensoracknowledgeuntil', ui:'glyph-clock', caption: 'Until&hellip;' }
			],
			{ cls:'probe hideiffixed disableforreadonlygroup hideforreadonlyuser group device sensor separator disableforlibrary', ui: 'glyph-trash-empty', id: 'dodelete', caption: 'Delete&hellip;' },
			{ cls:'hideforreadonlyuser libraryobject separator', ui: 'glyph-trash-empty', id: 'libdodelete', caption: 'Delete from Library&hellip;' },
			{ cls:'device hideifisautonomous hideforreadonlyuser', id:'deviceclone', ui:'glyph-docs', caption:'Clone&hellip;'},
			{ cls:'group hideforreadonlyuser', id:'groupclone', ui:'glyph-docs', caption:'Clone&hellip;'},
			{ cls:'sensor hideiffixed hideforreadonlyuser', id:'sensorclone', ui:'glyph-docs', caption:'Clone&hellip;'},
			{ cls:'sensor disableforreadonlygroup hideforreadonlyuser device group probe libraryobject disableforlibrary hideifisautonomous', id: '', ui: 'glyph-shuffle2', caption: 'Move' },
			[
				{ cls: 'sensor hideforreadonlyuser device group probe libraryobject disableforlibrary', id: 'movetop', ui: 'glyph-move-up', caption: 'Top' },
				{ cls: 'sensor hideforreadonlyuser device group probe libraryobject disableforlibrary', id: 'moveup', ui: 'glyph-level-up', caption: 'Up' },
				{ cls: 'sensor hideforreadonlyuser device group probe libraryobject disableforlibrary', id: 'movedown', ui: 'glyph-level-down', caption: 'Down' },
				{ cls: 'sensor hideforreadonlyuser device group probe libraryobject disableforlibrary', id: 'movebottom', ui: 'glyph-move-down', caption: 'Bottom' },
				{ cls: 'group hideforreadonlyuser separator disableforlibrary', id: 'groupmove', caption: 'To Other Group&hellip;' },
				{ cls: 'device hideforreadonlyuser separator disableforlibrary', id: 'devicemove', caption: 'To Other Group&hellip;' },
				{ cls: 'group hideforreadonlyuser separator disableforlibrary', id: 'groupmanage', ui: 'glyph-cog2', caption: 'Management...' },
				{ cls: 'probe hideforreadonlyuser separator disableforlibrary', id: 'probemanage', ui: 'glyph-cog2', caption: 'Management...' }
			],
			{ cls:'sensor disableforreadonlygroup hideforreadonlyuser hideifpaused device group rootgroup probe separator', id:'', ui:'glyph-pause3', caption:'Pause'},
			[
				{ cls:'sensor rootgroup device group probe hideforreadonlyuser', data:{duration:null}, id:'pausenowcomment', ui:'glyph-pause3', caption:'Pause Indefinitely&hellip;'},
				{ cls:'sensor rootgroup hideforreadonlyuser device group probe separator', data:{duration:5}, id:'pausefor5', ui:'glyph-stopwatch', caption:'For 5 Minutes&hellip;'},
				{ cls:'sensor rootgroup hideforreadonlyuser device group probe', data:{duration:15}, id:'pausefor15', ui:'glyph-stopwatch', caption:'For 15 Minutes&hellip;'},
				{ cls:'sensor rootgroup hideforreadonlyuser device group probe', data:{duration:60}, id:'pausefor60', ui:'glyph-stopwatch', caption:'For 1 Hour&hellip;'},
				{ cls:'sensor rootgroup hideforreadonlyuser device group probe', data:{duration:180}, id:'pausefor180', ui:'glyph-stopwatch', caption:'For 3 Hours&hellip;'},
				{ cls:'sensor rootgroup hideforreadonlyuser device group probe', data:{duration:1440}, id:'pausefor1440', ui:'glyph-stopwatch', caption:'For 1 Day&hellip;'},
				{ cls:'sensor rootgroup hideforreadonlyuser device group probe', data:{duration:"?"}, id:'pauseuntil', ui:'glyph-clock', caption:'Until&hellip;'},
        		{ cls:'sensor rootgroup hideforreadonlyuser device group probe separator', id:'maintenance', ui: 'glyph-history', caption:'One-time Maintenance Window&hellip;'}
			],
			{ cls:'sensor hideforreadonlyuser disableifpaused disableifpausedbyparent disableiferror disableforsmallprobe', id:'pauseanderror', txt:'‼', caption:'Simulate Error Status'},
			{ cls:'sensor rootgroup hideforreadonlyuser hideifnotpaused hideifpausedbyparent device group probe separator', id:'resumenow', ui:'glyph-play-1', caption:'Resume'},
			{ cls: 'sensor device group probe hideforreadonlyuser hideifnotpaused hideifpaused separator disabled', id: '', ui: 'glyph-play-1', title: 'Resume a parent to resume this object!', caption: '(Paused by parent)' },
			{ cls:'device disableforreadonlygroup hideforreadonlyuser sensor separator', id:'', ui:'glyph-star-half-alt', caption:'Priority/Favorite'},
			[
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-5', id:'prio5', caption:''},
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-4', id:'prio4', caption:''},
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-3', id:'prio3', caption:''},
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-2', id:'prio2', caption:''},
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-1', id:'prio1', caption:''},
				{ cls:'device hideiffavorite hideforreadonlyuser sensor separator', id:'addfavorite', ui:'glyph-flag2', caption:'Add to Favorites'},
				{ cls:'device hideifnotfavorite hideforreadonlyuser sensor separator', id:'removefavorite', ui:'glyph-flag-empty', caption:'Remove from Favorites'}
			],
			{ cls:'disableforreadonlygroup hideforreadonlyuser group probe separator', id:'', ui:'glyph-star-half-alt', caption:'Priority'},
			[
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-5', id:'prio5', caption:''},
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-4', id:'prio4', caption:''},
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-3', id:'prio3', caption:''},
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-2', id:'prio2', caption:''},
				{ cls:'device hideforreadonlyuser group sensor probe icon-priority-1', id:'prio1', caption:''},
			],
			{ cls:'group rootgroup probe device sensor', id:'', ui:'glyph-database', caption:'Historic Data'},
			[
				{ cls:'group', id:'groupgraph1', ui:'glyph-history', caption:'Last 2 days&hellip;'},
				{ cls:'group', id:'groupgraph2', ui:'glyph-history', caption:'Last 30 days&hellip;'},
				{ cls:'group', id:'groupgraph3', ui:'glyph-history', caption:'Last 365 days&hellip;'},
				{ cls:'rootgroup', id:'rootgroupgraph1', ui:'glyph-history', caption:'2 days&hellip;'},
				{ cls:'rootgroup', id:'rootgroupgraph2', ui:'glyph-history', caption:'30 days&hellip;'},
				{ cls:'rootgroup', id:'rootgroupgraph3', ui:'glyph-history', caption:'365 days&hellip;'},
				{ cls:'probe', id:'probegraph1', ui:'glyph-history', caption:'Last 2 days&hellip;'},
				{ cls:'probe', id:'probegraph2', ui:'glyph-history', caption:'Last 30 days&hellip;'},
				{ cls:'probe', id:'probegraph3', ui:'glyph-history', caption:'Last 365 days&hellip;'},
				{ cls:'device', id:'devicegraph1', ui:'glyph-history', caption:'Last 2 days&hellip;'},
				{ cls:'device', id:'devicegraph2', ui:'glyph-history', caption:'Last 30 days&hellip;'},
				{ cls:'device', id:'devicegraph3', ui:'glyph-history', caption:'Last 365 days&hellip;'},
				{ cls:'sensor', id:'sensorgraph0', ui:'glyph-chart-area', caption:'Live Data&hellip;'},
				{ cls:'sensor', id:'sensorgraph1', ui:'glyph-history', caption:'Last 2 days&hellip;'},
				{ cls:'sensor', id:'sensorgraph2', ui:'glyph-history', caption:'Last 30 days&hellip;'},
				{ cls:'sensor', id:'sensorgraph3', ui:'glyph-history', caption:'Last 365 days&hellip;'},
                { cls:'sensor separator', id:'sensorcompare', ui:'glyph-exchange', caption:'Compare&hellip;'},
                { cls:'sensor separator', id:'sensorhistoric', ui:'glyph-database', caption:'View Historic Data&hellip;'},
				{ cls:'sensor device hideforreadonlyuser rootgroup group probe', id:'instantreport', ui:'glyph-doc', caption:'Create Report&hellip;'}
			],
			{ cls:'device disableforreadonlygroup hideforreadonlyuser hideonpodprobedevice', id:'', ui:'glyph-briefcase2', caption:'Device Tools'},
			[
				{ cls:'device hideforreadonlyuser', id:'serviceurl', ui:'glyph-link2', caption:'Go to Service URL&hellip;'},
				{ cls:'device hideforreadonlyuser separator', id:'openhttp', ui:'glyph-link-ext', caption:'New Window with HTTP&hellip;'},
				{ cls:'device hideforreadonlyuser', id:'openhttps', ui:'glyph-link-ext', caption:'New Window with HTTPS&hellip;'},
				{ cls:'device hideforreadonlyuser', id:'openftp', ui:'glyph-link-ext', caption:'New Window with FTP&hellip;'},
				{ cls:'device hideforreadonlyuser separator', id:'devicerdp', ui:'glyph-terminal2', caption:'Remote Desktop&hellip;'},
				{ cls:'device hideforreadonlyuser', id:'devicetracert', caption:'Traceroute&hellip;'},
        		{ cls:'device hidefornoneadmins hideforsmallprobe hideforremoteprobes', id:'deviceinstallprobe', caption:'Install Remote Probe&hellip;'}
			],
      		{ cls:'device hideforreadonlyuser', id:'devicefindduplicates', ui:'glyph-search2 glyph-copy', caption:'Find Duplicates&hellip;'},
			{ cls:'sensor', id:'sensorsendlinkpermail', ui:'glyph-mail5', caption:'Send Link by Email'},
			{ cls:'device', id:'devicesendlinkpermail', ui:'glyph-mail5', caption:'Send Link by Email'},
			{ cls:'group', id:'groupsendlinkpermail', ui:'glyph-mail5', caption:'Send Link by Email'},
			{ cls:'probe', id:'probesendlinkpermail', ui:'glyph-mail5', caption:'Send Link by Email'},
			{ cls:'rootgroup', id:'rootsendlinkpermail', ui:'glyph-mail5', caption:'Send Link by Email'},
			{ cls:'libraryobject library', id:'libsendlinkpermail', ui:'glyph-mail5', caption:'Send Link by Email'},
			{ cls:'rootgroup probe group device sensor hideforreadonlyuser hidefornotticketsystem', id:'newticket', ui:'glyph-ticket2', caption:'Add Ticket'}
		],
		buildMailtoLink: function buildMailtoLink(t, type) {

			return "mailto:?subject=["
				+ 'PRTG Network Monitor (DESKTOP-H9EJ7RL)'
				+ "] "
				+ 'Link to http://127.0.0.1'
				+ "/"+type+".htm?id=" + (t.attr('data-id')||t.attr('id')) + ' ' + (t.text()||'')
				+ "&body="
				+ 'Please look at this URL'
				+ ": "
				+ 'http://127.0.0.1'
				+ "/"+type+".htm?id=" + (t.attr('data-id')||t.attr('id'));
		},
		setWorkingClass: function setWorkingClass(elm) {
			var target = $(elm.attr('target') || elm[0]);
			target.addClass("working");
		},
		unsetWorkingClass: function unsetWorkingClass(elm) {
			var target = $(elm.attr('target') || elm[0]);
			target.removeClass("working");
		},
		makeThisMyHomepage: function makeThisMyHomepage() {
      $.post('/makehome?hash='+escape(window.location.hash.substr(1,100))+'&url='+escape(window.location.pathname+''+window.location.search),
       function(){
        _Prtg.Dialogs.alert(
          $('<div>'+ _Prtg.Lang.Dialogs.strings.homepageMessage+'</div>'),
          _Prtg.Lang.Dialogs.strings.homepageTitle,
          {}
        );
       });
		},
		menuCommands: {}
	};
	function installContextMenu() {
		var settings = {
			contextMenus: $(createSubMenu(self.menuItems)),
			menuStyle: {
				bindToEvent: "contextmenu"
			},
			bindings: self.bindings,
			onContextMenu: function(e) {
				if($("#ptip").is(":visible") || $('body').is('.mapshow')){
					return false;
				} else {
					_Prtg.Tip.kill();
				}
				var myresult = false;
				myobject = $(e.target);
				if (!myobject.is('[id],[data-id]')) {
					myobject = myobject.find('[id]').eq(0);
					if(myobject.length === 0 && $(e.target).closest('[contextmenu]').length > 0){
						myobject = $(e.target).closest('[contextmenu]').eq(0);
					}
				}
        		var c = myobject.attr("class");
				   myresult = /mapmarker/.test(c)===false && /(probe|probenode|group|device|sensor|library|system|rootgroup|libraryobject)menu|sensr|sensq|tabs-container/.test(c)===true;
				//special case for library menu in table
				if(myresult 
				&& myobject.is('.librarymenu')
				&& myobject.closest('#form_libtable').length > 0)
					myresult = false;
				if(!myresult) { //if no other menu should be shown, let's show the system menu, but only for specific DOM object types
					myresult = (myobject.length === 0); //user clicked into an "undefined" area
					if(!myresult) {
						myresult = myobject.is("div,td,p,h1,h2,h3,body");
					}
				}
				if($(myobject).parents("#form_devicesort").length > 0) { //no contextmenu on device/group sort page
					myresult = false;
				}
				e.target = myobject[0];
				return myresult;
			},
			onShowMenu: function(e, menu) {
				var c = null
					, cc = null;
				$('li', menu).hide();
				cc = myobject.attr("class");
				if(cc) {
					var m = /([a-z]+)menu/i;
					c = cc.replace(/systemmenu/gi, "");
					if(m.test(c)) {
						c = RegExp.lastMatch.replace(/nodemenu/, "").replace(/menu/i, "");
						if(c.length === 0 && !window.winGUI) {
							c = "system";
						}
						c.length && $("li." + c, menu).show();
						if(myobject.is(".sensormenu")) {
							if(!(myobject.hasClasses(['sensorred', 'sensr', 'sr', 'senso', 'so' ,'status5','status14'])) & !($('.sensorid' + myobject.attr("id")).hasClasses(['sensorred', 'sensr', 'sr', 'senso', 'so']))) {
								$('li.sensorred', menu).hide();
							}
						}
					} else {
						!window.winGUI && $('li.system', menu).show();
					}
				} else {
					!window.winGUI && $('li.system', menu).show();
				}

				if(!_Prtg.Options.recommender)
					$('li#recommendnow', menu).hide();
				if(_Prtg.Options.userIsReadOnly) {
					if(_Prtg.Options.allowAcknowledge) {
						$('li.hideforreadonlyuser', menu).each(function(index, element) {
							if(!$(this).hasClass('allowackuser')) {
								$(this).hide();
							}
						});
					} else {
						$('li.hideforreadonlyuser', menu).hide();
					}
				}
				if(myobject.is('.readonlycontextmenu') ) {
					$('li.disableforreadonlygroup', menu).each(function(index, element) {
						$(this).addClass("disabled");
					});
				}
				if(!_Prtg.Options.userTicketSystem)
					$('li.hidefornotticketsystem').hide();
				if(myobject.is('.fixed')
				|| (myobject.is('.devicemenu')
				&& (myobject.attr('data-id')||myobject.attr('id'))==='40')){
					$('li.hideiffixed', menu).addClass("disabled");
				}
				if(myobject.is(".ispaused")) {
					$('li.disableifpaused', menu).addClass("disabled");
					$('li.hideifpaused', menu).hide();
				}
				if(myobject.is(".isnotpaused")) {
					$('li.hideifnotpaused', menu).hide();
				}
				if(myobject.is(".menulink")) {
					$('li.hideformenulink', menu).hide();
				}
				if(myobject.is(".ispausedbyparent")) {
					$('li.disableifpausedbyparent', menu).addClass("disabled");
					$('li.hideifpausedbyparent', menu).hide();
				}
				if(myobject.is(".isfavorite")) {
					$('li.hideiffavorite', menu).hide();
				}
				if(myobject.is(".isnotfavorite")) {
					$('li.hideifnotfavorite', menu).hide();
				}
				if(myobject.is(".clusterprobedevice")) {
					$('li.hideforclusterprobe', menu).hide();
				}
				if(myobject.is(".smallprobe")) {
					$('li.hideforsmallprobe', menu).hide();
					$('li.disableforsmallprobe', menu).addClass("disabled");
        		}
				if(myobject.is(".device.fixed")) {
					$('li.hideforprobedevice', menu).hide();
					$('li.disabledforprobedevice', menu).addClass("disabled");
    		    }
				if(myobject.is(".librarymenu")) {
					$('li.disableforlibrary', menu).addClass("disabled");
				} else {
					$('li.disablefornonrootlibrary', menu).addClass("disabled");
				}
				if(myobject.is(".isnotautodiscoverable")){
					$('li.autodiscoverable').addClass("disabled");
				}
				if(myobject.is(".device.fixed")) {
					$('li.hideforprobedevice', menu).hide();
					$('li.disabledforprobedevice', menu).addClass("disabled");
				}
				if(myobject.is(".device.localprobe.pod,.devicemenu.localprobe.pod")) {
					$('li.hideonpodprobedevice', menu).hide();
				}
				if(myobject.is(".localprobe.pod")) {
					$('li.hideonpodlocalprobe', menu).hide();
				}
				if(myobject.is(".device.remoteprobe,.devicemenu.remoteprobe")) {
					$('li.hideforremoteprobes', menu).hide();
				}
				if(myobject.is(".isautonomous")){
					$('li.hideifisautonomous', menu).addClass("disabled");
				}
				return menu;
			}
		};
		_Prtg.Contextmenu.menu = $(document).contextMenu("PRTGContextMenu", settings);
		$('body').on('click', '.menuleft', function(e){
			var ee = jQuery.Event("contextmenu");
			ee.target = this;
			ee = $.extend(true,e,ee);
			_Prtg.Contextmenu.menu.trigger(ee);
		});

		function createSubMenu( items ) {
			var ul = []
				, itm
				, nxt;
			for (var i = 0, itemlen = items.length; i <itemlen; i++) {
				itm = items[i];
				nxt = items[i+1];
				if(itm.id !== 'sensorcompare'){ //filtering compare option since removing it breaks the text in EC
					if ( !(itm instanceof Array) ) {
						if ( itm.id ) self.menuCommands[itm.id] = itm;
						if ( itm.txt === undefined )
							itm.txt = "";
						else
							itm.ui = "txt";
						if( itm.data === undefined)
							itm.data = "";
						else
							itm.data = " data-params='" + JSON.stringify(itm.data) +"' ";
						if(itm.ui !== undefined && itm.ui !== "")
							itm.icon = itm.ui;
						else
							itm.icon = '';

						if ( nxt instanceof Array ) {
							itm['nxt'] = "<i class='icon-dark icon-carat-1-e'></i>";
						} else {
							itm['nxt'] = "</li>";
						}
							ul.push("\n<li id='{id}' class='{cls}'{data}><i class='{icon}'>{txt}</i>{caption}{nxt}".printf(itm));
					} else {
						ul.push(createSubMenu(itm) +"</li>");
					}
            	}
			}
			return "<ul>"+ ul.join("\n") + "</ul>";
		}
	}

	_Prtg.Contextmenu = self;
	installContextMenu();
	$.fn.extend({
		hasClasses: function (selectors) {
			var self = this;
			for (var i in selectors) {
				if ($(self).hasClass(selectors[i]))
					return true;
				}
				return false;
			}
	});
})(true);
;
/* conext help plugin */
;(function ($, window, document, undefined) {
    var regRemarks = /<span class="f_Remarks">(.*)<\/span>/gi;

    function Documentation(element, data, parent) {
        this.element = $(element);
        this.data = data;
        if (!!this.data.url)
            this.init(this);
    }

    Documentation.prototype.init = function (me) {
        if (!me.data || !me.data.url)
            return;
        setTimeout(function () {
            $.ajax({
                url: me.data.url,
                dataType: "text",
                beforeSend: function (jqXHR) {
                    jqXHR.ignoreError = true;
                }
            })
                .done(function (html) {
                    var elms = [],
                        h = [],
                        m = null;
                    while ((m = regRemarks.exec(html)) !== null) {
                        elms.push(m[1]);
                    }
                    if (elms.length) {
                        elms.forEach(function (elm) {
                            if (elm !== '&nbsp;') {
                                elm = $('<li>' + elm + '</li>');
                                elm.find("a").each(function () {
                                    var href = $(this).attr('href');
                                    if (href.indexOf('/') === -1) href = '/help/' + href;
                                    $(this)
                                        .attr('href', href)
                                        .attr('target', '_blank');
                                });
                                elm.find("img").each(function () {
                                    var src = $(this).attr('src');
                                    if (src.indexOf('/') === -1) src = '/help/' + src;
                                    $(this).attr('src', src);
                                });
                                h.push(elm);
                            }
                        });
                        if (!!h.length) {
                            me.element.append(h);
                            me.element.children().wrapAll('<ul class="manual-remarks"></ul>');
                            me.element.removeClass('hide');
                        }
                    }
                });
        }, 500);
    };

    _Prtg.Plugins.registerPlugin("documentation", Documentation);

    var pluginName = "contexthelp";

    function Plugin(element, options) {
        this.element = element;
        this.open = false;
        this.$self = $(element);
        this.$last = this.$self.find('.lasthelpitem');
        this.$container = this.$self;//.css('maxHeight',(parseInt($(window).height() * 0.5, 10)+'px'));
        this.$toggler = this.$self.parent().find('#togglehelp');
        this.body = $('body');
        this.init();
    }

    Plugin.prototype.init = function () {
        var me = this,
            height = me.$container.height();
            me.body.removeClass('helpOpened');

        _Prtg.Events.subscribe('navigate.prtg,navigate.tab.prtg', $.proxy(me.refresh, me));
        me.refresh();
        this.$self.parent().find('#togglehelp,#closehelp').on('click', function (e) {
            toggle();
            e.stopImmediatePropagation();
        });

        //_Prtg.Events.subscribe('prtg.resize.layout', function () {
            //me.$container.css('maxHeight', parseInt($(window).height() * 0.5, 10) + 'px');
        //});

        if ($('#helpcontainer').hasClass('hidden')) {
            this.open = false;
        } else {
            this.open = true;
        }

        function toggle() {
            me.open = !me.open;
            me.animation2(!me.open);
            $.ajax({
                url: "/api/setshowhelpstatus.htm",
                data: {
                    "action": me.open ? 1 : 0,
                    "page": me.url,
                    "help": true
                },
                type: "GET"
            });
        }
    };

    function setColumnsClass(elem, text) {
        var sizeClasses = {
            l:'text_l',
            xl:'text_xl'
        };

        elem.removeClass(sizeClasses.xl +' '+ sizeClasses.l);

        if(text.length>400){
            elem.addClass(sizeClasses.xl)
        }
        else if(text.length>200){
            elem.addClass(sizeClasses.l);
        }

    }

    Plugin.prototype.animation2 = function (open) {

        var me = this;
        me.$container.removeClass('hidden');

        if (!open) {
            me.$container.removeClass('hidden');
            me.body.addClass('helpOpened');
            $("#sendfeedbackbox").css("right", "290px");
            me.$toggler.hide();
            $('footer').removeClass('hidebuttons');
            $('#prtg_growls').css('bottom', $('#helpcontainer').outerHeight() + 25);
        } else {
            $('footer').addClass('hidebuttons');
            me.$container.addClass('hidden');
            me.body.removeClass('helpOpened');
            $("#sendfeedbackbox").css("right", "");
            me.$toggler.show();
            $('#prtg_growls').css('bottom', "");
        }
    };

    Plugin.prototype.add = function (elm, data) {
        var urlchange = false,
            $content = $(elm),
            me = this;

        me.$self.find(".contexthelpbox").not('.lasthelpitem').remove();
        if (me.url !== encodeURIComponent(window.location.pathname.substr(1, 100))) {
            urlchange = true;
            me.url = encodeURIComponent(window.location.pathname.substr(1, 100));
            if (me.open !== data.show) me.open = data.show;
        }
        if ($content.length === 0) return;
        $content.each(function () {
            var $elm = $(this).detach();
            if (me.$container.find('#' + data.id).length === 0) {
                $elm.data().pluginFunction = 'remove';
                $elm.attr('id', data.id).insertBefore(me.$last);
                !!_Prtg.Plugins.TCT && _Prtg.Plugins.TCT.plugin.init(undefined, me.$self);
            }
        });
        setColumnsClass(me.$self, me.$self.find('p').text());
        if (!urlchange && me.open) {
            me.animation2(!me.open);
        } else if (urlchange) {
            me.animation2(!me.open);
        }
    };

    Plugin.prototype.remove = function (elm) {
        if (!elm) return;
        //if(this.open) this.animation2(this.open);
    };

    Plugin.prototype.refresh = function () {
        var me = this;
        me.$toggler.show();
        me.$self.find(".contexthelpbox").not('.lasthelpitem').remove();
        setColumnsClass(me.$self, me.$self.find('p').text());
    };

    $.fn[pluginName] = function (options) {
        var me = this,
            elm = this;
        if (!!options) {
            if (!!options.pluginTarget) me = $('#helpcontainer');
            if (!!options.pluginFunction) {
                return me.each(function () {
                    $.data(this, "plugin_" + pluginName)[options.pluginFunction](elm, options);
                });
            }
        }
        return me.each(function () {
            if (!$.data(this, "plugin_" + pluginName)) {
                $.data(this, "plugin_" + pluginName, new Plugin(this, options));
            }
        });
    };

})(jQuery, window, document);
;

// PRTG Jquery Plugins
_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
  Graphs: {
    strings: {
      'bigscrollleft': 'Scroll left one window',
      'smallscrollleft': 'Scroll left',
      'bigscrollright': 'Scroll right one window',
      'smallscrollright': 'Scroll right',
      'reset': 'Reset scroll and zoom',
      'zoomin': 'Zoom in',
      'zoomout': 'Zoom out'

    }
  }
});
;
/* _Prtg.Graphs.js */
(function($, window, document, undefined) {
  var regexWidth = /width=\d+/,
    regexHeight = /height=\d+/,
    regexCacheBreaker = /myid=\d/,
    fitSizeUrl = function(url) {
      return url;
    };

  function prtgGraphs(element, data, parent) {
    this.el = !(element instanceof jQuery) ? element : element[0];
    this.$el = !(element instanceof jQuery) ? $(element) : element;
    this.$parent = !(parent instanceof jQuery) ? $(parent) : parent;
    this.$legend = this.$el.find(".chartlegend");
    this.$chart = function() {
      return this.$el.find(
        '.prtgchart[data-graphid="' + this.$legend.attr("data-graphid") + '"]'
      );
    };

    this.data = data;
    this.fitSize = !!data.fitSize;

    this.data.currentChartUrl = this.$chart()
      .parent(".PNGGraph")
      .attr("refreshurl");
    this.data.currentChartSrc = this.$chart().attr("src");
    this.data.sh0w = [];
    this.data.hiddenChannel = [];
    this.data.exitstShowAttribut = false;

    try {
      this.data.hiddenChannel = window.sessionStorage
        .getItem("graphchannelfilter" + this.data.id)
        .split(",");
    } catch (e) {
      this.data.hiddenChannel = [];
    }

    var tmp;
    try {
      // Findet den Channel heraus, der angezeigt werden soll
      this.data.sh0w = _Prtg.Util.getUrlParameters(this.data.currentChartUrl)[
        "sh0w"
      ];
      if (this.data.sh0w) this.data.exitstShowAttribut = true;

      // Attribut von URL ersetzen
      tmp = this.data.currentChartUrl.replace(/hide=all/, "");
      this.data.currentChartUrl = tmp;
      tmp = this.data.currentChartSrc.replace(/hide=all/, "");
      this.data.currentChartSrc = tmp;
    } catch (e) {}
    this.init(this);
    this.initEvents();
  }

  prtgGraphs.prototype.init = function(self) {
    var tempZoomicon = $(".graphzoomicon").find(".zoom");
    var hiddenChannel = self.data.hiddenChannel;
    var channels = [];
    var valuesInHiddenChannelArray = false;

    tempZoomicon.attr("href", tempZoomicon.attr("href") + "&dynamicgraph=1");

    // hiddenChannel-Array in Int-Werte umwandeln
    if (self.data.hiddenChannel.length > 0) {
      for (var i = 0; i < self.data.hiddenChannel.length; i++) {
        channels.push(parseInt(self.data.hiddenChannel[i], 10));
      }
      self.data.hiddenChannel = channels;
      valuesInHiddenChannelArray = true;
    }

    this.$legend.find(".oneitem .chartlegendcolorbox").each(function() {
      var $this = $(this);
      var color = $this.css("background-color");
      var channelid = $this.parent(".oneitem").data("channelid");
      $this.removeAttr("style");
      $this
        .css({
          color: color
        })
        .empty();

      $this.addClass("prtg-checkbox");

      // hide alarms channel
      if (channelid == "-3") {
        $this.css("background-color", color);
        $this.removeClass("prtg-checkbox");
      } else {
        if (self.data.exitstShowAttribut) {
          if (channelid == self.data.sh0w) {
            if (valuesInHiddenChannelArray === false) {
              $this.addClass("icon-check icon-dark");
            }
          } else {
            if (valuesInHiddenChannelArray === false) {
              // Channel in hiddenChannel hinzufügen
              if (!self.data.hiddenChannel.indexOf(channelid) > -1) {
                self.data.hiddenChannel.push(parseInt(channelid, 10));
              }
              $this.removeClass("icon-check icon-dark ");
            }
          }
        } else {
          if (hiddenChannel.indexOf("" + channelid) === -1)
            $this.addClass("icon-check icon-dark ");
        }
        if (valuesInHiddenChannelArray) {
          if (self.data.hiddenChannel.indexOf(channelid) > -1) {
          } else {
            $this.addClass("icon-check icon-dark ");
          }
        }
      }
      try {
        window.sessionStorage.setItem(
          "graphchannelfilter" + self.data.id,
          self.data.hiddenChannel
        );
      } catch (e) {}
    });

    // Add Select/Deselect all checkboxes.
    this.$legend.append(
      '<span class="prtg-graphs-controls"><a href="#" class="button btngrey btnsmall prtg-graphs-control" data-action="selectall">' +
        _Prtg.Lang.common.strings.showall +
        '</a> <a href="#" class="button btngrey btnsmall prtg-graphs-control" data-action="deselectall">' +
        _Prtg.Lang.common.strings.hideall +
        "</a></span>"
    );
  };

  prtgGraphs.prototype.initEvents = function() {
    var self = this;
    this.$el
      .on("click", ".prtg-graphs-control", function(e) {
        var $this = $(this);
        if (self.$el.find(".PNGGraph").length) {
          $this.parent().addClass("loading");
        }

        if ($this.attr("data-action") === "selectall") {
          self.allCheckboxes(true);
        } else if ($this.attr("data-action") === "deselectall") {
          self.allCheckboxes(false);
        }
        e.preventDefault();
      })
      .on("mousedown", "a[data-force]", function() {
        var $this = $(this);
        var url = _Prtg.Util.getUrlParameters(self.data.currentChartSrc);
        [
          "bgcolor",
          "graphtitle",
          "graphstyling",
          "datastylefile",
          "force" + $this.data("force"),
          "hide"
        ].forEach(function(e) {
          delete url[e];
        });
        url = $.extend(true, url, $this.data().params);
        url = [
          $this.attr("href").split("?")[0],
          Object.keys(url)
            .map(function(e) {
              return e + "=" + encodeURIComponent(url[e]);
            })
            .join("&")
        ];
        $this.attr(
          "href",
          url.join("?") +
            "&hide=" +
            self.data.hiddenChannel.join(",") +
            "&graphstyling=baseFontSize%3D'10'%20showLegend%3D'1'&tooltexts=1"
        );
      });

    this.$legend.on("click", ".oneitem", function(e) {
      var $parent = $(this);
      var channelid = $parent.parent(".oneitem").data("channelid");

      var $box = $parent.find(".prtg-checkbox");
      if ($parent.data("channelid") == "-3") return;
      if (!$box.hasClass("icon-check")) {
        $box.addClass("icon-check icon-dark");
        self.ShowChannelInGraph($parent.attr("data-channelid"));
      } else {
        $box.removeClass("icon-check icon-dark");
        self.HideChannelFromGraph($parent.attr("data-channelid"));
      }
      try {
        window.sessionStorage.setItem(
          "graphchannelfilter" + self.data.id,
          self.data.hiddenChannel
        );
      } catch (e) {}

      self.loadNewGraph();
      e.preventDefault();
    });

    if (this.fitSize) {
      fitSizeUrl = function(url) {
        var width = self.$el.width(),
          height = self.$el.height() - self.$legend.outerHeight(); //30 for tooltp

        width = Math.max(width, 300);
        height = Math.max(height, 150);

        return url
          .replace(regexWidth, "width=" + width)
          .replace(regexHeight, "height=" + height);
      };
      $(window).debounce(function() {
        self.fitGraphSize.call(self);
      });
      this.fitGraphSize();
    } else {
      this.updateRefreshUrl();
      this.loadNewGraph();
    }
  };
  prtgGraphs.prototype.fitGraphSize = function() {
    this.data.currentChartUrl = fitSizeUrl(this.data.currentChartUrl);
    this.data.currentChartSrc = fitSizeUrl(this.data.currentChartSrc);
    this.updateRefreshUrl();
    if (this.chartloading)
      _Prtg.Events.subscribeOnce(
        "graph.loaded",
        $.proxy(this, this.fitGraphSize)
      );
    else this.loadNewGraph();
  };

  prtgGraphs.prototype.allCheckboxes = function(select) {
    var self = this;
    var hiddenChannel = [];

    self.$legend.find(".oneitem").each(function() {
      if ($(this).data("channelid") == "-3") return;
      if (select) {
        $(this)
          .find(".chartlegendcolorbox")
          .addClass("icon-check icon-dark");
        hiddenChannel = [];
      } else {
        $(this)
          .find(".chartlegendcolorbox")
          .removeClass("icon-check icon-dark");
        hiddenChannel.push(parseInt($(this).attr("data-channelid"), 10));
      }
    });

    this.data.hiddenChannel = hiddenChannel;

    try {
      window.sessionStorage.setItem(
        "graphchannelfilter" + self.data.id,
        hiddenChannel
      );
    } catch (e) {}

    self.updateRefreshUrl();
    self.loadNewGraph();
  };

  prtgGraphs.prototype.loadNewGraph = function() {
    var self = this;
    var hiddenChannels = this.data.hiddenChannel.join(",");
    var newSrc = this.data.currentChartSrc + "&hide=" + hiddenChannels;
    if (this.$chart().attr("src") == newSrc) {
      self.$el.find(".loading,.load").removeClass("loading load");
    } else {
      self.chartloading = true;
      newSrc = newSrc.replace(regexCacheBreaker, "myid=" + $.now());
      this.$chart()
        .addClass("load")
        .off("load")
        .attr("src", newSrc)
        .one("load", function() {
          self.$el.find(".loading,.load").removeClass("loading load");
          self.chartloading = false;
          _Prtg.Events.publish("graph.loaded");
        });
    }

    // NOTE: Append hidden channels params to download chart links (PRTG-820)
    var $graph_download_link = $("a.save");
    if (hiddenChannels !== "NaN" && !!$graph_download_link.length) {
      $graph_download_link.each(function() {
        var url = $(this)
          .attr("href")
          .split("?")[0];
        var params = _Prtg.Util.getUrlParameters(this.href);
        params["hide"] = hiddenChannels;
        href = url + "?" + $.param(params);
        $(this).attr("href", href);
      });
    }
  };

  prtgGraphs.prototype.getChart = function() {
    return this.$el.find(
      '.prtgchart[data-graphid="' + this.$legend.attr("data-graphid") + '"]'
    );
  };

  prtgGraphs.prototype.HideChannelFromGraph = function(channelID) {
    var hiddenChannel = this.data.hiddenChannel;
    var idx = hiddenChannel.indexOf(parseInt(channelID, 10));
    if (idx > -1) {
    } else {
      hiddenChannel.push(parseInt(channelID, 10));
    }
    this.updateRefreshUrl();
  };

  prtgGraphs.prototype.ShowChannelInGraph = function(channelID) {
    var hiddenChannel = this.data.hiddenChannel,
      idx = hiddenChannel.indexOf(parseInt(channelID, 10));
    if (idx > -1) {
      hiddenChannel.splice(idx, 1);
    }
    this.updateRefreshUrl();
  };

  prtgGraphs.prototype.updateRefreshUrl = function() {
    this.$chart()
      .parent(".PNGGraph")
      .attr(
        "refreshurl",
        this.data.currentChartUrl + "&hide=" + this.data.hiddenChannel.join(",")
      );
    this.$el.find("#hiddenchannels").val(this.data.hiddenChannel.join(","));
  };

  _Prtg.Plugins.registerPlugin("prtg-graphs", prtgGraphs);

  function prtgGraphsScroll(element, data, parent) {
    this.el = !(element instanceof jQuery) ? element : element[0];
    this.$el = !(element instanceof jQuery) ? $(element) : element;
    this.$parent = !(parent instanceof jQuery) ? $(parent) : parent;
    this.$legend = this.$el.find(".chartlegend");
    this.$chart = function() {
      return this.$el.find(
        '.prtgchart[data-graphid="' + this.$legend.attr("data-graphid") + '"]'
      );
    };

    this.data = data;
    this.serverTime = _Prtg.serverTime.getTime();

    this.orginalRefreshUrl =
      this.data.currentChartUrl ||
      this.$chart()
        .parent(".PNGGraph")
        .attr("refreshurl");
    this.orginalRefreshUrl = {
      url: this.orginalRefreshUrl.split("?")[0],
      par: _Prtg.Util.getUrlParameters(this.orginalRefreshUrl)
    };
    this.orginalSrc = this.data.currentChartSrc || this.$chart().attr("src");
    this.orginalSrc = {
      url: this.orginalSrc.split("?")[0],
      par: _Prtg.Util.getUrlParameters(this.orginalSrc)
    };
    this.average = "";
    this.incrementor = 0;
    this.clgid = $('input[name="clgid"]:checked').val() || null;
    this.stepwidth =
      this.$el.find(".PNGGraph").length > 0
        ? (function(me, data) {
            var p,
              j,
              t = data.chartType,
              i = data.sensorInterval,
              multiplier = function(d) {
                switch (d) {
                  case "m":
                    return 60;
                  case "h":
                    return 60 * 60;
                  case "d":
                    return 60 * 60 * 24;
                  default:
                    return 1;
                }
              };
            if (typeof t === "string") {
              p = t.split("|");
              t = parseInt(p[0], 10);
              i = multiplier(p[0].charAt(p[0].length - 1));
              if (p.length > 1) {
                j = parseInt(p[1], 10);
                me.average = j * multiplier(p[1].charAt(p[1].length - 1));
              } else {
                me.average = i;
              }
            } else {
              me.average = i;
            }
            p = t * i * 1000;
            return p;
          })(this, this.$el.find(".PNGGraph").data())
        : 0;
    this.zoom = 1.0;
    this.init(this);
  }

  prtgGraphsScroll.prototype.roundTime = function() {
    return this.serverTime - this.serverTime % (this.average * 1000);
  };

  prtgGraphsScroll.prototype.init = function(self) {
    var timer = null;
    self.$el
      .on("click", ".scrollchart", function(e) {
        if (self.$el.find(".PNGGraph").length) {
          var controls = $(this).parent(".prtg-graphs-controls");
          if (controls.find(".loadspinner").length == 0) {
            controls.append('<div class="loadspinner"></div>');
          }
          $(this)
            .parent(".prtg-graphs-controls")
            .addClass("loading");
        }

        var orginalSrc = $.extend(true, {}, self.orginalSrc),
          orginalRefreshUrl = $.extend(true, {}, self.orginalRefreshUrl),
          edate,
          sdate,
          data = $(this).data();

        if (self.incrementor === 0) {
          if ($(this).is(".right")) {
            $(this)
              .parent(".prtg-graphs-controls")
              .removeClass("loading");
            return;
          } else {
            self.serverTime = _Prtg.serverTime.getTime();
          }
        }

        if (self.zoom + data.zoom > 0.01) self.zoom += data.zoom;
        if (self.zoom >= 1.0) self.zoom = 1.0;
        self.incrementor += data.step;
        if (self.incrementor >= 0) self.incrementor = 0;
        if (data.zoom === 0 && data.step === 0)
          (self.incrementor = 0), (self.zoom = 1.0);
        if (self.incrementor !== 0 || self.zoom !== 1.0) {
          edate = new Date(
            self.roundTime() + self.incrementor * self.stepwidth * self.zoom
          );
          sdate = new Date(edate.getTime() - self.stepwidth * self.zoom);
          orginalSrc.par["graphid"] = -1;
          orginalSrc.par["edate"] = edate.toPrtgString();
          orginalSrc.par["sdate"] = sdate.toPrtgString();
          orginalSrc.par["avg"] = self.average;
          if (self.clgid) orginalSrc.par["clgid"] = self.clgid;
          self
            .$chart()
            .parent(".PNGGraph")
            .removeAttr("refreshurl");
        } else {
          self
            .$chart()
            .parent(".PNGGraph")
            .attr(
              "refreshurl",
              self.url(orginalRefreshUrl, "currentChartUrl") +
                "&hide=" +
                self.data.hiddenChannel.join(",")
            );
          self.serverTime = _Prtg.serverTime.getTime();
        }
        clearTimeout(timer);
        self.$el.find("a[data-force]").each(function() {
          orginalSrc.url = $(this)
            .attr("href")
            .split("?")[0];
          $(this).attr(
            "href",
            self.url(orginalSrc, "currentChartSrc") +
              "&hide=" +
              self.data.hiddenChannel.join(",") +
              "&" +
              $(this).data("force") +
              "=true"
          );
        });

        timer = setTimeout(function() {
          var newSrc =
            self.url(orginalSrc, "currentChartSrc") +
            "&hide=" +
            self.data.hiddenChannel.join(",");
          newSrc = fitSizeUrl(newSrc);

          if (self.$chart().attr("src") == newSrc) {
            self.$el.find(".loading,.load").removeClass("loading load");
          } else {
            newSrc = newSrc.replace(regexCacheBreaker, "myid=" + $.now());
            self
              .$chart()
              .addClass("load")
              .off("load")
              .attr("src", newSrc)
              .one("load", function() {
                self.$el.find(".loading,.load").removeClass("loading load");
              });
          }
        }, 333);
      })
      .find("#chart")
      .append(
        '<span class="prtg-graphs-controls">' +
          '<div class="scrollchart left" data-step="-1" data-zoom="0" title="' +
          _Prtg.Lang.Graphs.strings.bigscrollleft +
          '"><i class="glyph-graph-left-double"></i></div>' +
          '<div class="scrollchart left" data-step="-0.1" data-zoom="0" title="' +
          _Prtg.Lang.Graphs.strings.smallscrollleft +
          '"><i class="glyph-graph-left"></i></div>' +
          '<div class="scrollchart center" data-step="0" data-zoom="-0.2" title="' +
          _Prtg.Lang.Graphs.strings.zoomin +
          '"><i class="glyph-graph-plus"></i></div>' +
          '<div class="scrollchart center" data-step="0" data-zoom="0" title="' +
          _Prtg.Lang.Graphs.strings.reset +
          '"><i class="glyph-graph-reload"></i></div>' +
          '<div class="scrollchart center" data-step="0" data-zoom="0.2" title="' +
          _Prtg.Lang.Graphs.strings.zoomout +
          '"><i class="glyph-graph-minus"></i></div>' +
          '<div class="scrollchart right " data-step="0.1" data-zoom="0" title="' +
          _Prtg.Lang.Graphs.strings.smallscrollright +
          '"><i class="glyph-graph-right"></i></div>' +
          '<div class="scrollchart right " data-step="1" data-zoom="0" title="' +
          _Prtg.Lang.Graphs.strings.bigscrollright +
          '"><i class="glyph-graph-right-double"></i></div>' +
          "</span>"
      );
  };

  // Ein kommentar wär schön...
  prtgGraphsScroll.prototype.url = function(u, c) {
    var ret =
      u.url +
      "?" +
      Object.keys(u.par)
        .map(function(e) {
          return e + "=" + encodeURIComponent(u.par[e]);
        })
        .join("&");
    this.data[c] = ret;
    return ret;
  };

  _Prtg.Plugins.registerPlugin("prtg-graphs-scroll", prtgGraphsScroll);
})(jQuery, window, document);
;
/* _Prtg.Breadcrumbs.js */
;
(function breadcrumbs($, window, document, undefined) {
  var child;

  function prtgBreadcrumbs(element, data, parent) {
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.$parent = (!(parent instanceof jQuery)) ? $(parent) : parent;
    this.menuDivs = {};
    this.init();
  }

  prtgBreadcrumbs.prototype.init = function() {
    var self = this;

    if (child !== undefined) this.changeContent(child);
    this.$el.find(".breadcrumbmenu").each(function() {
      $(this).find(".breadcrumbdivider").addClass("breadcrumbdivideractive");
      self.loadJsonMenuData($(this));
    });
    this.InitEvents();
  };

  prtgBreadcrumbs.prototype.changeContent = function(child) {
    var self = this;
    var $child = (!(child instanceof jQuery)) ? $(child) : child;
    this.$el.children().replaceWith($child.children());
    $child.remove();
    this.$el.find(".breadcrumbmenu").each(function() {
      $(this).find(".breadcrumbdivider").addClass("breadcrumbdivideractive");
      self.loadJsonMenuData($(this));
    });
  };

  prtgBreadcrumbs.prototype.loadJsonMenuData = function($menuparent) {
    var self = this;
    $.ajax({
      beforeSend: function(jqXHR) {
        jqXHR.ignoreManager = true;
      },
      url: "/api/nodechilds.json",
      data: {
        "id": $menuparent.attr("data-breadid")
      },
      dataType: "json"
    }).done(function(response) {
      self.initMenu($menuparent, response);
    });
  };

  prtgBreadcrumbs.prototype.InitEvents = function() {
    var self = this;
    var closeTimer;
    this.$el.on("click", ".breadcrumbmenu", function(e) {
      if (self.menuDivs[$(this).attr("data-breadid")] && !self.menuDivs[$(this).attr("data-breadid")].menu.is(":visible")) {
        $(".breadcrumbsubmenu").hide();
        var $menu = self.menuDivs[$(this).attr("data-breadid")].menu
        self.resetSubMenu($menu);
        $menu.show();
        $menu.find(".breadcrumbsubmenusearchboxinput").focus();
        $menu.find(".hoveritem").removeClass("hoveritem");
        $menu.find("ul").scrollTop(0);
        $menu.find("ul").scrollTop($menu.find(".breadcrumbsubmenuselected").offset().top - 130);
        $menu.css("width", $menu.width() + "px")
        e.stopPropagation();
        e.preventDefault();
      }
    }).on("click", ".breadcrumbmenu a", function(e) {
      if (self.menuDivs[$(this).attr("data-breadid")] && !self.menuDivs[$(this).parent(".breadcrumbmenu").attr("data-breadid")].menu.is(":visible")) {
        $(".breadcrumbsubmenu").hide();
        var $menu = self.menuDivs[$(this).parent(".breadcrumbmenu").attr("data-breadid")].menu
        self.resetSubMenu($menu);
        $menu.show();
        $menu.find(".breadcrumbsubmenusearchboxinput").focus();
        $menu.find(".hoveritem").removeClass("hoveritem");
        $menu.css("width", $menu.width() + "px")
        e.stopPropagation();
        e.preventDefault();
      }
    });
    this.$el.parent('#header_breadcrumbs').on("mouseout", ".breadcrumbsubmenu", function(e) {
      
      var $this = $(this);
      closeTimer = setTimeout(function() {
        $this.hide();
      }, 500);
    }).on("mouseover", ".breadcrumbsubmenu", function(e) {
      clearTimeout(closeTimer);
    }).on("click", ".breadcrumbsubmenu li", function(e) {
      if ($(this).children().index(e.target) != -1) return;
      $(this).find('a').trigger('click');
      e.stopPropagation();
      e.preventDefault();
    });
    this.$el.parent().on("keyup", ".breadcrumbsubmenusearchboxinput", function(e) {
      self.search($(this).val(), $(this).parents(".breadcrumbsubmenu"));
    });
    //.on("focus", ".breadcrumbsubmenusearchboxinput", function(e) {
      //$(this).val(""); TODO
    //});
  };

  prtgBreadcrumbs.prototype.initMenu = function($menuparent, menuData) {
    var menuContent = "",
      selectedEntry, menuDiv = $("<div />", {
        "class": "breadcrumbsubmenu"
      });

    if (!menuData.children) return false; // If no data availible -> abort
    $menuparent.append('<span class="icon-triangle-1-s icon-gray breadcrumbsubmenuopener"></span>');
    menuContent = menuContent + "<ul>";
    for (var i = 0, len = menuData.children.length; i < len; i++) {
      if (!menuData.children[i].error) {
        menuContent = menuContent + "<li " + (i % 2 === 0 ? 'class="odd"' : '') + 'objid="' + menuData.children[i].id + '">' + menuData.children[i].link + "</li>";
      }
    }
    menuContent = menuContent + "</ul>";
    menuDiv.append(menuContent);
    menuDiv.css({
      "top": ($menuparent.position().top + $menuparent.outerHeight(true)) + "px",
      "left": $menuparent.position().left + "px"
    });
    selectedEntry = menuDiv.find('li[objid="' + $menuparent.attr("data-breadid") + '"]').addClass("breadcrumbsubmenuselected");

    // current object to first position
    //selectedEntry.detach();
    //menuDiv.find("ul").prepend(selectedEntry.clone());

    menuDiv.prepend($("<p />", {
      'class': 'breadcrumbsubmenusearchbox',
      'html': '<span class="icon-search icon-gray"></span><input type="text" class="breadcrumbsubmenusearchboxinput">'
    }));
    this.$el.after(menuDiv);
    this.menuDivs[$menuparent.attr("data-breadid")] = {
      "menu": menuDiv
    };
  };

  prtgBreadcrumbs.prototype.search = function(text, $menuDiv) {
    if (text.length > 1) {
      var searchStr = new RegExp(text, "ig");
      
      $menuDiv.find("li a").each(function() {
        if ($(this).text().search(searchStr) > -1) {
          $(this).parent().show();
        } else {
          $(this).parent().hide();
        }
      });
    } else {
      $menuDiv.find("li").show();
    }
  };

  prtgBreadcrumbs.prototype.resetSubMenu = function($menuDiv) {
    $menuDiv.find("li").show();
    $menuDiv.find(".breadcrumbsubmenusearchboxinput").val("");
  };

  $.fn['prtg-breadcrumbs'] = function(data, parent) {
    return this.each(function() {
      if (data.child) {
        var $this = $(this).detach().removeClass('hide');
        $('#header_breadcrumbs').html($this);
        if (!$.data(this, 'plugin_prtgBreadcrumbs')) {
          $.data(this, 'plugin_prtgBreadcrumbs', new prtgBreadcrumbs(this, data, parent));
        }
      }
    });
  };

})(jQuery, window, document);
;
/* _Prtg.Clock.Plugin.js */
(function prtgClockPlugin($, window, document, undefined) {
  var pluginName = 'prtg-clock';
  function prtgClock(element, data, parent) {
    this.data = data;
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.$clockEl = this.$el.find('.serverclock');
    this.timezone = this.data['timezone']
    this.initEvents();
  }

  prtgClock.prototype.initEvents = function() {
    var _this = this;
    _this.$el.on('destroyed', _this, _this.destroy);
    _this.statusHandler = $.proxy(_this.handleStatusRefresh, _this)
    _Prtg.Events.subscribe('refreshstatus.events.prtg', _this.statusHandler);
  };

  prtgClock.prototype.handleStatusRefresh = function handleStatusRefresh(event, statusData) {
    var _this = this;
    _this.$el.attr('data-original-title', statusData.Clock + ' (' + _this.timezone + ')');
    _this.$clockEl.text(formatTimeString(statusData.Clock));
  }

  prtgClock.prototype.destroy = function destroyEvent(event) {
    var _this = event.data;
    _Prtg.Events.unsubscribe('refreshstatus.events.prtg', _this.statusHandler);
  };

  function formatTimeString(timeStr) {
    var splitdatetime =  timeStr.split(' ', 2);
    var splitTime = splitdatetime[1].split(':',2);
    return splitTime[0]+':'+splitTime[1];
  }
  
  _Prtg.Plugins.registerPlugin(pluginName, prtgClock);
})(jQuery, window, document);;
(function($) {
  /**
   * Take an text input field and style it as an autocomplete tags field, with each tag in a box and a remove button.
   * @param {array} options to set various options.
   * @param {array} options.tags array with availible tags for the autocomplete menu.
   * @todo check if object is input type=text!
   */
  $.Tagsinput = function(el, options) {
    var base = this;
    base.$el = $(el);
    base.el = el;
    base.$el.data('Tagsinput', base),
    shiftPressed=false;

    var tags = [],
      tagslist = $('<div />', {
        'class': 'taglist'
      }),
      list = $('<ul />'),
      inputLi = $('<li />', {
        'class': 'newtaginput'
      }),
      input = $('<input />', {
        'type': 'text',
        'disabled': base.$el.prop('disabled')
      }),
      editmode = false;

    base.init = function() {
      base.options = $.extend(true, {}, $.Tagsinput.defaultOptions, options);
      if (base.$el.prop('id').indexOf('filter') < 0) {
        base.options.firstkeycode.push(43, 45);
        base.options.firstregex = /^(\+|\-)/;
      }

      var loadedTags = base.$el.val().replace(/,/g, base.options.seperator);
      loadedTags = loadedTags.split(base.options.seperator);
      if (base.options.pastesplitregex !== null) {
        base.options.pastesplitregex = new RegExp(base.options.pastesplitregex, 'i');
      }

      if (!base.options.readonly) {
        inputLi.append(input);
        list.append(inputLi);
      } else {
        tagslist.addClass('readonly');
      }

      tagslist.append(list);
      base.$el.prop('type', 'hidden');
      base.$el.after(tagslist);

      for (var i = 0; i < loadedTags.length; i++) {
        base.addTag(loadedTags[i], true);
      }

      if (!base.options.readonly) base.initEvents();
    };

    base.initEvents = function() {
      input.on('keydown', function(event) {

        if(event.which==16) shiftPressed=true;
        else if (event.which == 226 || (shiftPressed && (event.which == 56 || event.which == 57))) {
          event.preventDefault();
          event.stopPropagation();
          return;
        }

        if (event.which == 8) {
          if (this.value === '') {
            $('li:last', list).prev().remove();
            tags = [];
            $('li', list).each(function() {
              tags.push($('span', this).text());
            });
            base.$el.val(tags.join(base.options.seperator));
            base.updateTagsInput();
          }
        }
      });

      input.on('keyup', function(event) {
          if (event.which == 16) shiftPressed=false;
      });

      input.on('keypress', function(event) {
        if (this.value === '' && $.inArray(event.which, base.options.firstkeycode) > -1) {
          event.preventDefault();
          event.stopPropagation();
          return;
        }

        if ($.inArray(event.which, base.options.newtagkeycode) > -1) {
          event.preventDefault();
          if (this.value !== '') {
            base.addTag(this.value);
            this.value = '';
            if (base.options.autocomplete) {
              input.autocomplete('close');
            }
          }
        }
      });
      input.on('focus', function(event) {
        if (base.options.autocomplete) {
          $(this).autocomplete('search', '');
        }
      });

      input.on('focusout', function(event) {
        if (input.val() !== '') {
          base.addTag(input.val());
          input.val('');
        }
      });

      input.on('paste', function(e) {
        setTimeout(function() {
          var seperatedTags;
          if (base.options.pastesplitregex === null) {
            seperatedTags = [input.val()];
          } else {
            seperatedTags = input.val().split(base.options.pastesplitregex);
          }

          for (var i = 0; i < seperatedTags.length; i++) {
            base.addTag(seperatedTags[i]);
          }

          input.val('');
        }, 100);
      });

      list.on('click', '.taglabel', function (event) {

        if($(event.target).hasClass('closetag') ||  $(event.target).parent().hasClass('closetag')) return;
        if (!input.prop('disabled')) {
          $(this).remove();
          base.updateTagsInput();
        }
        return false;
      });

      // "Edit on click"-functionality replaced with "show specific tag overview"-page
      list.on('click', '.taglabel>span', function(event) {
        var path = location.pathname;
        var sourceDestionationMap = {
          '/probenode.htm': '/devices.htm?',
          '/group.htm': '/devices.htm?',
          '/device.htm': '/devices.htm?',
          '/sensor.htm': '/sensors.htm?',
          '/library.htm': '/libraries.htm?',
          '/report.htm': '/reports.htm?',
          '/addsensor1.htm': '/sensors.htm?',
          '/addsensor2.htm': '/sensors.htm?',
          '/addsensor3.htm': '/sensors.htm?',
          '/addsensor4.htm': '/sensors.htm?',
          '/map.htm': '/maps.htm?',
          '/editnotification.htm': 'myaccount.htm?tabid=2&'
        };
        if(path in sourceDestionationMap){
          path=sourceDestionationMap[path];
          window.open(path+'filter_tags=@tag('+encodeURIComponent($(event.target).text())+')','_blank');
        }
      });

      tagslist.on('click', function() {
        if ($('.taglabeledit').length < 1) {
          input.focus();
        }
      });

      if (base.options.autocomplete) {
        input.autocomplete({
          minLength: 0,
          messages: {
            noResults: null,
            results: function() {}
          },
          search: function() {
            if (base.$el.prop('disabled')) {
              return false;
            }
          },
          focus: function() {
            return false;
          },
          select: function(event, ui) {
            base.addTag(ui.item.value);
            input.val('');
            return false;
          },
          create: function() {
            if (typeof (base.options.tags) === 'function') {
              base.options.tags($(this), function(tags) {
                base.options.tags = tags;
              });
            } else {
              $(this).autocomplete({
                source: base.options.tags,
                messages: {
                  noResults: null,
                  results: function() {}
                }
              });
            }
          }
        });
      }
    };

    base.addTag = function(newTag, initTags) {
      if (newTag !== '') {
        var newTagLabel;
        if (base.options.firstregex)
        newTag = newTag.replace(base.options.firstregex, '');
        if (!base.options.readonly) {
          newTagLabel = $('<li />', {
            'class': 'taglabel',
            'html': '<span class="closetag"></span>'
          });
        } else {
          newTagLabel = $('<li />', {
            'class': 'taglabel',
            'html': '<span></span>'
          });
        }

        if(newTag.length>21) newTagLabel.attr('title',newTag);

        tags.push(newTag);
        newTagLabel.find('span').text(newTag);
        if (!base.options.readonly) {
          inputLi.before(newTagLabel);
        } else {
          list.append(newTagLabel);
        }

        base.$el.val(tags.join(base.options.seperator));
        if (!initTags) {
          base.$el.change();
        }
      }
    };

    base.updateTagsInput = function() {
      tags = [];
      $('li.taglabel', list).each(function(elm, i) {
        tags.push($('span', this).text());
      });
      base.$el.val(tags.join(base.options.seperator)).change();
    };

    base.init();
  };

  $.Tagsinput.defaultOptions = {
    'tags': '[]',
    'autocomplete': true,
    'seperator': ' ',
    'newtagkeycode': [44, 13, 32],
    'pastesplitregex': ',| ',
    'firstkeycode': [],
    'firstregex': null
  };
  $.fn.tagsinput = function(options) {
    if (!$(this).is('input')) {
      return;
    }

    return this.each(function() {
      if (!$(this).data('Tagsinput'))
      (new $.Tagsinput(this, options));
    });
  };
})(jQuery);
;
(function($) {
  /**
   * Take an dropdown select field and style it with clickable stars to change the value.
   */
  $.Favstarsinput = function(el) {
    var base = this;
    base.$el = $(el);
    base.el = el;
    base.$el.data("Favstarsinput", base);

    var starSpan = $("<span />", {
      "id": "favstarinput",
      "html": "&nbsp;"
    });

    var aStar = $("<a />", {
      "class": "favstar",
      "href": "#"
    });
    var aEmptyStar = $("<a />", {
      "class": "favempty",
      "href": "#"
    });

    base.init = function() {
      base.$el.hide();
      //starSpan.css("width", base.$el.css("width"));

      var currentStars = base.$el.val();
      var starsCount = $("option", base.$el).size();

      for(var i = 0; i < starsCount; i++) {
        if(i < currentStars) {
          starSpan.append(aStar.clone().data("starnum", i + 1));
        } else {
          starSpan.append(aEmptyStar.clone().data("starnum", i + 1));
        }
      }

      base.$el.after(starSpan);

      starSpan.delegate("a", "click", function(e) {
        if(!base.$el.prop("disabled")) {
          var num = $(this).data("starnum");
          base.setStars(num);
          base.$el.val(num).change();
        }
        return false;
      }).delegate("a", "hover", function(e) {
        if(!base.$el.prop("disabled")) {
          if(e.type === "mouseenter") {
            base.setStars($(this).data("starnum"));
          } else {
            base.setStars(base.$el.val());
          }
        }
        return false;
      });
    };

    base.setStars = function(num) {
      $("a", starSpan).each(function(index, elm) {
        if(index < num) {
          $(elm).addClass("favstar");
          $(elm).removeClass("favempty");
        } else {
          $(elm).addClass("favempty");
          $(elm).removeClass("favstar");
        }
      });
    };
    base.init();
  };

  $.fn.favstarsinput = function() {
    if(!$(this).is("select") || $("#favstarinput").length > 0) {
      return;
    }
    return this.each(function() {
      (new $.Favstarsinput(this));
    });
  };
})(jQuery);
;
(function ($) {
    /**
    * jQuery.fn.sortElements
    * --------------
    * @param {function} comparator:
    *   Exactly the same behaviour as [1,2,3].sort(comparator)
    *   
    * @param {function} getSortable
    *   A function that should return the element that is
    *   to be sorted. The comparator will run on the
    *   current collection, but you may want the actual
    *   resulting sort to occur on a parent or another
    *   associated element.
    *   
    *   E.g. $('td').sortElements(comparator, function(){
    *      return this.parentNode; 
    *   })
    *   
    *   The <td>'s parent (<tr>) will be sorted instead
    *   of the <td> itself.
    */
    $.fn.sortElements = (function () {
        var sort = [].sort;
        return function (comparator, getSortable) {
            getSortable = getSortable || function () { return this; };
            var placements = this.map(function () {
                var sortElement = getSortable.call(this),
                parentNode = sortElement.parentNode,
                // Since the element itself will change position, we have
                // to have some way of storing its original position in
                // the DOM. The easiest way is to have a 'flag' node:
                nextSibling = parentNode.insertBefore(
                    document.createTextNode(''),
                    sortElement.nextSibling
                );
                return function () {
                    if (parentNode === this) {
                        throw new Error("You can't sort elements if any one is a descendant of another.");
                    }
                    // Insert before flag:
                    parentNode.insertBefore(this, nextSibling);
                    // Remove flag:
                    parentNode.removeChild(nextSibling);
                };
            });
            return sort.call(this, comparator).each(function (i) {
                placements[i].call(getSortable.call(this));
            });
        };
    })();
})(jQuery);
;
//_Prtg.DesktopNotifications.lang.js
_Prtg.Lang = _Prtg.Lang || {
  ___: '_Prtg.Lang'
};
$.extend(true, _Prtg.Lang, {
  desktopNotifications: {
    strings: {
      "down": 'Down',
      "downPartial": 'Down (Partial)',
      "warning": 'Warning',
      "downAck": 'Down (Acknowledged)',
      "up": 'Up',
      "paused": 'Paused',
      "unusual": 'Unusual',
      "unknown": 'Unknown'
    }
  }
});
;
//_Prtg.DesktopNotifications.js
(function($) {
  var desktopNotification = function() {
    var showAlarmsNotifi = function(count) {
      var alarms;
      try {
        alarms = window.localStorage.getItem("newalarmcount");
      } catch (err) {
        alarms = 0;
      }
      if (alarms >= 0 && count > 0 && alarms < count) {
        if ("Notification" in window) {
          if (Notification.permission === "granted") {
            PrintAlarmStringAsDesktopNotification();
          }
        }
      }
      try {
        window.localStorage.setItem("newalarmcount", count);
      } catch (err) {}
    };

    var requestPermission = function() {
      if ("Notification" in window && Notification.permission == "default") {
        Notification.requestPermission(function(permission) {});
      }
    };

    return {
      showAlarms: showAlarmsNotifi,
      requestPermission: requestPermission,
      ___: "_Prtg.desktopNotification"
    };
  };

  $.extend(true, window, {
    _Prtg: {
      desktopNotification: desktopNotification()
    }
  });

  function PrintAlarmStringAsDesktopNotification() {
    var notificationText;
    $.getJSON("/api/getstatus.htm?id=0").done(function(response) {
      if (response.Alarms !== "") {
        notificationText =
          _Prtg.Lang.desktopNotifications.strings.down + ": " + response.Alarms;
      }
      if (response.PartialAlarms !== "") {
        if (notificationText.length > 0)
          notificationText = notificationText + " / ";
        notificationText =
          notificationText +
          _Prtg.Lang.desktopNotifications.strings.downPartial +
          ": " +
          response.PartialAlarms;
      }
      if (response.WarnSens !== "") {
        if (notificationText.length > 0)
          notificationText = notificationText + " / ";
        notificationText =
          notificationText +
          _Prtg.Lang.desktopNotifications.strings.warning +
          ": " +
          response.WarnSens;
      }
      if (response.AckAlarms !== "") {
        if (notificationText.length > 0)
          notificationText = notificationText + " / ";
        notificationText =
          notificationText +
          _Prtg.Lang.desktopNotifications.strings.downAck +
          ": " +
          response.AckAlarms;
      }
      if (response.UpSens !== "") {
        if (notificationText.length > 0)
          notificationText = notificationText + " / ";
        notificationText =
          notificationText +
          _Prtg.Lang.desktopNotifications.strings.up +
          ": " +
          response.UpSens;
      }
      if (response.PausedSens !== "") {
        if (notificationText.length > 0)
          notificationText = notificationText + " / ";
        notificationText =
          notificationText +
          _Prtg.Lang.desktopNotifications.strings.paused +
          ": " +
          response.PausedSens;
      }
      if (response.UnusualSens !== "") {
        if (notificationText.length > 0)
          notificationText = notificationText + " / ";
        notificationText =
          notificationText +
          _Prtg.Lang.desktopNotifications.strings.unusual +
          ": " +
          response.UnusualSens;
      }
      if (response.UnknownSens !== "") {
        if (notificationText.length > 0)
          notificationText = notificationText + " / ";
        notificationText =
          notificationText +
          _Prtg.Lang.desktopNotifications.strings.unknown +
          ": " +
          response.UnknownSens;
      }

      var date = new Date();
      var dateString = date.toLocaleTimeString();

      var options = {
        body: notificationText,
        tag: dateString,
        icon: "/icons/led_red_big.png"
      };

      var notification = new Notification(
        "(" + dateString + ") " + "PRTG - New Alarms: " + response.NewAlarms,
        options
      );
      notification.onclick = function() {
        window.location.href =
          "alarms.htm?filter_status=5&filter_status=4&filter_status=10&filter_status=13&filter_status=14";
        $.ajax({
          url: "/api/resetnewmessagestimestamp.htm",
          dataType: "text",
          type: "GET",
          beforeSend: function(jqXHR) {
            jqXHR.ignoreManager = true;
          },
          success: function() {
            try {
              window.localStorage.setItem("newalarmcount", 0);
            } catch (err) {}
          }
        });
        notification.close();
      };
    });
  }
})(jQuery);
;
//_Prtg.ObjectSelector.js

(function($, window, document, undefined) {
  var pluginName = "objectselector";

  function Plugin(element, data, parent) {
      this.data = data;
      this.$element = $(element);
      this.$parent = $(parent);
      this.$sensorload = (!!data.sensorload && this.$parent.find(data.sensorload).length ? this.$parent.find(data.sensorload) : null);
      this.timer = null;
      this.init(this);
  }

  Plugin.prototype.init = function(me) {
      var $self = me.$element
        , data = me.data
        , node = $();
      if (!data.tree) return;
      $self.attr('data-tree', null)
      .on("loaded.jstree", function(e, o) {
        o.inst.open_all(-1);
        !!(data.branch) && o.inst.select_node("#objectlink_"+data.branch);
        !!data.disabled && !o.inst.close_node("#objectlink_"+data.disabled) &&  o.inst._get_node("#objectlink_"+data.disabled)!==false && o.inst._get_node("#objectlink_"+data.disabled).attr('rel', 'disabled');
      }).on("select_node.jstree", function(e, o) {
        node = $(o.args[0]);
        var objid = $.map(o.inst.get_selected(),function(node){return $(node).attr('objid');});
        !!node.length && !!me.$sensorload && me.loadSensorlist(objid, node);
        $self.next().val(objid.join(',')).trigger('change').trigger('blur');
        $self.parents("form").trigger("change");
      }).on("search.jstree", function (e, o) {
        $self.addClass('jstree-search');
      }).jstree({
        "json_data": {
          "data": data.tree
        },
        "ui":{
          "select_limit": data.allowone || -1,
          "initially_select": (''+data.selid||'').split(',').map(function(e){return 'objectlink_'+e;})
        },
        "core": {
          "animation": 0
        },
        "themes": {
          "url": "/css/prtg.tree.css"
        },
        "search": {
          "case_insensitive": true,
          "show_only_matches": true
        },
        "types": {
          "types": {
            "default": {
              "max_children": -2,
              "max_depth": -2,
              "valid_children": "all",
              "icon": {
                "image": "",
                "position": false
              }
            },
            "disabled": {
              "valid_children": "all",
              "hover_node": false,
              "select_node": function(node){
                  return false;
              }
            }
          }
        },
        "plugins": ["json_data", "ui", "themes", "types", "search"]
      });

    //object search
    $self.closest('form').find('#objsearch')
      .on('focusin', function(){
        var $me = $(this)
          , timer = null;
        $self
          .removeClass('jstree-search')
          .addClass('jstree-search-light');

        if ($me.val() === $me.attr('defaultvalue'))
          $me.val('');
        !!me.$sensorload && !!me.$sensorload.empty();

        $me.on('keyup.searchobject', function(e){
          if(e.target.value.length === 0) {
            clearTimeout(timer);
            $self.removeClass('jstree-search-light');
            !!node.length && !!me.$sensorload &&  me.loadSensorlist.call(me, node.parent().attr('objid'), node);

          } else {
            clearTimeout(timer);
            timer = setTimeout(function() {
              !!me.$sensorload && me.loadSensorlist.call(me, undefined,undefined,'group,device,name,tags,objid',e.target.value)
            }, 600);
          }
        });
      })
      .on('focusout', function(){
        var $me = $(this);
        $me.off('.searchobject')
      });
    //tree search
    $self
      .on('mousedown', function(e){
        if($self.hasClass('jstree-search-light')) {
          !!node.length && !!me.$sensorload &&  me.loadSensorlist.call(me, node.parent().attr('objid'), node);
          $self.removeClass('jstree-search jstree-search-light');
        }
      })
      .closest('form').find('#objtreesearch')
      .on('focusin', function(){
        var $me = $(this)
          , timer = null;

        if($self.hasClass('jstree-search-light'))
          !!node.length && !!me.$sensorload &&  me.loadSensorlist.call(me, node.parent().attr('objid'), node);

        $self
          .removeClass('jstree-search jstree-search-light')
          .jstree('clear_search');

        $me.val('');
        $me.on('keyup.searchtree', function(e){
          if(e.target.value.length === 0){
            clearTimeout(timer);
            $self
              .removeClass('jstree-search')
              .jstree('clear_search');
          } else {
            clearTimeout(timer);
            timer = setTimeout(function(){
              $self.jstree("search", e.target.value);
            }, 300);
          }
        });
      })
      .on('focusout', function(){
        var $me = $(this);
        $me.off('.searchtree');
      })
      .filter(':focus').triggerHandler('focusin');
  };

  Plugin.prototype.loadSensorlist = function loadSensorlist(myid,node,searchtype,searchstring){
    var self = this
      , myurl=""
      , $mytarget=self.$sensorload.empty().addClass('loading')
      , data = this.data
      , ajax = {}
      , filter=[""];

      if ($mytarget.find('.loadspinner').length == 0){
          $mytarget.append('<div class="loadspinner"></div>')
      }
    if (myid !== null) {
      myurl="/api/table.json";
      ajax = {
        // id:myid,
        content: "sensorxref",
        noraw: "1",
        columns: "name,objid,status=textraw,type,basetype,device,group",
        filter_basetype: ['sensor'],
        filter_parentid: myid,
        output: "json",
        maxcount: "9999",
        nonefound: "{}"
      };
    }
    if (!!searchstring){
      searchtype = searchtype.split(',');
      filter = $.map(searchtype, function(e){
        return "?filter_"+e+"=@sub("+searchstring+")";
      });
      myurl="/api/search.htm";
      ajax = {
        id: 0,
        maxcount: "9999",
        noraw: "1",
        content: "sensors",
        columns: "name,type,basetype,objid,status=textraw,device,group,icon=treejson",
        output: "json",
        nonefound: "{}"
      };
      if(!data.onlysensors)
        ajax.content += ',device,groups,probes';
    }

    if(!data.onlysensors && !!node){
      $mytarget.append("<div><input id='mainobject' type='radio' name='"+(self.data.parametername||'id')+"' checked='checked' value='"+myid+"' class='hidden'><label for='mainobject' style='background-image:"+node.find('.jstree-icon').css('background-image')+";'>"+node.text()+"</label></div>");
    }

    // $mytarget.appendTo(this.$sensorload);

    $.each(filter, function(i,e){
      var content = ajax.content;
      $.ajax({
        type: "GET",
        url: myurl+e,
        data: ajax,
        dataType: "json"
      }).done(function(results){
        var dd = (results.hasOwnProperty('multiobj') ? 'multiobj':content);
        if(!!results[dd]){
          // data-ownid is set to false so we need to get it from dom again
          var ownid = $("[data-ownid]").first().attr('data-ownid');
          
          $.each(results[dd],function(){
            var elm = this;
            elm.mytitle = '';
            if (!!elm.group)
              elm.mytitle  += _Prtg.Lang.common.strings.Group+": "+elm.group;
            if (!!elm.device)
              elm.mytitle += " " + _Prtg.Lang.common.strings.Device+": "+elm.device;
            elm.mystyle='';
            switch (elm.basetype.toLowerCase())
            {
              case "group": elm.mystyle='background-image:url(' + elm.icon + ');';break;
              case "device": elm.mystyle='background-image:url(' + elm.icon + ');';break;
              case "probenode": elm.mystyle= 'background-image:url(' + elm.icon + ');';break;
              case "sensor": break;
              default: elm.mystyle='-';break;
            }
            elm.parametername = self.data.parametername||'id';
            if (!!searchstring && elm.mystyle=='-') return;
            if(!!elm.mystyle) elm.status =0;

            // The user should not be able to select the exact same sensor as dependency (no self dependency)
            if(!!!self.data.allowself) {
              elm.disabled = elm.objid.toString() === ownid;
            }
            $mytarget.append($.jqote(_Prtg.Core.objects.objectSelector.template, elm));
          });
        }
        self.$sensorload.removeClass("loading").find("input").eq(0).click();
        if (!!self.data.sensorid){
          if ($("#objectnode_"+myid).length>0)
            self.$element.scrollTo($("#objectnode_"+myid),1000, {axis:'y'});
          if (self.$sensorload.find("#radio"+self.data.sensorid).length>0){
            self.$sensorload.find("#radio"+self.data.sensorid).click();
            self.$sensorload.scrollTo($("#radio"+self.data.sensorid),2000,{offset:-50});
          }
        }
        self.data.sensorid=false;
      });
    });
  };

  $.fn[pluginName] = function(options, parent) {
    return this.each(function() {
      if (!$.data(this, "plugin_" + pluginName)) {
        $.data(this, "plugin_" + pluginName, new Plugin(this, options, parent));
      }
    });
  };
})(jQuery, window, document);
;
/* _Prtg.DateTimePicker.js */
(function($, window, document, undefined) {
  var pluginName = "prtg-datetimepicker";


  function Plugin(element, data, parent) {
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.resetable = this.$el.closest('.resetable');
    this.$picker = this.$el.clone();
    this.$picker.data('plugin_prtgDatetimepicker', this);
    this.$el.addClass("orginal_input");
    this.$picker.attr("name", this.$picker.attr("name") + "_picker").attr("id", "").addClass("initilizing").toggleClass('prtg-plugin');
    this.$parent = (!(parent instanceof jQuery)) ? $(parent) : parent;
    this.prtgdateFormat = "yy-mm-dd";
    this.timepicker = data.timepicker || false;
    this.formatStrings = this.splitDateTimeFormat(data.datetimeformat || _Prtg.Options.userDateTimeFormat ||"yy-mm-dd HH:mm");
    this.currentDateText = "";
    this.inline = data.inline;
    this.oldSelected = "";
    this.endpicker = data.endpicker;
    var self = this;

    if(self.endpicker !== "") {
      _Prtg.Events.subscribe('datetimpicker.initialized', function(e, plugin) {
        if(plugin.$el.is(self.endpicker)) {
          self.endpicker = plugin;
          // set startpicker id as data attribute on the corresponding endpicker
          self.endpicker.$picker.attr('data-startpicker', self.$picker.attr("id"))
          self.setMinDate();

          var currentDate = self.getCurrentSelectedDate();
          var currentEndDate = self.endpicker.getCurrentSelectedDate();
          if(currentDate >= currentEndDate) {
            currentEndDate.addMinutes(1);
            self.endpicker.setCurrentSelectedDateTime(currentEndDate);
          }
        }
      });
    }

    this.settings = {
      dateFormat: self.formatStrings['date'],
      timeFormat: self.formatStrings['time'],
      showOn: "both",
      minDate: data.mindate || "-10y",
      buttonImage: "",
      buttonImageOnly: false,
      buttonText:_Prtg.Lang.common.strings['choose'],
      firstDay: 1,
      onSelect: function(dateText, inst) {
        self.dateToOwnFormat(dateText);
        self.currentDateText = dateText;
      },
      onClose: function(dateText, inst) {
        self.dateToOwnFormat(dateText);
        if(self.oldSelected != self.$el.val()) {
           _Prtg.Events.publish('datetimpicker.change', self);
           if(!self.timepicker) self.$el.trigger("change");
        }
        _Prtg.Events.resume();
        self.setMinDate();
      },
      beforeShow: function(elm, inst) {
        self.oldSelected = self.$el.val();
        _Prtg.Events.pause();
      },
      onChangeMonthYear: function() {
        $('body div.tooltip').remove();
      }
    };
    this.init();
  }

  Plugin.prototype.init = function() {
    var self = this;
    var initialValue = self.$picker.val();
    var initial;
    self.$el.after(self.$picker).hide();


    if (initialValue !== "") {
      var timeArr = initialValue.split(",");
      if(timeArr.length > 3 && self.timepicker) {
        initial = new Date(timeArr[0], timeArr[1]-1, timeArr[2], timeArr[3], timeArr[4]);
        initialValue = $.datepicker.formatDate(self.formatStrings['date'], initial);
        initialValue = initialValue + ' ' + $.datepicker.formatTime(self.formatStrings['time'], {hour: timeArr[3], minute: timeArr[4]});
      } else if(timeArr.length > 2) {
        initial = new Date(timeArr[0], timeArr[1]-1, timeArr[2]);
        initialValue = $.datepicker.formatDate(self.formatStrings['date'], initial);
      } else {
        initial = new Date(Date.now());
        initialValue = $.datepicker.formatDate(self.formatStrings['date'], initial);
      }

      self.$picker.val(initialValue);
    }

    if (self.timepicker) {
      self.$picker.datetimepicker(self.settings);
    } else {
      self.$picker.datepicker(self.settings);
    }

    if (initial instanceof Date) {
      self.settings.defaultDate = initial;
      self.dateToOwnFormat();
    }


    self.currentDateText = self.$picker.val();
    self.$picker.removeClass("initilizing");
    _Prtg.Events.publish('datetimpicker.initialized', self);

    if(!!self.resetable.length) {
      if(!self.resetable.data('picker'))
        self.resetable.data('picker', []);

      self.resetable
        .off('click.datepickerclose')
        .on('click.datepickerclose','i.icon-close',function(){
            var pickers = self.resetable.data('picker')
              , target = $(this).data().target;
            pickers.forEach(function(picker) {
              if(!!target) {
                (target.indexOf(picker.$el.attr('id'))>-1) && (picker.clear.call(picker), _Prtg.Events.publish('datetimpicker.change', [picker,'reset']));
              } else {
                picker.clear.call(picker);
              }
            });
            if(!target)
              _Prtg.Events.publish('datetimpicker.change', [self,'reset']);
          })
        .data().picker.push(self);
      }

  };

  Plugin.prototype.formatDate = function(dateToFormat) {
    var addLeadingZero = function(val) {
      if(typeof val === "string") {
        val = parseInt(val);
      }
      return val > 9 ? '' + val : '0' + val;
    }
    var date = new Date(dateToFormat)
    var year = date.getFullYear();
    var month = addLeadingZero(date.getMonth() + 1);
    var day = addLeadingZero(date.getDate());
    var hours = addLeadingZero(date.getHours());
    var minutes = addLeadingZero(date.getMinutes());
    return year + '-' + month + '-' + day + ' ' + hours + ':' + minutes;
  }

  Plugin.prototype.dateToOwnFormat = function(newDate) {
    var self = this;
    var dateText = newDate ? newDate : self.$picker.val();
    var selectedDate = $.datepicker.formatDate(this.prtgdateFormat, $.datepicker.parseDate(this.formatStrings['date'], dateText.split(" ")[0]));
    var selectedTime;
    if(dateText.split(" ")[1]) {
      dateText = dateText.split(" ");
      dateText.shift();
      dateText = dateText.join(" ");
      selectedTime = $.datepicker.formatTime("HH-mm-ss", $.datepicker.parseTime(this.formatStrings['time'], dateText));
    } else {
      selectedTime = "00-00-00";
    }
    this.$el.val(selectedDate + '-' + selectedTime).attr("value", selectedDate + '-' + selectedTime);
  };

  Plugin.prototype.clear = function() {
    this.$picker.val('');
    this.$picker.text('');
    this.$el.val('');
  };

  Plugin.prototype.splitDateTimeFormat = function(dateTimeString) {
    var formatString = {};

    dateTimeString = dateTimeString.split(" ");
    formatString["time"] = dateTimeString[1];
    if(dateTimeString[2]) {
      formatString["time"] = formatString["time"] + ' ' + dateTimeString[2];
    }
    formatString["date"] = dateTimeString[0];
    return formatString;
  };

  Plugin.prototype.setMinDate = function() {
    var self = this;
    return; // we need to discuss the need of this function in one of the later tickets
    if(self.endpicker === undefined) {
      return
    }
    var currentDate = self.getCurrentSelectedDate();
    var startpickerDateTime = currentDate.getTime();
    var endpickerDateTime = self.endpicker.$picker.datetimepicker('getDate').getTime();
    if (self.timepicker) {
      currentDate.addMinutes(1);
      self.endpicker.$picker.datepicker("option", "minDate", currentDate);
      self.endpicker.$picker.datetimepicker("option", "minDateTime", currentDate);
      // updates the dom by setting the new date
      self.endpicker.settings.onSelect(self.formatDate(currentDate));
      self.endpicker.$picker.datetimepicker("setDate", currentDate);
    } else {
      currentDate.addDays(1);
      self.endpicker.$picker.datepicker("option", "minDate", currentDate);
    }
  };

  Plugin.prototype.getCurrentSelectedDate = function() {
    if (this.timepicker) {
      return this.$picker.datetimepicker("getDate");
    } else {
      return this.$picker.datepicker("getDate");
    }
  };

  Plugin.prototype.dateToString = function(dateString) {
    if(!dateString) return dateString;
    if(!this.timepicker) {
      return $.datepicker.formatDate(this.prtgdateFormat, dateString) + '-' + "00-00-00";
    } else {
      return $.datepicker.formatDate(this.prtgdateFormat, dateString) + '-' + $.datepicker.formatTime("HH-mm-ss", $.datepicker.parseTime(this.formatStrings['time'], this.currentDateText.split(" ")[1]));
    }
  };

  Plugin.prototype.setCurrentSelectedDate = function(newDate) {
    // TODO: refactor like setCurrentSelectedDateTime!
    this.$el.val($.datepicker.formatDate(this.prtgdateFormat, newDate) + this.$el.val().slice(10));
    this.$picker.val($.datepicker.formatDate(this.settings.dateFormat, newDate) + this.$picker.val().slice(10));
    this.highLight();

  };

  Plugin.prototype.setCurrentSelectedDateTime = function(newDate, noHighLight) {
    var self = this;
    if (this.timepicker) {
      this.$picker.datetimepicker("setDate", newDate);
    } else {
      this.$picker.datepicker("setDate", newDate);
    }
    this.settings.onSelect(self.$picker.val());
    if(noHighLight === false) {
      this.highLight();
    }
    self.setMinDate();
  };

  Plugin.prototype.highLight = function() {
    this.$picker.css("border-color", "#EC0E68");
    this.$picker.stop().animate({
      borderTopColor: '#fff',
      borderLeftColor: '#fff',
      borderRightColor: '#fff',
      borderBottomColor: '#fff'
    }, 1000);
  };

  $.fn[pluginName] = function(data, parent) {
    return this.each(function() {
      if (!$.data(this, 'plugin_' + pluginName)) {
        $.data(this, 'plugin_' + pluginName, new Plugin(this, data, parent));
      }
    });
  };

})(jQuery, window, document);
;
//_Prtg.MultiEdit.Plugin.js
(function($, window, document, undefined) {
		var pluginName = 'multiedit';

  function Plugin(element, data, parent) {
    this.element = $(element);
    this.data = data;
    this.parent = parent;
    this.inline = (this.element.closest('.multieditscrollcontainer').length>0);
    if(this.element.find('.control-activation').length) {
      this.element
        .find('.control-group .controls')
        .find('input,select,textarea,label').not().attr('disabled','disabled');
    }
    data.inline = this.inline;
    this.element['prtg-form'](data,parent);
    this.init(this);
  }

  Plugin.prototype.init = function(me) {

    me.element
      .on('change.' + pluginName,'input.multieditactivecheckbox', function() {
        var $self = $(this);
        if($self.is(':checked'))
          $self.nextAll('.controls').first().find('input,select,textarea,label').removeAttr('disabled');
        else
          $self.nextAll('.controls').first().find('input,select,textarea,label').attr('disabled','disabled');
      })
      .on('destroyed', function() {
        if(me.$scrollable) me.$scrollable.off('.inline');
        $(window).off('.' + pluginName);
        $(document).off('.' + pluginName);
        me.element.off('.' + pluginName);
      });

    if(this.element.closest('.editsettings.inline').length > 0){
      me.element.find('[data-placement="right"]').attr('data-placement','left');
    }
    if(me.inline)
      me.element.addClass('inlinescroll')
    // if(me.inline) {
    //   var box = $('.submitbuttonbox').removeClass('float');
    //   me.$scrollable = $('#layout.fullsize').length ? $(window) : $('.multieditscrollcontainer .inline');
    //   var minus = (me.$scrollable.is('.inline') ? box.offsetParent().offset().top-box.offsetParent().offsetParent().offset().top-25: me.element.closest('.inline').offset().top);
    //   me.$scrollable.on('scroll.inline', function(){
    //     if($('.submitbuttonboxanchor').length === 0) return;
    //     var plus = $(this).height() - $('.submitbuttonbox').height();
    //     if($('.submitbuttonboxanchor').position().top >  $(this).scrollTop() + plus - minus)
    //       $('.submitbuttonbox').css({'position':'absolute','top':$(this).scrollTop() + plus - minus});
    //     else
    //       $('.submitbuttonbox').css('position', 'static');
    //   }).triggerHandler('scroll.inline');
    // }
  };

  $.fn[pluginName] = function(options, parent) {
    return this.each(function() {
      if(!$.data(this, "plugin_" + pluginName)) {
        $.data(this, "plugin_" + pluginName, new Plugin(this, options, parent));
      }
    });
  };
})(jQuery, window, document);
;
// _Prtg.Channels.Plugin.js
(function($, window, document, undefined) {
  var pluginName = 'channels';

  function Plugin(element, data, parent) {
    this.element = $(element);
    this.data = data;
    this.parent = $(parent);
    // initialize form plugin first
    if (!this.data.singleedit) this.element['prtg-form'](data,parent);

    this.container = this.parent.find(data.container);
    this.select = this.element.find('#channelsdropdown');
    this.channelkind = -999;
    this.channelval = 0;
    this.multiedit = 0;
    this.init(this);
  }

  Plugin.prototype.init = function(me) {
    if (me.data.singleedit) {
      me.select.val(me.data.channelid);
      me.select.on('change', function(e) {
        if (me.container.find('.prtg-form').hasClass('formchanged')) {
          _Prtg.Dialogs.confirmDialog(_Prtg.Lang.Dialogs.strings['savewarningtitle'], _Prtg.Lang.Dialogs.strings['savewarning'], _Prtg.Lang.common.strings['save'], _Prtg.Lang.common.strings['discardchanges']).done(function() {
            me.container.find('.prtg-form').addClass('dialogform').trigger('submit');
            me.loadContent(me);
          }).fail(function() {
            me.loadContent(me);
          });
        } else {
          me.loadContent(me);
        }
      });
    } else {
      me.select
        .on('click', function(e) {
          var selected = $(this).find(':selected').not(e.target)
            , $current = $(e.target)
            , val = $current.val()
            , chan = $current.attr('data-channel-kind');
          //IE hack
          e.preventDefault();
          if(typeOf(val) === "Array") {
            val = val[0];
            chan = $(this).find('option[value="'+val+'"]');
            selected = $(this).find(':selected').not(chan);
            chan = chan.attr('data-channel-kind');
          }
          val = parseInt(val, 10);
          if(e.shiftKey && val > 0){
            selected.prop("selected", false);
            me.select.find('[data-channel-kind="'+chan+'"]').not('[value^="-"]').prop('selected',true);
            me.channelkind = chan;
          }
          if(val < 0 || me.channelval < 0 || chan !== me.channelkind) {
            selected.prop("selected", false);
          }
          me.channelkind = chan;
          me.channelval = val;
          me.select.trigger("changed");
        })
        .on('changed',function() {
          var myurl="/controls/"+me.data.template
           , channels = $.map(me.select.serializeArray(), function(elm){return elm.value;});
          if(channels.length > 1 || (''+me.data.objectid).indexOf(',') > 0) {
            me.multiedit=1;
          } else {
            me.multiedit=0;
          }
            if( me.container.find('.loadspinner').length == 0){
                me.container.append('<div class="loadspinner"></div>')
            }
          me.container.addClass('loading').removeClass('prtg-form');
          $.ajax({
            url: myurl,
            data:{
              id: me.data.objectid,
              channel: channels,
              channelmultiedit: me.multiedit
            },
            type: "POST",
            dataType: "html"
          }).done(function(html,status) {
            me.container.removeClass("loading").html(html);
            _Prtg.initPlugins(me.container);
            if(me.multiedit === 1){
              me.element.closest('.ui-dialog').find('button.submit').off('mousedown.multiedit').on('mousedown.multiedit',function channelClick(e) {
                e.preventDefault();
                var o={}
                  , values = me.container.find('#channelsform').serializeArray();
                  channels.pop();
                  jQuery.each(values, function () {
                    if(this.name.indexOf('_')>-1 && !!parseInt(this.name.split('_')[1],10)) {
                      var n = this.name.split('_')
                        , v = this.value;
                      channels.forEach(function(value){
                        n[1] = value;
                        var name = n.join("_");
                        if(o[name] === undefined) {
                          o[name] = v || '';
                        }
                      });
                    }
                  });
                  $(this).trigger('click', o);
              });
            }
        });
      });
    }
  };

  Plugin.prototype.loadContent = function(me) {
      if( me.container.find('.loadspinner').length == 0){
          me.container.append('<div class="loadspinner"></div>')
      }
    me.container.addClass('loading');
        $.ajax({
          url: 'controls/' + me.data.template,
          data: {
            id: me.data.objectid,
            channel: me.select.val()
          },
          type: 'GET',
          dataType: 'html'
        }).done(function(response) {
          me.container.removeClass('loading');
          me.container.html(response);
          _Prtg.initPlugins(me.container);
        });
  };
  _Prtg.Plugins.registerPlugin(pluginName, Plugin);
})(jQuery, window, document);
;
/* _Prtg.DateTimeQuickrange.js */
(function ($, window, document, undefined) {
  var pluginName = "prtg-datetimequickrange";

  function Plugin(element, data, parent) {
    this.data = data;
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.$parent = (!(parent instanceof jQuery)) ? $(parent) : parent;
    this.init(this);
  }

  Plugin.prototype.init = function (me) {
    me.$el.on("click", "a", {
      self: me
    }, me.quickrangeHandler);
  };
  
  Plugin.prototype.quickrangeHandler = function (e) {
  
    if (!$(this).hasClass("reloadtablelink")) e.preventDefault();
    // The range consist of 2 separate values. 
      // At position 0 there should be a number
      // At position 1 there should be a valid range modifier ("h", "d", "m," "a")
    var self = e.data.self,
      $this = $(this),
      range = $(this).attr("range"),
      rangeModifier = range.charAt(range.length - 1),
      startDate = new Date(),
      endDate = new Date(),
      setTime = function (dateObj, hours, minutes, seconds) {
      dateObj.setHours(hours);
      dateObj.setMinutes(minutes);
      dateObj.setSeconds(seconds);
    };

    range = range.substr(0, range.length - 1);
    switch(rangeModifier) {
    case "h":
      startDate.addHours(-range);
      break;
    case "d":
      setTime(startDate, 0, 0, 0);
      startDate.addDays(-range);
      setTime(endDate, 0, 0, 0);
      endDate.addDays(1)
      break;
    case "m":
      setTime(startDate, 0, 0, 0);
      startDate.addMonth(-range);
      setTime(endDate, 0, 0, 0);
      endDate.addDays(1)
      break;
    case "a":    
      setTime(startDate, 0, 0, 0);
      startDate.addDays(-range);
      setTime(endDate, 0, 0, 0);
      endDate.addDays(-(range-1));
      break;
    case "l":
      startDate.setDate(1);
      setTime(startDate, 0, 0, 0);
      endDate = new Date(startDate.getTime());
      startDate.addMonth(-(parseInt(range, 10)));
      break;
    case "w":
      var weekbegin = parseInt(range, 10) === 0 ? 1 : 0;

      startDate.addDays(-(startDate.getDay() + 1));
      while(startDate.getDay() > weekbegin) {
        startDate.addDays(-1);
      }
      setTime(startDate, 0, 0, 0);
      endDate = new Date(startDate.getTime());
      endDate.addDays(7);
      setTime(endDate, 0, 0, 0);
      break;
    }

    if(self.data.mode != 'inline') {
      var startpicker = $("#" + self.data.sfield).data('plugin_prtgDatetimepicker');
      var endpicker = $("#" + self.data.endfield).data('plugin_prtgDatetimepicker');
      startpicker.setCurrentSelectedDateTime(startDate);
      endpicker.setCurrentSelectedDateTime(endDate);
    } else {
      $('.datetimepicker[for="'+ self.data.sfield +'"]').datetimepicker('setDate', startDate);
      $('.datetimepicker[for="'+ self.data.endfield +'"]').datetimepicker('setDate', endDate);
      $('.ui-datepicker-current-day').click();
    }
    self.$el.trigger("change");
    if (!$(this).hasClass("reloadtablelink")) return false;
  };

  _Prtg.Plugins.registerPlugin(pluginName, Plugin);

})(jQuery, window, document);
;
//_Prtg.AutodiscoveryForm.Plugin.js
(function($, window, document, undefined) {
	var pluginName = 'autodiscovery-form';

	function Plugin(element, data, parent) {
		this.$elm = $(element);
		this.init(this.$elm,data);
	}

	Plugin.prototype.init = function(me, data) {

		me.find('label[for="discoverytype0"]').hide();
		if(data.type === 'template') {
		  if(data.object === 'device') {
		    var dtsb=me.find('.dataTables_scrollBody').first();
			var uidc=dtsb.parents('.ui-dialog-content').first();
			if(uidc.length && dtsb.length) dtsb.css('height',uidc.height()-165);
		  }
		  me.find('#discoverytype2').prop("checked", true).trigger('click');
	    }	else {
	      me.find('#discoverytype1').prop("checked", true).trigger('click');
	    }
	};

	$.fn[pluginName] = function(options, parent) {
		return this.each(function() {
			if (!$.data(this, "plugin_" + pluginName)) {
				$.data(this, "plugin_" + pluginName, new Plugin(this, options, parent));
			}
		});
	};
})(jQuery, window, document);
;
//_Prtg.ObjectLookup.Plugin.js
(function($, window, document, undefined) {
  var pluginName = "object-lookup";

  function ObjectLookup(element, data, parent) {
    this.data = data;
    this.$el = $(element);
    this.$parent = $(parent);
    this.resetable = this.$el.is(".resetable");
    this.init(this);
  }

  ObjectLookup.prototype.init = function(self) {
    var data = self.data;
    var myurl =
      data.selid !== null
        ? "/controls/objectlookupnew.htm"
        : data.emptyinfo || "/controls/objectlookupnewempty.htm";
    var para = { domid: $.now() };

    $.extend(true, para, data);

    if (data.selid !== null) {
      para["id"] = data.selid;
      self.$el.addClass("loading");

      if (self.$el.find(".loadspinner").length == 0) {
        self.$el.append('<div class="loadspinner"></div>');
      }
    }
    self.$el.attr("id", "div" + para.domid);

    $.ajax({
      url: myurl,
      data: para,
      type: "GET",
      beforeSend: function(jqXHR, settings) {
        jqXHR.peNumber = "PE1018";
      }
    }).done(function success(html) {
      self.$el
        .html(
          html.replace(/&nbsp;&raquo;&nbsp;/g, '<div class="treeellipsis" />')
        )
        .removeClass("loading");
      if (data.validate) self.$el.find("input").addClass("validateme");

      if (data.required === "required") {
        self.$el.find("input").valid();
      }

      if (self.$el.find(".objectlookup.clusterobject").length) {
        self.$parent.find(".clustertreeobject").show();
      } else {
        self.$parent.find(".clustertreeobject").hide();
      }
      self.$el.triggerHandler("loaded");
      self.$el.off("click").on("click", function() {
        self
          .selectObject(self.$el.find("input:first"), para, self)
          .done(function(result) {
            if (!!self.$el.data("filtername")) {
              self.$el.trigger("changed", {
                filters: [
                  {
                    name: self.$el.data("filtername"),
                    value: "" + (result.id || null)
                  },
                  { name: "start", value: "0" }
                ]
              });
            } else {
              self.$el.triggerHandler("changed", result);
            }
          });
        return false;
      });
      if (self.resetable) {
        self.$el.find("i.resetable").addClass("icon-close");
        self.$el.on("click", "i.resetable", function(e) {
          e.stopImmediatePropagation();
          self.data.selid = null;
          self.init(self);
          self.$el.trigger("changed", {
            filters: [
              { name: self.$el.data("filtername"), value: null },
              { name: "start", value: "0" }
            ]
          });
        });
      }
    });
  };

  ObjectLookup.prototype.selectObject = function selectObject(
    $input,
    data,
    me
  ) {
    var myurl =
      "/controls/objectselectorform" +
      (!!data.hidesensors ? "nosensors" : "") +
      ".htm";
    var self = this;

    return _Prtg.Dialogs.defaultDialog(myurl, data, {})
      .done(function(result, action) {
        if (!self.$el.data("filtername") && self.data.selid !== result.id)
          self.$el.trigger("change");
        self.data.selid = result.id === undefined ? null : result.id;
        self.init(self);
      })
      .fail(function() {});
  };

  $.fn[pluginName] = function(options, parent) {
    return this.each(function() {
      if (!$.data(this, "plugin_" + pluginName)) {
        $.data(
          this,
          "plugin_" + pluginName,
          new ObjectLookup(this, options, parent)
        );
      }
    });
  };
})(jQuery, window, document);
;
// _Prtg.Comparison.Plugin.js

(function($, window, document, undefined) {
	var pluginName = "comparison";

	function Comparison(element, data, parent) {
			this.data = data;
			this.$element = $(element);
			this.parent = parent;
			this.$parent = $(parent);
			this.timer = this.$parent.Events();
			this.init(this);
	}

	Comparison.prototype.init = function(me) {
		me.result = {id: me.data.selid};
    var baseURI = me.$element.context.baseURI;
    var count, show, connectedIdWithParameter, ids;
    var existsShowInUrl=false, existsIdsInUrl=false, existsCountInUrl=false, existsGraphidInUrl=false;
    if(!!baseURI){
      show = _Prtg.Util.getUrlParameters(baseURI)["sh0w"];
      ids = _Prtg.Util.getUrlParameters(baseURI)["ids"];
      count = _Prtg.Util.getUrlParameters(baseURI)["count"];
      if(baseURI.indexOf("graphid") > -1)
        existsGraphidInUrl = true;
    }
    show = !!show ? show.split(',') : null;
    ids = !!ids ? ids.split(',') : null;
    if(!!show && !!ids){
      existsShowInUrl = true;
      existsIdsInUrl = true;

      connectedIdWithParameter = new Array();
      connectedIdWithParameter[ids[0]] = show[0];
      connectedIdWithParameter[ids[1]] = show[1];
    }
    if(count !== undefined)
      existsCountInUrl = true;
		$.extend(true, me.result, me.data);
    me.objectlookup = me.$element['object-lookup'](me.result,me.$parent[0]);
		me.$contentload = me.$parent.find(me.data.contentload);

    me.$contentload.on('click', '.centeredHint, .selectNewSensor', function(e) {
      me.objectlookup.triggerHandler('click');
      e.stopPropagation();
      e.preventDefault();
    });

		me.$graphid = me.$parent.find('input:radio.graphid').on('click', function(){
			me.$element.triggerHandler('changed', me.result);
		});

    if(existsCountInUrl) {
      me.$element.on('changed', function(e,r){
        if(r.hasOwnProperty('id'))
        {
          me.result = {
            id: r.id<0?0:r.id,
            graphid: me.$graphid.filter(':checked').val(),
            isinitialized: r.id>0
          };
        }
        me.refresh();
      }).triggerHandler('changed', me.result);
    }
    else {
      if(existsGraphidInUrl) {
        me.$element.on('changed', function(e,r){
          if(r.hasOwnProperty('id'))
          {
            me.result = {
              id: r.id<0?0:r.id,
              graphid: me.$graphid.filter(':checked').val(),
              isinitialized: r.id>0
            };
          }
          me.refresh();
        }).triggerHandler('changed', me.result);
      }
      else {
        me.$element.on('changed', function(e,r){
          if(r.hasOwnProperty('id'))
          {
            me.result = {
              id: r.id<0?0:r.id,
              graphid: me.$graphid.filter(':checked').val(),
              isinitialized: r.id>0,
              sh0w: !!connectedIdWithParameter ? connectedIdWithParameter[r.id] : undefined
            };
          }
          me.refresh();
        }).triggerHandler('changed', me.result);
      }
    }

		this.timer.subscribe('refresh.events.prtg',$.proxy(this.refresh, this));
		this.timer.subscribeOnce('navigate.prtg', $.proxy(function(e){
			this.timer.unsubscribe('refresh.events.prtg',$.proxy(this.refresh, this));
		}, this));
	};

	Comparison.prototype.refresh = function(){
		var me = this;
		this.result.multi = me.$element.parents('#content').hasClass('multi-compare');
		this.$contentload
		.empty()
		.addClass('load');
		$.ajax({
			url: '/controls/compareobject'+(this.result.multi?'.multi':'')+'.htm',
			data: this.result,
			timeout: 10000,
			beforeSend: function(jqXHR){
				jqXHR.peNumber = 'PE1132';
			}
		}).done(function(html){
			var elm = me.$contentload.removeClass('load').html(html);
			if(me.result.isinitialized) elm.closest('.no-data').removeClass('no-data');
			_Prtg.initPlugins(me.$contentload[0]);
		});
	};

	$.fn[pluginName] = function(options, parent) {
		return this.each(function() {
			if (!$.data(this, "plugin_" + pluginName)) {
				$.data(this, "plugin_" + pluginName, new Comparison(this, options, parent));
			}
		});
	};
})(jQuery, window, document);

// _Prtg.MultiComparison.Plugin.js
//
(function($, window, document, undefined) {
	var pluginName = "comparison-multi";

	function MultiComparison(element, data, parent) {
			this.data = data;
			this.$element = $(element);
			this.$parent = $(parent);
			this.init(this);
	}

	MultiComparison.prototype.init = function(me) {
		var ids= _Prtg.Util.getUrlVars()['ids']
			, count =  parseInt(_Prtg.Util.getUrlVars()['count'], 10)
			, $cp = me.$element.find('#compareobjects');

		ids = !!ids ? ids.split(',') : [];
		if( count > ids.length)
			ids.length = count;
		else
			count = ids.length;

		me.$element.on('click', '#popout', function(){
			ids = me.$element.find('.comparison-object input')
			.map(function(){var val = $(this).val(); return val<0?undefined:val;}).get().join(',');
			window.open('/compares.htm?graphid='+me.$element.find('input:radio:checked').val()+'&ids='+ids);
		});

		if(!!ids){
			me.$element.find('#comparecount').val(ids.length);
			//if(ids.length>3) me.$element.addClass('multi-compare');
			$.ajax({
				url: '/controls/compareobjecteditajax.htm',
				data:{
					id: '{objectid}',
					counter: '{counter}',
					isinitialized: '{initialized}'
				},
				beforeSend: function(jqXHR) {
					jqXHR.peNumber = 'PE1131';
				}
			}).done(function(htm){
				for(var i=me.$element.find('.comparison-object').length; i < ids.length; ++i){
					el = htm.printf({objectid:(ids[i]||0), counter:i+1, initialized: ''+!!ids[i]});
					$cp.append(el);
				}
				_Prtg.initPlugins($('#main')[0]);
			});
		}
	};

	$.fn[pluginName] = function(options, parent) {
		return this.each(function() {
			if (!$.data(this, "plugin_" + pluginName)) {
				$.data(this, "plugin_" + pluginName, new MultiComparison(this, options, parent));
			}
		});
	};
})(jQuery, window, document);
;
/*
/   _Prtg.RootTree.RootTree.js
*/
(function ( $, window, document, undefined ) {
	var pluginName = "roottree"
		, BasePlugin = null;

	function RootTree( element, data, parent ) {
		this.element = element;
		this.options = data;
		this.data = data;
		this.parent = parent;

		this.$sensorTree = $(element)
		this.$parent = this.$sensorTree.parent();
		this.grid = null;
		this.$treeblocker = this.$sensorTree.find('#treeblocker');
		this.$editSettings = $('.editsettings');
		this.$dropTreeAdorner = $('<div id="treeAdorner" />');
		this.editable = this.$sensorTree.parent().is('.treeiseditable');
		this.fullSize = !(this.data.noFullSize || this.options.objects['sensorxref'][0].totalsens > _Prtg.Core.objects.maxSensorFullSize);
		this.layout = null;
		this.selectorArray = [];

		this.$sensorTree.attr('data-objects',null);

		this.isNotRefreshable = false || this.data.isNotRefreshable
		this.dragging = false;

		this.init(this);

	};

	RootTree.prototype.refresh = function refreshObjectTree(){
		if(this.isNotRefreshable
		|| this.$sensorTree.find('.selected').length
		|| this.dragging)
			return;
		this.$sensorTree.sensortree('refresh');
	};

	RootTree.prototype.resize =  function (setHeight, offsetTop, footer, buttons){
    footer = !!footer && footer.length > 0 ? footer[0] : false;
    if(setHeight)
      this.$sensorTree.height(
        (window.innerHeight
          - offsetTop
          - (footer ? footer.offsetHeight : 0)
          - (buttons ? buttons.offsetHeight : 0)
          -23
        )
      );
    else
      this.$sensorTree.height('auto');
    this.$sensorTree.trigger('resize.objecttree');
  };

	RootTree.prototype.init = function(me){
		var self = me
			, postDataLoadRequestLib = null
			, postDataLoadTimerLib = null
			, $layouts = !!me.data.layout ? $(me.data.layout) : me.$sensorTree.closest("#layout")
			, rootopts = $.extend(true,{}, _Prtg.Core.objects['library'], {
				treetype: 'sensorxref',
				gridOptions: {
						headerHeight: 0,
						showTopPanel: true,
						topPanelHeight: 31,
						showHeaderRow: false,
						headerRowHeight: 18
				},
				columns: [
					{
						id: 'content',
						name: _Prtg.Lang.sensorTree.strings.ColumnHeaderLibrary,
						formatter: function (row, cell, value, columnDef, dataContext) {
							if(!!dataContext.basetype)
								return $.jqote(_Prtg.Core.getObject(dataContext.basetype.toLowerCase()).template, dataContext);
							else
								return $.jqote(_Prtg.Core.getObject('library').template, dataContext);

						},
						width: 300,
						minWidth: 150,
						cssClass: 'treeColumn'
					},
					{
						id: 'leafs',
						name: _Prtg.Lang.sensorTree.strings.ColumnHeaderSensors,
							formatter: function (row, cell, value, colDef, data) {
								var content = '<div class="sensorItem cell-inner c1 ' + data._classes.join(' ').trim() + '"' + ' type="' + data.basetype + '" objid="' + data.objid + '" idx="' + data._idx + '" path="' + data._id + '"><span></span></div>';
								if(/device/.test(data.basetype) === true && data.totalsens > 0){
									if (data._collapsed || !colDef.layout)
										content = $.jqote(_Prtg.Core.getObject('sensor').deviceCollapsed.template, data);
									else
										content = $.jqote(_Prtg.Core.getObject('sensor').template, data);
								} else { //if(/filter|node|library/.test(data.basetype) === true){
									if(data._collapsed)// && /sensorTree|node/.test(data.libkind) === true)
										content = $.jqote(_Prtg.Core.getObject('sensor').groupCollapsed.template, data);
									else
										content = $.jqote(_Prtg.Core.getObject('sensor').template, data);
								}
								return content;
						},
						asyncPostRender: function (cellNode, row, dx, colDef) {
							var content="";
								if (!!dx) {
									if (!!dx.leafs) {
										if (dx._collapsed || !colDef.layout)
											content = $.jqote(_Prtg.Core.getObject('sensor').deviceCollapsed.template, dx);
										else
											content = $.jqote(_Prtg.Core.getObject('sensor').template, dx);
									} else if (dx._collapsed || !colDef.layout){
											content = $.jqote(_Prtg.Core.getObject('sensor').groupCollapsed.template, dx);
									}
								}
								return content;
						},
						rerenderOnResize: true,
						width: '*',
						minWidth: 370,
						cssClass: 'valueColumn'
					}
				],
				postDataLoad: function postDataLoadLibrary(grid, from, to, dataContext, rows, idxByObjId, eventHelper, direction) {
					var loaderrors=false,
            opts = $.extend(true,{},_Prtg.Core.objects['sensor']),
						preload =_Prtg.Core.objects.deviceCache,
						dfd = $.Deferred(),
						transpose = {},
						ready = {},
						load = [],
						settings = {
							type: opts.type || 'GET',
							dataType: opts.dataType || 'text json',
							url: opts.url,
							data: opts.data,
							traditional: opts.traditional || false,
							cache: opts.cache || false,
							success: function libSensorLoadSuccess(ret) {
								var d = ret[opts.data.content],
									to = d.length,
									node = null,
									i=0,l=0,
									pid=0,
									idx,
									now = $.now();
								postDataLoadRequestLib = null;
								for (i = 0; i < to; i++) {
									node = d[i].probegroupdevice.slice(0);
									node.pop();
									node = node.pop();
									$.each(transpose[node],function(j,node){
										if (!!node){
											if(!!node._updateLeafs) {
												node.leafs = [];
												node._updateLeafs = false;
											}
											!!node.leafs && node.leafs.push(d[i]);
										}
									});
								}
								eventHelper.notify(ready, null, grid);
								dfd.resolve();
							},
							error: function libSensorloadError(jqXHR, textStatus, errorThrown) {
								postDataLoadRequestLib = null;
								dfd.reject();
							}
						};
					if(!!postDataLoadTimerLib){
						clearTimeout(postDataLoadTimerLib);
						postDataLoadTimerLib = null;
					}

					if(!!postDataLoadRequestLib && postDataLoadRequestLib.readyState < 4){
						postDataLoadRequestLib.abort();
						postDataLoadRequestLib = null;
					}

                    if(direction !== undefined) {
                        if (direction < 0){
                            from = from - preload > 0 ? from - preload : 0;
                        } else {
                            from = from - 5 > 0 ? from - 5 : 0;
                            to = to + preload < rows.length ? to + preload : rows.length - 1;
                        }
                    }

					for(var i=from; i <= to; ++i){
						var item = dataContext[rows[i]];
						if(!!item && item._updateLeafs){
							load.push(item.objid);
							if(!transpose.hasOwnProperty(item.objid))
								transpose[item.objid] = [];
							transpose[item.objid].push(item);
							ready[[item.objid,'-',i].join('')] = i;
						}else if(!!item && !!item._loaderrors)
                loaderrors = true;
					}
					if(load.length > 0){
						settings.data.filter_parentid = load;
						postDataLoadTimerLib = setTimeout(function(){
							postDataLoadTimerLib = null;
							postDataLoadRequestLib = $.ajax(settings)
						},10);
					} else {
						//eventHelper.notify(ready, null, grid);
						dfd.resolve();
					}
          if(!!_Prtg.Events && loaderrors){
            loaderrors = $.extend(true, {}, _Prtg.Core.objects['sensor']);
            loaderrors.data.filter_status=[5,13,14];
            loaderrors.data.count = '*';
            loaderrors.data.id=0;
						dfd.promise().then(function(){
	            $.ajax({
	              type: 'POST',
	              dataType: 'text json',
	              url: loaderrors.url,
	              data: loaderrors.data,
	              traditional: loaderrors.traditional || false,
	              cache: loaderrors.cache || false
	            }).done(function(res){
	              if(!!res && !!res.treesize){
	                var result = res.sensorxref;
	                for(var x=0, m=result.length; x < m; ++x){
	                  result[x]._probegroupdevice = result[x].probegroupdevice.slice(0);
	                  result[x]._probegroupdevice.pop();
	                  result[x]._probegroupdevice.pop();
	                  result[x]._probegroupdevice = result[x]._probegroupdevice.join('-');
	                }
	                !!_Prtg.Events && _Prtg.Events.publish('leafs.refreshed.prtg',res);
	                res = null;
	              }
	            });
            });
          }
					return dfd.promise();
				}
				})
			, dndPlugin = $(me.data.dndTarget).find(me.data.dndPlugin);

		if(!me.isNotRefreshable){
			me.$parent.Events().subscribe('refresh.events.prtg', $.proxy(me.refresh, me));
			me.$sensorTree.on('destroyed', function(){
				me.$parent.Events().unsubscribe('refresh.events.prtg', $.proxy(me.refresh, me));
				me.$parent.closest('.tab-container').css('height','');
			});
		}

    _Prtg.Events.subscribe('prtg.resize.layout',$.proxy(
      me.resize,
      me,
      !me.fullSize,
      me.$sensorTree.offset().top,
      document.getElementsByTagName('footer'),
      document.getElementById('sensortreelinks')
    ));
    if(!me.fullSize){
        me.resize(
          !me.fullSize,
          me.$sensorTree.offset().top,
          document.getElementsByTagName('footer'),
          document.getElementById('sensortreelinks')
        );
    }

		$.event.special.drop.targets=[];
		$.drop({ mode: 'mouse'});

		if(dndPlugin.length > 0){
			// dndPlugin.on('changed', function(e,d){me.updateData(d.data)});
			dndPlugin = dndPlugin.data();
		} else
			dndPlugin = null;

		if(!!dndPlugin)
			dndPlugin = dndPlugin['plugin_'+ dndPlugin.plugin.camelCase()];
		else
			dndPlugin = null;
		$(me.data.dndTarget).on({
			'drop': function dropItem(e, d) {
				if(d.feedback !== false && !!dndPlugin){
					if(dndPlugin.drop){
						dndPlugin.drop.apply(dndPlugin,[e,d]);
					}else
						dndPlugin
							.add(d.hasOwnProperty('sensorIdx') ? d.data.leafs[d.sensorIdx].objid : d.data.objid,e,d)
							// .always(function(data){
							// 	if(data)
							// 		me.updateData.call(data);
							// });
				}
        me.$sensorTree.data('sensortree').grid.onDragEnd.notify(d,e);
			},
			'dropstart': function dropStartItem(e, d) {
				me.$dropTreeAdorner.removeClass().remove();
				if(!!dndPlugin && dndPlugin.dropstart)
						return dndPlugin.dropstart.apply(dndPlugin,[e,d]);
				else {
					d.feedback = 'copy';
					return true;
				}
			},
			'dropend ': function dropEndItem(e, d) {
				if(!!dndPlugin && !!dndPlugin.dropend)
					dndPlugin.dropend.apply(dndPlugin,[e,d]);
				me.$sensorTree.find('.selected').removeClass('selected');
				$(me.data.dndTarget).removeClass('cursor-copy cursor-move cursor-progress cursor-notallowed cursor-none')
        this.dragging = false;
        return true;
			}
		}, me.data.dndElements,me);

		if(!!me.data.libs){
			me.libraryData = _Prtg.Plugins['libdata'].init.apply(me.element,[me.options, me.parent]);
			me.data.libs.library.unshift ({
				access: ""
				,basetype: "group"
				,condition: ""
				,devicenum: 0
				,downacksens: 0
				,downsens: 0
				,favorite: ""
				,fold: true
				,groupnum: 0
				,icon: ""
				,info: ""
				,libkind: "libraries-root"
				,liblinkedid: 0
				,message: ""
				,name: "Libraries"
				,objid: -6
				,partialdownsens: 0
				,pausedsens: 0
				,priority: 3
				,probegroupdevice: [-6]
				,status: 0
				,totalsens: 0
				,undefinedsens: 0
				,unusualsens: 0
				,upsens: 0
				,warnsens: 0
			});
			me.libraryData.initLibraryData(me.data.libs.library, false);
			// me.data.libs.library[0].libkind =  "libraries";
			me.$sensorTree.removeAttr('data-libs');
			me.data.objects.sensorxref = me.data.objects.sensorxref.concat(me.data.libs.library);
		}

		$.when(
			me.$sensorTree.sensortree($.extend(true, rootopts, {
				initLibraryData: function(junk, name){return me.libraryData.initLibraryData(junk)},
				layout: me.data.viewType,
				data: {
					id: me.data.rootId,
					content: 'sensorxref'
				},
				editMode: false,
				gridOptions: {
					fullHeight: me.fullSize,
					showTopPanel: me.data.showTopPanel,
					borderBottomWidth: (!!me.data.borderBottomWidth ? me.data.borderBottomWidth:0)
				},
				timer: $(me.parent).Events(),
				displayMode: 'managed',//me.data.displayMode,
				controlsParent: me.data.controlsParent || '#loadedcontent',
				hideControls: !!me.data.hideControls,
				dragMode: true,
				noPopups: true,
				ignorFold: true
			}), me.data.objects)
			.parents('.loading')
			.removeClass('loading')
		).then(function(){
			// !!dndPlugin && me.updateData(dndPlugin.getData());
		});

		me.$sensorTree.sensortree('subscribe', 'onDragStart', function dragend(e, d) {
			me.dragging = true;
			e.stopImmediatePropagation();
		});
		me.$sensorTree.sensortree('subscribe', 'onDragEnd', function dragend(e, d) {
			me.$sensorTree.find('.selected').removeClass('selected');
			me.dragging = false;
			e.stopImmediatePropagation();
		});

		/* disabling DnD of already selected objects */
		// me.$sensorTree.data('sensortree').grid.onRefreshLeafs.subscribe(function(){
		// 	$.each(me.selectorArray, function(i,e){
		// 		me.$sensorTree.find(e).closest('.slick-row,sensor').removeClass('dragable').addClass('nondragable');
		// 	});
		// });
		// me.$sensorTree.data('sensortree').grid.onPostRender.subscribe(function(){
		// 	$.each(me.selectorArray, function(i,e){
		// 		me.$sensorTree.find(e).closest('.slick-row,sensor').removeClass('dragable').addClass('nondragable');
		// 	});
		// });

	};

	// RootTree.prototype.updateData = function updateData(data){
	// 	var me = this;
	// 	if(!data) return;
	// 	this.selectorArray = [];
	// 	data= $.map(data, function(e){
	// 		var selector = 'row '+ {
	// 			probe: 'div[path*="-'+e.objid+'-"], div[path*="-'+e.objid+'-"] sensor,div',
	// 			group: 'div[path*="-'+e.objid+'-"], div[path*="-'+e.objid+'-"] sensor,div' ,
	// 			device: 'div[objid="'+e.objid+'"]  sensor,div',
	// 			sensor: 'sensor'}[e.basetype]
	// 			+ '[objid="'+e.objid+'"]';
	// 			if(e.hasOwnProperty('purge')){
	// 				me.$sensorTree.find(selector).closest('.slick-row,sensor').addClass('dragable').removeClass('nondragable');
	// 				return null;
	// 			} else {
	// 				me.selectorArray.push(selector);
	// 				me.$sensorTree.find(selector).closest('.slick-row,sensor').addClass('nondragable').removeClass('dragable');
	// 				return e;
	// 			}
	// 	});
	// }


	$.fn[pluginName] = function ( options, parent ) {
		var me = this
			, elm = this;
		if(!!options){
			if(!!options.pluginTarget)
				me = $(options.pluginTarget);
			if(!!options.pluginFunction){
				return me.each(function(){
					$.data(this, "plugin_" + pluginName )[options.pluginFunction](elm, options);
				});
			}
		}
		return me.each(function () {
			if ( !$.data(this, "plugin_" + pluginName )) {
				$.data( this, "plugin_" + pluginName, new RootTree( this, options, parent ));
			}
		});
	};
})( jQuery, window, document );
;
(function($, window, document, undefined) {
  var pluginName = "sensorlistselect";
  function sensorlistselect(element, data, parent) {
    this.element = element;
    this.$element = $(element);
    this.$input = null;
    this.inputid = pluginName + $.now();
    this.data = data;
    this.init(this,pluginName + $.now());
  };

  sensorlistselect.prototype.init = function(me,inputid){
    me.$element.before('<input type="hidden" name="'+(me.data.inputname||'deselectedsensors')+'" id="'+inputid+'">');
    me.$input = $('#'+inputid);
    me.$element
      .on('click','a',function(e){
        e.preventDefault();
      })
      .on('click selected unselected',function(e){
        me.$input.val($.makeArray(me.$element.find('input[sensorid]:checked').map(function(){return $(this).attr('sensorid')})).join(','));
      });
  }

  _Prtg.Plugins.registerPlugin(pluginName, sensorlistselect);
})(jQuery, window, document);
;
// _Prtg.ContentList.Plugin.js
(function ($, window, document, undefined) {

    function contentList(element, data, parent) {
        this.data = data;
        this.$element = $(element);
        this.$parent = $(parent);

        this.init(this);
    }

    contentList.prototype.init = function (me) {
        createContentAncors(me.$element);
        _Prtg.Events.subscribe('refresh.events.prtg', this.refresh.bind(this, me));
    };

    contentList.prototype.refresh = function (me) {
        createContentAncors(me.$element);
    };


    function createContentAncors($elem) {
        var headlines = $elem.find('h1:visible, h2:visible, .js-contentList_add:visible').not('.main-headline'),
            contentList = $elem.find('.js-contentList') || {};

        contentList.html('');
        headlines.each(function (i, elem) {
            $(elem).attr('id', 'toc-index-' + i)
                   .attr('tabindex','-1');
            contentList.append('<li><a href="#' + $(elem).attr('id') + '">' + $(elem).text() + '</a></li>');
        });
    }


    _Prtg.Plugins.registerPlugin("content-list", contentList);

})(jQuery, window, document);
;
/* _Prtg.AutoUpdate.Plugin.js */
;
(function($, window, document, undefined) {
  var pluginName = 'autoupdate';

  function autoupdate(element, data, parent) {
    this.data = data;
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.initEvents();
    this.hadNoConnection = false;
    this.connectionInterval;
  }

  autoupdate.prototype.initEvents = function() {
    var self = this;
    self.updateRunning = false;
    this.$el
      .on("click", "#triggerdownloadupdate", function(e) {
        e.preventDefault();
        $("#results").load("/api/autoupdatedownload.htm");
        $("#install_p").hide();
        $("#download_p").hide();
        $("#download_loader").show();
        _Prtg.Events.stop('refresh');
      })
      .on("click", "#beforeinstallupdate", function(e) {
        e.preventDefault();
        $("#beforeinstall").dialog({
        	closeText: "",
          closeOnEscape: false,
          draggable: false,
          modal: true,
          resizable: false,
          height: 360,
          title: 'Important',
          width: 450,
          buttons: [
            {
              'html': 'Yes, install now',
              'class': "actionbutton",
              'click': function (e) {
                var $dlg = $(this);
                if (!self.updateRunning) {
                  self.updateRunning = true;
                  $(e.target).closest('button').addClass('btndisabled').css('pointer-events', 'none');
                  $dlg.find('.loading').show();
                  self.triggerinstallupdate()
                    .done(function () {
                      location.replace("/start.htm");
                    })
                    .fail(function (jqXHR) {
                      $dlg.find('.loading').hide()
                      $(e.target).closest('button').removeClass('btndisabled').css('pointer-events', 'all');
                      self.updateRunning = false;
                      $dlg.find('.validateerror').html(jqXHR.responseText);
                    });
                }
              }
            },
            {
              'html': 'No, do not install',
              'class': "button btngrey",
              'click': function (e) {
                $(this).dialog("destroy");
              }
            }
          ]
        });
      });
  };

  autoupdate.prototype.triggerinstallupdate = function() {
    return $.ajax({
      beforeSend: function(jqXHR) {
        jqXHR.ignoreError= true;
      },
      url: "/api/autoupdateinstall.htm",
    });
  };

  _Prtg.Plugins.registerPlugin(pluginName, autoupdate);
})(jQuery, window, document);

;
//_Prtg.objectoverview.plugin.js

(function($, window, document, undefined) {
  var pluginName = "channelgauges";

  function Plugin(element, data, parent) {
      this.data = data;
      this.element = element;
      this.$element = $(element);
      this.$parent = $(parent);
      this.template = data.type==='channels'
        ? _Prtg.Core.getObject('sensor').channelTemplates.gauge.template
        : _Prtg.Core.getObject('device').channelTemplates.gauge.template;
      this.ajaxdata = !!data.ajaxdata ? data.ajaxdata : data.type==='channels'
      ? $.extend(true,{},_Prtg.Core.getObject('sensor').channelTemplates.gauge.data)
      : $.extend(true,{},_Prtg.Core.getObject('device').channelTemplates.gauge.data);
      if(!!this.data.filterpriority)
        this.ajaxdata.filter_priority = this.data.filterpriority;
      if(!!this.data.filter)
        $.extend(this.ajaxdata,data.filter);
      this.ajaxdata.id = data.objectid;
      this.init(this);
      this.render(this);
      if(!!this.data.sortable)
        this.sortable = this.$element.sortable(data, parent, true)[0].refresh();
  }

  Plugin.prototype.refresh = function() {
    var me = this;
    if (this.data.mapobj == true) return;
    $.ajax({
      type: 'GET',
      url: '/api/table.json',
      data: me.ajaxdata,
      dataType: 'json',
      cached: false,
      traditional: true,
      beforeSend: function(jqXHR){
        jqXHR.peNumber = 'PE1125';
      }
    }).done(function(d){
      me.data.objects = d;
      me.render.call(me, me);
      !!me.sortable && me.sortable.refresh();
    });
  };

  Plugin.prototype.init = function(me) {
    if(me.$element.data.objects && !me.element.dataset.mapobj === 'true') {
      me.data.objects = me.$element.data.objects
    }

    if(!!me.data && ['cloudhttp','cloudping'].indexOf(me.data.sensortype)>-1){
       $('.responsiveobjectoverview_panelB')
       		.remove('#globe')
       		.prepend('<div id="globe" class="graphbox"><div class="prtg-plugin" data-plugin="prtg_globe" style="width:100%;margin-bottom:6px"/><div class="globetitle" /></div>');
       var globe = $('#globe', '.responsiveobjectoverview_panelB');
       globe.find('.prtg-plugin').data(me.data.objects[me.data.type]);
      _Prtg.initPlugins(globe);
    }

    if(!_Prtg.Events) return;

    _Prtg.Events.subscribe('refresh.events.prtg', $.proxy(me.refresh, me));
    me.$element
      .removeAttr('data-objects')
      .on('destroyed',function() {
        _Prtg.Events.unsubscribe('refresh.events.prtg', $.proxy(me.refresh, me));
      });
    if(!_Prtg.Options.userIsReadOnly) {
      me.$element
        .on('click','.channeledit, .channelsettings', function(e) {
          if($(this).hasClass('channeledit') || e.target.className.indexOf('editsetting') > -1) {
            _Prtg.objectTools.channelEditDialog(me.data.objectid, $(this).data().channel);
          } else if(e.target.className.indexOf('setprimarychannel') > -1) {
            me.data.primarychannel = $(this).data().channel;
            _Prtg.objectTools.primaryChannel.call(me.$element[0], me.data.objectid,$(this).data().channel);
          }
          e.stopImmediatePropagation();
        })
        .on('click','.toplistsettings', function(e) {
          if(e.target.className.indexOf('editsetting') > -1) {
            _Prtg.Dialogs.defaultDialog(
              "/controls/toplistedit.htm",
              $(this).data()
            ).done(function(result, action) {
              return $.ajax({
                url: action,
                type: "POST",
                data: result,
                beforeSend: function(jqXHR) {
                  jqXHR.peNumber = 'PE1121';
                }
              }).done(function(html) {
                _Prtg.objectTools.update.call(me.$element);
              });
            });
        } else if(e.target.className.indexOf('add') > -1) {
          _Prtg.Dialogs.defaultDialog(
            "/controls/toplistadd.htm",
            $(this).data()
            ).done(function(result, action) {
              return $.ajax({
                url: action,
                type: "POST",
                data: result,
                beforeSend: function(jqXHR) {
                  jqXHR.peNumber = 'PE1122';
                }
              }).done(function(html) {
                _Prtg.objectTools.update.call(me.$element);
              });
            });
        } else if(e.target.className.indexOf('delete') > -1) {
          _Prtg.Dialogs.defaultDialog(
            "/controls/toplistdelete.htm",
            $(this).data()
            ).done(function(result, action) {
              return $.ajax({
                url: action,
                type: "POST",
                data: result,
                beforeSend: function(jqXHR) {
                  jqXHR.peNumber = 'PE1123';
                }
              }).done(function(html) {
                _Prtg.objectTools.update.call(me.$element);
              });
            });
        }
      });
    }

    me.refresh();
  };

    Plugin.prototype.render = function (me) {
        var primaryObjects = [];
        var smallObjects = [];

        me.$element.empty();
        if (!me.data || !me.data.objects || !me.data.objects[me.data.type] || !me.data.objects[me.data.type].length) {
            renderDisplayEmptyMessage();
            return;
        }

        sortObjects(me.data.objects[me.data.type], me.data.type, me.data.mapview);

        var mainElem = me.$element;
        me.$element.append('<div class="centered"></div>');
        me.$element = me.$element.find('.centered');

        $.each(primaryObjects, function () {
            if (!!this.addinfo.lookups)
                me.renderLookup.call(this, me, this.addinfo);
            else
                me.renderGauge.call(this, me, this.addinfo);
        });


        $.each(smallObjects, function () {
            if (!!this.addinfo.lookups)
                me.renderLookup.call(this, me, this.addinfo);
            else
                me.renderGauge.call(this, me, this.addinfo);
        });
        me.$element.append('<div style="clear: both;"></div>');
        me.$element = mainElem;


        if ((primaryObjects.length + smallObjects.length) < 1
            && !$(".overviewsmalldata").hasClasses(["overviewsmalldatastatus7", "overviewsmalldatastatus8", "overviewsmalldatastatus9", "overviewsmalldatastatus11", "overviewsmalldatastatus12"])) {
            renderDisplayEmptyMessage();
        }

        function renderDisplayEmptyMessage(){
            if ((me.data.type === 'sensors') && me.$element.closest('.map_object').length === 0) {
                me.$element.html('<div class="oskhelpbox nosensors">' + _Prtg.Lang.objectoverview.strings.nosensors + ' &nbsp;' +
                    '<i class="priority3"></i>' + ' / ' + '<i class="priority4"></i> .</div>');
            }
            else {
                $('#displaytable').show();
                $('#overviewshowtablelink').hide();
            }
        }

        //me.data.objects[me.data.type], me.data.mapview
        function sortObjects(object, type, mapview ) {

            $.each(object, function () {
                var info = !!this.info.data ? $.extend(true, {}, this.info.data[0]) : null;
                this.addinfo = info;
                this.primary = (((info||{}).primary || this.priority > 4) ? (/small/.test(mapview || '') !== true ? ' primary' : ' smallprimary') : '');

                if (!info || !info.name || info.show === 0
                    || (type === 'channels' && !this.condition)
                    || $(".overviewsmalldata").is(".overviewsmalldatastatus7,.overviewsmalldatastatus12"))
                    return;

                if (this.primary === ' primary')
                    primaryObjects.push(this);
                else {
                    if ((/primaryonly/.test(mapview || '') === false) || this.primary === ' smallprimary'){
                        smallObjects.push(this);
                    }
                }
            });
        }
    };

  Plugin.prototype.renderLookup = function(me,info) {
    this.channelidtxt = '<br>'
        +(me.data.type==='channels'
          ?_Prtg.Lang.objectoverview.strings.ChannelID
          :_Prtg.Lang.objectoverview.strings.SensorID)
        +': ' +info.id;
    this.minimumtxt= "";
    this.maximumtxt= "";

    me.$element[(!!this.primary?"prepend":"append")]($.jqote(me.template, this));
    var config = {
        size: (this.primary === ' primary'?220:60),
        label: info.name.substring(0,10),
        greenColor:"status3",
        yellowColor:"status4",
        redColor:"status5",
        grayColor:"status0",
        lookups: info.lookups,
        lastvalue: info.lastvalue,
        lastvalueraw: info.lastvalueraw,
        status: info.status
      }
      , mygauge = new _Prtg.Graphixs.LookupsDonut($('#channelgauge'+info.id, me.element)[0], config);
      mygauge.render();
  };

  Plugin.prototype.renderGauge = function(me,info) {

      this.channelidtxt = '<br>'
        +(me.data.type==='channels'
          ?_Prtg.Lang.objectoverview.strings.ChannelID
          :_Prtg.Lang.objectoverview.strings.SensorID)
        +': ' +info.id;
      this.minimumtxt=this.maximumtxt="";
      if(!!info.alltimeminimum)
        this.minimumtxt="<br>"+_Prtg.Lang.objectoverview.strings.Min+": "+info.alltimeminimum;
      if(!!info.alltimemaximum)
        this.maximumtxt="<br>"+_Prtg.Lang.objectoverview.strings.Max+": "+info.alltimemaximum;

      var config = {
            size: (this.primary === ' primary'?220:56),
            label: info.name.substring(0,10),
            min:info.graphminraw||0,
            max:info.graphmaxraw||1000,
            avg:null,
            redZones : [],
            yellowZones : [],
            grayZones : [],
            greenZones : [],
            greenColor:"status3",
            yellowColor:"status4",
            redColor:"status5",
            grayColor:"status0"
          }
        , transform_conf = ['min','max']
        , transform_lim = ['limitminwarning','limitmaxwarning','limitminerror','limitmaxerror']
        , transform_val = ['lastvalueraw','averageraw'];

      if(!!info.average){
        config.avgtxt = _Prtg.Lang.objectoverview.strings.Avg+": "+info.average;
        this.maximumtxt = "<br>"+config.avgtxt+this.maximumtxt ;
      }

      me.$element[(!!this.primary?"prepend":"append")]($.jqote(me.template, this));


      var scale = config.max - config.min
        , min = config.min;
      if(!!scale){
        if(!!info.limitmode && info.limitminwarning !== "" && info.limitmaxwarning === info.limitminwarning){
          info.limitminwarning += (-0.05*scale);
          info.limitmaxwarning += (0.05*scale);
        }
        if(!!info.limitmode && info.limitmaxerror !== "" && info.limitminerror === info.limitmaxerror){
          info.limitmaxerror += (0.05*scale);
          info.limitminerror += (-0.05*scale);
        }
        transform_conf.forEach(function(e){
          config[e] = Math.round((config[e] - min) / scale * 1000);
        });
        if(!!info.limitmode)
          transform_lim.forEach(function(e){
            if(info[e] !== '')
              info[e] = Math.round((info[e] - min) / scale * 1000);
          });
        transform_val.forEach(function(e){
          if(info[e] !== '')
            info[e] = Math.round((info[e] - min) / scale * 1000);
        });
      }
      var hidelabels=false;
      if (info.hasOwnProperty('averageraw') && info.averageraw!=='') { config.avg = info.averageraw, transform_conf.push('avg');}
      if (info.graphmaxraw === null || info.graphminraw === null || isNaN(info.lastvalueraw)) {
        config.min=0;
        config.max=1000;
        hidelabels=true;
        config.grayZones.push({ from: config.min, to: config.max });
        config.grayColor = 'status' + info.status;
      } else if(info.status===7||info.status===8||info.status===9||info.status===11||info.status===12) { //paused
        config.min=0;
        config.max=1000;
        config.grayZones.push({ from: config.min, to: config.max });
        config.grayColor= 'status' + info.status;
        hidelabels=true;
        $("#channelbox"+info.id+" .channelvalue", me.element).hide();
      } else if (info.status===0||info.status===1||info.status===6) { //unknown
        config.min=0;
        config.max=1000;
        config.grayZones.push({ from: config.min, to: config.max });
        hidelabels=true;
        $("#channelbox"+info.id+" .channelvalue", me.element).hide();
      } else {
        config.greenZones.push({ from: config.min, to: config.max });
        if(info.graphmaxraw === info.graphminraw)
          hidelabels=true;
      }
      if (!hidelabels && !!info.limitmode) {
        if (info.limitminwarning!=="")
          config.yellowZones.push({ from: config.min, to: info.limitminwarning });
        if (info.limitminerror!=="")
          config.redZones.push({ from: config.min, to: info.limitminerror });
        if (info.limitmaxwarning!=="")
          config.yellowZones.push({ from: info.limitmaxwarning, to: config.max  });
        if (info.limitmaxerror!=="")
          config.redZones.push({ from: info.limitmaxerror, to: config.max  });
      }
        $('#channelbox'+info.id, me.element).data('gauge',{config:config,info:info});
        var mygauge = new _Prtg.Graphixs.Gauge($('#channelgauge'+info.id, me.element)[0], config);
        if (info.graphmax) config.maxtext=info.graphmax;
        if (info.graphmin) config.mintext=info.graphmin;
        mygauge.render(info.lastvalueraw);
        if (hidelabels) {
          $("#channelgauge" + info.id + " .pointerContainer,#channelgauge" + info.id + " text", me.element).hide();
        }
  };

	_Prtg.Plugins.registerPlugin(pluginName, Plugin);

})(jQuery, window, document);
;
// _Prtg.ObjectOverview.Lang.js
_Prtg.Lang = _Prtg.Lang || { "___": '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
  objectoverview: {
    strings: {
        "primaryChannel": 'Primary Channel',
        "setPrimaryChannel": 'Make Primary Channel',
        "editChannel": 'Edit Channel Settings',
        "Max": 'Max',
        "Min": 'Min',
        "Avg": 'Avg',
        "ChannelID": 'Channel ID',
        "SensorID": 'Sensor ID',
        "nosensors": 'To see sensor gauges here, please change the priority of one or more sensors to'
    }
  }
});
;
(function($, window, document, undefined) {
	var pluginName = "clustermap";
	function clustermap(element, data, parent) {
		this.element = element;
		this.$element = $(element);
		this.data = data;
		this.preview = data.preview || false;
		this.r = 325;
		this.scale = Math.round(Math.min(this.$element.height(), this.$element.width())/2) / 325;
		this.center = 325 * this.scale;
		this.d3 = d3.select(element)
			.append('svg:svg')
			.attr('style','width:100%;height:100%;overflow: visible')
			.insert('g')
			.attr('transform','matrix({scale},0,0,{scale},{center},{center})'.printf(this));
		this.r -= 75;
		this.links = data.links;
		this.init(this);
	};

	clustermap.prototype.init = function(me){
		_Prtg.Events.subscribe('refresh.events.prtg', $.proxy(me.refresh, me));
		me.$element
			.removeAttr('data-objects')
			.on('destroyed',function() {
				_Prtg.Events.unsubscribe('refresh.events.prtg', $.proxy(me.refresh, me));
			})

		this.render(this.data.objects);
	};

	clustermap.prototype.render = function(data){
		var me = this
			, halfwidth = 75
			, clustermembercount = Object.keys(data).length
			, num = (clustermembercount===2 ? -0.5 : -1)
			, rotate  =(2*Math.PI / clustermembercount)
			, rotate2 =(  Math.PI / 2 / (clustermembercount-1));

		$(me.d3[0]).empty();
		var defs = me.d3
			.append('defs');
		var grad = defs.append('linearGradient')
			.attr('id','downplus')
			.attr('x1','0')
			.attr('y1','0')
			.attr('x2','1')
			.attr('y2','1');
		grad.append('stop').attr('offset','25%').attr('stop-color','gray');
		grad.append('stop').attr('offset','75%').attr('stop-color',_Prtg.Colors.statusdown);
		grad = defs.append('linearGradient')
			.attr('id','downminus')
			.attr('x1','1')
			.attr('y1','1')
			.attr('x2','0')
			.attr('y2','0');
		grad.append('stop').attr('offset','25%').attr('stop-color','gray');
		grad.append('stop').attr('offset','75%').attr('stop-color',_Prtg.Colors.statusdown);
		grad = defs.append('linearGradient')
			.attr('gradientUnits','objectBoundingBox')
			.attr('id','upminus')
			.attr('x1','0')
			.attr('y1','0')
			.attr('x2','1')
			.attr('y2','1');
		grad.append('stop').attr('offset','0').attr('stop-color',_Prtg.Colors.statusup);
		grad = defs.append('linearGradient')
			.attr('gradientUnits','objectBoundingBox')
			.attr('id','upplus')
			.attr('x1','1')
			.attr('y1','1')
			.attr('x2','0')
			.attr('y2','0');
		grad.append('stop').attr('offset','0').attr('stop-color',_Prtg.Colors.statusup);
		grad = defs.append('linearGradient')
			.attr('gradientUnits','objectBoundingBox')
			.attr('id','unknownminus')
			.attr('x1','0')
			.attr('y1','0')
			.attr('x2','1')
			.attr('y2','1');
		grad.append('stop').attr('offset','0').attr('stop-color','gray');
		grad = defs.append('linearGradient')
			.attr('gradientUnits','objectBoundingBox')
			.attr('id','unknownplus')
			.attr('x1','1')
			.attr('y1','1')
			.attr('x2','0')
			.attr('y2','0');
		grad.append('stop').attr('offset','0').attr('stop-color','gray');
		me.d3.append('marker')
			.attr('id',"arrow")
			.attr('viewBox',"0 0 10 10")
			.attr('refX',"5")
			.attr('refY',"5")
			.attr('markerUnits',"strokeWidth")
			.attr('markerWidth',"5")
			.attr('markerHeight',"5")
			.attr('orient',"auto")
			.insert('path')
				.attr('d',"M 0 0 L 10 5 L 0 10 z");
    me.d3.append('marker')
			.attr('id','circle')
			.attr('viewBox',"0 0 10 10")
			.attr('refX',"3")
			.attr('refY',"3")
			.attr('markerUnits',"strokeWidth")
			.attr('markerWidth',"6")
			.attr('markerHeight',"6")
			.attr('orient',"auto")
				.insert('circle')
					.attr('r',2)
					.attr('cx',3)
					.attr('cy',3);
		$.each(data, function(guid){
			var self = this
			 	, myclass=''
				, mytitle=''
				, myobject='cluster'+this.guid
				, icon='/images/clusternode.svg';
			++num;
			this.angle = num * rotate;
			if (this.status === 'maintenance')
				{mytitle=mytitle+_Prtg.Lang.clustermap.strings.maintenance;icon='/images/clusternode_inactive.svg';}
			else if (this.status === 'disconnected')
				{mytitle=mytitle+_Prtg.Lang.clustermap.strings.notlinked;icon='/images/clusternode_disconnected.svg';}
			else if (this.status === 'master')
				{mytitle=mytitle+_Prtg.Lang.clustermap.strings.currentmaster;myclass=" master";icon='/images/clusternode_master.svg';}
			else
				mytitle=mytitle+_Prtg.Lang.clustermap.strings.failover;
			this.position = {
				x:  Math.sin(this.angle)*me.r - halfwidth,
				y: -Math.cos(this.angle)*me.r - halfwidth
			};
			this.center = {
				x:  Math.sin(this.angle)*me.r,
				y: -Math.cos(this.angle)*me.r
			};
			this.node = me.d3
				.append('svg:g')
				.attr("transform", 'translate({x},{y})'.printf(this.position))
				.attr('id','clustermap-node-'+guid)
				.attr('class',"clustermap-node "+myclass);


			var link = this.node.append('svg:a')
				.attr('class','nohjax')
				.attr('target', '_blank')
				.attr('xlink:href',me.links[guid]||'#');
			link.append('image')
				.attr('transform', 'translate(11,0)')
				.attr('width',128)
				.attr('height',106)
				.attr('xlink:href',icon);
			link.append('text')
				.text(this.name)
				.attr('dy',120)
				.attr('x',halfwidth)
                .attr('class','clusternode_name')
				.attr('startOffset', '50%')
				.attr('text-anchor',"middle");
            link
                .append('text')
                .text(mytitle)
                .attr('dy',134)
                .attr('x',halfwidth)
                .attr('class','clusternode_type')
                .attr('text-anchor',"middle")
                .attr('startOffset', '50%')
                .attr('xlink:href','#P-'+guid);
		});
		var svgheight = (function(num){
			var ret = 0;
			switch(num){
				case 1:
					ret = 150;
					break;
				case 2:
					me.d3.attr("transform", 'translate({x},{y})'.printf({x:me.r + halfwidth,y:halfwidth}));
					ret = 150;
					break;
				case 3:
					ret = 480;
					break;
				default:
					ret = 630;
			}
			return ret;
		})(clustermembercount);
		$(".cluster_map_background").css({"height": svgheight +'px'});

		$.each(data, function(num){
			var src = this;
			$.each(this.connections, function(){
				var dst = data[this.guid]
					, xoff = src.center.x > dst.center.x
							? -5
							: src.center.x === dst.center.x
								? src.center.y > dst.center.y
									? 5
									: -5
								: 5
					, yoff = src.center.y > dst.center.y
							? 5
							: src.center.y === dst.center.y
								? xoff
								: -5
					, x1 = src.center.x + xoff
					, y1 = src.center.y + yoff
					, x2 = dst.center.x + xoff
					, y2 = dst.center.y + yoff
					, m = (y1 - y2 + 1) / (x1 - x2 + 1)
					, angle = Math.atan(1/m)
					, dx = Math.sin(angle) * halfwidth
					, dy =  Math.cos(angle) * halfwidth
					, f1 = (x2-x1)*(x2-x1)+(y2-y1)*(y2-y1) < (x2-x1+dx)*(x2-x1+dx)+(y2-y1+dy)*(y2-y1+dy) ? 1 : -1
					, f2 = (x2-x1)*(x2-x1)+(y2-y1)*(y2-y1) > (x2+dx-x1)*(x2+dx-x1)+(y2+dy-y1)*(y2+dy-y1) ? 1 : -1


				x1 = x1 + f1*dx;
				y1 = y1 + f1*dy;
				x2 = x2 + f2*dx;
				y2 = y2 + f2*dy;

				me.d3.append('g')
					.attr("stroke-width", 2)
					.attr("stroke", "url(#"+this.status+(x1<=x2?"minus":"plus")+")")
				.insert('line')
					.attr('x1',x1)
					.attr('y1',y1)
					.attr('x2',x2)
					.attr('y2',y2)
					.attr('marker-start',"url(#circle)")
					.attr('marker-end',"url(#arrow)")
			});
		});
		// if(clustermembercount===2)
    if(_Prtg.Options.browser == 'firefox')
      setTimeout(function(){$('table').hide(3).show(10)},200);
	};
	clustermap.prototype.refresh = function(){
		var  me=this;
		$.ajax({
			url: '/api/cluster.json',
			dataType:'json'
		}).done(function(data){
			me.render(data);
		});
	};
	clustermap.prototype.update = function(data){
		this.render(data);
	};

	$.fn[pluginName] = function(data, parent) {
	return this.each(function() {
		if (!$.data(this, 'plugin_' + pluginName)) {
			$.data(this, 'plugin_' + pluginName, new clustermap(this, data, parent));
		}
	});
};
})(jQuery, window, document);

;
// _Prtg.ClusterMap.Plugin.lang.js
_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
  clustermap: {
    strings: {
      failover: 'Failover Node',
      currentmaster: 'Current Master',
      notlinked: 'Not Linked',
      maintenancemaintenance: 'Maintenance Mode'
    }
  }
});
;
// _Prtg.Status.Plugin.js
(function($, window, document, undefined) {
  function status(element, data, parent) {
    this.data = data;
    this.$element = $(element);
    this.$parent = $(parent);
    this.timer = this.$parent.Events();
    this.$elms = this.$element.find("[status]");
    this.init(this);
  }

  status.prototype.init = function(me) {
    var r = Math.random()
      .toString(36)
      .substring(7);
    me.$elms.each(function() {
      var arg = $(this)
        .attr("status")
        .split(";");
      var i, args, proxy, prop, attr, prepend;
      for (i = 0; i <arg.length; ++i) {
        args = arg[i].split(",");
        proxy = null;
        prop = null;
        attr = "";
        prepend = "";

        if (args.length === 0) return;
        if (args.length === 1) {
          proxy = me.updateContent;
          prop = args[0];
        } else {
          proxy = me.updateAttr;
          prop = args[0];
          attr = args[1];
          prepend = args.length === 3 ? args[2] : "";
        }
        _Prtg.Events.subscribe(
          "newstats.prtg." + r,
          $.proxy(proxy, this, prop, attr, prepend)
        );
      }
    });

    me.$element.on(
      "destroyed",
      $.proxy(function(e) {
        _Prtg.Events.unsubscribe("newstats.prtg." + r);
      }, me)
    );
  };

  status.prototype.updateContent = function(prop, attr, prepend, event, data) {
    $(this).html(data.object[prop]);
  };

  status.prototype.updateAttr = function(prop, attr, prepend, event, data) {
    if (attr === "title") {
      attr = !!$(this).attr("title") ? "title" : "data-original-title";
    }
    $(this).prop(attr, prepend + data.object[prop]);
  };

  _Prtg.Plugins.registerPlugin("status", status);
})(jQuery, window, document);
;
//_Prtg.BusinessProcessChannels.Plugin.js
"use strict";

(function($, window, document, undefined) {
  var pluginName = "businessprocesschannels";
  var rwTemplates = {
      addObject: '<span class="add-object"><span class="ui-icon ui-icon-circle-plus"></span></span>',
      newRow: 'overwrite',
      row: '<tr><td><input type="text" name="channelname" value="{channelname}"></td><td><input name="errorthreshhold" type="number" min="0" max="100" step ="1" value="{errorthreshhold}"></td><td><input name="warningthreshhold" type="number" min="0" max="100" step ="1" value="{warningthreshhold}"></td>',
      element: '<li class="taglabel" data-objectid="{id}">' +
                '<span class="closetag" data-id="{id}"  data-node-type="{type}" style="background-image:url({icon})" title="#{id} {name}">{name}' +
                '</span></li>'
    };
  var roTemplates = {
      addObject: '',
      newRow: 'overwrite',
      row: '<tr><td><input readonly type="text" name="channelname" value="{channelname}"></td><td><input readonly name="errorthreshhold" type="number" min="0" max="100" step ="1" value="{errorthreshhold}"></td><td><input readonly name="warningthreshhold" type="number" min="0" max="100" step ="1" value="{warningthreshhold}"></td>',
      element:  '<li class="taglabel" data-objectid="{id}">' +
                '<span class="closetag" data-id="{id}"  data-node-type="{type}" style="background-image:url({icon})" title="#{id} {name}">{name}' +
                '</span></li>'
    };
  var maxChannels = 50;

  function businessProcessChannels(element, data, parent) {
    this.$el = $(element);
    this.data = data;
    this.templates = (this.data.readonly ? roTemplates : rwTemplates);
    this.$lastRow = this.$el.find('tbody tr:last-child');
    this.$values = this.$el.next();
    this.templates.newRow = this.$lastRow[0].outerHTML;

    this.init(this);
    !!this.data.objects.length && this.$values.val(JSON.stringify(this.data.objects));
  }
  businessProcessChannels.prototype.init = function init(me) {
    var ids = [];

    this.$el
      .parents('fieldset, div.control-group').css('overflow','visible');
    this.$el
      .closest('.controls')
      .addClass('fillwidth');

    if(!this.data.readonly)
      this.initEvents(me);

    this
      .data.objects.forEach(function(elm){
        return ids.push.apply(ids,elm.objects);
      });

    this
      .fetch(ids)
      .done(function(objects){
        me.$el
          .removeClass('loading');
        me.data.objects.forEach(function(row, index){
          var html = me.templates.row.printf($.extend({index:index}, row)) + '<td class="object-list"><ul>';
          !!row.objects && row.objects.forEach(function(objectid, index){
            html += me.templates.element.printf(objects[objectid]);
          });
          html += '</ul></td><td>' + me.templates.addObject + '</td></tr>';
          me.$lastRow.before(html).prev().data(row);
        });
        if(me.data.objects.length <50)
          me.$lastRow.before('<tr class="separator"><td colspan="5"></td></tr');
        else
          me.$lastRow.remove();
      });
  }

  businessProcessChannels.prototype.initEvents = function initEvents(me) {
    this.$el
      .on('change.' + pluginName,'input:not(.quick-search)', function(event){
        var $this = $(this);
        var data = $this.closest('tr').data();

        if($this.is('.new-row')){
          if(!data[$this.attr('name')]){
            me.$lastRow
              .find('td.object-list-disabled')
                .toggleClass('object-list-disabled object-list')
              .end()
              .find('input[disabled]')
                .removeAttr('disabled')
                .eq(0)
                .focus();
            me.$lastRow
              .find('td:last-of-type')
                .append(me.templates.addObject);
            if(me.$el.find('tbody tr').length <= maxChannels){
              $this.closest('tr').after(me.templates.newRow);
              me.$lastRow = me.$el.find('tbody tr:last-child');
            }
          }

          if($this.val() === '' && me.$el.find('tbody tr').length > 1){
            $this.closest('tr').remove()
          }

          data[$this.attr('name')] = me.format($this.attr('type'), $this.val());

        } else {

          if($this.val() === ''
          && $this.attr('name') === 'channelname')
            $this.val(data[$this.attr('name')]);

          data[$this.attr('name')] = me.format($this.attr('type'), $this.val());
        }

        me.save();
      })
      .on('click.' + pluginName,'span.add-object', function(event){
        var $this = $(this);
        var data = $this.closest('tr').data();
        var $objects = $this.closest('tr').find('td.object-list ul');

        event.stopImmediatePropagation(),

        _Prtg.Dialogs.defaultDialog("/controls/objectselectorform.htm", {
          tablefilter:1,
          allowreadonly:1,
          allowroot:0,
          allowself:0,
          allowone:0,
          allownone:0,
          probes:1,
          groups:1,
          devices:1,
          sensors:1,
          hidesensors:false,
          onlysensors:0,
          rootid:0,
          selid: 1
        })
        .done(function(result, action) {
          var ids;
          if(!result || !result.id) return;

          ids = result.id
            .split(',')
            .map(function(element){
              if(0+element === 0)
                return null;
              else
                return Number(element)
            });

          if(ids.length){
            data.objects.push.apply(data.objects,ids);
            me
              .save()
              .fetch(ids)
              .done(function(objects){
                var html='';
                  ids.forEach(function(objectid){
                    html += me.templates.element.printf($.extend(objects[objectid], {index:data.objects.indexOf(objectid)}));
                  })
                if($objects.find('.quick-search').length)
                  $objects.find('.quick-search').parent().before(html);
                else
                  $objects.append(html);
                
                $this.trigger('change');
              });
          }
        }).fail(function() {});
      })
      .on('click.' + pluginName,'.taglabel', function(event){

        if($(event.target).hasClass('closetag') ||  $(event.target).parent().hasClass('closetag')) return;

        var $this = $(this).closest('li');
        var data = $this.closest('tr').data();
        var index = data.objects.indexOf(Number($this.data().objectid));

        $this.trigger('change');
        $this.remove();
        data.objects.splice(index,1);
        me.save();
      })
      .on('click.' + pluginName, 'tbody td.object-list', function(event){
        var $this = $(this);
        var data = $this.closest('tr').data();

        $this.children('ul:not(.object-list)')
          .addClass('object-list')
          .append('<li><input type="text" class="quick-search"></li>')
          .find('input')
            .focus()
            .on('focusout', function(event){
              $(this).parent().hide();
            })
            .on('changed.quicksearch', function(event, object){
              var html;
              data.objects.push.call(data.objects,object.id);
              me.save()
              html = me.templates.element.printf($.extend(object, {index:data.objects.indexOf(object.id)}));
              $(this).closest('li').before(html);
            })
            .on('keydown'+ pluginName, function(event){
              if([9,13,27].indexOf(event.which) === -1)
                return true;
              event.preventDefault();
              if(event.which === 27){
                $(this).parent().hide()
              }else if([9,13].indexOf(event.which) > -1){
                $(this)
                  .parent()
                  .show()
                  .end()
                  .focus();
              }
            })
            .on('click' + pluginName, function(event) {
              event.stopImmediatePropagation();
            })
            .filter(':visible')
            .each(function(){
              _Prtg.Plugins['quicksearch'].init.apply(this,[null, $this]);
            });
        $this = $this.find('input.quick-search');
        $this.parent().show();
        $this.focus();
      });

    this.$el
      .find('thead th:last-child')
      .eq(0)
      .append('<i class="flr ui-icon icon-clipboard"></i>')
      .on('click', 'i', function(){
        _Prtg.objectTools.copyClipBoard(undefined, me.$values.val());
      });

  }
  businessProcessChannels.prototype.update = function update() {
    return $.makeArray(this.$el.find('tbody tr:not(.separator)').map(function(){
        var ret = $(this).data();
        if (!ret.channelname.length)
          ret = null;
        return ret;
    }));
  }

  businessProcessChannels.prototype.save = function save() {
    var data = this.update();
    if(data.length)
      this.$values.val(JSON.stringify(data));
    return this;
  }

  businessProcessChannels.prototype.fetch = function fetch(ids) {
    var ida = [];
    ids.forEach(function(elm){
      if(ida.indexOf(elm) === -1)
        ida.push(elm)
    })
    if(ids.length){
      return $.ajax({
        url: '/api/objectlist.json',
        dataType: 'json',
        data: {
          id: ida.join(',')
        }
      });
    } else {
      return $.when({});
    }
  }
  businessProcessChannels.prototype.format = function format(type, value) {
    switch(type){
      case 'number':
        value = Number(value);
        break
    }
    return value;
  }
  _Prtg.Plugins.registerPlugin(pluginName, businessProcessChannels);

})(jQuery, window, document);
;
//_Prtg.QuickSearch.Plugin.js
(function($, window, document, undefined) {
  var pluginName = 'quicksearch';
  var templates = {
    element: '<li style="background-image:url({icon})"  data-id="{objid}" data-icon="{icon}" data-name="{name}" data-type="{basetype}">{name}</li>'
  };

  function QuickSearch(element, data, parent){
    var _this = this;
    this.$el = $(element);
    this.$par = $(parent);
    this.data = [];
    this.searchtext = '';
    this.root = [];
    this.autocomplete = false;

    data = data || {};
    // (Object.keys(_Prtg.Lang.common.roots) ||
     (data.root || data.roots || ['root']).forEach(function(key){
      if(_Prtg.Lang.common.roots[key]['basetype'])
        _this.root.push(_Prtg.Lang.common.roots[key]);
    });
    this.selectionTypes = (data.selectionTypes || ['', 'probe', 'group', 'device', 'sensor']);
    element[pluginName] = $.now();
    this.$el
      .attr({
        'placeholder': _Prtg.Lang.common.strings.search,
        'title': _Prtg.Lang.common.strings.searchtitle,
        'data-placement': 'left'
      });
    this.init(this);
  };

  QuickSearch.prototype.init = function init(_this){
    this.$el
      .on('keydown.' + pluginName, function(event) {
        var $lis = _this.$content.find('li');
        var $current = $lis
          .filter('.focus')
          .removeClass('focus');

        if(!$lis || !$lis.length)
          return;

        if (event.which === 27
        || (event.which === 9 && this.value === '')) {
          _this.stop.call(_this, event, $current);
        }else if([38, 40].indexOf(event.which) > -1){
          _this.arrowKeysUpDown.call(_this, event, $current, $lis);
        }else if(_this.autocomplete && [8, 9, 37, 39].indexOf(event.which) > -1){
          _this.arrowKeysLeftRight.call(_this, event, $current);
        }else if([9, 13].indexOf(event.which) > -1){
          _this.select.call(_this, event, $current);
        }else{
          _this.$content.show();
        }
      })
      .on('keypress.' + pluginName + ' paste.' + pluginName, _Prtg.debounce(function(event){
          var input = this;
          var searchtext = this.value.trim();
          var remember = input.readOnly;

          if(searchtext.length){
            input.readOnly = true;
            _this.keyUp.call(_this, searchtext)
              .done(function(){
                input.readOnly = remember;
              });
          }
        }, 999)
      )
      .on('focusout.' + pluginName, function(event){
        _this.stop();
      })
      .after('<ul class="quick-search-content" style="display:none;width:'
             + (_Prtg.scrollbarDimensions.width + this.$el.width())
             + 'px" />');

      this.$content = this.$el.parent().find('ul.quick-search-content');

      this.$content.parents('.control-group').css('z-index','100');

      this.$content
        .on('mouseenter.' + pluginName,'li', function(event){
          $(this)
            .parent()
              .find('li.focus')
              .removeClass('focus');
          $(this)
            .addClass('focus');
        })
        .on('mousedown.' + pluginName, function(event){
          event.stopImmediatePropagation();
          event.preventDefault();
        })
        .on('mousedown.' + pluginName, 'li', function(event){
          event.stopImmediatePropagation();
          event.preventDefault();
          _this.select.call(_this, event, $(this));
        });
  };

  QuickSearch.prototype.stop = function stop(event, $current){
    this.$el[0].value = '';
    this.autocomplete = false;
    this.searchtext = '';
    this.data = [];
    !! this.jqXHR
    && this.jqXHR.abort
    && this.jqXHR.abort();
    this.$content.empty().hide();
    this.$el
      //.attr('placeholder', _Prtg.Lang.common.strings.search)
      .focus()[0].readOnly = false;
    return this;
  };

  QuickSearch.prototype.select = function select(event, $current){
    var data = $current && $current.data();

    if(event.which === 13){
      event.stopImmediatePropagation();
      event.preventDefault();
    }
    !! data
    && data.id > 0
    && this.selectionTypes.indexOf(data.type) > -1
    && this.$el.trigger('changed.' + pluginName, $.extend($current.data(), {key: event.which}));
    this.stop();
    return this;
  };

  QuickSearch.prototype.arrowKeysUpDown = function arrowKeysUpDown(event, $current, $lis){
    event.stopImmediatePropagation();
    event.preventDefault();

    if($current.length){
      if(event.which === 38)
        $current = $current.prev();
      else
        $current = $current.next();
    }
    if($current.length === 0){
      if(event.which === 38)
        $current = $lis.filter(':last-child');
      else
        $current = $lis.filter(':first-child');
    }
    $current.addClass('focus');

    $current[0].parentNode.scrollTop = $current[0].offsetTop;

    if(this.autocomplete){
      this.$el
        .val(this.autocomplete + $current.data().name )[0]
        .setSelectionRange(this.autocomplete.length, this.autocomplete.length + $current.data().name.length);
    }
    return this;
  };

  QuickSearch.prototype.arrowKeysLeftRight = function arrowKeysLeftRight(event, $current){
    var _this = this;
    var txt = '';
    var data = this.$el.data().objects;

    event.stopImmediatePropagation();
    event.preventDefault();

    if($current.data().type === 'sensor'){
       _this.select.call(_this, event, $current);
       return this;
    }

    if([8, 37].indexOf(event.which) > -1){
      $current.data(data.shift());
    }else{
      data.unshift($current.data());
    }


    data.forEach(function(element){
      if(element && element.name)
        txt = element.name + '/' + txt;
    });

    if(txt){
      txt  = '//' + txt;
      this.$el.val(txt);

      this.$el[0]
        .setSelectionRange(this.autocomplete.length, txt.length);
      this.keyUp.call(this, txt);
    }else{
      this.stop();
    }
    return this;
  };

  QuickSearch.prototype.keyUp = function keyUp(searchtext){
    var _this = this;
    var filtered = [];
    var filtertext = searchtext.split('/');
    var dfd = $.Deferred();

    filtertext = filtertext[filtertext.length - 1];

    if (searchtext.length >= 2
    && ( !this.searchtext
      || searchtext.indexOf(this.searchtext) !== 0
      || searchtext.lastIndexOf('/') === searchtext.length - 1)){
      _this.jqXHR = this
        .fetch(searchtext)
        .done(function(data){
          filtered = _this.filter.call(_this, filtertext.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&"));
          if(filtered.lengh)
            _this.$content
              .removeClass('loading')
              .show();
          _this.show.call(_this, filtered);
          dfd.resolve();
        })
        .fail(function(){
          dfd.resolve();
        });
    } else if(filtertext.length > 2){
      filtered = _this.filter.call(_this, filtertext.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&"));
      _this.show.call(_this, filtered);
      dfd.resolve();
    } else{
      _this.$content
        .empty()
          .append('<div class="loadspinner"></div>')
        .addClass('loading');
      dfd.resolve();
    }
    return dfd;
  };

  QuickSearch.prototype.show = function show(data){
    var html = data.map(function(element){
      return templates.element.printf(element);
    });
    var $current = this.$content
      .removeClass('loading')
      .empty()
      .append(html)
      .find('li')
      .filter(':first-child')
      .addClass('focus');

    if($current.length){
      this.$content.show();
      if(this.autocomplete){
        // this.$el.data().objects.unshift($current.data())
        this.$el
          .val(this.autocomplete + $current.data().name)[0]
          .setSelectionRange(this.autocomplete.length, this.autocomplete.length + $current.data().name.length);

      }
    }
    return this;
  };

  QuickSearch.prototype.filter = function filter(searchtext){
    var regexTags = new RegExp(' '+searchtext, 'gi');
    var regexText = new RegExp(searchtext, 'gi');


    return this.data.filter(function(element){
      return ((element['objid'] - searchtext) === 0
          || element['name'].match(regexText)
          || (' ' + element['tags']).match(regexTags));
    });
  };

  QuickSearch.prototype.fetch = function fetch(searchtext){
    var _this = this;
    var search;
    var done = function(){};
    var request = {
          dataType: 'json',
          timeout: 99999,
          beforeSend: function(jqXHR){
            jqXHR.ignoreManager = true;
            jqXHR.ignoreError = true;
          }
        };
    var id = (!!_this.$el.data().objects
          && !!_this.$el.data().objects[0]
          && _this.$el.data().objects[0].id > -1
          ? _this.$el.data().objects[0].id
          : undefined);


    _this.searchtext = searchtext;
    _this.$el.attr('placeholder', _Prtg.Lang.common.strings.search);
    if(searchtext[0] === '/'
    && searchtext[1] === '/'){
      _this.autocomplete = searchtext;
      _this.$el[0].readOnly = true;
      if(searchtext === '//'){
        _this.data = _this.root;
        _this.$el.data({objects: []});
        return $.when({});
      }else if(id !== undefined){
        request = $.extend(true, request ,{
          url: '/api/quicksearch.json',
          data: {
            parentid: id
          }
        });
        done = function(data) {
          var ret = [];
          !!data && !!data.objects && data.objects.forEach(function(elm){
              if(!elm.icon)
                elm.icon = _this.$el.data().objects[0].icon;
            });
            !!data && !!data.objects && ret.push.apply(ret, data.objects);
            _this.data = ret;
        };
      }else{
        return $.Deferred().reject();
      }
    }else{
      _this.autocomplete = false;
      request = $.extend(true, request ,{
        url: '/api/searchtreeobject.json',
        data: {
          searchtext: searchtext
        }
      });
      done = function(data) {
        var ret = [];
        Object
          .keys(data)
          .forEach(function(key){
             !!data[key] && !!data[key].sensorxref && ret.push.apply(ret, data[key].sensorxref);
             !!data[key] && !!data[key].multiobj && ret.push.apply(ret, data[key].multiobj);
          });
          _this.data = ret;
      }
    }
    if(this.$content.find(".loadspinner").length === 0){
        this.$content.append('<div class="loadspinner"></div>')
    }
    this.$content.addClass('loading').show();
    return $.ajax(request)
      .done(done)
      .fail(function(){
        _this.$el.attr('placeholder', _Prtg.Lang.common.strings.noresult);
        _this.stop();
      });
  };
  _Prtg.Plugins.registerPlugin(pluginName, QuickSearch);
})(jQuery, window, document);
;
//_Prtg.TCT.Plugin.js
(function($, window, document, undefined) {

  var templates = {
        'tour': '<div class="tct" role="tooltip"><div class="arrow"></div><h2 class="tct-title popover-title"></h2><div class="tct-content popover-content"></div><div class="buttonbar"><button class="actionbutton">'+_Prtg.Lang.TCT.gotit+'</button></div></div>',
        'sequence': '<div class="tct" role="tooltip"><div class="arrow"></div><h2 class="tct-title popover-title"></h2><div class="tct-content popover-content"></div><div class="buttonbar"><button class="actionbutton">'+_Prtg.Lang.TCT.gotit+'</button></div></div>',
        'guru': '<div class="tct-content">',
        'inline': '<div class="tct inlined"><h2 class="tct-title"></h2><div class="tct-content "></div><div class="buttonbar"><button class="actionbutton">'+_Prtg.Lang.TCT.gotit+'</button></div</div>',
        'closebutton': '<button class="closebutton" data-placement="left" title="'+_Prtg.Lang.TCT.dontshowagain+'"></button>'
      }
      , debug = false
      , dbgUndo = null
      , dbgStorage = window.sessionStorage
    ;

  function armUndo(undoables){
    if(undoables){
      !!console && !!console.log && console.log('undo is armed');
      $('body').off('.tct.undo').one('click.tct.undo', function(e){
        if(e.shiftKey && e.ctrlKey && e.altKey)
          undo();
      });
    }
  }

  function undoable(index, val){
    if(!!dbgStorage && !!debug){
      if(dbgUndo === null){
        if(!!dbgStorage.getItem('tct.'+debug))
          dbgUndo = JSON.parse(dbgStorage.getItem('tct.'+debug));
        else
          dbgUndo = {};
        armUndo(true);
      }
      if(!dbgUndo[index]){
        dbgUndo[index] = val;
        dbgStorage.setItem('tct.'+debug, JSON.stringify(dbgUndo));
      }
    }
  }

  function undo(dbg, storage){
    var dbgUndo = {};

    debug = dbg || debug;
    dbgStorage = storage || dbgStorage;
    if(!!dbgStorage){
      if(!!dbgStorage.getItem('tct.'+debug))
          dbgUndo = JSON.parse(dbgStorage.getItem('tct.'+debug));
      $.each(dbgUndo, function(key, val) {
        $.ajax({
          url: val,
          beforeSend: function(jqXHR) {
            jqXHR.ignoreManager = true;
            jqXHR.ignoreError = true;
          },
          type: "GET"
        });
      });
      dbgStorage.removeItem('tct.'+debug);
      dbgStorage.removeItem('tct.debug.mode');
      location.reload();
    }
  }
  function debugMode(dbg, storage){
    debug = dbg || true;
    if(typeof(storage) === "object")
      dbgStorage = storage;
    if(!!dbgStorage)
      dbgStorage.setItem('tct.debug.mode', debug);
     return (!!debug ? debug : 'off');
  }

  function TCT() {
    var self = this;

    this.runTCT = $();
    this.undo = undo;
    this.debug = debugMode;
    this.version = _Prtg.Options.version.split('.').slice(0,3).join('.');
    this.interval = Math.round(60*5 / _Prtg.Options.refreshInterval);
    this.intervalCount = 1;

    if(!!dbgStorage && !!dbgStorage.getItem("tct.debug.mode")){
      debug = dbgStorage.getItem("tct.debug.mode");
      !!console && !!console.log && console.log('tct.debug.mode', (!!debug ? debug : 'off'));
      armUndo(true);
    }
    _Prtg.Events.subscribe('document.ready.prtg tabloaded.events.prtg loaded.events.prtg',$.proxy(this.init,this));
    this.init();
    $.ajax({
      url: '/api/sensortypesinuse.json',
      data:{simpleobject:true},
      timeout: 100000,
      dataType: 'json',
      beforeSend: function(jqXHR) {
        jqXHR.ignoreManager = true;
        jqXHR.ignoreError = true;
      }
    }).done(function(sensortypes) {
      _Prtg.sensorTypes = sensortypes;
    });
  }

  TCT.prototype.initElement = function initElement(me, data) {
    var self = this
      , testAB = me.find('test')
      , check = null
      , comment = me.contents().filter(function(){return this.nodeType===8;})
      , action = null
      , funcwrap = "try{{code}}catch(e){!!console && !!console.log && console.log(e)};"
    ;

    if(me.is('.removeme')) {
      me.remove();
      return 0;
    }
    if(comment.length > 0) {
      action = comment.get(0).nodeValue;
      comment.remove();
    } else if(!!data.action) {
      action = data.action;
    } else {
      action = null;
    }
    if(!!action) {
      if(action.trim().split(' ')[0] === 'return') {
          data.code = (new Function('$tct, lastStats, sensorTypes', funcwrap.printf({code:unescape(action)},true)))(me, _Prtg.lastStats, _Prtg.sensorTypes);
          if(data.code.check)
            data.check = data.code.check;
          if(data.code.action)
            data.action = data.code.action;
      }else{
        data.action = new Function('$tct, lastStats, sensorTypes', funcwrap.printf({code:unescape(action)},true));
      }
    }

    if(!!data.check) {
      if(typeof(data.check) === 'string') {
        if(data.check.split(' ')[0].trim() === "return") {
          check = new Function('$tct, lastStats, sensorTypes', unescape(data.check));
          if(!check.call(me, me, _Prtg.lastStats, _Prtg.sensorTypes)) {
            me.remove();
            return 0;
          }
        }
      } else if(typeof(data.check) === 'function') {
        if(!data.check.call(me, me, _Prtg.lastStats, _Prtg.sensorTypes)) {
          me.remove();
          return 0;
        }
      }
    }
    me.children('[data-condition]').each(function(){
      var condition = $(this).data().condition;
      if(condition.split(' ')[0].trim() === "return") {
        condition = new Function('$tct, lastStats, sensorTypes', unescape(condition));
        if(!condition.call(me, me, _Prtg.lastStats, _Prtg.sensorTypes)) {
          $(this).remove();
        }
      }
    });

    data.confirm = this.confirm;

    !!testAB.length && testAB.each(function() {
      var $test = $(this)
        , take = parseInt($test.data().take, 10)
      ;

      if(!$.isNumeric(take))
        take = Math.floor(Math.random() * $test.children().length);
      $test
        .children()
        .eq(take)
        .remove()
        .end()
        .unwrap()
        .one('click.tct',function() {
          self.sendTest($(this).attr('data-key'));
        });
    });
    return me;
  };

  TCT.prototype.randNumber = function randNumber(min, max, last) {
    var ret = last;

    min = min || 0;
    while(ret === last) {
      ret = Math.floor(Math.random() * max) + min;
    }
    return ret;
  };

  TCT.prototype.rotate = function rotate(me, selector, ignoreinterval) {
    var rotate = me.find(selector || '>*')
      , current = rotate.filter(':visible')
      , idx = 0
    ;

    if(typeof me !== 'object') return;

    if(!ignoreinterval && ++this.intervalCount <this.interval) return;

    current.addClass('rotate').hide();

    if(rotate.length > 0) {
      if(rotate.index(current) + 1 <rotate.length)
        idx = rotate.index(current) + 1;
      rotate.eq(idx).removeClass('rotate').show().parent('test').show();
    } else { //empty
      me.remove();
    }
    this.intervalCount = 1;
  };

  TCT.prototype.init = function init(event, element) {
    var self = this;
    $('tct', element)
      .filter('[data-role="action"]:not(.initialized)')
        .each(function(){
          var me = $(this)
            , data = me.data()
          ;
          self.initElement(me, data);
        })
        .eq(0)
          .each(function() {
            var me = $(this)
              , data = me.data()
            ;

            !!data.action && data.action.call(me, _Prtg.lastStats, _Prtg.sensorTypes);
          })
        .end()
        .addClass('initialized')
      .end()
      .filter('[data-role="theater"]:not(.initialized)')
        .parent()
          .each(function(){
            var $tct
              , me = $(this)
            ;
            me.find('.removeme').remove();
            $tct = me.find('tct');
            if($tct.length > 0){
              $tct.addClass('rotate').hide();
              $tct.eq(self.randNumber(0, $tct.length-1)).show().removeClass('rotate');
              _Prtg.Events.subscribe('refresh.events.prtg rotate.events.prtg',$.proxy(self.rotate, self, me, 'tct[data-role="theater"]', false));
            }
          })
        .end()
        .each(function() {
          var me = $(this)
            , data = me.data()
            , elements = self.initElement(me, data)
          ;

          if(!data.hideCloseButton)
            me.children().append(templates.closebutton);
          if(elements.length > 1)
            _Prtg.Events.subscribe('refresh.events.prtg rotate.events.prtg',$.proxy(self.rotate, self, me, nothing, false));
        })
        .on('click.tct','button.closebutton',function(e) {
          var tct = $(this).closest('tct')
            , data = tct.data()
          ;

          e.stopImmediatePropagation();
          self
            .confirm((e.shiftKey & e.ctrlKey), data.role, data.page, 'skipped')
            .done(function(){
              self.rotate(tct.parent(), 'tct[data-role="theater"]', true);
              tct.remove();
            });
          return false;
        })
        .one('click.tct','a.box', function(e) {
          var tct = $(this).closest('tct')
            , data = tct.data()
          ;

          !!tct.data()
          && !!tct.data().page
          && self
              .confirm((e.shiftKey & e.ctrlKey), data.role, data.page, 'done')
              .done(function(){
                self.rotate(tct.parent(), 'tct[data-role="theater"]', true);
                if (!data.keepAfterClick) {
                  tct.remove();
                }
              });
        })
        .on('destroyed.tct', function() {
          var me = $(this);

          _Prtg.Tip.killPopups();
          $('.tooltip, .popover').remove();
          if(me.parent().find('tct[data-role="theater"]').length === 0){
            _Prtg.Events.unsubscribe('refresh.events.prtg rotate.events.prtg',$.proxy(self.rotate, self, me));
            document.location.reload();
          }
        })
        .addClass('initialized')
      .end()
      .filter('[data-role="guru"]:not(.initialized)')
        .filter(function(i) {
          var me = $(this)
            , data = me.data()
            , elements = self.initElement(me, data)
          ;

          if(elements.length) {
            me.html(
              $(templates['guru']).prepend(me.html())
            );
          }
          return (elements.length > 0);
        })
        .eq(0)
          .each(function() {
            var me = $(this)
              , data = me.data()
            ;

            !!data.action && data.action.call(me, _Prtg.lastStats, _Prtg.sensorTypes);
          })
          .css('display','block')
        .end()
        .one('click.tct','button.skip', function(e) {
          var tct = $(this).closest('tct');
          if(!$(this).hasClass("later"))
            self.confirm(e, 'guru', tct.data().page, 'skipped');
          tct.data('removeDelay', 1).remove();
        })
        .one('click.tct','button.actionbutton', function(e) {
          var tct = $(this).closest('tct');

          !!tct.data() && !!tct.data().page && self.confirm(e, 'guru', tct.data().page, 'done');
        })
        .one('destroyed.tct', function(e) {
          var data = $(this).data()
            , delay = data.removeDelay || 0
            , parent = $(this).parent()
            , $next
          ;
          _Prtg.Tip.killPopups();
          $('.tooltip, .popover').remove();
          if(!$(this).is(':visible')) return;


          $('#tctCursor').remove();
          setTimeout(function() {
            if(data.replaceWith) {
              parent.load(data.replaceWith, {id:_Prtg.Util.getUrlVars()['id']}, function() {
                _Prtg.initPlugins(parent);
                self.init();
              });
            } else {
              $next = $('tct[data-role="guru"].initialized').eq(0);
              if($next.length > 0) {
                if(!!$next.data().action)
                  $next.data().action.call($next, _Prtg.lastStats, _Prtg.sensorTypes);
                $next.css('display','block');
              }
            }
          },delay);
        })
        .addClass('initialized');
  };

  TCT.prototype.confirm = function confirm(event, type, page, action) {
    var index = type
      , msg = ""
      , data = [0, page]
    ;
    index += (!!page ? "."+page : "");
    data[1] = index;

    if(!this.version)
    	this.version = _Prtg.Options.version.split('.').slice(0,3).join('.');
    if(type === 'theater' && action === 'done')
      data.push(
        action,
        this.version,
        page
      );
    else
      data.push(
        type === 'guru' ? 'done' : action,
        this.version,
        index + '.' + action
      );



    if(debug === true)
      return $.when();

    !!window.__ga && window.__ga('send', 'event', type, index + '.' + action);

    if(event && !debug && event.ctrlKey && event.shiftKey && event.altKey){
      msg = debugMode($.now());
      !!console && !!console.log && console.log('tct.debug.mode', msg);
    }

    if(!!debug)
      undoable(index, location.origin+"/api/setshowhelpstatus.htm?action=1&page="+encodeURIComponent(index));

    return _Prtg.api.tctAction.apply(this, data);
  };

  TCT.prototype.sendTest = function sendTest(key) {
    if(debug === true) return;
    console.log('sendTest kissmetrics', {key:key,version:this.version});
  };

  _Prtg.Plugins.registerPlugin("TCT", TCT);

  $.fn.tct = function tct(method) {
    var args = Array.prototype.slice.call(arguments).slice(1)
      , cursor = $('<div id="tctCursor"><info /></div>')
      , methods = {
          run: function run(){
            this.dequeue('tct');
          },
          end: function end(queue, callback,delay){
            this.delay(delay||1, 'tct');
            queue.push(function(next){
              !!callback && callback.call($(this));
              next();
            });
          },
          waitFor: function waitFor(queue, element, event, callback){
            queue.push(function(next){
              $(element).off('.tct').one(event+'.tct', function(){
                !!callback && callback.call($(this));
                next();
              });
            });
          },
          blinkStart: function blinkStart(queue){
            queue.push(function(next){
              $('#tctCursor')
                .removeClass('animate-click')
                .show();
              next();
            });
          },
          blinkEnd: function blinkEnd(queue){
            queue.push(function(next){
               $('#tctCursor')
              	.addClass('animate-click')
              	.hide(1500);
              next();
            });
          },
          mouseMoveStart: function mouseMoveStart(queue, event){
            queue.push(function(next){
              _Prtg.Events.subscribeOnce('navigate.prtg', function(){
                $('#tctCursor').remove();
              });
              $('body').append(cursor);
              cursor
                .css({
                  top: event.pageY,
                  left:event.pageX-cursor.width()-2
                })
                .show();
              next();
            });
          },
          mouseMoveTo: function mouseMoveTo(queue, delay, offset, callback){
            var self = this;

            queue.push(function(next){
              var cursor = $('#tctCursor');
              if(!!callback && !offset)
                offset = callback.call($(this), cursor);
              cursor
                .animate(
                  {
                    top: offset.top,
                    left:offset.left -cursor.width()/2
                  }
                  , delay || 1000
                  ,'swing'
                  , function(){
                      next();
                    }
                );
            });
          },
          mouseMoveEnd: function mouseMoveEnd(queue, delay){
            delay = delay || 500;
            this.delay(delay, 'tct');
            queue.push(function(next){
              $('#tctCursor').remove();
              $(document).off('.catchall');
              document.body.style.cursor = 'auto';
              next();
            });
          },
          mouseInfo: function mouseInfo(queue, text, delay){
            queue.push(function(next){
              var cursor = $('#tctCursor').find('info');
              if(cursor.length)
                cursor.html(text).show(10,next);
            });
            !!delay &&  this.delay(delay, 'tct');
          },
          css: function css(queue, callback){
            queue.push(function(next){
              !!callback && callback.call($(this));
              next();
            });

          },
          click: function click(queue, delay){
            !!delay &&  this.delay(delay, 'tct');
            queue.push(function(next){
              $(this)
                .trigger('click')
              next();
            });
          },
          contextmenu: function contextmenu(queue, event, target, delay, callback){
            var self = this
              , offset = this.offset()
            ;

            !!delay &&  this.delay(delay, 'tct');
            queue.push(function(next){
              $(this).trigger({
                type: 'contextmenu',
                which: 3,
                pageY: offset.top+5,
                pageX: offset.left+5
              });
              !!target && $(target)
                .parentsUntil('#PRTGContextMenu>ul')
                .each(function(){
                  if(this.nodeName === 'UL')
                    $(this).css('display','block');
                });
              next();
            });
          }
      }
    ;

    return this.each(function(){
      var queue = $(this).queue('tct');

      if(queue.length === 0)
        queue = $(this).queue('tct', []);
      args.unshift($(this).queue('tct'));
      methods[method].apply($(this),args);
    });
  };
})(jQuery, window, document);
;
/* _Prtg.fileHandler.Plugin.js */
(function fileHandlerPlugin($, window, document, undefined) {

	var pluginName = 'prtg-fileHandler';

	function fileHandler(element, data, parent) {
		this.data = data;
		this.el = (!(element instanceof jQuery)) ? element : element[0];
		this.$el = (!(element instanceof jQuery)) ? $(element) : element;

		this.init();
	}

	fileHandler.prototype.init = function init() {

		if (this.$el.is('input') && this.$el.attr('type') == 'file') {
			fileUpload.call(this);
		} else if (this.$el.is('button') || this.$el.is('a') || this.$el.is('input') && this.$el.attr('type') == 'button') {

			var _this = this;

			this.$el.click(function click(evt) {

				var fileData = '';

				if ($(_this.data.filedata).length) {
					fileData = $(_this.data.filedata).html() || $(_this.data.filedata).val();
				} else if (_this.data.filedata in window && typeof window[_this.data.filedata] === 'function') {
					fileData = window[_this.data.filedata].call(_this, _this);
				} else {
					fileData = _this.data.filedata;
				}

				fileSave.call(_this, _this.data.filename, fileData);
			});
		}
	};

	var fileSave = function fileSave(fileName, data) {

		var blob = new Blob([data], { type: 'text/plain' });
		if (window.navigator.msSaveOrOpenBlob) {
			this.$el.click(function (e) {
				window.navigator.msSaveOrOpenBlob(blob, fileName);
				e.preventDefault();
			});
		} else {
			this.el.download = fileName;
			this.el.href = window.URL.createObjectURL(blob);
		}
	};

	var fileUpload = function fileUpload() {

		this.$el.hide();

		var id = this.$el.attr('id');

		if (!id) {
			id = randomId();
			this.$el.attr('id', id);
		}

		var presetValue=this.$el.attr('value');
		var fileNameLabel = $('<label class="fileHandlerTextLabel" for="' + id + '">'+(presetValue?presetValue:'')+'</label>').insertAfter(this.$el);
		var fakeButtonLabel = $('<label for="' + id + '" class="fileHandlerButtonLabel actionbutton"></label>').html(this.$el.attr('defaultValue')).insertAfter(this.$el);

		var _this = this;

		this.$el.change(function change(evt) {
			$(this).parent().removeClass('fileHandler-validateerror-field');
			$('.fileHandler-validateerror-text').remove();

			var file = {};

			if ('files' in evt.target && evt.target.files.length > 0) {
				file = evt.target.files[Object.keys(evt.target.files)[0]];
			} else {
				updateLabel(fileNameLabel, "");
				return
			}

			if (!('name' in file)) {
				return validError(this, _Prtg.Lang.FileHandler.strings.loadError);
			}

			var valid = 1;

			valid &= checkFileSize(file, _this, this);
			valid &= checkFileType(this);
			updateLabel(fileNameLabel, file.name);

			if (('filecontent' in _this.data) && $(_this.data.filecontent).length) {
				if (valid) {
					fileContent(file, _this.data.filecontent);
				} else {
					$(_this.data.filecontent).html('');
				}
			}

		});

	};

	var validError = function validError(el, text) {
		var $parentControl = $(el).parent();
		$parentControl.addClass('fileHandler-validateerror-field');
		$parentControl.append(
			$('<div id="' + el.name + '-error" class="fileHandler-validateerror-text">' + text + '</div>')
		);
		return false;
	};

	var checkFileSize = function checkFileSize(file, _this, uploadInput) {
		if (file && 'size' in file && file.size > _this.data.max) {
			return validError(uploadInput, _Prtg.Lang.FileHandler.strings.maxSize.printf({ max: (_this.data.max >> 20) }));
		}
		return true;
	};

	var checkFileType = function checkFileType(uploadInput) {
		var ext = '.' + uploadInput.value.split('.').pop().toLowerCase();
		if ($(uploadInput).attr('accept')) {
			var allowed = $(uploadInput).attr('accept').replace(/ /g, '').split(',');
			if (!~allowed.indexOf(ext)) {
				validError(uploadInput, _Prtg.Lang.FileHandler.strings.wrongExt);
				return false;
			}
		}

		return true;
	};

	var updateLabel = function updateLabel(fileNameLabel, fileName) {
		if (fileName.length > 60) fileName = '...' + fileName.substring(fileName.length - 60);
		fileNameLabel.html(fileName);
	};

	var fileContent = function fileContent(file, target) {

		var reader = new FileReader();

		reader.onload = function onload(evt) {
			$(target).val(evt.target.result);
		};

		reader.onerror = function onerror() {
			$(target).val('');
		};

		reader.readAsText(file);
	};

	var randomId = function randomId() {
		var id = Math.random().toString().replace('0.', 'ID');
		while (document.getElementById(id) !== null) {
			id = Math.random().toString().replace('0.', 'ID');
		}
		return id;
	};

	_Prtg.Plugins.registerPlugin(pluginName, fileHandler);
})(jQuery, window, document);

;
_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
	FileHandler: {
		strings: {
			'loadError': 'The file could not be loaded.',
			'maxSize': 'The maximum file size is {max} MB.',
			'wrongExt': 'This is the wrong file type.'
		}
	}
});
;
// _Prtg.MainMenuHandlers.js
(function ($, window, undefined) {

    var debounce = 0;
    var reload = 0;

    var mainMenuHandlers = function() {
        this.init();
    }

    mainMenuHandlers.prototype.init = function () {
        $(window).resize(resizeMainMenuDebounced);

        resizeMainMenuDebounced();

        $('footer').addClass('hovered').delay(3000).queue(function() {
            $(this).removeClass('hovered').dequeue();
        });
        
        menuClickAndHover();

         _Prtg.Events.subscribe('prtg.reload.menu', reloadMainMenuDebounced);
    }

    var reloadMainMenuDebounced = function(){
        clearTimeout(reload);
        reload = setTimeout(reloadMainMenu, 200);
    }

    var reloadMainMenu = function () {
        if ($('#main_menu').length) {
            $('#main_menu').parent().load('/controls/menu.htm', function() {
                resizeMainMenuDebounced();
                menuClickAndHover();
            });
        }
    }

    var resizeMainMenuDebounced = function() {
        clearTimeout(debounce);
        debounce = setTimeout(resizeMainMenu, 200);
    }

 /* –––– set menu lvl 3 list position (top, left) on window resize –––– */
    var resizeMainMenu = function () {
        !!_Prtg.Events && _Prtg.Events.publish('prtg.resize.layout');

        var mh = $('header.header').outerHeight()
        $('div.header-spacer').css("height", mh + "px")

        var topSpacing = 40,
            leftSpacing = 30,
            header = $('.js-header'),
            footer = $('.footer'),
            windowWidth = $(window).width(),
            windowHeight = $(window).height(),
            bigMenu = window.innerWidth > 1880,
            smallMenu = window.innerWidth < 1150,
            mediumMenu = !bigMenu && !smallMenu;

        if(mediumMenu) {
            topSpacing = 70;
            leftSpacing = 0;
        }

        // Fix if you change from mobile to desktop menu
        $('#main_menu li.active').removeClass('active');

        var init = function() {
            $('#main_menu > li > ul').each(function(k,el) {
                editMenu($(el),true)
                $(el).find('> li > ul').each(function(k2,el2) {
                    editMenu($(el2))
                    $(el2).find('> li > ul').each(function(k3,el3) {
                        editMenu($(el3))
                        $(el3).find('> li > ul').each(function(k4,el4) {
                            editMenu($(el4))
                        })
                    })
                })
            })
        };

       var editMenu = function(elem,root) {

            // init / reset
            $(window).scrollTop(0);
            elem.css({
                top:root?30:0,
                marginTop:0,
                marginLeft:0,
                left:'',
                maxHeight:'',
                overflowY:'',
                overflowX:''
            });
            elem.removeClass('groupedList');

            if(smallMenu) return;

            var letterBox=elem.find('>li>a').toArray().some(function(v,k) {
                var text=$(v).text().trim();
                return (text.length==2 && text.indexOf('…')===1);
            });

            var fitsIntoView = ((elem.height() + topSpacing + header.height() + footer.height()) < windowHeight);

            // is too big to display in view, so we need scrollsbars
            if(!fitsIntoView) {
                if(letterBox) {
                    elem.addClass('groupedList');
                }else if(elem.find('ul').length==0) {

                    var maxHeight = windowHeight - header.height() - footer.height() - topSpacing;
                    if(!fitsIntoView) elem.css('maxHeight',maxHeight);

                    elem.css({overflowY: "auto", overflowX: "hidden"});
                }
            }


            // needs to be moved higher, else it leaves view at bottom
            if(!root && elem.height()+elem.offset().top > windowHeight) {
                
                var minusHeight = -elem.height()+elem.parent().height();
                var nearlyTop = -elem.parent().offset().top+topSpacing;

                elem.css({marginTop:(minusHeight<nearlyTop?nearlyTop:minusHeight)});
            }

            if(elem.parent().parent().hasClass('groupedList')) elem.css({'zIndex':1 });

            if(elem.width()+elem.offset().left > windowWidth){
                var marginLeft = windowWidth-elem.width()-elem.offset().left-20;
                var parentUls=elem.parents('ul:not(#main_menu)');
                if(parentUls.length) marginLeft = -elem.parents().outerWidth()-elem.width()-10;
                elem.css({marginLeft: marginLeft,'z-index':1})
            }
        }

        init();
    };

    /* ––––––––––––––––––––––––––––––––––––––––––––––––––
                  Menu Click & Hover Handling
    –––––––––––––––––––––––––––––––––––––––––––––––––– */
    var menuClickAndHover = function(){

        var e = $('.js-header'),
        allLi = e.find('li'),
        burgerMenuIcon = $('.js-menuIcon');

        allLi.each(handleSubMenu);

        $(window).mousemove(function(event){
            'timeout' in this && clearTimeout(this.timeout);
            this.timeout=setTimeout(delayMenuHover,250,event.target);
        });

        burgerMenuIcon.click(function (event) {
            event.preventDefault();
            $(event.target).closest('.menu-wrapper').toggleClass('active');
        });

        function handleSubMenu(key,liElem){
            liElem=$(liElem);
            if (liElem.has("ul").length) {
              //adding an arrow icon and handling clicking on that or the li itself for mobile handling
              var triggerArrow = $('<span></span>').addClass("ui-icon header_menu-trigger js-menuIcon");
              liElem.prepend(triggerArrow);
              liElem.click(handleMenuClick);
              triggerArrow.click(handleMenuClick);
            }
        }

        function delayMenuHover(target){

            if($(target).parents('#main_menu').length){
                $(target).parents('li').addClass('hovered').addClass('new_hovered');
                $('.hovered:not(.new_hovered)').removeClass('hovered');
                $('.new_hovered').removeClass('new_hovered');
                $(target).addClass('hovered');
            }else{
                $('.hovered').removeClass('hovered');
            }
        }


        function handleMenuClick(event) {

            if($(event.target).is('a')){
                $('.menu-wrapper').removeClass('active');
                return;
            }

            if ($(window).width() < 1150) {
              event.preventDefault();
              event.stopImmediatePropagation();

              var target = $(event.target);

              if (!target.is("li")) {
                target = target.closest('li');
              }

              target.siblings().removeClass('active');
              target.toggleClass('active');
            }
        }
    }

    _Prtg.Plugins.registerPlugin("main-menu-handlers", mainMenuHandlers);

})(jQuery, window, document);;
// _Prtg.GoogleMapsCheck.Plugin.js
(function prtgGoogleMapsCheckPlugin($, window, document, undefined) {
    var pluginName = 'prtg-plugin-googlemaps-check';
   
    function GoogleMapsCheck(element, data, parent) {
      this.data = data;
      this.el = (!(element instanceof jQuery)) ? element : element[0];
      this.$el = (!(element instanceof jQuery)) ? $(element) : element;
      var isGoogleMap = this.$el.children('div').hasClass('google');
      this.$el.removeClass('geomap-error');
  
      if (isGoogleMap) {
        this.init();
      }
    }
  
    GoogleMapsCheck.prototype.init = function() {
      var self = this;
      var $image = self.$el.find('img');
      
      $image.on('error', function(event) {
        $.ajax({
          url: event.target.currentSrc,
          beforeSend: function(jqXHR){
            jqXHR.peNumber = 'PE1004'
          }
        }).fail( function(jqXHR) {
          var errorTitle = _Prtg.Lang.Geomaps.strings.geomapserrortitle;
          var errorMessage = jqXHR.responseText;

          self.$el.addClass('geomap-error');
          self.$el.html('<div><h3>' + errorTitle + '</h3><p>' + errorMessage + '</p></div>');

          _Prtg.api.logError(
            "Error in plugin: " + pluginName + ' - Error-Msg: ' + errorMessage + ' - PE:' + (jqXHR.peNumber || 'none'),
            {global:false}
          );
        });
      });
    }
    
    _Prtg.Plugins.registerPlugin(pluginName, GoogleMapsCheck);
  
  })(jQuery, window, document);
;

// Module: report select sensors manually
_Prtg.Lang=_Prtg.Lang||{};$.extend(true,_Prtg.Lang,{reportchannels:{strings:{"reorder":'Drag and Drop to Sort'}}});
;
// _Prtg.ReportsChannelList.Plugin.js
(function($, window, document, undefined) {
	var pluginName = "prtg-reportchannellist";

	function Plugin(element, data, parent) {
		this.data = data;
    this.data.objects = this.loadDataFromHtmlComment('reportchannels-data-objects');
		this.el = (!(element instanceof jQuery)) ? element : element[0];
		this.$el = (!(element instanceof jQuery)) ? $(element) : element;
		this.$parent = (!(parent instanceof jQuery)) ? $(parent) : parent;

		this.coreObject = $.extend(true,{data:{id:data.objectid}},_Prtg.Core.getObject(data.template));
		this.init(this);
	}

	Plugin.prototype.init = function(me) {
		var id = me.data.objectid;

		me.$nirvana =
		me.$parent
			.on('resize.objecttree',function(){
				me.$parent.find('#reportChannelList').css('max-height',$('.rootTree',this).height());
			})
			.on('click.report', '.deleteItem, #nirvana', me, me.remove)
			// .on('click.report', '.sortItems', me, me.switchSorting)
			.on('change.report','input:checkbox', me, me.change)
			.on('add.report','input:checkbox', me, me.add)
			.find(me.data.multiselectDelete);
		me.$el.sortable({
				handle: '.reorder',
				axis: "y",
				revert: true,
				update: function(event, ui) {
					var subids = []
						, objids = [];
					me.$el.find('.channelItem').each(function(){
						subids.push($(this).data().reportNodeId);
						objids.push($(this).data().objid);
					});
					$.ajax({
						url: '/api/deletesubobject.htm',
						data: {
							id: id,
							subid: subids.join(',')
						}
					}).done(function(){
							$.ajax({
								url: '/api/reportaddsensor.htm',
								data: {
									id: id,
									addid: objids.join(',')
								}
							}).done(function(){
								me.refresh();
							});
					});
				}
			})
			.selectable({
				cancel: '.deleteItem,:input,option, label,reorder,a',
				selected: function () { me.$nirvana.show(); },
				unselected: function () {
					if (me.$el.find('.ui-selected').length === 0) {
						me.$nirvana.hide();
					}
				}
			});
		me.update(me.data.objects.reportnodes);

		me.$el.removeAttr('data-objects');
		//me.sorts().current.apply($('.sortItems.ui-icon-triangle-1-n')[0]);
	};

  Plugin.prototype.loadDataFromHtmlComment = function(commentid) {
    var $comment = $('#' + commentid);
    var comment = $.trim($comment.html());
    var commentLength = comment.length;
    var dataBegin = comment.indexOf('{');
    var data;
    data = JSON.parse(comment.substr(dataBegin, commentLength-3-dataBegin));
    $comment.remove();
    return data;
  };

	Plugin.prototype.sorts = function(){
			var e = null
				, x = {
				'none': ['ui-icon-triangle-2-n-s', function (a, b) { return b - a; } ],
				'up': ['ui-icon-triangle-1-n', function (a, b) { return a === b ? 0 : a > b ? 1 : -1; } ],
				'down': ['ui-icon-triangle-1-s', function (a, b) { return a === b ? 0 : a < b ? 1 : -1; } ]
			};
			return {
				current: function () {
					if (this !== window) {
						if (!!e && e !== this) {
							var i = $(e).data().sort.type;
							$(e).removeClass(x[i][0]).addClass(x['none'][0]);
							$(e).data().sort.type = 'none';
						}
						e = this;
					}
					return { 'sort': x[$(e).data().sort.type || 'none'], 'field': $(e).data().sort.field };
				},
				next: function () {
					var i = $(this).data().sort.type || 'none';
					$(e).removeClass(x[i][0]);
					i = i === 'none' ? 'up' : i === 'up' ? 'down' : 'up';
					$(e).addClass(x[i][0]);
					$(this).data().sort.type = i;
					return { 'sort': x[i], 'field': $(this).data().sort.field };
				}
			};
	};

	Plugin.prototype.refresh = function(){
		var self = this;
		return $.ajax({
			global: false,
			dataType: 'text json',
			url: this.coreObject.url,
			data: this.coreObject.data
		}).done(function(d) {
			self.update(d.reportnodes);
		});
	};

	Plugin.prototype.update = function(d) {
		var me= this
			, $self = me.$el
			, p = me.$el.parent();
		$self.detach()
			.empty()
			.append($.jqote(this.coreObject.template, d));

		if(d.length === 0)
			p.find('.centeredHint').show().delay(8000).fadeOut(2000);
		else
			p.find('.centeredHint').hide();

		p.append($self);
//		$self.triggerHandler('changed',{data:d});
		me.currentData = d;

		var subids=[], objids=[];
		$self.find('.channelItem').each(function(){
			subids.push($(this).data().reportNodeId);
			objids.push($(this).data().objid);
		});
	};

	Plugin.prototype.getData = function(){
		return [];//this.currentData;
	};

	Plugin.prototype.add = function(objid, e,d){
		var self = this
			, opts = this.settings
			, dfd = $.Deferred();

		self.$el.css('opacity', 0.3).append("<center class='loading'><span class='loadspinner'></span></center>");
		$.ajax({
			url: '/api/reportaddsensor.htm',
			data: {
				id: self.data.objectid,
				addid: objid
			}
		}).done(function(html){
			self.refresh().always(function (data) {
				//self.sorting();
				self.$el.css('opacity', 1);
				var $elm = self.$el.find('div[objid="' + objid + '"]').css('opacity', 0.3);
				$elm[0].scrollIntoView();
				$elm.fadeTo(3000, 1);
				dfd.resolve(data);
			});
		});
		return dfd.promise();
	};

	Plugin.prototype.reorder = function(e,d){
		var $this = $(this)
			, me = e.data;

	};

	Plugin.prototype.remove = function(e){
		var $this = null
			, me = e.data
			, subids=[]
			, purged=[];

		if ($(e.target).hasClass('deleteItem')){
			$(this).closest('.channelItem').addClass('ui-selected');
			me.$nirvana.show();
		}
		$this = me.$el.find('div[objid].ui-selected').not('.disabled').addClass('disabled');

		$.each($this, function(){
			var $self = $(this);
			subids.push($self.data().reportNodeId);
			purged.push($.extend(true,{purge:true},$self.data()));
		});
		if(subids.length > 0)
			$.ajax({
				url:'/api/deletesubobject.htm',
				data: {
					id: me.data.objectid,
					subid: subids.join(',')
				}
			}).done(function(){
				$this.effect('transfer', { to: '#nirvana', className: 'ui-effects-transfer' },
          500,
					function () {
						$(this).remove();
						me.$nirvana.hide();
						//me.$el.triggerHandler('changed',{data:purged});
						me.refresh();
				});
			});
	};

	Plugin.prototype.change = function(e){
			var $self = $(this)
				, url = '';
			if ($self.is(":checked") === true)
				url = '/api/reportaddsensorchannel.htm';
			else
				url = '/api/reportdeletesensorchannel.htm';
			$.ajax({ url: url,
				data: {
					id: e.data.data.objectid,
					repnodeid: $self.data().reportNodeId,
					channelid: $self.data().channelId
				},
				type: "GET"
			});

	};
/*
					sorting: function sorting() {
						var c = sorts.current.apply(window),
							p = $list.parent();
						$list.detach();
						$list.html($list.find('.sortItem').sort(function (a, b) {
							return c.sort[1]($(a).data().sortData[c.field], $(b).data().sortData[c.field]);
						}));
						p.append($list);
						makeButtonSets($list);
					},
					switchSorting: function switchSorting(e) {
						sorts.current.apply(this);
						sorts.next.apply(this);
						e.data.report.sorting();
					},
*/
	$.fn[pluginName] = function(data, parent) {

    return this.each(function() {
			if (!$.data(this, 'plugin_' + pluginName)) {
				$.data(this, 'plugin_' + pluginName, new Plugin(this, data, parent));
			}
		});
	};

})(jQuery, window, document);
;

// Module: crumbler
//_Prtg.CrumblerSensorStats.lang.js
_Prtg.Lang = _Prtg.Lang || {
    ___: '_Prtg.Lang'
};
$.extend(true, _Prtg.Lang, {
    crumbler: {
        strings: {
            "failovermaster1": 'This failover node is current master',
            "failovermaster2": 'This failover node is your current master node because your primary node is not connected to this cluster. You can modify the monitoring configuration, but as soon as the primary node reconnects to the cluster all your changes will be overwritten by the configuration of the primary node.',
            "failovernode1": 'This is a failover node (read-only).',
            "failovernode2": 'You can only access monitoring results. You cannot change the configuration.',
            "AutoDiscovery": 'Auto-Discovery',
            "CacheCalculation": 'Cache Calculation',
            "Reporting": 'Reporting',
            "BackgroundTask": 'Active Background Tasks',
            "CorrelationTask": 'Similar Sensors Detection',
            "Warning": 'Warning',
            "overload": 'Overload protection is active! Click to learn more.',
            "activationrequired": 'Activation Required!',
            "LowMem": 'Attention: Core system is low on memory, stability may be affected!',
            "prolong1a": 'Click here to renew your maintenance!',
            "prolong2b": '<b>Your software maintenance will expire in ||days|| days.</b><br>',
            "prolong3b": '<b>Your maintenance expired ||days|| days ago.</b><p>Without maintenance, you are not able to download and install new PRTG versions.</p>',
            "POPLicense": 'Once the trial has ended, you can continue to use PRTG with 100 sensors for free. If you need more sensors, click here to buy one of our commercial licenses.',
            "PODLicense": 'Once the trial has ended, your PRTG Hosted Monitor instance and all of your data will be deleted.<br><br>Please consider upgrading to one of our commercial plans to avoid losing your configuration, sensors, and monitoring data.',
            "PODSubdomain": '',
            "trialhasexpired": '<b>Your trial license expired ||days|| days ago.</b><br>',
            "trialwillexpire1a": '<b>Your trial license will expire in ||days|| days.</b><br>',
            "trialwillexpire2a": '<b>Your trial license will expire in ||days|| days.</h2>',
            "trialwillexpire2ah": '<h2>Your trial license will expire in ||days|| days.</h2>',
            "commercialwillexpire": '<h2>Your license will expire in ||days|| days.</h2><br>',
            "commercialPlusNeedsToBeRevalidated_Title": '<h2>License Revalidation Failed</h2><br>',
            "commercialPlusNeedsToBeRevalidated": 'The PRTG server could not reach the Paessler activation servers. Your license needs to be revalidated within the next ||days|| days to ensure continuous monitoring!<br>Please try to manually refresh your license.</h2><br>',
            "clickformoreinfo": 'Click here for more information!'
        }
    }
});

//_Prtg.CrumblerSensorStats.js
(function ($, window, undefined) {
    var pluginName = 'crumblerSensorStats';

    function Plugin(elements, data, parent) {
        this.elements = elements;
        this.$parent = $(parent);
        this._name = pluginName;
        this.id = null;
        this.confirmedGrowls = {};
        this.stats = $.each({
                'alert': {'value': 'NewAlarms'},
                'message': {'value': 'NewMessages'},
                'newtickets': {'value': 'NewTickets'},
                'downsens': {'value': 'Alarms'},
                'partialdownsens': {'value': 'PartialAlarms'},
                'downacksens': {'value': 'AckAlarms'},
                'warnsens': {'value': 'WarnSens'},
                'upsens': {'value': 'UpSens'},
                'pausedsens': {'value': 'PausedSens'},
                'unusualsens': {'value': 'UnusualSens'},
                'undefinedsens': {'value': 'UnknownSens'}
            },
            function (i, o) {
                o['element'] = $('.statusinfo.' + i, elements);
                o['text'] = o['element'].find('.counter');
                var t = !!o['element'].attr('title') ? 'title' : 'data-original-title';
                t = o['element'].attr(t);
                if (!!t && t.indexOf('x') !== -1)
                    o['title'] = 'x' + t.split('x')[1];
            });
        _Prtg.lastStats = {};
        this.init(this);
    }

    Plugin.prototype.init = function (me) {
        $('#new_message', this.elements).click(function () {
            me.resetnewmessagestimestamp();
            $(this).parent().fadeOut("slow");
            return true;
        });
        $('#new_alarms', this.elements).click(function () {
            me.resetnewmessagestimestamp();
            $(this).parent().fadeOut("slow");
            return true;
        }).effect("pulsate", {times: 10}, 1500);


        if (_Prtg.Options.refreshType === 'none') $('#footerrefresh').css('visibility', 'hidden');

        _Prtg.Events.subscribe('refreshstatus.events.prtg', $.proxy(crumblerSensorStats, this));
        function crumblerSensorStats(event, s) {
            var me = this;
            var mymsg = "";

            if ((!!_Prtg.lastStats.hasOwnProperty('ClusterType')
                && _Prtg.lastStats.ClusterType !== s.ClusterType)
                || (!!_Prtg.lastStats.hasOwnProperty('ReadOnlyUser')
                && _Prtg.lastStats.ReadOnlyUser !== s.ReadOnlyUser)) {
                document.location.reload();
                return;
            }

            s.Alarms = parseInt(s.Alarms + 0, 10) / 10;
            ///*IE only supports ICO file format */
            
            if (s.Alarms > 0) {
                Tinycon.setImage('/icons/favicon_red.png')
            } else {
                Tinycon.setImage('/favicon.ico')
            }
            Tinycon.setBubble(s.Alarms);
            

                $.each(me.stats, function (i, o) {
                    var txt = s[o['value']] + o['title']
                        , attr = (!!o['element'].attr('title') ? 'title' : 'data-original-title');
                    if (!!o['title']) o['element'][0].setAttribute(attr, txt);
                    o['text'].text(s[o['value']]);
                    s[o['value']] = parseInt(0 + s[o['value']], 10);
                    if (s[o['value']] > 0) {
                        o['element'].removeClass('display0').show();
                    } else {
                        o['element'].hide();
                    }
                });

            if (parseInt(s.NewAlarms + 0, 10) > 0) {
                _Prtg.desktopNotification.showAlarms(s.NewAlarms);
            }
            if (parseInt(s.BackgroundTasks + 0, 10) > 0) {
                mymsg += " <a href='/status.htm'>" + s.BackgroundTasks + "x " + _Prtg.Lang.crumbler.strings.CacheCalculation + "</a><br>";
            }
            if (parseInt(s.CorrelationTasks + 0, 10) > 0) {
                mymsg += " <a href='/status.htm'>" + s.CorrelationTasks + "x " + _Prtg.Lang.crumbler.strings.CorrelationTask + "</a><br>";
            }
            if (parseInt(s.AutoDiscoTasks + 0, 10) > 0) {
                mymsg += " <a href='/status.htm'>" + s.AutoDiscoTasks + "x " + _Prtg.Lang.crumbler.strings.AutoDiscovery + "</a><br>";
            }
            if (parseInt(s.ReportTasks + 0, 10) > 0) {
                mymsg += " <a href='/reports.htm'>" + s.ReportTasks + "x " + _Prtg.Lang.crumbler.strings.Reporting + "</a>";
            }
            if (mymsg !== "") {
                _Prtg.Growls.add({
                    id: 'backroundtask',
                    type: "info",
                    title: _Prtg.Lang.crumbler.strings.BackgroundTask,
                    message: mymsg,
                    time: _Prtg.Options.refreshInterval + 3
                });
            }
            if (s.LowMem) {
                _Prtg.Growls.add({
                    id: 'lowmem',
                    type: "warning",
                    title: _Prtg.Lang.crumbler.strings.Warning,
                    message: _Prtg.Lang.crumbler.strings.LowMem,
                    time: _Prtg.Options.refreshInterval + 3
                });
            }
            if (s.Overloadprotection == true) {
                _Prtg.Growls.add({
                    id: 'overload',
                    type: "warning",
                    time: _Prtg.Options.refreshInterval * 3,
                    title: _Prtg.Lang.crumbler.strings.Warning,
                    message: '<a href="https://kb.paessler.com/en/topic/25523?utm_source=prtg&utm_medium=referral&utm_campaign=webgui-kb" target="_blank">' + _Prtg.Lang.crumbler.strings.overload + '</a>'
                });
            }
            if (!!s.ClusterType) {
                $("#clusterstatus").html(s.ClusterNodeName);
                if (s.ClusterType === 'clustermaster') $("clustergrowl").hide();
                if (s.ClusterType === 'failovermaster') {
                    _Prtg.Growls.add({
                        id: 'clustergrowl',
                        type: "warning",
                        title: _Prtg.Lang.crumbler.strings.failovermaster1,
                        message: '<a href="https://kb.paessler.com/en/topic/7663?utm_source=prtg&utm_medium=referral&utm_campaign=webgui-kb" target="_blank">' + _Prtg.Lang.crumbler.strings.failovermaster2 + '</a>',
                        time: _Prtg.Options.refreshInterval * 3
                    });
                }
                if (s.ClusterType === 'failovernode') {
                    _Prtg.Growls.add({
                        id: 'clustergrowl',
                        type: "info",
                        title: _Prtg.Lang.crumbler.strings.failovernode1,
                        message: '<a href="https://kb.paessler.com/en/topic/7663?utm_source=prtg&utm_medium=referral&utm_campaign=webgui-kb" target="_blank">' + _Prtg.Lang.crumbler.strings.failovernode2 + '</a>',
                        time: _Prtg.Options.refreshInterval * 3
                    });
                }
            }
            _Prtg.lastStats = null;
            _Prtg.lastStats = s;

            if (!me.growlIsConfirmed('growltrial')
                && s.TrialExpiryDays !== '-999999'
                && $.isNumeric(s.TrialExpiryDays))
                me.checkExpiryDays(parseInt(s.TrialExpiryDays, 10), false)
                    .off('click.confirm')
                    .on('click.confirm', '#closehelp', $.proxy(me.growlConfirm, me, 'growltrial'));

            if (!me.growlIsConfirmed('growlcommercial')
                && s.CommercialExpiryDays !== '-999999'
                && $.isNumeric(s.CommercialExpiryDays))
                me.checkExpiryDays(parseInt(s.CommercialExpiryDays, 10), true)
                    .off('click.confirm')
                    .on('click.confirm', '#closehelp', $.proxy(me.growlConfirm, me, 'growlcommercial'));


            if (!me.growlIsConfirmed('growlmaint')
                && $.isNumeric(s.MaintExpiryDays))
                me.checkMaintExpiryDays(parseInt(s.MaintExpiryDays, 10))
                    .off('click.confirm')
                    .on('click.confirm', '#closehelp', $.proxy(me.growlConfirm, me, 'growlmaint'));

            _Prtg.Events.publish('newstats.prtg', _Prtg.lastStats);

            if (!!s.Warnings) {
                s.Warnings.forEach(function (elm) {
                    if (!me.growlIsConfirmed(elm.id)) {
                        _Prtg.Growls.add(elm)
                            .off('click.confirm')
                            .on('click.confirm', '#closehelp', $.proxy(me.growlConfirm, me, elm.id));
                    }
                });
            }

            checkAndPlayAudibleAlarm.call(_Prtg.lastStats);
        }

        _Prtg.Events.subscribe('playalarm.events.prtg', $.proxy(checkAndPlayAudibleAlarm, _Prtg.lastStats));
        function checkAndPlayAudibleAlarm() {
            if (this.NewAlarms > 0) _Prtg.AudibleAlarm.playAlarm();
        }

        me.bindLiveChat();
        me.checkTimezone();
    };

    Plugin.prototype.checkTimezone = function () {
        var storedValue = true;
        if (typeof localStorage !== 'undefined') {
          storedValue = JSON.parse(localStorage.getItem('showTimezoneMismatch'));
        }

        if(storedValue || storedValue === null) {
          var browserdate = new Date();
          var $timezoneWarning = $('.js-timezoneMismatch');
          var $content = $timezoneWarning.find('.js-timezone-textreplace');

          if (browserdate.getTimezoneOffset() != parseInt(_Prtg.Options.userTimezone.offset)) {
              var browserTimezoneName = browserdate.toString().split('(')[1].split(')')[0];
            $content.html($content.html()
              .replace('${user_set_timezone}', _Prtg.Options.userTimezone.name)
              .replace('${browser_set_timezone}', browserTimezoneName)
            );
            $timezoneWarning.css('display', 'block');
          }

          $timezoneWarning.find('.js-timezone-ignore').click(function () {
            localStorage.setItem("showTimezoneMismatch", 'false');
            $timezoneWarning.css('display', 'none');
          });

          localStorage.setItem("showTimezoneMismatch", 'true');
        }
    };

    Plugin.prototype.bindLiveChat = function () {
        var LC_API = window.LC_API || {};
        var button = $('.js-livechat_button');

        LC_API.on_after_load = function() {
            if (LC_API.agents_are_available()) {
                button.click(function(){
                    LC_API.open_chat_window();
                });
                button.show();
            }
            else button.remove();
        };
    };

    Plugin.prototype.growlIsConfirmed = function (id) {
        if (!id) return;
        try {
            this.confirmedGrowls = JSON.parse(window.sessionStorage.getItem('Growls')) || {};
        } catch (e) {
            this.confirmedGrowls = {};
        }
        return this.confirmedGrowls.hasOwnProperty(id) && this.confirmedGrowls[id].isconfirmed;
    }
    Plugin.prototype.growlConfirm = function (id) {
        if (!id) return;
        this.confirmedGrowls[id] = {"isconfirmed": true};
        try {
            window.sessionStorage.setItem('Growls', JSON.stringify(this.confirmedGrowls));
        } catch (e) {
            this.confirmedGrowls = {};
        }
    }
    Plugin.prototype.checkMaintExpiryDays = function (expirydays) {
        var getlic = _Prtg.Lang.crumbler.strings.prolong1a;
        var expireText = [
            _Prtg.Lang.crumbler.strings.prolong2b,
            _Prtg.Lang.crumbler.strings.prolong3b
        ];
        expireText[0] = expireText[0].replace("||days||", expirydays);
        expireText[1] = expireText[1].replace("||days||", -expirydays);

        if ((expirydays <16) && (expirydays > 0)) {
            return _Prtg.Growls.add({
                id: 'growlmaint',
                type: "warning",
                title: _Prtg.Lang.crumbler.strings.Warning,
                message: expireText[0] +'<a class="actionbutton" target="_blank" href="https://shop.paessler.com/shop/prtg/maintenance/?license_hash=41bc6861fbb9da11f6ca6d868ac197912bbaf908&utm_source=prtg&utm_medium=referral&utm_campaign=webgui-prolongmaintenance1&utm_content=maintenance">' + getlic + '</a>',
                time: 99999
            });
        }
        if ((expirydays <= 0) && (expirydays > -10)) {
            return _Prtg.Growls.add({
                id: 'growlmaint',
                type: "warning",
                title: _Prtg.Lang.crumbler.strings.Warning,
                message: expireText[1] + '<a class="actionbutton" target="_blank" href="https://shop.paessler.com/shop/prtg/maintenance/?license_hash=41bc6861fbb9da11f6ca6d868ac197912bbaf908&utm_source=prtg&utm_medium=referral&utm_campaign=webgui-prolongmaintenance2&utm_content=maintenance">' +  getlic + '</a>',
                time: 99999
            });
        }
        return $();
    };

    Plugin.prototype.checkExpiryDays = function (expirydays, iscommercial) {
        if (!expirydays || expirydays == -999999) {
            return $();
        } // freeware/commercial/POD/MSP/expired

        var getlic = !!_Prtg.lastStats && _Prtg.lastStats.EditionType !== "PT" ? _Prtg.Lang.crumbler.strings.POPLicense : _Prtg.Lang.crumbler.strings.PODLicense;
        var expireText = [
            _Prtg.Lang.crumbler.strings.trialwillexpire1a,
            _Prtg.Lang.crumbler.strings.trialwillexpire2a,
            _Prtg.Lang.crumbler.strings.trialwillexpire2ah,
            _Prtg.Lang.crumbler.strings.trialhasexpired,
            _Prtg.Lang.crumbler.strings.commercialwillexpire,
            _Prtg.Lang.crumbler.strings.commercialPlusNeedsToBeRevalidated
        ];

        expireText[0] = expireText[0].replace("||days||", expirydays);
        expireText[1] = expireText[1].replace("||days||", expirydays);
        expireText[2] = expireText[2].replace("||days||", expirydays);
        expireText[3] = expireText[3].replace("||days||", -expirydays);
        expireText[4] = expireText[4].replace("||days||", expirydays);
        expireText[5] = expireText[5].replace("||days||", expirydays);

        if (iscommercial) {
            if (_Prtg.lastStats.EditionType === "Cplus") {
                if ((expirydays <14) && (expirydays > -1)) {
                    var growlTypeCplus = "warning";
                    if (expirydays <7) {
                        growlTypeCplus = "error";
                    }
                    return _Prtg.Growls.add({
                        id: 'growlcommercial',
                        type: growlTypeCplus,
                        title: _Prtg.Lang.crumbler.strings.commercialPlusNeedsToBeRevalidated_Title,
                        message:  expireText[5] + '<br><br><a  href="/licensing.htm?tabid=1">' +  _Prtg.Lang.crumbler.strings.clickformoreinfo + '</a>',
                        time: 99999
                    });
                }
            } else {
                if ((expirydays <32) && (expirydays > -1)) {
                    return _Prtg.Growls.add({
                        id: 'growlcommercial',
                        type: "warning",
                        title: expireText[4],
                        message: '<a  href="/licensing.htm?tabid=1">' +  _Prtg.Lang.crumbler.strings.clickformoreinfo + '</a>',
                        time: 99999
                    });
                }
            }
        } else {
            if (_Prtg.lastStats.EditionType == "PT") {
                if (expirydays <7) {
                    return addTrialGrowl(expireText[1], ' https://app.my-prtg.com/');
                }
            } else {
                if (expirydays <0) {
                    if(expirydays > -20) {
                        return addTrialGrowl(expireText[3], "https://www.paessler.com/order?utm_source=prtg&utm_medium=referral&utm_campaign=webgui-trialexpired4");
                    }
                }
                else if (expirydays <8) {
                    return addTrialGrowl(expireText[2], "https://www.paessler.com/order?utm_source=prtg&utm_medium=referral&utm_campaign=webgui-trialexpired3");
                }
                else if (expirydays <14) {
                    return addTrialGrowl(expireText[1], "https://www.paessler.com/order?utm_source=prtg&utm_medium=referral&utm_campaign=webgui-trialexpired2");
                }
                else if (expirydays <20)  {
                    return addTrialGrowl(expireText[0], "https://www.paessler.com/order?utm_source=prtg&utm_medium=referral&utm_campaign=webgui-trialexpired1");
                }
            }
        }
        return $();

        function addTrialGrowl(trialGrowlTitle, trialGrowlHref) {
            return _Prtg.Growls.add({
                id: 'growltrial',
                type: "warning",
                title: trialGrowlTitle,
                message: '<a target="_blank" href="'+trialGrowlHref+'">' + getlic + '</a>',
                time: 99999
            })
        }
    };


    Plugin.prototype.resetnewmessagestimestamp = function () {
        $.ajax({
            url: "/api/resetnewmessagestimestamp.htm",
            dataType: "text",
            type: "GET",
            beforeSend: function (jqXHR) {
                jqXHR.ignoreManager = true;
            },
            success: function () {
                try {
                    window.localStorage.setItem("newalarmcount", 0);
                } catch (err) {
                }
            }
        });
    };
    _Prtg.Plugins.registerPlugin(pluginName, Plugin);

})(jQuery, window, document);


// Module: Maps
_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
  Maps: {
    strings: {
      'dragtocreate': 'Drag to create a connector',
      'linktoobjecttext': 'Select a PRTG Object or Map to Link to',
      'linktoobjectdialogtabobject': 'Objects',
      'linktoobjectdialogtabmaps': 'Maps',
      'loadingtext': 'Loading',
      'previewtext': 'Preview'
    }
  }
});
;
/* _Prtg.Maps.js */
(function prtgMapsPlugin($, window, document, undefined) {
  var pluginName = 'prtg-maps';

  function prtgMaps(element, data, parent) {
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.$parent = (!(parent instanceof jQuery)) ? $(parent) : parent;
    this.$objectpanel = this.$el.find('div.objectpanel');
    this.$probpanel = this.$el.find('div.probpanel');


    this.mode = data.mode;
    this.isInputFocused = false;
    this.connections = data.connections;
    this.mObjInfo = {};

    this.historydata = data.historydata;

    this.autoscale = data.autoscale;

    this.previewShowtimer = null;
    this.previewAjax = null;
    this.previewHover = false;

    this.snapToGrid = true;

    this.map = {
      id: parseInt(data.mapid, 10),
      width: parseInt(data.mapwidth, 10),
      height: parseInt(data.mapheight, 10)
    };

    this.selectedObjects = [];

    this.svg = d3.select('#mapsvg');
    this.svgDefs = this.svg.append('svg:defs');

    if (this.mode === 'edit') {
      this.initMapEditor();
    } else {
      this.initMapView();
    }
  }

  prtgMaps.prototype.mapAutoScale = function mapAutoScale() {
    var $map = $('#mapview');
    var $view = $('#mapshow');

    var mapHeight = $map.height();
    var mapWidth = $map.width();

    var viewWidth = $view.innerWidth();
    var viewHeight = $view.innerHeight();

    var widthFactor;
    var heightFactor;
    var factor;

    widthFactor = (viewWidth / mapWidth);
    heightFactor = (viewHeight / mapHeight);
    if (widthFactor > heightFactor) factor = heightFactor;
    else factor = widthFactor;

    $map.css('-moz-transform', 'scale(' + factor + ')');
    $map.css('-moz-transform-origin', '0 0');
    $map.css('-ms-transform', 'scale(' + factor + ')');
    $map.css('-ms-transform-origin', '0 0');
    $map.css('transform', 'scale(' + factor + ')');
    $map.css('transform-origin', '0 0');
    if ($map.parent('.scalewrapper').length) {
      $map.parent('.scalewrapper').css({
        'width': $map.innerWidth() * factor,
        'height': $map.innerHeight() * factor
      });
    } else {
      $map.wrap($('<div/>', {'class': 'scalewrapper'}).css({
        'position': 'absolute',
        'width': $map.innerWidth() * factor,
        'height': $map.innerHeight() * factor,
        'overflow': 'hidden'
      }));
    }
  };

  prtgMaps.prototype.initMapView = function initMapView() {
    var self = this;

    function resize(offsetTop, footerAtr, scale) {
      var e = $('#loadedcontent').parent();
      var d = e.find('#mapshow');
      var h = Math.floor(window.innerHeight - offsetTop);
      var footer = !!footerAtr && footerAtr.length > 0 ? footerAtr[0] : false;
      if (!!footer) {
        h -= footer.offsetHeight + 19;
      }
      d.height((Math.floor(d.css('min-Height'), 10) > h ? Math.floor(d.css('min-Height'), 10) : h));
      if (self.mode !== 'edit' && self.autoscale === true && scale !== false) {
        self.mapAutoScale();
      }
    }
    resize(
      self.$el.offset().top,
      document.getElementsByTagName('footer'),
      false
    );
    _Prtg.Events.subscribe('prtg.resize.layout', $.proxy(
        resize,
        self,
        self.$el.offset().top,
        document.getElementsByTagName('footer')
    ));
    self.$el.on('destroyed', function() {
      _Prtg.Events.unsubscribe('prtg.resize.layout', $.proxy(
          resize,
          self,
          self.$el.offset().top,
          document.getElementsByTagName('footer')
      ));
    });
    // Non-Blocking loading

    self.$el.find('.map_object').each(function(i, elm) {
      self.updateMapObjectPosition($(elm));
    });
    self.$el.find('.map_object').each(function(i, elm) {
      self.InitMapObject.call(self, elm);
    });

    function linkIsExternal(link) {
      if (link.match(/.{0,7}:\/\/.*/)) return true;
      return false;
    }

    self.$el.on('click.mapeditor', '.map_linkedobject', function(e) {
      e.preventDefault();
      var link = this.getAttribute('data-link');
      if (linkIsExternal(link)) {
        var newWnd = window.open(link);
        newWnd.opener = null;
      } else {
        window.top.location = link;
      }
      return false;
    });

    _Prtg.Events.subscribeOnce('refresh.events.prtg', function() {
      if ($('#mapeditor').length < 1 && $('.prtg-tabs').find('.tab-active').attr("tabid") == 1) {
        $('.prtg-tabs').find('.tab-active').click();
      } else if($('#mapdashboard').length) {
        $.ajax({
          url: $('#mapdashboard').attr('mapurl'),
          type: 'GET',
          dataType: 'html',
        }).done(function success(content, textStatus, jqXHR) {
          content = $($.parseHTML(content));

          $('#mapdashboard').html(content)
          content=null;
          _Prtg.initPlugins($('#mapdashboard'));
        })
      }
    });

    if (self.autoscale === true) {
      self.mapAutoScale();
    }
  };

  prtgMaps.prototype.initMapEditor = function() {
    var self = this;

    self.$historyUndoButton = self.$objectpanel.find('.history_button.history_undo');
    self.$historyRedoButton = self.$objectpanel.find('.history_button.history_redo');

    var historyData = self.historydata.split(':');
    self.historyPosition = historyData[0];
    self.historyMax = historyData[1];
    self.historyCount = historyData[2];
    self.historyLoading = false;

    // disable jquery.event.drag - HACK
    $.event.special.drag.defaults.distance = 9999999;
    $.event.special.drag.defaults.which = 9999999;

    _Prtg.Events.subscribe('prtg.resize.layout', $.proxy(self.resizeMapeditor, self));

    self.$el.on('destroyed', {
      'self': self
    }, self.destroyEditor);

    self.$el.on('mouseover mouseleave', '.previewloading', function(e) {
      e.preventDefault();
      e.stopPropagation();
    });

    // Make right and left panel resizeable
    self.$el.find('.panelsizer').draggable({
      containment: '#mapeditor',
      axis: 'x',
      addClasses: false
    });

    var $mapObjects = self.$el.find('.map_object');

    $mapObjects.each(function(i, elm) {
      self.updateMapObjectPosition($(elm));
    });
    $mapObjects.each(function(i, elm) {
      self.InitMapObject.call(self, elm);
    });

    self.initEvents();
    setTimeout(self.initTree, 10);
    setTimeout(function() {
      self.prepareIcons.call(self);
    }, 10);

    self.resizeMapeditor(true);
    self.checkHistoryButtons();
  };

  prtgMaps.prototype.initEditorMapobjects = function() {
    var self = this;
    self.svg = d3.select('#mapsvg');
    self.svgDefs = self.svg.append('svg:defs');

    var $mapObjects = self.$el.find('.map_object');
    $mapObjects.each(function(i, elm) {
      self.updateMapObjectPosition($(elm));
    });
    $mapObjects.each(function(i, elm) {
      self.InitMapObject.call(self, elm);
    });
  };

  prtgMaps.prototype.destroyEditor = function(event) {
    var self = event.data.self;
    $(window).off('.mapeditor');
    $(document).off('.mapeditor');
    self.$el.off('.mapeditor');
    _Prtg.Events.unsubscribe('prtg.resize.layout', $.proxy(self.resizeMapeditor, self));
    try {
      self.$el.find('.ui-draggable, .map_object, .object_connector, .panelsizer, .map_objectsizer').draggable('destroy');
      self.$el.find('.ui-droppable, .map_object, #mapview').droppable('destroy');
    } catch (e) {
      console.log(e);
    }
  };

  prtgMaps.prototype.resizeMapeditor = function(initial) {
    var self = this;
    var w = $(window);
    var f = $('footer')[0];
    var e = self.$el.parent();
    var d = e.find('#mapeditor');
    var h = window.innerHeight - self.$el.offset().top;
    if (!!f) {
      h -= f.offsetHeight + 15;
    } else if (self.$el.parent().is('.wingui')) {
      h = w.height();
    }
    d.height((Math.floor(d.css('min-Height'), 10) > h ? Math.floor(d.css('min-Height'), 10) : h));
    // sizer position after window resize
    self.$el.find('.probpanelsizer').css('left', $('#mapeditor').outerWidth() - $('.probpanel').outerWidth() - 21);

    var treePanel = self.$el.find('#objectpanel_tree');
    var objectpanel = treePanel.parent('.objectpanel');
    treePanel.css('height', (objectpanel.height() - 40 - 35 - 12) + 'px');

    if (!initial) $('#possibleobjects').accordion('refresh');
  };

  // --------------------------------------------------
  // Right/Left panel
  // --------------------------------------------------
  prtgMaps.prototype.prepareIcons = function() {
    var self = this;
    $.getJSON("/api/mapobject.json", $.proxy(self.initIcons, self));
  };

  prtgMaps.prototype.initIcons = function(images) {
    var self = this;
    var objectdiv = $("#possibleobjects"),
      accord = "",
      category, cont, i = 0;

    for (category in images) {

      accord += '<h3 cate="' + category + '">' + category + '</h3><div>';
      if (typeOf(images[category][0]) === "String") {
        accord += '<ul class="iconspreview objectprev">';
      } else if (typeOf(images[category][0]) === "Object") {
        accord += '<ul class="objectpreview objectprev">';
      }
      for (cont in images[category]) {
        if (typeOf(images[category][cont]) === "String") {
          if (i % 2 || i === 8) {
            accord += '<li class="newobject" data-type="icon"><a href="#"><img class="lazy" src="images/transparent.gif" data-src="/mapicons' + images[category][cont] + '" alt="" /></a>';
          } else {
            accord += '<li class="newobject" data-type="icon"><a href="#"><img class="lazy" src="images/transparent.gif" data-src="/mapicons' + images[category][cont] + '" alt="" /><img  class="lazy icontemplate" src="images/transparent.gif" data-src="/images/mapicon_template.svg" alt="" /></a></li>';
          }
        } else if (typeOf(images[category][cont]) === "Object") {
          accord += '<li class="newobject" data-type="data">' + images[category][cont].name + '<div class="objectpreviewoverlay" data-url="' + images[category][cont].value + '" data-title="' + images[category][cont].name + '"></div></li>';
        }
      }
      accord += '</ul></div>';
      i++;
    }
    objectdiv.append(accord);

    $("ul.objectprev li").draggable({
      containment: '#mapview',
      appendTo: "#mapview",
      cancel: false,
      scroll: true,
      cursor: "move",
      scope: "mapobject",
      revert: false,
      addClasses: false,
      helper: function() {
        var $this = $(this);
        var objid = 0;
        if ($(".jstree-clicked").length) {
          objid = $(".jstree-clicked").parent().attr("objid");
        }
        if ($this.find('img').length > 0) {
          return '<div id="' + objid + '" class="dragto_helper icon_dragto" data-type="' + $this.attr("data-type") + '"><p><img src="' + $this.find('img').attr('src') + '" /></p>' + '</div>';
        } else {
          if ($this.find('.mapobjectpreviewcontainer').length > 0) {
            return '<div id="' + objid + '" class="dragto_helper icon_dragto" data-type="' + $this.attr("data-type") + '"><p>' + $this.find('.mapobjectpreviewcontainer').html() + '</p>' + '</div>';
          } else {
            return '<div id="' + objid + '" class="dragto_helper icon_dragto" data-type="' + $this.attr("data-type") + '"><p>' + $this.text() + '</p>' + '</div>';
          }
        }
      },
      distance: 30,
      zIndex: 999999999,
      opacity: 0.35
    });

    $("#possibleobjects").accordion({
      collapsible: true,
      heightStyle: "fill",
      animate: false,
      activate: function(event, ui) {
        self.lazyImageLoad(ui.newPanel);
      }
    });

    $("#possibleobjects").accordion("refresh");
    self.lazyImageLoad($('.ui-accordion-content-active'));

  };

  prtgMaps.prototype.lazyImageLoad = function($container) {
    $container.find('img.lazy').each(function(i, e) {
      var $this = $(this);
      var source = $this.attr('data-src');
      $this.attr('src', source);
      $this.removeClass('lazy').removeAttr('data.src');
    });

  };

  prtgMaps.prototype.initTree = function() {
    var searchResultCount = 0;
    var searched = false;
    var searchActive = false;

    var tree = $("#objectpanel_tree").jstree({
      "json_data": {
        "ajax": {
          "url": "/api/tree.json?groups=1&devices=1&probes=1&allowroot=1"
        },
        "progressive_render": true
      },
      "core": {
        "animation": 0
      },
      "search": {
        "case_insensitive": true,
        "show_only_matches": true
      },
      "ui": {
        "select_limit": 1
      },
      types: {
        "types" : {
          "disabled": {
            "select_node": false
          }
        }
      },
      "plugins": ["json_data", "ui", "search", "types"]
    }).bind("open_node.jstree", function(event, data) {
      if (searchActive) return;
      data.rslt.obj.siblings(".jstree-open").each(function() {
        data.inst.close_node(this, true);
      });
    }).bind('load_node.jstree', function(e, data) {
      var $nodes = data.inst._get_children(data.rslt.obj);
      $nodes.each(function() {
          $(this).draggable({
            containment: "#mapeditor",
            scope: "mapobject",
            helper: function(event) {
              return $('<div class="dragto_helper" id="' + $(this).attr("objid") + '"><p><img src="/mapicons/defaulticons1/A1 pc.png" /></p>' + '</div>');
            },
            start: function(e) {
              if($(this).attr('rel') == 'disabled') return false;
            },
            distance: 30,
            appendTo: 'body'
          });
      });
    }).bind('loaded.jstree', function(e, data) {
      $('#objectpanel_tree li').draggable({
        containment: "#mapeditor",
        scope: "mapobject",
        helper: function(event) {
          return $('<div class="dragto_helper" id="' + $(this).attr("objid") + '"><p><img src="/mapicons/defaulticons1/A1 pc.png" /></p>' + '</div>');
        },
        start: function(e) {
          if($(this).attr('rel') == 'disabled') return false;
        },
        distance: 30,
        appendTo: 'body',
        addClasses: false
      });
    });
    var searchTimeout;
    var searchbox = $('#maptreesearchinput');

    searchbox.keydown(function(event) {
      clearTimeout(searchTimeout);
      searched = !searched;
      if (event.keyCode == '13') startSearch();
      searchTimeout = setTimeout(startSearch, 1000);

      function startSearch() {
        searchActive = true;
        tree.addClass('jstree-search');
        $('#prtgtreeview_deleteicon').show();
        tree.jstree('open_all', false);
        tree.jstree('search', searchbox.val());
      }
    }).blur(function(event) {
      if ($(this).val() === '') {
        $(this).val(_Prtg.Lang.common.strings.search);
      }
    }).focus(function() {
      $(this).val('');
    });

    $("#prtgtreeview_deleteicon").click(function() {
      tree.removeClass('jstree-search');
      tree.jstree("clear_search");
      $(this).hide();
      searchbox.val("Search...");
      searched = false;
      searchActive = false;
    });
  };

  //TODO: refactor
  prtgMaps.prototype.showObjectProperties = function() {
    var self = this;
    self.$el.find("#prob_save").hide();
    if (self.$el.find("#objectproperties").is(':hidden')) {
      self.$el.find("#objectproperties").show();

      self.$el.find("#possibleobjects").accordion("refresh");
    }
  };
  //TODO: refactor
  prtgMaps.prototype.hideObjectProperties = function() {
    var self = this;
    if (self.$el.find("#objectproperties").is(':visible')) {
      self.$el.find("#objectproperties").hide();
      self.$el.find("#possibleobjects").accordion("refresh");
    }
  };

  // --------------------------------------------------
  // Event Binding
  // --------------------------------------------------
  prtgMaps.prototype.initEvents = function() {
    var self = this;

    // Dropphandling TODO
    self.$el.find("#mapview").on("drop.mapeditor", {
      "self": self
    }, self.dropNewObjectHandler).on("dropover.mapeditor", function(event, ui) {
      if (ui.helper.hasClass("dragto_helper")) {
        // TODO move to css
        ui.helper.css({
          "border": "1px solid green"
        });
      }
    }).on("dropout.mapeditor", function(event, ui) {
      if (ui.helper.hasClass("dragto_helper")) {
        // TODO move to css
        ui.helper.css({
          "border": "1px solid black"
        });
      }
    }).droppable({
      scope: "mapobject",
      tolerance: 'pointer',
      addClasses: false
    });

    // In der object preview clicks deaktivieren.
    self.$el.on("click.mapeditor", ".onepreview>*", function(e) {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }).on("dblclick.mapeditor", 'ul.objectprev li, #objectpanel_tree li', function(e) {
      var $this = $(this);
      if($this.attr('rel') == "disabled") return;
      var ui = {
        'helper': $($this.draggable("option", "helper").call($this)),
        'draggable': $this
      };
      if(self.selectedObjects[0]) {
        if (!self.isScrolledIntoViewVertical($(".editor"), self.selectedObjects[0])) {
          $(".editor").scrollTop(self.selectedObjects[0].position().top);
        }
        if (!self.isScrolledIntoViewHorizontal($(".editor"), self.selectedObjects[0])) {
          $(".editor").scrollLeft(self.selectedObjects[0].position().left);
        }
        self.$el.find(self.selectedObjects[0]).trigger('drop.mapeditor', [ui]);
      } else {
        self.$el.find("#mapview").trigger('drop.mapeditor', [ui]);
      }
      e.stopPropagation();
      e.preventDefault();
    });

    self.$el.on("dragstop.mapeditor", ".panelsizer", {
      "self": self
    }, self.dragStopPanelSizerHanlder).on("drag.mapeditor", ".panelsizer", {
      "self": self
    }, self.dragPanelSizerHanlder).on("click.mapeditor", ".panelpinbutton", {
      "self": self
    }, self.togglePanelHanlder).on("click.mapeditor", ".editor", {
      "self": self
    }, self.deSelectAllHandler).on("click.mapeditor", "#prob_save", {
      "self": self
    }, self.saveMapObjectPropertiesHandler).on("click.mapeditor", "#map_select_externallink", {
      "self": self
    }, self.selectMapObjectLinkDialog).on("change.mapeditor", "#map_snaptogridcontrol input", {
      "self": self
    }, self.snapToGridHandler).on('click.mapeditor', '.history_buttons .history_button', {
      "self": self
    }, self.historyButtonHandler).on("keydown.mapeditor", ".propertyval", function() {
      if (!$("#prob_save").is(':visible')) {
        self.$el.find("#prob_save").show();
        $("#possibleobjects").accordion("refresh");
      }
    }).on("mouseenter.mapeditor mouseleave.mapeditor", "ul.objectpreview li", {
      "self": self
    }, self.hoverObjectPreviewHandler);

    $(document).on('keydown.mapeditor', {
      'self': self
    }, self.keyHandler);

    $('input').focus(function() {
      self.isInputFocused = true;
    }).blur(function() {
      self.isInputFocused = false;
    });
    $("textarea").focus(function() {
      self.isInputFocused = true;
    }).blur(function() {
      self.isInputFocused = false;
    });

    self.mapObjectEvents();
  };

  prtgMaps.prototype.mapObjectEvents = function() {
    var self = this;

    self.$el.find("#mapview").on("click.mapeditor", ".map_object_overlay", {
      "self": self
    }, self.selectMapObjectHandler).on("click.mapeditor", ".map_object .map_objecttools.delete", {
      "self": self
    }, self.deleteMapObjectButtonHandler).on("click.mapeditor", ".map_object .map_objecttools.dropconnectors", {
      "self": self
    }, self.dropAllConnectionsButtonHandler).on("click.mapeditor", ".map_object .map_objecttools.moveup, .map_object .map_objecttools.movedown", {
      "self": self
    }, self.moveUpDownButtonHandler).on("drag.mapeditor", ".map_object", {
      "self": self
    }, self.dragObjectHandler).on("dragstart.mapeditor", ".map_object", {
      "self": self
    }, self.dragStartObjectHandler).on("dragstop.mapeditor", ".map_object", {
      "self": self
    }, self.dragStopObjectHandler).on("drop.mapeditor", ".map_object", {
      "self": self
    }, self.dropObjectHandler).on("drag.mapeditor", ".object_connector", {
      "self": self
    }, self.dragConnectorHandler).on("dragstart.mapeditor", ".object_connector", {
      "self": self
    }, self.dragConnectorHandler).on("dragstop.mapeditor", ".object_connector", {
      "self": self
    }, self.dragConnectorHandler).on("drag.mapeditor", ".map_objectsizer", {
      "self": self
    }, self.dragSizerHandler).on("dragstart.mapeditor", ".map_objectsizer", {
      "self": self
    }, self.dragStartSizerHandler).on("dragstop.mapeditor", ".map_objectsizer", {
      "self": self
    }, self.dragStopSizerHandler).on("mouseenter.mapeditor", "line", {
      "self": self
    }, self.showConnectionRemoveButton).on("mouseleave.mapeditor", ".connection-remove-container", {
      "self": self
    }, self.removeConnectionRemoveButton).on("mouseenter.mapeditor", ".connection-remove-container", {
      "self": self
    }, self.removeConnectionRemoveButton).on("click.mapeditor", ".connection-remove", {
      "self": self
    }, self.removeConnectionHandler);

    $('.map_object').on("scroll.mapeditor", function(e) {
      var $this = $(this);
      $this.find('.map_object_buttonbar').css('top', $this.scrollTop() + 'px');
    });
  };

  // --------------------------------------------------
  // Event Handlers
  // --------------------------------------------------
  prtgMaps.prototype.removeConnectionHandler = function(event) {
    var self = event.data.self;

    var subid = $(this).attr("subid");
    var tosubid = $(this).attr("tosubid");

    self.$el.find(".connection-remove-container").remove();
    $.when(self.SaveMapObject(subid, {
      "delconnectionto": tosubid
    })).done(function(response) {
      // TODO: load and update all connections from this subid after delete (Connection id change)
      self.$el.find('line[fromsubid="' + subid + '"]').filter('[tosubid="' + tosubid + '"]').remove();
    });
  };

  prtgMaps.prototype.showConnectionRemoveButton = function(event) {
    var self = event.data.self;
    if (self.$el.find('.connection-remove[subid="' + $(this).attr("fromsubid") + '"]').length > 0) return;
    var delDiv = $("<div />", {
      "class": "connection-remove",
      "subid": $(this).attr("fromsubid"),
      "tosubid": $(this).attr("tosubid")
    });

    var div = $("<div />", {
      "class": "connection-remove-container",
      "html": delDiv
    }).css({
      "top": event.originalEvent.layerY - 30,
      "left": event.originalEvent.layerX - 30
    }).appendTo("#mapview");
  };

  prtgMaps.prototype.removeConnectionRemoveButton = function(event) {
    var self = event.data.self;
    if (event.type === "mouseleave") {
      $(this).data("removetimer", setTimeout(function() {
        self.$el.find(".connection-remove-container").remove();
      }, 1000));
    } else if (event.type === "mouseenter") {
      clearTimeout($(this).data("removetimer"));
    }
  };

  prtgMaps.prototype.saveMapObjectPropertiesHandler = function(event) {
    var self = event ? event.data.self : this;
    if(event) event.preventDefault();
    var selected = self.selectedObjects[0];
    $validator = self.$el.find("#htmlvalidator");
    $validator.append(self.$el.find("#prob_htmlbefore").val() + "|-|-|" + self.$el.find("#prob_htmlafter").val());
    self.$el.find("#prob_htmlbefore").val($validator.html().split("|-|-|")[0]);
    self.$el.find("#prob_htmlafter").val($validator.html().split("|-|-|")[1]);
    $validator.html("");

    selected.css({
      "top": self.$el.find("#prob_top").val() + "px",
      "left": self.$el.find("#prob_left").val() + "px",
      "width": self.$el.find("#prob_width").val() + "px",
      "height": self.$el.find("#prob_height").val() + "px",
      "z-index": self.$el.find("#prob_zindex").val()
    });


    self.newMapObjectPosition(selected);
    //    CheckObjectBounds(selected, $("#mapview"));
    var subid = selected.attr("subid");
    self.SaveMapObject(subid, {
      "top": parseInt(selected.position().top, 10) || 0,
      "left": parseInt(selected.position().left, 10) || 0,
      "width": parseInt(selected.width(), 10) || 0,
      "height": parseInt(selected.height(), 10) || 0,
      "zindex": self.$el.find("#prob_zindex").val() || 0,
      "htmlbefore_": self.$el.find("#prob_htmlbefore").val() || "",
      "htmlafter_": self.$el.find("#prob_htmlafter").val() || "",
      "ElementLink": self.$el.find("#prob_externallink").val() || ""
    }).done(function(resp) {
      self.$el.find("#prob_save").hide();
      self.replaceMapObject(resp, subid);
    }); // TODO: show saving wheel after click
  };

  prtgMaps.prototype.deSelectAllHandler = function(event) {
    var self = event.data.self;
    self.selectedObjects = [];
    self.$el.find(".maptable_selected").removeClass("maptable_selected");
    self.$el.find(".mapobject_selected").removeClass("mapobject_selected");
    self.hideObjectProperties();
  };

  prtgMaps.prototype.selectMapObjectHandler = function(event) {
    var self = event.data ? event.data.self : event;
    if (event.data) event.stopPropagation();

    self.showObjectProperties();
    if (self.selectedObjects[0]) {
      // Wenn das aktuell ausgewaelte schon das selbe ist abbrechen
      if (self.selectedObjects[0].attr("id") === $(this).parent(".map_object").attr("id")) return;
      self.selectedObjects[0].removeClass("maptable_selected");
      self.selectedObjects[0].removeClass("mapobject_selected");
    }

    self.selectedObjects = [$(this).parent(".map_object")];
    var selected = self.selectedObjects[0];
    if (selected.hasClass("map_table") || selected.hasClass("map_graph")) {
      selected.addClass("maptable_selected");
    } else {
      selected.addClass("mapobject_selected");
    }
    self.updatePropbSheet(selected);
  };

  prtgMaps.prototype.selectMapObject = function(subid) {
    var self = this;
    var $elm = this.$el.find('#mapelement_' + this['map'].id + '_' + subid);

    self.showObjectProperties();
    if (self.selectedObjects[0]) {
      self.selectedObjects[0].removeClass("maptable_selected");
      self.selectedObjects[0].removeClass("mapobject_selected");
    }

    self.selectedObjects = [$elm];
    var selected = self.selectedObjects[0];
    if (selected.hasClass("map_table") || selected.hasClass("map_graph")) {
      selected.addClass("maptable_selected");
    } else {
      selected.addClass("mapobject_selected");
    }
    self.updatePropbSheet(selected);
  };

  // TODO: look
  prtgMaps.prototype.togglePanelHanlder = function(event) {
    var self = event.data.self;
    var $this = $(this);
    $panel = $this.parent(".panel");
    if ($panel.hasClass("objectpanel")) {
      if ($panel.is(":visible")) {
        $editor = $("#mapeditor div.editor");
        $editor.css("left", "10px");
        //$panel.css("width", "0px");
        $panel.hide();
        //$(".objectpanelsizer").addClass("objectpaneltoggle");
        self.$el.find(".objectpanelsizer").css({
          "left": "0px",
          "width": "10px"
        });
      }
    }
  };

  prtgMaps.prototype.keyHandler = function(event) {
    var self = event.data.self;
    if(event.which === 89 && event.ctrlKey) {
      self.loadMapHistory(0);
    } else if (event.which === 90 && event.ctrlKey) {
      self.loadMapHistory(1);
    }

    if (!self.selectedObjects[0]) return;
    var movedist = 1;
    var selectedSubid = self.selectedObjects[0].attr('subid');

    function updateObj() {
      self.CheckObjectBounds(self.selectedObjects[0], $("#mapview"));
      self.newMapObjectPosition(self.selectedObjects[0]);
      self.SaveMapObject(selectedSubid, {
        'top': parseInt(self.selectedObjects[0].position().top, 10),
        'left': parseInt(self.selectedObjects[0].position().left, 10)
      });
      event.preventDefault();
    }

    if(event.shiftKey) movedist = 10;
    if (self.isInputFocused) return;
    if (!self.selectedObjects[0]) return;

    if (!self.isScrolledIntoViewVertical($(".editor"), self.selectedObjects[0])) {
      $(".editor").scrollTop(self.selectedObjects[0].position().top);
    }
    if (!self.isScrolledIntoViewHorizontal($(".editor"), self.selectedObjects[0])) {
      $(".editor").scrollLeft(self.selectedObjects[0].position().left);
    }

    switch (event.keyCode) {
    case 46: //entf key
      self.DeleteMapObject.call(self, self.selectedObjects[0]);
      self.deSelectAllHandler({
        'data': {
          'self': self
        }
      });
      break;
    case 37: // left
      self.selectedObjects[0].css("left", (self.selectedObjects[0].position().left -= movedist).toFixed(0) + "px");
      updateObj();
      break;
    case 38: // up
      self.selectedObjects[0].css("top", (self.selectedObjects[0].position().top -= movedist).toFixed(0) + "px");
      updateObj();
      break;
    case 39: // right
      self.selectedObjects[0].css("left", (self.selectedObjects[0].position().left += movedist).toFixed(0) + "px");
      updateObj();
      break;
    case 40: // down
      self.selectedObjects[0].css("top", (self.selectedObjects[0].position().top += movedist).toFixed(0) + "px");
      updateObj();
      break;
    }
  };

  prtgMaps.prototype.hoverObjectPreviewHandler = function(event) {
    var self = event.data.self;
    var $this = $(this);
    if (event.type === "mouseleave") {
      clearTimeout(self.previewShowtimer);
      self.previewHover = false;
      return;
    }
    if (self.previewHover) return;

    self.previewHover = true;
    self.previewShowtimer = setTimeout(function() {
      var $thisdiv = $this.find('div');
      var objid = 0;
      var width = 200;
      var height = 200;

      if ($(".jstree-clicked").length) {
        objid = $(".jstree-clicked").parent().attr("objid");
      }
      // if (selected !== "") {
      //   objid = selected.attr("objectid");
      // }
      $(".preview").remove();
      self.previewAjax = null;
      // TODO
      // if (!isScrolledIntoViewVertical($thisdiv.parent().parent().parent(), $(".preview"))) {
      //     $thisdiv.parent().parent().parent().scrollTop($(".preview").position().top);
      // }
      $this.append('<div class="preview"><span class="previewheader">' + _Prtg.Lang.Maps.strings.previewtext + ':</span><p class="previewloading loading-box"><span class="loadspinner"></span><span>' + _Prtg.Lang.Maps.strings.loadingtext + '</span></p></div>');

      if (self.previewAjax != null) self.previewAjax.abort();
      self.previewAjax = $.ajax({
        url: "/controls/mapobjectpreview.htm",
        data: {
          id: self.map.id,
          count: 5,
          dependency_: objid,
          width: width,
          height: height,
          selected: "",
          mapelements: ",*" + $thisdiv.attr("data-url") + "*",
          maptitles: ",*" + $thisdiv.attr("data-title") + "*"
        },
        dataType: 'html',
        type: "GET"
      }).done(function(response) {
        var preHtml = $(response);
        preHtml.find(".objtitle").hide()
        self.previewAjax = null;
        $(".previewloading", $this).html(preHtml).removeClass('loading-box');
        _Prtg.initPlugins($(".previewloading", $this));
      }).fail(function() {
        $(".preview").remove();
      });
    }, 500);
  };

  prtgMaps.prototype.dragStopPanelSizerHanlder = function(event, ui) {
    event.stopPropagation();
    var $sizer = $(this);
    var $resizePanel = $sizer.hasClass("objectpanelsizer") ? $(".objectpanel") : $(".probpanel");
    if ($resizePanel.hasClass("objectpanel")) {
      $editor = $("#mapeditor div.editor");
      $editor.css("left", ui.position.left + 6);
      $resizePanel.css("width", ui.position.left);
    } else if ($resizePanel.hasClass("probpanel")) {
      $editor = $("#mapeditor div.editor");
      $editor.css("right", $("#mapeditor").outerWidth() - ui.position.left);
      $resizePanel.css("width", $("#mapeditor").outerWidth() - ui.position.left - 21);
    }
  };

  prtgMaps.prototype.dragPanelSizerHanlder = function(event, ui) {
    event.stopPropagation();
    var $sizer = $(this);
    var $resizePanel = $sizer.hasClass("objectpanelsizer") ? $(".objectpanel") : $(".probpanel");
    if ($resizePanel.hasClass("objectpanel")) {
      // minsize = 200
      if (ui.position.left < 200) {
        ui.position.left = 200;
      }
      // maxsize = rightpanel - 100px
      if (ui.position.left > $(".probpanelsizer").position().left - 100) {
        ui.position.left = $(".probpanelsizer").position().left - 100;
      }
    } else if ($resizePanel.hasClass("probpanel")) {
      // minsize = 300
      if (($("#mapeditor").outerWidth() - ui.position.left - 21) < 300) {
        ui.position.left = $("#mapeditor").outerWidth() - 321;
      }
      // maxsize = leftpanel - 100px
      if (ui.position.left < $(".objectpanelsizer").position().left + 100) {
        ui.position.left = $(".objectpanelsizer").position().left + 100;
      }
    }
  };

  prtgMaps.prototype.dropNewObjectHandler = function(event, ui) {
    if (!ui.helper.hasClass("dragto_helper")) return;
    var self = event.data.self;
    self.CheckObjectBounds(ui.helper, $("#mapview"));
    var addId = ui.helper.attr("id");
    var top = ui.helper.offset().top - $("#mapview").offset().top + 15;
    var left = ui.helper.offset().left - $("#mapview").offset().left - 30;
    var helper = ui.helper.clone();

    if (self.snapToGrid) {
      var position = self.calcGrid({
        "top": top,
        "left": left
      });
      //ui.helper.offset().top = position.top;
      //ui.helper.offset().left = position.left;
      top = position.top;
      left = position.left;
    }

    helper.css({
      "position": "absolute",
      "top": top + "px",
      "left": left + "px"
    });
    //top = top + 15;
    //left = left - 30;
    helper.append('<p class="loading"><span class="loadspinner"></span></p>');
    helper.appendTo("#mapview");
    var obj = self.GetNewIcon(ui.draggable);
    self.addToMap(addId, top, left, helper, obj).done(function(resp) { // FAIL
      // PRTG-5902: when user drags and drops Status Donuts Map Object the status Text is not displayed.
      // This is solved by setting an initial width and height inside the map object template.
      // By setting the width to auto value the map object will be as wide as its children. 
      
      var setInitialSize = function (htmlObject) {
        var getNodeIndex = function (arr) {
          for (var i = 0; i < arr.length; i++) {
            var el = arr[i];
            if (el.className && el.className.indexOf("map_object") !== -1) {
              return i;
            }
          }
        }
        var formatSizeValue = function (sizeValue, suffix) {
          var value = sizeValue;
          // remove possible spaces
          value = sizeValue.replace(/\s/g, '');
          // check if value is a int 
          if (parseInt(value, 10)) {
            // check for suffix
            return value.indexOf(suffix) === -1 ? value + suffix : value; 
          }
          return value;
        }
        var parsedObj = htmlObject;
        var nodeIndex = getNodeIndex(parsedObj);
        var initialWidth = parsedObj[nodeIndex].getAttribute("initialwidth");
        var initialHeight = parsedObj[nodeIndex].getAttribute("initialheight");
    
        if (initialWidth) {
          parsedObj[nodeIndex].style.width = formatSizeValue(initialWidth, "px");
        }

        if (initialHeight) {
          parsedObj[nodeIndex].style.height = formatSizeValue(initialHeight, "px");
        }
        return parsedObj;
      }

      // parse html string to html node
      var parsedObj = $.parseHTML(resp);
      parsedObj = setInitialSize(parsedObj);
      helper.remove();
      $.when($("#mapview").append(parsedObj)).then(function() {
        var subid = $(parsedObj).filter(".map_object").attr("subid");
        var $addedElm = $("#mapelement_" + self.map.id + "_" + subid);
        if ($addedElm.is('.reaload_wo_params')) {
          $.get('/controls/mapobjectonly.htm?mode=edit&subid=' + subid + '&id=' + self['map'].id, function(response) {
            $addedElm.replaceWith(response);
            $addedElm = $("#mapelement_" + self.map.id + "_" + subid);
            self.updateMapObjectPosition($addedElm);
            self.InitMapObject.call(self, $addedElm);
          });
        } else {
          self.updateMapObjectPosition($addedElm);
          self.InitMapObject.call(self, $addedElm);
          // saves the object again with initial size values set inside the template
          self.SaveMapObject(subid, {
            width: parseInt($addedElm.width(), 10),
            height: parseInt($addedElm.height(), 10)
          });  
        }
      });
    });
  };

  prtgMaps.prototype.dragObjectHandler = function(event, ui) {
    var objid = ui.helper.attr("id");
    var subid = ui.helper.attr("subid");
    var self = event.data.self;

    self.updateMapObjectPosition(ui.helper);
    self.calcConnectionLines(subid);
    self.updatePropbSheetOnMove($(this));
  };

  prtgMaps.prototype.dragStartObjectHandler = function(event, ui) {
    var objid = ui.helper.attr("id");
    var subid = ui.helper.attr("subid");
    var self = event.data.self;

    if (self.snapToGrid) {
      var position = self.calcGrid({
        "top": ui.helper.offset().top,
        "left": ui.helper.offset().left
      });
      ui.helper.offset().top = position.top;
      ui.helper.offset().left = position.left;
    }

    self.selectMapObjectHandler.call(ui.helper.find(".map_object_overlay"), self);
    // Hide stuff that should not be displayed while dragging
    $(this).find(".map_object_buttonbar").hide();
    self.svg.select("#newconnector_" + subid).style("display", "none");
    self.$el.find("#map_objectsizer_" + subid).hide();
    self.$el.find("#object_connector_" + subid).hide();
  };

  prtgMaps.prototype.dragStopObjectHandler = function(event, ui) {
    var objid = ui.helper.attr("id");
    var subid = ui.helper.attr("subid");
    var self = event.data.self;
    var $this = $(this);
    $this.find(".map_object_buttonbar").show();
    // TODO: check object bounds;
    // if(self.CheckObjectBounds(ui.helper, $("#mapview"))) {
    //self.updatePropbSheetOnMove($this);
    self.newMapObjectPosition(ui.helper);

    self.SaveMapObject(subid, {
      'top': parseInt(ui.position.top, 10),
      'left': parseInt(ui.position.left, 10)
    });
  };

  prtgMaps.prototype.dropObjectHandler = function(event, ui) {
    event.stopPropagation();
    var self = event.data.self;
    var subid;

    if (ui.helper.hasClass("object_connector")) {
      subid = ui.helper.attr("subid");
      // if a connection between the objects allready exists, dont add a second one.
      if (self.$el.find('line[fromsubid="' + subid + '"]').filter('[tosubid="' + $(this).attr("subid") + '"]').length > 0) return;
      if (self.$el.find('line[fromsubid="' + $(this).attr("subid") + '"]').filter('[tosubid="' + subid + '"]').length > 0) return;

      var newConnectionIndex = self.mObjInfo[subid].connections.push(parseInt($(this).attr("subid"), 10)) - 1;
      self.svg.append("svg:line").data([self.mObjInfo[subid]]).call(self.calcNewConnection, self, subid, newConnectionIndex);
      self.svgDefs.append('svg:linearGradient').data([self.mObjInfo[subid]]).call(self.calcNewGradient, self, subid, newConnectionIndex);
      self.SaveMapObject(subid, {
        "addconnection": $(this).attr("subid")
      });
    } else if (ui.helper.hasClass("dragto_helper") && ui.helper.hasClass("icon_dragto")) {
      var obj = self.GetNewIcon(ui.draggable);
      subid = $(event.currentTarget).attr("subid");
      self.SaveMapObject(subid, {
        mapobject_: obj
      }).done(

      function(response) {
        self.replaceMapObject(response, subid);
      });
    } else if (ui.helper.hasClass("dragto_helper") && !ui.helper.hasClass("icon_dragto")) {
      subid = $(event.currentTarget).attr("subid");
      self.SaveMapObject(subid, {
        "objectid": ui.helper.attr("id")
      }).done(function(response) {
        self.replaceMapObject(response, subid);
      });
    }
  };

  prtgMaps.prototype.dragConnectorHandler = function(event, ui) {
    // TODO: Draw line to new connector dot while dragging
    // event.preventDefault();
    event.stopPropagation();

    // var subid = ui.helper.attr("subid"),
    //  self = event.data.self;
    // /* Drag */
    // if(event.type === "drag") {
    // }
    // /* Dragstart */
    // if(event.type === "dragstart") {
    // }
    // /* Dragstop */
    // if(event.type === "dragstart") {
    // }
  };

  // Map_object buttons handler
  prtgMaps.prototype.deleteMapObjectButtonHandler = function(event) {
    var $mapObj = $(this).parents(".map_object");
    var self = event.data.self;
    self.DeleteMapObject.call(self, $mapObj);
    event.stopPropagation();
    event.preventDefault();
  };

  prtgMaps.prototype.dropAllConnectionsButtonHandler = function(event) {
    var $mapObj = $(this).parents(".map_object");
    var subid = $mapObj.attr("subid");
    var self = event.data.self;

    self.$el.find('line[tosubid="' + subid + '"]').remove();
    self.$el.find('line[fromsubid="' + subid + '"]').remove();

    self.SaveMapObject(subid, {
      "delallconnections": 1
    });
    event.stopPropagation();
  };

  prtgMaps.prototype.moveUpDownButtonHandler = function(event) {
    var $mapObj = $(this).parents(".map_object");
    var subid = $mapObj.attr("subid");
    var self = event.data.self;
    var zindex = parseInt($mapObj.css("z-index"), 10);

    if ($(this).hasClass("movedown")) zindex = zindex - 1;
    else if ($(this).hasClass("moveup")) zindex = zindex + 1;

    if (zindex > 0) {
      self.SaveMapObject(subid, {
        "zindex": zindex
      });
      $mapObj.css("z-index", zindex);
      self.updatePropbSheetOnMove($mapObj);
    }
    event.stopPropagation();
  };

  prtgMaps.prototype.dragSizerHandler = function(event, ui) {
    var self = event.data.self;
    var subid = $(this).attr("subid");
    var $elm = self.$el.find("#mapelement_" + self.map.id + "_" + subid);

    $elm.width(parseInt(((ui.offset.left - $elm.offset().left) + 8), 10));
    $elm.height(parseInt(((ui.offset.top - $elm.offset().top) + 8), 10));

    self.updatePropbSheetOnMove($(this));
    self.updateMapObjectPosition($elm);
    self.calcConnectionLines(subid);
  };

  prtgMaps.prototype.dragStartSizerHandler = function(event, ui) {
    var self = event.data.self;
    var subid = $(this).attr("subid");

    self.svg.select("#newconnector_" + subid).style("display", "none");
    self.$el.find('#object_connector_' + subid).hide();
  };

  prtgMaps.prototype.dragStopSizerHandler = function(event, ui) {
    var self = event.data.self;
    var subid = $(this).attr("subid");
    var $elm = self.$el.find("#mapelement_" + self.map.id + "_" + subid);

    self.svg.select("#newconnector_" + subid).data([self.mObjInfo[subid]]).each(self.calcNewConnectorLines).style("display", "inline");
    self.$el.find('#object_connector_' + subid).show();

    $('#map_objectsizer_' + subid).hide();
    $('#object_connector_' + subid).hide();
    self.SaveMapObject(subid, {
      "width": parseInt($elm.width(), 10),
      "height": parseInt($elm.height(), 10)
    }).done(function(response) {
      if ($elm.is('.mapoject_noreload')) {
        $('#map_objectsizer_' + subid).show();
        $('#object_connector_' + subid).show();
        return;
      }
      self.replaceMapObject(response, subid);
    });
  };

  prtgMaps.prototype.snapToGridHandler = function(event, ui) {
    var self = event.data.self;
    var $currentTarget = $(event.currentTarget);
    if ($currentTarget.is(':checked')) {
      self.snapToGrid = true;
      self.$el.find("#mapview").addClass("showsnaptogrid");
      self.$el.find(".map_object, .map_objectsizer").draggable("option", "grid", [10, 10]);
    } else {
      self.snapToGrid = false;
      self.$el.find("#mapview").removeClass("showsnaptogrid");
      self.$el.find(".map_object, .map_objectsizer").draggable("option", "grid", false);
    }
  };

  prtgMaps.prototype.checkHistoryButtons = function checkHistoryButtons() {
      if (this.historyPosition <= 0) {
        this.$historyUndoButton.addClass('disabled button btndisabled');
        this.$historyUndoButton.removeClass('actionbutton');
      } else {
        this.$historyUndoButton.removeClass('disabled button btndisabled');
        this.$historyUndoButton.addClass('actionbutton');
      }

      if (this.historyPosition >= this.historyMax || this.historyPosition >= this.historyCount) {
        this.$historyRedoButton.addClass('disabled button btndisabled');
        this.$historyRedoButton.removeClass('actionbutton');
      } else {
        this.$historyRedoButton.removeClass('disabled button btndisabled');
        this.$historyRedoButton.addClass('actionbutton');
      }
  };

  prtgMaps.prototype.historyButtonHandler = function(event) {
    var self = event.data.self;
    var $currentTarget = $(event.currentTarget);
    if ($currentTarget.eq(0).hasClass('disabled')) return;

    if ($currentTarget.eq(0).hasClass('history_undo')) {
      self.loadMapHistory(1);
    } else if ($currentTarget.eq(0).hasClass('history_redo')) {
      self.loadMapHistory(0);
    }
  };

  prtgMaps.prototype.loadMapHistory = function(back) {
    var self = this;
    if (self.historyLoading) {
      return;
    } else {
      self.selectedObjects = [];
      self.hideObjectProperties();
      self.historyLoading = true;
    }

    $('#mapeditor .historyloader').show();

    var data = {
      id: self.map.id,
      type: 'history'
    };

    if (parseInt(back, 10) === 1) {
      data.back = 1;
    } else {
      data.forward = 1;
    }

    this.getMapobjects(data).done(function(response) {
      var historyData = response.split(':');
      self.historyPosition = parseInt(historyData[0], 10);
      self.historyCount = parseInt(historyData[1], 10);
      self.checkHistoryButtons.call(self);

      var connData = {
        type: 'connections',
        id: self.map.id
      };

      self.getMapobjects(connData).done(function(response) {
        self.mObjInfo = {};
        self.connections = response;

        self.getMapSvg().done(function(response) {
          self.$el.find('#mapview').html(response);
          self.initEditorMapobjects();
          $('#mapeditor .historyloader').hide();
          self.historyLoading = false;
        });
      });
    });
  };

  prtgMaps.prototype.InitMapObject = function(elm, replace) { // TODO
    var self = this;
    var $elm = $(elm);
    var subid = $elm.attr("subid");
    var grid = self.snapToGrid ? [10, 10] : false;

    $elm.attr('onclick', '');

    // TODO initialize prtg plugins
    // TODO remove if control trough init functions
    if (self.mode === "edit") {
      // TODO Move to webserver
      //var over = crel('div', {class: 'map_object_overlay', data},)
      var overlay = '<div class="map_object_overlay" data-subid="' + $elm.attr("id") + '"><div class="map_object_buttonbar"><div class="map_objecttools moveup"><a href="#" title="Bring to Front"></a></div><div class="map_objecttools movedown"><a href="#" title="Send to Back"></a></div><div class="map_objecttools delete"><a href="#" title="Delete"></a></div><div class="map_objecttools dropconnectors"><a href="#" title="Drop Connections"></a></div></div><p class="ajaxindicator"></p><div class="selected_indicator"></div></div>';
      $elm.append(overlay);


      $elm.draggable({
        containment: 'parent',
        appendTo: "parent",
        cancel: false,
        scroll: true,
        cursor: "move",
        addClasses: false,
        handle: ".map_object_overlay",
        grid: grid
      });

      $elm.droppable({
        scope: "mapobject",
        tolerance: 'pointer',
        greedy: true,
        hoverClass: "drophoverhighlight",
        addClasses: false
      });

      $('<div title="' + _Prtg.Lang.Maps.strings.dragtocreate + '" id="object_connector_' + subid + '" class="object_connector" subid="' + subid + '"></div>').css({
        'top': $elm.position().top + parseInt(($elm.height() / 2), 10),
        'left': $elm.position().left - 10,
        'z-index': $elm.css("z-index")
      }).appendTo($elm.parent()).draggable({
        scope: "mapobject",
        containment: '#mapview',
        appendTo: "#mapview",
        cancel: false,
        scroll: true,
        cursor: "move",
        addClasses: false,
        revert: true
      });

      // Append resizer - only if object is not an map_icon
      if (!$elm.hasClass("map_icon")) {
        $('<div id="map_objectsizer_' + subid + '" class="map_objectsizer" subid="' + subid + '"><div class="ui-icon ui-icon-arrowthick-2-se-nw"></div></div>').css({
          'top': $elm.position().top + $elm.height() - 8,
          'left': $elm.position().left + $elm.width() - 8,
          'z-index': $elm.css("z-index")
        }).appendTo($elm.parent()).draggable({
          scope: "items",
          containment: '#mapview',
          cancel: false,
          grid: grid,
          addClasses: false
        });
      }

      // New connection lines
      this.svg.append("svg:line").data([self.mObjInfo[subid]]).each(this.calcNewConnectorLines).attr("id", "newconnector_" + subid).style("stroke", "rgb(6,120,155)");

    }
    // TODO Refactor - Muss ausserhalb des editors callable sein, zum anzeigen
    // Create connection lines
    if (!replace) {
      for (var i = self.mObjInfo[subid].connections.length - 1; i >= 0; i--) {
        this.svgDefs.append('svg:linearGradient').data([self.mObjInfo[subid]]).call(this.calcNewGradient, self, subid, i);
        this.svg.append("svg:line").data([self.mObjInfo[subid]]).call(this.calcNewConnection, self, subid, i);
      }
    } else {
      self.updateMapObjectPosition($elm);
      self.calcConnectionLines(subid, true);
      self.svg.select("#newconnector_" + subid).data([self.mObjInfo[subid]]).each(self.calcNewConnectorLines);
    }
    _Prtg.initPlugins($elm);
  };

  // --------------------------------------------------
  //  Helper
  // --------------------------------------------------
  prtgMaps.prototype.updateMapObjectPosition = function($mapObj) {
    var self = this;
    // TODO only read changed values
    var subid = $mapObj.attr("subid");
    if (!this.mObjInfo[subid]) {
      this.mObjInfo[subid] = {
        "connections": self.connections[subid] || []
      };
    }
    this.mObjInfo[subid].top = parseInt($mapObj.position().top, 10);
    this.mObjInfo[subid].left = parseInt($mapObj.position().left, 10);
    this.mObjInfo[subid].width = parseInt($mapObj.width(), 10);
    this.mObjInfo[subid].height = parseInt($mapObj.height(), 10);
  };

  prtgMaps.prototype.calcNewConnection = function(obj, self, subid, i) {
    var from = self.mObjInfo[subid],
      to = self.mObjInfo[self.mObjInfo[subid].connections[i]];
    obj.attr("x1", function(d) {
      return parseInt(from.left + (from.width / 2), 10);
    }).attr("y1", function(d) {
      return parseInt(from.top + (from.height / 2), 10);
    }).attr("x2", function(d) {
      return parseInt(to.left + (to.width / 2), 10);
    }).attr("y2", function(d) {
      return parseInt(to.top + (to.height / 2), 10);
    }).attr("id", "connection_" + subid + "_" + self.mObjInfo[subid].connections[i]).attr("class", "elmfrom" + subid + " elmto" + self.mObjInfo[subid].connections[i] + " connectionline").attr("fromsubid", subid).attr("tosubid", self.mObjInfo[subid].connections[i]).attr("stroke", 'url(#gradient_' + subid + '_' + i + ')').attr("gradient", 'gradient_' + subid + '_' + i);
  };

  prtgMaps.prototype.getGradientColor = function(subid, mid) {
    var color = '#b4cc38';

    var redClasses = ".hasred, .sensr, .map_iconcolor_sensr, .map_iconcolor_hasred, .map_objectstate_sensr, .map_objectstate_hasred";
    redClasses = redClasses + ".haspartialred, .sensq, .map_iconcolor_sensq, .map_iconcolor_haspartialred, .map_objectstate_sensq, .map_objectstate_haspartialred";
    var ackClasses = ".hasack, .senso, .map_iconcolor_senso, .map_iconcolor_hasack, .map_objectstate_senso, .map_objectstate_hasack";

    var yellowClasses = ".hasyellow, .sensy, .map_iconcolor_hasyellow, .map_iconcolor_sensy, .map_objectstate_sensy, .map_objectstate_hasyellow";
    var unusualClasses = ".hasorange, .sensp, .map_iconcolor_hasorange, .map_iconcolor_sensp, .map_objectstate_sensp, .map_objectstate_hasorange";
    var blueClasses = ".hasblue, .sensb, .map_iconcolor_hasblue, .map_iconcolor_sensb, .map_objectstate_sensb, .map_objectstate_hasblue";
    var undefindClasses = ".hasblack, .sensx, .map_iconcolor_hasblack, .map_iconcolor_sensx, .map_objectstate_sensx, .map_objectstate_hasblack";


    var $elm = $('#mapelement_' + mid + '_' + subid);

    if ($elm.is(redClasses) || $elm.find(redClasses).length) color = '#d71920';
    else if ($elm.is(ackClasses) || $elm.find(ackClasses).length) color = '#e77579';
    else if ($elm.is(yellowClasses) || $elm.find(yellowClasses).length) color = '#ffcb05';
    else if ($elm.is(unusualClasses) || $elm.find(unusualClasses).length) color = '#f99d1c';
    else if ($elm.is(blueClasses) || $elm.find(blueClasses).length) color = '#447fc1';
    else if ($elm.is(undefindClasses) || $elm.find(undefindClasses).length) color = '#808282';

    return color;
  };

  prtgMaps.prototype.calcNewGradient = function(obj, self, subid, i) {
    var from = self.mObjInfo[subid];
      to = self.mObjInfo[self.mObjInfo[subid].connections[i]];

    var fromColor = '#b4cc38';
    var toColor = '#b4cc38';

    var redClasses = ".hasred, .sensr, .map_iconcolor_sensr, .map_iconcolor_hasred, .map_objectstate_sensr, .map_objectstate_hasred";
    redClasses = redClasses + ".haspartialred, .sensq, .map_iconcolor_sensq, .map_iconcolor_haspartialred, .map_objectstate_sensq, .map_objectstate_haspartialred";
    var ackClasses = ".hasack, .senso, .map_iconcolor_senso, .map_iconcolor_hasack, .map_objectstate_senso, .map_objectstate_hasack";

    var yellowClasses = ".hasyellow, .sensy, .map_iconcolor_hasyellow, .map_iconcolor_sensy, .map_objectstate_sensy, .map_objectstate_hasyellow";
    var unusualClasses = ".hasorange, .sensp, .map_iconcolor_hasorange, .map_iconcolor_sensp, .map_objectstate_sensp, .map_objectstate_hasorange";
    var blueClasses = ".hasblue, .sensb, .map_iconcolor_hasblue, .map_iconcolor_sensb, .map_objectstate_sensb, .map_objectstate_hasblue";
    var undefindClasses = ".hasblack, .sensx, .map_iconcolor_hasblack, .map_iconcolor_sensx, .map_objectstate_sensx, .map_objectstate_hasblack";


    var $fromDiv = $('#mapelement_' + self.map.id + '_' + subid);
    var $toDiv = $('#mapelement_' + self.map.id + '_' + self.mObjInfo[subid].connections[i]);

    if ($fromDiv.is(redClasses) || $fromDiv.find(redClasses).length) fromColor = '#d71920';
    else if ($fromDiv.is(ackClasses) || $fromDiv.find(ackClasses).length) fromColor = '#e77579';
    else if ($fromDiv.is(yellowClasses) || $fromDiv.find(yellowClasses).length) fromColor = '#ffcb05';
    else if ($fromDiv.is(unusualClasses) || $fromDiv.find(unusualClasses).length) fromColor = '#f99d1c';
    else if ($fromDiv.is(blueClasses) || $fromDiv.find(blueClasses).length) fromColor = '#447fc1';
    else if ($fromDiv.is(undefindClasses) || $fromDiv.find(undefindClasses).length) fromColor = '#808282';

    if ($toDiv.is(redClasses) || $toDiv.find(redClasses).length) toColor = '#d71920';
    else if ($toDiv.is(ackClasses) || $toDiv.find(ackClasses).length) toColor = '#e77579';
    else if ($toDiv.is(yellowClasses) || $toDiv.find(yellowClasses).length) toColor = '#ffcb05';
    else if ($toDiv.is(unusualClasses) || $toDiv.find(unusualClasses).length) toColor = '#f99d1c';
    else if ($toDiv.is(blueClasses) || $toDiv.find(blueClasses).length) toColor = '#447fc1';
    else if ($toDiv.is(undefindClasses) || $toDiv.find(undefindClasses).length) toColor = '#808282';


    obj.attr('gradientUnits', 'userSpaceOnUse').attr("x1", function(d) {
      return parseInt(from.left + (from.width / 2), 10);
    }).attr("y1", function(d) {
      return parseInt(from.top + (from.height / 2), 10);
    }).attr("x2", function(d) {
      return parseInt(to.left + (to.width / 2), 10);
    }).attr("y2", function(d) {
      return parseInt(to.top + (to.height / 2), 10);
    }).attr("id", "gradient_" + subid + '_' + i).attr("class", "gradelmfrom" + subid + ' connection_' + i + " gradelmto" + self.mObjInfo[subid].connections[i] + " connectionlineGradient").call(

    function(gradient) {
      gradient.append('svg:stop').attr('offset', '40%').attr('stop-color', fromColor).attr('class', 'fromgradient_' + subid);
      gradient.append('svg:stop').attr('offset', '60%').attr('stop-color', toColor).attr('class', 'togradient_' + self.mObjInfo[subid].connections[i]);
    });
  };


  prtgMaps.prototype.GetNewIcon = function($elm) {
    var type = $elm.attr("data-type"),
      obj;
    if (type === "icon") {
      obj = $elm.find("img").attr("src").replace("/mapicons", "");
    } else if (type === "data") {
      obj = $(".objectpreviewoverlay", $elm).attr("data-url");
    }
    return obj;
  };

  prtgMaps.prototype.calcGrid = function(position) {
    var top = position.top || 0;
    var left = position.left || 0;
    position.top = top - (top % 10);
    position.left = left - (left % 10);
    return position;
  };

  prtgMaps.prototype.replaceMapObject = function(newHtml, subid) {
    var self = this;
    var $oldElm = this.$el.find('#mapelement_' + this['map'].id + '_' + subid);
    this.$el.find('#object_connector_' + subid).remove();
    this.$el.find('#map_objectsizer_' + subid).remove();
    this.$el.find('#newconnector_' + subid).remove();
    if ($oldElm.is('.reaload_wo_params')) {
      $.get('/controls/mapobjectonly.htm?mode=edit&subid=' + subid + '&id=' + self['map'].id, function(response) {
        $oldElm.replaceWith(response);
        self.InitMapObject(self.$el.find('#mapelement_' + self['map'].id + '_' + subid), true);
        self.selectMapObject(subid);
      });
    } else {
      $oldElm.replaceWith(newHtml);
      this.InitMapObject(this.$el.find('#mapelement_' + this['map'].id + '_' + subid), true);
      this.selectMapObject(subid);
    }
  };

  // TODO: name onMove nicht passend
  prtgMaps.prototype.updatePropbSheetOnMove = function($elm) {
    var self = this;
    var subid = $elm.attr("subid");

    // TODO: check if server response is equal to browser results (width/height)
    self.$el.find("#prob_top").val(self.mObjInfo[subid].top || 0);
    self.$el.find("#prob_left").val(self.mObjInfo[subid].left || 0);
    self.$el.find("#prob_width").val(self.mObjInfo[subid].width || 0);
    self.$el.find("#prob_height").val(self.mObjInfo[subid].height || 0);
    self.$el.find("#prob_zindex").val($elm.css("z-index") || 0);
  };

  prtgMaps.prototype.updatePropbSheet = function($elm) {
    var self = this;
    var subid = $elm.attr("subid");
    var serverData;
    self.updatePropbSheetOnMove($elm);

    var htmlbefore = $("#prob_htmlbefore"),
      htmlafter = $("#prob_htmlafter"),
      externallink = $("#prob_externallink");

    htmlbefore.val("").attr("readonly", "readonly").addClass("ajax-loader-small");
    htmlafter.val("").attr("readonly", "readonly").addClass("ajax-loader-small");
    externallink.val("").attr("readonly", "readonly").addClass("ajax-loader-small");

    $.ajax({
      url: "/api/mapsettings.htm",
      data: {
        id: self.map.id,
        subid: subid,
        type: "objectproperties"
      }
    }).done(function(response) {
      serverData = $.parseJSON(response);
      htmlbefore.val((''+serverData["htmlbefore"]).replace(/&apos;/g, '"')).removeAttr("readonly").removeClass("ajax-loader-small");
      htmlafter.val((''+serverData["htmlafter"]).replace(/&apos;/g, '"')).removeAttr("readonly").removeClass("ajax-loader-small");
      externallink.val(serverData["externallink"]).removeAttr("readonly").removeClass("ajax-loader-small");
    });
  };

  prtgMaps.prototype.CheckObjectBounds = function($elm, $mapview) {
    // TODO: remove mapview parameter (use class var)
    var mapwidth = $mapview.width();
    var mapheight = $mapview.height();

    if ($elm.position().left + $elm.outerWidth() + $mapview.scrollLeft() > (mapwidth)) {
      $elm.css("left", (mapwidth - $elm.outerWidth()) + "px");
    }
    if ($elm.position().top + $elm.outerHeight() + $mapview.scrollTop() > mapheight) {
      $elm.css("top", (mapheight - $elm.outerHeight()) + "px");
    }
    if ($elm.position().top < 0) {
      $elm.css("top", "0px");
    }
    if ($elm.position().left < 0) {
      $elm.css("left", "0px");
    }
    return;
  };

  prtgMaps.prototype.isScrolledIntoViewVertical = function ($view, $elem) {
    var docViewTop = $view.scrollTop();
    var docViewBottom = docViewTop + $view.height();

    var elemTop = $elem.position().top;
    var elemBottom = elemTop + $elem.height();

    //return ((elemBottom >= docViewTop) && (elemTop <= docViewBottom));

    return ((elemBottom >= docViewTop) && (elemTop <= docViewBottom) && (elemBottom <= docViewBottom) && (elemTop >= docViewTop));
  };

  prtgMaps.prototype.isScrolledIntoViewHorizontal = function ($view, $elm) {
    var docViewLeft = $view.scrollLeft();
    var docViewRight = docViewLeft + $view.width();

    var elmLeft = $elm.position().left;
    var elmRight = elmLeft + $elm.width();
    //return ((elmRight >= docViewLeft) && (elmLeft <= docViewRight));
    return ((elmRight >= docViewLeft) && (elmLeft <= docViewRight) && (elmRight <= docViewRight) && (elmLeft >= docViewLeft));
  };

  prtgMaps.prototype.GetNewIcon = function($elm) {
    var type = $elm.attr("data-type"),
      obj;
    if (type === "icon") {
      obj = $elm.find("img").attr("src");
      obj = obj.replace("/mapicons", "");
    } else if (type === "data") {
      obj = $(".objectpreviewoverlay", $elm).attr("data-url");
    }
    return obj;
  };

  prtgMaps.prototype.calcConnectionLines = function(subid, calcGradient) {
    var self = this;

    function updateGradient() {
      var gradient = this.getAttribute('gradient');
      var x1 = this.getAttribute('x1');
      var x2 = this.getAttribute('x2');
      var y1 = this.getAttribute('y1');
      var y2 = this.getAttribute('y2');
      self.svg.selectAll('#' + gradient).attr("x1", x1).attr("y1", y1).attr("x2", x2).attr("y2", y2);
      if (calcGradient) {
        var newColor = self.getGradientColor(subid, self.map.id);
        self.svg.selectAll('.fromgradient_' + subid).attr('stop-color', newColor);
        self.svg.selectAll('.togradient_' + subid).attr('stop-color', newColor);
      }
    }

    var from = this.mObjInfo[subid];
    this.svg.selectAll(".elmfrom" + subid).attr("x1", function(d) {
      return parseInt(from.left + (from.width / 2), 10);
    }).attr("y1", function(d) {
      return parseInt(from.top + (from.height / 2), 10);
    }).each(updateGradient);
    this.svg.selectAll(".elmto" + subid).attr("x2", function(d) {
      return parseInt(from.left + (from.width / 2), 10);
    }).attr("y2", function(d) {
      return parseInt(from.top + (from.height / 2), 10);
    }).each(updateGradient);
  };

  prtgMaps.prototype.calcConnectionLineStart = function(d, i) {
    d3.select(this).attr("x1", function(d) {
      return parseInt(d.left + (d.width / 2), 10);
    }).attr("y1", function(d) {
      return parseInt(d.top + (d.height / 2), 10);
    });
  };

  prtgMaps.prototype.calcNewConnectorLines = function(d, i) {
    d3.select(this).attr("x1", parseInt(d.left + (d.width / 2), 10)).attr("y1", parseInt(d.top + (d.height / 2), 10)).attr("x2", parseInt(d.left, 10)).attr("y2", parseInt(d.top + (d.height / 2), 10));
  };

  prtgMaps.prototype.newMapObjectPosition = function($elm) {
    var self = this;
    var subid = $elm.attr("subid");
    // Update Mapobject data, update connection, show and update new connector lines
    self.updateMapObjectPosition($elm);
    self.calcConnectionLines(subid);
    self.svg.select("#newconnector_" + subid).data([self.mObjInfo[subid]]).each(self.calcNewConnectorLines).style("display", "inline");

    self.$el.find("#map_objectsizer_" + subid).css({
      'top': parseInt($elm.position().top + $elm.height() - 8, 10),
      'left': parseInt($elm.position().left + $elm.width() - 8, 10)
    }).show();

    self.$el.find("#object_connector_" + subid).css({
      'top': parseInt($elm.position().top + $elm.height() / 2, 10),
      'left': parseInt($elm.position().left - 10, 10)
    }).show();
  };


  // --------------------------------------------------
  //  Ajax call functions
  // --------------------------------------------------
  prtgMaps.prototype.addToMap = function(objid, toparg, leftarg, helper, mapobjectarg) {
    var self = this;
    var mapobject = mapobjectarg || "/defaulticons1/A1 pc.png";
    var top = parseInt(toparg, 10);
    var left = parseInt(leftarg, 10);
    return $.ajax({
      url: "/api/addobjecttomap.htm",
      data: {
        "objectid": objid,
        "top": top,
        "left": left,
        "id": this.map.id,
        "width": 200,
        "height": 200,
        "mapobject_": mapobject,
        "noautoposition": 1,
        "result": "html" // retunrs new mapobject as html
      },
      type: "POST"
    }).done(function() {
      self.getHistoryData();
    });

  };

  prtgMaps.prototype.getMapSvg = function() {
    var self = this;
    return $.ajax({
      url: '/api/mapsvg.htm',
      data: {
        id: self.map.id
      },
      dataType: 'html'
    });
  };

  prtgMaps.prototype.getMapobjects = function(data) {
    var dataType = 'html';
    if(data.type === 'connections') dataType = 'JSON';

    return $.ajax({
      url: '/api/mapobjects.htm',
      data: data,
      dataType: dataType
    });
  };

  prtgMaps.prototype.LoadSingleMapObject = function(subid) {
    return $.ajax({
      url: "/controls/mapobjectonly.htm",
      data: {
        "subid": subid,
        "id": this.map.id
      },
      type: "GET",
      dataType: "html"
    });
  };

  prtgMaps.prototype.getHistoryData = function() {
    var self = this;
    $.ajax({
      url: '/api/maphistorydata.htm',
      data: {
        'id': self.map.id
      },
      type: 'GET',
      dataType: 'html'
    }).done(function(response) {
      var historyData = response.split(':');
      self.historyPosition = historyData[0];
      self.historyMax = historyData[1];
      self.historyCount = historyData[2];
      self.checkHistoryButtons();
    });
  };

  prtgMaps.prototype.SaveMapObject = function(subid, options) {
    var self = this;
    var apiargs = options || {};
    apiargs.subid = subid;
    apiargs.id = this.map.id;
    return $.ajax({
      url: "/api/editmapobject.htm",
      data: apiargs,
      type: "POST"
    }).done(function()
{      self.getHistoryData();
    });
  };

  prtgMaps.prototype.DeleteMapObject = function($elm) {
    var self = this;
    var subid = $elm.attr("subid");

    $elm.detach();
    self.DeleteMapObjectCall.call(self, subid).done(function(response) {
      $elm.remove();
      self.svg.selectAll(".elmfrom" + subid).remove();
      self.svg.selectAll(".elmto" + subid).remove();
      self.svg.selectAll("#newconnector_" + subid).remove();
      self.$el.find('#map_objectsizer_' + subid).remove();
      self.$el.find('#object_connector_' + subid).remove();
      $('.tooltip').remove();
      self.getHistoryData();
    }).fail(function() {
      $elm.appendTo(self.$el);
    });
  };

  prtgMaps.prototype.DeleteMapObjectCall = function(subid) {
    var self = this;
    return $.ajax({
      url: "/api/deletesubobject.htm",
      data: {
        id: self.map.id,
        subid: subid
      },
      type: "GET"
    }).done(function() {
      self.getHistoryData();
    });
  };

  prtgMaps.prototype.selectMapObjectLinkDialog = function(event) {
    var self = event.data.self || this;
    if(event) event.preventDefault();
    $("<div />", {
      "html": '<div id="map_selectobjectlink"><ul><li id="map_objectlinkdialog_tab1"><a href="#externallink-tabs-1">' + _Prtg.Lang.Maps.strings.linktoobjectdialogtabobject + '</a></li><li id="map_objectlinkdialog_tab2"><a href="#externallink-tabs-2">' + _Prtg.Lang.Maps.strings.linktoobjectdialogtabmaps + '</a></li></ul><div id="externallink-tabs-1"><div id="objectSelectorTree"></div></div><div id="externallink-tabs-2"><ul id="map_mapslist"></ul></div></div>',
      "id": 'externallinkdialog'
    }).dialog({
    	closeText: "",
      closeOnEscape: false,
      draggable: false,
      resizable: false,
      height: 450,
      modal: true,
      width: 490,
      title: _Prtg.Lang.Maps.strings.linktoobjecttext,
      open: function() {
        $("#objectSelectorTree").jstree({
          "json_data": {
            "ajax": {
              "url": "/api/tree.json"
            },
            "progressive_render": true
          },
          "core": {
            "animation": 0
          },
          "themes": {
            "url": "/css/prtg.tree.css"
          },
          "search": {
            "case_insensitive": true
          },
          "ui": {
            "select_multiple_modifier": false
          },
          "plugins": ["json_data", "ui", "themes", "search"],
          metadata: "metadata"
        });
        $("#map_selectobjectlink").tabs();
        $.ajax({
          url: "api/table.json?content=maps&columns=name,objid",
          type: "GET",
          dataType: "JSON",
          success: function(response) {
            var maplist = "";
            for (var i = 0; i < response.maps.length; i++) {
              maplist += '<li data-objid="' + response.maps[i].objid + '">' + response.maps[i].name + '</li>';
            }
            $("#map_mapslist").append(maplist);
            $("#map_mapslist").find("li").click(function() {
              $("#map_mapslist").find("li").removeClass("maplistselected");
              $(this).addClass("maplistselected");
            });
          }
        });
      },
      close: function() {
        $(this).remove();
      },
      buttons: [{
        "html": _Prtg.Lang.common.strings.ok,
        "class": "actionbutton",
        "click": function(event) {
          // TODO self.$el.find für dialog
          if ($("#externallinkdialog").find("#map_objectlinkdialog_tab1").hasClass("ui-tabs-active")) {
            var li = $("#externallinkdialog").find(".jstree-clicked").parent("li");
            if (li.length === 1) {
              var link = "";
              switch (li.attr("type")) {
              case "probe":
                link = "probenode.htm?id=" + li.attr("objid");
                break;
              case "group":
                link = "group.htm?id=" + li.attr("objid");
                break;
              case "sensor":
                link = "sensor.htm?id=" + li.attr("objid");
                break;
              case "device":
                link = "device.htm?id=" + li.attr("objid");
                break;
              case "probedevice":
                link = "device.htm?id=" + li.attr("objid");
                break;
              }
              $("#prob_externallink").val(link).change();
            }
          } else if ($("#externallinkdialog").find("#map_objectlinkdialog_tab2").hasClass("ui-tabs-active")) {
            $("#prob_externallink").val('map.htm?id=' + $("#externallinkdialog").find(".maplistselected").attr("data-objid")).change();
          }
          self.saveMapObjectPropertiesHandler.call(self);
          $(this).dialog("close").remove();
        }
      }, {
        "html": _Prtg.Lang.common.strings.cancel,
        "class": "button btngrey",
        "click": function(event) {
          $(this).dialog("close").remove();
        }
      }]
    });
    return false;
  };

  _Prtg.Plugins.registerPlugin(pluginName, prtgMaps);

})(jQuery, window, document);
;

// Module: Dialogs
_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
	Dialogs: {
		strings: {
			'continue': 'Continue',
			'deleteObject' :'Delete Object',
			'cancelDeleteObject': 'No, I do not want to delete this object',
			"deleteObjects": 'Delete Objects',
			"cancelDeleteObjects": 'No, I do not want to delete these objects',
			'ok': 'OK',
			'cancel': 'Cancel',
			'close': 'Close',
			'error': 'Error',
			'checkport': 'Checking Port',
			'checkportok': 'Port OK',
			"approvediscover": 'Approve and auto-discover',
			"approve": 'Approve',
			"connectionlostdialog": '<h2>Lost connection to PRTG core server</h2><p>Unable to continue. Please try again.</p>',
			"connectionlosttitle": 'Connection Problems',
      "working": 'Working...',
      "background": 'Continue in background',
      "multieditworking": 'Working',
			"multieditdialogtitle": 'Saving...',
			"hidethiswindow": 'Close window',
			"multieditmessage2": 'Your changes are saved.',
			"addmultipleuserhelp": 'Add new user accounts to PRTG by pasting their email addresses below.',
			"addmultipleuserlable": 'Select the user group to which you want to add new user accounts:',
			"addmultipleuserlable2": 'Email addresses:',
			"addingusers": 'Adding new users.',
			"onemoment": 'One moment please...',
			"loading": 'Loading',
			"addmultipleusertitle": 'Add Multiple Users',
			"addmultipleuserdonetitle": 'Users Added',
			"createTemplateResults": 'Create Template Results',
			"createTemplateMessage": 'Congratulations! Your device template is now ready. It contains the following sensors:',
			"takeScreenShot": 'Do you want to include a screenshot in your feedback?',
			"sendFeedback": 'Send Feedback',
			"hideFeedback": 'Hide Feedback Button',
      "homepageTitle": 'The current page is now your homepage.',
			"homepageMessage": 'You will see this page after logging in to your PRTG installation and every time you select <b>Home</b> from the main menu.',
			"ticketassig":'Assign',
			"ticketassigning":'Assigning...',
			"ticketresolve": 'Resolve',
			"ticketresolving":'Resolving...',
			"ticketreopen": 'Reopen',
			"ticketclose": 'Close',
			"ticketclosing": 'Closing...',
      'selectdaterange': 'Select A Date Range',
      'assignedtome': 'Me',
      'needserverrestarttitle': 'PRTG Core Server Restart Required',
      'needserverrestart': 'To apply the new settings the PRTG core server will now be restarted!',
      'needserverrestarthint': 'All users of all PRTG interfaces will be disconnected for a few minutes.',
      'doyouwanttocontinue': 'Do you want to continue?',
      'serverrestarting': 'Restarting PRTG Core Server',
      'serverrestartinfo': 'Restarting core service and web server now. This can take a few minutes. Afterwards you are automatically redirected to the login screen. Please wait...',
      'serverrestartpreurltext': 'After the restart, your server will be reachable on:',
      'serverrestartinfonoautoreload': 'Restarting core server service and web server now. This can take a few minutes. Please wait, then reload the link below until the server comes up again.',
      'savewarning': 'Do you want to save your changes? If you click <b>Discard Changes</b>, your changes will be lost!',
      "savewarningtitle": 'Save changes?',
      "close": 'Close',
      'approving': 'Approving probe',
      'denying': 'Denying probe',
      'addingsensors': 'Adding recommended Sensors',
      'deleteobjecttitle': 'Delete Object?',
      'deleteobjecttext': 'Are you sure that you want to delete this object?',

      'recommedermessagetitle': 'Recommended Sensors',
      'recommedermessage': 'PRTG is creating sensors. They will appear in the sensor list soon.',
      'recommedenowmessage': 'Running recommender service. The information will be available soon.',
      'recommederservice': 'Recommender Service',
      'notifytesttitle': 'Notification Test Results',
      'notifytestmessage': 'PRTG will attempt to deliver a test notification. Recipient information for user accounts is shown for the notification methods <b>Send Email</b>, <b>Send Push Notification</b>, and <b>Send SMS/Pager Message</b>. If the attempt is successful, the test notification will reach you shortly. For troubleshooting, please see the log entries under <br><a href=/log.htm?filter_status=13>Logs | System Events | Notifications</a> in the main menu bar of the PRTG web interface.',
      'nonotifytestmessage': 'Sorry, no test notification found. Please check your notification settings and try again.',

      'sslTitle': 'Do you want to switch to SSL/TLS?',
      'sslButton': 'Yes, switch to SSL/TLS',
      'sslRestart': 'Restarting PRTG Core Server Service',
      'sslMessageA': 'The PRTG core server service is restarting to apply the new settings. Afterwards, you will be redirected to the PRTG web interface via an SSL/TLS-secured connection. For more information, see the <a href=https://www.paessler.com/manuals/prtg/ssl_certificate_warning.htm target=_blank>PRTG Manual: SSL Certificate Warning</a>. Please wait until you are redirected.',
      'sslMessageB': 'The PRTG core server service is restarting to apply the new settings. For more information, see the <a href=https://www.paessler.com/manuals/prtg/ssl_certificate_warning.htm target=_blank>PRTG Manual: SSL Certificate Warning</a>.<p>Please wait a few minutes and open:',
      'sslGrowlA': 'SSL/TLS reminder could not be hidden',
      'sslGrowlB': 'SSL/TLS reminder has been hidden',

      'deactivatinglicensetitle': 'Deactivate License',
      'deactivatinglicensequestion': 'If you deactivate the license on this computer, PRTG will revert to the Freeware Edition after 30 days.<br><br>Are you sure you want to deactivate this license?',
      'deactivatinglicense': 'Deactivating License',

      'timeoutTitle': 'Processing Timeout',
      'timeoutDescription': 'Sorry, processing your request took too long.',
      'testDelivery':{
        sms: {		
          confirmText:'PRTG will attempt to deliver a test SMS via the configured SMS server. If the attempt is successful, the test SMS will reach you shortly. For troubleshooting, please see the log entries under [Logs | System Events | Notifications] in the main menu bar of the PRTG web interface.',
          confirmHeadline:'Test SMS Notification'
        },
        email: {
          confirmText: 'PRTG will attempt to deliver a test email via the configured SMTP server or servers. If the attempt is successful, the test emails will reach you shortly. For troubleshooting, please see the log entries under [Logs | System Events | Notifications] in the main menu bar of the PRTG web interface.',
          confirmHeadline: 'Test Email Notification'
        }
      },
      'notificationTemplates': {
        'objectNotUsed': 'This object is not used by any other object'
      },
      'appserverinstallinprogress': 'Activating',
      'appserveruninstallinprogress': 'Deactivating',
    }
	}
});
;
// _Prtg.Dialogs.js
(function ($, window, undefined) {

  function Dialog(element, data, parent) {
    this.data = data;
    this.$element = $(element);
    this.$parent = $(parent);
    if (this.$element.is(':visible'))
      this.init(this);
  };

  Dialog.prototype.init = function (me) {
    var dfd;
    if (me.data.dialogType === 'loadAlert')
      dfd = _Prtg.Dialogs.loadAlert(me.data.dialogurl, me.data.data, me.data.options);
    else if (me.data.dialogType === 'alert')
      dfd = _Prtg.Dialogs.alert($(me.data.html), me.data.title, me.data.options);
    else
      dfd = _Prtg.Dialogs.defaultDialog(me.data.dialogurl, me.data.data, me.data.opts, me.data.parent);
    dfd.done(function () {
      if (me.data.redirect)
        location.href = me.data.redirect;
    });
  };

  Dialog.prototype.init = function (me) {
    if (me.data.dialogType === 'loadAlert')
      _Prtg.Dialogs.loadAlert(me.data.dialogurl, me.data.data, me.data.options);
    else if (me.data.dialogType === 'alert')
      _Prtg.Dialogs.alert($(me.data.html), me.data.title, me.data.options);
    else
      _Prtg.Dialogs.defaultDialog(me.data.dialogurl, me.data.data, me.data.opts, me.data.parent);
  };

  _Prtg.Plugins.registerPlugin('Dialog', Dialog);

  //HINT: Alle dialoge sollten eine close funktion haben mit $(this).dialog('destroy').remove() und mit einem dialog.dialog("close") geschlossen werden.
  var connectionLost = function (message) {
    _Prtg.Options.connectionLost = window.connectionLost = true;
    !!_Prtg.Events && _Prtg.Events.stop();
    $(document).off('ajaxError');
    _Prtg.xhrManager.xhrabort();

    var ConnectionLostDialog = $('<div />', {
      id: 'connectionlostdialog',
      html: _Prtg.Lang.Dialogs.strings.connectionlostdialog + '<p class="small">' + _Prtg.Lang.common.strings.server + ': ' + location.host + '<br>' + _Prtg.Lang.common.strings.url + ': ' + message + '<br>Time: ' + _Prtg.Util.getTimeString() + '</p>'
    });

    ConnectionLostDialog.dialog({
    	closeText: "",
      closeOnEscape: false,
      modal: true,
      draggable: false,
      resizable: false,
      title: _Prtg.Lang.Dialogs.strings.connectionlosttitle,
      zIndex: 99999,
      buttons: [{
        html: _Prtg.Lang.common.strings.tryagain,
        class: 'actionbutton',
        click: function (e) {
          window.location.reload();
          return false;
        }
      }],
      close: function () {
        $(this).dialog('destroy').remove();
      }
    });
  };

  var loadAlert = function loadAlert(dialogurl, data, options) {
    var loader = $("<div class='loader'/>").html("<div class='loading' style='min-height:100px;'><div class='loadspinner'></div></div>").dialog({
    closeText: "",
    dialogClass: 'addMultipleUserDialog',
    modal: true,
    resizable: false,
    draggable: false,
    width: 400,
    title: _Prtg.Lang.Dialogs.strings.loading });

    data = $.extend(true, data, {
      _hjax: true
    });
    $.ajax({
      url: dialogurl,
      dataType: 'html',
      type: 'GET',
      data: data,
      beforeSend: function (jqXHR) {
        jqXHR.peNumber = 'PE1001';
      }
    }).always(function () {
      loader.dialog('destroy').remove();
    }).done(function dialogDone(html, d, b) {
      var $html = $('<div>' + html + '</div>');
      // check if object is used by any other object.
      var objectIsUsed = !!$html.find('#main .multieditsearchresult .prtg-plugin').children().length;
      var title = ''
      if(objectIsUsed) {
        title = $html.find('#main, #content').data().title;
      } else {
        title = _Prtg.Lang.Dialogs.strings.notificationTemplates.objectNotUsed;
      }
      _Prtg.Dialogs.alert($html, title, options || {});
      $html.closest('.ui-dialog').focus()
    });
  };

  var alert = function alert($html, title, options) {
    options = options || {};
    var dfd = $.Deferred();
    var $dlg = $html.dialog({
      dialogClass: options.dialogClass || "",
    	closeText: "",
      title: title,
      closeOnEscape: options.closeOnEscape || true,
      draggable: options.draggable || false,
      resizable: options.resizable || false,
      modal: options.modal || true,
      minWidth: options.width || 550,
      minHeight: options.height || 150,
      maxHeight: options.maxHeight || parseInt($(window).height() * 0.75, 10),
      maxWidth: options.maxWidth || parseInt($(window).outerWidth() * 0.75, 10),
      zIndex: options.zIndex || 89,
      create: options.create || function (event, ui) {},
      close: options.close || function (event, ui) {},

      open: options.open || function (event, ui) {},

      buttons: options.buttons || [{
        html: options.buttonText0 || _Prtg.Lang.Dialogs.strings.ok,
        class: 'actionbutton',
        click: function (event) {
          $dlg.parent().hide();
          $(this).dialog('close');
          dfd.resolve();
          return false;
        }
      }]
    });

    $dlg.find('[type="submit"], [type="reset"]').not('.hjax').hide();
    $dlg.on('click', 'a:not(.reloadtablelink)', function (event) {
      $dlg.dialog('close');
      dfd.resolve();
    });

    !!_Prtg.initPlugins && _Prtg.initPlugins($html);
    return dfd;
  };

  var loader = function (title, buttons) {
    return $("<div class='loader'/>").html("<div class='loading' style='min-height:100px;'><div class='loadspinner'></div></div>").dialog($.extend(true, {
      closeText: "",
      modal: true,
      resizable: false,
      draggable: false,
      position: 'center',
      maxHeight: parseInt($(window).height() * 0.95, 10),
      maxWidth:  parseInt($(window).width() * 0.95, 10),
      width: 200,
      title: title || _Prtg.Lang.Dialogs.strings.loading

    }, buttons || {})).addClass('loadingDialog');
  };

  var confirmDialog = function (title, text, okbuttontext, cancelbuttontext) {
    var dfd = $.Deferred();
    var dialog = $('<div />').html(text).dialog({
    	closeText: "",
      dialogClass: 'confirmdialog',
      modal: true,
      resizable: false,
      draggable: false,
      width: 400,
      title: title,
      close: function (e, ui) {
        dfd.reject();
        dialog.dialog('destroy').remove();
      },

      buttons: [{
          html: cancelbuttontext || _Prtg.Lang.Dialogs.strings.cancel,
          class: 'button btnlink',
          click: function (event) {
            dfd.reject();
            dialog.dialog('destroy').remove();
          }
        },
          {
        text: okbuttontext || _Prtg.Lang.Dialogs.strings.ok,
        class: 'actionbutton',
        click: function (event) {
          dfd.resolve();
          dialog.dialog('destroy').remove();
        }
      }]
    });
    return dfd;
  };
  var defaultDialog = function defaultDialog(dialogurl, data, opts, parent) {
    var dfd = $.Deferred();

    if ($('html').hasClass('dialog' + dialogurl)) {
      dfd.reject(null);
      return dfd.promise();
    }

    var scrollTop = $(window).scrollTop();
    var load = loader();
    var id = $.now();
    var options = opts || {};
    var maxWidth = options.maxWidth || (window.winGUI && 600) || 800;
    var minWidth = options.width || 550;
    var $dlg;
    var title = '';

    $('html').addClass('dialog id' + id + ' dialog' + dialogurl);
    data = $.extend(true, {
      _hjax: true
    }, (data instanceof Object ? data : {
      id: data
    }));

    $.ajax({
      url: dialogurl,
      data: data,
      dataType: 'html',
      type: 'GET',
      traditional: true,
      beforeSend: function (jqXHR) {
        jqXHR.peNumber = 'PE1002';
      }
    }).always(function () {
      load.dialog('destroy').remove();
      !!window.__ga && window.__ga('send', 'pageview', window.__gaStripOrigin(dialogurl));
    }).done(function dialogDone(html) {
      var $res = $('<div>' + html + '</div>');

      //FIXME: This is a workaround for: PRTG-1198 and PRTG-1277
      // In order to fix the issues properly we have to change multiedit HTML partials in the webserver
      if ($res.find('div.multieditsearchresult').length && $res.find('div.multieditsearchresult form').length > 1) {
        $dlg = $res.find('div.multieditsearchresult').eq(0).clone();
      } else {
        $dlg = $res.find('form, .pseudoform').eq(0).parent().clone();
        title = $dlg.find('form, .pseudoform').eq(0).attr('title');
      }

      var buttons = $dlg.find('.quick-action-wrapper').hide();
      $dlg.find('form, .pseudoform').removeAttr('title');
      if (buttons.length === 0) buttons = null;
      if (!title) title = $res.find('h1').eq(0).text();
      $dlg = $dlg.wrapInner('<div class="dialog-container inline"/>').css({
        'max-height': parseInt($(window).height() * 0.75, 10) + 'px',
        width: '100%'
      });
      $res.find('.contexthelpbox').each(function () {
        $(this)
        .removeClass('prtg-plugin contexthelpbox')
        .detach()
        .prependTo($dlg);
      });

      function closeAndSave(e, data) {
        var $form = $dlg.find('form');
        var formPlugin = $form.data('plugin');
        if (formPlugin != undefined && formPlugin.indexOf('prtg-form') != -1) {
          $form.addClass('dialogform').trigger('submit', true);
          if (!$form.valid()) return;
        }
        // Every form inside a dialog that should be validated needs data-validate="validate"
        if ($form.data('validate') && !$form.valid()) {
          return;
        }
        var formData = _Prtg.Util.getFormData($form, data);
        if (formData !== null) {
          $dlg.parent().hide();
          destroyDialog();
          dfd.resolve(formData, ($form.attr('action') || dialogurl));
        } else {
          destroyDialog();
        }
        return dfd.promise();
      }
      
      var destroyDialog = function destroyDialog() {
        var $tbl = $dlg.closest('.dialog-table');
        !!_Prtg.Events && _Prtg.Events.unsubscribe('navigate.prtg', destroyDialog);
        $('html').removeClass('id' + id + ' dialog' + dialogurl);
        if ($('html').attr('class') === 'dialog') {
          $('html').removeClass('dialog');
          $(window).scrollTop(scrollTop);
        }

        $dlg.dialog('destroy').remove();
        $(window).off('.dialog' + id);
        $tbl.remove();
      };

      !!_Prtg.Events && _Prtg.Events.subscribeOnce('navigate.prtg', destroyDialog);
      $dlg.find('input[placeholder], textarea[placeholder]').placeholder();
      $dlg.dialog({
				closeText: "",
        title: title,
        closeOnEscape: options.closeOnEscape || true,
        draggable: false,
        resizable: options.resizable || false,
        modal: options.modal || true,
        minWidth: minWidth,
        minHeight: options.height || 100,
        maxHeight: options.maxHeight || parseInt($(window).height() * 0.95, 10),
        maxWidth: maxWidth,
        width: _Prtg.Util.calcLimit($(window).width(), minWidth, maxWidth, 0.75),
        zIndex: options.zIndex || 89,
        create: options.create ||
        function (event, ui) {
          !!$dlg.Events && $dlg.Events().publish('create.dialog.prtg', $dlg);
        },

        close: function (event, ui) {
          dfd.reject(null);
          destroyDialog();
          options.close && options.close.call($dlg);
          !!$dlg.Events && $dlg.Events().publish('close.dialog.prtg', $dlg);
        },

        open: function (event, ui) {
          $dlg.closest('.ui-dialog').addClass('ui-dialog-cell').css({
            display: '',
            top: ''
          })
          .wrap('<div class="dialog-table" style="top:' + scrollTop + 'px"/>')
          .wrap('<div class="dialog-cell" />');

          options.open && options.open.call($dlg);
          !!$dlg.Events && $dlg.Events().publish('open.dialog.prtg', $dlg);
        },

        buttons: options.buttons || [{
            html: _Prtg.Lang.Dialogs.strings.cancel,
            class: 'button btnlink',
            click: function() {
              dfd.reject(null);
              destroyDialog();
            }
          },
          {
          html: options.buttonText0 || (buttons && buttons.find('.actionbutton[type="submit"]').text()) || _Prtg.Lang.Dialogs.strings.ok,
          class: 'actionbutton',
          click: function (e, data) {
            closeAndSave(e, data);
          }
        }]
      });

      !!_Prtg.initPlugins && _Prtg.initPlugins($dlg);

      $(window).on('resize.dialog' + id, $dlg, function () {
        var opts = {
          maxHeight: options.maxHeight || parseInt($(window).height() * 0.95, 10),
          // width: options.maxWidth || parseInt($(window).width() * 0.75, 10),
          width: _Prtg.Util.calcLimit($(window).width(), minWidth, maxWidth, 0.75),
          position: 'center'
        };
        $dlg.dialog('option', opts);
      }).on('keydown.dialog' + id, function (event) {
        if ($('textarea:focus').length > 0) return;
        if (event.keyCode == 13) {
          event.preventDefault();
          $dlg.parent().find('button.submit:not(.noentersubmit)').triggerHandler('click');
        }
      });
    }).fail(function dialogFailed(jqXHR, textStatus, errorThrown) {
      dfd.reject(null);
    });

    return dfd.promise();
  };

  var wizardDialog = function wizardDialog(dialogurl, data, step, callbacks, opts, parent) {

    var dfd = $.Deferred();

    if ($('html').hasClass('dialog' + dialogurl)) {
      dfd.reject(null);
      return dfd.promise();
    }

    var scrollTop = $(window).scrollTop();
    var load = loader();
    var id = $.now();
    var options = opts || {};
    var maxWidth = options.maxWidth || (window.winGUI && 600) || 800;
    var minWidth = options.width || 550;
    var $dlg;
    var destroyDialog;
    var title = '';
    var $stepper = null;
    var $step = null;
      var defaultbuttons = [{
            text: _Prtg.Lang.Dialogs.strings.cancel,
            class: 'button btnlink cancel',
            click: function ($dlg, $steps) {
                destroyDialog();
                dfd.reject(null);
                return dfd.promise();
            }
          },
          {
              text: _Prtg.Lang.Dialogs.strings.next,
              class: 'actionbutton next',
              click: function ($dlg, $steps) {
                  if (step === $steps.length - 1) return;
                  if (callbacks['' + (step + 1)].apply($dlg, $steps)) {
                      var $old = $step;
                      $step = $($steps.get(++step));
                      $stepper.eq(step).removeClass('ustep').addClass('step');
                      $old = $old.add($step);
                      $old.toggle();
                      if (!!$step.attr('wizTitle'))
                          $dlg.dialog('option', 'title', $step.attr('wizTitle'));

                      if (!!$step.attr('btnText'))
                          $('.next').text($step.attr('btnText'));
                  }
              }
          }];

    $('html').addClass('dialog id' + id + ' dialog' + dialogurl);
    data = $.extend(true, {
      _hjax: true
    }, (data instanceof Object ? data : {
      id: data
    }));

    $.ajax({
      url: dialogurl,
      data: data,
      dataType: 'html',
      type: 'GET',
      traditional: true,
      beforeSend: function (jqXHR) {
        jqXHR.peNumber = 'PE1002';
      }
    }).always(function () {
      load.dialog('destroy').remove();
      !!window.__ga && window.__ga('send', 'pageview', window.__gaStripOrigin(dialogurl));
    }).done(function dialogDone(html) {
      var $res = $('<div>' + html + '</div>')
        , $dlg = $res.find('form, .pseudoform').eq(0).parent().clone()
        , $steps = $dlg.find('fieldset')
      ;
      $step = $($steps.get(step));
      title = $step.attr('wizTitle');
      $steps.not($step).hide();
      $dlg = $dlg.wrapInner('<div class="dialog-container inline"/>').css({
        'max-height': parseInt($(window).height() * 0.75, 10) + 'px',
        width: '100%'
      });
      $res.find('.contexthelpbox').each(function () {
        $(this)
        .removeClass('prtg-plugin contexthelpbox')
        .detach()
        .prependTo($dlg);
      });

      destroyDialog = function destroyDialog() {
        var $tbl = $dlg.closest('.dialog-table');
        !!_Prtg.Events && _Prtg.Events.unsubscribe('navigate.prtg', destroyDialog);
        $('html').removeClass('id' + id + ' dialog' + dialogurl);
        if ($('html').attr('class') === 'dialog') {
          $('html').removeClass('dialog');
          $(window).scrollTop(scrollTop);
        }

        $dlg.dialog('destroy').remove();
        $('body').off('.dialog' + id);
        $tbl.remove();
      };

      !!_Prtg.Events && _Prtg.Events.subscribeOnce('navigate.prtg', destroyDialog);
      $dlg.find('input[placeholder], textarea[placeholder]').placeholder();

      if(!!options.buttons){
        var addLeftButtons = [];
        options.buttons.forEach(function(button) {
          if('position' in button && button.position == 'right') {
            defaultbuttons.push(button);
          } else {
            addLeftButtons.push(button);
          }
        });
        defaultbuttons = addLeftButtons.concat(defaultbuttons);
      }
      options.buttons = defaultbuttons;
      options.buttons = options.buttons.map(function(e){
        e.click = $.proxy(e.click, $dlg, $dlg, $steps);
        return e;
      });

      $dlg.dialog({
      	closeText: "",
        title: title,
        closeOnEscape: options.closeOnEscape || true,
        draggable: false,
        resizable: options.resizable || false,
        modal: options.modal || true,
        minWidth: minWidth,
        minHeight: options.height || 100,
        maxHeight: options.maxHeight || parseInt($(window).height() * 0.95, 10),
        maxWidth: maxWidth,
        width: _Prtg.Util.calcLimit($(window).width(), minWidth, maxWidth, 0.75),
        zIndex: options.zIndex || 89,
        create: options.create ||
        function (event, ui) {
          !!$dlg.Events && $dlg.Events().publish('create.dialog.prtg', $dlg);
        },

        close: function (event, ui) {
          dfd.reject(null);
          destroyDialog();
          options.close && options.close.call($dlg);
          !!$dlg.Events && $dlg.Events().publish('close.dialog.prtg', $dlg);
        },

        open: function (event, ui) {
          $dlg.closest('.ui-dialog').addClass('ui-dialog-cell').css({
            display: '',
            top: ''
          })
          .wrap('<div class="dialog-table" style="top:' + scrollTop + 'px"/>')
          .wrap('<div class="dialog-cell" />');

          options.open && options.open.call($dlg);
          !!$dlg.Events && $dlg.Events().publish('open.dialog.prtg', $dlg);

          var buttonpane = $dlg.closest('.ui-dialog').find('.ui-dialog-buttonpane');
          $.each($steps, function (index, value) {
            index == 0 ? buttonpane.append("<i class='step'>&#8226</i>")
                       : buttonpane.append("<i class='ustep'>&#8226</i>");
          });

          $stepper = $dlg.closest('.ui-dialog').find('.ui-dialog-buttonpane>i')
          if(!!$step.attr('btnText'))
            $('.next').text($step.attr('btnText'));
        },

        buttons: options.buttons

        });
      !!_Prtg.initPlugins && _Prtg.initPlugins($dlg);
    }).fail(function dialogFailed(jqXHR, textStatus, errorThrown) {
      dfd.reject(null);
    });

    return dfd.promise();
  };

  var serverRestartNeededDialog = function () {
    return _Prtg.Dialogs.confirmDialog(_Prtg.Lang.Dialogs.strings.needserverrestarttitle, '<p style="color: red; font-size: 15px;">' + _Prtg.Lang.Dialogs.strings.needserverrestart + '</p><p>' + _Prtg.Lang.Dialogs.strings.needserverrestarthint + '</p><p>' + _Prtg.Lang.Dialogs.strings.doyouwanttocontinue + '</p>');
  };

  var addMultipleUserDialog = function () {
    var redirectafter = false;
    var groupid;
    var dialog = $('<div />').html(_Prtg.Lang.Dialogs.strings.loading).dialog({
    	closeText: "",
      dialogClass: 'addMultipleUserDialog',
      modal: true,
      resizable: false,
      draggable: false,
      width: 400,
      title: _Prtg.Lang.Dialogs.strings.loading,
      open: function (e, ui) {
        $.ajax({
          url: '/api/table.json',
          data: {
            content: 'lookuplist',
            list: 'noadusergroupid',
            columns: 'name,objid',
            sortby: 'name'
          },
          dataType: 'json',
          type: 'GET'
        }).done(function (response) {
          var groupSelectDropDown = '<p>' + _Prtg.Lang.Dialogs.strings.addmultipleuserhelp + '</p><p class="bold">' + _Prtg.Lang.Dialogs.strings.addmultipleuserlable + '</p><select style="width:100%" name="adduserlistgroupselect" id="selectedaddusersgroup">';
          var groupList = response;

          for (var i = 0; i < groupList.lookuplist.length; i++) {
            groupSelectDropDown = groupSelectDropDown + '<option value="' + groupList.lookuplist[i].objid + '">' + groupList.lookuplist[i].name + '</option>';
          }

          groupSelectDropDown = groupSelectDropDown + '</select><p class="bold">' + _Prtg.Lang.Dialogs.strings.addmultipleuserlable2 + '</p><input type="text" name="newuseremails" id="newuserslist" />';

          dialog.html('<p>' + groupSelectDropDown + '</p>');

          // Select PRTG User group as default - Not Admin Group
          $("#selectedaddusersgroup option[value='201']").attr('selected', 'selected');
          $('#newuserslist').tagsinput({
            autocomplete: false,
            seperator: ','
          });
          dialog.dialog({
            title: _Prtg.Lang.Dialogs.strings.addmultipleusertitle
          });
        });
      },

      close: function () {
        if (redirectafter) {
          window.location.href = 'editusergroup.htm?id=' + groupid;
        }

        $(this).dialog('destroy').remove();
      },

      buttons: [{
              text: _Prtg.Lang.Dialogs.strings.cancel,
              class:'button btnlink',
              click: function (event) {
                  $(this).dialog('destroy').remove();
              }
          }, {
        text: _Prtg.Lang.Dialogs.strings.ok,
        class:'actionbutton',
        click: function (event) {
          groupid = $('#selectedaddusersgroup').val();
          var newusers = $.trim($('#newuserslist').val());
          if (newusers === '') {
            return;
          }

          if ($.trim($('#newtag').val()) !== '') {
            newusers = newusers + ',' + $.trim($('#newtag').val());
          }

          if (newusers[0] === ',') {
            newusers = newusers.substr(1, newusers.length);
          }

          dialog.dialog('option', 'buttons', {}); // Remove buttons
          dialog.html('<p>' + _Prtg.Lang.Dialogs.strings.addingusers + '</p><p>' + _Prtg.Lang.Dialogs.strings.onemoment + '</p><p class="loading"><span class="loadspinner"></span></p>');
          dialog.dialog({ title: _Prtg.Lang.common.strings.working + '...' });

          $.ajax({
            url: 'api/addusers.htm',
            data: {
              id: groupid,
              users: newusers
            },
            type: 'POST'
          }).done(function (response) {
            dialog.dialog('option', 'buttons', [{
            	closeText: "",
              html: _Prtg.Lang.common.strings.ok,
              click: function () {
                redirectafter = true;
                $(this).dialog('close');
              }
            }]);
            dialog.dialog({ title: _Prtg.Lang.Dialogs.strings.addmultipleuserdonetitle });
            dialog.html('<p>' + response + '</p>');
          });
        }
      }]
    });
  };

  $.extend(true, window, {
    _Prtg: {
      Dialogs: {
        connectionLost: connectionLost,
        defaultDialog: defaultDialog,
        wizardDialog: wizardDialog,
        loadAlert: loadAlert,
        alert: alert,
        loader: loader,
        serverRestartNeededDialog: serverRestartNeededDialog,
        addMultipleUserDialog: addMultipleUserDialog,
        confirmDialog: confirmDialog
      }
    }
  });
})(jQuery, window);
;

// Module: Triggeredit
_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
triggerEdit:
    {
        strings:
        {
            "notriggersdefined": '(no triggers defined)',
            "nonotifi": 'no notification',
            "errortitle": 'oops, something went wrong...',
            "libtriggerhelp": 'If you want to change these notification triggers, remove the sensor from the library or edit the notification triggers on the library\&apos;s <b>Notification Triggers</b> tab.',
            "editnotificationtemplate": 'Edit Notification Template',
            "addnotificationtemplate": 'Add Notification Template'
        }
    }
});
;
(function($, window, document, undefined) {
    var pluginName = 'triggeredit',
        viewContext;

    function triggerEdit(element, data, parent) {
        viewContext = data.nodetype;
        var self = this;
        this.element = element;
        this.$element = $(element);

        this.data = data;
        this.parent = parent;

        this.objId = data.objid;
        this.nodetype = data.nodetype;
        this.nodename = data.nodename;
        this.mode = "view";

        this.templates = {
            "state": $.jqotec('#statetriggertemplate', '*'),
            "speed": $.jqotec('#speedtriggertemplate', '*'),
            "volume": $.jqotec('#volumetriggertemplate', '*'),
            "threshold": $.jqotec('#thresholdtriggertemplate', '*'),
            "change": $.jqotec('#changetriggertemplate', '*')
        };

        this.addTriggerTemplateData = [];


        if (this.nodetype !== "library" && this.nodename !== 'Root') {
            data.inherited = this.loadDataFromHtmlComment('triggerinherited');
            this.renderInheritedTemplates(data.inherited, 'trigger', '#inheritedtriggertabledata');

            if (this.nodetype === "sensor") {
                data.libinherited = this.loadDataFromHtmlComment('triggerlibinherited');
                this.renderInheritedTemplates(data.libinherited, 'libtrigger', '#inheritedlibtriggertabledata');
            } else {
                $("#inheritedlibtriggertable, .inheritedlibtriggertable").hide();
            }
        } else {
            $(".inheritedtriggertable, .inheritedlibtriggertable").hide();
        }

        data.dataobj = this.loadDataFromHtmlComment('triggerdataobj');

        self.renderTemplates(data.dataobj);

        if (typeOf(data.dataobj.data) === "Array") {
            for (var i = 0; i < data.dataobj.data.length; i++) {
                data.dataobj.data[i] = self.prepareTemplateData(data.dataobj.data[i]);
                $("#triggertabledata").append($.jqote(self.templates[data.dataobj.data[i].type], data.dataobj.data[i]));
            }
            if (data.dataobj.readonly) $("#triggertable .editcolumn").remove();

        } else {
            self.checkForEmptyTrigger("#triggertabledata");
        }

        // TODO: Look over it
        $("#triggertabledata tr").each(function() {
            self.checkForNoNotification($(this));
        });
        $("#inheritedtriggertabledata tr").each(function() {
            self.checkForNoNotification($(this));
        });

        self.checkForEmptyTrigger('#inheritedtriggertabledata');
        self.checkForEmptyTrigger('#inheritedlibtriggertabledata');


        $(".savetriggerbutton, .canceltriggersavebutton, .triggers_thresholdedithelp").hide();

        self.initChosen('.notificationtemplates select', { width: "auto" });
        // set the overflow of all parent elements for a rule definition to visible.
        // otherwise the chosen drop down is not be shown completely
        self.resetOverflow();
        self.initEvents();
    }

    triggerEdit.prototype.initChosen = function(elements, options) {
        var $elements = $(elements);
        var $searchBar = $('.chosen-search');
        $elements.chosen(options);
        $('.chosen-search').append('<span class="notification-icon glyph-plus-circled add-icon js-add-trigger-template" title="' + _Prtg.Lang.triggerEdit.strings.addnotificationtemplate + '"></span>');
        $('.chosen-search').addClass('with-add-icon');
        $elements.each(addOptionIcons);
    }

    function addOptionIcons(index, element) {
        var chosen = $(element).data('chosen')
        var options = chosen.results_data
        addSelectedOptionIcons(chosen.selected_item[0], options)
        options.forEach(addOptionIconHtml)
    }

    function addSelectedOptionIcons(selectedOption, options) {
        var selectedText = selectedOption.text
        var matchingOption = options.filter(function(option) {
            return option.text.trim() === selectedText.trim()
        })[0]
        if (!matchingOption) {
            return
        }
        var iconsHtml = buildIconHtml(matchingOption.value)
        $(selectedOption).find('span').prepend(iconsHtml)
    }

    function addOptionIconHtml(option) {
        var iconsHtml = buildIconHtml(option.value)
        option.html = iconsHtml + option.html
    }

    function buildIconHtml(value) {
        var iconsString = value.split('|')[2]
        if (!iconsString) {
            return ''
        }
        var iconsData = iconsString.split(',')
        return iconsData.map(function(iconData) {
            var iconDataParts = iconData.split(':')
            var icon = iconDataParts[0]
            var title = iconDataParts[1]
            return '<span class="notification-icon glyph-notification-'+ icon + '" title="' + title + '" data-original-title="' + title + '"></span>'
        }).join('') + ' '
    }

    triggerEdit.prototype.resetOverflow = function() {
        var notificationColumns = $('.notificationcolumn');
        notificationColumns.css('overflow', 'visible');
        notificationColumns.find('form').css('overflow', 'visible');
    }

    triggerEdit.prototype.loadDataFromHtmlComment = function(commentid) {
        var $comment = $('#' + commentid);
        var comment = $.trim($comment.html());
        var commentLength = comment.length;
        var dataBegin = comment.indexOf('{');
        var data;
        data = JSON.parse(comment.substr(dataBegin, commentLength - 3 - dataBegin));
        $comment.remove();
        return data;
    };

    triggerEdit.prototype.addNewTemplateToList = function(templateData, $templateSelect) {
        if(!templateData || !templateData.id || !templateData.name) {
            return false
        }
        var value = templateData.id +'|' + templateData.name + '|';
        var option = '<option value="' + value + '">' + templateData.name + '</option>';
        var notificationsObj = {
            'onnotificationid': '',
            'onnotificationid_input': '',
            'offnotificationid': '',
            'offnotificationid_input': '',
        };

        var nodeObj = this.data.dataobj.data[0];
        var addTriggerTemplateData = this.addTriggerTemplateData;
        var str = '';
        var splitPosition = null;

        // update notification templates by adding new option to select
        for(var node in notificationsObj) {
            str = addTriggerTemplateData['state'][node];
            splitPosition = str.indexOf('</select>');
            notificationsObj[node] = str.slice(0, splitPosition) + option + str.slice(splitPosition, str.length)
        }

        // merge new template with existing ones
        $.extend(nodeObj, notificationsObj);
        
        // make new option available to newly added triggers
        for(var prop in addTriggerTemplateData) {
            $.extend(addTriggerTemplateData[prop], notificationsObj);
        }

        var $comboBox = $('.notificationtemplates select');
        // update view by adding new select to current trigger
        $comboBox.append(option);
        // update current selection, set newly added trigger template to current value
        $templateSelect.val(value);
        // reloading chosen
        $comboBox.trigger("chosen:updated");
    };

    triggerEdit.prototype.initEvents = function() {
        var self = this;
        this.$element
            .on("change", 'input[name="inherittriggers_"]', { self: this }, this.eventHandler.inheritanceChange)
            .on("click", "#addbuttons button", { self: this }, this.eventHandler.addTriggerButtonHandler)
            .on("click", ".modificationbutton", { self: this }, this.eventHandler.editButtonsHandler)
            .on("change", '.statetrigger .combo:first-child', function(event) {
                var $this = $(this);
                $this.parents('form').find('.selected_status').text($this.children(':selected').text());
            })
            .on("click", "th", { self: this }, function(event) {
                var $this = $(this);
                var self = event.data.self;
                if ($this.attr("sort") !== "") {
                    self.sortColumn($this.attr("sort"), $this.attr("sortorder"), $this.parent().parent().parent().attr("id") + "data");
                    $this.attr("sortorder", ($this.attr("sortorder") === "asc" ? "desc" : "asc"));
                    $("img", $this).toggleClass("ui-icon-triangle-1-s").toggleClass("ui-icon-triangle-1-n");
                }
                return false;
            })
            .on("keypress", 'form input', function(e) {
                // Save changes with enter submit in an input
                if (e.which == 13) {
                    $(this).parents('tr').find('.savetriggerbutton').click();
                    return false;
                }
            }).on("click", '.notificationlink', { self: this }, function(e) {
                if (self.mode == "edit") { return; }
                e.preventDefault();
                _Prtg.objectTools.editSettingsDialog.call(this,'/controls/editnotification.htm?id=' + $(this).data("id")).then(function(result, action) {
                    $('.tab-active').click();
                });
                    
                return false;
            }).on("click", ".js-add-trigger-template", { self: this }, function(e) {
                e.preventDefault();
                var $parent = $(this).closest('.edittrigger');
                _Prtg.objectTools.addNotificationTemplate.call(self, '/controls/editnotification.htm?id=new').then(function(result) {
                    self.addNewTemplateToList(result, $parent.find('select'))
                    _Prtg.Events.publish('refresh.events.prtg', [true]);
                })
                return false;
            });
    };

    triggerEdit.prototype.eventHandler = {
        "addTriggerButtonHandler": function(event) {
            var self = event.data.self;
            var triggerEditFormContainer = $('.triggerediting')[0];
            var addType = $(this).attr("triggertype");

            $("#triggertabledata").append($.jqote(self.templates[addType], self.addTriggerTemplateData[addType]));
            self.checkForEmptyTrigger.call(self, "#triggertabledata");

            var elm = self.$element.find('.statetrigger[subid="new"]');
            elm.find('.selected_status').text(elm.find("form #nodest_new").children(':selected').text());

            //$(".actionbutton").button();
            self.editColumn.call(self, $('tr[subid="new"]', '#triggertable'));
            $(".addtriggerbuttons").hide();
            self.initChosen('.notificationtemplates select', { width: "auto" });
            // set the overflow of all parent elements for a rule definition to visible.
            // otherwise the chosen drop down is not be shown completely
            self.resetOverflow();
            $(triggerEditFormContainer).css("z-index", "1");
            
        },
        "editButtonsHandler": function(event) {
            var self = event.data.self;
            var $this = $(this);
            
            var $triggerEditFormContainer = $($this.parents('.triggerediting')[0]);
            event.preventDefault();

            if ($this.hasClass("savetriggerbutton")) {
                if (self.mode == 'view') return
                $triggerEditFormContainer.css("z-index", "");
                self.saveColumn.call(self, $(this).parent().parent().parent(), $this);
            } else if ($this.hasClass("canceltriggersavebutton")) {
                $triggerEditFormContainer.css("z-index", "");
                self.cancelEditColumn.call(self, $(this).parent().parent().parent(), $this);
            } else if ($this.hasClass("edittriggerbutton")) {
                var $editcolumn = $($this.parents('.editcolumn')[0]);
                var $notificationcolumn = $editcolumn.prev();
                var chosenInstances = $notificationcolumn.find('.chosen-container');
                if (chosenInstances.length === 0) {
                    var $selects = $notificationcolumn.find('.notificationtemplates select')
                    self.initChosen($selects, { width: "auto" });
                }
                $triggerEditFormContainer.css("z-index", "1");
                self.editColumn.call(self, $(this).parent().parent().parent(), $this);
            } else if ($this.hasClass("deletetriggerbutton")) {
                $triggerEditFormContainer.css("z-index", "");
                var delSubId = $(this).attr("subid");
                var $column = $(this).parent().parent().parent();
                $("#dialog-del-confirm").dialog({
                		closeText: "",
                    resizable: false,
                    height: 171,
                    modal: true,
                    buttons: [{
                        text: _Prtg.Lang.common.strings['delete'],
                        'class': "actionbutton",
                        click: function() {
                            $(this).dialog("close");
                            self.toggleAjaxIndicator($column, true);
                            self.deleteTrigger(delSubId);
                        }
                    }, {
                        text: _Prtg.Lang.common.strings.cancel,
                        'class': "button btngrey",
                        click: function() {
                            $(this).dialog("close");
                        }
                    }]
                });
            }
        },
        "inheritanceChange": function(event) {
            var self = event.data.self;
            var $radioInput = $("input[name='inherittriggers_']");
            $radioInput.closest('.control-group').siblings('legend').append('<span class="js-saveindicator inheritanceChanged loading"><span class="loadspinner loadspinner-inline"></span></span>');
            $radioInput.attr('disabled', true);

            $.ajax({
                url: "editsettings?",
                type: "POST",
                data: {
                    "inherittriggers_": $(this).attr("value"),
                    "id": self.objId
                }
            }).done(function(response) {
                var responseJson;
                try {
                    responseJson = jQuery.parseJSON(response);
                        $.when(
                            $(".js-saveindicator").remove()
                        ).then(function() {
                            $radioInput.attr('disabled',false)
                        })
                } catch (err) {
                    window.location.href = "editsettings?inherittriggers_=" + value + "&id=" + self.objId;
                }
            });
        }
    };

    triggerEdit.prototype.renderInheritedTemplates = function(data, root, selector) {
        if (data === undefined) return;
        var inheriTriggerdata = [];
        var i;

        // Data preperation
        for (i = 0; i < data.treesize; i++) {
            inheriTriggerdata.push(data[root][i]["content"]);
        }

        for (i = 0; i < inheriTriggerdata.length; i++) {
            for (var prob in inheriTriggerdata[i]) {
                if (prob === "offnotificationid" || prob === "onnotificationid" || prob === "escnotificationid") {
                    if (inheriTriggerdata[i][prob].split("|")[0] === "-1") {
                        inheriTriggerdata[i][prob] = _Prtg.Lang.triggerEdit.strings.nonotifi;
                        inheriTriggerdata[i][prob] = '<span class="readtrigger" data-id="new" href="/editnotification.htm?id=new">' +_Prtg.Lang.triggerEdit.strings.nonotifi + '</span>';              
                    } else {
                        var probData = inheriTriggerdata[i][prob];
                        var splitData = probData.split("|");
                        var iconsHtml = buildIconHtml(probData);
                        inheriTriggerdata[i][prob] = '<span title="' + _Prtg.Lang.triggerEdit.strings.editnotificationtemplate + '" class="readtrigger notificationlink" data-id="' + splitData[0] + '" href="/editnotification.htm?id=' + splitData[0] + '">' + iconsHtml + splitData[1] + '<i class="glyph-edit"></i></span>';
                    }
                } else {
                    if (prob == "nodest") inheriTriggerdata[i][prob + '_original'] = inheriTriggerdata[i][prob];
                    if (prob !== "type" && prob !== "objectlink" && prob !== "typename") {
                        inheriTriggerdata[i][prob] = '<span class="readtrigger">' + inheriTriggerdata[i][prob] + '</span>';
                    }
                }
            }
            inheriTriggerdata[i]["objectlink"] = _Prtg.Util.urlDecodeString(inheriTriggerdata[i]["objectlink"]);
        }

        // Actual template rendering
        for (i = 0; i < inheriTriggerdata.length; i++) {
            $(selector).jqoteapp(this.templates[inheriTriggerdata[i].type], inheriTriggerdata[i]);
        }
        this.$element.find("[data-placement]").attr('data-placement', 'bottom');
    };

    triggerEdit.prototype.fetchTemplateData = function(triggertype) {
        var self = this;
        $.ajax({
            url: "/api/newtrigger.json",
            type: "GET",
            dataType: "JSON",
            data: {
                "class": triggertype,
                "parid": self.objId
            }
        }).done(function(response) {
            self.addTriggerTemplateData[triggertype] = self.prepareTemplateData(response);
        });
    };

    triggerEdit.prototype.prepareTemplateData = function(dataNew) {
        var data = dataNew;
        data.viewContext = viewContext;
        for (var prob in data) {
            if (!_Prtg.Util.endsWithSuffix(prob, "_input") && data[prob + "_input"]) {
                if (prob === "offnotificationid" || prob === "onnotificationid" || prob === "escnotificationid") {
                    if (data[prob].split("|")[0] === "-1") {
                        data[prob] = _Prtg.Lang.triggerEdit.strings.nonotifi;
                        data[prob] = '<span class="readtrigger" data-id="new" href="/editnotification.htm?id=new">' + _Prtg.Lang.triggerEdit.strings.nonotifi + '</span><span class="edittrigger notificationtemplates hide">';
                        var $selectbox = $(data[prob + "_input"]);
                        $selectbox = $('<div>').append($selectbox.clone()).remove();
                        data[prob] = data[prob] + $selectbox.html();
                    } else {
                        var splitData = data[prob].split("|");
                        var optionValue = getOptionValue(splitData[0], data[prob + "_input"])
                        var iconsHtml = buildIconHtml(optionValue);
                        data[prob] = '<span title="' + _Prtg.Lang.triggerEdit.strings.editnotificationtemplate + '" class="readtrigger notificationlink" data-id="' + splitData[0] + '" href="/editnotification.htm?id=' + splitData[0] + '">' + iconsHtml + splitData[1] + '<i class="glyph-edit"></i></span><span class="edittrigger hide notificationtemplates">' + (data[prob + "_input"]);
                    }
                } else {
                    if (prob == "nodest") data[prob + '_original'] = data[prob];
                    data[prob] = '<span class="readtrigger">' + data[prob] + '</span><span class="edittrigger hide">' + data[prob + "_input"];
                }
                data[prob] = data[prob] + "</span>";
            }
        }
        return data;
    };

    function getOptionValue(optionKey, selectHtml) {
        var $select = $(selectHtml)
        var option = $select.find('option[value^="' + optionKey + '"]');
        return option[0].value
    }

    triggerEdit.prototype.renderTemplates = function(triggerData) {
        if (!triggerData.readonly) {
            $(".addtriggerbuttons").hide();
            for (var i = 0; i < triggerData.supported.length; i++) {
                $("#add" + triggerData.supported[i] + "button").show();
                this.fetchTemplateData(triggerData.supported[i]);

                if(triggerData.supported.length > 0) {
                    $('.js-triggerbutton-trigger').show();
                }
            }
            $(".addtriggerbuttons:hidden").remove();
        } else {
            $(".addtriggerbuttons").remove();
        }
    };

    triggerEdit.prototype.showAfterSaveButtons = function(subid) {
        var $newColumn;
        var self = this;
        if (self.mode !== "view") {
            $newColumn = $('tr[subid="' + subid + '"]');
            $newColumn.find(".edittriggerbutton").hide();
            $newColumn.find(".deletetriggerbutton").hide();
            $newColumn.find(".savetriggerbutton, .canceltriggersavebutton, .triggers_thresholdedithelp").hide();
        } else {
            $newColumn = $('tr[subid="' + subid + '"]');
            $newColumn.find(".savetriggerbutton, .canceltriggersavebutton, .triggers_thresholdedithelp").hide();
        }
        $(".addtriggerbuttons").show();
    };

    triggerEdit.prototype.saveColumn = function($column, $savebutton) {
        this.mode = "view";
        this.$element.find(".notificationlink").removeClass("disabled");
        $column.find(".edittrigger").removeClass("showinline").addClass("hide");
        $column.find(".readtrigger").removeClass("hide");
        $column.find(".canceltriggersavebutton").hide();

        // TODO: $savebutton.hide();
        this.toggleAjaxIndicator($column, true);
        var $allOtherColumns = $('tr[subid!="' + $column.attr("subid") + '"]');
        $allOtherColumns.find(".edittriggerbutton").show();
        $allOtherColumns.find(".deletetriggerbutton").show();

        $column.find(".edittriggerbutton").hide();

        $column.find(".typecolumn, .notificationcolumn, .editcolumn").addClass('highlight');

        if ($savebutton.attr("subid") === "new") {
            this.addTrigger($savebutton.attr("triggertype"));
        } else {
            this.saveTrigger($savebutton.attr("subid"));
        }

        // TODO
        this.checkForEmptyTrigger("#triggertabledata");
    };

    triggerEdit.prototype.cancelEditColumn = function($column) {
        this.mode = "view";
        this.$element.find(".notificationlink").removeClass("disabled");
        if ($column.attr("subid") === "new") {
            $column.remove();
        } else {
            $column.find(".edittrigger").removeClass("showinline").addClass("hide");
            $column.find(".readtrigger").removeClass("hide");
            $column.find(".savetriggerbutton").hide();
            $column.find(".triggers_thresholdedithelp").hide();
            $column.find(".canceltriggersavebutton").hide();
        }

        $(".deletetriggerbutton").show();
        $(".edittriggerbutton").show();

        $column.find(".typecolumn, .notificationcolumn, .editcolumn").removeClass('highlight');
        $(".addtriggerbuttons").show();
        this.checkForEmptyTrigger("#triggertabledata");
    };

    triggerEdit.prototype.editColumn = function($column, $editbutton) {
        this.mode = "edit";
        this.$element.find(".notificationlink").addClass("disabled");
        $column.find(".typecolumn, .notificationcolumn, .editcolumn").addClass('highlight');
        $(".addtriggerbuttons").hide();
        $column.find(".edittrigger").removeClass("hide").addClass("showinline");
        $column.find(".readtrigger").addClass("hide");
        $column.find(".readtrigger").addClass("hide");
        $(".edittriggerbutton").hide();
        $(".deletetriggerbutton").hide();
        $column.find(".savetriggerbutton").show();
        $column.find(".triggers_thresholdedithelp").show();
        $column.find(".canceltriggersavebutton").show();
    };

    triggerEdit.prototype.addTrigger = function(triggerType) {
        this.subid = "new";
        var self = this;
        var data = $("form[subid='" + this.subid + "']", '#triggertable').serialize();
        data = data + "&subid=" + this.subid + "&objecttype=nodetrigger&class=" + triggerType + "&ajaxrequest=1&id=" + this.objId;

        $("tr[subid='" + this.subid + "'] td", '#triggertable').addClass('saving');

        return $.ajax({
            url: "editsettings?" + data,
            type: "POST",
            beforeSend: function(jqXHR) {
                jqXHR.gotoAfterError = window.location.href;
            }
        }).done(function(response, textStatus) {
            var responseJson;
            // try {
            responseJson = jQuery.parseJSON(response);
            $.when(self.loadSingleTrigger(responseJson.subid, true)).then(function() {
                self.checkForNoNotification($('tr[subid="' + responseJson.subid + '"]'));
                self.showAfterSaveButtons.call(self, responseJson.subid);
            });
        });
    };

    triggerEdit.prototype.saveTrigger = function(subid) {
        var self = this;
        var data = $("form[subid='" + subid + "']", '#triggertable').serialize();
        data = data + "&id=" + self.objId + "&subid=" + subid;

        $("tr[subid='" + subid + "'] td", '#triggertable').addClass('saving');

        return $.ajax({
            url: "editsettings?" + data,
            type: "post",
            beforeSend: function(jqXHR) {
                jqXHR.gotoAfterError = window.location.href;
            }
        }).done(function(response, textStatus) {
            var responseJson;
            responseJson = jQuery.parseJSON(response);
            $.when(self.loadSingleTrigger(subid, false)).done(function() {
                self.checkForNoNotification($('tr[subid="' + subid + '"]'));
                self.showAfterSaveButtons.call(self, subid);
            });
        });
    };

    triggerEdit.prototype.deleteTrigger = function(subid) {
        var self = this;
        $("tr[subid='" + subid + "'] td", '#triggertable').addClass('deleting');
        $.ajax({
            url: "deletesub.htm",
            data: {
                "id": self.objId,
                "subid": subid
            },
            type: "GET"
        }).done(function(response) {
            setTimeout(function() {
                $("tr[subid='" + subid + "']", '#triggertable').remove();
                if (self.mode === "view") {
                    $(".deletetriggerbutton").show();
                    $(".edittriggerbutton").show();
                }
                self.checkForEmptyTrigger("#triggertabledata");
            }, 500);
        });
    };

    triggerEdit.prototype.loadSingleTrigger = function(subid, newtrigger) {
        var self = this;
        return $.ajax({
            url: "/api/triggers.json",
            data: {
                "id": self.objId,
                "subid": subid
            },
            dataType: "JSON",
            type: "GET"
        }).done(function(response) {
            response.data[0] = self.prepareTemplateData(response.data[0]);
            if (newtrigger) subid = "new";
            $("tr[subid='" + subid + "']", '#triggertable').replaceWith($.jqote(self.templates[response.data[0].type], response.data[0]));
            self.initChosen($("tr[subid='" + subid + "']", '#triggertable').find('.notificationtemplates select'), { width: "auto" });
            // set the overflow of all parent elements for a rule definition to visible.
            // otherwise the chosen drop down is not be shown completely
            self.resetOverflow();
        });
    };

    triggerEdit.prototype.checkForEmptyTrigger = function(tableselector) {
        if ($("tr", tableselector).length < 1) {
            $(tableselector).append('<tr class="nodata"><td colspan="3">' + _Prtg.Lang.triggerEdit.strings.notriggersdefined + '</td></tr>');
        } else {
            $(".nodata", tableselector).remove();
            if (tableselector === "#inheritedlibtriggertabledata") {
                $(tableselector).parents("table").after('<div>' + _Prtg.Lang.triggerEdit.strings.libtriggerhelp + '</div>');
            }
        }
    };

    triggerEdit.prototype.checkForNoNotification = function($column) {
        $('span[disabled="true"]', $column).each(function() {
            $(this).css("text-decoration", "underline");
        });
    };

    triggerEdit.prototype.toggleAjaxIndicator = function($column, show) {
        if (this.show) {
            $column.find(".editcolumn").html('<span class="saveindicator"><span class="loadspinner"></span></span>');
        } else {
            $column.find(".editcolumn").remove(".saveindicator");
        }
    };

    triggerEdit.prototype.sortColumn = function(columnClass, order, table) {
        order = order || "asc";
        if (order === "asc") {
            $("#" + table + " > tr").sortElements(function(a, b) {
                return $("." + columnClass, a).text() > $("." + columnClass, b).text() ? 1 : -1;
            });
        } else {
            $("#" + table + " > tr").sortElements(function(a, b) {
                return $("." + columnClass, a).text() < $("." + columnClass, b).text() ? 1 : -1;
            });
        }
    };

    _Prtg.Plugins.registerPlugin(pluginName, triggerEdit);

})(jQuery, window, document);
;

// Module: AddSensor
_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
addSensor:
  {
    strings:
    {
      "cat_normal"        : 'Matching sensor types',
      "cat_top10"     : 'Most used sensor types',
      "cat_probeconn"     : 'Sensor types that require a connected probe',
      "cat_probeconn2"     : 'You cannot set up these sensors because the probe is currently disconnected.',
      "cat_probedevice"   : 'Sensor types that can only be created on a probe device',
      "cat_probedevice2"   : 'To add these sensor types, select a probe device.',
      "cat_clusternode"   : 'Sensor types that cannot be added to a cluster',
      "cat_clusternode2"   : 'To add these sensor types, select device on the local or a remote probe, but not the cluster probe.',
      "cat_validvm"       : 'Sensor types that need valid credentials for VMware/XenServer',
      "cat_validvm2"       : 'To add these sensor types, enter VMware/XenServer credentials in the settings of the parent device or a parent group.',
      "cat_validwindows"  : 'Sensor types that need valid credentials for Windows servers',
      "cat_validwindows2"  : 'To add these sensor types, enter credentials on the parent device or a parent group.',
      "cat_requiredsettings"  : 'Sensor types that need valid credentials',
      "cat_requiredsettings2"  : 'To add these sensor types, enter credentials in the settings of the parent device or a parent group. You can check which credentials a sensor needs in the sensor help or the PRTG Manual.',
      "cat_validlinux"    : 'Sensor types that need valid credentials for Linux (SSH/WBEM) Systems',
      "cat_validlinux2"    : 'To add these sensor types, enter Linux credentials in the settings of the parent device or a parent group.',
      "cat_dotnetrelease" : 'Sensor types that need specific Microsoft .NET versions',
      "cat_dotnetrelease2" : 'To add these sensor types, see the sensor information and install the appropriate version of .NET on the computer running the PRTG probe.',
      "cat_isv6host"      : 'Sensor types that are not IPv6 compatible',
      "cat_islinux"       : 'Sensor types that are not compatible with a mini probe',
      "cat_islinux2"       : 'To add these sensor types, select a device on the local probe or a Windows remote probe to add these sensor types.',
      "cat_needslocalprobe": 'Sensor types that can only be created on a local probe or hosted probe device',
      "cat_needslocalprobe2": 'Select a local probe or hosted probe device to add these sensor types.',
      "cat_notonpod": 'Sensor types that can only be created on a remote probe',
      "cat_notonpod2": 'Select a device on a remote probe to add these sensor types.',
      // Ressource Usage strings
      "resourceusage": [
        'Unknown impact on system performance. Use this performance category with caution.',
        'Very low impact on system performance. Try to stay below 5000 sensors of this performance category per probe.',
        'Low impact on system performance. Try to stay below 2000 sensors of this performance category per probe.',
        'Medium impact on system performance. Try to stay below 500 sensors of this performance category per probe.',
        'High impact on system performance. Try to stay below 200 sensors of this performance category per probe.',
        'Very high impact on system performance. Try to stay below 50 sensors of this performance category per probe.'
      ],
      "noHelpText"        : 'Click question mark to open help',
      "resulttext"        : 'Results',
      "counttext"         : 'Count',
      "filtertext"        : 'Filter',
      "searchtext"        : 'Search',
      "addingSensor"      : 'Adding sensor(s)...',
      "addsensorfailed"		: 'Sorry, the scan for available monitoring items has failed!'
    }
  }
});
;
(function($) {
  var AddSensor = function() {
      var Families = [],
        SensorTypes, objId, searchInProgress = false,
        ObjStatus, SensorTemplate, FilterTemplate, SensorlistTemplate, Categories = [], isSmallProbe = false;

      var init = function(SensorsObj, deviceId, deviceStatus) {
          objId = deviceId;
          if(SensorsObj["smallprobe"]) isSmallProbe = true;
          Families = SensorsObj["familys"] || [];
          SensorTypes = SensorsObj["sensortypes"] || [];
          SensorTemplate = $.jqotec('#addsensor_listview', '*');
          FilterTemplate = $.jqotec('#addsensor_filterview', '*');
          SensorlistTemplate = $.jqotec('#addsensor_sublist', '*');
          ObjStatus = deviceStatus;
          Categories = [{
            "type": "istop10",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_top10+"</h2>"
          }, {
            "type": "normal",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_normal+"</h2>"
          }, {
            "type": "probeconn",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_probeconn+"</h2>"+_Prtg.Lang.addSensor.strings.cat_probeconn2
          }, {
            "type": "probedevice",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_probedevice+"</h2>"+_Prtg.Lang.addSensor.strings.cat_probedevice2
          }, {
            "type": "clusternode",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_clusternode+"</h2>"+_Prtg.Lang.addSensor.strings.cat_clusternode2
          }, {
            "type": "validvm",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_validvm+"</h2>"+_Prtg.Lang.addSensor.strings.cat_validvm2
          }, {
            "type": "validwindows",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_validwindows+"</h2>"+_Prtg.Lang.addSensor.strings.cat_validwindows2
          }, {
            "type": "validlinux",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_validlinux+"</h2>"+_Prtg.Lang.addSensor.strings.cat_validlinux2
          }, {
            "type": "dotnetrelease",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_dotnetrelease+"</h2>"+_Prtg.Lang.addSensor.strings.cat_dotnetrelease2
          }, {
            "type": "isv6host",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_isv6host+"</h2>"
          }, {
            "type": "islinux",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_islinux+"</h2>"+_Prtg.Lang.addSensor.strings.cat_islinux2
          }, {
            "type": "needslocalprobe",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_needslocalprobe+"</h2>"+_Prtg.Lang.addSensor.strings.cat_needslocalprobe2
          }, {
            "type": "notonpod",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_notonpod+"</h2>"+_Prtg.Lang.addSensor.strings.cat_notonpod2
          }, {
            "type": "requiredsettings",
            "text": "<h2>"+_Prtg.Lang.addSensor.strings.cat_requiredsettings+"</h2>"+_Prtg.Lang.addSensor.strings.cat_requiredsettings2
          }];

          prepareDataAndElements();
          initEvents();
          $("#addsensor_searchinput").focus();
        };

      var top10Visible = function() {
        return $('#addsensor_list_istop10').find('.addsensor_sensorcontainer.addsensor:visible').length;
      };

      var prepareDataAndElements = function() {
          var i;
          var content = "";
          for (i = 0; i < Categories.length; i++) {
              content = content + $.jqote(SensorlistTemplate, Categories[i]);
          }
          $("#addsensor_list").html('').html(content);
          for (i = 0; i < SensorTypes.length; i++) {
            SensorTypes[i]["index"] = i;
            SensorTypes[i]["show"] = true;
            SensorTypes[i]["disabled"] = false;
            SensorTypes[i]["searchresult"] = false;
            SensorTypes[i]["description"] = SensorTypes[i]["description"].replace(/\\'/g, "");
            if (SensorTypes[i]["help"] === '') {
              SensorTypes[i]["help"] = _Prtg.Lang.addSensor.strings.noHelpText;
            } else {
              SensorTypes[i]["help"] = SensorTypes[i]["help"].replace(/\\/g, "");
            }
            findCategorie(SensorTypes[i]);

            SensorTypes[i]["$elm"] = $($.jqote(SensorTemplate, SensorTypes[i]));
            SensorTypes[i]["$elm"].data("id", i);
            $("#addsensor_list_" + SensorTypes[i]["categorie"]).append(SensorTypes[i]["$elm"]);
            if ($("#addsensor_list_" + SensorTypes[i]["categorie"]).parent().hasClass("addsensor_sensorcategoriehide")) {
              $("#addsensor_list_" + SensorTypes[i]["categorie"]).parent().removeClass("addsensor_sensorcategoriehide").addClass("addsensor_sensorcategorieshow");
            }
          }
          if(!isSmallProbe) $("#addsensor_sensorfilter").append($.jqote(FilterTemplate, Families));
          $("#addsensor_resultcount").text((SensorTypes.length - top10Visible()));
        };

      var findCategorie = function(sensorType) {
          if (!ObjStatus["probeconn"] && sensorType["needsprobe"]) {
            sensorType["categorie"] = Categories[2]["type"];
          } else if(ObjStatus["onpodlocalprobe"] && sensorType["notonpod"]) {
            sensorType["categorie"] = Categories[12]["type"];
          } else if (!ObjStatus["probedevice"] && sensorType["needsprobedevice"]) {
            sensorType["categorie"] = Categories[3]["type"];
          } else if (ObjStatus["clusternode"] && sensorType["notincluster"]) {
            sensorType["categorie"] = Categories[4]["type"];
          } else if (!ObjStatus["validvm"] && sensorType["needsvm"]) {
            sensorType["categorie"] = Categories[5]["type"];
          } else if (!ObjStatus["validlinux"] && sensorType["needslinux"]) {
            sensorType["categorie"] = Categories[7]["type"];
          } else if (!ObjStatus["validwindows"] && sensorType["needswindows"]) {
            sensorType["categorie"] = Categories[6]["type"];
          } else if (!sensorType["requiredsettingsavailable"]) {
            sensorType["categorie"] = Categories[13]["type"];
          } else if ((sensorType["dotnetrelease"] != -1) && (ObjStatus["dotnetrelease"] < sensorType["dotnetrelease"])) {
            sensorType["categorie"] = Categories[8]["type"];
          } else if (ObjStatus["isv6host"] && !sensorType["ipv6"]) {
            sensorType["categorie"] = Categories[9]["type"];
          } else if (ObjStatus["islinux"] && !sensorType["linux"]) {
            sensorType["categorie"] = Categories[10]["type"];
          } else if(!ObjStatus["localprobe"] && sensorType["needslocalprobe"]) {
            sensorType["categorie"] = Categories[11]["type"];
          } else if(sensorType["top10"]) {
            sensorType["categorie"] = Categories[0]["type"];
          } else {
            sensorType["categorie"] = Categories[1]["type"];
          }

          if ((sensorType["top10"]) && sensorType["categorie"] !== "istop10")
            sensorType["categorie"] = "hide";
        };

      var hideEmptyCate = function() {
          $("#addsensor_list").find(".addsensor_sensorcategorieshow:hidden").show();
          $("#addsensor_list").find(".addsensor_sensorcategorieshow").each(function(index, elm) {
            var oneVisib = false;
            if (index !== 1 ) {
              $("div", this).find("div:visible").each(function() {
                oneVisib = true;
              });
              if (!oneVisib) {
                $(this).hide();
              }
            }
          });
        };

      var initEvents = function() {
          $("#addsensor_sensorfilter").on('click', '.addsensor_filterbutton', function() {
            var $this = $(this);
            if ($this.hasClass("addsensor_filterselected")) {
              $this.removeClass("addsensor_filterselected");
            } else {
              $this.parent().find(".addsensor_filterselected").removeClass("addsensor_filterselected");
              $this.addClass("addsensor_filterselected");
            }
            filterSensors();
          });
          $("#addsensor_list").on('click', '.addsensor', function(e) {
            var $target = $(e.target);
            if (!$target.hasClass("addsensor_sensorhelplink")) {
              var Sensor = SensorTypes[$(this).attr("sensorindex")];
              if (Sensor["preselection"]) {
                $("#addsensor_preselection").append(_Prtg.Util.urlDecodeString(Sensor["preselectionlist"]));
                preselection(Sensor["id"]);
              } else {
                addSensor(Sensor["id"]);
              }
            }
          });
          $("#addsensor_view").on('keyup', '#addsensor_searchinput', _Prtg.debounce(function() {
            search($(this).val());
          },500));
          if($('#addsensor_searchinput').val() !== '')
            search($('#addsensor_searchinput').val());
        };
      var selectedFamily = [];
      var filterSensors = function() {
          var results = 0,
            notVisible = [],
            clickedFilter;
          selectedFamily = [],

          $(".addsensor_filterselected", "#addsensor_sensorfilter").each(function() {
            clickedFilter = $(this).attr("filter");
            selectedFamily.push(clickedFilter); // TODO, nicht jedesmal die ganze liste aufbauen!
          });

          if (selectedFamily.length !== 0) {
            $("#addsensor_headerfiltertext").text(" - " + _Prtg.Lang.addSensor.strings.filtertext + ": " + selectedFamily.join(", "));
          } else {
            $("#addsensor_headerfiltertext").text("");
          }
          for (var i = 0; i < SensorTypes.length; i++) {
            SensorTypes[i]["show"] = true;
            if (selectedFamily.length > 0) {
              for (var j = 0; j < selectedFamily.length; j++) {
                if ($.inArray(selectedFamily[j], SensorTypes[i]["family"]) === -1) {
                  SensorTypes[i]["show"] = false;
                }
              }
              if (SensorTypes[i]["show"]) {
                SensorTypes[i]["$elm"].show();
                results = results + 1;
              } else {
                notVisible.push(SensorTypes[i]["name"]);
                SensorTypes[i]["$elm"].hide();
              }
            } else {
              SensorTypes[i]["$elm"].show();
            }
          }
          if (selectedFamily.length !== 0) {
            $("#addsensor_resultcount").text(results - top10Visible());
          } else {
            $("#addsensor_resultcount").text((SensorTypes.length - top10Visible()));
          }
          if (searchInProgress) {
            search($("#addsensor_searchinput").val());
          }else{
          !!window.__ga && window.__ga("send", "event", "sensorsearch" , "filter", (selectedFamily.join(",")).substring(0,500), $(".addsensor_sensorcontainer:visible").not(".addsensor_disabledsensors").length);

          }
          hideEmptyCate();
        };

      var search = function(text) {
          var i, splitStr, stext=text;
          text = $.trim(text);
          if (text.length < 1) {
            $("#addsensor_headersearchtext").text("");
            $("#addsensor_resultcount").text(SensorTypes.length - top10Visible());
            for (i = 0; i < SensorTypes.length; i++) {
              if (SensorTypes[i]["show"]) {
                SensorTypes[i]["searchresult"] = false;
                SensorTypes[i]["$elm"].show();
              }
            }
            searchInProgress = false;
            filterSensors();
            return;
          }
          var results = 0;
          searchInProgress = true;

          splitStr = text.split(' ');
          text = '';
          for (i = splitStr.length - 1; i >= 0; i--) {
            text = text +'(?=.*?' + splitStr[i] + ')';
          }
          text = text + '^.*$';

          var searchStr = new RegExp(text, "ig");
          if (text.length > 0) {
            $("#addsensor_headersearchtext").text(" - Search: " + text);
          } else {
            $("#addsensor_headersearchtext").text("");
          }
          for (i = 0; i < SensorTypes.length; i++) {
            if (SensorTypes[i]["show"]) {
              if ((SensorTypes[i]["name"] + ' ' + SensorTypes[i]["description"] + ' ' + SensorTypes[i]["help"]).search(searchStr) > -1) {
                SensorTypes[i]["searchresult"] = true;
                SensorTypes[i]["$elm"].show();
                results = results + 1;
              } else {
                SensorTypes[i]["searchresult"] = false;
                SensorTypes[i]["$elm"].hide();
              }
            }
          }
          $("#addsensor_resultcount").text(results - top10Visible());
          hideEmptyCate();

          !!window.__ga && window.__ga("send", "event", "sensorsearch" , "text" + (selectedFamily.length > 0 ? "-filter" : "") , (stext + (selectedFamily.length > 0 ? '-' + selectedFamily.join(",") : "")).substring(0,500), $(".addsensor_sensorcontainer:visible").not(".addsensor_disabledsensors").length);

        };

      var preselection = function(id) {
          if ($('#preselection_' + id).find("option").eq(0).val() === '') {
            $('#preselection_' + id).find("option").eq(0).remove();
          }
          $('#preselection_' + id).attr("size", 10).css("width", "450px").dialog({
          	closeText: "",
            closeOnEscape: false,
            draggable: false,
            resizable: false,
            height: 370,
            modal: true,
            title: _Prtg.Lang.common.strings.selectalibraryfile,
            width: 550,
            zIndex: 8999,
            buttons: [{
              text: _Prtg.Lang.common.strings.ok,
              'class': "actionbutton",
              click: function() {
                $(this).dialog("destroy").hide();
                addSensor(id, true);
              }
            }, {
              text: _Prtg.Lang.common.strings.cancel,
              'class': "button btngrey",
              click: function() {
                $(this).dialog("destroy");
                $(this).remove();
              }
            }]
          });
          $('#preselection_' + id).css("width", "100%");
        };

      var addSensor = function(sensortype, preselection) {
          var urlData = {},
            progressDialog,
            progressInterval,
            addsensorxhr;
          urlData.id = objId;
          urlData.sensortype = sensortype;
          if (preselection !== undefined) {
            urlData["preselection_" + sensortype + "_nolist"] = $("#preselection_" + sensortype).val();
            urlData.sensortype = urlData.sensortype + "_nolist";
          }

          progressDialog = $('<div id="working" class="inline"><p class="loading"><span class="loadspinner"></span></p></div>').dialog({
            closeText: "",
            draggable: false,
            resizable: false,
            width: 350,
            modal: true,
            zIndex: 8999,
            title: $("<div/>").html(_Prtg.Lang.Dialogs.strings.working).text(),
            buttons: [{
              text: _Prtg.Lang.common.strings.cancel,
              'class': "button btngrey",
              'click': function() {
                clearInterval(progressInterval);
                if(addsensorxhr != undefined) addsensorxhr.abort();
                $(this).dialog('close');
                $(this).dialog("destroy");
                $(this).remove();
              }
            }]
          });

          var showprogressbar = function(response) {
            $('#working').html(response);
            progressDialog.dialog('option', 'width', 350);
            progressDialog.dialog('option', 'buttons',
              [{
              	closeText: "",
                text: _Prtg.Lang.common.strings.cancel,
                'class': "button btngrey",
                'click': function() {
                  clearInterval(progressInterval);
                  if(addsensorxhr != undefined) addsensorxhr.abort();
                  $(this).dialog('close');
                  $(this).dialog("destroy");
                  $(this).remove();
                }
              }]
            );
            if ($("#newprogressbar").length > 0) {
              $("#newprogressbar").progressbar({
                value: 0
              });
              progressInterval = setInterval(function() {
                $.ajax({
                  global: false,
                  dataType: "json",
                  url: "/api/getaddsensorprogress.htm?id=" + objId + "&tmpid=" + $('#tempid').val()
                }).done(function(json) {
                  $("#newprogressbar").progressbar({
                    value: json.progress
                  });
                  if (json.progress >= 100) {
                    _Prtg.Events.resume();
                    clearInterval(progressInterval);
                    if(window.winGUI) {
                      window.location.href = window.location.pathname + '?action=' + encodeURIComponent(json.targeturl);
                    } else {
				              $('#working').dialog('destroy').remove();
                    	$('#container').addClass('loading').html('<div class="loadspinner"></div>')
                    	_Prtg.Hjax.loadLink(json.targeturl);
                      // window.location.href = json.targeturl;
                    }
                  }
                });
              }, 1000);
            }
          };

          addsensorxhr = $.ajax({
            url: "/controls/addsensor2.htm",
            data: urlData,
            type: "GET",
            success: function(response) {
              $('#working').html(response);
              _Prtg.Events.pause();
              if($('#working').find('form').length > 0) {

                $('#working').on('keypress', function (event) {
                  if (event.keyCode == 13) {
                    $(this).parent().find("button.submit").trigger("click");
                    return false;
                  }
                });

                progressDialog.dialog('option', 'width', 800);
                progressDialog.dialog('option', 'buttons',
                [{
                	closeText: "",
                  text: _Prtg.Lang.Dialogs.strings["ok"],
                  'class': 'actionbutton',
                  click: function (event) {
                    var $form = $('#working').find('form');
                    $form.each(function() {
                      valid = $(this).valid();
                    });
                    if(!valid) { return; }
                    $.ajax({
                      url: $form.attr('action'),
                      data: $form.serializeArray(),
                      type: "POST"
                    }).done(function(response) {
                      showprogressbar(response);
                    });
                  }
                },
                {
                  text: _Prtg.Lang.common.strings.cancel,
                  'class': "button btngrey",
                  'click': function() {
                  clearInterval(progressInterval);
                  if(addsensorxhr !== undefined) addsensorxhr.abort();
                  $(this).dialog('close');
                  $(this).dialog("destroy");
                  $(this).remove();
                }
                }]);
                _Prtg.initPlugins($('#working'));
              } else {
                showprogressbar(response);
              }
            }
          });
        };

      return {
        init: function(data, parent) {
          var sensobj, devstat;
          $.when(
          $.getJSON("/api/sensortypes.json?id=" + data.devid, function(resp) {
            sensobj = resp;
          }), $.getJSON("/api/typesstatus.json?id=" + data.devid, function(resp) {
            devstat = resp;
          })).then(function() {
            init(sensobj, data.devid, devstat);
          });
        },
        ___: "_Prtg.AddSensor"
      };
    };
  $.extend(true, window, {
    _Prtg: {
      Plugins: {
        AddSensor: AddSensor()
      }
    }
  });
})(jQuery);
;

(function($) {
  function Sparkline() {
				function render($elm, data){
//				async function render($elm, data){
			    if ($elm.length > 0) {
				    if (data.graph && data.graph.length) {
//			        await $elm.sparkline(data.graph, {
			        $elm.sparkline(data.graph, {
			          type: 'line',
				        width: '110px',
				        height: '18px',
			          lineColor: '#aaaaaa',
			          fillColor: '#dddddd',
			          spotRadius: 0,
				        chartRangeMin: 0,
			          disableInteraction: true,
			          disableHiddenCheck: false
			        });
			      }
			    }
			    return null;
				}

    return {
      init: function(data, parent) {
  			render($(this), data);
      },

      ___: '_Prtg.Sparklines',
    };
  }

  function renderd3(elm) {
    counter++;
    var myobject = $(elm);
    var pxwidth = $(elm).parent().width() - 1;
    var pxheight = $(elm).parent().height();
    var data = myobject.data();
    var graph = d3.select(elm).append('svg:svg')
    	.attr({
    		'width': pxwidth + 'px',
    		'height': pxheight + 'px'
    	});
    var maxd = d3.max(data.graph);
    var maxe = d3.max(data.error);
    var xd = d3.scale.linear().domain([0, data.graph.length - 1]).range([0, pxwidth - 1]);
    var yd = d3.scale.linear().domain([0, Math.max(maxd, maxe)]).rangeRound([pxheight - 1, 0]);
    var xe = d3.scale.linear().domain([0, data.error.length - 1]).range([0, pxwidth - 1]);
    var ye = d3.scale.linear().domain([0, Math.max(maxd, maxe)]).rangeRound([pxheight - 1, 0]);
    var dataarea = d3.svg.area()
      .x(function(d, i) {
        return xd(i);
      })
      .y0(pxheight)
      .y1(function(d) {
        return yd(d);
      }).interpolate('linear');

    var errorline = d3.svg.line()
      .x(function(d, i) {
        return xe(i);
      })
      .y(function(d) {
        return ye(d);
      }).interpolate('linear');

    graph.append('svg:path').attr('class', 'error').attr('d', errorline(data.error));
    graph.append('svg:path').attr('class', 'data').attr('d', dataarea(data.graph));
    counter--;
    elm = null;
  }

  $.extend(true, window, {
    _Prtg: {
      Plugins: {
        Sparkline: Sparkline(),
      },
    },
  });
})(jQuery);
;
// Module: objecttree
_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
	sensorTree: {
		strings: {
			"ColumnHeaderLibrary":	'Library Objects',
			"ColumnHeaderObjects":	'Objects',
			"ColumnHeaderSensors":	'Sensors',
			"GroupsAndDeviceCount": '{name}&lt;br/&gt;({groupnum} Groups and {devicenum} Devices)&lt;br/&gt;{message}',
			"DeviceTitle": 			'{name}&lt;br/&gt;({totalsens} Sensors)&lt;br/&gt;{message}',
			"SearchTitle":			'Press Enter to search',
			"SizeBySensors":		'Sensors',
			"SizeByPriority":		'Priority',
			"AddDevice":			'Add Device',
			"AddSensor":			'Add Sensor',
			"AddRemoteProbe":		'Add Remote Probe',
			"AddGroup":				'Add Group',
			"AddNode":				'Add Node',
			"AddAutodiscoveryGroup": 'Add Auto-Discovery Group',
			"Disconnected":			'Disconnected',
			"Connected":			'Connected',
			"Denynewprobe":			'Deny',
      "Approvenewprobe":    'Approve',
      "ApprovenewprobeDisco":    'Approve and auto-discover',
			"Paused":				'Paused',
			"Pausedbydependency":	'Paused by dependency',
			"RunAutoDiscovery": 'Run Auto-Discovery',
			"AddLibraynode": 'Add Library Node'
		}
	}
});
/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
// Created: 2008-06-04 
// Updated: 2012-05-21
// REQUIRES: jquery 1.7.x

;(function( $ ){

// add the jquery instance method
$.fn.drag = function( str, arg, opts ){
	// figure out the event type
	var type = typeof str == "string" ? str : "",
	// figure out the event handler...
	fn = $.isFunction( str ) ? str : $.isFunction( arg ) ? arg : null;
	// fix the event type
	if ( type.indexOf("drag") !== 0 ) 
		type = "drag"+ type;
	// were options passed
	opts = ( str == fn ? arg : opts ) || {};
	// trigger or bind event handler
	return fn ? this.bind( type, opts, fn ) : this.trigger( type );
};

// local refs (increase compression)
var $event = $.event, 
$special = $event.special,
// configure the drag special event 
drag = $special.drag = {
	
	// these are the default settings
	defaults: {
		which: 1, // mouse button pressed to start drag sequence
		distance: 0, // distance dragged before dragstart
		not: ':input', // selector to suppress dragging on target elements
		handle: null, // selector to match handle target elements
		relative: false, // true to use "position", false to use "offset"
		drop: true, // false to suppress drop events, true or selector to allow
		click: false // false to suppress click events after dragend (no proxy)
	},
	
	// the key name for stored drag data
	datakey: "dragdata",
	
	// prevent bubbling for better performance
	noBubble: true,
	
	// count bound related events
	add: function( obj ){ 
		// read the interaction data
		var data = $.data( this, drag.datakey ),
		// read any passed options 
		opts = obj.data || {};
		// count another realted event
		data.related += 1;
		// extend data options bound with this event
		// don't iterate "opts" in case it is a node 
		$.each( drag.defaults, function( key, def ){
			if ( opts[ key ] !== undefined )
				data[ key ] = opts[ key ];
		});
	},
	
	// forget unbound related events
	remove: function(){
		$.data( this, drag.datakey ).related -= 1;
	},
	
	// configure interaction, capture settings
	setup: function(){
		// check for related events
		if ( $.data( this, drag.datakey ) ) 
			return;
		// initialize the drag data with copied defaults
		var data = $.extend({ related:0 }, drag.defaults );
		// store the interaction data
		$.data( this, drag.datakey, data );
		// bind the mousedown event, which starts drag interactions
		$event.add( this, "touchstart mousedown", drag.init, data );
		// prevent image dragging in IE...
		if ( this.attachEvent ) 
			this.attachEvent("ondragstart", drag.dontstart ); 
	},
	
	// destroy configured interaction
	teardown: function(){
		var data = $.data( this, drag.datakey ) || {};
		// check for related events
		if ( data.related ) 
			return;
		// remove the stored data
		$.removeData( this, drag.datakey );
		// remove the mousedown event
		$event.remove( this, "touchstart mousedown", drag.init );
		// enable text selection
		drag.textselect( true ); 
		// un-prevent image dragging in IE...
		if ( this.detachEvent ) 
			this.detachEvent("ondragstart", drag.dontstart ); 
	},
		
	// initialize the interaction
	init: function( event ){ 
		// sorry, only one touch at a time
		if ( drag.touched ) 
			return;
		// the drag/drop interaction data
		var dd = event.data, results;
		// check the which directive
		if ( event.which != 0 && dd.which > 0 && event.which != dd.which ) 
			return; 
		// check for suppressed selector
		if ( $( event.target ).is( dd.not ) ) 
			return;
		// check for handle selector
		if ( dd.handle && !$( event.target ).closest( dd.handle, event.currentTarget ).length ) 
			return;

		drag.touched = event.type == 'touchstart' ? this : null;
		dd.propagates = 1;
		dd.mousedown = this;
		dd.interactions = [ drag.interaction( this, dd ) ];
		dd.target = event.target;
		dd.pageX = event.pageX;
		dd.pageY = event.pageY;
		dd.dragging = null;
		// handle draginit event... 
		results = drag.hijack( event, "draginit", dd );
		// early cancel
		if ( !dd.propagates )
			return;
		// flatten the result set
		results = drag.flatten( results );
		// insert new interaction elements
		if ( results && results.length ){
			dd.interactions = [];
			$.each( results, function(){
				dd.interactions.push( drag.interaction( this, dd ) );
			});
		}
		// remember how many interactions are propagating
		dd.propagates = dd.interactions.length;
		// locate and init the drop targets
		if ( dd.drop !== false && $special.drop ) 
			$special.drop.handler( event, dd );
		// disable text selection
		drag.textselect( false ); 
		// bind additional events...
		if ( drag.touched )
			$event.add( drag.touched, "touchmove touchend", drag.handler, dd );
		else 
			$event.add( document, "mousemove mouseup", drag.handler, dd );
		// helps prevent text selection or scrolling
		if ( !drag.touched || dd.live )
			return false;
	},	
	
	// returns an interaction object
	interaction: function( elem, dd ){
		var offset = $( elem )[ dd.relative ? "position" : "offset" ]() || { top:0, left:0 };
		return {
			drag: elem, 
			callback: new drag.callback(), 
			droppable: [],
			offset: offset
		};
	},
	
	// handle drag-releatd DOM events
	handler: function( event ){ 
		// read the data before hijacking anything
		var dd = event.data;	
		// handle various events
		switch ( event.type ){
			// mousemove, check distance, start dragging
			case !dd.dragging && 'touchmove': 
				event.preventDefault();
			case !dd.dragging && 'mousemove':
				//  drag tolerance, pythagoras
				if ( Math.pow(  event.pageX-dd.pageX, 2 ) + Math.pow(  event.pageY-dd.pageY, 2 ) < Math.pow( dd.distance, 2 ) ) 
					break; // distance tolerance not reached
				event.target = dd.target; // force target from "mousedown" event (fix distance issue)
				drag.hijack( event, "dragstart", dd ); // trigger "dragstart"
				if ( dd.propagates ) // "dragstart" not rejected
					dd.dragging = true; // activate interaction
			// mousemove, dragging
			case 'touchmove':
				event.preventDefault();
			case 'mousemove':
				if ( dd.dragging ){
					// trigger "drag"		
					drag.hijack( event, "drag", dd );
					if ( dd.propagates ){
						// manage drop events
						if ( dd.drop !== false && $special.drop )
							$special.drop.handler( event, dd ); // "dropstart", "dropend"							
						break; // "drag" not rejected, stop		
					}
					event.type = "mouseup"; // helps "drop" handler behave
				}
			// mouseup, stop dragging
			case 'touchend': 
			case 'mouseup': 
			default:
				if ( drag.touched )
					$event.remove( drag.touched, "touchmove touchend", drag.handler ); // remove touch events
				else 
					$event.remove( document, "mousemove mouseup", drag.handler ); // remove page events	
				if ( dd.dragging ){
					if ( dd.drop !== false && $special.drop )
						$special.drop.handler( event, dd ); // "drop"
					drag.hijack( event, "dragend", dd ); // trigger "dragend"	
				}
				drag.textselect( true ); // enable text selection
				// if suppressing click events...
				if ( dd.click === false && dd.dragging )
					$.data( dd.mousedown, "suppress.click", new Date().getTime() + 5 );
				dd.dragging = drag.touched = false; // deactivate element	
				break;
		}
	},
		
	// re-use event object for custom events
	hijack: function( event, type, dd, x, elem ){
		// not configured
		if ( !dd ) 
			return;
		// remember the original event and type
		var orig = { event:event.originalEvent, type:event.type },
		// is the event drag related or drog related?
		mode = type.indexOf("drop") ? "drag" : "drop",
		// iteration vars
		result, i = x || 0, ia, $elems, callback,
		len = !isNaN( x ) ? x : dd.interactions.length;
		// modify the event type
		event.type = type;
		// remove the original event
		event.originalEvent = null;
		// initialize the results
		dd.results = [];
		// handle each interacted element
		do if ( ia = dd.interactions[ i ] ){
			// validate the interaction
			if ( type !== "dragend" && ia.cancelled )
				continue;
			// set the dragdrop properties on the event object
			callback = drag.properties( event, dd, ia );
			// prepare for more results
			ia.results = [];
			// handle each element
			$( elem || ia[ mode ] || dd.droppable ).each(function( p, subject ){
				// identify drag or drop targets individually
				callback.target = subject;
				// force propagtion of the custom event
				event.isPropagationStopped = function(){ return false; };
				// handle the event	
				result = subject ? $event.dispatch.call( subject, event, callback ) : null;
				// stop the drag interaction for this element
				if ( result === false ){
					if ( mode == "drag" ){
						ia.cancelled = true;
						dd.propagates -= 1;
					}
					if ( type == "drop" ){
						ia[ mode ][p] = null;
					}
				}
				// assign any dropinit elements
				else if ( type == "dropinit" )
					ia.droppable.push( drag.element( result ) || subject );
				// accept a returned proxy element 
				if ( type == "dragstart" )
					ia.proxy = $( drag.element( result ) || ia.drag )[0];
				// remember this result	
				ia.results.push( result );
				// forget the event result, for recycling
				delete event.result;
				// break on cancelled handler
				if ( type !== "dropinit" )
					return result;
			});	
			// flatten the results	
			dd.results[ i ] = drag.flatten( ia.results );	
			// accept a set of valid drop targets
			if ( type == "dropinit" )
				ia.droppable = drag.flatten( ia.droppable );
			// locate drop targets
			if ( type == "dragstart" && !ia.cancelled )
				callback.update(); 
		}
		while ( ++i < len )
		// restore the original event & type
		event.type = orig.type;
		event.originalEvent = orig.event;
		// return all handler results
		return drag.flatten( dd.results );
	},
		
	// extend the callback object with drag/drop properties...
	properties: function( event, dd, ia ){		
		var obj = ia.callback;
		// elements
		obj.drag = ia.drag;
		obj.proxy = ia.proxy || ia.drag;
		// starting mouse position
		obj.startX = dd.pageX;
		obj.startY = dd.pageY;
		// current distance dragged
		obj.deltaX = event.pageX - dd.pageX;
		obj.deltaY = event.pageY - dd.pageY;
		// original element position
		obj.originalX = ia.offset.left;
		obj.originalY = ia.offset.top;
		// adjusted element position
		obj.offsetX = obj.originalX + obj.deltaX; 
		obj.offsetY = obj.originalY + obj.deltaY;
		// assign the drop targets information
		obj.drop = drag.flatten( ( ia.drop || [] ).slice() );
		obj.available = drag.flatten( ( ia.droppable || [] ).slice() );
		return obj;	
	},
	
	// determine is the argument is an element or jquery instance
	element: function( arg ){
		if ( arg && ( arg.jquery || arg.nodeType == 1 ) )
			return arg;
	},
	
	// flatten nested jquery objects and arrays into a single dimension array
	flatten: function( arr ){
		return $.map( arr, function( member ){
			return member && member.jquery ? $.makeArray( member ) : 
				member && member.length ? drag.flatten( member ) : member;
		});
	},
	
	// toggles text selection attributes ON (true) or OFF (false)
	textselect: function( bool ){ 
		$( document )[ bool ? "unbind" : "bind" ]("selectstart", drag.dontstart )
			.css("MozUserSelect", bool ? "" : "none" );
		// .attr("unselectable", bool ? "off" : "on" )
		document.unselectable = bool ? "off" : "on"; 
	},
	
	// suppress "selectstart" and "ondragstart" events
	dontstart: function(){ 
		return false; 
	},
	
	// a callback instance contructor
	callback: function(){}
	
};

// callback methods
drag.callback.prototype = {
	update: function(){
		if ( $special.drop && this.available.length )
			$.each( this.available, function( i ){
				$special.drop.locate( this, i );
			});
	}
};

// patch $.event.$dispatch to allow suppressing clicks
var $dispatch = $event.dispatch;
$event.dispatch = function( event ){
	if ( $.data( this, "suppress."+ event.type ) - new Date().getTime() > 0 ){
		$.removeData( this, "suppress."+ event.type );
		return;
	}
	return $dispatch.apply( this, arguments );
};

// event fix hooks for touch events...
var touchHooks = 
$event.fixHooks.touchstart = 
$event.fixHooks.touchmove = 
$event.fixHooks.touchend =
$event.fixHooks.touchcancel = {
	props: "clientX clientY pageX pageY screenX screenY".split( " " ),
	filter: function( event, orig ) {
		if ( orig ){
			var touched = ( orig.touches && orig.touches[0] )
				|| ( orig.changedTouches && orig.changedTouches[0] )
				|| null; 
			// iOS webkit: touchstart, touchmove, touchend
			if ( touched ) 
				$.each( touchHooks.props, function( i, prop ){
					event[ prop ] = touched[ prop ];
				});
		}
		return event;
	}
};

// share the same special event configuration with related events...
$special.draginit = $special.dragstart = $special.dragend = drag;

})( jQuery );;
/*! 
 * jquery.event.drag.live - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
// Created: 2010-06-07
// Updated: 2012-05-21
// REQUIRES: jquery 1.7.x, event.drag 2.2

;(function( $ ){
	
// local refs (increase compression)
var $event = $.event,
// ref the special event config
drag = $event.special.drag,
// old drag event add method
origadd = drag.add,
// old drag event teradown method
origteardown = drag.teardown;

// allow events to bubble for delegation
drag.noBubble = false;

// the namespace for internal live events
drag.livekey = "livedrag";

// new drop event add method
drag.add = function( obj ){ 
	// call the old method
	origadd.apply( this, arguments );
	// read the data
	var data = $.data( this, drag.datakey );
	// bind the live "draginit" delegator
	if ( !data.live && obj.selector ){
		data.live = true;
		$event.add( this, "draginit."+ drag.livekey, drag.delegate );
	}
};

// new drop event teardown method
drag.teardown = function(){ 
	// call the old method
	origteardown.apply( this, arguments );
	// read the data
	var data = $.data( this, drag.datakey ) || {};
	// bind the live "draginit" delegator
	if ( data.live ){
		// remove the "live" delegation
		$event.remove( this, "draginit."+ drag.livekey, drag.delegate );
		data.live = false;
	}
};

// identify potential delegate elements
drag.delegate = function( event ){
	// local refs
	var elems = [], target, 
	// element event structure
	events = $._data( this, "events" ) || {};
	// query live events
	$.each( events || [], function( key, arr ){
		// no event type matches
		if ( key.indexOf("drag") !== 0 )
			return;
		$.each( arr || [], function( i, obj ){
			// locate the element to delegate
			target = $( event.target ).closest( obj.selector, event.currentTarget )[0];
			// no element found
			if ( !target ) 
				return;
			// add an event handler
			$event.add( target, obj.origType+'.'+drag.livekey, obj.origHandler || obj.handler, obj.data );
			// remember new elements
			if ( $.inArray( target, elems ) < 0 )
				elems.push( target );		
		});
	});
	// if there are no elements, break
	if ( !elems.length ) 
		return false;
	// return the matched results, and clenup when complete		
	return $( elems ).bind("dragend."+ drag.livekey, function(){
		$event.remove( this, "."+ drag.livekey ); // cleanup delegation
	});
};
	
})( jQuery );;
/*! 
 * jquery.event.drop - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
// Created: 2008-06-04 
// Updated: 2012-05-21
// REQUIRES: jquery 1.7.x, event.drag 2.2

;(function($){ // secure $ jQuery alias

// Events: drop, dropstart, dropend

// add the jquery instance method
$.fn.drop = function( str, arg, opts ){
	// figure out the event type
	var type = typeof str == "string" ? str : "",
	// figure out the event handler...
	fn = $.isFunction( str ) ? str : $.isFunction( arg ) ? arg : null;
	// fix the event type
	if ( type.indexOf("drop") !== 0 ) 
		type = "drop"+ type;
	// were options passed
	opts = ( str == fn ? arg : opts ) || {};
	// trigger or bind event handler
	return fn ? this.bind( type, opts, fn ) : this.trigger( type );
};

// DROP MANAGEMENT UTILITY
// returns filtered drop target elements, caches their positions
$.drop = function( opts ){ 
	opts = opts || {};
	// safely set new options...
	drop.multi = opts.multi === true ? Infinity : 
		opts.multi === false ? 1 : !isNaN( opts.multi ) ? opts.multi : drop.multi;
	drop.delay = opts.delay || drop.delay;
	drop.tolerance = $.isFunction( opts.tolerance ) ? opts.tolerance : 
		opts.tolerance === null ? null : drop.tolerance;
	drop.mode = opts.mode || drop.mode || 'intersect';
};

// local refs (increase compression)
var $event = $.event, 
$special = $event.special,
// configure the drop special event
drop = $.event.special.drop = {

	// these are the default settings
	multi: 1, // allow multiple drop winners per dragged element
	delay: 20, // async timeout delay
	mode: 'overlap', // drop tolerance mode
		
	// internal cache
	targets: [], 
	
	// the key name for stored drop data
	datakey: "dropdata",
		
	// prevent bubbling for better performance
	noBubble: true,
	
	// count bound related events
	add: function( obj ){ 
		// read the interaction data
		var data = $.data( this, drop.datakey );
		// count another realted event
		data.related += 1;
	},
	
	// forget unbound related events
	remove: function(){
		$.data( this, drop.datakey ).related -= 1;
	},
	
	// configure the interactions
	setup: function(){
		// check for related events
		if ( $.data( this, drop.datakey ) ) 
			return;
		// initialize the drop element data
		var data = { 
			related: 0,
			active: [],
			anyactive: 0,
			winner: 0,
			location: {}
		};
		// store the drop data on the element
		$.data( this, drop.datakey, data );
		// store the drop target in internal cache
		drop.targets.push( this );
	},
	
	// destroy the configure interaction	
	teardown: function(){ 
		var data = $.data( this, drop.datakey ) || {};
		// check for related events
		if ( data.related ) 
			return;
		// remove the stored data
		$.removeData( this, drop.datakey );
		// reference the targeted element
		var element = this;
		// remove from the internal cache
		drop.targets = $.grep( drop.targets, function( target ){ 
			return ( target !== element ); 
		});
	},
	
	// shared event handler
	handler: function( event, dd ){ 
		// local vars
		var results, $targets;
		// make sure the right data is available
		if ( !dd ) 
			return;
		// handle various events
		switch ( event.type ){
			// draginit, from $.event.special.drag
			case 'mousedown': // DROPINIT >>
			case 'touchstart': // DROPINIT >>
				// collect and assign the drop targets
				$targets =  $( drop.targets );
				if ( typeof dd.drop == "string" )
					$targets = $targets.filter( dd.drop );
				// reset drop data winner properties
				$targets.each(function(){
					var data = $.data( this, drop.datakey );
					data.active = [];
					data.anyactive = 0;
					data.winner = 0;
				});
				// set available target elements
				dd.droppable = $targets;
				// activate drop targets for the initial element being dragged
				$special.drag.hijack( event, "dropinit", dd ); 
				break;
			// drag, from $.event.special.drag
			case 'mousemove': // TOLERATE >>
			case 'touchmove': // TOLERATE >>
				drop.event = event; // store the mousemove event
				if ( !drop.timer )
					// monitor drop targets
					drop.tolerate( dd ); 
				break;
			// dragend, from $.event.special.drag
			case 'mouseup': // DROP >> DROPEND >>
			case 'touchend': // DROP >> DROPEND >>
				drop.timer = clearTimeout( drop.timer ); // delete timer	
				if ( dd.propagates ){
					$special.drag.hijack( event, "drop", dd ); 
					$special.drag.hijack( event, "dropend", dd ); 
				}
				break;
				
		}
	},
		
	// returns the location positions of an element
	locate: function( elem, index ){ 
		var data = $.data( elem, drop.datakey ),
		$elem = $( elem ), 
		posi = $elem.offset() || {}, 
		height = $elem.outerHeight(), 
		width = $elem.outerWidth(),
		location = { 
			elem: elem, 
			width: width, 
			height: height,
			top: posi.top, 
			left: posi.left, 
			right: posi.left + width, 
			bottom: posi.top + height
		};
		// drag elements might not have dropdata
		if ( data ){
			data.location = location;
			data.index = index;
			data.elem = elem;
		}
		return location;
	},
	
	// test the location positions of an element against another OR an X,Y coord
	contains: function( target, test ){ // target { location } contains test [x,y] or { location }
		return ( ( test[0] || test.left ) >= target.left && ( test[0] || test.right ) <= target.right
			&& ( test[1] || test.top ) >= target.top && ( test[1] || test.bottom ) <= target.bottom ); 
	},
	
	// stored tolerance modes
	modes: { // fn scope: "$.event.special.drop" object 
		// target with mouse wins, else target with most overlap wins
		'intersect': function( event, proxy, target ){
			return this.contains( target, [ event.pageX, event.pageY ] ) ? // check cursor
				1e9 : this.modes.overlap.apply( this, arguments ); // check overlap
		},
		// target with most overlap wins	
		'overlap': function( event, proxy, target ){
			// calculate the area of overlap...
			return Math.max( 0, Math.min( target.bottom, proxy.bottom ) - Math.max( target.top, proxy.top ) )
				* Math.max( 0, Math.min( target.right, proxy.right ) - Math.max( target.left, proxy.left ) );
		},
		// proxy is completely contained within target bounds	
		'fit': function( event, proxy, target ){
			return this.contains( target, proxy ) ? 1 : 0;
		},
		// center of the proxy is contained within target bounds	
		'middle': function( event, proxy, target ){
			return this.contains( target, [ proxy.left + proxy.width * .5, proxy.top + proxy.height * .5 ] ) ? 1 : 0;
		}
	},	
	
	// sort drop target cache by by winner (dsc), then index (asc)
	sort: function( a, b ){
		return ( b.winner - a.winner ) || ( a.index - b.index );
	},
		
	// async, recursive tolerance execution
	tolerate: function( dd ){		
		// declare local refs
		var i, drp, drg, data, arr, len, elem,
		// interaction iteration variables
		x = 0, ia, end = dd.interactions.length,
		// determine the mouse coords
		xy = [ drop.event.pageX, drop.event.pageY ],
		// custom or stored tolerance fn
		tolerance = drop.tolerance || drop.modes[ drop.mode ];
		// go through each passed interaction...
		do if ( ia = dd.interactions[x] ){
			// check valid interaction
			if ( !ia )
				return; 
			// initialize or clear the drop data
			ia.drop = [];
			// holds the drop elements
			arr = []; 
			len = ia.droppable.length;
			// determine the proxy location, if needed
			if ( tolerance )
				drg = drop.locate( ia.proxy ); 
			// reset the loop
			i = 0;
			// loop each stored drop target
			do if ( elem = ia.droppable[i] ){ 
				data = $.data( elem, drop.datakey );
				if ( !data ) continue; /* FIXED ! */ 
				drp = data.location;
				if ( !drp ) continue;
				// find a winner: tolerance function is defined, call it
				data.winner = tolerance ? tolerance.call( drop, drop.event, drg, drp ) 
					// mouse position is always the fallback
					: drop.contains( drp, xy ) ? 1 : 0; 
				arr.push( data );	
			} while ( ++i < len ); // loop 
			// sort the drop targets
			arr.sort( drop.sort );			
			// reset the loop
			i = 0;
			// loop through all of the targets again
			do if ( data = arr[ i ] ){
				// winners...
				if ( data.winner && ia.drop.length < drop.multi ){
					// new winner... dropstart
					if ( !data.active[x] && !data.anyactive ){
						// check to make sure that this is not prevented
						if ( $special.drag.hijack( drop.event, "dropstart", dd, x, data.elem )[0] !== false ){ 	
							data.active[x] = 1;
							data.anyactive += 1;
						}
						// if false, it is not a winner
						else
							data.winner = 0;
					}
					// if it is still a winner
					if ( data.winner )
						ia.drop.push( data.elem );
				}
				// losers... 
				else if ( data.active[x] && data.anyactive == 1 ){
					// former winner... dropend
					$special.drag.hijack( drop.event, "dropend", dd, x, data.elem ); 
					data.active[x] = 0;
					data.anyactive -= 1;
				}
			} while ( ++i < len ); // loop 		
		} while ( ++x < end ) // loop
		// check if the mouse is still moving or is idle
		if ( drop.last && xy[0] == drop.last.pageX && xy[1] == drop.last.pageY ) 
			delete drop.timer; // idle, don't recurse
		else  // recurse
			drop.timer = setTimeout(function(){ 
				drop.tolerate( dd ); 
			}, drop.delay );
		// remember event, to compare idleness
		drop.last = drop.event; 
	}
	
};

// share the same special event configuration with related events...
$special.dropinit = $special.dropstart = $special.dropend = drop;

})(jQuery); // confine scope	;
/*! 
 * jquery.event.drop.live - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
// Created: 2010-06-07
// Updated: 2012-05-21
// REQUIRES: jquery 1.7.x, event.drag 2.2, event.drop 2.2
// extendet by PAESSLER AG for scroll events
//
;(function($){ // secure $ jQuery alias

// local refs (increase compression)
var $event = $.event,
$special = $event.special,
// ref the drop special event config
drop = $event.special.drop,
// old drop event add method
origadd = drop.add,
// old drop event teradown method
origteardown = drop.teardown;

// allow events to bubble for delegation
drop.noBubble = false;

// the namespace for internal live events
drop.livekey = "livedrop";

// new drop event add method
drop.add = function( obj ){ 
	// call the old method
	origadd.apply( this, arguments );
	// read the data
	var data = $.data( this, drop.datakey );
	// bind the live "dropinit" delegator
	if ( !data.live && obj.selector ){
		data.live = true;
		$(this).on("dropinit."+ drop.livekey, drop.delegate);
		//$event.add( this, "dropinit."+ drop.livekey, drop.delegate );
	}
};

// new drop event teardown method
drop.teardown = function(){ 
	// call the old method
	origteardown.apply( this, arguments );
	// read the data
	var data = $.data( this, drop.datakey ) || {};
	// remove the live "dropinit" delegator
	if ( data.live ){
		// remove the "live" delegation
		$event.remove( this, "dropinit", drop.delegate );
		data.live = false;
	}
};

//-->customized
// scroll events
drop.initIvent = false;
drop.handleObject = null;
drop.reinit = function(){
	drop.initIvent = true;
};
//<--customized

// shared event handler override
drop.handler = function( event, dd ){ 
		// local vars
		var results, $targets;
		// make sure the right data is available
		if ( !dd ) 
			return;
//-->customized
		//scroll ebvent call drop.reinit()
		if(drop.initIvent === true){
			event.type = 'mousedown';
			event.handler = drop.delegate;
			var saveDrop = [];
			for(var i=0, l=dd.interactions.length; i < l; ++i){
				saveDrop[i] = dd.interactions[i].drop;
			}
			var saveHandleObject = event.handleObject;
			event.handleObject = drop.handleObject;
			delete dd.interactions[0].drop;
		}
//<--customized


		// handle various events
		switch ( event.type ){
			// draginit, from $.event.special.drag
			case 'mousedown': // DROPINIT >>
			case 'touchstart': // DROPINIT >>
				// collect and assign the drop targets
				$targets =  $( drop.targets );
				if ( typeof dd.drop == "string" )
					$targets = $targets.filter( dd.drop );
				// reset drop data winner properties
				$targets.each(function(){
					var data = $.data( this, drop.datakey );
					data.active = [];
					data.anyactive = 0;
					data.winner = 0;
				});
				// set available target elements
				dd.droppable = $targets;
				// activate drop targets for the initial element being dragged
				$special.drag.hijack( event, "dropinit", dd ); 
//-->customized
				if(drop.initIvent === true){
					event.handleObject = saveHandleObject;
					for(var i=0, l=dd.interactions.length; i < l; ++i){
						dd.interactions[i].drop = saveDrop[i];
						$.each(dd.interactions[0].droppable || [], function (i) {
							drop.locate(this, i);
						});
					}
					drop.initIvent = false;
				}
//<--customized
				break;
			// drag, from $.event.special.drag
			case 'mousemove': // TOLERATE >>
			case 'touchmove': // TOLERATE >>
				drop.event = event; // store the mousemove event
				if ( !drop.timer )
					// monitor drop targets
					drop.tolerate( dd ); 
				break;
			// dragend, from $.event.special.drag
			case 'mouseup': // DROP >> DROPEND >>
			case 'touchend': // DROP >> DROPEND >>
				drop.timer = clearTimeout( drop.timer ); // delete timer	
				if ( dd.propagates ){
					$special.drag.hijack( event, "drop", dd ); 
					$special.drag.hijack( event, "dropend", dd ); 
				}
				break;
				
		}
	};


// identify potential delegate elements
drop.delegate = function( event, dd ){
	// local refs
	var elems = [], $targets, 
	// element event structure
	events = $._data( this, "events" ) || {};
	// query live events
	$.each( events || [], function( key, arr ){
		// no event type matches
		if ( key.indexOf("drop") !== 0 )
			return;
		$.each( arr, function( i, obj ){
			// locate the elements to delegate
			$targets = $( event.currentTarget ).find( obj.selector );
			// no element found
			if ( !$targets.length ) 
				return;
			// take each target...
			$targets.each(function(){
				// add an event handler
				$event.add( this, obj.origType +'.'+ drop.livekey, obj.origHandler || obj.handler, obj.data );
				// remember new elements
				if ( $.inArray( this, elems ) < 0 )
					elems.push( this );	
			});	
		});
	});
	// may not exist when artifically triggering dropinit event
	if ( dd )
		// clean-up after the interaction ends
		$event.add( dd.drag, "dragend."+drop.livekey, function(){
			$.each( elems.concat( this ), function(){
				$event.remove( this, '.'+ drop.livekey );							
			});
		});
	//drop.delegates.push( elems );
	return elems.length ? $( elems ) : false;
};

})( jQuery ); // confine scope	;

/* Chosen v1.8.7 | (c) 2011-2018 by Harvest | MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md */

(function(){var t,e,s,i,n=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function s(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},o={}.hasOwnProperty;(i=function(){function t(){this.options_index=0,this.parsed=[]}return t.prototype.add_node=function(t){return"OPTGROUP"===t.nodeName.toUpperCase()?this.add_group(t):this.add_option(t)},t.prototype.add_group=function(t){var e,s,i,n,r,o;for(e=this.parsed.length,this.parsed.push({array_index:e,group:!0,label:t.label,title:t.title?t.title:void 0,children:0,disabled:t.disabled,classes:t.className}),o=[],s=0,i=(r=t.childNodes).length;s<i;s++)n=r[s],o.push(this.add_option(n,e,t.disabled));return o},t.prototype.add_option=function(t,e,s){if("OPTION"===t.nodeName.toUpperCase())return""!==t.text?(null!=e&&(this.parsed[e].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:t.value,text:t.text,html:t.innerHTML,title:t.title?t.title:void 0,selected:t.selected,disabled:!0===s?s:t.disabled,group_array_index:e,group_label:null!=e?this.parsed[e].label:null,classes:t.className,style:t.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1},t}()).select_to_array=function(t){var e,s,n,r,o;for(r=new i,s=0,n=(o=t.childNodes).length;s<n;s++)e=o[s],r.add_node(e);return r.parsed},e=function(){function t(e,s){this.form_field=e,this.options=null!=s?s:{},this.label_click_handler=n(this.label_click_handler,this),t.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers(),this.on_ready())}return t.prototype.set_default_values=function(){return this.click_test_action=function(t){return function(e){return t.test_active_click(e)}}(this),this.activate_action=function(t){return function(e){return t.activate_field(e)}}(this),this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.is_rtl=this.options.rtl||/\bchosen-rtl\b/.test(this.form_field.className),this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text&&this.options.allow_single_deselect,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null==this.options.enable_split_word_search||this.options.enable_split_word_search,this.group_search=null==this.options.group_search||this.options.group_search,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null==this.options.single_backstroke_delete||this.options.single_backstroke_delete,this.max_selected_options=this.options.max_selected_options||Infinity,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null==this.options.display_selected_options||this.options.display_selected_options,this.display_disabled_options=null==this.options.display_disabled_options||this.options.display_disabled_options,this.include_group_label_in_selected=this.options.include_group_label_in_selected||!1,this.max_shown_results=this.options.max_shown_results||Number.POSITIVE_INFINITY,this.case_sensitive_search=this.options.case_sensitive_search||!1,this.hide_results_on_select=null==this.options.hide_results_on_select||this.options.hide_results_on_select},t.prototype.set_default_text=function(){return this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||t.default_multiple_text:this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||t.default_single_text,this.default_text=this.escape_html(this.default_text),this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||t.default_no_result_text},t.prototype.choice_label=function(t){return this.include_group_label_in_selected&&null!=t.group_label?"<b class='group-name'>"+this.escape_html(t.group_label)+"</b>"+t.html:t.html},t.prototype.mouse_enter=function(){return this.mouse_on_container=!0},t.prototype.mouse_leave=function(){return this.mouse_on_container=!1},t.prototype.input_focus=function(t){if(this.is_multiple){if(!this.active_field)return setTimeout(function(t){return function(){return t.container_mousedown()}}(this),50)}else if(!this.active_field)return this.activate_field()},t.prototype.input_blur=function(t){if(!this.mouse_on_container)return this.active_field=!1,setTimeout(function(t){return function(){return t.blur_test()}}(this),100)},t.prototype.label_click_handler=function(t){return this.is_multiple?this.container_mousedown(t):this.activate_field()},t.prototype.results_option_build=function(t){var e,s,i,n,r,o,h;for(e="",h=0,n=0,r=(o=this.results_data).length;n<r&&(s=o[n],i="",""!==(i=s.group?this.result_add_group(s):this.result_add_option(s))&&(h++,e+=i),(null!=t?t.first:void 0)&&(s.selected&&this.is_multiple?this.choice_build(s):s.selected&&!this.is_multiple&&this.single_set_selected_text(this.choice_label(s))),!(h>=this.max_shown_results));n++);return e},t.prototype.result_add_option=function(t){var e,s;return t.search_match&&this.include_option_in_results(t)?(e=[],t.disabled||t.selected&&this.is_multiple||e.push("active-result"),!t.disabled||t.selected&&this.is_multiple||e.push("disabled-result"),t.selected&&e.push("result-selected"),null!=t.group_array_index&&e.push("group-option"),""!==t.classes&&e.push(t.classes),s=document.createElement("li"),s.className=e.join(" "),t.style&&(s.style.cssText=t.style),s.setAttribute("data-option-array-index",t.array_index),s.innerHTML=t.highlighted_html||t.html,t.title&&(s.title=t.title),this.outerHTML(s)):""},t.prototype.result_add_group=function(t){var e,s;return(t.search_match||t.group_match)&&t.active_options>0?((e=[]).push("group-result"),t.classes&&e.push(t.classes),s=document.createElement("li"),s.className=e.join(" "),s.innerHTML=t.highlighted_html||this.escape_html(t.label),t.title&&(s.title=t.title),this.outerHTML(s)):""},t.prototype.results_update_field=function(){if(this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build(),this.results_showing)return this.winnow_results()},t.prototype.reset_single_select_options=function(){var t,e,s,i,n;for(n=[],t=0,e=(s=this.results_data).length;t<e;t++)(i=s[t]).selected?n.push(i.selected=!1):n.push(void 0);return n},t.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},t.prototype.results_search=function(t){return this.results_showing?this.winnow_results():this.results_show()},t.prototype.winnow_results=function(t){var e,s,i,n,r,o,h,l,c,_,a,u,d,p,f;for(this.no_results_clear(),_=0,e=(h=this.get_search_text()).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),c=this.get_search_regex(e),i=0,n=(l=this.results_data).length;i<n;i++)(r=l[i]).search_match=!1,a=null,u=null,r.highlighted_html="",this.include_option_in_results(r)&&(r.group&&(r.group_match=!1,r.active_options=0),null!=r.group_array_index&&this.results_data[r.group_array_index]&&(0===(a=this.results_data[r.group_array_index]).active_options&&a.search_match&&(_+=1),a.active_options+=1),f=r.group?r.label:r.text,r.group&&!this.group_search||(u=this.search_string_match(f,c),r.search_match=null!=u,r.search_match&&!r.group&&(_+=1),r.search_match?(h.length&&(d=u.index,o=f.slice(0,d),s=f.slice(d,d+h.length),p=f.slice(d+h.length),r.highlighted_html=this.escape_html(o)+"<em>"+this.escape_html(s)+"</em>"+this.escape_html(p)),null!=a&&(a.group_match=!0)):null!=r.group_array_index&&this.results_data[r.group_array_index].search_match&&(r.search_match=!0)));return this.result_clear_highlight(),_<1&&h.length?(this.update_results_content(""),this.no_results(h)):(this.update_results_content(this.results_option_build()),(null!=t?t.skip_highlight:void 0)?void 0:this.winnow_results_set_highlight())},t.prototype.get_search_regex=function(t){var e,s;return s=this.search_contains?t:"(^|\\s|\\b)"+t+"[^\\s]*",this.enable_split_word_search||this.search_contains||(s="^"+s),e=this.case_sensitive_search?"":"i",new RegExp(s,e)},t.prototype.search_string_match=function(t,e){var s;return s=e.exec(t),!this.search_contains&&(null!=s?s[1]:void 0)&&(s.index+=1),s},t.prototype.choices_count=function(){var t,e,s;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,t=0,e=(s=this.form_field.options).length;t<e;t++)s[t].selected&&(this.selected_option_count+=1);return this.selected_option_count},t.prototype.choices_click=function(t){if(t.preventDefault(),this.activate_field(),!this.results_showing&&!this.is_disabled)return this.results_show()},t.prototype.keydown_checker=function(t){var e,s;switch(s=null!=(e=t.which)?e:t.keyCode,this.search_field_scale(),8!==s&&this.pending_backstroke&&this.clear_backstroke(),s){case 8:this.backstroke_length=this.get_search_field_value().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(t),this.mouse_on_container=!1;break;case 13:case 27:this.results_showing&&t.preventDefault();break;case 32:this.disable_search&&t.preventDefault();break;case 38:t.preventDefault(),this.keyup_arrow();break;case 40:t.preventDefault(),this.keydown_arrow()}},t.prototype.keyup_checker=function(t){var e,s;switch(s=null!=(e=t.which)?e:t.keyCode,this.search_field_scale(),s){case 8:this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0?this.keydown_backstroke():this.pending_backstroke||(this.result_clear_highlight(),this.results_search());break;case 13:t.preventDefault(),this.results_showing&&this.result_select(t);break;case 27:this.results_showing&&this.results_hide();break;case 9:case 16:case 17:case 18:case 38:case 40:case 91:break;default:this.results_search()}},t.prototype.clipboard_event_checker=function(t){if(!this.is_disabled)return setTimeout(function(t){return function(){return t.results_search()}}(this),50)},t.prototype.container_width=function(){return null!=this.options.width?this.options.width:this.form_field.offsetWidth+"px"},t.prototype.include_option_in_results=function(t){return!(this.is_multiple&&!this.display_selected_options&&t.selected)&&(!(!this.display_disabled_options&&t.disabled)&&!t.empty)},t.prototype.search_results_touchstart=function(t){return this.touch_started=!0,this.search_results_mouseover(t)},t.prototype.search_results_touchmove=function(t){return this.touch_started=!1,this.search_results_mouseout(t)},t.prototype.search_results_touchend=function(t){if(this.touch_started)return this.search_results_mouseup(t)},t.prototype.outerHTML=function(t){var e;return t.outerHTML?t.outerHTML:((e=document.createElement("div")).appendChild(t),e.innerHTML)},t.prototype.get_single_html=function(){return'<a class="chosen-single chosen-default">\n  <span>'+this.default_text+'</span>\n  <div><b></b></div>\n</a>\n<div class="chosen-drop">\n  <div class="chosen-search">\n    <input class="chosen-search-input" type="text" autocomplete="off" />\n  </div>\n  <ul class="chosen-results"></ul>\n</div>'},t.prototype.get_multi_html=function(){return'<ul class="chosen-choices">\n  <li class="search-field">\n    <input class="chosen-search-input" type="text" autocomplete="off" value="'+this.default_text+'" />\n  </li>\n</ul>\n<div class="chosen-drop">\n  <ul class="chosen-results"></ul>\n</div>'},t.prototype.get_no_results_html=function(t){return'<li class="no-results">\n  '+this.results_none_found+" <span>"+this.escape_html(t)+"</span>\n</li>"},t.browser_is_supported=function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:!(/iP(od|hone)/i.test(window.navigator.userAgent)||/IEMobile/i.test(window.navigator.userAgent)||/Windows Phone/i.test(window.navigator.userAgent)||/BlackBerry/i.test(window.navigator.userAgent)||/BB10/i.test(window.navigator.userAgent)||/Android.*Mobile/i.test(window.navigator.userAgent))},t.default_multiple_text="Select Some Options",t.default_single_text="Select an Option",t.default_no_result_text="No results match",t}(),(t=jQuery).fn.extend({chosen:function(i){return e.browser_is_supported()?this.each(function(e){var n,r;r=(n=t(this)).data("chosen"),"destroy"!==i?r instanceof s||n.data("chosen",new s(this,i)):r instanceof s&&r.destroy()}):this}}),s=function(s){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,e),n.prototype.setup=function(){return this.form_field_jq=t(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex},n.prototype.set_up_html=function(){var e,s;return(e=["chosen-container"]).push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&e.push(this.form_field.className),this.is_rtl&&e.push("chosen-rtl"),s={"class":e.join(" "),title:this.form_field.title},this.form_field.id.length&&(s.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=t("<div />",s),this.container.width(this.container_width()),this.is_multiple?this.container.html(this.get_multi_html()):this.container.html(this.get_single_html()),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior()},n.prototype.on_ready=function(){return this.form_field_jq.trigger("chosen:ready",{chosen:this})},n.prototype.register_observers=function(){return this.container.on("touchstart.chosen",function(t){return function(e){t.container_mousedown(e)}}(this)),this.container.on("touchend.chosen",function(t){return function(e){t.container_mouseup(e)}}(this)),this.container.on("mousedown.chosen",function(t){return function(e){t.container_mousedown(e)}}(this)),this.container.on("mouseup.chosen",function(t){return function(e){t.container_mouseup(e)}}(this)),this.container.on("mouseenter.chosen",function(t){return function(e){t.mouse_enter(e)}}(this)),this.container.on("mouseleave.chosen",function(t){return function(e){t.mouse_leave(e)}}(this)),this.search_results.on("mouseup.chosen",function(t){return function(e){t.search_results_mouseup(e)}}(this)),this.search_results.on("mouseover.chosen",function(t){return function(e){t.search_results_mouseover(e)}}(this)),this.search_results.on("mouseout.chosen",function(t){return function(e){t.search_results_mouseout(e)}}(this)),this.search_results.on("mousewheel.chosen DOMMouseScroll.chosen",function(t){return function(e){t.search_results_mousewheel(e)}}(this)),this.search_results.on("touchstart.chosen",function(t){return function(e){t.search_results_touchstart(e)}}(this)),this.search_results.on("touchmove.chosen",function(t){return function(e){t.search_results_touchmove(e)}}(this)),this.search_results.on("touchend.chosen",function(t){return function(e){t.search_results_touchend(e)}}(this)),this.form_field_jq.on("chosen:updated.chosen",function(t){return function(e){t.results_update_field(e)}}(this)),this.form_field_jq.on("chosen:activate.chosen",function(t){return function(e){t.activate_field(e)}}(this)),this.form_field_jq.on("chosen:open.chosen",function(t){return function(e){t.container_mousedown(e)}}(this)),this.form_field_jq.on("chosen:close.chosen",function(t){return function(e){t.close_field(e)}}(this)),this.search_field.on("blur.chosen",function(t){return function(e){t.input_blur(e)}}(this)),this.search_field.on("keyup.chosen",function(t){return function(e){t.keyup_checker(e)}}(this)),this.search_field.on("keydown.chosen",function(t){return function(e){t.keydown_checker(e)}}(this)),this.search_field.on("focus.chosen",function(t){return function(e){t.input_focus(e)}}(this)),this.search_field.on("cut.chosen",function(t){return function(e){t.clipboard_event_checker(e)}}(this)),this.search_field.on("paste.chosen",function(t){return function(e){t.clipboard_event_checker(e)}}(this)),this.is_multiple?this.search_choices.on("click.chosen",function(t){return function(e){t.choices_click(e)}}(this)):this.container.on("click.chosen",function(t){t.preventDefault()})},n.prototype.destroy=function(){return t(this.container[0].ownerDocument).off("click.chosen",this.click_test_action),this.form_field_label.length>0&&this.form_field_label.off("click.chosen"),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},n.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field.disabled||this.form_field_jq.parents("fieldset").is(":disabled"),this.container.toggleClass("chosen-disabled",this.is_disabled),this.search_field[0].disabled=this.is_disabled,this.is_multiple||this.selected_item.off("focus.chosen",this.activate_field),this.is_disabled?this.close_field():this.is_multiple?void 0:this.selected_item.on("focus.chosen",this.activate_field)},n.prototype.container_mousedown=function(e){var s;if(!this.is_disabled)return!e||"mousedown"!==(s=e.type)&&"touchstart"!==s||this.results_showing||e.preventDefault(),null!=e&&t(e.target).hasClass("search-choice-close")?void 0:(this.active_field?this.is_multiple||!e||t(e.target)[0]!==this.selected_item[0]&&!t(e.target).parents("a.chosen-single").length||(e.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),t(this.container[0].ownerDocument).on("click.chosen",this.click_test_action),this.results_show()),this.activate_field())},n.prototype.container_mouseup=function(t){if("ABBR"===t.target.nodeName&&!this.is_disabled)return this.results_reset(t)},n.prototype.search_results_mousewheel=function(t){var e;if(t.originalEvent&&(e=t.originalEvent.deltaY||-t.originalEvent.wheelDelta||t.originalEvent.detail),null!=e)return t.preventDefault(),"DOMMouseScroll"===t.type&&(e*=40),this.search_results.scrollTop(e+this.search_results.scrollTop())},n.prototype.blur_test=function(t){if(!this.active_field&&this.container.hasClass("chosen-container-active"))return this.close_field()},n.prototype.close_field=function(){return t(this.container[0].ownerDocument).off("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale(),this.search_field.blur()},n.prototype.activate_field=function(){if(!this.is_disabled)return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},n.prototype.test_active_click=function(e){var s;return(s=t(e.target).closest(".chosen-container")).length&&this.container[0]===s[0]?this.active_field=!0:this.close_field()},n.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=i.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},n.prototype.result_do_highlight=function(t){var e,s,i,n,r;if(t.length){if(this.result_clear_highlight(),this.result_highlight=t,this.result_highlight.addClass("highlighted"),i=parseInt(this.search_results.css("maxHeight"),10),r=this.search_results.scrollTop(),n=i+r,s=this.result_highlight.position().top+this.search_results.scrollTop(),(e=s+this.result_highlight.outerHeight())>=n)return this.search_results.scrollTop(e-i>0?e-i:0);if(s<r)return this.search_results.scrollTop(s)}},n.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},n.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.get_search_field_value()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}))},n.prototype.update_results_content=function(t){return this.search_results.html(t)},n.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},n.prototype.set_tab_index=function(t){var e;if(this.form_field.tabIndex)return e=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=e},n.prototype.set_label_behavior=function(){if(this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=t("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0)return this.form_field_label.on("click.chosen",this.label_click_handler)},n.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},n.prototype.search_results_mouseup=function(e){var s;if((s=t(e.target).hasClass("active-result")?t(e.target):t(e.target).parents(".active-result").first()).length)return this.result_highlight=s,this.result_select(e),this.search_field.focus()},n.prototype.search_results_mouseover=function(e){var s;if(s=t(e.target).hasClass("active-result")?t(e.target):t(e.target).parents(".active-result").first())return this.result_do_highlight(s)},n.prototype.search_results_mouseout=function(e){if(t(e.target).hasClass("active-result")||t(e.target).parents(".active-result").first())return this.result_clear_highlight()},n.prototype.choice_build=function(e){var s,i;return s=t("<li />",{"class":"search-choice"}).html("<span>"+this.choice_label(e)+"</span>"),e.disabled?s.addClass("search-choice-disabled"):((i=t("<a />",{"class":"search-choice-close","data-option-array-index":e.array_index})).on("click.chosen",function(t){return function(e){return t.choice_destroy_link_click(e)}}(this)),s.append(i)),this.search_container.before(s)},n.prototype.choice_destroy_link_click=function(e){if(e.preventDefault(),e.stopPropagation(),!this.is_disabled)return this.choice_destroy(t(e.target))},n.prototype.choice_destroy=function(t){if(this.result_deselect(t[0].getAttribute("data-option-array-index")))return this.active_field?this.search_field.focus():this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.get_search_field_value().length<1&&this.results_hide(),t.parents("li").first().remove(),this.search_field_scale()},n.prototype.results_reset=function(){if(this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.trigger_form_field_change(),this.active_field)return this.results_hide()},n.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},n.prototype.result_select=function(t){var e,s;if(this.result_highlight)return e=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?e.removeClass("active-result"):this.reset_single_select_options(),e.addClass("result-selected"),s=this.results_data[e[0].getAttribute("data-option-array-index")],s.selected=!0,this.form_field.options[s.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(s):this.single_set_selected_text(this.choice_label(s)),this.is_multiple&&(!this.hide_results_on_select||t.metaKey||t.ctrlKey)?t.metaKey||t.ctrlKey?this.winnow_results({skip_highlight:!0}):(this.search_field.val(""),this.winnow_results()):(this.results_hide(),this.show_search_field_default()),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.trigger_form_field_change({selected:this.form_field.options[s.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,t.preventDefault(),this.search_field_scale())},n.prototype.single_set_selected_text=function(t){return null==t&&(t=this.default_text),t===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").html(t)},n.prototype.result_deselect=function(t){var e;return e=this.results_data[t],!this.form_field.options[e.options_index].disabled&&(e.selected=!1,this.form_field.options[e.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.trigger_form_field_change({deselected:this.form_field.options[e.options_index].value}),this.search_field_scale(),!0)},n.prototype.single_deselect_control_build=function(){if(this.allow_single_deselect)return this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")},n.prototype.get_search_field_value=function(){return this.search_field.val()},n.prototype.get_search_text=function(){return t.trim(this.get_search_field_value())},n.prototype.escape_html=function(e){return t("<div/>").text(e).html()},n.prototype.winnow_results_set_highlight=function(){var t,e;if(e=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),null!=(t=e.length?e.first():this.search_results.find(".active-result").first()))return this.result_do_highlight(t)},n.prototype.no_results=function(t){var e;return e=this.get_no_results_html(t),this.search_results.append(e),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},n.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},n.prototype.keydown_arrow=function(){var t;return this.results_showing&&this.result_highlight?(t=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(t):void 0:this.results_show()},n.prototype.keyup_arrow=function(){var t;return this.results_showing||this.is_multiple?this.result_highlight?(t=this.result_highlight.prevAll("li.active-result")).length?this.result_do_highlight(t.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight()):void 0:this.results_show()},n.prototype.keydown_backstroke=function(){var t;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(t=this.search_container.siblings("li.search-choice").last()).length&&!t.hasClass("search-choice-disabled")?(this.pending_backstroke=t,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0},n.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},n.prototype.search_field_scale=function(){var e,s,i,n,r,o,h;if(this.is_multiple){for(r={position:"absolute",left:"-1000px",top:"-1000px",display:"none",whiteSpace:"pre"},s=0,i=(o=["fontSize","fontStyle","fontWeight","fontFamily","lineHeight","textTransform","letterSpacing"]).length;s<i;s++)r[n=o[s]]=this.search_field.css(n);return(e=t("<div />").css(r)).text(this.get_search_field_value()),t("body").append(e),h=e.width()+25,e.remove(),this.container.is(":visible")&&(h=Math.min(this.container.outerWidth()-10,h)),this.search_field.width(h)}},n.prototype.trigger_form_field_change=function(t){return this.form_field_jq.trigger("input",t),this.form_field_jq.trigger("change",t)},n}()}).call(this);;

// Module: UDPMessages
/* _Prtg.UDPMessages.js */
(function PrtgUdpmessagesPlugin($, window, document, undefined) {
  var pluginName = 'prtg-udpmessages';

  function prtgUDPMessages(element, data, parent) {
    this.data = data;
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.previewMode = data.preview;

    this.$output = this.$el.find('.udpmessages-output');

    this.requestId = -1;
    this.objid = data.objid;
    this.udptype = data.udptype;
    this.probeConnected = false;
    this.tablecolumns = data.columns.split(',');
    this.responsecode = { ok: 0, done: -100, timeout: 2};

    this.startDate = new Date();
    this.startDate.addDays(-100);
    this.endDate = new Date();

    this.startDatePlugin = null;
    this.endDatePlugin = null;

    this.FilterToggle = _Prtg.Plugins['table-filter-toggle'];

    this.filterText = '';
    this.$filterDialog = this.$el.find('.udpmessages-filter-dialog');
    this.$filterTextarea = this.$filterDialog.find('.udpmessages-advanced-filter');

    this.advancedFilterEnabled = false;

    this.showFilter = true;

    this.pollTimer = null;
    this.running = false;

    this.resultPerRequest = parseInt(50, 10);
    this.page = 0;
    this.xhrRequest = {
      requestid: null,
      gettable: null,
      status: null
    };

    var _this = this;

    _Prtg.Events.subscribe('datetimpicker.initialized', function(e, plugin) {
      if (plugin.$el.hasClass('table_datepicker_dstart')) {
        plugin.setCurrentSelectedDateTime(_this.startDate, true);
        _this.startDatePlugin = plugin;
      } else if (plugin.$el.hasClass('table_datepicker_dend')) {
        plugin.setCurrentSelectedDateTime(_this.endDate, true);
        _this.endDatePlugin = plugin;
      }
    });

    $.getJSON('/api/typesstatus.json?id=' + _this.objid, function(resp) {
      _this.probeConnected = resp.probeconn;
    }).done(function() {
      if (_this.previewMode) {
        _this.initPreview();
      } else {
        _this.init();
      }
    });
  }

  prtgUDPMessages.prototype.initPreview = function() {
    var self = this;
    if (!self.probeConnected) {
      self.$output.html('<p>' + _Prtg.Lang.common.strings.udpmessageprobeconn + '</p>');
      return;
    }
    if(self.udptype == 'flow') {
      self.$output.append('<table cellspacing="0" class="messagetable table hoverable udpmessage" id="table_" style="display: table;"><tbody class="data"></tbody></table>');
    }
    self.startDate.addDays(-100);
    self.resultPerRequest = parseInt(10, 10);
    self.showFilter = false;
    self.getRequestId().done(function(response) {
      self.requestId = response;
      clearTimeout(self.pollTimer);
      if(self.udptype !== 'flow') {
        self.pollTimer = setTimeout($.proxy(self.getTableData, self), 1000);
      } else {
        self.pollTimer = setTimeout($.proxy(self.getFlowData, self), 1000);
      }
    });

    self.$el.on('click.udpmessag', function() {
      _Prtg.Plugins['prtg-tabs'].plugin.activateTab(20, true);
    });
  };

  prtgUDPMessages.prototype.init = function() {
    var self = this;
    if (!self.probeConnected) {
      self.$output.html('<p>' + _Prtg.Lang.common.strings.udpmessageprobeconn + '</p>');
      return;
    }

    self.$output.find('.messagetable').show();
    _Prtg.Events.subscribe('datetimpicker.change', function(e, plugin) {
      self.startDate = self.startDatePlugin.getCurrentSelectedDate();
      self.endDate = self.endDatePlugin.getCurrentSelectedDate();
      self.applyFilterEvent();
    });
    if(self.udptype == 'flow') {
      self.$output.append('<table cellspacing="0" class="messagetable table hoverable udpmessage" id="table_" style="display: table;"><tbody class="data"></tbody></table>');
    }
    self.showFilter = false;
    self.initEvents();
    self.updatePagingView();
    self.applyFilter();

    self.$el.find('tr.filters input').tagsinput({
      autocomplete: false,
      newtagkeycode: [13],
      pastesplitregex: null
    });

    var example = self.$filterDialog.find('table tr').eq(0).find('th').eq(2).text();
    self.$filterDialog.find('table tr:gt(0)').each(function() {
      var $this = $(this);
      var name = $(this).find('td').eq(0).text().split('[')[0];
      var $filter = $('tr.filters td[filtertype="' + name + '"]');
      var $tds = $this.find('td');

      if ($filter.length) {
        $filter.attr('data-original-title', '<div>' + $tds.eq(1).html() + '</div>' +
        '<div><b>' + example + '</b>:<br>' + $tds.eq(2).html().replace(new RegExp(name + '\\[','gi'), '').replace(/(\] ,)|(\])/gi, '<br>')
        );
      }
    });

    $('tr.filters td:last-child').attr('data-placement', 'left');
  };

  prtgUDPMessages.prototype.initEvents = function() {
    var self = this;
    self.$el.on('destroyed', {self: self}, self.destroy);

    this.$el.on('click.udpmessage', '.table_itemcount_selector a', {self: self}, self.resultPerRequestChangeEvent);
    this.$el.on('click.udpmessage', '.table_daterange_selector li', {self: self}, self.dateRangeChangeEvent);
    this.$el.on('click.udpmessage', '.reloadtablelink.arrow', {self: self}, self.pagingEvent);
    this.$el.on('change.udpmessage', 'input.udpmessages-filterfield', function() {
      self.applyFilterEvent();
    });

    this.$el.on('click.udpmessage', '.udpmessages-morefilter, .advancedfilterinputcolumn', {self: self}, self.showFilterDialog);
    this.$el.on('click.udpmessage', '.advancedfilterinputcolumn i', function(event) {
      event.stopPropagation();
      self.advancedFilterEnabled = false;
      self.hideAdvancedFilterBar();
      self.applyFilter();
    });

    this.$el.on('change.udpmessages', 'select.udpmessages-filterfield', {self: self}, self.applyFilterEvent);

    this.FilterToggle.init(this.el);

    this.$el.on('click.udpmessages', 'table tr:not(.filters) td', {self: self}, function() {
      var sel = getSelection().toString();
      if (sel !== '') return;
      var $this = $(this);
      var me = this;
      var index = '';
      var value = '';
      $this.parent('tr').find('td').each(function(i, elm) {
        if (elm === me) {
          index = i;
          value = $(elm).text();
          return false;
        }
      });

      var $filterTd = self.$el.find('tr.filters').find('td').eq(index);
      if ($filterTd.find('.taglist').length > 0) {
        var $td = self.$el.find('tr.filters').find('td').eq(index);
        $td.find('.taglist li span').each(function(i, elm) {
          if ($(elm).text() === value) value = '';
        });

        if (value !== '') $td.find('input').data('Tagsinput').addTag(value);
      } else if ($filterTd.find('select').length > 0) {
        if ($filterTd.find('select').val() !== value) $filterTd.find('select').val(value).trigger('change');
      }
    });
  };

  prtgUDPMessages.prototype.killXhr = function() {
    var self = this;
    for (var request in self.xhrRequest) {
      if (self.xhrRequest.hasOwnProperty(request)) {
        if (self.xhrRequest[request] !== null) {
          self.xhrRequest[request].abort();
        }
      }
    }
  };

  prtgUDPMessages.prototype.start = function() {
    var self = this;
    self.running = true;
    this.getRequestId().done(function(response) {
      self.requestId = response;
      clearTimeout(self.pollTimer);
      if(self.udptype !== 'flow') {
        self.pollTimer = setTimeout($.proxy(self.getTableData, self), 1000);
      } else {
        self.pollTimer = setTimeout($.proxy(self.getFlowData, self), 1000);
      }
    });
  };

  prtgUDPMessages.prototype.applyFilter = function() {
    var self = this;
    self.killXhr();
    self.running = true;
    self.filterText = self.collectFilter();
    if (self.advancedFilterEnabled) {
      if (self.filterText !== '') {
        self.showAdvancedFilterBar();
      } else {
        self.hideAdvancedFilterBar();
        self.advancedFilterEnabled = false;
        self.filterText = self.collectFilter();
      }
    }

    self.$el.find('.loading_indicator').show();
    self.$el.find('.percent_loading').show();
    self.$output.find('table tbody:last').html('');
    this.getRequestId().done(function(response) {
      self.requestId = response;
      clearTimeout(self.pollTimer);
      if(self.udptype !== 'flow') {
        self.pollTimer = setTimeout($.proxy(self.getTableData, self), 1000);
      } else {
        if(self.$el.find('tr.filters').length > 0) {
          self.pollTimer = setTimeout($.proxy(self.getFlowData, self), 1000);
        } else {
          self.pollTimer = setTimeout($.proxy(self.getFlowData, self, true), 1000);
        }

      }
    });
  };

  prtgUDPMessages.prototype.getTableData = function() {
    var self = this;
    self.getStatus().done(function(statusResponse) {
      var status = $.parseJSON(statusResponse);
      if (status.code === self.responsecode.ok ) {
        self.$el.find('.percent_loading').html(status.progress + '%');
        self.getTable().done(function(response) {
          if (self.$output.find('table').length) {
            var $data = $($.parseHTML(response));
            self.$output.find('table tbody:last').append($data.find('tbody > tr'));
          } else {
            self.$output.html(response);
          }

          self.pollTimer = setTimeout($.proxy(self.getTableData, self), 1000);
        });
      } else {
        self.$el.find('.loading_indicator').hide();
        self.$el.find('.percent_loading').hide();
        self.running = false;

        if (status.code === self.responsecode.timeout){
          _Prtg.Dialogs.alert($('<div>'+_Prtg.Lang.Dialogs.strings.timeoutDescription+'</div>'),_Prtg.Lang.Dialogs.strings.timeoutTitle, {});
        }
      }
    });
  };

  prtgUDPMessages.prototype.getFlowData = function(getHeads) {
    var self = this;
    var table = '<form id="form_"><table cellspacing="0" class="messagetable table hoverable udpmessage" id="table_" style="display: table;">';
    self.getStatus().done(function(statusResponse) {
      var status = $.parseJSON(statusResponse);
      if (status.code === self.responsecode.ok) {
        self.$el.find('.percent_loading').html(status.progress + '%');
        $.ajax({
          url: 'api/flowmessagelist.json',
          data: {
            'requestid': self.requestId,
            'header': 'true'
          },
          dataType: 'json'
        }).done(function(response) {
          var table_obj = $('table');
          if(self.previewMode) {
            response.preview = true;
            response.previewconf = {
              columns: 6,
              rows: 10
            };
          } else {
            response.preview = false;
          }
          if(getHeads) {
            table = $.jqote(_Prtg.Core.objects.flowlist.header.template, response);
          }
          table = table + $.jqote(_Prtg.Core.objects.flowlist.data.template, response);
          if(getHeads) {
            self.$output.find('.messagetable tbody.data').append(table);
          } else {
            table = $($.parseHTML(table));
            if(self.previewMode) {
              self.$output.html(table);
            } else {
              self.$output.find('table tbody:last').append(table.find('tbody > tr'));
            }
          }
          if(getHeads) {
            self.$el.find("tr.filters input").tagsinput({
              autocomplete: false,
              "newtagkeycode": [13],
              "pastesplitregex": null
            });
          }

          if(getHeads) _Prtg.initPlugins(self.$el);
          self.pollTimer = setTimeout($.proxy(self.getFlowData, self, false), 1000);
        });
      }
      else {
        self.$el.find('.loading_indicator').hide();
        self.$el.find('.percent_loading').hide();
        self.running = false;

        if (status.code === self.responsecode.timeout){
          _Prtg.Dialogs.alert($('<div>'+_Prtg.Lang.Dialogs.strings.timeoutDescription+'</div>'),_Prtg.Lang.Dialogs.strings.timeoutTitle, {});
        }
      }
    });
  };

  // Event functions

  prtgUDPMessages.prototype.applyFilterEvent = function(event) {
    var self = (event !== undefined && event.data !== undefined ? event.data.self : this);
    self.page = 0;
    self.updatePagingView();
    self.applyFilter();
  };

  prtgUDPMessages.prototype.resultPerRequestChangeEvent = function(event) {
    var self = (event !== undefined && event.data !== undefined ? event.data.self : this);
    var $this = $(this);
    self.$el.find('.table_itemcount_selector .selected').removeClass('selected');
    $this.addClass('selected');
    var reloadData = $.parseJSON($this.attr('data-reload'));
    for (var i = reloadData.length - 1; i >= 0; i--) {
      if (reloadData[i].name === 'count') {
        self.resultPerRequest = parseInt(reloadData[i].value, 10);
        self.$el.find('.table_fromcount').html((self.page) * self.resultPerRequest);
        self.applyFilter();
      }
    }

    self.updatePagingView();
  };

  prtgUDPMessages.prototype.pagingEvent = function(event) {
    var self = (event !== undefined && event.data !== undefined ? event.data.self : this);
    var $this = $(this);
    event.preventDefault();
    if ($this.hasClass('a_right_on')) {
      self.page = self.page + 1;
    } else if ($this.hasClass('a_first_on')) {
      self.page = 0;
    } else if ($this.hasClass('a_left_on')) {
      self.page = self.page - 1;
    }

    self.updatePagingView();
    self.applyFilter();
  };

  prtgUDPMessages.prototype.dateRangeChangeEvent = function(event) {
    var self = (event !== undefined && event.data !== undefined ? event.data.self : this);
    var $this = $(this).find('a');
    var reloadData = $.parseJSON($this.attr('data-reload'));
    for (var i = reloadData.length - 1; i >= 0; i--) {
      if (reloadData[i].name === 'filter_drel') {
        self.startDate = new Date();
        self.startDate.setHours(0, 0, 0, 0);
        self.endDate = new Date();
        self.endDate.setHours(24, 0, 0, 0);
        switch (reloadData[i].value) {
        case 'today':
          break;
        case 'yesterday':
          self.startDate.addDays(-1);
          self.endDate.addDays(-1);
          break;
        case '7days':
          self.startDate.addDays(-7);
          break;
        case '30days':
          self.startDate.addDays(-30);
          break;
        case '6months':
          self.startDate.addMonth(-6);
          break;
        case '12months':
          self.startDate.addMonth(-12);
          break;
        case 'eternity':
          self.startDate.addMonth(-48);
          break;
        default:
          break;
        }
        self.page = 0;
        self.updatePagingView();
        self.startDatePlugin.setCurrentSelectedDateTime(self.startDate, true);
        self.endDatePlugin.setCurrentSelectedDateTime(self.endDate, true);
        self.applyFilter();
      }
    }
  };

  prtgUDPMessages.prototype.showFilterDialog = function(event) {
    var self = (event !== undefined && event.data !== undefined ? event.data.self : this);

    self.$filterTextarea.val(self.filterText);
    var dialog = self.$filterDialog.dialog({
    	closeText: "",
      title: 'Advanced Filter',
      closeOnEscape: true,
      draggable: false,
      resizable: false,
      modal: true,
      width: '710px',
      buttons: [{
        html: _Prtg.Lang.Dialogs.strings.ok, // TODO
        class: 'actionbutton',
        click: function() {
          self.advancedFilterEnabled = true;
          self.applyFilter();
          dialog.dialog('close');
          return false;
        }
      }, {
        html: _Prtg.Lang.Dialogs.strings.cancel,
        class: 'button btngrey',
        click: function() {
          dialog.dialog('close');
          return false;
        }
      }],
      close: function() {
        dialog.dialog('destroy');
      }
    });
  };

  prtgUDPMessages.prototype.showAdvancedFilterBar = function(event) {
    var self = (event !== undefined && event.data !== undefined ? event.data.self : this);
    self.$output.find('tr.filters').hide();
    self.$output.find('.udpfilterheader').hide();
    self.$output.find('.advancedfilterinputcolumn').html(self.filterText + '<i class="icon-dark float-right icon-close icon-hovertored"></i>');
    self.$output.find('.udpadvancedfilterheader').show();
    self.$output.find('.advancedfilterinputrow').show();
  };

  prtgUDPMessages.prototype.hideAdvancedFilterBar = function(event) {
    var self = (event !== undefined && event.data !== undefined ? event.data.self : this);
    if (event !== undefined) event.stopPropagation();
    self.$output.find('tr.filters').show();
    self.$output.find('.udpfilterheader').show();
    self.$output.find('.udpadvancedfilterheader').hide();
    self.$output.find('.advancedfilterinputrow').hide();
  };

  // Helper functions
  prtgUDPMessages.prototype.updatePagingView = function() {
    var self = this;
    if (self.page === 0) {
      self.$el.find('.reloadtablelink.arrow.a_left_on').removeClass('a_left_on').addClass('a_left_off').removeClass('.disabled');
      self.$el.find('.reloadtablelink.arrow.a_first_on').removeClass('a_first_on').addClass('a_first_off').removeClass('.disabled');
    } else if (self.page > 0) {
      self.$el.find('.reloadtablelink.arrow.a_left_off').removeClass('a_left_off').addClass('a_left_on').addClass('.disabled');
      self.$el.find('.reloadtablelink.arrow.a_first_off').removeClass('a_first_off').addClass('a_first_on').addClass('.disabled');
    }

    self.$el.find('.table_fromcount').html(self.page * self.resultPerRequest);
    self.$el.find('.table_tocount').html((self.page * self.resultPerRequest) + self.resultPerRequest);
  };

  prtgUDPMessages.prototype.collectFilter = function() {
    var self = this;
    var filter = '';
    var filterCount = 0;
    var filterVal;
    var filterBlock;

    if (self.advancedFilterEnabled) return self.$filterTextarea.val().trim();

    self.$el.find('.udpmessages-filterfield').each(function(index, elm) {
      var $this = $(this);
			if(($this.val() === '-1') || ($this.val().trim() === '')) return;
      if (index > 0 && filterCount > 0) filter = filter + ' AND ';
      filterVal = $.trim($this.val()).split(' ');
      filterBlock = '';
      for (var i = 0; i < filterVal.length; i++) {
        if (filterVal[i] === ' ') continue;
        if (i > 0) filterBlock = filterBlock + ' OR ';
        filterBlock = filterBlock + elm.getAttribute('filtername') + '[' + filterVal[i] + ']';
      }

      if (filterBlock !== '') filter = filter + ' (' + filterBlock + ') ';
      filterCount = filterCount + 1;
    });

    return filter;
  };

  // API Call functions

  prtgUDPMessages.prototype.getStatus = function() {
    var self = this;
    self.xhrRequest.status = $.ajax({
      url: 'api/udpmessageliststatus.json',
      data: {
        type: self.udptype,
        requestid: self.requestId
      }
    });
    return self.xhrRequest.status;
  };

  prtgUDPMessages.prototype.getRequestId = function() {
    var self = this;
    self.xhrRequest.requestid = $.ajax({
      url: 'api/requestudpmessagelist.htm',
      data: {
        type: self.udptype,
        id: self.objid,
        sdate: self.startDate.toPrtgString(),
        edate: self.endDate.toPrtgString(),
        filter: self.filterText,
        count: self.resultPerRequest,
        start: self.page * self.resultPerRequest
      }
    });
    return self.xhrRequest.requestid;
  };

  prtgUDPMessages.prototype.getTable = function() {
    var self = this;
    self.xhrRequest.gettable = $.ajax({
      url: 'api/table.json',
      data: {
        output: 'html',
        udptype: self.udptype,
        udpmsgid: self.requestId,
        content: 'udpmessage',
        infoheader:'true',
        columns: self.tablecolumns.join(','),
        count: self.resultPerRequest,
        start: '0',
        showfilter: self.showFilter,
        hideemptycol: 'true'
      }
    });
    return self.xhrRequest.gettable;
  };

  prtgUDPMessages.prototype.destroy = function(event) {
    var self = event.data.self;
    clearTimeout(self.pollTimer);
    self.killXhr();
    $(window).off('.udpmessages');
    $(document).off('.udpmessages');
    self.$el.off('.udpmessages');

    _Prtg.Events.unsubscribe('datetimpicker.change');
    _Prtg.Events.unsubscribe('datetimpicker.initialized');
  };
  _Prtg.Plugins.registerPlugin(pluginName, prtgUDPMessages);
})(jQuery, window, document);


// Module: Sysinfo
/* _Prtg.Sysinfo.js */

(function SysinfoIffe($, window, document, undefined) {
  var pluginName = 'prtg-sysinfo';

  function prtgSysinfo(element, init_data, parent) {

    // DOM depending
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.timer = $(parent).Events();
    this.prtgTable = this.$el.find('.prtg-table');
    this.$error = this.$el.find('error');

    // data depending
    this.data = init_data;
    this.kind = init_data.kind;
    this.data_structure = {kind:null,receivetime:null,userreceivetime:null,timeago:null,error:null,message:null};

    if ('sysinfoinit' in init_data && init_data.kind in init_data.sysinfoinit) var sysinfoinit = init_data.sysinfoinit[init_data.kind];
    else var sysinfoinit = this.data_structure;

    for (var key in this.data_structure)
      this.data[key] = (key in sysinfoinit) ? sysinfoinit[key] : null;

    // syinfo logic
    this.checkAlways = !!~['services', 'loggedonusers', 'processes'].indexOf(this.data.kind);
    this.userHasRights = !!~['Full', 'Write'].indexOf(this.data.accessright);

    this.xhrRequest = null;
    this.timeout = null;

    this.checkRunning = false;
    this.runningTime = 0;

    this.REFRESH_RATE = 2000;
    this.REFRESH_TIMEOUT = 180000;

    this.init();
  }

  prtgSysinfo.prototype.init = function init() {

    // Refresh all Sysinfo squares on tab-click if they had any "error"
    if (!this.$el.find('error').hasClass('hidden') || this.checkAlways) this.refresh.call(this, true);

    this.initEvents();
  };

  prtgSysinfo.prototype.initEvents = function initEvents() {

    // Bind refresh on global 30sec refresh
    _Prtg.Events.subscribe('refresh.events.prtg', this.refresh.bind(this, false, false));

    if (this.userHasRights) {
      // Bind refresh function to all not disabled refresh buttons of each square
      this.$el.on('click.checknow', 'a.checknow:not(.no_probe)', this.refresh.bind(this, true, true));
      this.$el.find('a.checknow.no_probe').attr('title', $('#hidden_no_probe_text').html());
    }else {
      this.$el.find('a.checknow').hide();
    }

    // Destructor
    this.$el.on('destroyed', { self: this }, this.destroy);
  };

  prtgSysinfo.prototype.refresh = function refresh(scanNow, autoUpdate) {
    var _this = this;

    // if(_this.checkRunning) console.log(_this.data.kind,"blocked - already running");
    // if(scanNow) console.log(_this.data.kind, 'scanNow');

    if (_this.checkRunning) return;
    _this.checkRunning = true;

    _this.hideRefreshLink();
    _this.showLoadingOverlay();

    var getUpdate = function() {
      _this.getUpdate(function(data, isNew) {
        if (isNew) {
          if (data.error * 1) {
            _this.updateErrorMessage(data.message);
            _this.$error.removeClass('hidden');
            _this.prtgTable.addClass('hidden');
          } else {
            _this.refreshTable();
            _this.$error.addClass('hidden');
            _this.prtgTable.removeClass('hidden');
          }
        }

        _this.cleanupRefresh();

      }, scanNow && _this.userHasRights, null, autoUpdate);
    };

    if (scanNow && _this.userHasRights) _this.scanNow(getUpdate);
    else getUpdate();

    return false;
  };

  prtgSysinfo.prototype.getUpdate = function getUpdate(callback, doUntilNew, selfCall, autoUpdate) {

    var _this = this;

    if (_this.runningTime >= _this.REFRESH_TIMEOUT) {
      // console.log(_this.data.kind,"timeout");
      _this.cleanupRefresh();
      return;
    }

    // console.log(_this.data.kind,"getUpdate")
    if (selfCall) _this.runningTime += _this.REFRESH_RATE;

    $.getJSON('api/sysinfo.json', { id: _this.data.objid, kind: _this.kind }, function(r) {
      var resp = null,
          sameDate = true;

      // Head
      if (!$.isEmptyObject(r) && Object.keys(resp = r[_this.kind]).join() == Object.keys(_this.data_structure).join()) {
        if ('timeago' in resp) _this.updateReceiveTimeInHeader(resp.timeago);
        if ('receivetime' in resp) sameDate = (_this.data.receivetime == resp.receivetime);
      }

      // console.log(_this.data.receivetime+" == "+resp.receivetime,_this.data.receivetime == resp.receivetime)
      // console.log(_this.kind,sameDate?'old data':'new data',doUntilNew);

      // Old state, refresh
      if (resp == null || (doUntilNew && sameDate)) {
        if (!autoUpdate) {
          _this.cleanupRefresh();
          return;
        }
        _this.timeout = setTimeout(function() {_this.getUpdate(callback, doUntilNew, true, true);}, _this.REFRESH_RATE);
        return;
      }

      // console.log(_this.data.kind,"callback")

      // New state, callback
      _this.data.receivetime = resp.receivetime;
      _this.cleanupRefresh();
      callback(resp, !sameDate);
    });

  }

  prtgSysinfo.prototype.cleanupRefresh = function cleanupRefresh() {
    this.runningTime = 0;
    this.checkRunning = false;
    this.showRefreshLink();
    this.hideLoadingOverlay();
  }

  prtgSysinfo.prototype.scanNow = function scanNow(callback) {
    var _this = this;
    $.get('api/sysinfochecknow.json', { id: _this.data.objid, kind: _this.kind }, callback);
  };

  prtgSysinfo.prototype.hideRefreshLink = function hideRefreshLink(link) {
    this.$el.find('.checknow').addClass('invisible');
  };

  prtgSysinfo.prototype.showRefreshLink = function showRefreshLink(link) {
    this.$el.find('.checknow').removeClass('invisible');
  };

  prtgSysinfo.prototype.showLoadingOverlay = function toggleLoadingOverlay() {
    this.$el.find('.loading-indicator').removeClass('invisible');
  };

  prtgSysinfo.prototype.hideLoadingOverlay = function toggleLoadingOverlay() {
    this.$el.find('.loading-indicator').addClass('invisible');
  };

  prtgSysinfo.prototype.updateErrorMessage = function updateErrorMessage(message) {
    this.$el.find('message').html(message != 'OK' ? '<ul><li>Error: ' + message.split('<br>').join('</li><li>Error: ') + '</li></ul>' : message);
  };

  prtgSysinfo.prototype.refreshTable = function refreshTable() {
    var $object = this.prtgTable.data('prtg-table');
    $object.refresh({ data: $object }, true);
  };

  prtgSysinfo.prototype.updateReceiveTimeInHeader = function updateReceiveTimeInHeader(time) {
    this.$el.find('small').html(time);
  };

  prtgSysinfo.prototype.killXhr = function killXhr() {
    if (this.xhrRequest !== null) {
      this.xhrRequest = this.xhrRequest.abort();
    }
  };

  prtgSysinfo.prototype.clearTimeout = function clearTimeout() {
    if (this.timeout !== null) {
      this.timeout = window.clearTimeout(this.timeout);
    }
  };

  prtgSysinfo.prototype.destroy = function destroy(event) {
    var _this = event.data.self;
    _this.killXhr();
    _this.clearTimeout();
    _this.timer.unsubscribe('refresh.events.prtg', _this.refresh.bind(this));
  };

  _Prtg.Plugins.registerPlugin(pluginName, prtgSysinfo);
})(jQuery, window, document);


/***
 * Contains core SlickGrid classes.
 * @module Core
 * @namespace Slick
 */

(function($) {
    // register namespace
    $.extend(true, window, {
        "Slick": {
            "Event":        Event,
            "EventData":    EventData,
            "Range":        Range,
            "NonDataRow":   NonDataItem,
            "Group":        Group,
            "GroupTotals":  GroupTotals,
            "EditorLock":   EditorLock,

            /***
             * A global singleton editor lock.
             * @class GlobalEditorLock
             * @static
             * @constructor
             */
            "GlobalEditorLock": new EditorLock()
        }
    });

    /***
     * An event object for passing data to event handlers and letting them control propagation.
     * <p>This is pretty much identical to how W3C and jQuery implement events.</p>
     * @class EventData
     * @constructor
     */
    function EventData() {
        var isPropagationStopped = false;
        var isImmediatePropagationStopped = false;

        /***
         * Stops event from propagating up the DOM tree.
         * @method stopPropagation
         */
        this.stopPropagation = function() {
            isPropagationStopped = true;
        };

        /***
         * Returns whether stopPropagation was called on this event object.
         * @method isPropagationStopped
         * @return {Boolean}
         */
        this.isPropagationStopped = function() {
            return isPropagationStopped;
        };

        /***
         * Prevents the rest of the handlers from being executed.
         * @method stopImmediatePropagation
         */
        this.stopImmediatePropagation = function() {
            isImmediatePropagationStopped = true;
        };

        /***
         * Returns whether stopImmediatePropagation was called on this event object.\
         * @method isImmediatePropagationStopped
         * @return {Boolean}
         */
        this.isImmediatePropagationStopped = function() {
            return isImmediatePropagationStopped;
        }
    }

    /***
     * A simple publisher-subscriber implementation.
     * @class Event
     * @constructor
     */
    function Event() {
        var handlers = [];

        /***
         * Adds an event handler to be called when the event is fired.
         * <p>Event handler will receive two arguments - an <code>EventData</code> and the <code>data</code>
         * object the event was fired with.<p>
         * @method subscribe
         * @param fn {Function} Event handler.
         */
        this.subscribe = function(fn) {
            handlers.push(fn);
        };

        /***
         * Removes an event handler added with <code>subscribe(fn)</code>.
         * @method unsubscribe
         * @param fn {Function} Event handler to be removed.
         */
        this.unsubscribe = function(fn) {
            for (var i = handlers.length - 1; i >= 0; i--) {
                if (handlers[i] === fn) {
                    handlers.splice(i, 1);
                }
            }
        };

        /***
         * Fires an event notifying all subscribers.
         * @method notify
         * @param args {Object} Additional data object to be passed to all handlers.
         * @param e {EventData}
         *      Optional.
         *      An <code>EventData</code> object to be passed to all handlers.
         *      For DOM events, an existing W3C/jQuery event object can be passed in.
         * @param scope {Object}
         *      Optional.
         *      The scope ("this") within which the handler will be executed.
         *      If not specified, the scope will be set to the <code>Event</code> instance.
         */
        this.notify = function(args, e, scope) {
            e = e || new EventData();
            scope = scope || this;

            var returnValue;
            for (var i = 0; i < handlers.length && !(e.isPropagationStopped() || e.isImmediatePropagationStopped()); i++) {
                returnValue = handlers[i].call(scope, e, args);
            }

            return returnValue;
        };
    }

    /***
     * A structure containing a range of cells.
     * @class Range
     * @constructor
     * @param fromRow {Integer} Starting row.
     * @param fromCell {Integer} Starting cell.
     * @param toRow {Integer} Optional. Ending row. Defaults to <code>fromRow</code>.
     * @param toCell {Integer} Optional. Ending cell. Defaults to <code>fromCell</code>.
     */
    function Range(fromRow, fromCell, toRow, toCell) {
        if (toRow === undefined && toCell === undefined) {
            toRow = fromRow;
            toCell = fromCell;
        }

        /***
         * @property fromRow
         * @type {Integer}
         */
        this.fromRow = Math.min(fromRow, toRow);

        /***
         * @property fromCell
         * @type {Integer}
         */
        this.fromCell = Math.min(fromCell, toCell);

        /***
         * @property toRow
         * @type {Integer}
         */
        this.toRow = Math.max(fromRow, toRow);

        /***
         * @property toCell
         * @type {Integer}
         */
        this.toCell = Math.max(fromCell, toCell);

        /***
         * Returns whether a range represents a single row.
         * @method isSingleRow
         * @return {Boolean}
         */
        this.isSingleRow = function() {
            return this.fromRow == this.toRow;
        };

        /***
         * Returns whether a range represents a single cell.
         * @method isSingleCell
         * @return {Boolean}
         */
        this.isSingleCell = function() {
            return this.fromRow == this.toRow && this.fromCell == this.toCell;
        };

        /***
         * Returns whether a range contains a given cell.
         * @method contains
         * @param row {Integer}
         * @param cell {Integer}
         * @return {Boolean}
         */
        this.contains = function(row, cell) {
            return row >= this.fromRow && row <= this.toRow &&
                   cell >= this.fromCell && cell <= this.toCell;
        };

        /***
         * Returns a readable representation of a range.
         * @method toString
         * @return {String}
         */
        this.toString = function() {
            if (this.isSingleCell()) {
                return "(" + this.fromRow + ":" + this.fromCell + ")";
            }
            else {
                return "(" + this.fromRow + ":" + this.fromCell + " - " + this.toRow + ":" + this.toCell + ")";
            }
        }
    }


    /***
     * A base class that all special / non-data rows (like Group and GroupTotals) derive from.
     * @class NonDataItem
     * @constructor
     */
    function NonDataItem() {
        this.__nonDataRow = true;
    }


    /***
     * Information about a group of rows.
     * @class Group
     * @extends Slick.NonDataItem
     * @constructor
     */
    function Group() {
        this.__group = true;
        this.__updated = false;

        /***
         * Number of rows in the group.
         * @property count
         * @type {Integer}
         */
        this.count = 0;

        /***
         * Grouping value.
         * @property value
         * @type {Object}
         */
        this.value = null;

        /***
         * Formatted display value of the group.
         * @property title
         * @type {String}
         */
        this.title = null;

        /***
         * Whether a group is collapsed.
         * @property collapsed
         * @type {Boolean}
         */
        this.collapsed = false;

        /***
         * GroupTotals, if any.
         * @property totals
         * @type {GroupTotals}
         */
        this.totals = null;
    }

    Group.prototype = new NonDataItem();

    /***
     * Compares two Group instances.
     * @method equals
     * @return {Boolean}
     * @param group {Group} Group instance to compare to.
     */
    Group.prototype.equals = function(group) {
        return this.value === group.value &&
               this.count === group.count &&
               this.collapsed === group.collapsed;
    };

    /***
     * Information about group totals.
     * An instance of GroupTotals will be created for each totals row and passed to the aggregators
     * so that they can store arbitrary data in it.  That data can later be accessed by group totals
     * formatters during the display.
     * @class GroupTotals
     * @extends Slick.NonDataItem
     * @constructor
     */
    function GroupTotals() {
        this.__groupTotals = true;

        /***
         * Parent Group.
         * @param group
         * @type {Group}
         */
        this.group = null;
    }

    GroupTotals.prototype = new NonDataItem();

    /***
     * A locking helper to track the active edit controller and ensure that only a single controller
     * can be active at a time.  This prevents a whole class of state and validation synchronization
     * issues.  An edit controller (such as SlickGrid) can query if an active edit is in progress
     * and attempt a commit or cancel before proceeding.
     * @class EditorLock
     * @constructor
     */
    function EditorLock() {
        var activeEditController = null;

        /***
         * Returns true if a specified edit controller is active (has the edit lock).
         * If the parameter is not specified, returns true if any edit controller is active.
         * @method isActive
         * @param editController {EditController}
         * @return {Boolean}
         */
        this.isActive = function(editController) {
            return (editController ? activeEditController === editController : activeEditController !== null);
        };

        /***
         * Sets the specified edit controller as the active edit controller (acquire edit lock).
         * If another edit controller is already active, and exception will be thrown.
         * @method activate
         * @param editController {EditController} edit controller acquiring the lock
         */
        this.activate = function(editController) {
            if (editController === activeEditController) { // already activated?
                return;
            }
            if (activeEditController !== null) {
                throw "SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";
            }
            if (!editController.commitCurrentEdit) {
                throw "SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";
            }
            if (!editController.cancelCurrentEdit) {
                throw "SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";
            }
            activeEditController = editController;
        };

        /***
         * Unsets the specified edit controller as the active edit controller (release edit lock).
         * If the specified edit controller is not the active one, an exception will be thrown.
         * @method deactivate
         * @param editController {EditController} edit controller releasing the lock
         */
        this.deactivate = function(editController) {
            if (activeEditController !== editController) {
                throw "SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";
            }
            activeEditController = null;
        };

        /***
         * Attempts to commit the current edit by calling "commitCurrentEdit" method on the active edit
         * controller and returns whether the commit attempt was successful (commit may fail due to validation
         * errors, etc.).  Edit controller's "commitCurrentEdit" must return true if the commit has succeeded
         * and false otherwise.  If no edit controller is active, returns true.
         * @method commitCurrentEdit
         * @return {Boolean}
         */
        this.commitCurrentEdit = function() {
            return (activeEditController ? activeEditController.commitCurrentEdit() : true);
        };

        /***
         * Attempts to cancel the current edit by calling "cancelCurrentEdit" method on the active edit
         * controller and returns whether the edit was successfully cancelled.  If no edit controller is
         * active, returns true.
         * @method cancelCurrentEdit
         * @return {Boolean}
         */
        this.cancelCurrentEdit = function cancelCurrentEdit() {
            return (activeEditController ? activeEditController.cancelCurrentEdit() : true);
        };
    }
})(jQuery);



(function($) {
    // register namespace
    $.extend(true, window, {
        "Slick": {
            "RowSelectionModel":    RowSelectionModel
        }
    });

    function RowSelectionModel(options) {
        var _grid;
        var _ranges = [];
        var _self = this;
        var _options;
        var _defaults = {
            selectActiveRow: true
        };

        function init(grid) {
            _options = $.extend(true, {}, _defaults, options);
            _grid = grid;
            _grid.onActiveCellChanged.subscribe(handleActiveCellChange);
            _grid.onKeyDown.subscribe(handleKeyDown);
            _grid.onClick.subscribe(handleClick);
        }

        function destroy() {
            _grid.onActiveCellChanged.unsubscribe(handleActiveCellChange);
            _grid.onKeyDown.unsubscribe(handleKeyDown);
            _grid.onClick.unsubscribe(handleClick);
        }

        function rangesToRows(ranges) {
            var rows = [];
            for (var i = 0; i < ranges.length; i++) {
                for (var j = ranges[i].fromRow; j <= ranges[i].toRow; j++) {
                    rows.push(j);
                }
            }
            return rows;
        }

        function rowsToRanges(rows) {
            var ranges = [];
            var lastCell = _grid.getColumns().length - 1;
            for (var i = 0; i < rows.length; i++) {
                ranges.push(new Slick.Range(rows[i], 0, rows[i], lastCell));
            }
            return ranges;
        }

        function getRowsRange(from,to) {
            var i, rows = [];
            for (i = from; i <= to; i++) {
                rows.push(i);
            }
            for (i = to; i < from; i++) {
                rows.push(i);
            }
            return rows;
        }

        function getSelectedRows() {
            return rangesToRows(_ranges);
        }

        function setSelectedRows(rows) {
            setSelectedRanges(rowsToRanges(rows));
        }

        function setSelectedRanges(ranges) {
            _ranges = ranges;
            _self.onSelectedRangesChanged.notify(_ranges);
        }

        function getSelectedRanges() {
            return _ranges;
        }

        function handleActiveCellChange(e, data) {
            if (_options.selectActiveRow) {
                setSelectedRanges([new Slick.Range(data.row, 0, data.row, _grid.getColumns().length - 1)]);
            }
        }

        function handleKeyDown(e) {
            var activeRow = _grid.getActiveCell();
            if (activeRow && e.shiftKey && !e.ctrlKey && !e.altKey && !e.metaKey && (e.which == 38 || e.which == 40)) {
                var selectedRows = getSelectedRows();
                selectedRows.sort(function(x,y) { return x-y });

                if (!selectedRows.length) {
                    selectedRows = [activeRow.row];
                }

                var top = selectedRows[0];
                var bottom = selectedRows[selectedRows.length - 1];
                var active;

                if (e.which == 40) {
                    active = activeRow.row < bottom || top == bottom ? ++bottom : ++top;
                }
                else {
                    active = activeRow.row < bottom ? --bottom : --top;
                }

                if (active >= 0 && active < _grid.getDataLength()) {
                    _grid.scrollRowIntoView(active);
                    _ranges = rowsToRanges(getRowsRange(top,bottom));
                    setSelectedRanges(_ranges);
                }

                e.preventDefault();
                e.stopPropagation();
            }
        }

        function handleClick(e) {
            var cell = _grid.getCellFromEvent(e);
            if (!cell || !_grid.canCellBeActive(cell.row, cell.cell)) {
                return false;
            }

            var selection = rangesToRows(_ranges);
            var idx = $.inArray(cell.row, selection);

            if (!e.ctrlKey && !e.shiftKey && !e.metaKey) {
                return false;
            }
            else if (_grid.getOptions().multiSelect) {
                if (idx === -1 && (e.ctrlKey || e.metaKey)) {
                    selection.push(cell.row);
                    _grid.setActiveCell(cell.row, cell.cell);
                }
                else if (idx !== -1 && (e.ctrlKey || e.metaKey)) {
                    selection = $.grep(selection, function(o, i) { return (o !== cell.row); });
                    _grid.setActiveCell(cell.row, cell.cell);
                }
                else if (selection.length && e.shiftKey) {
                    var last = selection.pop();
                    var from = Math.min(cell.row, last);
                    var to = Math.max(cell.row, last);
                    selection = [];
                    for (var i = from; i <= to; i++) {
                        if (i !== last) {
                            selection.push(i);
                        }
                    }
                    selection.push(last);
                    _grid.setActiveCell(cell.row, cell.cell);
                }
            }

            _ranges = rowsToRanges(selection);
            setSelectedRanges(_ranges);
            //e.stopImmediatePropagation();

            return true;
        }

        $.extend(this, {
            "getSelectedRows":              getSelectedRows,
            "setSelectedRows":              setSelectedRows,

            "getSelectedRanges":            getSelectedRanges,
            "setSelectedRanges":            setSelectedRanges,

            "init":                         init,
            "destroy":                      destroy,

            "onSelectedRangesChanged":        new Slick.Event()
        });
    }
})(jQuery);
/*
 * @license
 * (c) 2009-2010 Michael Leibman
 * michael{dot}leibman{at}gmail{dot}com
 * http://github.com/mleibman/slickgrid
 * Distributed under MIT license.
 * All rights reserved.
 *
 * SlickGrid v2.0 alpha
 *
 * NOTES:
 *     Cell/row DOM manipulations are done directly bypassing jQuery's DOM manipulation methods.
 *     This increases the speed dramatically, but can only be done safely because there are no event handlers
 *     or data associated with any cell/row DOM nodes.  Cell editors must make sure they implement .destroy()
 *     and do proper cleanup.
 */

// make sure required JavaScript modules are loaded
if (typeof jQuery === "undefined") {
    throw "SlickGrid requires jquery module to be loaded";
}
if (!jQuery.fn.drag) {
    throw "SlickGrid requires jquery.event.drag module to be loaded";
}
if (typeof Slick === "undefined") {
    throw "slick.core.js not loaded";
}


(function($) {
    // Slick.Grid
    $.extend(true, window, {
        Slick: {
            Grid: SlickGrid
        }
    });

    var scrollbarDimensions; // shared across all grids on this page

    //////////////////////////////////////////////////////////////////////////////////////////////
    // SlickGrid class implementation (available as Slick.Grid)

    /**
     * @param {Node}              container   Container node to create the grid in.
     * @param {Array,Object}      data        An array of objects for databinding.
     * @param {Array}             columns     An array of column definitions.
     * @param {Object}            options     Grid options.
     **/
    function SlickGrid(container,data,columns,options) {
        /// <summary>
        /// Create and manage virtual grid in the specified $container,
        /// connecting it to the specified data source. Data is presented
        /// as a grid with the specified columns and data.length rows.
        /// Options alter behaviour of the grid.
        /// </summary>

        // settings
        var defaults = {
            headerHeight: 25,
            rowHeight: 25,
            defaultColumnWidth: 80,
            enableAddRow: false,
            leaveSpaceForNewRows: false,
            editable: false,
            autoEdit: true,
            enableCellNavigation: true,
            enableCellRangeSelection: false,
            enableColumnReorder: false,
            asyncEditorLoading: false,
            asyncEditorLoadDelay: 100,
            forceFitColumns: false,
            enableAsyncPostRender: false,
            asyncPostRenderDelay: 60,
            autoHeight: false,
            editorLock: Slick.GlobalEditorLock,
            showHeaderRow: false,
            headerRowHeight: 25,
            showTopPanel: false,
            topPanelHeight: 25,
            formatterFactory: null,
            editorFactory: null,
            cellFlashingCssClass: "flashing",
            selectedCellCssClass: "selected",
            multiSelect: true,
            enableTextSelectionOnCells: false,
            borderBottomWidth:0
        };

        var columnDefaults = {
            name: "",
            resizable: true,
            sortable: false,
            minWidth: 30,
            rerenderOnResize: false,
            headerCssClass: null
        };

        // scroller
        var maxSupportedCssHeight;      // browser's breaking point
        var th;                         // virtual height
        var h;                          // real scrollable height
        var ph;                         // page height
        var n;                          // number of pages
        var cj;                         // "jumpiness" coefficient

        var page = 0;                   // current page
        var offset = 0;                 // current page offset
        var scrollDir = 1;

        // private
        var $container;
        var uid = "slickgrid_" + Math.round(1000000 * Math.random());
        var self = this;
        var $headerScroller;
        var $headers;
        var $headerRow, $headerRowScroller;
        var $topPanelScroller;
        var $topPanel;
        var $viewport;
        var $canvas;
        var $style;
        var stylesheet;
        var viewportH, viewportW;
        var viewportHasHScroll;
        var headerColumnWidthDiff, headerColumnHeightDiff, cellWidthDiff, cellHeightDiff;  // padding+border
        var absoluteColumnMinWidth;

        var activePosX;
        var activeRow, activeCell;
        var activeCellNode = null;
        var currentEditor = null;
        var serializedEditorValue;
        var editController;

        var rowsCache = {};
        var renderedRows = 0;
        var numVisibleRows;
        var prevScrollTop = 0;
        var scrollTop = 0;
        var lastRenderedScrollTop = 0;
        var prevScrollLeft = 0;
        var avgRowRenderTime = 10;

        var selectionModel;
        var selectedRows = [];

        var plugins = [];
        var cellCssClasses = {};

        var columnsById = {};
        var sortColumnId;
        var sortAsc = true;

        // async call handles
        var h_editorLoader = null;
        var h_render = null;
        var h_postrender = null;
        var postProcessedRows = {};
        var postProcessToRow = 0;
        var postProcessFromRow = 0;
        var lastrenderedRows =null;

        // perf counters
        var counter_rows_rendered = 0;
        var counter_rows_removed = 0;


        //////////////////////////////////////////////////////////////////////////////////////////////
        // Initialization

        function init() {
            /// <summary>
            /// Initialize 'this' (self) instance of a SlickGrid.
            /// This function is called by the constructor.
            /// </summary>

            $container = $(container);
            if($container.length < 1) {
              throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.");
            }

            try {
                maxSupportedCssHeight = parseInt(window.localStorage.getItem('maxSupportedCssHeight'));
            } catch (e) { maxSupportedCssHeight=NaN; }
            if(!(maxSupportedCssHeight > 0))
                maxSupportedCssHeight = getMaxSupportedCssHeight();

            scrollbarDimensions = scrollbarDimensions || measureScrollbar(); // skip measurement if already have dimensions
            options = $.extend({},defaults,options);
            columnDefaults.width = options.defaultColumnWidth;

            // validate loaded JavaScript modules against requested options
            if (options.enableColumnReorder && !$.fn.sortable) {
                throw new Error("SlickGrid's \"enableColumnReorder = true\" option requires jquery-ui.sortable module to be loaded");
            }

            editController = {
                "commitCurrentEdit": commitCurrentEdit,
                "cancelCurrentEdit": cancelCurrentEdit
            };

            $container
                .empty()
                .attr("tabIndex",0)
                .attr("hideFocus",true)
                .css("overflow","hidden")
                .css("outline",0)
                .addClass(uid)
                .addClass("ui-widget");

            // set up a positioning container if needed
            if (!/relative|absolute|fixed/.test($container.css("position")))
                $container.css("position","relative");

            $headerScroller = $("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />")//;.appendTo($container);
            $headers = $("<div class='slick-header-columns' style='width:100%; left:0px' />")//;.appendTo($headerScroller);

            $headerRowScroller = $("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />")//;.appendTo($container);
            $headerRow = $("<div class='slick-headerrow-columns' style='width:100%;' />")//;.appendTo($headerRowScroller);

            $topPanelScroller = $("<div class='slick-top-panel-scroller ui-state-default' style='overflow:visible;position:relative;' />")//;.appendTo($container);
            $topPanel = $("<div class='slick-top-panel' style='width:100%' />")//;.appendTo($topPanelScroller);

            if (!options.showTopPanel) {
                $topPanelScroller.hide();
            }

            if (!options.showHeaderRow) {
                $headerRowScroller.hide();
            }

            $viewport = $("<div class='slick-viewport' tabIndex='0' hideFocus style='width:100%;overflow:hidden;outline:0;position:relative;"
                          +(options.borderBottomWidth>0?'border-bottom-width:'+options.borderBottomWidth+'px;':'')
                          +"'>").appendTo($container);
            $canvas = $("<div class='grid-canvas' tabIndex='0' hideFocus><div id='dynRowSizer'/></div>").appendTo($viewport);

            // header columns and cells may have different padding/border skewing width calculations (box-sizing, hello?)
            // calculate the diff so we can set consistent sizes
            measureCellPaddingAndBorder();

            // for usability reasons, all text selection in SlickGrid is disabled
            // with the exception of input and textarea elements (selection must
            // be enabled there so that editors work as expected); note that
            // selection in grid cells (grid body) is already unavailable in
            // all browsers except IE
            disableSelection($headers); // disable all text selection in header (including input and textarea)

            if (!options.enableTextSelectionOnCells) {
                // disable text selection in grid cells except in input and textarea elements
                // (this is IE-specific, because selectstart event will only fire in IE)
                $viewport.bind("selectstart.ui", function (event) {
                    return $(event.target).is("input,textarea");
                });
            }

            viewportW = parseFloat($.css($container[0], "width", true));

            // createColumnHeaders();
            // setupColumnSort();
            // //createCssRules();
            // resizeAndRender();

            // bindAncestorScrollEvents();
            $viewport.bind("scroll.slickgrid", handleScroll);
            $container.bind("resize.slickgrid", resizeAndRender);
            bind();
            // $headerScroller
            //     .bind("contextmenu.slickgrid", handleHeaderContextMenu)
            //     .bind("click.slickgrid", handleHeaderClick);
        }
        function bind(){
            $canvas
                .on("keydown.slickgrid", handleKeyDown)
                .on("click.slickgrid", handleClick)
                .on("dblclick.slickgrid", handleDblClick)
                .on("contextmenu.slickgrid", handleContextMenu)
                .on("draginit", handleDragInit)
                .on("dragstart", handleDragStart)
                .on("drag", handleDrag)
                .on("dragend", handleDragEnd)
								.on("mouseenter", ".slick-cell", handleMouseEnter)
            		.on("mouseleave", ".slick-cell", handleMouseLeave);
        }
        function unbind(){
            $canvas
                .off("keydown.slickgrid", handleKeyDown)
                .off("click.slickgrid", handleClick)
                .off("dblclick.slickgrid", handleDblClick)
                .off("contextmenu.slickgrid", handleContextMenu)
                .off("draginit", handleDragInit)
                .off("dragstart", handleDragStart)
                .off("drag", handleDrag)
                .off("dragend", handleDragEnd)
								.off("mouseenter", ".slick-cell", handleMouseEnter)
            		.off("mouseleave", ".slick-cell", handleMouseLeave);
        }


        function registerPlugin(plugin) {
            plugins.unshift(plugin);
            plugin.init(self);
        }

        function unregisterPlugin(plugin) {
            for (var i = plugins.length; i >= 0; i--) {
                if (plugins[i] === plugin) {
                    if (plugins[i].destroy) {
                        plugins[i].destroy();
                    }
                    plugins.splice(i, 1);
                    break;
                }
            }
        }

        function setSelectionModel(model) {
            if (selectionModel) {
                selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged);
                if (selectionModel.destroy) {
                    selectionModel.destroy();
                }
            }

            selectionModel = model;
            selectionModel.init(self);

            selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged);
        }

        function getSelectionModel() {
            return selectionModel;
        }

        function getCanvasNode() {
            return $canvas[0];
        }

        function measureScrollbar() {
            /// <summary>
            /// Measure width of a vertical scrollbar
            /// and height of a horizontal scrollbar.
            /// </summary
            /// <returns>
            /// { width: pixelWidth, height: pixelHeight }
            /// </returns>
            var $c = $("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body");
            var dim = { width: $c.width() - $c[0].clientWidth, height: $c.height() - $c[0].clientHeight };
            $c.remove();
            return dim;
        }

        function getRowWidth() {
            var rowWidth = 0;
            var i = columns.length;
            while (i--) {
                rowWidth += (columns[i].width || columnDefaults.width);
            }
            return rowWidth;
        }

        function setCanvasWidth(width) {
            // $canvas.width(width);
            viewportHasHScroll = (width > viewportW - scrollbarDimensions.width);
        }

        function disableSelection($target) {
            /// <summary>
            /// Disable text selection (using mouse) in
            /// the specified target.
            /// </summary
            if ($target && $target.jquery) {
                $target
                    .attr('unselectable', 'on')
                    .css('MozUserSelect', 'none')
                    .bind('selectstart.ui', function() { return false; }); // from jquery:ui.core.js 1.7.2
            }
        }

        function getMaxSupportedCssHeight() {
            var increment = 1000000;
            var supportedHeight = increment;
            // FF reports the height back but still renders blank after ~6M px
            var testUpTo = (_Prtg.Options.browser == "firefox") ? 5000000 : 1000000000;
            var div = $("<div style='display:none' />").appendTo(document.body);

            while (supportedHeight <= testUpTo) {
                div.css("height", supportedHeight + increment);
                if (div.height() !== supportedHeight + increment)
                    break;
                else
                    supportedHeight += increment;
            }

            div.remove();
            try { ret = window.localStorage.setItem('maxSupportedCssHeight', supportedHeight) } catch (e) { }
            return supportedHeight;
        }

        // TODO:  this is static.  need to handle page mutation.
        function bindAncestorScrollEvents() {
            var elem = $canvas[0];
            while (elem && (elem = elem.parentNode) != document.body) {
                // bind to scroll containers only
                if (!!elem && !!elem.scrollWidth &&  !!elem.scrollHeight && (elem == $viewport[0] || elem.scrollWidth != elem.clientWidth || elem.scrollHeight != elem.clientHeight))
                    $(elem).bind("scroll.slickgrid", handleActiveCellPositionChange);
            }
        }

        function unbindAncestorScrollEvents() {
            $canvas.parents().unbind("scroll.slickgrid");
        }

        function updateColumnHeader(columnId, title, toolTip) {
            var idx = getColumnIndex(columnId);
            var $header = $headers.children().eq(idx);
            if ($header) {
                columns[idx].name = title;
                columns[idx].toolTip = toolTip;
                $header
                    .attr("title", toolTip || title || "")
                    .children().eq(0).html(title);
            }
        }

        function getHeaderRow() {
            return $headerRow[0];
        }

        function getHeaderRowColumn(columnId) {
            var idx = getColumnIndex(columnId);
            var $header = $headerRow.children().eq(idx);
            return $header && $header[0];
        }

        function createColumnHeaders() {
            var i;

            function hoverBegin() {
                $(this).addClass("ui-state-hover");
            }
            function hoverEnd() {
                $(this).removeClass("ui-state-hover");
            }

            $headers.empty();
            $headerRow.empty();
            columnsById = {};

            for (i = 0; i < columns.length; i++) {
                var m = columns[i] = $.extend({},columnDefaults,columns[i]);
                columnsById[m.id] = i;

                var header = $("<div class='ui-state-default slick-header-column' id='" + uid + m.id + "' />")
                    .html("<span class='slick-column-name'>" + m.name + "</span>")
                    .width(m.width - headerColumnWidthDiff)
                    .attr("title", m.toolTip || m.name || "")
                    .data("fieldId", m.id)
                    .addClass(m.headerCssClass || "")
                    .appendTo($headers);

                if (options.enableColumnReorder || m.sortable) {
                    header.hover(hoverBegin, hoverEnd);
                }

                if (m.sortable) {
                    header.append("<span class='slick-sort-indicator' />");
                }

                if (options.showHeaderRow) {
                    $("<div class='ui-state-default slick-headerrow-column c" + i + "'></div>").appendTo($headerRow);
                }
            }

            setSortColumn(sortColumnId,sortAsc);
            // setupColumnResize();
            if (options.enableColumnReorder) {
                setupColumnReorder();
            }
        }

        function setupColumnSort() {
            $headers.click(function(e) {
                if ($(e.target).hasClass("slick-resizable-handle")) {
                    return;
                }

                var $col = $(e.target).closest(".slick-header-column");
                if (!$col.length)
                    return;

                var column = columns[getColumnIndex($col.data("fieldId"))];
                if (column.sortable) {
                    if (!getEditorLock().commitCurrentEdit())
                        return;

                    if (column.id === sortColumnId) {
                        sortAsc = !sortAsc;
                    }
                    else {
                        sortColumnId = column.id;
                        sortAsc = true;
                    }

                    setSortColumn(sortColumnId,sortAsc);
                    trigger(self.onSort, {sortCol:column,sortAsc:sortAsc});
                }
            });
        }

        function setupColumnReorder() {
            $headers.sortable({
                containment: "parent",
                axis: "x",
                cursor: "default",
                tolerance: "intersection",
                helper: "clone",
                placeholder: "slick-sortable-placeholder ui-state-default slick-header-column",
                forcePlaceholderSize: true,
                start: function(e, ui) { $(ui.helper).addClass("slick-header-column-active"); },
                beforeStop: function(e, ui) { $(ui.helper).removeClass("slick-header-column-active"); },
                stop: function(e) {
                    if (!getEditorLock().commitCurrentEdit()) {
                        $(this).sortable("cancel");
                        return;
                    }

                    var reorderedIds = $headers.sortable("toArray");
                    var reorderedColumns = [];
                    for (var i=0; i<reorderedIds.length; i++) {
                        reorderedColumns.push(columns[getColumnIndex(reorderedIds[i].replace(uid,""))]);
                    }
                    setColumns(reorderedColumns);

                    trigger(self.onColumnsReordered, {});
                    e.stopPropagation();
                    setupColumnResize();
                }
            });
        }

        function setupColumnResize() {
            var $col, j, c, pageX, columnElements, minPageX, maxPageX, firstResizable, lastResizable, originalCanvasWidth;
            columnElements = $headers.children();
            columnElements.find(".slick-resizable-handle").remove();
            columnElements.each(function(i,e) {
                if (columns[i].resizable) {
                    if (firstResizable === undefined) { firstResizable = i; }
                    lastResizable = i;
                }
            });
            if (firstResizable === undefined) {
                return;
            }
            columnElements.each(function(i,e) {
                if (i < firstResizable || (options.forceFitColumns && i >= lastResizable)) { return; }
                $col = $(e);
                $("<div class='slick-resizable-handle' />")
                    .appendTo(e)
                    .bind("dragstart", function(e,dd) {
                        if (!getEditorLock().commitCurrentEdit()) { return false; }
                        pageX = e.pageX;
                        $(this).parent().addClass("slick-header-column-active");
                        var shrinkLeewayOnRight = null, stretchLeewayOnRight = null;
                        // lock each column's width option to current width
                        columnElements.each(function(i,e) { columns[i].previousWidth = $(e).outerWidth(); });
                        if (options.forceFitColumns) {
                            shrinkLeewayOnRight = 0;
                            stretchLeewayOnRight = 0;
                            // colums on right affect maxPageX/minPageX
                            for (j = i + 1; j < columnElements.length; j++) {
                                c = columns[j];
                                if (c.resizable) {
                                    if (stretchLeewayOnRight !== null) {
                                        if (c.maxWidth) {
                                            stretchLeewayOnRight += c.maxWidth - c.previousWidth;
                                        }
                                        else {
                                            stretchLeewayOnRight = null;
                                        }
                                    }
                                    shrinkLeewayOnRight += c.previousWidth - Math.max(c.minWidth || 0, absoluteColumnMinWidth);
                                }
                            }
                        }
                        var shrinkLeewayOnLeft = 0, stretchLeewayOnLeft = 0;
                        for (j = 0; j <= i; j++) {
                            // columns on left only affect minPageX
                            c = columns[j];
                            if (c.resizable) {
                                if (stretchLeewayOnLeft !== null) {
                                    if (c.maxWidth) {
                                        stretchLeewayOnLeft += c.maxWidth - c.previousWidth;
                                    }
                                    else {
                                        stretchLeewayOnLeft = null;
                                    }
                                }
                                shrinkLeewayOnLeft += c.previousWidth - Math.max(c.minWidth || 0, absoluteColumnMinWidth);
                            }
                        }
                        if (shrinkLeewayOnRight === null) { shrinkLeewayOnRight = 100000; }
                        if (shrinkLeewayOnLeft === null) { shrinkLeewayOnLeft = 100000; }
                        if (stretchLeewayOnRight === null) { stretchLeewayOnRight = 100000; }
                        if (stretchLeewayOnLeft === null) { stretchLeewayOnLeft = 100000; }
                        maxPageX = pageX + Math.min(shrinkLeewayOnRight, stretchLeewayOnLeft);
                        minPageX = pageX - Math.min(shrinkLeewayOnLeft, stretchLeewayOnRight);
                        originalCanvasWidth = $canvas.width();
                    })
                    .bind("drag", function(e,dd) {
                        var actualMinWidth, d = Math.min(maxPageX, Math.max(minPageX, e.pageX)) - pageX, x, ci;
                        if (d < 0) { // shrink column
                            x = d;
                            for (j = i; j >= 0; j--) {
                                c = columns[j];
                                if (c.resizable) {
                                    actualMinWidth = Math.max(c.minWidth || 0, absoluteColumnMinWidth);
                                    if (x && c.previousWidth + x < actualMinWidth) {
                                        x += c.previousWidth - actualMinWidth;
                                        c.width = actualMinWidth;
                                    } else {
                                        c.width = c.previousWidth + x;
                                        x = 0;
                                    }
                                }
                            }

                            if (options.forceFitColumns) {
                                x = -d;
                                for (j = i + 1; j < columnElements.length; j++) {
                                    c = columns[j];
                                    if (c.resizable) {
                                        if (x && c.maxWidth && (c.maxWidth - c.previousWidth < x)) {
                                            x -= c.maxWidth - c.previousWidth;
                                            c.width = c.maxWidth;
                                        } else {
                                            c.width =  c.previousWidth + x;
                                            x = 0;
                                        }
                                    }
                                }
                            } else if (options.syncColumnCellResize) {
                                setCanvasWidth(originalCanvasWidth + d);
                            }
                        } else { // stretch column
                            x = d;
                            for (j = i; j >= 0; j--) {
                                c = columns[j];
                                if (c.resizable) {
                                    if (x && c.maxWidth && (c.maxWidth - c.previousWidth < x)) {
                                        x -= c.maxWidth - c.previousWidth;
                                        c.width = c.maxWidth;
                                    } else {
                                        c.width = c.previousWidth + x;
                                        x = 0;
                                    }
                                }
                            }

                            if (options.forceFitColumns) {
                                x = -d;
                                for (j = i + 1; j < columnElements.length; j++) {
                                    c = columns[j];
                                    if (c.resizable) {
                                        actualMinWidth = Math.max(c.minWidth || 0, absoluteColumnMinWidth);
                                        if (x && c.previousWidth + x < actualMinWidth) {
                                            x += c.previousWidth - actualMinWidth;
                                            c.width = actualMinWidth;
                                        } else {
                                            c.width = c.previousWidth + x;
                                            x = 0;
                                        }
                                    }
                                }
                            } else if (options.syncColumnCellResize) {
                                setCanvasWidth(originalCanvasWidth + d);
                            }
                        }
                        applyColumnHeaderWidths();
                        if (options.syncColumnCellResize) {
                            applyColumnWidths();
                        }
                    })
                    .bind("dragend", function(e,dd) {
                        var newWidth;
                        $(this).parent().removeClass("slick-header-column-active");
                        for (j = 0; j < columnElements.length; j++) {
                            c = columns[j];
                            newWidth = $(columnElements[j]).outerWidth();

                            if (c.previousWidth !== newWidth && c.rerenderOnResize) {
                                invalidateAllRows();
                            }
                        }
                        applyColumnWidths();
                        resizeCanvas();
                        trigger(self.onColumnsResized, {});
                    });
                });
        }

        function getVBoxDelta($el) {
            var p = ["borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom"];
            var delta = 0;
            $.each(p, function(n,val) { delta += parseFloat($el.css(val)) || 0; });
            return delta;
        }

        function measureCellPaddingAndBorder() {
            var el;
            var h = ["borderLeftWidth", "borderRightWidth", "paddingLeft", "paddingRight"];
            var v = ["borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom"];

            el = $("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers);
            headerColumnWidthDiff = headerColumnHeightDiff = 0;
            $.each(h, function(n,val) { headerColumnWidthDiff += parseFloat(el.css(val)) || 0; });
            $.each(v, function(n,val) { headerColumnHeightDiff += parseFloat(el.css(val)) || 0; });
            el.remove();

            var r = $("<div class='slick-row' />").appendTo($canvas);
            el = $("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(r);
            cellWidthDiff = cellHeightDiff = 0;
            $.each(h, function(n,val) { cellWidthDiff += parseFloat(el.css(val)) || 0; });
            $.each(v, function(n,val) { cellHeightDiff += parseFloat(el.css(val)) || 0; });
            r.remove();

            absoluteColumnMinWidth = Math.max(headerColumnWidthDiff,cellWidthDiff);
        }

        function createCssRules() {
            $style = $("<style type='text/css' rel='stylesheet' />").appendTo($("head"));
            var rowHeight = (options.rowHeight - cellHeightDiff);

            var rules = [
                "." + uid + " .slick-header-column { left: 1000px; }",
                "." + uid + " .slick-top-panel { height:" + options.topPanelHeight + "px; }",
                "." + uid + " .slick-headerrow-columns { height:" + options.headerRowHeight + "px; }",
                "." + uid + " .slick-cell { height:" + rowHeight + "px; }",
                "." + uid + " .slick-row { width:" + getRowWidth() + "px; }",
                "." + uid + " .lr { float:none; position:absolute; }"
            ];

            var rowWidth = getRowWidth();
            var x = 0, w;
            for (var i=0; i<columns.length; i++) {
                w = columns[i].width;

                rules.push("." + uid + " .l" + i + " { left: " + x + "px; }");
                rules.push("." + uid + " .r" + i + " { right: " + (rowWidth - x - w) + "px; }");
                rules.push("." + uid + " .c" + i + " { width:" + (w - cellWidthDiff) + "px; }");

                x += columns[i].width;
            }

            if ($style[0].styleSheet) { // IE
                $style[0].styleSheet.cssText = rules.join(" ");
            }
            else {
                $style[0].appendChild(document.createTextNode(rules.join(" ")));
            }

            var sheets = document.styleSheets;
            for (var i=0; i<sheets.length; i++) {
                if ((sheets[i].ownerNode || sheets[i].owningElement) == $style[0]) {
                    stylesheet = sheets[i];
                    break;
                }
            }
        }

        function findCssRule(selector) {
            var rules = (stylesheet.cssRules || stylesheet.rules);

            for (var i=0; i<rules.length; i++) {
                if (rules[i].selectorText == selector)
                    return rules[i];
            }

            return null;
        }

        function removeCssRules() {
            $style.remove();
        }

        function destroy() {
            getEditorLock().cancelCurrentEdit();

            trigger(self.onBeforeDestroy, {});

            for (var i = 0; i < plugins.length; i++) {
                unregisterPlugin(plugins[i]);
            }

            if (options.enableColumnReorder && $headers.sortable)
                $headers.sortable("destroy");

            unbindAncestorScrollEvents();
            $container.unbind(".slickgrid");
            removeCssRules();

            $canvas.unbind("draginit dragstart dragend drag");
            $container.empty().removeClass(uid);
        }


        //////////////////////////////////////////////////////////////////////////////////////////////
        // General

        function trigger(evt, args, e) {
            e = e || new Slick.EventData();
            args = args || {};
            args.grid = self;
            return evt.notify(args, e, self);
        }

        function getEditorLock() {
            return options.editorLock;
        }

        function getEditController() {
            return editController;
        }

        function getColumnIndex(id) {
            return columnsById[id];
        }

        function autosizeColumns() {
            var i, c,
                widths = [],
                shrinkLeeway = 0,
                availWidth = (options.autoHeight ? viewportW : viewportW - scrollbarDimensions.width), // with AutoHeight, we do not need to accomodate the vertical scroll bar
                total = 0,
                existingTotal = 0;

            for (i = 0; i < columns.length; i++) {
                c = columns[i];
                widths.push(c.width);
                existingTotal += c.width;
                shrinkLeeway += c.width - Math.max(c.minWidth || 0, absoluteColumnMinWidth);
            }

            total = existingTotal;

            invalidateAllRows();

            // shrink
            while (total > availWidth) {
                if (!shrinkLeeway) { return; }
                var shrinkProportion = (total - availWidth) / shrinkLeeway;
                for (i = 0; i < columns.length && total > availWidth; i++) {
                    c = columns[i];
                    if (!c.resizable || c.minWidth === c.width || c.width === absoluteColumnMinWidth) { continue; }
                    var shrinkSize = Math.floor(shrinkProportion * (c.width - Math.max(c.minWidth || 0, absoluteColumnMinWidth))) || 1;
                    total -= shrinkSize;
                    widths[i] -= shrinkSize;
                }
            }

            // grow
            var previousTotal = total;
            while (total < availWidth) {
                var growProportion = availWidth / total;
                for (i = 0; i < columns.length && total < availWidth; i++) {
                    c = columns[i];
                    if (!c.resizable || c.maxWidth <= c.width) { continue; }
                    var growSize = Math.min(Math.floor(growProportion * c.width) - c.width, (c.maxWidth - c.width) || 1000000) || 1;
                    total += growSize;
                    widths[i] += growSize;
                }
                if (previousTotal == total) break; // if total is not changing, will result in infinite loop
                previousTotal = total;
            }

            for (i=0; i<columns.length; i++) {
                columns[i].width = widths[i];
            }

            applyColumnHeaderWidths();
            applyColumnWidths();
            resizeCanvas();
        }

        function applyColumnHeaderWidths() {
            var h;
            for (var i = 0, headers = $headers.children(), ii = headers.length; i < ii; i++) {
                h = $(headers[i]);
                if (h.width() !== columns[i].width - headerColumnWidthDiff) {
                    h.width(columns[i].width - headerColumnWidthDiff);
                }
            }
        }

        function applyColumnWidths() {
            var rowWidth = getRowWidth();
            var x = 0, w, rule;
            for (var i = 0; i < columns.length; i++) {
                w = columns[i].width;

                rule = findCssRule("." + uid + " .c" + i);
                rule.style.width = (w - cellWidthDiff) + "px";

                rule = findCssRule("." + uid + " .l" + i);
                rule.style.left = x + "px";

                rule = findCssRule("." + uid + " .r" + i);
                rule.style.right = (rowWidth - x - w) + "px";

                x += columns[i].width;
            }

            rule = findCssRule("." + uid + " .slick-row");
            rule.style.width = rowWidth + "px";
        }

        function setSortColumn(columnId, ascending) {
            sortColumnId = columnId;
            sortAsc = ascending;
            var columnIndex = getColumnIndex(sortColumnId);

            $headers.children().removeClass("slick-header-column-sorted");
            $headers.find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc");

            if (columnIndex != null) {
                $headers.children().eq(columnIndex)
                    .addClass("slick-header-column-sorted")
                    .find(".slick-sort-indicator")
                        .addClass(sortAsc ? "slick-sort-indicator-asc" : "slick-sort-indicator-desc");
            }
        }

        function handleSelectedRangesChanged(e, ranges) {
            selectedRows = [];
            var hash = {};
            for (var i = 0; i < ranges.length; i++) {
                for (var j = ranges[i].fromRow; j <= ranges[i].toRow; j++) {
                    if (!hash[j]) {  // prevent duplicates
                        selectedRows.push(j);
                    }
                    hash[j] = {};
                    for (var k = ranges[i].fromCell; k <= ranges[i].toCell; k++) {
                        if (canCellBeSelected(j, k)) {
                            hash[j][columns[k].id] = options.selectedCellCssClass;
                        }
                    }
                }
            }

            setCellCssStyles(options.selectedCellCssClass, hash);

            trigger(self.onSelectedRowsChanged, {rows:getSelectedRows()}, e);
        }

        function getColumns() {
            return columns;
        }

        function setColumns(columnDefinitions) {
            columns = columnDefinitions;
            invalidateAllRows();
            createColumnHeaders();
            removeCssRules();
            createCssRules();
            resizeAndRender();
//            handleScroll();
        }

        function getOptions() {
            return options;
        }

        function setOptions(args) {
            if (!getEditorLock().commitCurrentEdit()) {
                return;
            }

            makeActiveCellNormal();

            if (options.enableAddRow !== args.enableAddRow) {
                invalidateRow(getDataLength());
            }

            options = $.extend(options,args);

            render();
        }

        function setData(newData,scrollToTop) {
            invalidateAllRows();
            data = newData;
            if (scrollToTop)
                scrollTo(0);
        }

        function getData() {
            return data;
        }

        function getDataLength() {
            if (data.getLength) {
                return data.getLength();
            }
            else {
                return data.length;
            }
        }

        function getDataItem(i) {
            if (data.getItem) {
                return data.getItem(i);
            }
            else {
                return data[i];
            }
        }

        function getTopPanel() {
            return $topPanel[0];
        }

        function showTopPanel() {
            options.showTopPanel = true;
            $topPanelScroller.slideDown("fast", resizeCanvas);
        }

        function hideTopPanel() {
            options.showTopPanel = false;
            $topPanelScroller.slideUp("fast", resizeCanvas);
        }

        function showHeaderRowColumns() {
            options.showHeaderRow = true;
            $headerRowScroller.slideDown("fast", resizeCanvas);
        }

        function hideHeaderRowColumns() {
            options.showHeaderRow = false;
            $headerRowScroller.slideUp("fast", resizeCanvas);
        }

        //////////////////////////////////////////////////////////////////////////////////////////////
        // Rendering / Scrolling

        function scrollTo(y) {
            var oldOffset = offset;

            page = Math.min(n-1, Math.floor(y / ph));
            offset = Math.round(page * cj);
            var newScrollTop = y - offset;

            if (offset != oldOffset) {
                var range = getVisibleRange(newScrollTop);
                cleanupRows(range.top,range.bottom);
                updateRowPositions();
            }

            if (prevScrollTop != newScrollTop) {
                scrollDir = (prevScrollTop + oldOffset < newScrollTop + offset) ? 1 : -1;
                $viewport[0].scrollTop = (lastRenderedScrollTop = scrollTop = prevScrollTop = newScrollTop);

                trigger(self.onViewportChanged, {});
            }
        }

        function defaultFormatter(row, cell, value, columnDef, dataContext) {
            return (value === null || value === undefined) ? "" : value;
        }

        function getFormatter(row, column) {
            var rowMetadata = data.getItemMetadata && data.getItemMetadata(row);

            // look up by id, then index
            var columnOverrides = rowMetadata &&
                    rowMetadata.columns &&
                    (rowMetadata.columns[column.id] || rowMetadata.columns[getColumnIndex(column.id)]);

            return (columnOverrides && columnOverrides.formatter) ||
                    (rowMetadata && rowMetadata.formatter) ||
                    column.formatter ||
                    (options.formatterFactory && options.formatterFactory.getFormatter(column)) ||
                    defaultFormatter;
        }

        function getEditor(row, cell) {
            var column = columns[cell];
            var rowMetadata = data.getItemMetadata && data.getItemMetadata(row);
            var columnMetadata = rowMetadata && rowMetadata.columns;

            if (columnMetadata && columnMetadata[column.id] && columnMetadata[column.id].editor !== undefined) {
                return columnMetadata[column.id].editor;
            }
            if (columnMetadata && columnMetadata[cell] && columnMetadata[cell].editor !== undefined) {
                return columnMetadata[cell].editor;
            }

            return column.editor || (options.editorFactory && options.editorFactory.getEditor(column));
        }

        function appendRowHtml(stringArray, row) {
            var d = getDataItem(row);
            var dataLoading = row < getDataLength() && !d;
            var cellCss;
            var rowCss = "slick-row " +
                (dataLoading ? " loading" : "") +
                (row % 2 == 1 ? ' odd' : ' even');

            var metadata = data.getItemMetadata && data.getItemMetadata(row);

            if (metadata && metadata.cssClasses) {
                rowCss += " " + metadata.cssClasses;
            }

            stringArray.push("<div class='ui-widget-content " + rowCss + "' row='" + row + "' style='top:" + (options.rowHeight*row-offset) + "px'>");

            var colspan;
            var rowHasColumnData = metadata && metadata.columns;

            for (var i=0, cols=columns.length; i<cols; i++) {
                var m = columns[i];
                colspan = getColspan(row, i);  // TODO:  don't calc unless we have to

                if (true || rowHasColumnData) {
                    cellCss = "slick-cell lr l" + i + " r" + Math.min(columns.length -1, i + colspan - 1) + (m.cssClass ? " " + m.cssClass : "");
                }
                else {
                    cellCss = "slick-cell c" + i + (m.cssClass ? " " + m.cssClass : "");
                }

                if (row === activeRow && i === activeCell) {
                    cellCss += (" active");
                }

                // TODO:  merge them together in the setter
                for (var key in cellCssClasses) {
                    if (cellCssClasses[key][row] && cellCssClasses[key][row][m.id]) {
                        cellCss += (" " + cellCssClasses[key][row][m.id]);
                    }
                }

                stringArray.push("<div class='" + cellCss + "'>");

                // if there is a corresponding row (if not, this is the Add New row or this data hasn't been loaded yet)
                if (d) {
                    stringArray.push(getFormatter(row, m)(row, i, d[m.field], m, d));
                }

                stringArray.push("</div>");

                if (colspan)
                    i += (colspan - 1);
            }

            stringArray.push("</div>");
        }

        function cleanupRows(rangeToKeep) {
            for (var i in rowsCache) {
                if (((i = parseInt(i, 10)) !== activeRow) && (i < rangeToKeep.top || i > rangeToKeep.bottom)) {
                    removeRowFromCache(i);
                }
            }
        }

        function invalidate() {
        	 lastrenderedRows = null;
           updateRowCount();
           invalidateAllRows();
           render();
        }

        function invalidateAllRows() {
            if (currentEditor) {
                makeActiveCellNormal();
            }
            for (var row in rowsCache) {
                removeRowFromCache(row);
            }
        }

        function removeRowFromCache(row) {
            var node = rowsCache[row];
            if (!node) { return; }
            $canvas[0].removeChild(node);

            delete rowsCache[row];
            delete postProcessedRows[row];
            renderedRows--;
            counter_rows_removed++;
        }

        function invalidateRows(rows) {
            var i, rl;
            if (!rows || !rows.length) { return; }
            scrollDir = 0;
            for (i=0, rl=rows.length; i<rl; i++) {
                if (currentEditor && activeRow === i) {
                    makeActiveCellNormal();
                }

                if (rowsCache[rows[i]]) {
                    removeRowFromCache(rows[i]);
                }
            }
        }

        function invalidateRow(row) {
            invalidateRows([row]);
        }

        function updateCell(row,cell) {
            var cellNode = getCellNode(row,cell);
            if (!cellNode) {
                return;
            }

            var m = columns[cell], d = getDataItem(row);
            if (currentEditor && activeRow === row && activeCell === cell) {
                currentEditor.loadValue(d);
            }
            else {
                cellNode.innerHTML = d ? getFormatter(row, m)(row, cell, d[m.field], m, d) : "";
                invalidatePostProcessingResults(row);
            }
        }

        function updateRow(row) {
            if (!rowsCache[row]) { return; }

            $(rowsCache[row]).children().each(function(i) {
                var m = columns[i];
                if (row === activeRow && i === activeCell && currentEditor) {
                    currentEditor.loadValue(getDataItem(activeRow));
                }
                else if (getDataItem(row)) {
                    this.innerHTML = getFormatter(row, m)(row, i, getDataItem(row)[m.field], m, getDataItem(row));
                }
                else {
                    this.innerHTML = "";
                }
            });

            invalidatePostProcessingResults(row);
        }

        function getViewportHeight() {
            return $container.height();
        }

        function resizeCanvas() {
            if (options.autoHeight) {
                viewportH = options.rowHeight * (getDataLength() + (options.enableAddRow ? 1 : 0) + (options.leaveSpaceForNewRows? numVisibleRows - 1 : 0));
            }
            else {
				if (!options.fullHeight || !viewportH)
					viewportH = getViewportHeight();
            }
            numVisibleRows = Math.ceil(viewportH / options.rowHeight);
            viewportW = parseFloat($.css($container[0], "width", true));

            var w = 0, i = columns.length;
            while (i--) {
                w += columns[i].width;
            }
            setCanvasWidth(w);

            updateRowCount();
            render();
        }

        function resizeAndRender() {
        		lastrenderedRows = null;
            if (options.forceFitColumns) {
                autosizeColumns();
            } else {
                resizeCanvas();
            }
        }

        function updateRowCount() {
            var newRowCount = getDataLength() + (options.enableAddRow?1:0) + (options.leaveSpaceForNewRows?numVisibleRows-1:0);
            var oldH = h;
            // remove the rows that are now outside of the data range
            // this helps avoid redundant calls to .removeRow() when the size of the data decreased by thousands of rows
            var l = options.enableAddRow ? getDataLength() : getDataLength() - 1;
            for (var i in rowsCache) {
                if (i >= l) {
                    removeRowFromCache(i);
                }
            }
            th = Math.max(options.rowHeight * newRowCount, viewportH - scrollbarDimensions.height);
            if (th < maxSupportedCssHeight) {
                // just one page
                h = ph = th;
                n = 1;
                cj = 0;
            }
            else {
                // break into pages
                h = maxSupportedCssHeight;
                ph = h / 100;
                n = Math.floor(th / ph);
                cj = (th - h) / (n - 1);
            }

            if (!!h && h !== oldH) {
                $canvas.css("height",h);
                scrollTop = $viewport[0].scrollTop;
            }

            var oldScrollTopInRange = (scrollTop + offset <= th - viewportH);

            if (th == 0 || scrollTop == 0) {
                page = offset = 0;
            }
            else if (oldScrollTopInRange) {
                // maintain virtual position
                scrollTo(scrollTop+offset);
            }
            else {
                // scroll to bottom
                scrollTo(th-viewportH);
            }

            if (h != oldH && options.autoHeight) {
                resizeCanvas();
            }
        }

        function getVisibleRange(viewportTop) {
            if (viewportTop == null)
                viewportTop = scrollTop;

            return {
                top: Math.floor((scrollTop+offset)/options.rowHeight),
                bottom: Math.ceil((scrollTop+offset+viewportH)/options.rowHeight)
            };
        }

        function getRenderedRange(viewportTop) {
            var range = getVisibleRange(viewportTop);
            var buffer = Math.round(viewportH/options.rowHeight);
            var minBuffer = 3;

            if (scrollDir == -1) {
                range.top -= buffer;
                range.bottom += minBuffer;
            }
            else if (scrollDir == 1) {
                range.top -= minBuffer;
                range.bottom += buffer;
            }
            else {
                range.top -= minBuffer;
                range.bottom += minBuffer;
            }

            range.top = Math.max(0,range.top);
            range.bottom = Math.min(options.enableAddRow ? getDataLength() : getDataLength() - 1,range.bottom);

            return range;
        }

        function renderRows(range) {
            var i, l,
                parentNode = $canvas[0],
                rowsBefore = renderedRows,
                stringArray = [],
                rows = [],
                needToReselectCell = false;

            for (i = range.top; i <= range.bottom; i++) {
                if (rowsCache[i]) { continue; }
                renderedRows++;
                rows.push(i);
                appendRowHtml(stringArray,i);
                if (activeCellNode && activeRow === i) {
                    needToReselectCell = true;
                }
                counter_rows_rendered++;
            }

            var x = document.createElement("div");
            x.innerHTML = stringArray.join("");

            for (i = 0, l = x.childNodes.length; i < l; i++) {
                rowsCache[rows[i]] = parentNode.appendChild(x.firstChild);
            }

            if (needToReselectCell) {
                activeCellNode = getCellNode(activeRow,activeCell);
            }
        }

        function startPostProcessing() {
            if (!options.enableAsyncPostRender) { return; }
            asyncPostProcessRows();
            // clearTimeout(h_postrender);
            // h_postrender = setTimeout(asyncPostProcessRows, options.asyncPostRenderDelay);
        }

        function invalidatePostProcessingResults(row) {
            delete postProcessedRows[row];
            postProcessFromRow = Math.min(postProcessFromRow,row);
            postProcessToRow = Math.max(postProcessToRow,row);
            startPostProcessing();
        }

        function updateRowPositions() {
            for (var row in rowsCache) {
                rowsCache[row].style.top = (row*options.rowHeight-offset) + "px";
            }
        }

        function render() {
            var visible = getVisibleRange();
            var rendered = getRenderedRange();
            unbind();
            // remove rows no longer in the viewport
            cleanupRows(rendered);

            // add new rows
            renderRows(rendered);

            postProcessFromRow = visible.top;
            postProcessToRow = Math.min(options.enableAddRow ? getDataLength() : getDataLength() - 1, visible.bottom);
            startPostProcessing();

            lastRenderedScrollTop = scrollTop;
            bind();
        }

        function handleScroll(e) {
            scrollTop = $viewport[0].scrollTop;
            var scrollLeft = $viewport[0].scrollLeft;
            var scrollDist = Math.abs(scrollTop - prevScrollTop);

            if (scrollLeft !== prevScrollLeft) {
                prevScrollLeft = scrollLeft;
                $headerScroller[0].scrollLeft = scrollLeft;
                $topPanelScroller[0].scrollLeft = scrollLeft;
                $headerRowScroller[0].scrollLeft = scrollLeft;
            }

            if (scrollDist) {

                scrollDir = prevScrollTop < scrollTop ? 1 : -1;
                prevScrollTop = scrollTop;

                // switch virtual pages if needed
                if (scrollDist < viewportH) {
                    scrollTo(scrollTop + offset);
                }
                else {
                    var oldOffset = offset;
                    page = Math.min(n - 1, Math.floor(scrollTop * ((th - viewportH) / (h - viewportH)) * (1 / ph)));
                    offset = Math.round(page * cj);
                    if (oldOffset != offset)
                        invalidateAllRows();
                }

                // if (Math.abs(lastRenderedScrollTop - scrollTop) < viewportH)
                //     render();
                // else
                    	var df = $.Deferred();
                    	df.always(render);
                    _Prtg.debounce(function(){
                    	return df.resolve();
                    },50, false, true)(e)

                trigger(self.onViewportChanged, {});
            }

            trigger(self.onScroll, {scrollLeft:scrollLeft, scrollTop:scrollTop});
        }

        function asyncPostProcessRows() {
            while (postProcessFromRow <= postProcessToRow) {
                var row = (scrollDir >= 0) ? postProcessFromRow++ : postProcessToRow--;
                var rowNode = rowsCache[row];
                if (!rowNode || postProcessedRows[row] || row>=getDataLength()) { continue; }

                var d = getDataItem(row), cellNodes = rowNode.childNodes;
                for (var i=0, j=0, l=columns.length; i<l; ++i) {
                    var m = columns[i];
                    if (m.asyncPostRender) { m.asyncPostRender(cellNodes[j], postProcessFromRow, d, m); }
                    ++j;
                }
                postProcessedRows[row] = true;
                h_postrender = setTimeout(asyncPostProcessRows, options.asyncPostRenderDelay);
                return;
            }
        }

        function addCellCssStyles(key,hash) {
            if (cellCssClasses[key]) {
                throw "addCellCssStyles: cell CSS hash with key '" + key + "' already exists.";
            }

            cellCssClasses[key] = hash;

            var node;
            for (var row in rowsCache) {
                if (hash[row]) {
                    for (var columnId in hash[row]) {
                        node = getCellNode(row, getColumnIndex(columnId));
                        if (node) {
                            $(node).addClass(hash[row][columnId]);
                        }
                    }
                }
            }
        }

        function removeCellCssStyles(key) {
            if (!cellCssClasses[key]) {
                return;
            }

            var node;
            for (var row in rowsCache) {
                if (cellCssClasses[key][row]) {
                    for (var columnId in cellCssClasses[key][row]) {
                        node = getCellNode(row, getColumnIndex(columnId));
                        if (node) {
                            $(node).removeClass(cellCssClasses[key][row][columnId]);
                        }
                    }
                }
            }

            delete cellCssClasses[key];
        }

        function setCellCssStyles(key,hash) {
            removeCellCssStyles(key);
            addCellCssStyles(key,hash);
        }

        function flashCell(row, cell, speed) {
            speed = speed || 100;
            if (rowsCache[row]) {
                var $cell = $(getCellNode(row,cell));

                function toggleCellClass(times) {
                    if (!times) return;
                    setTimeout(function() {
                        $cell.queue(function() {
                            $cell.toggleClass(options.cellFlashingCssClass).dequeue();
                            toggleCellClass(times-1);
                        });
                    },
                    speed);
                }

                toggleCellClass(4);
            }
        }

        //////////////////////////////////////////////////////////////////////////////////////////////
        // Interactivity

        function handleDragInit(e,dd) {
            var cell = getCellFromEvent(e);
            if (!cell || !cellExists(cell.row, cell.cell)) {
                return false;
            }

            return trigger(self.onDragInit, dd, e);

        }

        function handleDragStart(e,dd) {
            var cell = getCellFromEvent(e);
            if (!cell || !cellExists(cell.row, cell.cell)) {
                return false;
            }

            return trigger(self.onDragStart, dd, e);
        }

        function handleDrag(e,dd) {
            return trigger(self.onDrag, dd, e);
        }

        function handleDragEnd(e,dd) {
            return trigger(self.onDragEnd, dd, e);
        }

        function handleKeyDown(e) {
            trigger(self.onKeyDown, {}, e);
            var handled = e.isImmediatePropagationStopped();

            if (!handled) {
                if (!e.shiftKey && !e.altKey && !e.ctrlKey) {
                    if (e.which == 27) {
                        if (!getEditorLock().isActive()) {
                            return; // no editing mode to cancel, allow bubbling and default processing (exit without cancelling the event)
                        }
                        cancelEditAndSetFocus();
                    }
                    else if (e.which == 37) {
                        navigateLeft();
                    }
                    else if (e.which == 39) {
                        navigateRight();
                    }
                    else if (e.which == 38) {
                        navigateUp();
                    }
                    else if (e.which == 40) {
                        navigateDown();
                    }
                    else if (e.which == 9) {
                        navigateNext();
                    }
                    else if (e.which == 13) {
                        if (options.editable) {
                            if (currentEditor) {
                                // adding new row
                                if (activeRow === getDataLength()) {
                                    navigateDown();
                                }
                                else {
                                    commitEditAndSetFocus();
                                }
                            } else {
                                if (getEditorLock().commitCurrentEdit()) {
                                    makeActiveCellEditable();
                                }
                            }
                        }
                    }
                    else
                        return;
                }
                else if (e.which == 9 && e.shiftKey && !e.ctrlKey && !e.altKey) {
                    navigatePrev();
                }
                else
                    return;
            }

            // the event has been handled so don't let parent element (bubbling/propagation) or browser (default) handle it
            e.stopPropagation();
            e.preventDefault();
            try {
                e.originalEvent.keyCode = 0; // prevent default behaviour for special keys in IE browsers (F3, F5, etc.)
            }
            catch (error) {} // ignore exceptions - setting the original event's keycode throws access denied exception for "Ctrl" (hitting control key only, nothing else), "Shift" (maybe others)
        }

        function handleClick(e) {
            var cell = getCellFromEvent(e);
            if (!cell || (currentEditor !== null && activeRow == cell.row && activeCell == cell.cell)) {
                return;
            }

            trigger(self.onClick, {row:cell.row, cell:cell.cell}, e);
            if (e.isImmediatePropagationStopped()) {
                return;
            }

            if (canCellBeActive(cell.row, cell.cell)) {
                if (!getEditorLock().isActive() || getEditorLock().commitCurrentEdit()) {
                    //scrollRowIntoView(cell.row,false);
                    setActiveCellInternal(getCellNode(cell.row,cell.cell), (cell.row === getDataLength()) || options.autoEdit);
                }
            }
        }

        function handleContextMenu(e) {
            var $cell = $(e.target).closest(".slick-cell", $canvas);
            if ($cell.length === 0) { return; }

            // are we editing this cell?
            if (activeCellNode === $cell[0] && currentEditor !== null) { return; }

            trigger(self.onContextMenu, {}, e);
        }

        function handleDblClick(e) {
            var cell = getCellFromEvent(e);
            if (!cell || (currentEditor !== null && activeRow == cell.row && activeCell == cell.cell)) {
                return;
            }

            trigger(self.onDblClick, {row:cell.row, cell:cell.cell}, e);
            if (e.isImmediatePropagationStopped()) {
                return;
            }

            if (options.editable) {
                gotoCell(cell.row, cell.cell, true);
            }
        }

        function handleHeaderContextMenu(e) {
            var $header = $(e.target).closest(".slick-header-column", ".slick-header-columns");
            var column = $header && columns[self.getColumnIndex($header.data("fieldId"))];
            trigger(self.onHeaderContextMenu, {column: column}, e);
        }

        function handleHeaderClick(e) {
            var $header = $(e.target).closest(".slick-header-column", ".slick-header-columns");
            var column = $header && columns[self.getColumnIndex($header.data("fieldId"))];
            trigger(self.onHeaderClick, {column: column}, e);
        }

        function handleMouseEnter(e) {
            trigger(self.onMouseEnter, {}, e);
        }

        function handleMouseLeave(e) {
            trigger(self.onMouseLeave, {}, e);
        }

        function cellExists(row,cell) {
            return !(row < 0 || row >= getDataLength() || cell < 0 || cell >= columns.length);
        }

        function getCellFromPoint(x,y) {
            var row = Math.floor((y+offset)/options.rowHeight);
            var cell = 0;

            var w = 0;
            for (var i=0; i<columns.length && w<x; i++) {
                w += columns[i].width;
                cell++;
            }

            if (cell < 0) {
                cell = 0;
            }

            return {row:row,cell:cell-1};
        }

        function getCellFromNode(node) {
            // read column number from .l1 or .c1 CSS classes
            var cls = /l\d+/.exec(node.className) || /c\d+/.exec(node.className);
            if (!cls)
                throw "getCellFromNode: cannot get cell - " + node.className;
            return parseInt(cls[0].substr(1, cls[0].length-1), 10);
        }

        function getCellFromEvent(e) {
            var $cell = $(e.target).closest(".slick-cell", $canvas);
            if (!$cell.length)
                return null;

            return {
                row: $cell.parent().attr("row") | 0,
                cell: getCellFromNode($cell[0])
            };
        }

        function getCellNodeBox(row,cell) {
             if (!cellExists(row,cell))
                 return null;

             var y1 = row * options.rowHeight - offset;
             var y2 = y1 + options.rowHeight - 1;
             var x1 = 0;
             for (var i=0; i<cell; i++) {
                 x1 += columns[i].width;
             }
             var x2 = x1 + columns[cell].width;

             return {
                 top: y1,
                 left: x1,
                 bottom: y2,
                 right: x2
             };
         }

        //////////////////////////////////////////////////////////////////////////////////////////////
        // Cell switching

        function resetActiveCell() {
            setActiveCellInternal(null,false);
        }

        function setFocus() {
            // IE tries to scroll the viewport so that the item being focused is aligned to the left border
            // IE-specific .setActive() sets the focus, but doesn't scroll
            if (_Prtg.Options.browser  == "msie") {
                $canvas[0].setActive();
            }
            else {
                $canvas[0].focus();
            }
        }

        function scrollActiveCellIntoView() {
            if (activeCellNode) {
                var left = $(activeCellNode).position().left,
                    right = left + $(activeCellNode).outerWidth(),
                    scrollLeft = $viewport.scrollLeft(),
                    scrollRight = scrollLeft + $viewport.width();

                if (left < scrollLeft)
                    $viewport.scrollLeft(left);
                else if (right > scrollRight)
                    $viewport.scrollLeft(Math.min(left, right - $viewport[0].clientWidth));
            }
        }

        function setActiveCellInternal(newCell, editMode) {
            if (activeCellNode !== null) {
                makeActiveCellNormal();
                $(activeCellNode).removeClass("active");
            }

            var activeCellChanged = (activeCellNode !== newCell);
            activeCellNode = newCell;

            if (activeCellNode != null) {
                activeRow = parseInt($(activeCellNode).parent().attr("row"));
                activeCell = activePosX = getCellFromNode(activeCellNode);

                $(activeCellNode).addClass("active");

                if (options.editable && editMode && isCellPotentiallyEditable(activeRow,activeCell)) {
                    clearTimeout(h_editorLoader);

                    if (options.asyncEditorLoading) {
                        h_editorLoader = setTimeout(function() { makeActiveCellEditable(); }, options.asyncEditorLoadDelay);
                    }
                    else {
                        makeActiveCellEditable();
                    }
                }
                else {
                      setFocus();
                }
            }
            else {
                activeRow = activeCell = null;
            }

            if (activeCellChanged) {
                scrollActiveCellIntoView();
                trigger(self.onActiveCellChanged, getActiveCell());
            }
        }

        function clearTextSelection() {
            if (document.selection && document.selection.empty) {
                document.selection.empty();
            }
            else if (window.getSelection) {
                var sel = window.getSelection();
                if (sel && sel.removeAllRanges) {
                    sel.removeAllRanges();
                }
            }
        }

        function isCellPotentiallyEditable(row, cell) {
            // is the data for this row loaded?
            if (row < getDataLength() && !getDataItem(row)) {
                return false;
            }

            // are we in the Add New row?  can we create new from this cell?
            if (columns[cell].cannotTriggerInsert && row >= getDataLength()) {
                return false;
            }

            // does this cell have an editor?
            if (!getEditor(row, cell)) {
                return false;
            }

            return true;
        }

        function makeActiveCellNormal() {
            if (!currentEditor) { return; }
            trigger(self.onBeforeCellEditorDestroy, {editor:currentEditor});
            currentEditor.destroy();
            currentEditor = null;

            if (activeCellNode) {
                $(activeCellNode).removeClass("editable invalid");

                if (getDataItem(activeRow)) {
                    var column = columns[activeCell];
                    activeCellNode.innerHTML = getFormatter(activeRow, column)(activeRow, activeCell, getDataItem(activeRow)[column.field], column, getDataItem(activeRow));
                    invalidatePostProcessingResults(activeRow);
                }
            }

            // if there previously was text selected on a page (such as selected text in the edit cell just removed),
            // IE can't set focus to anything else correctly
            if (_Prtg.Options.browser == "msie") { clearTextSelection(); }

            getEditorLock().deactivate(editController);
        }

        function makeActiveCellEditable(editor) {
            if (!activeCellNode) { return; }
            if (!options.editable) {
                throw "Grid : makeActiveCellEditable : should never get called when options.editable is false";
            }

            // cancel pending async call if there is one
            clearTimeout(h_editorLoader);

            if (!isCellPotentiallyEditable(activeRow,activeCell)) {
                return;
            }

            var columnDef = columns[activeCell];
            var item = getDataItem(activeRow);

            if (trigger(self.onBeforeEditCell, {row:activeRow, cell:activeCell, item:item, column:columnDef}) === false) {
                setFocus();
                return;
            }

            getEditorLock().activate(editController);
            $(activeCellNode).addClass("editable");

            // don't clear the cell if a custom editor is passed through
            if (!editor) {
            activeCellNode.innerHTML = "";
            }

            currentEditor = new (editor || getEditor(activeRow, activeCell))({
                grid: self,
                gridPosition: absBox($container[0]),
                position: absBox(activeCellNode),
                container: activeCellNode,
                column: columnDef,
                item: item || {},
                commitChanges: commitEditAndSetFocus,
                cancelChanges: cancelEditAndSetFocus
            });

            if (item)
                currentEditor.loadValue(item);

            serializedEditorValue = currentEditor.serializeValue();

            if (currentEditor.position)
                handleActiveCellPositionChange();
        }

        function commitEditAndSetFocus() {
            // if the commit fails, it would do so due to a validation error
            // if so, do not steal the focus from the editor
            if (getEditorLock().commitCurrentEdit()) {
                  setFocus();

                if (options.autoEdit) {
                    navigateDown();
                }
            }
        }

        function cancelEditAndSetFocus() {
            if (getEditorLock().cancelCurrentEdit()) {
                  setFocus();
            }
        }

        function absBox(elem) {
            var box = {top:elem.offsetTop, left:elem.offsetLeft, bottom:0, right:0, width:$(elem).outerWidth(), height:$(elem).outerHeight(), visible:true};
            box.bottom = box.top + box.height;
            box.right = box.left + box.width;

            // walk up the tree
            var offsetParent = elem.offsetParent;
            while ((elem = elem.parentNode) != document.body) {
                if (box.visible && elem.scrollHeight != elem.offsetHeight && $(elem).css("overflowY") != "visible")
                    box.visible = box.bottom > elem.scrollTop && box.top < elem.scrollTop + elem.clientHeight;

                if (box.visible && elem.scrollWidth != elem.offsetWidth && $(elem).css("overflowX") != "visible")
                    box.visible = box.right > elem.scrollLeft && box.left < elem.scrollLeft + elem.clientWidth;

                box.left -= elem.scrollLeft;
                box.top -= elem.scrollTop;

                if (elem === offsetParent) {
                    box.left += elem.offsetLeft;
                    box.top += elem.offsetTop;
                    offsetParent = elem.offsetParent;
                }

                box.bottom = box.top + box.height;
                box.right = box.left + box.width;
            }

            return box;
        }

        function getActiveCellPosition(){
            return absBox(activeCellNode);
        }

        function getGridPosition(){
            return absBox($container[0])
        }

        function handleActiveCellPositionChange() {
            if (!activeCellNode) return;
            var cellBox;

            trigger(self.onActiveCellPositionChanged, {});

            if (currentEditor) {
                cellBox = cellBox || getActiveCellPosition();
                if (currentEditor.show && currentEditor.hide) {
                    if (!cellBox.visible)
                        currentEditor.hide();
                    else
                        currentEditor.show();
                }

                if (currentEditor.position)
                    currentEditor.position(cellBox);
            }
        }

        function getCellEditor() {
            return currentEditor;
        }

        function getActiveCell() {
            if (!activeCellNode)
                return null;
            else
                return {row: activeRow, cell: activeCell};
        }

        function getActiveCellNode() {
            return activeCellNode;
        }

        function scrollRowIntoView(row, doPaging) {
            var rowAtTop = row * options.rowHeight;
            var rowAtBottom = (row + 1) * options.rowHeight - viewportH + (viewportHasHScroll?scrollbarDimensions.height:0);

            // need to page down?
            if ((row + 1) * options.rowHeight > scrollTop + viewportH + offset) {
                scrollTo(doPaging ? rowAtTop : rowAtBottom);
                render();
            }

            // or page up?
            else if (row * options.rowHeight < scrollTop + offset) {
                scrollTo(doPaging ? rowAtBottom : rowAtTop);
                render();
            }
        }

        function getColspan(row, cell) {
            var metadata = data.getItemMetadata && data.getItemMetadata(row);
            if (!metadata || !metadata.columns) {
                return 1;
            }

            var columnData = metadata.columns[columns[cell].id] || metadata.columns[cell];
            var colspan = (columnData && columnData.colspan);
            if (colspan === "*") {
                colspan = columns.length - cell;
            }
            return (colspan || 1);
        }

        function findFirstFocusableCell(row) {
            var cell = 0;
            while (cell < columns.length) {
                if (canCellBeActive(row, cell)) {
                    return cell;
                }
                cell += getColspan(row, cell);
            }
            return null;
        }

        function findLastFocusableCell(row) {
            var cell = 0;
            var lastFocusableCell = null;
            while (cell < columns.length) {
                if (canCellBeActive(row, cell)) {
                    lastFocusableCell = cell;
                }
                cell += getColspan(row, cell);
            }
            return lastFocusableCell;
        }

        function gotoRight(row, cell, posX) {
            if (cell >= columns.length) {
                return null;
            }

            do {
                cell += getColspan(row, cell);
            }
            while (cell < columns.length && !canCellBeActive(row, cell));

            if (cell < columns.length) {
                return {
                    "row": row,
                    "cell": cell,
                    "posX": cell
                };
            }
            return null;
        }

        function gotoLeft(row, cell, posX) {
            if (cell <= 0) {
                return null;
            }

            var firstFocusableCell = findFirstFocusableCell(row);
            if (firstFocusableCell === null || firstFocusableCell >= cell) {
                return null;
            }

            var prev = {
                "row": row,
                "cell": firstFocusableCell,
                "posX": firstFocusableCell
            };
            var pos;
            while (true) {
                pos = gotoRight(prev.row, prev.cell, prev.posX);
                if (!pos) {
                    return null;
                }
                if (pos.cell >= cell) {
                    return prev;
                }
                prev = pos;
            }
        }

        function gotoDown(row, cell, posX) {
            var prevCell;
            while (true) {
                if (++row >= getDataLength() + (options.enableAddRow ? 1 : 0)) {
                    return null;
                }

                prevCell = cell = 0;
                while (cell <= posX) {
                    prevCell = cell;
                    cell += getColspan(row, cell);
                }

                if (canCellBeActive(row, prevCell)) {
                    return {
                        "row": row,
                        "cell": prevCell,
                        "posX": posX
                    };
                }
            }
        }

        function gotoUp(row, cell, posX) {
            var prevCell;
            while (true) {
                if (--row < 0) {
                    return null;
                }

                prevCell = cell = 0;
                while (cell <= posX) {
                    prevCell = cell;
                    cell += getColspan(row, cell);
                }

                if (canCellBeActive(row, prevCell)) {
                    return {
                        "row": row,
                        "cell": prevCell,
                        "posX": posX
                    };
                }
            }
        }

        function gotoNext(row, cell, posX) {
            var pos = gotoRight(row, cell, posX);
            if (pos) {
                return pos;
            }

            var firstFocusableCell = null;
            while (++row < getDataLength() + (options.enableAddRow ? 1 : 0)) {
                firstFocusableCell = findFirstFocusableCell(row);
                if (firstFocusableCell !== null) {
                    return {
                        "row": row,
                        "cell": firstFocusableCell,
                        "posX": firstFocusableCell
                    };
                }
            }
            return null;
        }

        function gotoPrev(row, cell, posX) {
            var pos;
            var lastSelectableCell;
            while (!pos) {
                pos = gotoLeft(row, cell, posX);
                if (pos) {
                    break;
                }
                if (--row < 0) {
                    return null;
                }

                cell = 0;
                lastSelectableCell = findLastFocusableCell(row);
                if (lastSelectableCell !== null) {
                    pos = {
                        "row": row,
                        "cell": lastSelectableCell,
                        "posX": lastSelectableCell
                    };
                }
            }
            return pos;
        }

        function navigateRight() {
            navigate("right");
        }

        function navigateLeft() {
            navigate("left");
        }

        function navigateDown() {
            navigate("down");
        }

        function navigateUp() {
            navigate("up");
        }

        function navigateNext() {
            navigate("next");
        }

        function navigatePrev() {
            navigate("prev");
        }

        function navigate(dir) {
            if (!activeCellNode || !options.enableCellNavigation) { return; }
            if (!getEditorLock().commitCurrentEdit()) { return; }

            var stepFunctions = {
                "up":       gotoUp,
                "down":     gotoDown,
                "left":     gotoLeft,
                "right":    gotoRight,
                "prev":     gotoPrev,
                "next":     gotoNext
            };
            var stepFn = stepFunctions[dir];
            var pos = stepFn(activeRow, activeCell, activePosX);
            if (pos) {
                var isAddNewRow = (pos.row == getDataLength());
                scrollRowIntoView(pos.row, !isAddNewRow);
                setActiveCellInternal(getCellNode(pos.row, pos.cell), isAddNewRow || options.autoEdit);
                activePosX = pos.posX;
            }
        }

        function getCellNode(row, cell) {
            if (rowsCache[row]) {
                var cells = $(rowsCache[row]).children();
                var nodeCell;
                for (var i = 0; i < cells.length; i++) {
                    nodeCell = getCellFromNode(cells[i]);
                    if (nodeCell === cell) {
                        return cells[i];
                    }
                    else if (nodeCell > cell) {
                        return null;
                    }

                }
            }
            return null;
        }

        function setActiveCell(row, cell) {
            if (row > getDataLength() || row < 0 || cell >= columns.length || cell < 0) {
                return;
            }

            if (!options.enableCellNavigation) {
                return;
            }

            scrollRowIntoView(row,false);
            setActiveCellInternal(getCellNode(row,cell),false);
        }

        function canCellBeActive(row, cell) {
            if (!options.enableCellNavigation || row >= getDataLength() + (options.enableAddRow ? 1 : 0) || row < 0 || cell >= columns.length || cell < 0) {
                return false;
            }

            var rowMetadata = data.getItemMetadata && data.getItemMetadata(row);
            if (rowMetadata && typeof rowMetadata.focusable === "boolean") {
                return rowMetadata.focusable;
            }

            var columnMetadata = rowMetadata && rowMetadata.columns;
            if (columnMetadata && columnMetadata[columns[cell].id] && typeof columnMetadata[columns[cell].id].focusable === "boolean") {
                return columnMetadata[columns[cell].id].focusable;
            }
            if (columnMetadata && columnMetadata[cell] && typeof columnMetadata[cell].focusable === "boolean") {
                return columnMetadata[cell].focusable;
            }

            if (typeof columns[cell].focusable === "boolean") {
                return columns[cell].focusable;
            }

            return true;
        }

        function canCellBeSelected(row, cell) {
            if (row >= getDataLength() || row < 0 || cell >= columns.length || cell < 0) {
                return false;
            }

            var rowMetadata = data.getItemMetadata && data.getItemMetadata(row);
            if (rowMetadata && typeof rowMetadata.selectable === "boolean") {
                return rowMetadata.selectable;
            }

            var columnMetadata = rowMetadata && rowMetadata.columns && (rowMetadata.columns[columns[cell].id] || rowMetadata.columns[cell]);
            if (columnMetadata && typeof columnMetadata.selectable === "boolean") {
                return columnMetadata.selectable;
            }

            if (typeof columns[cell].selectable === "boolean") {
                return columns[cell].selectable;
            }

            return true;
        }

        function gotoCell(row, cell, forceEdit) {
            if (!canCellBeActive(row, cell)) {
                return;
            }

            if (!getEditorLock().commitCurrentEdit()) { return; }

            scrollRowIntoView(row,false);

            var newCell = getCellNode(row, cell);

            // if selecting the 'add new' row, start editing right away
            setActiveCellInternal(newCell, forceEdit || (row === getDataLength()) || options.autoEdit);

            // if no editor was created, set the focus back on the grid
            if (!currentEditor) {
                setFocus();
            }
        }


        //////////////////////////////////////////////////////////////////////////////////////////////
        // IEditor implementation for the editor lock

        function commitCurrentEdit() {
            var item = getDataItem(activeRow);
            var column = columns[activeCell];

            if (currentEditor) {
                if (currentEditor.isValueChanged()) {
                    var validationResults = currentEditor.validate();

                    if (validationResults.valid) {
                        if (activeRow < getDataLength()) {
                            var editCommand = {
                                row: activeRow,
                                cell: activeCell,
                                editor: currentEditor,
                                serializedValue: currentEditor.serializeValue(),
                                prevSerializedValue: serializedEditorValue,
                                execute: function() {
                                    this.editor.applyValue(item,this.serializedValue);
                                    updateRow(this.row);
                                },
                                undo: function() {
                                    this.editor.applyValue(item,this.prevSerializedValue);
                                    updateRow(this.row);
                                }
                            };

                            if (options.editCommandHandler) {
                                makeActiveCellNormal();
                                options.editCommandHandler(item,column,editCommand);

                            }
                            else {
                                editCommand.execute();
                                makeActiveCellNormal();
                            }

                            trigger(self.onCellChange, {
                                row: activeRow,
                                cell: activeCell,
                                item: item
                            });
                        }
                        else {
                            var newItem = {};
                            currentEditor.applyValue(newItem,currentEditor.serializeValue());
                            makeActiveCellNormal();
                            trigger(self.onAddNewRow, {item:newItem, column:column});
                        }

                        // check whether the lock has been re-acquired by event handlers
                        return !getEditorLock().isActive();
                    }
                    else {
                        // TODO: remove and put in onValidationError handlers in examples
                        $(activeCellNode).addClass("invalid");
                        $(activeCellNode).stop(true,true).effect("highlight", {color:"red"}, 300);

                        trigger(self.onValidationError, {
                            editor: currentEditor,
                            cellNode: activeCellNode,
                            validationResults: validationResults,
                            row: activeRow,
                            cell: activeCell,
                            column: column
                        });

                        currentEditor.focus();
                        return false;
                    }
                }

                makeActiveCellNormal();
            }
            return true;
        }

        function cancelCurrentEdit() {
            makeActiveCellNormal();
            return true;
        }

        function rowsToRanges(rows) {
            var ranges = [];
            var lastCell = columns.length - 1;
            for (var i = 0; i < rows.length; i++) {
                ranges.push(new Slick.Range(rows[i], 0, rows[i], lastCell));
            }
            return ranges;
        }

        function getSelectedRows() {
            if (!selectionModel) {
                throw "Selection model is not set";
            }
            return selectedRows;
        }

        function setSelectedRows(rows) {
            if (!selectionModel) {
                throw "Selection model is not set";
            }
            selectionModel.setSelectedRanges(rowsToRanges(rows));
        }


        //////////////////////////////////////////////////////////////////////////////////////////////
        // Debug

        this.debug = function() {
            var s = "";

            s += ("\n" + "counter_rows_rendered:  " + counter_rows_rendered);
            s += ("\n" + "counter_rows_removed:  " + counter_rows_removed);
            s += ("\n" + "renderedRows:  " + renderedRows);
            s += ("\n" + "numVisibleRows:  " + numVisibleRows);
            s += ("\n" + "maxSupportedCssHeight:  " + maxSupportedCssHeight);
            s += ("\n" + "n(umber of pages):  " + n);
            s += ("\n" + "(current) page:  " + page);
            s += ("\n" + "page height (ph):  " + ph);
            s += ("\n" + "scrollDir:  " + scrollDir);

            alert(s);
        };

        // a debug helper to be able to access private members
        this.eval = function(expr) {
            return eval(expr);
        };

        //////////////////////////////////////////////////////////////////////////////////////////////
        // Public API

        $.extend(this, {
            "slickGridVersion": "2.0a1",

            // Events
            "onScroll":                     new Slick.Event(),
            "onSort":                       new Slick.Event(),
            "onHeaderContextMenu":          new Slick.Event(),
            "onHeaderClick":                new Slick.Event(),
            "onMouseEnter":                 new Slick.Event(),
            "onMouseLeave":                 new Slick.Event(),
            "onClick":                      new Slick.Event(),
            "onDblClick":                   new Slick.Event(),
            "onContextMenu":                new Slick.Event(),
            "onKeyDown":                    new Slick.Event(),
            "onAddNewRow":                  new Slick.Event(),
            "onValidationError":            new Slick.Event(),
            "onViewportChanged":            new Slick.Event(),
            "onColumnsReordered":           new Slick.Event(),
            "onColumnsResized":             new Slick.Event(),
            "onCellChange":                 new Slick.Event(),
            "onBeforeEditCell":             new Slick.Event(),
            "onBeforeCellEditorDestroy":    new Slick.Event(),
            "onBeforeDestroy":              new Slick.Event(),
            "onActiveCellChanged":          new Slick.Event(),
            "onActiveCellPositionChanged":  new Slick.Event(),
            "onDragInit":                   new Slick.Event(),
            "onDragStart":                  new Slick.Event(),
            "onDrag":                       new Slick.Event(),
            "onDragEnd":                    new Slick.Event(),
            "onSelectedRowsChanged":        new Slick.Event(),

            // Methods
            "registerPlugin":               registerPlugin,
            "unregisterPlugin":             unregisterPlugin,
            "getColumns":                   getColumns,
            "setColumns":                   setColumns,
            "getColumnIndex":               getColumnIndex,
            "updateColumnHeader":           updateColumnHeader,
            "setSortColumn":                setSortColumn,
            "autosizeColumns":              autosizeColumns,
            "getOptions":                   getOptions,
            "setOptions":                   setOptions,
            "getData":                      getData,
            "getDataLength":                getDataLength,
            "getDataItem":                  getDataItem,
            "setData":                      setData,
            "getSelectionModel":            getSelectionModel,
            "setSelectionModel":            setSelectionModel,
            "getSelectedRows":              getSelectedRows,
            "setSelectedRows":              setSelectedRows,

            "render":                       render,
            "invalidate":                   invalidate,
            "invalidateRow":                invalidateRow,
            "invalidateRows":               invalidateRows,
            "invalidateAllRows":            invalidateAllRows,
            "updateCell":                   updateCell,
            "updateRow":                    updateRow,
            "getViewport":                  getVisibleRange,
            "resizeCanvas":                 resizeCanvas,
            "updateRowCount":               updateRowCount,
            "scrollRowIntoView":            scrollRowIntoView,
            "getCanvasNode":                getCanvasNode,

            "getCellFromPoint":             getCellFromPoint,
            "getCellFromEvent":             getCellFromEvent,
            "getActiveCell":                getActiveCell,
            "setActiveCell":                setActiveCell,
            "getActiveCellNode":            getActiveCellNode,
            "getActiveCellPosition":        getActiveCellPosition,
            "resetActiveCell":              resetActiveCell,
            "editActiveCell":               makeActiveCellEditable,
            "getCellEditor":                getCellEditor,
            "getCellNode":                  getCellNode,
            "getCellNodeBox":               getCellNodeBox,
            "canCellBeSelected":            canCellBeSelected,
            "canCellBeActive":              canCellBeActive,
            "navigatePrev":                 navigatePrev,
            "navigateNext":                 navigateNext,
            "navigateUp":                   navigateUp,
            "navigateDown":                 navigateDown,
            "navigateLeft":                 navigateLeft,
            "navigateRight":                navigateRight,
            "gotoCell":                     gotoCell,
            "getTopPanel":                  getTopPanel,
            "showTopPanel":                 showTopPanel,
            "hideTopPanel":                 hideTopPanel,
            "showHeaderRowColumns":         showHeaderRowColumns,
            "hideHeaderRowColumns":         hideHeaderRowColumns,
            "getHeaderRow":                 getHeaderRow,
            "getHeaderRowColumn":           getHeaderRowColumn,
            "getGridPosition":              getGridPosition,
            "flashCell":                    flashCell,
            "addCellCssStyles":             addCellCssStyles,
            "setCellCssStyles":             setCellCssStyles,
            "removeCellCssStyles":          removeCellCssStyles,

            "destroy":                      destroy,

            // IEditor implementation
            "getEditorLock":                getEditorLock,
            "getEditController":            getEditController

        });

        init();
    }
}(jQuery));

// D3.JS related
/*
version 3.3.6 from https://github.com/d3/d3.github.com
*/
d3=function(){function n(n){return null!=n&&!isNaN(n)}function t(n){return n.length}function e(n){for(var t=1;n*t%1;)t*=10;return t}function r(n,t){try{for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}catch(r){n.prototype=t}}function u(){}function i(){}function o(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function a(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var e=0,r=Do.length;r>e;++e){var u=Do[e]+t;if(u in n)return u}}function c(){}function l(){}function s(n){function t(){for(var t,r=e,u=-1,i=r.length;++u<i;)(t=r[u].on)&&t.apply(this,arguments);return n}var e=[],r=new u;return t.on=function(t,u){var i,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,e=e.slice(0,i=e.indexOf(o)).concat(e.slice(i+1)),r.remove(t)),u&&e.push(r.set(t,{on:u})),n)},t}function f(){mo.event.preventDefault()}function h(){for(var n,t=mo.event;n=t.sourceEvent;)t=n;return t}function g(n){for(var t=new l,e=0,r=arguments.length;++e<r;)t[arguments[e]]=s(t);return t.of=function(e,r){return function(u){try{var i=u.sourceEvent=mo.event;u.target=n,mo.event=u,t[u.type].apply(e,r)}finally{mo.event=i}}},t}function p(n){return Lo(n,Ro),n}function d(n){return"function"==typeof n?n:function(){return Ho(n,this)}}function v(n){return"function"==typeof n?n:function(){return Fo(n,this)}}function m(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function u(){this.setAttribute(n,t)}function i(){this.setAttributeNS(n.space,n.local,t)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=mo.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?a:o:n.local?i:u}function y(n){return n.trim().replace(/\s+/g," ")}function M(n){return new RegExp("(?:^|\\s+)"+mo.requote(n)+"(?:\\s+|$)","g")}function x(n,t){function e(){for(var e=-1;++e<u;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<u;)n[e](this,r)}n=n.trim().split(/\s+/).map(b);var u=n.length;return"function"==typeof t?r:e}function b(n){var t=M(n);return function(e,r){if(u=e.classList)return r?u.add(n):u.remove(n);var u=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(u)||e.setAttribute("class",y(u+" "+n))):e.setAttribute("class",y(u.replace(t," ")))}}function _(n,t,e){function r(){this.style.removeProperty(n)}function u(){this.style.setProperty(n,t,e)}function i(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?i:u}function w(n,t){function e(){delete this[n]}function r(){this[n]=t}function u(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?u:r}function S(n){return"function"==typeof n?n:(n=mo.ns.qualify(n)).local?function(){return xo.createElementNS(n.space,n.local)}:function(){return xo.createElementNS(this.namespaceURI,n)}}function E(n){return{__data__:n}}function k(n){return function(){return Oo(this,n)}}function A(n){return arguments.length||(n=mo.ascending),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}function N(n,t){for(var e=0,r=n.length;r>e;e++)for(var u,i=n[e],o=0,a=i.length;a>o;o++)(u=i[o])&&t(u,o,e);return n}function T(n){return Lo(n,Io),n}function q(n){var t,e;return function(r,u,i){var o,a=n[i].update,c=a.length;for(i!=e&&(e=i,t=0),u>=t&&(t=u+1);!(o=a[t])&&++t<c;);return o}}function z(){var n=this.__transition__;n&&++n.active}function C(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}function u(){var u=l(t,Mo(arguments));r.call(this),this.addEventListener(n,this[o]=u,u.$=e),u._=t}function i(){var t,e=new RegExp("^__on([^.]+)"+mo.requote(n)+"$");for(var r in this)if(t=r.match(e)){var u=this[r];this.removeEventListener(t[1],u,u.$),delete this[r]}}var o="__on"+n,a=n.indexOf("."),l=D;a>0&&(n=n.substring(0,a));var s=Zo.get(n);return s&&(n=s,l=j),a?t?u:r:t?c:i}function D(n,t){return function(e){var r=mo.event;mo.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{mo.event=r}}}function j(n,t){var e=D(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function L(){var n=".dragsuppress-"+ ++Xo,t="touchmove"+n,e="selectstart"+n,r="dragstart"+n,u="click"+n,i=mo.select(_o).on(t,f).on(e,f).on(r,f),o=bo.style,a=o[Vo];return o[Vo]="none",function(t){function e(){i.on(u,null)}i.on(n,null),o[Vo]=a,t&&(i.on(u,function(){f(),e()},!0),setTimeout(e,0))}}function H(n,t){t.changedTouches&&(t=t.changedTouches[0]);var e=n.ownerSVGElement||n;if(e.createSVGPoint){var r=e.createSVGPoint();if(0>$o&&(_o.scrollX||_o.scrollY)){e=mo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var u=e[0][0].getScreenCTM();$o=!(u.f||u.e),e.remove()}return $o?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(n.getScreenCTM().inverse()),[r.x,r.y]}var i=n.getBoundingClientRect();return[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop]}function F(n){return n>0?1:0>n?-1:0}function P(n){return n>1?0:-1>n?Bo:Math.acos(n)}function O(n){return n>1?Jo:-1>n?-Jo:Math.asin(n)}function R(n){return((n=Math.exp(n))-1/n)/2}function Y(n){return((n=Math.exp(n))+1/n)/2}function I(n){return((n=Math.exp(2*n))-1)/(n+1)}function U(n){return(n=Math.sin(n/2))*n}function Z(){}function V(n,t,e){return new X(n,t,e)}function X(n,t,e){this.h=n,this.s=t,this.l=e}function $(n,t,e){function r(n){return n>360?n-=360:0>n&&(n+=360),60>n?i+(o-i)*n/60:180>n?o:240>n?i+(o-i)*(240-n)/60:i}function u(n){return Math.round(255*r(n))}var i,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,o=.5>=e?e*(1+t):e+t-e*t,i=2*e-o,ot(u(n+120),u(n),u(n-120))}function B(n,t,e){return new W(n,t,e)}function W(n,t,e){this.h=n,this.c=t,this.l=e}function J(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),G(e,Math.cos(n*=Qo)*t,Math.sin(n)*t)}function G(n,t,e){return new K(n,t,e)}function K(n,t,e){this.l=n,this.a=t,this.b=e}function Q(n,t,e){var r=(n+16)/116,u=r+t/500,i=r-e/200;return u=tt(u)*sa,r=tt(r)*fa,i=tt(i)*ha,ot(rt(3.2404542*u-1.5371385*r-.4985314*i),rt(-.969266*u+1.8760108*r+.041556*i),rt(.0556434*u-.2040259*r+1.0572252*i))}function nt(n,t,e){return n>0?B(Math.atan2(e,t)*na,Math.sqrt(t*t+e*e),n):B(0/0,0/0,n)}function tt(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function et(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function rt(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function ut(n){return ot(n>>16,255&n>>8,255&n)}function it(n){return ut(n)+""}function ot(n,t,e){return new at(n,t,e)}function at(n,t,e){this.r=n,this.g=t,this.b=e}function ct(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function lt(n,t,e){var r,u,i,o=0,a=0,c=0;if(r=/([a-z]+)\((.*)\)/i.exec(n))switch(u=r[2].split(","),r[1]){case"hsl":return e(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(gt(u[0]),gt(u[1]),gt(u[2]))}return(i=da.get(n))?t(i.r,i.g,i.b):(null!=n&&"#"===n.charAt(0)&&(4===n.length?(o=n.charAt(1),o+=o,a=n.charAt(2),a+=a,c=n.charAt(3),c+=c):7===n.length&&(o=n.substring(1,3),a=n.substring(3,5),c=n.substring(5,7)),o=parseInt(o,16),a=parseInt(a,16),c=parseInt(c,16)),t(o,a,c))}function st(n,t,e){var r,u,i=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-i,c=(o+i)/2;return a?(u=.5>c?a/(o+i):a/(2-o-i),r=n==o?(t-e)/a+(e>t?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=0/0,u=c>0&&1>c?0:r),V(r,u,c)}function ft(n,t,e){n=ht(n),t=ht(t),e=ht(e);var r=et((.4124564*n+.3575761*t+.1804375*e)/sa),u=et((.2126729*n+.7151522*t+.072175*e)/fa),i=et((.0193339*n+.119192*t+.9503041*e)/ha);return G(116*u-16,500*(r-u),200*(u-i))}function ht(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function gt(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function pt(n){return"function"==typeof n?n:function(){return n}}function dt(n){return n}function vt(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),mt(t,e,n,r)}}function mt(n,t,e,r){function u(){var n,t=c.status;if(!t&&c.responseText||t>=200&&300>t||304===t){try{n=e.call(i,c)}catch(r){return o.error.call(i,r),void 0}o.load.call(i,n)}else o.error.call(i,c)}var i={},o=mo.dispatch("beforesend","progress","load","error"),a={},c=new XMLHttpRequest,l=null;return!_o.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(n)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=u:c.onreadystatechange=function(){c.readyState>3&&u()},c.onprogress=function(n){var t=mo.event;mo.event=n;try{o.progress.call(i,c)}finally{mo.event=t}},i.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",i)},i.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",i):t},i.responseType=function(n){return arguments.length?(l=n,i):l},i.response=function(n){return e=n,i},["get","post"].forEach(function(n){i[n]=function(){return i.send.apply(i,[n].concat(Mo(arguments)))}}),i.send=function(e,r,u){if(2===arguments.length&&"function"==typeof r&&(u=r,r=null),c.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),c.setRequestHeader)for(var s in a)c.setRequestHeader(s,a[s]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=l&&(c.responseType=l),null!=u&&i.on("error",u).on("load",function(n){u(null,n)}),o.beforesend.call(i,c),c.send(null==r?null:r),i},i.abort=function(){return c.abort(),i},mo.rebind(i,o,"on"),null==r?i:i.get(yt(r))}function yt(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function Mt(){var n=bt(),t=_t()-n;t>24?(isFinite(t)&&(clearTimeout(Ma),Ma=setTimeout(Mt,t)),ya=0):(ya=1,ba(Mt))}function xt(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now()),xa.callback=n,xa.time=e+t}function bt(){var n=Date.now();for(xa=va;xa;)n>=xa.time&&(xa.flush=xa.callback(n-xa.time)),xa=xa.next;return n}function _t(){for(var n,t=va,e=1/0;t;)t.flush?t=n?n.next=t.next:va=t.next:(t.time<e&&(e=t.time),t=(n=t).next);return ma=n,e}function wt(n,t){var e=Math.pow(10,3*Math.abs(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function St(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Et(n){return n+""}function kt(){}function At(n,t,e){var r=e.s=n+t,u=r-n,i=r-u;e.t=n-i+(t-u)}function Nt(n,t){n&&Da.hasOwnProperty(n.type)&&Da[n.type](n,t)}function Tt(n,t,e){var r,u=-1,i=n.length-e;for(t.lineStart();++u<i;)r=n[u],t.point(r[0],r[1],r[2]);t.lineEnd()}function qt(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)Tt(n[e],t,1);t.polygonEnd()}function zt(){function n(n,t){n*=Qo,t=t*Qo/2+Bo/4;var e=n-r,o=Math.cos(t),a=Math.sin(t),c=i*a,l=u*o+c*Math.cos(e),s=c*Math.sin(e);La.add(Math.atan2(s,l)),r=n,u=o,i=a}var t,e,r,u,i;Ha.point=function(o,a){Ha.point=n,r=(t=o)*Qo,u=Math.cos(a=(e=a)*Qo/2+Bo/4),i=Math.sin(a)},Ha.lineEnd=function(){n(t,e)}}function Ct(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function Dt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function jt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Lt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Ht(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Ft(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Pt(n){return[Math.atan2(n[1],n[0]),O(n[2])]}function Ot(n,t){return Math.abs(n[0]-t[0])<Go&&Math.abs(n[1]-t[1])<Go}function Rt(n,t){n*=Qo;var e=Math.cos(t*=Qo);Yt(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function Yt(n,t,e){++Fa,Oa+=(n-Oa)/Fa,Ra+=(t-Ra)/Fa,Ya+=(e-Ya)/Fa}function It(){function n(n,u){n*=Qo;var i=Math.cos(u*=Qo),o=i*Math.cos(n),a=i*Math.sin(n),c=Math.sin(u),l=Math.atan2(Math.sqrt((l=e*c-r*a)*l+(l=r*o-t*c)*l+(l=t*a-e*o)*l),t*o+e*a+r*c);Pa+=l,Ia+=l*(t+(t=o)),Ua+=l*(e+(e=a)),Za+=l*(r+(r=c)),Yt(t,e,r)}var t,e,r;Ba.point=function(u,i){u*=Qo;var o=Math.cos(i*=Qo);t=o*Math.cos(u),e=o*Math.sin(u),r=Math.sin(i),Ba.point=n,Yt(t,e,r)}}function Ut(){Ba.point=Rt}function Zt(){function n(n,t){n*=Qo;var e=Math.cos(t*=Qo),o=e*Math.cos(n),a=e*Math.sin(n),c=Math.sin(t),l=u*c-i*a,s=i*o-r*c,f=r*a-u*o,h=Math.sqrt(l*l+s*s+f*f),g=r*o+u*a+i*c,p=h&&-P(g)/h,d=Math.atan2(h,g);Va+=p*l,Xa+=p*s,$a+=p*f,Pa+=d,Ia+=d*(r+(r=o)),Ua+=d*(u+(u=a)),Za+=d*(i+(i=c)),Yt(r,u,i)}var t,e,r,u,i;Ba.point=function(o,a){t=o,e=a,Ba.point=n,o*=Qo;var c=Math.cos(a*=Qo);r=c*Math.cos(o),u=c*Math.sin(o),i=Math.sin(a),Yt(r,u,i)},Ba.lineEnd=function(){n(t,e),Ba.lineEnd=Ut,Ba.point=Rt}}function Vt(){return!0}function Xt(n,t,e,r,u){var i=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(Ot(e,r)){u.lineStart();for(var a=0;t>a;++a)u.point((e=n[a])[0],e[1]);return u.lineEnd(),void 0}var c={point:e,points:n,other:null,visited:!1,entry:!0,subject:!0},l={point:e,points:[e],other:c,visited:!1,entry:!1,subject:!1};c.other=l,i.push(c),o.push(l),c={point:r,points:[r],other:null,visited:!1,entry:!1,subject:!0},l={point:r,points:[r],other:c,visited:!1,entry:!0,subject:!1},c.other=l,i.push(c),o.push(l)}}),o.sort(t),$t(i),$t(o),i.length){for(var a=0,c=e,l=o.length;l>a;++a)o[a].entry=c=!c;for(var s,f,h,g=i[0];;){for(s=g;s.visited;)if((s=s.next)===g)return;f=s.points,u.lineStart();do{if(s.visited=s.other.visited=!0,s.entry){if(s.subject)for(var a=0;a<f.length;a++)u.point((h=f[a])[0],h[1]);else r(s.point,s.next.point,1,u);s=s.next}else{if(s.subject){f=s.prev.points;for(var a=f.length;--a>=0;)u.point((h=f[a])[0],h[1])}else r(s.point,s.prev.point,-1,u);s=s.prev}s=s.other,f=s.points}while(!s.visited);u.lineEnd()}}}function $t(n){if(t=n.length){for(var t,e,r=0,u=n[0];++r<t;)u.next=e=n[r],e.prev=u,u=e;u.next=e=n[0],e.prev=u}}function Bt(n,t,e,r){return function(u,i){function o(t,e){var r=u(t,e);n(t=r[0],e=r[1])&&i.point(t,e)}function a(n,t){var e=u(n,t);v.point(e[0],e[1])}function c(){y.point=a,v.lineStart()}function l(){y.point=o,v.lineEnd()}function s(n,t){d.push([n,t]);var e=u(n,t);x.point(e[0],e[1])}function f(){x.lineStart(),d=[]}function h(){s(d[0][0],d[0][1]),x.lineEnd();var n,t=x.clean(),e=M.buffer(),r=e.length;if(d.pop(),p.push(d),d=null,r){if(1&t){n=e[0];var u,r=n.length-1,o=-1;for(i.lineStart();++o<r;)i.point((u=n[o])[0],u[1]);return i.lineEnd(),void 0}r>1&&2&t&&e.push(e.pop().concat(e.shift())),g.push(e.filter(Wt))}}var g,p,d,v=t(i),m=u.invert(r[0],r[1]),y={point:o,lineStart:c,lineEnd:l,polygonStart:function(){y.point=s,y.lineStart=f,y.lineEnd=h,g=[],p=[],i.polygonStart()},polygonEnd:function(){y.point=o,y.lineStart=c,y.lineEnd=l,g=mo.merge(g);var n=Kt(m,p);g.length?Xt(g,Gt,n,e,i):n&&(i.lineStart(),e(null,null,1,i),i.lineEnd()),i.polygonEnd(),g=p=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}},M=Jt(),x=t(M);return y}}function Wt(n){return n.length>1}function Jt(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:c,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Gt(n,t){return((n=n.point)[0]<0?n[1]-Jo-Go:Jo-n[1])-((t=t.point)[0]<0?t[1]-Jo-Go:Jo-t[1])}function Kt(n,t){var e=n[0],r=n[1],u=[Math.sin(e),-Math.cos(e),0],i=0,o=0;La.reset();for(var a=0,c=t.length;c>a;++a){var l=t[a],s=l.length;if(s)for(var f=l[0],h=f[0],g=f[1]/2+Bo/4,p=Math.sin(g),d=Math.cos(g),v=1;;){v===s&&(v=0),n=l[v];var m=n[0],y=n[1]/2+Bo/4,M=Math.sin(y),x=Math.cos(y),b=m-h,_=Math.abs(b)>Bo,w=p*M;if(La.add(Math.atan2(w*Math.sin(b),d*x+w*Math.cos(b))),i+=_?b+(b>=0?2:-2)*Bo:b,_^h>=e^m>=e){var S=jt(Ct(f),Ct(n));Ft(S);var E=jt(u,S);Ft(E);var k=(_^b>=0?-1:1)*O(E[2]);(r>k||r===k&&(S[0]||S[1]))&&(o+=_^b>=0?1:-1)}if(!v++)break;h=m,p=M,d=x,f=n}}return(-Go>i||Go>i&&0>La)^1&o}function Qt(n){var t,e=0/0,r=0/0,u=0/0;return{lineStart:function(){n.lineStart(),t=1},point:function(i,o){var a=i>0?Bo:-Bo,c=Math.abs(i-e);Math.abs(c-Bo)<Go?(n.point(e,r=(r+o)/2>0?Jo:-Jo),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(i,r),t=0):u!==a&&c>=Bo&&(Math.abs(e-u)<Go&&(e-=u*Go),Math.abs(i-a)<Go&&(i-=a*Go),r=ne(e,r,i,o),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=i,r=o),u=a},lineEnd:function(){n.lineEnd(),e=r=0/0},clean:function(){return 2-t}}}function ne(n,t,e,r){var u,i,o=Math.sin(n-e);return Math.abs(o)>Go?Math.atan((Math.sin(t)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(u=Math.cos(t))*Math.sin(n))/(u*i*o)):(t+r)/2}function te(n,t,e,r){var u;if(null==n)u=e*Jo,r.point(-Bo,u),r.point(0,u),r.point(Bo,u),r.point(Bo,0),r.point(Bo,-u),r.point(0,-u),r.point(-Bo,-u),r.point(-Bo,0),r.point(-Bo,u);else if(Math.abs(n[0]-t[0])>Go){var i=(n[0]<t[0]?1:-1)*Bo;u=e*i/2,r.point(-i,u),r.point(0,u),r.point(i,u)}else r.point(t[0],t[1])}function ee(n){function t(n,t){return Math.cos(n)*Math.cos(t)>i}function e(n){var e,i,c,l,s;return{lineStart:function(){l=c=!1,s=1},point:function(f,h){var g,p=[f,h],d=t(f,h),v=o?d?0:u(f,h):d?u(f+(0>f?Bo:-Bo),h):0;if(!e&&(l=c=d)&&n.lineStart(),d!==c&&(g=r(e,p),(Ot(e,g)||Ot(p,g))&&(p[0]+=Go,p[1]+=Go,d=t(p[0],p[1]))),d!==c)s=0,d?(n.lineStart(),g=r(p,e),n.point(g[0],g[1])):(g=r(e,p),n.point(g[0],g[1]),n.lineEnd()),e=g;else if(a&&e&&o^d){var m;v&i||!(m=r(p,e,!0))||(s=0,o?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1])))}!d||e&&Ot(e,p)||n.point(p[0],p[1]),e=p,c=d,i=v},lineEnd:function(){c&&n.lineEnd(),e=null},clean:function(){return s|(l&&c)<<1}}}function r(n,t,e){var r=Ct(n),u=Ct(t),o=[1,0,0],a=jt(r,u),c=Dt(a,a),l=a[0],s=c-l*l;if(!s)return!e&&n;var f=i*c/s,h=-i*l/s,g=jt(o,a),p=Ht(o,f),d=Ht(a,h);Lt(p,d);var v=g,m=Dt(p,v),y=Dt(v,v),M=m*m-y*(Dt(p,p)-1);if(!(0>M)){var x=Math.sqrt(M),b=Ht(v,(-m-x)/y);if(Lt(b,p),b=Pt(b),!e)return b;var _,w=n[0],S=t[0],E=n[1],k=t[1];w>S&&(_=w,w=S,S=_);var A=S-w,N=Math.abs(A-Bo)<Go,T=N||Go>A;if(!N&&E>k&&(_=E,E=k,k=_),T?N?E+k>0^b[1]<(Math.abs(b[0]-w)<Go?E:k):E<=b[1]&&b[1]<=k:A>Bo^(w<=b[0]&&b[0]<=S)){var q=Ht(v,(-m+x)/y);return Lt(q,p),[b,Pt(q)]}}}function u(t,e){var r=o?n:Bo-n,u=0;return-r>t?u|=1:t>r&&(u|=2),-r>e?u|=4:e>r&&(u|=8),u}var i=Math.cos(n),o=i>0,a=Math.abs(i)>Go,c=Te(n,6*Qo);return Bt(t,e,c,o?[0,-n]:[-Bo,n-Bo])}function re(n,t,e,r){function u(r,u){return Math.abs(r[0]-n)<Go?u>0?0:3:Math.abs(r[0]-e)<Go?u>0?2:1:Math.abs(r[1]-t)<Go?u>0?1:0:u>0?3:2}function i(n,t){return o(n.point,t.point)}function o(n,t){var e=u(n,1),r=u(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}function a(u,i){var o=i[0]-u[0],a=i[1]-u[1],c=[0,1];return Math.abs(o)<Go&&Math.abs(a)<Go?n<=u[0]&&u[0]<=e&&t<=u[1]&&u[1]<=r:ue(n-u[0],o,c)&&ue(u[0]-e,-o,c)&&ue(t-u[1],a,c)&&ue(u[1]-r,-a,c)?(c[1]<1&&(i[0]=u[0]+c[1]*o,i[1]=u[1]+c[1]*a),c[0]>0&&(u[0]+=c[0]*o,u[1]+=c[0]*a),!0):!1}return function(c){function l(n){for(var t=0,e=y.length,r=n[1],u=0;e>u;++u)for(var i,o=1,a=y[u],c=a.length,l=a[0];c>o;++o)i=a[o],l[1]<=r?i[1]>r&&s(l,i,n)>0&&++t:i[1]<=r&&s(l,i,n)<0&&--t,l=i;return 0!==t}function s(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1])}function f(i,a,c,l){var s=0,f=0;if(null==i||(s=u(i,c))!==(f=u(a,c))||o(i,a)<0^c>0){do l.point(0===s||3===s?n:e,s>1?r:t);while((s=(s+c+4)%4)!==f)}else l.point(a[0],a[1])}function h(u,i){return u>=n&&e>=u&&i>=t&&r>=i}function g(n,t){h(n,t)&&c.point(n,t)}function p(){q.point=v,y&&y.push(M=[]),k=!0,E=!1,w=S=0/0}function d(){m&&(v(x,b),_&&E&&T.rejoin(),m.push(T.buffer())),q.point=g,E&&c.lineEnd()}function v(n,t){n=Math.max(-Ja,Math.min(Ja,n)),t=Math.max(-Ja,Math.min(Ja,t));var e=h(n,t);if(y&&M.push([n,t]),k)x=n,b=t,_=e,k=!1,e&&(c.lineStart(),c.point(n,t));else if(e&&E)c.point(n,t);else{var r=[w,S],u=[n,t];a(r,u)?(E||(c.lineStart(),c.point(r[0],r[1])),c.point(u[0],u[1]),e||c.lineEnd(),A=!1):e&&(c.lineStart(),c.point(n,t),A=!1)}w=n,S=t,E=e}var m,y,M,x,b,_,w,S,E,k,A,N=c,T=Jt(),q={point:g,lineStart:p,lineEnd:d,polygonStart:function(){c=T,m=[],y=[],A=!0},polygonEnd:function(){c=N,m=mo.merge(m);var t=l([n,r]),e=A&&t,u=m.length;(e||u)&&(c.polygonStart(),e&&(c.lineStart(),f(null,null,1,c),c.lineEnd()),u&&Xt(m,i,t,f,c),c.polygonEnd()),m=y=M=null}};return q}}function ue(n,t,e){if(Math.abs(t)<Go)return 0>=n;var r=n/t;if(t>0){if(r>e[1])return!1;r>e[0]&&(e[0]=r)}else{if(r<e[0])return!1;r<e[1]&&(e[1]=r)}return!0}function ie(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function oe(n){var t=0,e=Bo/3,r=be(n),u=r(t,e);return u.parallels=function(n){return arguments.length?r(t=n[0]*Bo/180,e=n[1]*Bo/180):[180*(t/Bo),180*(e/Bo)]},u}function ae(n,t){function e(n,t){var e=Math.sqrt(i-2*u*Math.sin(t))/u;return[e*Math.sin(n*=u),o-e*Math.cos(n)]}var r=Math.sin(n),u=(r+Math.sin(t))/2,i=1+r*(2*u-r),o=Math.sqrt(i)/u;return e.invert=function(n,t){var e=o-t;return[Math.atan2(n,e)/u,O((i-(n*n+e*e)*u*u)/(2*u))]},e}function ce(){function n(n,t){Ka+=u*n-r*t,r=n,u=t}var t,e,r,u;rc.point=function(i,o){rc.point=n,t=r=i,e=u=o},rc.lineEnd=function(){n(t,e)}}function le(n,t){Qa>n&&(Qa=n),n>tc&&(tc=n),nc>t&&(nc=t),t>ec&&(ec=t)}function se(){function n(n,t){o.push("M",n,",",t,i)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function u(){o.push("Z")}var i=fe(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return i=fe(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function fe(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function he(n,t){Oa+=n,Ra+=t,++Ya}function ge(){function n(n,r){var u=n-t,i=r-e,o=Math.sqrt(u*u+i*i);Ia+=o*(t+n)/2,Ua+=o*(e+r)/2,Za+=o,he(t=n,e=r)}var t,e;ic.point=function(r,u){ic.point=n,he(t=r,e=u)}}function pe(){ic.point=he}function de(){function n(n,t){var e=n-r,i=t-u,o=Math.sqrt(e*e+i*i);Ia+=o*(r+n)/2,Ua+=o*(u+t)/2,Za+=o,o=u*n-r*t,Va+=o*(r+n),Xa+=o*(u+t),$a+=3*o,he(r=n,u=t)}var t,e,r,u;ic.point=function(i,o){ic.point=n,he(t=r=i,e=u=o)},ic.lineEnd=function(){n(t,e)}}function ve(n){function t(t,e){n.moveTo(t,e),n.arc(t,e,o,0,Wo)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function u(){a.point=t}function i(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:u,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=u,a.point=t},pointRadius:function(n){return o=n,a},result:c};return a}function me(n){function t(t){function r(e,r){e=n(e,r),t.point(e[0],e[1])}function u(){M=0/0,S.point=o,t.lineStart()}function o(r,u){var o=Ct([r,u]),a=n(r,u);e(M,x,y,b,_,w,M=a[0],x=a[1],y=r,b=o[0],_=o[1],w=o[2],i,t),t.point(M,x)}function a(){S.point=r,t.lineEnd()}function c(){u(),S.point=l,S.lineEnd=s}function l(n,t){o(f=n,h=t),g=M,p=x,d=b,v=_,m=w,S.point=o}function s(){e(M,x,y,b,_,w,g,p,f,d,v,m,i,t),S.lineEnd=a,a()}var f,h,g,p,d,v,m,y,M,x,b,_,w,S={point:r,lineStart:u,lineEnd:a,polygonStart:function(){t.polygonStart(),S.lineStart=c},polygonEnd:function(){t.polygonEnd(),S.lineStart=u}};return S}function e(t,i,o,a,c,l,s,f,h,g,p,d,v,m){var y=s-t,M=f-i,x=y*y+M*M;if(x>4*r&&v--){var b=a+g,_=c+p,w=l+d,S=Math.sqrt(b*b+_*_+w*w),E=Math.asin(w/=S),k=Math.abs(Math.abs(w)-1)<Go?(o+h)/2:Math.atan2(_,b),A=n(k,E),N=A[0],T=A[1],q=N-t,z=T-i,C=M*q-y*z;(C*C/x>r||Math.abs((y*q+M*z)/x-.5)>.3||u>a*g+c*p+l*d)&&(e(t,i,o,a,c,l,N,T,k,b/=S,_/=S,w,v,m),m.point(N,T),e(N,T,k,b,_,w,s,f,h,g,p,d,v,m))}}var r=.5,u=Math.cos(30*Qo),i=16;return t.precision=function(n){return arguments.length?(i=(r=n*n)>0&&16,t):Math.sqrt(r)},t}function ye(n){this.stream=n}function Me(n){var t=me(function(t,e){return n([t*na,e*na])});return function(n){var e=new ye(n=t(n));return e.point=function(t,e){n.point(t*Qo,e*Qo)},e}}function xe(n){return be(function(){return n})()}function be(n){function t(n){return n=a(n[0]*Qo,n[1]*Qo),[n[0]*h+c,l-n[1]*h]}function e(n){return n=a.invert((n[0]-c)/h,(l-n[1])/h),n&&[n[0]*na,n[1]*na]}function r(){a=ie(o=Ee(m,y,M),i);var n=i(d,v);return c=g-n[0]*h,l=p+n[1]*h,u()}function u(){return s&&(s.valid=!1,s=null),t}var i,o,a,c,l,s,f=me(function(n,t){return n=i(n,t),[n[0]*h+c,l-n[1]*h]}),h=150,g=480,p=250,d=0,v=0,m=0,y=0,M=0,x=Wa,b=dt,_=null,w=null;return t.stream=function(n){return s&&(s.valid=!1),s=_e(x(o,f(b(n)))),s.valid=!0,s},t.clipAngle=function(n){return arguments.length?(x=null==n?(_=n,Wa):ee((_=+n)*Qo),u()):_},t.clipExtent=function(n){return arguments.length?(w=n,b=n?re(n[0][0],n[0][1],n[1][0],n[1][1]):dt,u()):w},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(g=+n[0],p=+n[1],r()):[g,p]},t.center=function(n){return arguments.length?(d=n[0]%360*Qo,v=n[1]%360*Qo,r()):[d*na,v*na]},t.rotate=function(n){return arguments.length?(m=n[0]%360*Qo,y=n[1]%360*Qo,M=n.length>2?n[2]%360*Qo:0,r()):[m*na,y*na,M*na]},mo.rebind(t,f,"precision"),function(){return i=n.apply(this,arguments),t.invert=i.invert&&e,r()}}function _e(n){var t=new ye(n);return t.point=function(t,e){n.point(t*Qo,e*Qo)},t}function we(n,t){return[n,t]}function Se(n,t){return[n>Bo?n-Wo:-Bo>n?n+Wo:n,t]}function Ee(n,t,e){return n?t||e?ie(Ae(n),Ne(t,e)):Ae(n):t||e?Ne(t,e):Se}function ke(n){return function(t,e){return t+=n,[t>Bo?t-Wo:-Bo>t?t+Wo:t,e]}}function Ae(n){var t=ke(n);return t.invert=ke(-n),t}function Ne(n,t){function e(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*r+a*u;return[Math.atan2(c*i-s*o,a*r-l*u),O(s*i+c*o)]}var r=Math.cos(n),u=Math.sin(n),i=Math.cos(t),o=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*i-c*o;return[Math.atan2(c*i+l*o,a*r+s*u),O(s*r-a*u)]},e}function Te(n,t){var e=Math.cos(n),r=Math.sin(n);return function(u,i,o,a){var c=o*t;null!=u?(u=qe(e,u),i=qe(e,i),(o>0?i>u:u>i)&&(u+=o*Wo)):(u=n+o*Wo,i=n-.5*c);for(var l,s=u;o>0?s>i:i>s;s-=c)a.point((l=Pt([e,-r*Math.cos(s),-r*Math.sin(s)]))[0],l[1])}}function qe(n,t){var e=Ct(t);e[0]-=n,Ft(e);var r=P(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Go)%(2*Math.PI)}function ze(n,t,e){var r=mo.range(n,t-Go,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function Ce(n,t,e){var r=mo.range(n,t-Go,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function De(n){return n.source}function je(n){return n.target}function Le(n,t,e,r){var u=Math.cos(t),i=Math.sin(t),o=Math.cos(r),a=Math.sin(r),c=u*Math.cos(n),l=u*Math.sin(n),s=o*Math.cos(e),f=o*Math.sin(e),h=2*Math.asin(Math.sqrt(U(r-t)+u*o*U(e-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,e=Math.sin(h-n)*g,r=e*c+t*s,u=e*l+t*f,o=e*i+t*a;return[Math.atan2(u,r)*na,Math.atan2(o,Math.sqrt(r*r+u*u))*na]}:function(){return[n*na,t*na]};return p.distance=h,p}function He(){function n(n,u){var i=Math.sin(u*=Qo),o=Math.cos(u),a=Math.abs((n*=Qo)-t),c=Math.cos(a);oc+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=r*i-e*o*c)*a),e*i+r*o*c),t=n,e=i,r=o}var t,e,r;ac.point=function(u,i){t=u*Qo,e=Math.sin(i*=Qo),r=Math.cos(i),ac.point=n},ac.lineEnd=function(){ac.point=ac.lineEnd=c}}function Fe(n,t){function e(t,e){var r=Math.cos(t),u=Math.cos(e),i=n(r*u);return[i*u*Math.sin(t),i*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),u=t(r),i=Math.sin(u),o=Math.cos(u);return[Math.atan2(n*i,r*o),Math.asin(r&&e*i/r)]},e}function Pe(n,t){function e(n,t){var e=Math.abs(Math.abs(t)-Jo)<Go?0:o/Math.pow(u(t),i);return[e*Math.sin(i*n),o-e*Math.cos(i*n)]}var r=Math.cos(n),u=function(n){return Math.tan(Bo/4+n/2)},i=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(u(t)/u(n)),o=r*Math.pow(u(n),i)/i;return i?(e.invert=function(n,t){var e=o-t,r=F(i)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/i,2*Math.atan(Math.pow(o/r,1/i))-Jo]},e):Re}function Oe(n,t){function e(n,t){var e=i-t;return[e*Math.sin(u*n),i-e*Math.cos(u*n)]}var r=Math.cos(n),u=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),i=r/u+n;return Math.abs(u)<Go?we:(e.invert=function(n,t){var e=i-t;return[Math.atan2(n,e)/u,i-F(u)*Math.sqrt(n*n+e*e)]},e)}function Re(n,t){return[n,Math.log(Math.tan(Bo/4+t/2))]}function Ye(n){var t,e=xe(n),r=e.scale,u=e.translate,i=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=u.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var o=i.apply(e,arguments);if(o===e){if(t=null==n){var a=Bo*r(),c=u();i([[c[0]-a,c[1]-a],[c[0]+a,c[1]+a]])}}else t&&(o=null);return o},e.clipExtent(null)}function Ie(n,t){var e=Math.cos(t)*Math.sin(n);return[Math.log((1+e)/(1-e))/2,Math.atan2(Math.tan(t),Math.cos(n))]}function Ue(n){function t(t){function o(){l.push("M",i(n(s),a))}for(var c,l=[],s=[],f=-1,h=t.length,g=pt(e),p=pt(r);++f<h;)u.call(this,c=t[f],f)?s.push([+g.call(this,c,f),+p.call(this,c,f)]):s.length&&(o(),s=[]);return s.length&&o(),l.length?l.join(""):null}var e=Ze,r=Ve,u=Vt,i=Xe,o=i.key,a=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(u=n,t):u},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?i=n:(i=gc.get(n)||Xe).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function Ze(n){return n[0]}function Ve(n){return n[1]}function Xe(n){return n.join("L")}function $e(n){return Xe(n)+"Z"}function Be(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return e>1&&u.push("H",r[0]),u.join("")}function We(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("V",(r=n[t])[1],"H",r[0]);return u.join("")}function Je(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r=n[t])[0],"V",r[1]);return u.join("")}function Ge(n,t){return n.length<4?Xe(n):n[1]+nr(n.slice(1,n.length-1),tr(n,t))}function Ke(n,t){return n.length<3?Xe(n):n[0]+nr((n.push(n[0]),n),tr([n[n.length-2]].concat(n,[n[1]]),t))}function Qe(n,t){return n.length<3?Xe(n):n[0]+nr(n,tr(n,t))}function nr(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return Xe(n);var e=n.length!=t.length,r="",u=n[0],i=n[1],o=t[0],a=o,c=1;if(e&&(r+="Q"+(i[0]-2*o[0]/3)+","+(i[1]-2*o[1]/3)+","+i[0]+","+i[1],u=n[1],c=2),t.length>1){a=t[1],i=n[c],c++,r+="C"+(u[0]+o[0])+","+(u[1]+o[1])+","+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1];for(var l=2;l<t.length;l++,c++)i=n[c],a=t[l],r+="S"+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1]}if(e){var s=n[c];r+="Q"+(i[0]+2*a[0]/3)+","+(i[1]+2*a[1]/3)+","+s[0]+","+s[1]}return r}function tr(n,t){for(var e,r=[],u=(1-t)/2,i=n[0],o=n[1],a=1,c=n.length;++a<c;)e=i,i=o,o=n[a],r.push([u*(o[0]-e[0]),u*(o[1]-e[1])]);return r}function er(n){if(n.length<3)return Xe(n);var t=1,e=n.length,r=n[0],u=r[0],i=r[1],o=[u,u,u,(r=n[1])[0]],a=[i,i,i,r[1]],c=[u,",",i,"L",or(vc,o),",",or(vc,a)];for(n.push(n[e-1]);++t<=e;)r=n[t],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),ar(c,o,a);return n.pop(),c.push("L",r),c.join("")}function rr(n){if(n.length<4)return Xe(n);for(var t,e=[],r=-1,u=n.length,i=[0],o=[0];++r<3;)t=n[r],i.push(t[0]),o.push(t[1]);for(e.push(or(vc,i)+","+or(vc,o)),--r;++r<u;)t=n[r],i.shift(),i.push(t[0]),o.shift(),o.push(t[1]),ar(e,i,o);return e.join("")}function ur(n){for(var t,e,r=-1,u=n.length,i=u+4,o=[],a=[];++r<4;)e=n[r%u],o.push(e[0]),a.push(e[1]);for(t=[or(vc,o),",",or(vc,a)],--r;++r<i;)e=n[r%u],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),ar(t,o,a);return t.join("")}function ir(n,t){var e=n.length-1;if(e)for(var r,u,i=n[0][0],o=n[0][1],a=n[e][0]-i,c=n[e][1]-o,l=-1;++l<=e;)r=n[l],u=l/e,r[0]=t*r[0]+(1-t)*(i+u*a),r[1]=t*r[1]+(1-t)*(o+u*c);return er(n)}function or(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function ar(n,t,e){n.push("C",or(pc,t),",",or(pc,e),",",or(dc,t),",",or(dc,e),",",or(vc,t),",",or(vc,e))}function cr(n,t){return(t[1]-n[1])/(t[0]-n[0])}function lr(n){for(var t=0,e=n.length-1,r=[],u=n[0],i=n[1],o=r[0]=cr(u,i);++t<e;)r[t]=(o+(o=cr(u=i,i=n[t+1])))/2;return r[t]=o,r
}function sr(n){for(var t,e,r,u,i=[],o=lr(n),a=-1,c=n.length-1;++a<c;)t=cr(n[a],n[a+1]),Math.abs(t)<Go?o[a]=o[a+1]=0:(e=o[a]/t,r=o[a+1]/t,u=e*e+r*r,u>9&&(u=3*t/Math.sqrt(u),o[a]=u*e,o[a+1]=u*r));for(a=-1;++a<=c;)u=(n[Math.min(c,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),i.push([u||0,o[a]*u||0]);return i}function fr(n){return n.length<3?Xe(n):n[0]+nr(n,sr(n))}function hr(n,t,e,r){var u,i,o,a,c,l,s;return u=r[n],i=u[0],o=u[1],u=r[t],a=u[0],c=u[1],u=r[e],l=u[0],s=u[1],(s-o)*(a-i)-(c-o)*(l-i)>0}function gr(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function pr(n,t,e,r){var u=n[0],i=e[0],o=t[0]-u,a=r[0]-i,c=n[1],l=e[1],s=t[1]-c,f=r[1]-l,h=(a*(c-l)-f*(u-i))/(f*o-a*s);return[u+h*o,c+h*s]}function dr(n){var t=n[0],e=n[n.length-1];return!(t[0]-e[0]||t[1]-e[1])}function vr(n,t){var e={list:n.map(function(n,t){return{index:t,x:n[0],y:n[1]}}).sort(function(n,t){return n.y<t.y?-1:n.y>t.y?1:n.x<t.x?-1:n.x>t.x?1:0}),bottomSite:null},r={list:[],leftEnd:null,rightEnd:null,init:function(){r.leftEnd=r.createHalfEdge(null,"l"),r.rightEnd=r.createHalfEdge(null,"l"),r.leftEnd.r=r.rightEnd,r.rightEnd.l=r.leftEnd,r.list.unshift(r.leftEnd,r.rightEnd)},createHalfEdge:function(n,t){return{edge:n,side:t,vertex:null,l:null,r:null}},insert:function(n,t){t.l=n,t.r=n.r,n.r.l=t,n.r=t},leftBound:function(n){var t=r.leftEnd;do t=t.r;while(t!=r.rightEnd&&u.rightOf(t,n));return t=t.l},del:function(n){n.l.r=n.r,n.r.l=n.l,n.edge=null},right:function(n){return n.r},left:function(n){return n.l},leftRegion:function(n){return null==n.edge?e.bottomSite:n.edge.region[n.side]},rightRegion:function(n){return null==n.edge?e.bottomSite:n.edge.region[yc[n.side]]}},u={bisect:function(n,t){var e={region:{l:n,r:t},ep:{l:null,r:null}},r=t.x-n.x,u=t.y-n.y,i=r>0?r:-r,o=u>0?u:-u;return e.c=n.x*r+n.y*u+.5*(r*r+u*u),i>o?(e.a=1,e.b=u/r,e.c/=r):(e.b=1,e.a=r/u,e.c/=u),e},intersect:function(n,t){var e=n.edge,r=t.edge;if(!e||!r||e.region.r==r.region.r)return null;var u=e.a*r.b-e.b*r.a;if(Math.abs(u)<1e-10)return null;var i,o,a=(e.c*r.b-r.c*e.b)/u,c=(r.c*e.a-e.c*r.a)/u,l=e.region.r,s=r.region.r;l.y<s.y||l.y==s.y&&l.x<s.x?(i=n,o=e):(i=t,o=r);var f=a>=o.region.r.x;return f&&"l"===i.side||!f&&"r"===i.side?null:{x:a,y:c}},rightOf:function(n,t){var e=n.edge,r=e.region.r,u=t.x>r.x;if(u&&"l"===n.side)return 1;if(!u&&"r"===n.side)return 0;if(1===e.a){var i=t.y-r.y,o=t.x-r.x,a=0,c=0;if(!u&&e.b<0||u&&e.b>=0?c=a=i>=e.b*o:(c=t.x+t.y*e.b>e.c,e.b<0&&(c=!c),c||(a=1)),!a){var l=r.x-e.region.l.x;c=e.b*(o*o-i*i)<l*i*(1+2*o/l+e.b*e.b),e.b<0&&(c=!c)}}else{var s=e.c-e.a*t.x,f=t.y-s,h=t.x-r.x,g=s-r.y;c=f*f>h*h+g*g}return"l"===n.side?c:!c},endPoint:function(n,e,r){n.ep[e]=r,n.ep[yc[e]]&&t(n)},distance:function(n,t){var e=n.x-t.x,r=n.y-t.y;return Math.sqrt(e*e+r*r)}},i={list:[],insert:function(n,t,e){n.vertex=t,n.ystar=t.y+e;for(var r=0,u=i.list,o=u.length;o>r;r++){var a=u[r];if(!(n.ystar>a.ystar||n.ystar==a.ystar&&t.x>a.vertex.x))break}u.splice(r,0,n)},del:function(n){for(var t=0,e=i.list,r=e.length;r>t&&e[t]!=n;++t);e.splice(t,1)},empty:function(){return 0===i.list.length},nextEvent:function(n){for(var t=0,e=i.list,r=e.length;r>t;++t)if(e[t]==n)return e[t+1];return null},min:function(){var n=i.list[0];return{x:n.vertex.x,y:n.ystar}},extractMin:function(){return i.list.shift()}};r.init(),e.bottomSite=e.list.shift();for(var o,a,c,l,s,f,h,g,p,d,v,m,y,M=e.list.shift();;)if(i.empty()||(o=i.min()),M&&(i.empty()||M.y<o.y||M.y==o.y&&M.x<o.x))a=r.leftBound(M),c=r.right(a),h=r.rightRegion(a),m=u.bisect(h,M),f=r.createHalfEdge(m,"l"),r.insert(a,f),d=u.intersect(a,f),d&&(i.del(a),i.insert(a,d,u.distance(d,M))),a=f,f=r.createHalfEdge(m,"r"),r.insert(a,f),d=u.intersect(f,c),d&&i.insert(f,d,u.distance(d,M)),M=e.list.shift();else{if(i.empty())break;a=i.extractMin(),l=r.left(a),c=r.right(a),s=r.right(c),h=r.leftRegion(a),g=r.rightRegion(c),v=a.vertex,u.endPoint(a.edge,a.side,v),u.endPoint(c.edge,c.side,v),r.del(a),i.del(c),r.del(c),y="l",h.y>g.y&&(p=h,h=g,g=p,y="r"),m=u.bisect(h,g),f=r.createHalfEdge(m,y),r.insert(l,f),u.endPoint(m,yc[y],v),d=u.intersect(l,f),d&&(i.del(l),i.insert(l,d,u.distance(d,h))),d=u.intersect(f,s),d&&i.insert(f,d,u.distance(d,h))}for(a=r.right(r.leftEnd);a!=r.rightEnd;a=r.right(a))t(a.edge)}function mr(n){return n.x}function yr(n){return n.y}function Mr(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function xr(n,t,e,r,u,i){if(!n(t,e,r,u,i)){var o=.5*(e+u),a=.5*(r+i),c=t.nodes;c[0]&&xr(n,c[0],e,r,o,a),c[1]&&xr(n,c[1],o,r,u,a),c[2]&&xr(n,c[2],e,a,o,i),c[3]&&xr(n,c[3],o,a,u,i)}}function br(n,t){n=mo.rgb(n),t=mo.rgb(t);var e=n.r,r=n.g,u=n.b,i=t.r-e,o=t.g-r,a=t.b-u;return function(n){return"#"+ct(Math.round(e+i*n))+ct(Math.round(r+o*n))+ct(Math.round(u+a*n))}}function _r(n,t){var e,r={},u={};for(e in n)e in t?r[e]=Er(n[e],t[e]):u[e]=n[e];for(e in t)e in n||(u[e]=t[e]);return function(n){for(e in r)u[e]=r[e](n);return u}}function wr(n,t){return t-=n=+n,function(e){return n+t*e}}function Sr(n,t){var e,r,u,i,o,a=0,c=0,l=[],s=[];for(n+="",t+="",Mc.lastIndex=0,r=0;e=Mc.exec(t);++r)e.index&&l.push(t.substring(a,c=e.index)),s.push({i:l.length,x:e[0]}),l.push(null),a=Mc.lastIndex;for(a<t.length&&l.push(t.substring(a)),r=0,i=s.length;(e=Mc.exec(n))&&i>r;++r)if(o=s[r],o.x==e[0]){if(o.i)if(null==l[o.i+1])for(l[o.i-1]+=o.x,l.splice(o.i,1),u=r+1;i>u;++u)s[u].i--;else for(l[o.i-1]+=o.x+l[o.i+1],l.splice(o.i,2),u=r+1;i>u;++u)s[u].i-=2;else if(null==l[o.i+1])l[o.i]=o.x;else for(l[o.i]=o.x+l[o.i+1],l.splice(o.i+1,1),u=r+1;i>u;++u)s[u].i--;s.splice(r,1),i--,r--}else o.x=wr(parseFloat(e[0]),parseFloat(o.x));for(;i>r;)o=s.pop(),null==l[o.i+1]?l[o.i]=o.x:(l[o.i]=o.x+l[o.i+1],l.splice(o.i+1,1)),i--;return 1===l.length?null==l[0]?(o=s[0].x,function(n){return o(n)+""}):function(){return t}:function(n){for(r=0;i>r;++r)l[(o=s[r]).i]=o.x(n);return l.join("")}}function Er(n,t){for(var e,r=mo.interpolators.length;--r>=0&&!(e=mo.interpolators[r](n,t)););return e}function kr(n,t){var e,r=[],u=[],i=n.length,o=t.length,a=Math.min(n.length,t.length);for(e=0;a>e;++e)r.push(Er(n[e],t[e]));for(;i>e;++e)u[e]=n[e];for(;o>e;++e)u[e]=t[e];return function(n){for(e=0;a>e;++e)u[e]=r[e](n);return u}}function Ar(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function Nr(n){return function(t){return 1-n(1-t)}}function Tr(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function qr(n){return n*n}function zr(n){return n*n*n}function Cr(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(.5>n?e:3*(n-t)+e-.75)}function Dr(n){return function(t){return Math.pow(t,n)}}function jr(n){return 1-Math.cos(n*Jo)}function Lr(n){return Math.pow(2,10*(n-1))}function Hr(n){return 1-Math.sqrt(1-n*n)}function Fr(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/Wo*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*Wo/t)}}function Pr(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function Or(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Rr(n,t){n=mo.hcl(n),t=mo.hcl(t);var e=n.h,r=n.c,u=n.l,i=t.h-e,o=t.c-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return J(e+i*n,r+o*n,u+a*n)+""}}function Yr(n,t){n=mo.hsl(n),t=mo.hsl(t);var e=n.h,r=n.s,u=n.l,i=t.h-e,o=t.s-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return $(e+i*n,r+o*n,u+a*n)+""}}function Ir(n,t){n=mo.lab(n),t=mo.lab(t);var e=n.l,r=n.a,u=n.b,i=t.l-e,o=t.a-r,a=t.b-u;return function(n){return Q(e+i*n,r+o*n,u+a*n)+""}}function Ur(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function Zr(n){var t=[n.a,n.b],e=[n.c,n.d],r=Xr(t),u=Vr(t,e),i=Xr($r(e,t,-u))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,u*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*na,this.translate=[n.e,n.f],this.scale=[r,i],this.skew=i?Math.atan2(u,i)*na:0}function Vr(n,t){return n[0]*t[0]+n[1]*t[1]}function Xr(n){var t=Math.sqrt(Vr(n,n));return t&&(n[0]/=t,n[1]/=t),t}function $r(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}function Br(n,t){var e,r=[],u=[],i=mo.transform(n),o=mo.transform(t),a=i.translate,c=o.translate,l=i.rotate,s=o.rotate,f=i.skew,h=o.skew,g=i.scale,p=o.scale;return a[0]!=c[0]||a[1]!=c[1]?(r.push("translate(",null,",",null,")"),u.push({i:1,x:wr(a[0],c[0])},{i:3,x:wr(a[1],c[1])})):c[0]||c[1]?r.push("translate("+c+")"):r.push(""),l!=s?(l-s>180?s+=360:s-l>180&&(l+=360),u.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:wr(l,s)})):s&&r.push(r.pop()+"rotate("+s+")"),f!=h?u.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:wr(f,h)}):h&&r.push(r.pop()+"skewX("+h+")"),g[0]!=p[0]||g[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),u.push({i:e-4,x:wr(g[0],p[0])},{i:e-2,x:wr(g[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=u.length,function(n){for(var t,i=-1;++i<e;)r[(t=u[i]).i]=t.x(n);return r.join("")}}function Wr(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return(e-n)*t}}function Jr(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return Math.max(0,Math.min(1,(e-n)*t))}}function Gr(n){for(var t=n.source,e=n.target,r=Qr(t,e),u=[t];t!==r;)t=t.parent,u.push(t);for(var i=u.length;e!==r;)u.splice(i,0,e),e=e.parent;return u}function Kr(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function Qr(n,t){if(n===t)return n;for(var e=Kr(n),r=Kr(t),u=e.pop(),i=r.pop(),o=null;u===i;)o=u,u=e.pop(),i=r.pop();return o}function nu(n){n.fixed|=2}function tu(n){n.fixed&=-7}function eu(n){n.fixed|=4,n.px=n.x,n.py=n.y}function ru(n){n.fixed&=-5}function uu(n,t,e){var r=0,u=0;if(n.charge=0,!n.leaf)for(var i,o=n.nodes,a=o.length,c=-1;++c<a;)i=o[c],null!=i&&(uu(i,t,e),n.charge+=i.charge,r+=i.charge*i.cx,u+=i.charge*i.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var l=t*e[n.point.index];n.charge+=n.pointCharge=l,r+=l*n.point.x,u+=l*n.point.y}n.cx=r/n.charge,n.cy=u/n.charge}function iu(n,t){return mo.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=lu,n}function ou(n){return n.children}function au(n){return n.value}function cu(n,t){return t.value-n.value}function lu(n){return mo.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function su(n){return n.x}function fu(n){return n.y}function hu(n,t,e){n.y0=t,n.y=e}function gu(n){return mo.range(n.length)}function pu(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function du(n){for(var t,e=1,r=0,u=n[0][1],i=n.length;i>e;++e)(t=n[e][1])>u&&(r=e,u=t);return r}function vu(n){return n.reduce(mu,0)}function mu(n,t){return n+t[1]}function yu(n,t){return Mu(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Mu(n,t){for(var e=-1,r=+n[0],u=(n[1]-r)/t,i=[];++e<=t;)i[e]=u*e+r;return i}function xu(n){return[mo.min(n),mo.max(n)]}function bu(n,t){return n.parent==t.parent?1:2}function _u(n){var t=n.children;return t&&t.length?t[0]:n._tree.thread}function wu(n){var t,e=n.children;return e&&(t=e.length)?e[t-1]:n._tree.thread}function Su(n,t){var e=n.children;if(e&&(u=e.length))for(var r,u,i=-1;++i<u;)t(r=Su(e[i],t),n)>0&&(n=r);return n}function Eu(n,t){return n.x-t.x}function ku(n,t){return t.x-n.x}function Au(n,t){return n.depth-t.depth}function Nu(n,t){function e(n,r){var u=n.children;if(u&&(o=u.length))for(var i,o,a=null,c=-1;++c<o;)i=u[c],e(i,a),a=i;t(n,r)}e(n,null)}function Tu(n){for(var t,e=0,r=0,u=n.children,i=u.length;--i>=0;)t=u[i]._tree,t.prelim+=e,t.mod+=e,e+=t.shift+(r+=t.change)}function qu(n,t,e){n=n._tree,t=t._tree;var r=e/(t.number-n.number);n.change+=r,t.change-=r,t.shift+=e,t.prelim+=e,t.mod+=e}function zu(n,t,e){return n._tree.ancestor.parent==t.parent?n._tree.ancestor:e}function Cu(n,t){return n.value-t.value}function Du(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function ju(n,t){n._pack_next=t,t._pack_prev=n}function Lu(n,t){var e=t.x-n.x,r=t.y-n.y,u=n.r+t.r;return.999*u*u>e*e+r*r}function Hu(n){function t(n){s=Math.min(n.x-n.r,s),f=Math.max(n.x+n.r,f),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g)}if((e=n.children)&&(l=e.length)){var e,r,u,i,o,a,c,l,s=1/0,f=-1/0,h=1/0,g=-1/0;if(e.forEach(Fu),r=e[0],r.x=-r.r,r.y=0,t(r),l>1&&(u=e[1],u.x=u.r,u.y=0,t(u),l>2))for(i=e[2],Ru(r,u,i),t(i),Du(r,i),r._pack_prev=i,Du(i,u),u=r._pack_next,o=3;l>o;o++){Ru(r,u,i=e[o]);var p=0,d=1,v=1;for(a=u._pack_next;a!==u;a=a._pack_next,d++)if(Lu(a,i)){p=1;break}if(1==p)for(c=r._pack_prev;c!==a._pack_prev&&!Lu(c,i);c=c._pack_prev,v++);p?(v>d||d==v&&u.r<r.r?ju(r,u=a):ju(r=c,u),o--):(Du(r,i),u=i,t(i))}var m=(s+f)/2,y=(h+g)/2,M=0;for(o=0;l>o;o++)i=e[o],i.x-=m,i.y-=y,M=Math.max(M,i.r+Math.sqrt(i.x*i.x+i.y*i.y));n.r=M,e.forEach(Pu)}}function Fu(n){n._pack_next=n._pack_prev=n}function Pu(n){delete n._pack_next,delete n._pack_prev}function Ou(n,t,e,r){var u=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,u)for(var i=-1,o=u.length;++i<o;)Ou(u[i],t,e,r)}function Ru(n,t,e){var r=n.r+e.r,u=t.x-n.x,i=t.y-n.y;if(r&&(u||i)){var o=t.r+e.r,a=u*u+i*i;o*=o,r*=r;var c=.5+(r-o)/(2*a),l=Math.sqrt(Math.max(0,2*o*(r+a)-(r-=a)*r-o*o))/(2*a);e.x=n.x+c*u+l*i,e.y=n.y+c*i-l*u}else e.x=n.x+r,e.y=n.y}function Yu(n){return 1+mo.max(n,function(n){return n.y})}function Iu(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Uu(n){var t=n.children;return t&&t.length?Uu(t[0]):n}function Zu(n){var t,e=n.children;return e&&(t=e.length)?Zu(e[t-1]):n}function Vu(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Xu(n,t){var e=n.x+t[3],r=n.y+t[0],u=n.dx-t[1]-t[3],i=n.dy-t[0]-t[2];return 0>u&&(e+=u/2,u=0),0>i&&(r+=i/2,i=0),{x:e,y:r,dx:u,dy:i}}function $u(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function Bu(n){return n.rangeExtent?n.rangeExtent():$u(n.range())}function Wu(n,t,e,r){var u=e(n[0],n[1]),i=r(t[0],t[1]);return function(n){return i(u(n))}}function Ju(n,t){var e,r=0,u=n.length-1,i=n[r],o=n[u];return i>o&&(e=r,r=u,u=e,e=i,i=o,o=e),n[r]=t.floor(i),n[u]=t.ceil(o),n}function Gu(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:Tc}function Ku(n,t,e,r){var u=[],i=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)u.push(e(n[o-1],n[o])),i.push(r(t[o-1],t[o]));return function(t){var e=mo.bisect(n,t,1,a)-1;return i[e](u[e](t))}}function Qu(n,t,e,r){function u(){var u=Math.min(n.length,t.length)>2?Ku:Wu,c=r?Jr:Wr;return o=u(n,t,c,e),a=u(t,n,c,Er),i}function i(n){return o(n)}var o,a;return i.invert=function(n){return a(n)},i.domain=function(t){return arguments.length?(n=t.map(Number),u()):n},i.range=function(n){return arguments.length?(t=n,u()):t},i.rangeRound=function(n){return i.range(n).interpolate(Ur)},i.clamp=function(n){return arguments.length?(r=n,u()):r},i.interpolate=function(n){return arguments.length?(e=n,u()):e},i.ticks=function(t){return ri(n,t)},i.tickFormat=function(t,e){return ui(n,t,e)},i.nice=function(t){return ti(n,t),u()},i.copy=function(){return Qu(n,t,e,r)},u()}function ni(n,t){return mo.rebind(n,t,"range","rangeRound","interpolate","clamp")}function ti(n,t){return Ju(n,Gu(ei(n,t)[2]))}function ei(n,t){null==t&&(t=10);var e=$u(n),r=e[1]-e[0],u=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),i=t/r*u;return.15>=i?u*=10:.35>=i?u*=5:.75>=i&&(u*=2),e[0]=Math.ceil(e[0]/u)*u,e[1]=Math.floor(e[1]/u)*u+.5*u,e[2]=u,e}function ri(n,t){return mo.range.apply(mo,ei(n,t))}function ui(n,t,e){var r=-Math.floor(Math.log(ei(n,t)[2])/Math.LN10+.01);return mo.format(e?e.replace(Aa,function(n,t,e,u,i,o,a,c,l,s){return[t,e,u,i,o,a,c,l||"."+(r-2*("%"===s)),s].join("")}):",."+r+"f")}function ii(n,t,e,r){function u(n){return(e?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function i(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(u(t))}return o.invert=function(t){return i(n.invert(t))},o.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(u)),o):r},o.base=function(e){return arguments.length?(t=+e,n.domain(r.map(u)),o):t},o.nice=function(){var t=Ju(r.map(u),e?Math:zc);return n.domain(t),r=t.map(i),o},o.ticks=function(){var n=$u(r),o=[],a=n[0],c=n[1],l=Math.floor(u(a)),s=Math.ceil(u(c)),f=t%1?2:t;if(isFinite(s-l)){if(e){for(;s>l;l++)for(var h=1;f>h;h++)o.push(i(l)*h);o.push(i(l))}else for(o.push(i(l));l++<s;)for(var h=f-1;h>0;h--)o.push(i(l)*h);for(l=0;o[l]<a;l++);for(s=o.length;o[s-1]>c;s--);o=o.slice(l,s)}return o},o.tickFormat=function(n,t){if(!arguments.length)return qc;arguments.length<2?t=qc:"function"!=typeof t&&(t=mo.format(t));var r,a=Math.max(.1,n/o.ticks().length),c=e?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(n){return n/i(c(u(n)+r))<=a?t(n):""}},o.copy=function(){return ii(n.copy(),t,e,r)},ni(o,n)}function oi(n,t,e){function r(t){return n(u(t))}var u=ai(t),i=ai(1/t);return r.invert=function(t){return i(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(u)),r):e},r.ticks=function(n){return ri(e,n)},r.tickFormat=function(n,t){return ui(e,n,t)},r.nice=function(n){return r.domain(ti(e,n))},r.exponent=function(o){return arguments.length?(u=ai(t=o),i=ai(1/t),n.domain(e.map(u)),r):t},r.copy=function(){return oi(n.copy(),t,e)},ni(r,n)}function ai(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function ci(n,t){function e(e){return o[((i.get(e)||"range"===t.t&&i.set(e,n.push(e)))-1)%o.length]}function r(t,e){return mo.range(n.length).map(function(n){return t+e*n})}var i,o,a;return e.domain=function(r){if(!arguments.length)return n;n=[],i=new u;for(var o,a=-1,c=r.length;++a<c;)i.has(o=r[a])||i.set(o,n.push(o));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(o=n,a=0,t={t:"range",a:arguments},e):o},e.rangePoints=function(u,i){arguments.length<2&&(i=0);var c=u[0],l=u[1],s=(l-c)/(Math.max(1,n.length-1)+i);return o=r(n.length<2?(c+l)/2:c+s*i/2,s),a=0,t={t:"rangePoints",a:arguments},e},e.rangeBands=function(u,i,c){arguments.length<2&&(i=0),arguments.length<3&&(c=i);var l=u[1]<u[0],s=u[l-0],f=u[1-l],h=(f-s)/(n.length-i+2*c);return o=r(s+h*c,h),l&&o.reverse(),a=h*(1-i),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(u,i,c){arguments.length<2&&(i=0),arguments.length<3&&(c=i);var l=u[1]<u[0],s=u[l-0],f=u[1-l],h=Math.floor((f-s)/(n.length-i+2*c)),g=f-s-(n.length-i)*h;return o=r(s+Math.round(g/2),h),l&&o.reverse(),a=Math.round(h*(1-i)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return a},e.rangeExtent=function(){return $u(t.a[0])},e.copy=function(){return ci(n,t)},e.domain(n)}function li(n,t){function e(){var e=0,i=t.length;for(u=[];++e<i;)u[e-1]=mo.quantile(n,e/i);return r}function r(n){return isNaN(n=+n)?void 0:t[mo.bisect(u,n)]}var u;return r.domain=function(t){return arguments.length?(n=t.filter(function(n){return!isNaN(n)}).sort(mo.ascending),e()):n},r.range=function(n){return arguments.length?(t=n,e()):t},r.quantiles=function(){return u},r.invertExtent=function(e){return e=t.indexOf(e),0>e?[0/0,0/0]:[e>0?u[e-1]:n[0],e<u.length?u[e]:n[n.length-1]]},r.copy=function(){return li(n,t)},e()}function si(n,t,e){function r(t){return e[Math.max(0,Math.min(o,Math.floor(i*(t-n))))]}function u(){return i=e.length/(t-n),o=e.length-1,r}var i,o;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],u()):[n,t]},r.range=function(n){return arguments.length?(e=n,u()):e},r.invertExtent=function(t){return t=e.indexOf(t),t=0>t?0/0:t/i+n,[t,t+1/i]},r.copy=function(){return si(n,t,e)},u()}function fi(n,t){function e(e){return e>=e?t[mo.bisect(n,e)]:void 0}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return fi(n,t)},e}function hi(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return ri(n,t)},t.tickFormat=function(t,e){return ui(n,t,e)},t.copy=function(){return hi(n)},t}function gi(n){return n.innerRadius}function pi(n){return n.outerRadius}function di(n){return n.startAngle}function vi(n){return n.endAngle}function mi(n){for(var t,e,r,u=-1,i=n.length;++u<i;)t=n[u],e=t[0],r=t[1]+Hc,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function yi(n){function t(t){function c(){d.push("M",a(n(m),f),s,l(n(v.reverse()),f),"Z")}for(var h,g,p,d=[],v=[],m=[],y=-1,M=t.length,x=pt(e),b=pt(u),_=e===r?function(){return g}:pt(r),w=u===i?function(){return p}:pt(i);++y<M;)o.call(this,h=t[y],y)?(v.push([g=+x.call(this,h,y),p=+b.call(this,h,y)]),m.push([+_.call(this,h,y),+w.call(this,h,y)])):v.length&&(c(),v=[],m=[]);return v.length&&c(),d.length?d.join(""):null}var e=Ze,r=Ze,u=0,i=Ve,o=Vt,a=Xe,c=a.key,l=a,s="L",f=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(u=i=n,t):i},t.y0=function(n){return arguments.length?(u=n,t):u},t.y1=function(n){return arguments.length?(i=n,t):i},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?a=n:(a=gc.get(n)||Xe).key,l=a.reverse||a,s=a.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(f=n,t):f},t}function Mi(n){return n.radius}function xi(n){return[n.x,n.y]}function bi(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]+Hc;return[e*Math.cos(r),e*Math.sin(r)]}}function _i(){return 64}function wi(){return"circle"}function Si(n){var t=Math.sqrt(n/Bo);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Ei(n,t){return Lo(n,Uc),n.id=t,n}function ki(n,t,e,r){var u=n.id;return N(n,"function"==typeof e?function(n,i,o){n.__transition__[u].tween.set(t,r(e.call(n,n.__data__,i,o)))}:(e=r(e),function(n){n.__transition__[u].tween.set(t,e)}))}function Ai(n){return null==n&&(n=""),function(){this.textContent=n}}function Ni(n,t,e,r){var i=n.__transition__||(n.__transition__={active:0,count:0}),o=i[e];if(!o){var a=r.time;o=i[e]={tween:new u,time:a,ease:r.ease,delay:r.delay,duration:r.duration},++i.count,mo.timer(function(r){function u(r){return i.active>e?l():(i.active=e,o.event&&o.event.start.call(n,s,t),o.tween.forEach(function(e,r){(r=r.call(n,s,t))&&p.push(r)}),c(r||1)?1:(xt(c,h,a),void 0))}function c(r){if(i.active!==e)return l();for(var u=r/g,a=f(u),c=p.length;c>0;)p[--c].call(n,a);return u>=1?(o.event&&o.event.end.call(n,s,t),l()):void 0}function l(){return--i.count?delete i[e]:delete n.__transition__,1}var s=n.__data__,f=o.ease,h=o.delay,g=o.duration,p=[];return r>=h?u(r-h):(xt(u,h,a),void 0)},0,a)}}function Ti(n,t){n.attr("transform",function(n){return"translate("+t(n)+",0)"})}function qi(n,t){n.attr("transform",function(n){return"translate(0,"+t(n)+")"})}function zi(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ci(n,t,e){function r(t){var e=n(t),r=i(e,1);return r-t>t-e?e:r}function u(e){return t(e=n(new Jc(e-1)),1),e}function i(n,e){return t(n=new Jc(+n),e),n}function o(n,r,i){var o=u(n),a=[];if(i>1)for(;r>o;)e(o)%i||a.push(new Date(+o)),t(o,1);else for(;r>o;)a.push(new Date(+o)),t(o,1);return a}function a(n,t,e){try{Jc=zi;var r=new zi;return r._=n,o(r,t,e)}finally{Jc=Date}}n.floor=n,n.round=r,n.ceil=u,n.offset=i,n.range=o;var c=n.utc=Di(n);return c.floor=c,c.round=Di(r),c.ceil=Di(u),c.offset=Di(i),c.range=a,n}function Di(n){return function(t,e){try{Jc=zi;var r=new zi;return r._=t,n(r,e)._}finally{Jc=Date}}}function ji(n){function t(t){for(var r,u,i,o=[],a=-1,c=0;++a<e;)37===n.charCodeAt(a)&&(o.push(n.substring(c,a)),null!=(u=dl[r=n.charAt(++a)])&&(r=n.charAt(++a)),(i=vl[r])&&(r=i(t,null==u?"e"===r?" ":"0":u)),o.push(r),c=a+1);return o.push(n.substring(c,a)),o.join("")}var e=n.length;return t.parse=function(t){var e={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},r=Li(e,n,t,0);if(r!=t.length)return null;"p"in e&&(e.H=e.H%12+12*e.p);var u=null!=e.Z&&Jc!==zi,i=new(u?zi:Jc);return"j"in e?i.setFullYear(e.y,0,e.j):"w"in e&&("W"in e||"U"in e)?(i.setFullYear(e.y,0,1),i.setFullYear(e.y,0,"W"in e?(e.w+6)%7+7*e.W-(i.getDay()+5)%7:e.w+7*e.U-(i.getDay()+6)%7)):i.setFullYear(e.y,e.m,e.d),i.setHours(e.H+Math.floor(e.Z/100),e.M+e.Z%100,e.S,e.L),u?i._:i},t.toString=function(){return n},t}function Li(n,t,e,r){for(var u,i,o,a=0,c=t.length,l=e.length;c>a;){if(r>=l)return-1;if(u=t.charCodeAt(a++),37===u){if(o=t.charAt(a++),i=ml[o in dl?t.charAt(a++):o],!i||(r=i(n,e,r))<0)return-1}else if(u!=e.charCodeAt(r++))return-1}return r}function Hi(n){return new RegExp("^(?:"+n.map(mo.requote).join("|")+")","i")}function Fi(n){for(var t=new u,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function Pi(n,t,e){var r=0>n?"-":"",u=(r?-n:n)+"",i=u.length;return r+(e>i?new Array(e-i+1).join(t)+u:u)}function Oi(n,t,e){cl.lastIndex=0;var r=cl.exec(t.substring(e));return r?(n.w=ll.get(r[0].toLowerCase()),e+r[0].length):-1}function Ri(n,t,e){ol.lastIndex=0;var r=ol.exec(t.substring(e));return r?(n.w=al.get(r[0].toLowerCase()),e+r[0].length):-1}function Yi(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function Ii(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e));return r?(n.U=+r[0],e+r[0].length):-1}function Ui(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e));return r?(n.W=+r[0],e+r[0].length):-1}function Zi(n,t,e){hl.lastIndex=0;var r=hl.exec(t.substring(e));return r?(n.m=gl.get(r[0].toLowerCase()),e+r[0].length):-1}function Vi(n,t,e){sl.lastIndex=0;var r=sl.exec(t.substring(e));return r?(n.m=fl.get(r[0].toLowerCase()),e+r[0].length):-1}function Xi(n,t,e){return Li(n,vl.c.toString(),t,e)}function $i(n,t,e){return Li(n,vl.x.toString(),t,e)}function Bi(n,t,e){return Li(n,vl.X.toString(),t,e)}function Wi(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Ji(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+2));return r?(n.y=Ki(+r[0]),e+r[0].length):-1}function Gi(n,t,e){return/^[+-]\d{4}$/.test(t=t.substring(e,e+5))?(n.Z=+t,e+5):-1}function Ki(n){return n+(n>68?1900:2e3)}function Qi(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function no(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function to(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function eo(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function ro(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function uo(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function io(n,t,e){yl.lastIndex=0;var r=yl.exec(t.substring(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function oo(n,t,e){var r=Ml.get(t.substring(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}function ao(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=~~(Math.abs(t)/60),u=Math.abs(t)%60;return e+Pi(r,"0",2)+Pi(u,"0",2)}function co(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+1));return r?e+r[0].length:-1}function lo(n){function t(n){try{Jc=zi;var t=new Jc;return t._=n,e(t)}finally{Jc=Date}}var e=ji(n);return t.parse=function(n){try{Jc=zi;var t=e.parse(n);return t&&t._}finally{Jc=Date}},t.toString=e.toString,t}function so(n){return n.toISOString()}function fo(n,t,e){function r(t){return n(t)}function u(n,e){var r=n[1]-n[0],u=r/e,i=mo.bisect(bl,u);return i==bl.length?[t.year,ei(n.map(function(n){return n/31536e6}),e)[2]]:i?t[u/bl[i-1]<bl[i]/u?i-1:i]:[El,ei(n,e)[2]]}return r.invert=function(t){return ho(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(ho)},r.nice=function(n,t){function e(e){return!isNaN(e)&&!n.range(e,ho(+e+1),t).length}var i=r.domain(),o=$u(i),a=null==n?u(o,10):"number"==typeof n&&u(o,n);return a&&(n=a[0],t=a[1]),r.domain(Ju(i,t>1?{floor:function(t){for(;e(t=n.floor(t));)t=ho(t-1);return t},ceil:function(t){for(;e(t=n.ceil(t));)t=ho(+t+1);return t}}:n))},r.ticks=function(n,t){var e=$u(r.domain()),i=null==n?u(e,10):"number"==typeof n?u(e,n):!n.range&&[{range:n},t];return i&&(n=i[0],t=i[1]),n.range(e[0],ho(+e[1]+1),1>t?1:t)},r.tickFormat=function(){return e},r.copy=function(){return fo(n.copy(),t,e)},ni(r,n)}function ho(n){return new Date(n)}function go(n){return function(t){for(var e=n.length-1,r=n[e];!r[1](t);)r=n[--e];return r[0](t)}}function po(n){return JSON.parse(n.responseText)}function vo(n){var t=xo.createRange();return t.selectNode(xo.body),t.createContextualFragment(n.responseText)}var mo={version:"3.3.6"};Date.now||(Date.now=function(){return+new Date});var yo=[].slice,Mo=function(n){return yo.call(n)},xo=document,bo=xo.documentElement,_o=window;try{Mo(bo.childNodes)[0].nodeType}catch(wo){Mo=function(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}}try{xo.createElement("div").style.setProperty("opacity",0,"")}catch(So){var Eo=_o.Element.prototype,ko=Eo.setAttribute,Ao=Eo.setAttributeNS,No=_o.CSSStyleDeclaration.prototype,To=No.setProperty;Eo.setAttribute=function(n,t){ko.call(this,n,t+"")},Eo.setAttributeNS=function(n,t,e){Ao.call(this,n,t,e+"")},No.setProperty=function(n,t,e){To.call(this,n,t+"",e)}}mo.ascending=function(n,t){return t>n?-1:n>t?1:n>=t?0:0/0},mo.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:0/0},mo.min=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(e=n[u])&&e>=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&e>r&&(e=r)}else{for(;++u<i&&!(null!=(e=t.call(n,n[u],u))&&e>=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&e>r&&(e=r)}return e},mo.max=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(e=n[u])&&e>=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&r>e&&(e=r)}else{for(;++u<i&&!(null!=(e=t.call(n,n[u],u))&&e>=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&r>e&&(e=r)}return e},mo.extent=function(n,t){var e,r,u,i=-1,o=n.length;if(1===arguments.length){for(;++i<o&&!(null!=(e=u=n[i])&&e>=e);)e=u=void 0;for(;++i<o;)null!=(r=n[i])&&(e>r&&(e=r),r>u&&(u=r))}else{for(;++i<o&&!(null!=(e=u=t.call(n,n[i],i))&&e>=e);)e=void 0;for(;++i<o;)null!=(r=t.call(n,n[i],i))&&(e>r&&(e=r),r>u&&(u=r))}return[e,u]},mo.sum=function(n,t){var e,r=0,u=n.length,i=-1;if(1===arguments.length)for(;++i<u;)isNaN(e=+n[i])||(r+=e);else for(;++i<u;)isNaN(e=+t.call(n,n[i],i))||(r+=e);return r},mo.mean=function(t,e){var r,u=t.length,i=0,o=-1,a=0;if(1===arguments.length)for(;++o<u;)n(r=t[o])&&(i+=(r-i)/++a);else for(;++o<u;)n(r=e.call(t,t[o],o))&&(i+=(r-i)/++a);return a?i:void 0},mo.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),u=+n[r-1],i=e-r;return i?u+i*(n[r]-u):u},mo.median=function(t,e){return arguments.length>1&&(t=t.map(e)),t=t.filter(n),t.length?mo.quantile(t.sort(mo.ascending),.5):void 0},mo.bisector=function(n){return{left:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n.call(t,t[i],i)<e?r=i+1:u=i}return r},right:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;e<n.call(t,t[i],i)?u=i:r=i+1}return r}}};var qo=mo.bisector(function(n){return n});mo.bisectLeft=qo.left,mo.bisect=mo.bisectRight=qo.right,mo.shuffle=function(n){for(var t,e,r=n.length;r;)e=0|Math.random()*r--,t=n[r],n[r]=n[e],n[e]=t;return n},mo.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},mo.pairs=function(n){for(var t,e=0,r=n.length-1,u=n[0],i=new Array(0>r?0:r);r>e;)i[e]=[t=u,u=n[++e]];return i},mo.zip=function(){if(!(u=arguments.length))return[];for(var n=-1,e=mo.min(arguments,t),r=new Array(e);++n<e;)for(var u,i=-1,o=r[n]=new Array(u);++i<u;)o[i]=arguments[i][n];return r},mo.transpose=function(n){return mo.zip.apply(mo,n)},mo.keys=function(n){var t=[];for(var e in n)t.push(e);return t},mo.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},mo.entries=function(n){var t=[];
for(var e in n)t.push({key:e,value:n[e]});return t},mo.merge=function(n){return Array.prototype.concat.apply([],n)},mo.range=function(n,t,r){if(arguments.length<3&&(r=1,arguments.length<2&&(t=n,n=0)),1/0===(t-n)/r)throw new Error("infinite range");var u,i=[],o=e(Math.abs(r)),a=-1;if(n*=o,t*=o,r*=o,0>r)for(;(u=n+r*++a)>t;)i.push(u/o);else for(;(u=n+r*++a)<t;)i.push(u/o);return i},mo.map=function(n){var t=new u;if(n instanceof u)n.forEach(function(n,e){t.set(n,e)});else for(var e in n)t.set(e,n[e]);return t},r(u,{has:function(n){return zo+n in this},get:function(n){return this[zo+n]},set:function(n,t){return this[zo+n]=t},remove:function(n){return n=zo+n,n in this&&delete this[n]},keys:function(){var n=[];return this.forEach(function(t){n.push(t)}),n},values:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n},entries:function(){var n=[];return this.forEach(function(t,e){n.push({key:t,value:e})}),n},forEach:function(n){for(var t in this)t.charCodeAt(0)===Co&&n.call(this,t.substring(1),this[t])}});var zo="\x00",Co=zo.charCodeAt(0);mo.nest=function(){function n(t,a,c){if(c>=o.length)return r?r.call(i,a):e?a.sort(e):a;for(var l,s,f,h,g=-1,p=a.length,d=o[c++],v=new u;++g<p;)(h=v.get(l=d(s=a[g])))?h.push(s):v.set(l,[s]);return t?(s=t(),f=function(e,r){s.set(e,n(t,r,c))}):(s={},f=function(e,r){s[e]=n(t,r,c)}),v.forEach(f),s}function t(n,e){if(e>=o.length)return n;var r=[],u=a[e++];return n.forEach(function(n,u){r.push({key:n,values:t(u,e)})}),u?r.sort(function(n,t){return u(n.key,t.key)}):r}var e,r,i={},o=[],a=[];return i.map=function(t,e){return n(e,t,0)},i.entries=function(e){return t(n(mo.map,e,0),0)},i.key=function(n){return o.push(n),i},i.sortKeys=function(n){return a[o.length-1]=n,i},i.sortValues=function(n){return e=n,i},i.rollup=function(n){return r=n,i},i},mo.set=function(n){var t=new i;if(n)for(var e=0,r=n.length;r>e;++e)t.add(n[e]);return t},r(i,{has:function(n){return zo+n in this},add:function(n){return this[zo+n]=!0,n},remove:function(n){return n=zo+n,n in this&&delete this[n]},values:function(){var n=[];return this.forEach(function(t){n.push(t)}),n},forEach:function(n){for(var t in this)t.charCodeAt(0)===Co&&n.call(this,t.substring(1))}}),mo.behavior={},mo.rebind=function(n,t){for(var e,r=1,u=arguments.length;++r<u;)n[e=arguments[r]]=o(n,t,t[e]);return n};var Do=["webkit","ms","moz","Moz","o","O"];mo.dispatch=function(){for(var n=new l,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=s(n);return n},l.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.substring(e+1),n=n.substring(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},mo.event=null,mo.requote=function(n){return n.replace(jo,"\\$&")};var jo=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,Lo={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},Ho=function(n,t){return t.querySelector(n)},Fo=function(n,t){return t.querySelectorAll(n)},Po=bo[a(bo,"matchesSelector")],Oo=function(n,t){return Po.call(n,t)};"function"==typeof Sizzle&&(Ho=function(n,t){return Sizzle(n,t)[0]||null},Fo=function(n,t){return Sizzle.uniqueSort(Sizzle(n,t))},Oo=Sizzle.matchesSelector),mo.selection=function(){return Uo};var Ro=mo.selection.prototype=[];Ro.select=function(n){var t,e,r,u,i=[];n=d(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var c=-1,l=r.length;++c<l;)(u=r[c])?(t.push(e=n.call(u,u.__data__,c,o)),e&&"__data__"in u&&(e.__data__=u.__data__)):t.push(null)}return p(i)},Ro.selectAll=function(n){var t,e,r=[];n=v(n);for(var u=-1,i=this.length;++u<i;)for(var o=this[u],a=-1,c=o.length;++a<c;)(e=o[a])&&(r.push(t=Mo(n.call(e,e.__data__,a,u))),t.parentNode=e);return p(r)};var Yo={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};mo.ns={prefix:Yo,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&(e=n.substring(0,t),n=n.substring(t+1)),Yo.hasOwnProperty(e)?{space:Yo[e],local:n}:n}},Ro.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=mo.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(m(t,n[t]));return this}return this.each(m(n,t))},Ro.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=n.trim().split(/^|\s+/g)).length,u=-1;if(t=e.classList){for(;++u<r;)if(!t.contains(n[u]))return!1}else for(t=e.getAttribute("class");++u<r;)if(!M(n[u]).test(t))return!1;return!0}for(t in n)this.each(x(t,n[t]));return this}return this.each(x(n,t))},Ro.style=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t="");for(e in n)this.each(_(e,n[e],t));return this}if(2>r)return _o.getComputedStyle(this.node(),null).getPropertyValue(n);e=""}return this.each(_(n,t,e))},Ro.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(w(t,n[t]));return this}return this.each(w(n,t))},Ro.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},Ro.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},Ro.append=function(n){return n=S(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},Ro.insert=function(n,t){return n=S(n),t=d(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments))})},Ro.remove=function(){return this.each(function(){var n=this.parentNode;n&&n.removeChild(this)})},Ro.data=function(n,t){function e(n,e){var r,i,o,a=n.length,f=e.length,h=Math.min(a,f),g=new Array(f),p=new Array(f),d=new Array(a);if(t){var v,m=new u,y=new u,M=[];for(r=-1;++r<a;)v=t.call(i=n[r],i.__data__,r),m.has(v)?d[r]=i:m.set(v,i),M.push(v);for(r=-1;++r<f;)v=t.call(e,o=e[r],r),(i=m.get(v))?(g[r]=i,i.__data__=o):y.has(v)||(p[r]=E(o)),y.set(v,o),m.remove(v);for(r=-1;++r<a;)m.has(M[r])&&(d[r]=n[r])}else{for(r=-1;++r<h;)i=n[r],o=e[r],i?(i.__data__=o,g[r]=i):p[r]=E(o);for(;f>r;++r)p[r]=E(e[r]);for(;a>r;++r)d[r]=n[r]}p.update=g,p.parentNode=g.parentNode=d.parentNode=n.parentNode,c.push(p),l.push(g),s.push(d)}var r,i,o=-1,a=this.length;if(!arguments.length){for(n=new Array(a=(r=this[0]).length);++o<a;)(i=r[o])&&(n[o]=i.__data__);return n}var c=T([]),l=p([]),s=p([]);if("function"==typeof n)for(;++o<a;)e(r=this[o],n.call(r,r.parentNode.__data__,o));else for(;++o<a;)e(r=this[o],n);return l.enter=function(){return c},l.exit=function(){return s},l},Ro.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},Ro.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=k(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]),t.parentNode=(e=this[i]).parentNode;for(var a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a)&&t.push(r)}return p(u)},Ro.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],u=r.length-1,i=r[u];--u>=0;)(e=r[u])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},Ro.sort=function(n){n=A.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},Ro.each=function(n){return N(this,function(t,e,r){n.call(t,t.__data__,e,r)})},Ro.call=function(n){var t=Mo(arguments);return n.apply(t[0]=this,t),this},Ro.empty=function(){return!this.node()},Ro.node=function(){for(var n=0,t=this.length;t>n;n++)for(var e=this[n],r=0,u=e.length;u>r;r++){var i=e[r];if(i)return i}return null},Ro.size=function(){var n=0;return this.each(function(){++n}),n};var Io=[];mo.selection.enter=T,mo.selection.enter.prototype=Io,Io.append=Ro.append,Io.empty=Ro.empty,Io.node=Ro.node,Io.call=Ro.call,Io.size=Ro.size,Io.select=function(n){for(var t,e,r,u,i,o=[],a=-1,c=this.length;++a<c;){r=(u=this[a]).update,o.push(t=[]),t.parentNode=u.parentNode;for(var l=-1,s=u.length;++l<s;)(i=u[l])?(t.push(r[l]=e=n.call(u.parentNode,i.__data__,l,a)),e.__data__=i.__data__):t.push(null)}return p(o)},Io.insert=function(n,t){return arguments.length<2&&(t=q(this)),Ro.insert.call(this,n,t)},Ro.transition=function(){for(var n,t,e=Oc||++Zc,r=[],u=Rc||{time:Date.now(),ease:Cr,delay:0,duration:250},i=-1,o=this.length;++i<o;){r.push(n=[]);for(var a=this[i],c=-1,l=a.length;++c<l;)(t=a[c])&&Ni(t,c,e,u),n.push(t)}return Ei(r,e)},Ro.interrupt=function(){return this.each(z)},mo.select=function(n){var t=["string"==typeof n?Ho(n,xo):n];return t.parentNode=bo,p([t])},mo.selectAll=function(n){var t=Mo("string"==typeof n?Fo(n,xo):n);return t.parentNode=bo,p([t])};var Uo=mo.select(bo);Ro.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n)this.each(C(e,n[e],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(C(n,t,e))};var Zo=mo.map({mouseenter:"mouseover",mouseleave:"mouseout"});Zo.forEach(function(n){"on"+n in xo&&Zo.remove(n)});var Vo=a(bo.style,"userSelect"),Xo=0;mo.mouse=function(n){return H(n,h())};var $o=/WebKit/.test(_o.navigator.userAgent)?-1:0;mo.touches=function(n,t){return arguments.length<2&&(t=h().touches),t?Mo(t).map(function(t){var e=H(n,t);return e.identifier=t.identifier,e}):[]},mo.behavior.drag=function(){function n(){this.on("mousedown.drag",o).on("touchstart.drag",a)}function t(){return mo.event.changedTouches[0].identifier}function e(n,t){return mo.touches(n).filter(function(n){return n.identifier===t})[0]}function r(n,t,e,r){return function(){function o(){var n=t(s,g),e=n[0]-d[0],r=n[1]-d[1];v|=e|r,d=n,f({type:"drag",x:n[0]+c[0],y:n[1]+c[1],dx:e,dy:r})}function a(){m.on(e+"."+p,null).on(r+"."+p,null),y(v&&mo.event.target===h),f({type:"dragend"})}var c,l=this,s=l.parentNode,f=u.of(l,arguments),h=mo.event.target,g=n(),p=null==g?"drag":"drag-"+g,d=t(s,g),v=0,m=mo.select(_o).on(e+"."+p,o).on(r+"."+p,a),y=L();i?(c=i.apply(l,arguments),c=[c.x-d[0],c.y-d[1]]):c=[0,0],f({type:"dragstart"})}}var u=g(n,"drag","dragstart","dragend"),i=null,o=r(c,mo.mouse,"mousemove","mouseup"),a=r(t,e,"touchmove","touchend");return n.origin=function(t){return arguments.length?(i=t,n):i},mo.rebind(n,u,"on")};var Bo=Math.PI,Wo=2*Bo,Jo=Bo/2,Go=1e-6,Ko=Go*Go,Qo=Bo/180,na=180/Bo,ta=Math.SQRT2,ea=2,ra=4;mo.interpolateZoom=function(n,t){function e(n){var t=n*y;if(m){var e=Y(d),o=i/(ea*h)*(e*I(ta*t+d)-R(d));return[r+o*l,u+o*s,i*e/Y(ta*t+d)]}return[r+n*l,u+n*s,i*Math.exp(ta*t)]}var r=n[0],u=n[1],i=n[2],o=t[0],a=t[1],c=t[2],l=o-r,s=a-u,f=l*l+s*s,h=Math.sqrt(f),g=(c*c-i*i+ra*f)/(2*i*ea*h),p=(c*c-i*i-ra*f)/(2*c*ea*h),d=Math.log(Math.sqrt(g*g+1)-g),v=Math.log(Math.sqrt(p*p+1)-p),m=v-d,y=(m||Math.log(c/i))/ta;return e.duration=1e3*y,e},mo.behavior.zoom=function(){function n(n){n.on(A,l).on(oa+".zoom",h).on(N,p).on("dblclick.zoom",d).on(q,s)}function t(n){return[(n[0]-S.x)/S.k,(n[1]-S.y)/S.k]}function e(n){return[n[0]*S.k+S.x,n[1]*S.k+S.y]}function r(n){S.k=Math.max(k[0],Math.min(k[1],n))}function u(n,t){t=e(t),S.x+=n[0]-t[0],S.y+=n[1]-t[1]}function i(){b&&b.domain(x.range().map(function(n){return(n-S.x)/S.k}).map(x.invert)),w&&w.domain(_.range().map(function(n){return(n-S.y)/S.k}).map(_.invert))}function o(n){n({type:"zoomstart"})}function a(n){i(),n({type:"zoom",scale:S.k,translate:[S.x,S.y]})}function c(n){n({type:"zoomend"})}function l(){function n(){s=1,u(mo.mouse(r),h),a(i)}function e(){f.on(N,_o===r?p:null).on(T,null),g(s&&mo.event.target===l),c(i)}var r=this,i=C.of(r,arguments),l=mo.event.target,s=0,f=mo.select(_o).on(N,n).on(T,e),h=t(mo.mouse(r)),g=L();z.call(r),o(i)}function s(){function n(){var n=mo.touches(p);return g=S.k,n.forEach(function(n){n.identifier in v&&(v[n.identifier]=t(n))}),n}function e(){for(var t=mo.event.changedTouches,e=0,i=t.length;i>e;++e)v[t[e].identifier]=null;var o=n(),c=Date.now();if(1===o.length){if(500>c-M){var l=o[0],s=v[l.identifier];r(2*S.k),u(l,s),f(),a(d)}M=c}else if(o.length>1){var l=o[0],h=o[1],g=l[0]-h[0],p=l[1]-h[1];m=g*g+p*p}}function i(){for(var n,t,e,i,o=mo.touches(p),c=0,l=o.length;l>c;++c,i=null)if(e=o[c],i=v[e.identifier]){if(t)break;n=e,t=i}if(i){var s=(s=e[0]-n[0])*s+(s=e[1]-n[1])*s,f=m&&Math.sqrt(s/m);n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+i[0])/2,(t[1]+i[1])/2],r(f*g)}M=null,u(n,t),a(d)}function h(){if(mo.event.touches.length){for(var t=mo.event.changedTouches,e=0,r=t.length;r>e;++e)delete v[t[e].identifier];for(var u in v)return void n()}_.on(x,null).on(b,null),w.on(A,l).on(q,s),E(),c(d)}var g,p=this,d=C.of(p,arguments),v={},m=0,y=mo.event.changedTouches[0].identifier,x="touchmove.zoom-"+y,b="touchend.zoom-"+y,_=mo.select(_o).on(x,i).on(b,h),w=mo.select(p).on(A,null).on(q,e),E=L();z.call(p),e(),o(d)}function h(){var n=C.of(this,arguments);y?clearTimeout(y):(z.call(this),o(n)),y=setTimeout(function(){y=null,c(n)},50),f();var e=m||mo.mouse(this);v||(v=t(e)),r(Math.pow(2,.002*ua())*S.k),u(e,v),a(n)}function p(){v=null}function d(){var n=C.of(this,arguments),e=mo.mouse(this),i=t(e),l=Math.log(S.k)/Math.LN2;o(n),r(Math.pow(2,mo.event.shiftKey?Math.ceil(l)-1:Math.floor(l)+1)),u(e,i),a(n),c(n)}var v,m,y,M,x,b,_,w,S={x:0,y:0,k:1},E=[960,500],k=ia,A="mousedown.zoom",N="mousemove.zoom",T="mouseup.zoom",q="touchstart.zoom",C=g(n,"zoomstart","zoom","zoomend");return n.event=function(n){n.each(function(){var n=C.of(this,arguments),t=S;Oc?mo.select(this).transition().each("start.zoom",function(){S=this.__chart__||{x:0,y:0,k:1},o(n)}).tween("zoom:zoom",function(){var e=E[0],r=E[1],u=e/2,i=r/2,o=mo.interpolateZoom([(u-S.x)/S.k,(i-S.y)/S.k,e/S.k],[(u-t.x)/t.k,(i-t.y)/t.k,e/t.k]);return function(t){var r=o(t),c=e/r[2];this.__chart__=S={x:u-r[0]*c,y:i-r[1]*c,k:c},a(n)}}).each("end.zoom",function(){c(n)}):(this.__chart__=S,o(n),a(n),c(n))})},n.translate=function(t){return arguments.length?(S={x:+t[0],y:+t[1],k:S.k},i(),n):[S.x,S.y]},n.scale=function(t){return arguments.length?(S={x:S.x,y:S.y,k:+t},i(),n):S.k},n.scaleExtent=function(t){return arguments.length?(k=null==t?ia:[+t[0],+t[1]],n):k},n.center=function(t){return arguments.length?(m=t&&[+t[0],+t[1]],n):m},n.size=function(t){return arguments.length?(E=t&&[+t[0],+t[1]],n):E},n.x=function(t){return arguments.length?(b=t,x=t.copy(),S={x:0,y:0,k:1},n):b},n.y=function(t){return arguments.length?(w=t,_=t.copy(),S={x:0,y:0,k:1},n):w},mo.rebind(n,C,"on")};var ua,ia=[0,1/0],oa="onwheel"in xo?(ua=function(){return-mo.event.deltaY*(mo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in xo?(ua=function(){return mo.event.wheelDelta},"mousewheel"):(ua=function(){return-mo.event.detail},"MozMousePixelScroll");Z.prototype.toString=function(){return this.rgb()+""},mo.hsl=function(n,t,e){return 1===arguments.length?n instanceof X?V(n.h,n.s,n.l):lt(""+n,st,V):V(+n,+t,+e)};var aa=X.prototype=new Z;aa.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),V(this.h,this.s,this.l/n)},aa.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),V(this.h,this.s,n*this.l)},aa.rgb=function(){return $(this.h,this.s,this.l)},mo.hcl=function(n,t,e){return 1===arguments.length?n instanceof W?B(n.h,n.c,n.l):n instanceof K?nt(n.l,n.a,n.b):nt((n=ft((n=mo.rgb(n)).r,n.g,n.b)).l,n.a,n.b):B(+n,+t,+e)};var ca=W.prototype=new Z;ca.brighter=function(n){return B(this.h,this.c,Math.min(100,this.l+la*(arguments.length?n:1)))},ca.darker=function(n){return B(this.h,this.c,Math.max(0,this.l-la*(arguments.length?n:1)))},ca.rgb=function(){return J(this.h,this.c,this.l).rgb()},mo.lab=function(n,t,e){return 1===arguments.length?n instanceof K?G(n.l,n.a,n.b):n instanceof W?J(n.l,n.c,n.h):ft((n=mo.rgb(n)).r,n.g,n.b):G(+n,+t,+e)};var la=18,sa=.95047,fa=1,ha=1.08883,ga=K.prototype=new Z;ga.brighter=function(n){return G(Math.min(100,this.l+la*(arguments.length?n:1)),this.a,this.b)},ga.darker=function(n){return G(Math.max(0,this.l-la*(arguments.length?n:1)),this.a,this.b)},ga.rgb=function(){return Q(this.l,this.a,this.b)},mo.rgb=function(n,t,e){return 1===arguments.length?n instanceof at?ot(n.r,n.g,n.b):lt(""+n,ot,$):ot(~~n,~~t,~~e)};var pa=at.prototype=new Z;pa.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,u=30;return t||e||r?(t&&u>t&&(t=u),e&&u>e&&(e=u),r&&u>r&&(r=u),ot(Math.min(255,~~(t/n)),Math.min(255,~~(e/n)),Math.min(255,~~(r/n)))):ot(u,u,u)},pa.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),ot(~~(n*this.r),~~(n*this.g),~~(n*this.b))},pa.hsl=function(){return st(this.r,this.g,this.b)},pa.toString=function(){return"#"+ct(this.r)+ct(this.g)+ct(this.b)};var da=mo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});da.forEach(function(n,t){da.set(n,ut(t))}),mo.functor=pt,mo.xhr=vt(dt),mo.dsv=function(n,t){function e(n,e,i){arguments.length<3&&(i=e,e=null);var o=mo.xhr(n,t,i);return o.row=function(n){return arguments.length?o.response(null==(e=n)?r:u(n)):e},o.row(e)}function r(n){return e.parse(n.responseText)}function u(n){return function(t){return e.parse(t.responseText,n)}}function o(t){return t.map(a).join(n)}function a(n){return c.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var c=new RegExp('["'+n+"\n]"),l=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var u=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(u(n),e)}:u})},e.parseRows=function(n,t){function e(){if(s>=c)return o;if(u)return u=!1,i;var t=s;if(34===n.charCodeAt(t)){for(var e=t;e++<c;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}s=e+2;var r=n.charCodeAt(e+1);return 13===r?(u=!0,10===n.charCodeAt(e+2)&&++s):10===r&&(u=!0),n.substring(t+1,e).replace(/""/g,'"')}for(;c>s;){var r=n.charCodeAt(s++),a=1;if(10===r)u=!0;else if(13===r)u=!0,10===n.charCodeAt(s)&&(++s,++a);else if(r!==l)continue;return n.substring(t,s-a)}return n.substring(t)}for(var r,u,i={},o={},a=[],c=n.length,s=0,f=0;(r=e())!==o;){for(var h=[];r!==i&&r!==o;)h.push(r),r=e();(!t||(h=t(h,f++)))&&a.push(h)}return a},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new i,u=[];return t.forEach(function(n){for(var t in n)r.has(t)||u.push(r.add(t))}),[u.map(a).join(n)].concat(t.map(function(t){return u.map(function(n){return a(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(o).join("\n")},e},mo.csv=mo.dsv(",","text/csv"),mo.tsv=mo.dsv("  ","text/tab-separated-values");var va,ma,ya,Ma,xa,ba=_o[a(_o,"requestAnimationFrame")]||function(n){setTimeout(n,17)};mo.timer=function(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now());var u=e+t,i={callback:n,time:u,next:null};ma?ma.next=i:va=i,ma=i,ya||(Ma=clearTimeout(Ma),ya=1,ba(Mt))},mo.timer.flush=function(){bt(),_t()};var _a=".",wa=",",Sa=[3,3],Ea="$",ka=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"].map(wt);mo.formatPrefix=function(n,t){var e=0;return n&&(0>n&&(n*=-1),t&&(n=mo.round(n,St(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((0>=e?e+1:e-1)/3)))),ka[8+e/3]},mo.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)},mo.format=function(n){var t=Aa.exec(n),e=t[1]||" ",r=t[2]||">",u=t[3]||"",i=t[4]||"",o=t[5],a=+t[6],c=t[7],l=t[8],s=t[9],f=1,h="",g=!1;switch(l&&(l=+l.substring(1)),(o||"0"===e&&"="===r)&&(o=e="0",r="=",c&&(a-=Math.floor((a-1)/4))),s){case"n":c=!0,s="g";break;case"%":f=100,h="%",s="f";break;case"p":f=100,h="%",s="r";break;case"b":case"o":case"x":case"X":"#"===i&&(i="0"+s.toLowerCase());case"c":case"d":g=!0,l=0;break;case"s":f=-1,s="r"}"#"===i?i="":"$"===i&&(i=Ea),"r"!=s||l||(s="g"),null!=l&&("g"==s?l=Math.max(1,Math.min(21,l)):("e"==s||"f"==s)&&(l=Math.max(0,Math.min(20,l)))),s=Na.get(s)||Et;var p=o&&c;return function(n){if(g&&n%1)return"";var t=0>n||0===n&&0>1/n?(n=-n,"-"):u;if(0>f){var d=mo.formatPrefix(n,l);n=d.scale(n),h=d.symbol}else n*=f;n=s(n,l);var v=n.lastIndexOf("."),m=0>v?n:n.substring(0,v),y=0>v?"":_a+n.substring(v+1);!o&&c&&(m=Ta(m));var M=i.length+m.length+y.length+(p?0:t.length),x=a>M?new Array(M=a-M+1).join(e):"";return p&&(m=Ta(x+m)),t+=i,n=m+y,("<"===r?t+n+x:">"===r?x+t+n:"^"===r?x.substring(0,M>>=1)+t+n+x.substring(M):t+(p?n:x+n))+h}};var Aa=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Na=mo.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=mo.round(n,St(n,t))).toFixed(Math.max(0,Math.min(20,St(n*(1+1e-15),t))))}}),Ta=dt;if(Sa){var qa=Sa.length;Ta=function(n){for(var t=n.length,e=[],r=0,u=Sa[0];t>0&&u>0;)e.push(n.substring(t-=u,t+u)),u=Sa[r=(r+1)%qa];return e.reverse().join(wa)}}mo.geo={},kt.prototype={s:0,t:0,add:function(n){At(n,this.t,za),At(za.s,this.s,this),this.s?this.t+=za.t:this.s=za.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var za=new kt;mo.geo.stream=function(n,t){n&&Ca.hasOwnProperty(n.type)?Ca[n.type](n,t):Nt(n,t)};var Ca={Feature:function(n,t){Nt(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,u=e.length;++r<u;)Nt(e[r].geometry,t)}},Da={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){Tt(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)Tt(e[r],t,0)},Polygon:function(n,t){qt(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)qt(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,u=e.length;++r<u;)Nt(e[r],t)}};mo.geo.area=function(n){return ja=0,mo.geo.stream(n,Ha),ja};var ja,La=new kt,Ha={sphere:function(){ja+=4*Bo},point:c,lineStart:c,lineEnd:c,polygonStart:function(){La.reset(),Ha.lineStart=zt},polygonEnd:function(){var n=2*La;ja+=0>n?4*Bo+n:n,Ha.lineStart=Ha.lineEnd=Ha.point=c}};mo.geo.bounds=function(){function n(n,t){M.push(x=[s=n,h=n]),f>t&&(f=t),t>g&&(g=t)}function t(t,e){var r=Ct([t*Qo,e*Qo]);if(m){var u=jt(m,r),i=[u[1],-u[0],0],o=jt(i,u);Ft(o),o=Pt(o);var c=t-p,l=c>0?1:-1,d=o[0]*na*l,v=Math.abs(c)>180;if(v^(d>l*p&&l*t>d)){var y=o[1]*na;y>g&&(g=y)}else if(d=(d+360)%360-180,v^(d>l*p&&l*t>d)){var y=-o[1]*na;f>y&&(f=y)}else f>e&&(f=e),e>g&&(g=e);v?p>t?a(s,t)>a(s,h)&&(h=t):a(t,h)>a(s,h)&&(s=t):h>=s?(s>t&&(s=t),t>h&&(h=t)):t>p?a(s,t)>a(s,h)&&(h=t):a(t,h)>a(s,h)&&(s=t)}else n(t,e);m=r,p=t}function e(){b.point=t}function r(){x[0]=s,x[1]=h,b.point=n,m=null}function u(n,e){if(m){var r=n-p;y+=Math.abs(r)>180?r+(r>0?360:-360):r}else d=n,v=e;Ha.point(n,e),t(n,e)}function i(){Ha.lineStart()}function o(){u(d,v),Ha.lineEnd(),Math.abs(y)>Go&&(s=-(h=180)),x[0]=s,x[1]=h,m=null}function a(n,t){return(t-=n)<0?t+360:t}function c(n,t){return n[0]-t[0]}function l(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var s,f,h,g,p,d,v,m,y,M,x,b={point:n,lineStart:e,lineEnd:r,polygonStart:function(){b.point=u,b.lineStart=i,b.lineEnd=o,y=0,Ha.polygonStart()},polygonEnd:function(){Ha.polygonEnd(),b.point=n,b.lineStart=e,b.lineEnd=r,0>La?(s=-(h=180),f=-(g=90)):y>Go?g=90:-Go>y&&(f=-90),x[0]=s,x[1]=h}};return function(n){g=h=-(s=f=1/0),M=[],mo.geo.stream(n,b);var t=M.length;if(t){M.sort(c);for(var e,r=1,u=M[0],i=[u];t>r;++r)e=M[r],l(e[0],u)||l(e[1],u)?(a(u[0],e[1])>a(u[0],u[1])&&(u[1]=e[1]),a(e[0],u[1])>a(u[0],u[1])&&(u[0]=e[0])):i.push(u=e);for(var o,e,p=-1/0,t=i.length-1,r=0,u=i[t];t>=r;u=e,++r)e=i[r],(o=a(u[1],e[0]))>p&&(p=o,s=e[0],h=u[1])}return M=x=null,1/0===s||1/0===f?[[0/0,0/0],[0/0,0/0]]:[[s,f],[h,g]]}}(),mo.geo.centroid=function(n){Fa=Pa=Oa=Ra=Ya=Ia=Ua=Za=Va=Xa=$a=0,mo.geo.stream(n,Ba);var t=Va,e=Xa,r=$a,u=t*t+e*e+r*r;return Ko>u&&(t=Ia,e=Ua,r=Za,Go>Pa&&(t=Oa,e=Ra,r=Ya),u=t*t+e*e+r*r,Ko>u)?[0/0,0/0]:[Math.atan2(e,t)*na,O(r/Math.sqrt(u))*na]};var Fa,Pa,Oa,Ra,Ya,Ia,Ua,Za,Va,Xa,$a,Ba={sphere:c,point:Rt,lineStart:It,lineEnd:Ut,polygonStart:function(){Ba.lineStart=Zt},polygonEnd:function(){Ba.lineStart=It}},Wa=Bt(Vt,Qt,te,[-Bo,-Bo/2]),Ja=1e9;mo.geo.clipExtent=function(){var n,t,e,r,u,i,o={stream:function(n){return u&&(u.valid=!1),u=i(n),u.valid=!0,u},extent:function(a){return arguments.length?(i=re(n=+a[0][0],t=+a[0][1],e=+a[1][0],r=+a[1][1]),u&&(u.valid=!1,u=null),o):[[n,t],[e,r]]}};return o.extent([[0,0],[960,500]])},(mo.geo.conicEqualArea=function(){return oe(ae)}).raw=ae,mo.geo.albers=function(){return mo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},mo.geo.albersUsa=function(){function n(n){var i=n[0],o=n[1];return t=null,e(i,o),t||(r(i,o),t)||u(i,o),t}var t,e,r,u,i=mo.geo.albers(),o=mo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=mo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(n,e){t=[n,e]}};return n.invert=function(n){var t=i.scale(),e=i.translate(),r=(n[0]-e[0])/t,u=(n[1]-e[1])/t;return(u>=.12&&.234>u&&r>=-.425&&-.214>r?o:u>=.166&&.234>u&&r>=-.214&&-.115>r?a:i).invert(n)},n.stream=function(n){var t=i.stream(n),e=o.stream(n),r=a.stream(n);return{point:function(n,u){t.point(n,u),e.point(n,u),r.point(n,u)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(i.precision(t),o.precision(t),a.precision(t),n):i.precision()},n.scale=function(t){return arguments.length?(i.scale(t),o.scale(.35*t),a.scale(t),n.translate(i.translate())):i.scale()},n.translate=function(t){if(!arguments.length)return i.translate();var l=i.scale(),s=+t[0],f=+t[1];return e=i.translate(t).clipExtent([[s-.455*l,f-.238*l],[s+.455*l,f+.238*l]]).stream(c).point,r=o.translate([s-.307*l,f+.201*l]).clipExtent([[s-.425*l+Go,f+.12*l+Go],[s-.214*l-Go,f+.234*l-Go]]).stream(c).point,u=a.translate([s-.205*l,f+.212*l]).clipExtent([[s-.214*l+Go,f+.166*l+Go],[s-.115*l-Go,f+.234*l-Go]]).stream(c).point,n},n.scale(1070)};var Ga,Ka,Qa,nc,tc,ec,rc={point:c,lineStart:c,lineEnd:c,polygonStart:function(){Ka=0,rc.lineStart=ce},polygonEnd:function(){rc.lineStart=rc.lineEnd=rc.point=c,Ga+=Math.abs(Ka/2)}},uc={point:le,lineStart:c,lineEnd:c,polygonStart:c,polygonEnd:c},ic={point:he,lineStart:ge,lineEnd:pe,polygonStart:function(){ic.lineStart=de},polygonEnd:function(){ic.point=he,ic.lineStart=ge,ic.lineEnd=pe}};mo.geo.transform=function(n){return{stream:function(t){var e=new ye(t);for(var r in n)e[r]=n[r];return e}}},ye.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},mo.geo.path=function(){function n(n){return n&&("function"==typeof a&&i.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=u(i)),mo.geo.stream(n,o)),i.result()}function t(){return o=null,n}var e,r,u,i,o,a=4.5;return n.area=function(n){return Ga=0,mo.geo.stream(n,u(rc)),Ga},n.centroid=function(n){return Oa=Ra=Ya=Ia=Ua=Za=Va=Xa=$a=0,mo.geo.stream(n,u(ic)),$a?[Va/$a,Xa/$a]:Za?[Ia/Za,Ua/Za]:Ya?[Oa/Ya,Ra/Ya]:[0/0,0/0]},n.bounds=function(n){return tc=ec=-(Qa=nc=1/0),mo.geo.stream(n,u(uc)),[[Qa,nc],[tc,ec]]},n.projection=function(n){return arguments.length?(u=(e=n)?n.stream||Me(n):dt,t()):e},n.context=function(n){return arguments.length?(i=null==(r=n)?new se:new ve(n),"function"!=typeof a&&i.pointRadius(a),t()):r},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(i.pointRadius(+t),+t),n):a},n.projection(mo.geo.albersUsa()).context(null)},mo.geo.projection=xe,mo.geo.projectionMutator=be,(mo.geo.equirectangular=function(){return xe(we)}).raw=we.invert=we,mo.geo.rotation=function(n){function t(t){return t=n(t[0]*Qo,t[1]*Qo),t[0]*=na,t[1]*=na,t}return n=Ee(n[0]%360*Qo,n[1]*Qo,n.length>2?n[2]*Qo:0),t.invert=function(t){return t=n.invert(t[0]*Qo,t[1]*Qo),t[0]*=na,t[1]*=na,t},t},Se.invert=we,mo.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=Ee(-n[0]*Qo,-n[1]*Qo,0).invert,u=[];return e(null,null,1,{point:function(n,e){u.push(n=t(n,e)),n[0]*=na,n[1]*=na}}),{type:"Polygon",coordinates:[u]}}var t,e,r=[0,0],u=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=Te((t=+r)*Qo,u*Qo),n):t},n.precision=function(r){return arguments.length?(e=Te(t*Qo,(u=+r)*Qo),n):u},n.angle(90)},mo.geo.distance=function(n,t){var e,r=(t[0]-n[0])*Qo,u=n[1]*Qo,i=t[1]*Qo,o=Math.sin(r),a=Math.cos(r),c=Math.sin(u),l=Math.cos(u),s=Math.sin(i),f=Math.cos(i);return Math.atan2(Math.sqrt((e=f*o)*e+(e=l*s-c*f*a)*e),c*s+l*f*a)},mo.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return mo.range(Math.ceil(i/v)*v,u,v).map(h).concat(mo.range(Math.ceil(l/m)*m,c,m).map(g)).concat(mo.range(Math.ceil(r/p)*p,e,p).filter(function(n){return Math.abs(n%v)>Go
}).map(s)).concat(mo.range(Math.ceil(a/d)*d,o,d).filter(function(n){return Math.abs(n%m)>Go}).map(f))}var e,r,u,i,o,a,c,l,s,f,h,g,p=10,d=p,v=90,m=360,y=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(g(c).slice(1),h(u).reverse().slice(1),g(l).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(i=+t[0][0],u=+t[1][0],l=+t[0][1],c=+t[1][1],i>u&&(t=i,i=u,u=t),l>c&&(t=l,l=c,c=t),n.precision(y)):[[i,l],[u,c]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],o=+t[1][1],r>e&&(t=r,r=e,e=t),a>o&&(t=a,a=o,o=t),n.precision(y)):[[r,a],[e,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(v=+t[0],m=+t[1],n):[v,m]},n.minorStep=function(t){return arguments.length?(p=+t[0],d=+t[1],n):[p,d]},n.precision=function(t){return arguments.length?(y=+t,s=ze(a,o,90),f=Ce(r,e,y),h=ze(l,c,90),g=Ce(i,u,y),n):y},n.majorExtent([[-180,-90+Go],[180,90-Go]]).minorExtent([[-180,-80-Go],[180,80+Go]])},mo.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||u.apply(this,arguments)]}}var t,e,r=De,u=je;return n.distance=function(){return mo.geo.distance(t||r.apply(this,arguments),e||u.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(u=t,e="function"==typeof t?null:t,n):u},n.precision=function(){return arguments.length?n:0},n},mo.geo.interpolate=function(n,t){return Le(n[0]*Qo,n[1]*Qo,t[0]*Qo,t[1]*Qo)},mo.geo.length=function(n){return oc=0,mo.geo.stream(n,ac),oc};var oc,ac={sphere:c,point:c,lineStart:He,lineEnd:c,polygonStart:c,polygonEnd:c},cc=Fe(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(mo.geo.azimuthalEqualArea=function(){return xe(cc)}).raw=cc;var lc=Fe(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},dt);(mo.geo.azimuthalEquidistant=function(){return xe(lc)}).raw=lc,(mo.geo.conicConformal=function(){return oe(Pe)}).raw=Pe,(mo.geo.conicEquidistant=function(){return oe(Oe)}).raw=Oe;var sc=Fe(function(n){return 1/n},Math.atan);(mo.geo.gnomonic=function(){return xe(sc)}).raw=sc,Re.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Jo]},(mo.geo.mercator=function(){return Ye(Re)}).raw=Re;var fc=Fe(function(){return 1},Math.asin);(mo.geo.orthographic=function(){return xe(fc)}).raw=fc;var hc=Fe(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(mo.geo.stereographic=function(){return xe(hc)}).raw=hc,Ie.invert=function(n,t){return[Math.atan2(R(n),Math.cos(t)),O(Math.sin(t)/Y(n))]},(mo.geo.transverseMercator=function(){return Ye(Ie)}).raw=Ie,mo.geom={},mo.svg={},mo.svg.line=function(){return Ue(dt)};var gc=mo.map({linear:Xe,"linear-closed":$e,step:Be,"step-before":We,"step-after":Je,basis:er,"basis-open":rr,"basis-closed":ur,bundle:ir,cardinal:Qe,"cardinal-open":Ge,"cardinal-closed":Ke,monotone:fr});gc.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var pc=[0,2/3,1/3,0],dc=[0,1/3,2/3,0],vc=[0,1/6,2/3,1/6];mo.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,u,i,o,a,c,l,s,f,h,g,p,d=pt(e),v=pt(r),m=n.length,y=m-1,M=[],x=[],b=0;if(d===Ze&&r===Ve)t=n;else for(i=0,t=[];m>i;++i)t.push([+d.call(this,u=n[i],i),+v.call(this,u,i)]);for(i=1;m>i;++i)(t[i][1]<t[b][1]||t[i][1]==t[b][1]&&t[i][0]<t[b][0])&&(b=i);for(i=0;m>i;++i)i!==b&&(c=t[i][1]-t[b][1],a=t[i][0]-t[b][0],M.push({angle:Math.atan2(c,a),index:i}));for(M.sort(function(n,t){return n.angle-t.angle}),g=M[0].angle,h=M[0].index,f=0,i=1;y>i;++i){if(o=M[i].index,g==M[i].angle){if(a=t[h][0]-t[b][0],c=t[h][1]-t[b][1],l=t[o][0]-t[b][0],s=t[o][1]-t[b][1],a*a+c*c>=l*l+s*s){M[i].index=-1;continue}M[f].index=-1}g=M[i].angle,f=i,h=o}for(x.push(b),i=0,o=0;2>i;++o)M[o].index>-1&&(x.push(M[o].index),i++);for(p=x.length;y>o;++o)if(!(M[o].index<0)){for(;!hr(x[p-2],x[p-1],M[o].index,t);)--p;x[p++]=M[o].index}var _=[];for(i=p-1;i>=0;--i)_.push(n[x[i]]);return _}var e=Ze,r=Ve;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},mo.geom.polygon=function(n){return Lo(n,mc),n};var mc=mo.geom.polygon.prototype=[];mc.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],u=0;++t<e;)n=r,r=this[t],u+=n[1]*r[0]-n[0]*r[1];return.5*u},mc.centroid=function(n){var t,e,r=-1,u=this.length,i=0,o=0,a=this[u-1];for(arguments.length||(n=-1/(6*this.area()));++r<u;)t=a,a=this[r],e=t[0]*a[1]-a[0]*t[1],i+=(t[0]+a[0])*e,o+=(t[1]+a[1])*e;return[i*n,o*n]},mc.clip=function(n){for(var t,e,r,u,i,o,a=dr(n),c=-1,l=this.length-dr(this),s=this[l-1];++c<l;){for(t=n.slice(),n.length=0,u=this[c],i=t[(r=t.length-a)-1],e=-1;++e<r;)o=t[e],gr(o,s,u)?(gr(i,s,u)||n.push(pr(i,o,s,u)),n.push(o)):gr(i,s,u)&&n.push(pr(i,o,s,u)),i=o;a&&n.push(n[0]),s=u}return n},mo.geom.delaunay=function(n){var t=n.map(function(){return[]}),e=[];return vr(n,function(e){t[e.region.l.index].push(n[e.region.r.index])}),t.forEach(function(t,r){var u=n[r],i=u[0],o=u[1];t.forEach(function(n){n.angle=Math.atan2(n[0]-i,n[1]-o)}),t.sort(function(n,t){return n.angle-t.angle});for(var a=0,c=t.length-1;c>a;a++)e.push([u,t[a],t[a+1]])}),e},mo.geom.voronoi=function(n){function t(n){var t,i,o,a=n.map(function(){return[]}),c=pt(e),l=pt(r),s=n.length,f=1e6;if(c===Ze&&l===Ve)t=n;else for(t=new Array(s),o=0;s>o;++o)t[o]=[+c.call(this,i=n[o],o),+l.call(this,i,o)];if(vr(t,function(n){var t,e,r,u,i,o;1===n.a&&n.b>=0?(t=n.ep.r,e=n.ep.l):(t=n.ep.l,e=n.ep.r),1===n.a?(i=t?t.y:-f,r=n.c-n.b*i,o=e?e.y:f,u=n.c-n.b*o):(r=t?t.x:-f,i=n.c-n.a*r,u=e?e.x:f,o=n.c-n.a*u);var c=[r,i],l=[u,o];a[n.region.l.index].push(c,l),a[n.region.r.index].push(c,l)}),a=a.map(function(n,e){var r=t[e][0],u=t[e][1],i=n.map(function(n){return Math.atan2(n[0]-r,n[1]-u)}),o=mo.range(n.length).sort(function(n,t){return i[n]-i[t]});return o.filter(function(n,t){return!t||i[n]-i[o[t-1]]>Go}).map(function(t){return n[t]})}),a.forEach(function(n,e){var r=n.length;if(!r)return n.push([-f,-f],[-f,f],[f,f],[f,-f]);if(!(r>2)){var u=t[e],i=n[0],o=n[1],a=u[0],c=u[1],l=i[0],s=i[1],h=o[0],g=o[1],p=Math.abs(h-l),d=g-s;if(Math.abs(d)<Go){var v=s>c?-f:f;n.push([-f,v],[f,v])}else if(Go>p){var m=l>a?-f:f;n.push([m,-f],[m,f])}else{var v=(l-a)*(g-s)>(h-l)*(s-c)?f:-f,y=Math.abs(d)-p;Math.abs(y)<Go?n.push([0>d?v:-v,v]):(y>0&&(v*=-1),n.push([-f,v],[f,v]))}}}),u)for(o=0;s>o;++o)u.clip(a[o]);for(o=0;s>o;++o)a[o].point=n[o];return a}var e=Ze,r=Ve,u=null;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.clipExtent=function(n){if(!arguments.length)return u&&[u[0],u[2]];if(null==n)u=null;else{var e=+n[0][0],r=+n[0][1],i=+n[1][0],o=+n[1][1];u=mo.geom.polygon([[e,r],[e,o],[i,o],[i,r]])}return t},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):u&&u[2]},t.links=function(n){var t,u,i,o=n.map(function(){return[]}),a=[],c=pt(e),l=pt(r),s=n.length;if(c===Ze&&l===Ve)t=n;else for(t=new Array(s),i=0;s>i;++i)t[i]=[+c.call(this,u=n[i],i),+l.call(this,u,i)];return vr(t,function(t){var e=t.region.l.index,r=t.region.r.index;o[e][r]||(o[e][r]=o[r][e]=!0,a.push({source:n[e],target:n[r]}))}),a},t.triangles=function(n){if(e===Ze&&r===Ve)return mo.geom.delaunay(n);for(var t,u=new Array(c),i=pt(e),o=pt(r),a=-1,c=n.length;++a<c;)(u[a]=[+i.call(this,t=n[a],a),+o.call(this,t,a)]).data=t;return mo.geom.delaunay(u).map(function(n){return n.map(function(n){return n.data})})},t)};var yc={l:"r",r:"l"};mo.geom.quadtree=function(n,t,e,r,u){function i(n){function i(n,t,e,r,u,i,o,a){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var c=n.x,s=n.y;if(null!=c)if(Math.abs(c-e)+Math.abs(s-r)<.01)l(n,t,e,r,u,i,o,a);else{var f=n.point;n.x=n.y=n.point=null,l(n,f,c,s,u,i,o,a),l(n,t,e,r,u,i,o,a)}else n.x=e,n.y=r,n.point=t}else l(n,t,e,r,u,i,o,a)}function l(n,t,e,r,u,o,a,c){var l=.5*(u+a),s=.5*(o+c),f=e>=l,h=r>=s,g=(h<<1)+f;n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=Mr()),f?u=l:a=l,h?o=s:c=s,i(n,t,e,r,u,o,a,c)}var s,f,h,g,p,d,v,m,y,M=pt(a),x=pt(c);if(null!=t)d=t,v=e,m=r,y=u;else if(m=y=-(d=v=1/0),f=[],h=[],p=n.length,o)for(g=0;p>g;++g)s=n[g],s.x<d&&(d=s.x),s.y<v&&(v=s.y),s.x>m&&(m=s.x),s.y>y&&(y=s.y),f.push(s.x),h.push(s.y);else for(g=0;p>g;++g){var b=+M(s=n[g],g),_=+x(s,g);d>b&&(d=b),v>_&&(v=_),b>m&&(m=b),_>y&&(y=_),f.push(b),h.push(_)}var w=m-d,S=y-v;w>S?y=v+w:m=d+S;var E=Mr();if(E.add=function(n){i(E,n,+M(n,++g),+x(n,g),d,v,m,y)},E.visit=function(n){xr(n,E,d,v,m,y)},g=-1,null==t){for(;++g<p;)i(E,n[g],f[g],h[g],d,v,m,y);--g}else n.forEach(E.add);return f=h=n=s=null,E}var o,a=Ze,c=Ve;return(o=arguments.length)?(a=mr,c=yr,3===o&&(u=e,r=t,e=t=0),i(n)):(i.x=function(n){return arguments.length?(a=n,i):a},i.y=function(n){return arguments.length?(c=n,i):c},i.extent=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],u=+n[1][1]),i):null==t?null:[[t,e],[r,u]]},i.size=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=e=0,r=+n[0],u=+n[1]),i):null==t?null:[r-t,u-e]},i)},mo.interpolateRgb=br,mo.interpolateObject=_r,mo.interpolateNumber=wr,mo.interpolateString=Sr;var Mc=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;mo.interpolate=Er,mo.interpolators=[function(n,t){var e=typeof t;return("string"===e?da.has(t)||/^(#|rgb\(|hsl\()/.test(t)?br:Sr:t instanceof Z?br:"object"===e?Array.isArray(t)?kr:_r:wr)(n,t)}],mo.interpolateArray=kr;var xc=function(){return dt},bc=mo.map({linear:xc,poly:Dr,quad:function(){return qr},cubic:function(){return zr},sin:function(){return jr},exp:function(){return Lr},circle:function(){return Hr},elastic:Fr,back:Pr,bounce:function(){return Or}}),_c=mo.map({"in":dt,out:Nr,"in-out":Tr,"out-in":function(n){return Tr(Nr(n))}});mo.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.substring(0,t):n,r=t>=0?n.substring(t+1):"in";return e=bc.get(e)||xc,r=_c.get(r)||dt,Ar(r(e.apply(null,Array.prototype.slice.call(arguments,1))))},mo.interpolateHcl=Rr,mo.interpolateHsl=Yr,mo.interpolateLab=Ir,mo.interpolateRound=Ur,mo.transform=function(n){var t=xo.createElementNS(mo.ns.prefix.svg,"g");return(mo.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate()}return new Zr(e?e.matrix:wc)})(n)},Zr.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var wc={a:1,b:0,c:0,d:1,e:0,f:0};mo.interpolateTransform=Br,mo.layout={},mo.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Gr(n[e]));return t}},mo.layout.chord=function(){function n(){var n,l,f,h,g,p={},d=[],v=mo.range(i),m=[];for(e=[],r=[],n=0,h=-1;++h<i;){for(l=0,g=-1;++g<i;)l+=u[h][g];d.push(l),m.push(mo.range(i)),n+=l}for(o&&v.sort(function(n,t){return o(d[n],d[t])}),a&&m.forEach(function(n,t){n.sort(function(n,e){return a(u[t][n],u[t][e])})}),n=(Wo-s*i)/n,l=0,h=-1;++h<i;){for(f=l,g=-1;++g<i;){var y=v[h],M=m[y][g],x=u[y][M],b=l,_=l+=x*n;p[y+"-"+M]={index:y,subindex:M,startAngle:b,endAngle:_,value:x}}r[y]={index:y,startAngle:f,endAngle:l,value:(l-f)/n},l+=s}for(h=-1;++h<i;)for(g=h-1;++g<i;){var w=p[h+"-"+g],S=p[g+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}c&&t()}function t(){e.sort(function(n,t){return c((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,u,i,o,a,c,l={},s=0;return l.matrix=function(n){return arguments.length?(i=(u=n)&&u.length,e=r=null,l):u},l.padding=function(n){return arguments.length?(s=n,e=r=null,l):s},l.sortGroups=function(n){return arguments.length?(o=n,e=r=null,l):o},l.sortSubgroups=function(n){return arguments.length?(a=n,e=null,l):a},l.sortChords=function(n){return arguments.length?(c=n,e&&t(),l):c},l.chords=function(){return e||n(),e},l.groups=function(){return r||n(),r},l},mo.layout.force=function(){function n(n){return function(t,e,r,u){if(t.point!==n){var i=t.cx-n.x,o=t.cy-n.y,a=1/Math.sqrt(i*i+o*o);if(d>(u-e)*a){var c=t.charge*a*a;return n.px-=i*c,n.py-=o*c,!0}if(t.point&&isFinite(a)){var c=t.pointCharge*a*a;n.px-=i*c,n.py-=o*c}}return!t.charge}}function t(n){n.px=mo.event.x,n.py=mo.event.y,a.resume()}var e,r,u,i,o,a={},c=mo.dispatch("start","tick","end"),l=[1,1],s=.9,f=Sc,h=Ec,g=-30,p=.1,d=.8,v=[],m=[];return a.tick=function(){if((r*=.99)<.005)return c.end({type:"end",alpha:r=0}),!0;var t,e,a,f,h,d,y,M,x,b=v.length,_=m.length;for(e=0;_>e;++e)a=m[e],f=a.source,h=a.target,M=h.x-f.x,x=h.y-f.y,(d=M*M+x*x)&&(d=r*i[e]*((d=Math.sqrt(d))-u[e])/d,M*=d,x*=d,h.x-=M*(y=f.weight/(h.weight+f.weight)),h.y-=x*y,f.x+=M*(y=1-y),f.y+=x*y);if((y=r*p)&&(M=l[0]/2,x=l[1]/2,e=-1,y))for(;++e<b;)a=v[e],a.x+=(M-a.x)*y,a.y+=(x-a.y)*y;if(g)for(uu(t=mo.geom.quadtree(v),r,o),e=-1;++e<b;)(a=v[e]).fixed||t.visit(n(a));for(e=-1;++e<b;)a=v[e],a.fixed?(a.x=a.px,a.y=a.py):(a.x-=(a.px-(a.px=a.x))*s,a.y-=(a.py-(a.py=a.y))*s);c.tick({type:"tick",alpha:r})},a.nodes=function(n){return arguments.length?(v=n,a):v},a.links=function(n){return arguments.length?(m=n,a):m},a.size=function(n){return arguments.length?(l=n,a):l},a.linkDistance=function(n){return arguments.length?(f="function"==typeof n?n:+n,a):f},a.distance=a.linkDistance,a.linkStrength=function(n){return arguments.length?(h="function"==typeof n?n:+n,a):h},a.friction=function(n){return arguments.length?(s=+n,a):s},a.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,a):g},a.gravity=function(n){return arguments.length?(p=+n,a):p},a.theta=function(n){return arguments.length?(d=+n,a):d},a.alpha=function(n){return arguments.length?(n=+n,r?r=n>0?n:0:n>0&&(c.start({type:"start",alpha:r=n}),mo.timer(a.tick)),a):r},a.start=function(){function n(n,r){for(var u,i=t(e),o=-1,a=i.length;++o<a;)if(!isNaN(u=i[o][n]))return u;return Math.random()*r}function t(){if(!c){for(c=[],r=0;p>r;++r)c[r]=[];for(r=0;d>r;++r){var n=m[r];c[n.source.index].push(n.target),c[n.target.index].push(n.source)}}return c[e]}var e,r,c,s,p=v.length,d=m.length,y=l[0],M=l[1];for(e=0;p>e;++e)(s=v[e]).index=e,s.weight=0;for(e=0;d>e;++e)s=m[e],"number"==typeof s.source&&(s.source=v[s.source]),"number"==typeof s.target&&(s.target=v[s.target]),++s.source.weight,++s.target.weight;for(e=0;p>e;++e)s=v[e],isNaN(s.x)&&(s.x=n("x",y)),isNaN(s.y)&&(s.y=n("y",M)),isNaN(s.px)&&(s.px=s.x),isNaN(s.py)&&(s.py=s.y);if(u=[],"function"==typeof f)for(e=0;d>e;++e)u[e]=+f.call(this,m[e],e);else for(e=0;d>e;++e)u[e]=f;if(i=[],"function"==typeof h)for(e=0;d>e;++e)i[e]=+h.call(this,m[e],e);else for(e=0;d>e;++e)i[e]=h;if(o=[],"function"==typeof g)for(e=0;p>e;++e)o[e]=+g.call(this,v[e],e);else for(e=0;p>e;++e)o[e]=g;return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){return e||(e=mo.behavior.drag().origin(dt).on("dragstart.force",nu).on("drag.force",t).on("dragend.force",tu)),arguments.length?(this.on("mouseover.force",eu).on("mouseout.force",ru).call(e),void 0):e},mo.rebind(a,c,"on")};var Sc=20,Ec=1;mo.layout.hierarchy=function(){function n(t,o,a){var c=u.call(e,t,o);if(t.depth=o,a.push(t),c&&(l=c.length)){for(var l,s,f=-1,h=t.children=[],g=0,p=o+1;++f<l;)s=n(c[f],p,a),s.parent=t,h.push(s),g+=s.value;r&&h.sort(r),i&&(t.value=g)}else i&&(t.value=+i.call(e,t,o)||0);return t}function t(n,r){var u=n.children,o=0;if(u&&(a=u.length))for(var a,c=-1,l=r+1;++c<a;)o+=t(u[c],l);else i&&(o=+i.call(e,n,r)||0);return i&&(n.value=o),o}function e(t){var e=[];return n(t,0,e),e}var r=cu,u=ou,i=au;return e.sort=function(n){return arguments.length?(r=n,e):r},e.children=function(n){return arguments.length?(u=n,e):u},e.value=function(n){return arguments.length?(i=n,e):i},e.revalue=function(n){return t(n,0),n},e},mo.layout.partition=function(){function n(t,e,r,u){var i=t.children;if(t.x=e,t.y=t.depth*u,t.dx=r,t.dy=u,i&&(o=i.length)){var o,a,c,l=-1;for(r=t.value?r/t.value:0;++l<o;)n(a=i[l],e,c=a.value*r,u),e+=c}}function t(n){var e=n.children,r=0;if(e&&(u=e.length))for(var u,i=-1;++i<u;)r=Math.max(r,t(e[i]));return 1+r}function e(e,i){var o=r.call(this,e,i);return n(o[0],0,u[0],u[1]/t(o[0])),o}var r=mo.layout.hierarchy(),u=[1,1];return e.size=function(n){return arguments.length?(u=n,e):u},iu(e,r)},mo.layout.pie=function(){function n(i){var o=i.map(function(e,r){return+t.call(n,e,r)}),a=+("function"==typeof r?r.apply(this,arguments):r),c=(("function"==typeof u?u.apply(this,arguments):u)-a)/mo.sum(o),l=mo.range(i.length);null!=e&&l.sort(e===kc?function(n,t){return o[t]-o[n]}:function(n,t){return e(i[n],i[t])});var s=[];return l.forEach(function(n){var t;s[n]={data:i[n],value:t=o[n],startAngle:a,endAngle:a+=t*c}}),s}var t=Number,e=kc,r=0,u=Wo;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(u=t,n):u},n};var kc={};mo.layout.stack=function(){function n(a,c){var l=a.map(function(e,r){return t.call(n,e,r)}),s=l.map(function(t){return t.map(function(t,e){return[i.call(n,t,e),o.call(n,t,e)]})}),f=e.call(n,s,c);l=mo.permute(l,f),s=mo.permute(s,f);var h,g,p,d=r.call(n,s,c),v=l.length,m=l[0].length;for(g=0;m>g;++g)for(u.call(n,l[0][g],p=d[g],s[0][g][1]),h=1;v>h;++h)u.call(n,l[h][g],p+=s[h-1][g][1],s[h][g][1]);return a}var t=dt,e=gu,r=pu,u=hu,i=su,o=fu;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:Ac.get(t)||gu,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:Nc.get(t)||pu,n):r},n.x=function(t){return arguments.length?(i=t,n):i},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(u=t,n):u},n};var Ac=mo.map({"inside-out":function(n){var t,e,r=n.length,u=n.map(du),i=n.map(vu),o=mo.range(r).sort(function(n,t){return u[n]-u[t]}),a=0,c=0,l=[],s=[];for(t=0;r>t;++t)e=o[t],c>a?(a+=i[e],l.push(e)):(c+=i[e],s.push(e));return s.reverse().concat(l)},reverse:function(n){return mo.range(n.length).reverse()},"default":gu}),Nc=mo.map({silhouette:function(n){var t,e,r,u=n.length,i=n[0].length,o=[],a=0,c=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];r>a&&(a=r),o.push(r)}for(e=0;i>e;++e)c[e]=(a-o[e])/2;return c},wiggle:function(n){var t,e,r,u,i,o,a,c,l,s=n.length,f=n[0],h=f.length,g=[];for(g[0]=c=l=0,e=1;h>e;++e){for(t=0,u=0;s>t;++t)u+=n[t][e][1];for(t=0,i=0,a=f[e][0]-f[e-1][0];s>t;++t){for(r=0,o=(n[t][e][1]-n[t][e-1][1])/(2*a);t>r;++r)o+=(n[r][e][1]-n[r][e-1][1])/a;i+=o*n[t][e][1]}g[e]=c-=u?i/u*a:0,l>c&&(l=c)}for(e=0;h>e;++e)g[e]-=l;return g},expand:function(n){var t,e,r,u=n.length,i=n[0].length,o=1/u,a=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];if(r)for(t=0;u>t;t++)n[t][e][1]/=r;else for(t=0;u>t;t++)n[t][e][1]=o}for(e=0;i>e;++e)a[e]=0;return a},zero:pu});mo.layout.histogram=function(){function n(n,i){for(var o,a,c=[],l=n.map(e,this),s=r.call(this,l,i),f=u.call(this,s,l,i),i=-1,h=l.length,g=f.length-1,p=t?1:1/h;++i<g;)o=c[i]=[],o.dx=f[i+1]-(o.x=f[i]),o.y=0;if(g>0)for(i=-1;++i<h;)a=l[i],a>=s[0]&&a<=s[1]&&(o=c[mo.bisect(f,a,1,g)-1],o.y+=p,o.push(n[i]));return c}var t=!0,e=Number,r=xu,u=yu;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=pt(t),n):r},n.bins=function(t){return arguments.length?(u="number"==typeof t?function(n){return Mu(n,t)}:pt(t),n):u},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},mo.layout.tree=function(){function n(n,i){function o(n,t){var r=n.children,u=n._tree;if(r&&(i=r.length)){for(var i,a,l,s=r[0],f=s,h=-1;++h<i;)l=r[h],o(l,a),f=c(l,a,f),a=l;Tu(n);var g=.5*(s._tree.prelim+l._tree.prelim);t?(u.prelim=t._tree.prelim+e(n,t),u.mod=u.prelim-g):u.prelim=g}else t&&(u.prelim=t._tree.prelim+e(n,t))}function a(n,t){n.x=n._tree.prelim+t;var e=n.children;if(e&&(r=e.length)){var r,u=-1;for(t+=n._tree.mod;++u<r;)a(e[u],t)}}function c(n,t,r){if(t){for(var u,i=n,o=n,a=t,c=n.parent.children[0],l=i._tree.mod,s=o._tree.mod,f=a._tree.mod,h=c._tree.mod;a=wu(a),i=_u(i),a&&i;)c=_u(c),o=wu(o),o._tree.ancestor=n,u=a._tree.prelim+f-i._tree.prelim-l+e(a,i),u>0&&(qu(zu(a,n,r),n,u),l+=u,s+=u),f+=a._tree.mod,l+=i._tree.mod,h+=c._tree.mod,s+=o._tree.mod;a&&!wu(o)&&(o._tree.thread=a,o._tree.mod+=f-s),i&&!_u(c)&&(c._tree.thread=i,c._tree.mod+=l-h,r=n)}return r}var l=t.call(this,n,i),s=l[0];Nu(s,function(n,t){n._tree={ancestor:n,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),o(s),a(s,-s._tree.prelim);var f=Su(s,ku),h=Su(s,Eu),g=Su(s,Au),p=f.x-e(f,h)/2,d=h.x+e(h,f)/2,v=g.depth||1;return Nu(s,u?function(n){n.x*=r[0],n.y=n.depth*r[1],delete n._tree}:function(n){n.x=(n.x-p)/(d-p)*r[0],n.y=n.depth/v*r[1],delete n._tree}),l}var t=mo.layout.hierarchy().sort(null).value(null),e=bu,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null},iu(n,t)},mo.layout.pack=function(){function n(n,i){var o=e.call(this,n,i),a=o[0],c=u[0],l=u[1],s=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(a.x=a.y=0,Nu(a,function(n){n.r=+s(n.value)}),Nu(a,Hu),r){var f=r*(t?1:Math.max(2*a.r/c,2*a.r/l))/2;Nu(a,function(n){n.r+=f}),Nu(a,Hu),Nu(a,function(n){n.r-=f})}return Ou(a,c/2,l/2,t?1:1/Math.max(2*a.r/c,2*a.r/l)),o}var t,e=mo.layout.hierarchy().sort(Cu),r=0,u=[1,1];return n.size=function(t){return arguments.length?(u=t,n):u},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},iu(n,e)},mo.layout.cluster=function(){function n(n,i){var o,a=t.call(this,n,i),c=a[0],l=0;Nu(c,function(n){var t=n.children;t&&t.length?(n.x=Iu(t),n.y=Yu(t)):(n.x=o?l+=e(n,o):0,n.y=0,o=n)});var s=Uu(c),f=Zu(c),h=s.x-e(s,f)/2,g=f.x+e(f,s)/2;return Nu(c,u?function(n){n.x=(n.x-c.x)*r[0],n.y=(c.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(g-h)*r[0],n.y=(1-(c.y?n.y/c.y:1))*r[1]}),a}var t=mo.layout.hierarchy().sort(null).value(null),e=bu,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null},iu(n,t)},mo.layout.treemap=function(){function n(n,t){for(var e,r,u=-1,i=n.length;++u<i;)r=(e=n[u]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r}function t(e){var i=e.children;if(i&&i.length){var o,a,c,l=f(e),s=[],h=i.slice(),p=1/0,d="slice"===g?l.dx:"dice"===g?l.dy:"slice-dice"===g?1&e.depth?l.dy:l.dx:Math.min(l.dx,l.dy);for(n(h,l.dx*l.dy/e.value),s.area=0;(c=h.length)>0;)s.push(o=h[c-1]),s.area+=o.area,"squarify"!==g||(a=r(s,d))<=p?(h.pop(),p=a):(s.area-=s.pop().area,u(s,d,l,!1),d=Math.min(l.dx,l.dy),s.length=s.area=0,p=1/0);s.length&&(u(s,d,l,!0),s.length=s.area=0),i.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var i,o=f(t),a=r.slice(),c=[];for(n(a,o.dx*o.dy/t.value),c.area=0;i=a.pop();)c.push(i),c.area+=i.area,null!=i.z&&(u(c,i.z?o.dx:o.dy,o,!a.length),c.length=c.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,u=0,i=1/0,o=-1,a=n.length;++o<a;)(e=n[o].area)&&(i>e&&(i=e),e>u&&(u=e));return r*=r,t*=t,r?Math.max(t*u*p/r,r/(t*i*p)):1/0}function u(n,t,e,r){var u,i=-1,o=n.length,a=e.x,l=e.y,s=t?c(n.area/t):0;if(t==e.dx){for((r||s>e.dy)&&(s=e.dy);++i<o;)u=n[i],u.x=a,u.y=l,u.dy=s,a+=u.dx=Math.min(e.x+e.dx-a,s?c(u.area/s):0);u.z=!0,u.dx+=e.x+e.dx-a,e.y+=s,e.dy-=s}else{for((r||s>e.dx)&&(s=e.dx);++i<o;)u=n[i],u.x=a,u.y=l,u.dx=s,l+=u.dy=Math.min(e.y+e.dy-l,s?c(u.area/s):0);u.z=!1,u.dy+=e.y+e.dy-l,e.x+=s,e.dx-=s}}function i(r){var u=o||a(r),i=u[0];return i.x=0,i.y=0,i.dx=l[0],i.dy=l[1],o&&a.revalue(i),n([i],i.dx*i.dy/i.value),(o?e:t)(i),h&&(o=u),u}var o,a=mo.layout.hierarchy(),c=Math.round,l=[1,1],s=null,f=Vu,h=!1,g="squarify",p=.5*(1+Math.sqrt(5));return i.size=function(n){return arguments.length?(l=n,i):l},i.padding=function(n){function t(t){var e=n.call(i,t,t.depth);return null==e?Vu(t):Xu(t,"number"==typeof e?[e,e,e,e]:e)}function e(t){return Xu(t,n)}if(!arguments.length)return s;var r;return f=null==(s=n)?Vu:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,i},i.round=function(n){return arguments.length?(c=n?Math.round:Number,i):c!=Number},i.sticky=function(n){return arguments.length?(h=n,o=null,i):h},i.ratio=function(n){return arguments.length?(p=n,i):p},i.mode=function(n){return arguments.length?(g=n+"",i):g},iu(i,a)},mo.random={normal:function(n,t){var e=arguments.length;return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,u;do e=2*Math.random()-1,r=2*Math.random()-1,u=e*e+r*r;while(!u||u>1);return n+t*e*Math.sqrt(-2*Math.log(u)/u)}},logNormal:function(){var n=mo.random.normal.apply(mo,arguments);return function(){return Math.exp(n())}},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++)t+=Math.random();return t/n}}},mo.scale={};var Tc={floor:dt,ceil:dt};mo.scale.linear=function(){return Qu([0,1],[0,1],Er,!1)},mo.scale.log=function(){return ii(mo.scale.linear().domain([0,1]),10,!0,[1,10])};var qc=mo.format(".0e"),zc={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};mo.scale.pow=function(){return oi(mo.scale.linear(),1,[0,1])},mo.scale.sqrt=function(){return mo.scale.pow().exponent(.5)},mo.scale.ordinal=function(){return ci([],{t:"range",a:[[]]})},mo.scale.category10=function(){return mo.scale.ordinal().range(Cc)},mo.scale.category20=function(){return mo.scale.ordinal().range(Dc)},mo.scale.category20b=function(){return mo.scale.ordinal().range(jc)},mo.scale.category20c=function(){return mo.scale.ordinal().range(Lc)};var Cc=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(it),Dc=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(it),jc=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(it),Lc=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(it);mo.scale.quantile=function(){return li([],[])},mo.scale.quantize=function(){return si(0,1,[0,1])},mo.scale.threshold=function(){return fi([.5],[0,1])},mo.scale.identity=function(){return hi([0,1])},mo.svg.arc=function(){function n(){var n=t.apply(this,arguments),i=e.apply(this,arguments),o=r.apply(this,arguments)+Hc,a=u.apply(this,arguments)+Hc,c=(o>a&&(c=o,o=a,a=c),a-o),l=Bo>c?"0":"1",s=Math.cos(o),f=Math.sin(o),h=Math.cos(a),g=Math.sin(a);return c>=Fc?n?"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"M0,"+n+"A"+n+","+n+" 0 1,0 0,"+-n+"A"+n+","+n+" 0 1,0 0,"+n+"Z":"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"Z":n?"M"+i*s+","+i*f+"A"+i+","+i+" 0 "+l+",1 "+i*h+","+i*g+"L"+n*h+","+n*g+"A"+n+","+n+" 0 "+l+",0 "+n*s+","+n*f+"Z":"M"+i*s+","+i*f+"A"+i+","+i+" 0 "+l+",1 "+i*h+","+i*g+"L0,0"+"Z"}var t=gi,e=pi,r=di,u=vi;return n.innerRadius=function(e){return arguments.length?(t=pt(e),n):t},n.outerRadius=function(t){return arguments.length?(e=pt(t),n):e},n.startAngle=function(t){return arguments.length?(r=pt(t),n):r},n.endAngle=function(t){return arguments.length?(u=pt(t),n):u},n.centroid=function(){var n=(t.apply(this,arguments)+e.apply(this,arguments))/2,i=(r.apply(this,arguments)+u.apply(this,arguments))/2+Hc;return[Math.cos(i)*n,Math.sin(i)*n]},n};var Hc=-Jo,Fc=Wo-Go;mo.svg.line.radial=function(){var n=Ue(mi);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},We.reverse=Je,Je.reverse=We,mo.svg.area=function(){return yi(dt)},mo.svg.area.radial=function(){var n=yi(mi);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},mo.svg.chord=function(){function n(n,a){var c=t(this,i,n,a),l=t(this,o,n,a);return"M"+c.p0+r(c.r,c.p1,c.a1-c.a0)+(e(c,l)?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,l.r,l.p0)+r(l.r,l.p1,l.a1-l.a0)+u(l.r,l.p1,c.r,c.p0))+"Z"}function t(n,t,e,r){var u=t.call(n,e,r),i=a.call(n,u,r),o=c.call(n,u,r)+Hc,s=l.call(n,u,r)+Hc;return{r:i,a0:o,a1:s,p0:[i*Math.cos(o),i*Math.sin(o)],p1:[i*Math.cos(s),i*Math.sin(s)]}}function e(n,t){return n.a0==t.a0&&n.a1==t.a1}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>Bo)+",1 "+t}function u(n,t,e,r){return"Q 0,0 "+r}var i=De,o=je,a=Mi,c=di,l=vi;return n.radius=function(t){return arguments.length?(a=pt(t),n):a},n.source=function(t){return arguments.length?(i=pt(t),n):i},n.target=function(t){return arguments.length?(o=pt(t),n):o},n.startAngle=function(t){return arguments.length?(c=pt(t),n):c},n.endAngle=function(t){return arguments.length?(l=pt(t),n):l},n},mo.svg.diagonal=function(){function n(n,u){var i=t.call(this,n,u),o=e.call(this,n,u),a=(i.y+o.y)/2,c=[i,{x:i.x,y:a},{x:o.x,y:a},o];return c=c.map(r),"M"+c[0]+"C"+c[1]+" "+c[2]+" "+c[3]}var t=De,e=je,r=xi;return n.source=function(e){return arguments.length?(t=pt(e),n):t},n.target=function(t){return arguments.length?(e=pt(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},mo.svg.diagonal.radial=function(){var n=mo.svg.diagonal(),t=xi,e=n.projection;return n.projection=function(n){return arguments.length?e(bi(t=n)):t},n},mo.svg.symbol=function(){function n(n,r){return(Pc.get(t.call(this,n,r))||Si)(e.call(this,n,r))}var t=wi,e=_i;return n.type=function(e){return arguments.length?(t=pt(e),n):t},n.size=function(t){return arguments.length?(e=pt(t),n):e},n};var Pc=mo.map({circle:Si,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*Ic)),e=t*Ic;return"M0,"+-t+"L"+e+",0"+" 0,"+t+" "+-e+",0"+"Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/Yc),e=t*Yc/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/Yc),e=t*Yc/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});mo.svg.symbolTypes=Pc.keys();var Oc,Rc,Yc=Math.sqrt(3),Ic=Math.tan(30*Qo),Uc=[],Zc=0;Uc.call=Ro.call,Uc.empty=Ro.empty,Uc.node=Ro.node,Uc.size=Ro.size,mo.transition=function(n){return arguments.length?Oc?n.transition():n:Uo.transition()},mo.transition.prototype=Uc,Uc.select=function(n){var t,e,r,u=this.id,i=[];n=d(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]);for(var c=this[o],l=-1,s=c.length;++l<s;)(r=c[l])&&(e=n.call(r,r.__data__,l,o))?("__data__"in r&&(e.__data__=r.__data__),Ni(e,l,u,r.__transition__[u]),t.push(e)):t.push(null)}return Ei(i,u)},Uc.selectAll=function(n){var t,e,r,u,i,o=this.id,a=[];n=v(n);for(var c=-1,l=this.length;++c<l;)for(var s=this[c],f=-1,h=s.length;++f<h;)if(r=s[f]){i=r.__transition__[o],e=n.call(r,r.__data__,f,c),a.push(t=[]);for(var g=-1,p=e.length;++g<p;)(u=e[g])&&Ni(u,g,o,i),t.push(u)}return Ei(a,o)},Uc.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=k(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]);for(var e=this[i],a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a)&&t.push(r)}return Ei(u,this.id)},Uc.tween=function(n,t){var e=this.id;return arguments.length<2?this.node().__transition__[e].tween.get(n):N(this,null==t?function(t){t.__transition__[e].tween.remove(n)}:function(r){r.__transition__[e].tween.set(n,t)})},Uc.attr=function(n,t){function e(){this.removeAttribute(a)}function r(){this.removeAttributeNS(a.space,a.local)}function u(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(a);return e!==n&&(t=o(e,n),function(n){this.setAttribute(a,t(n))})})}function i(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(a.space,a.local);return e!==n&&(t=o(e,n),function(n){this.setAttributeNS(a.space,a.local,t(n))
})})}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?Br:Er,a=mo.ns.qualify(n);return ki(this,"attr."+n,t,a.local?i:u)},Uc.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(u));return r&&function(n){this.setAttribute(u,r(n))}}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(u.space,u.local));return r&&function(n){this.setAttributeNS(u.space,u.local,r(n))}}var u=mo.ns.qualify(n);return this.tween("attr."+n,u.local?r:e)},Uc.style=function(n,t,e){function r(){this.style.removeProperty(n)}function u(t){return null==t?r:(t+="",function(){var r,u=_o.getComputedStyle(this,null).getPropertyValue(n);return u!==t&&(r=Er(u,t),function(t){this.style.setProperty(n,r(t),e)})})}var i=arguments.length;if(3>i){if("string"!=typeof n){2>i&&(t="");for(e in n)this.style(e,n[e],t);return this}e=""}return ki(this,"style."+n,t,u)},Uc.styleTween=function(n,t,e){function r(r,u){var i=t.call(this,r,u,_o.getComputedStyle(this,null).getPropertyValue(n));return i&&function(t){this.style.setProperty(n,i(t),e)}}return arguments.length<3&&(e=""),this.tween("style."+n,r)},Uc.text=function(n){return ki(this,"text",n,Ai)},Uc.remove=function(){return this.each("end.transition",function(){var n;this.__transition__.count<2&&(n=this.parentNode)&&n.removeChild(this)})},Uc.ease=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof n&&(n=mo.ease.apply(mo,arguments)),N(this,function(e){e.__transition__[t].ease=n}))},Uc.delay=function(n){var t=this.id;return N(this,"function"==typeof n?function(e,r,u){e.__transition__[t].delay=+n.call(e,e.__data__,r,u)}:(n=+n,function(e){e.__transition__[t].delay=n}))},Uc.duration=function(n){var t=this.id;return N(this,"function"==typeof n?function(e,r,u){e.__transition__[t].duration=Math.max(1,n.call(e,e.__data__,r,u))}:(n=Math.max(1,n),function(e){e.__transition__[t].duration=n}))},Uc.each=function(n,t){var e=this.id;if(arguments.length<2){var r=Rc,u=Oc;Oc=e,N(this,function(t,r,u){Rc=t.__transition__[e],n.call(t,t.__data__,r,u)}),Rc=r,Oc=u}else N(this,function(r){var u=r.__transition__[e];(u.event||(u.event=mo.dispatch("start","end"))).on(n,t)});return this},Uc.transition=function(){for(var n,t,e,r,u=this.id,i=++Zc,o=[],a=0,c=this.length;c>a;a++){o.push(n=[]);for(var t=this[a],l=0,s=t.length;s>l;l++)(e=t[l])&&(r=Object.create(e.__transition__[u]),r.delay+=r.duration,Ni(e,l,i,r)),n.push(e)}return Ei(o,i)},mo.svg.axis=function(){function n(n){n.each(function(){var n,l=mo.select(this),s=this.__chart__||e,f=this.__chart__=e.copy(),h=null==c?f.ticks?f.ticks.apply(f,a):f.domain():c,g=null==t?f.tickFormat?f.tickFormat.apply(f,a):dt:t,p=l.selectAll(".tick").data(h,f),d=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Go),v=mo.transition(p.exit()).style("opacity",Go).remove(),m=mo.transition(p).style("opacity",1),y=Bu(f),M=l.selectAll(".domain").data([0]),x=(M.enter().append("path").attr("class","domain"),mo.transition(M));d.append("line"),d.append("text");var b=d.select("line"),_=m.select("line"),w=p.select("text").text(g),S=d.select("text"),E=m.select("text");switch(r){case"bottom":n=Ti,b.attr("y2",u),S.attr("y",Math.max(u,0)+o),_.attr("x2",0).attr("y2",u),E.attr("x",0).attr("y",Math.max(u,0)+o),w.attr("dy",".71em").style("text-anchor","middle"),x.attr("d","M"+y[0]+","+i+"V0H"+y[1]+"V"+i);break;case"top":n=Ti,b.attr("y2",-u),S.attr("y",-(Math.max(u,0)+o)),_.attr("x2",0).attr("y2",-u),E.attr("x",0).attr("y",-(Math.max(u,0)+o)),w.attr("dy","0em").style("text-anchor","middle"),x.attr("d","M"+y[0]+","+-i+"V0H"+y[1]+"V"+-i);break;case"left":n=qi,b.attr("x2",-u),S.attr("x",-(Math.max(u,0)+o)),_.attr("x2",-u).attr("y2",0),E.attr("x",-(Math.max(u,0)+o)).attr("y",0),w.attr("dy",".32em").style("text-anchor","end"),x.attr("d","M"+-i+","+y[0]+"H0V"+y[1]+"H"+-i);break;case"right":n=qi,b.attr("x2",u),S.attr("x",Math.max(u,0)+o),_.attr("x2",u).attr("y2",0),E.attr("x",Math.max(u,0)+o).attr("y",0),w.attr("dy",".32em").style("text-anchor","start"),x.attr("d","M"+i+","+y[0]+"H0V"+y[1]+"H"+i)}if(f.rangeBand){var k=f.rangeBand()/2,A=function(n){return f(n)+k};d.call(n,A),m.call(n,A)}else d.call(n,s),m.call(n,f),v.call(n,f)})}var t,e=mo.scale.linear(),r=Vc,u=6,i=6,o=3,a=[10],c=null;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Xc?t+"":Vc,n):r},n.ticks=function(){return arguments.length?(a=arguments,n):a},n.tickValues=function(t){return arguments.length?(c=t,n):c},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t){var e=arguments.length;return e?(u=+t,i=+arguments[e-1],n):u},n.innerTickSize=function(t){return arguments.length?(u=+t,n):u},n.outerTickSize=function(t){return arguments.length?(i=+t,n):i},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var Vc="bottom",Xc={top:1,right:1,bottom:1,left:1};mo.svg.brush=function(){function n(i){i.each(function(){var i=mo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",u).on("touchstart.brush",u),o=i.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),i.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=i.selectAll(".resize").data(v,dt);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return $c[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var s,f=mo.transition(i),h=mo.transition(o);c&&(s=Bu(c),h.attr("x",s[0]).attr("width",s[1]-s[0]),e(f)),l&&(s=Bu(l),h.attr("y",s[0]).attr("height",s[1]-s[0]),r(f)),t(f)})}function t(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+s[+/e$/.test(n)]+","+h[+/^s/.test(n)]+")"})}function e(n){n.select(".extent").attr("x",s[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",s[1]-s[0])}function r(n){n.select(".extent").attr("y",h[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function u(){function u(){32==mo.event.keyCode&&(N||(M=null,q[0]-=s[1],q[1]-=h[1],N=2),f())}function g(){32==mo.event.keyCode&&2==N&&(q[0]+=s[1],q[1]+=h[1],N=0,f())}function v(){var n=mo.mouse(b),u=!1;x&&(n[0]+=x[0],n[1]+=x[1]),N||(mo.event.altKey?(M||(M=[(s[0]+s[1])/2,(h[0]+h[1])/2]),q[0]=s[+(n[0]<M[0])],q[1]=h[+(n[1]<M[1])]):M=null),k&&m(n,c,0)&&(e(S),u=!0),A&&m(n,l,1)&&(r(S),u=!0),u&&(t(S),w({type:"brush",mode:N?"move":"resize"}))}function m(n,t,e){var r,u,a=Bu(t),c=a[0],l=a[1],f=q[e],g=e?h:s,v=g[1]-g[0];return N&&(c-=f,l-=v+f),r=(e?d:p)?Math.max(c,Math.min(l,n[e])):n[e],N?u=(r+=f)+v:(M&&(f=Math.max(c,Math.min(l,2*M[e]-r))),r>f?(u=r,r=f):u=f),g[0]!=r||g[1]!=u?(e?o=null:i=null,g[0]=r,g[1]=u,!0):void 0}function y(){v(),S.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),mo.select("body").style("cursor",null),z.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),T(),w({type:"brushend"})}var M,x,b=this,_=mo.select(mo.event.target),w=a.of(b,arguments),S=mo.select(b),E=_.datum(),k=!/^(n|s)$/.test(E)&&c,A=!/^(e|w)$/.test(E)&&l,N=_.classed("extent"),T=L(),q=mo.mouse(b),z=mo.select(_o).on("keydown.brush",u).on("keyup.brush",g);if(mo.event.changedTouches?z.on("touchmove.brush",v).on("touchend.brush",y):z.on("mousemove.brush",v).on("mouseup.brush",y),S.interrupt().selectAll("*").interrupt(),N)q[0]=s[0]-q[0],q[1]=h[0]-q[1];else if(E){var C=+/w$/.test(E),D=+/^n/.test(E);x=[s[1-C]-q[0],h[1-D]-q[1]],q[0]=s[C],q[1]=h[D]}else mo.event.altKey&&(M=q.slice());S.style("pointer-events","none").selectAll(".resize").style("display",null),mo.select("body").style("cursor",_.style("cursor")),w({type:"brushstart"}),v()}var i,o,a=g(n,"brushstart","brush","brushend"),c=null,l=null,s=[0,0],h=[0,0],p=!0,d=!0,v=Bc[0];return n.event=function(n){n.each(function(){var n=a.of(this,arguments),t={x:s,y:h,i:i,j:o},e=this.__chart__||t;this.__chart__=t,Oc?mo.select(this).transition().each("start.brush",function(){i=e.i,o=e.j,s=e.x,h=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=kr(s,t.x),r=kr(h,t.y);return i=o=null,function(u){s=t.x=e(u),h=t.y=r(u),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){i=t.i,o=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(c=t,v=Bc[!c<<1|!l],n):c},n.y=function(t){return arguments.length?(l=t,v=Bc[!c<<1|!l],n):l},n.clamp=function(t){return arguments.length?(c&&l?(p=!!t[0],d=!!t[1]):c?p=!!t:l&&(d=!!t),n):c&&l?[p,d]:c?p:l?d:null},n.extent=function(t){var e,r,u,a,f;return arguments.length?(c&&(e=t[0],r=t[1],l&&(e=e[0],r=r[0]),i=[e,r],c.invert&&(e=c(e),r=c(r)),e>r&&(f=e,e=r,r=f),(e!=s[0]||r!=s[1])&&(s=[e,r])),l&&(u=t[0],a=t[1],c&&(u=u[1],a=a[1]),o=[u,a],l.invert&&(u=l(u),a=l(a)),u>a&&(f=u,u=a,a=f),(u!=h[0]||a!=h[1])&&(h=[u,a])),n):(c&&(i?(e=i[0],r=i[1]):(e=s[0],r=s[1],c.invert&&(e=c.invert(e),r=c.invert(r)),e>r&&(f=e,e=r,r=f))),l&&(o?(u=o[0],a=o[1]):(u=h[0],a=h[1],l.invert&&(u=l.invert(u),a=l.invert(a)),u>a&&(f=u,u=a,a=f))),c&&l?[[e,u],[r,a]]:c?[e,r]:l&&[u,a])},n.clear=function(){return n.empty()||(s=[0,0],h=[0,0],i=o=null),n},n.empty=function(){return!!c&&s[0]==s[1]||!!l&&h[0]==h[1]},mo.rebind(n,a,"on")};var $c={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Bc=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Wc=mo.time={},Jc=Date,Gc=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];zi.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Kc.setUTCDate.apply(this._,arguments)},setDay:function(){Kc.setUTCDay.apply(this._,arguments)},setFullYear:function(){Kc.setUTCFullYear.apply(this._,arguments)},setHours:function(){Kc.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Kc.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Kc.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Kc.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Kc.setUTCSeconds.apply(this._,arguments)},setTime:function(){Kc.setTime.apply(this._,arguments)}};var Kc=Date.prototype,Qc="%a %b %e %X %Y",nl="%m/%d/%Y",tl="%H:%M:%S",el=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],rl=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ul=["January","February","March","April","May","June","July","August","September","October","November","December"],il=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Wc.year=Ci(function(n){return n=Wc.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),Wc.years=Wc.year.range,Wc.years.utc=Wc.year.utc.range,Wc.day=Ci(function(n){var t=new Jc(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),Wc.days=Wc.day.range,Wc.days.utc=Wc.day.utc.range,Wc.dayOfYear=function(n){var t=Wc.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},Gc.forEach(function(n,t){n=n.toLowerCase(),t=7-t;var e=Wc[n]=Ci(function(n){return(n=Wc.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=Wc.year(n).getDay();return Math.floor((Wc.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});Wc[n+"s"]=e.range,Wc[n+"s"].utc=e.utc.range,Wc[n+"OfYear"]=function(n){var e=Wc.year(n).getDay();return Math.floor((Wc.dayOfYear(n)+(e+t)%7)/7)}}),Wc.week=Wc.sunday,Wc.weeks=Wc.sunday.range,Wc.weeks.utc=Wc.sunday.utc.range,Wc.weekOfYear=Wc.sundayOfYear,Wc.format=ji;var ol=Hi(el),al=Fi(el),cl=Hi(rl),ll=Fi(rl),sl=Hi(ul),fl=Fi(ul),hl=Hi(il),gl=Fi(il),pl=/^%/,dl={"-":"",_:" ",0:"0"},vl={a:function(n){return rl[n.getDay()]},A:function(n){return el[n.getDay()]},b:function(n){return il[n.getMonth()]},B:function(n){return ul[n.getMonth()]},c:ji(Qc),d:function(n,t){return Pi(n.getDate(),t,2)},e:function(n,t){return Pi(n.getDate(),t,2)},H:function(n,t){return Pi(n.getHours(),t,2)},I:function(n,t){return Pi(n.getHours()%12||12,t,2)},j:function(n,t){return Pi(1+Wc.dayOfYear(n),t,3)},L:function(n,t){return Pi(n.getMilliseconds(),t,3)},m:function(n,t){return Pi(n.getMonth()+1,t,2)},M:function(n,t){return Pi(n.getMinutes(),t,2)},p:function(n){return n.getHours()>=12?"PM":"AM"},S:function(n,t){return Pi(n.getSeconds(),t,2)},U:function(n,t){return Pi(Wc.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return Pi(Wc.mondayOfYear(n),t,2)},x:ji(nl),X:ji(tl),y:function(n,t){return Pi(n.getFullYear()%100,t,2)},Y:function(n,t){return Pi(n.getFullYear()%1e4,t,4)},Z:ao,"%":function(){return"%"}},ml={a:Oi,A:Ri,b:Zi,B:Vi,c:Xi,d:no,e:no,H:eo,I:eo,j:to,L:io,m:Qi,M:ro,p:oo,S:uo,U:Ii,w:Yi,W:Ui,x:$i,X:Bi,y:Ji,Y:Wi,Z:Gi,"%":co},yl=/^\s*\d+/,Ml=mo.map({am:0,pm:1});ji.utc=lo;var xl=lo("%Y-%m-%dT%H:%M:%S.%LZ");ji.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?so:xl,so.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},so.toString=xl.toString,Wc.second=Ci(function(n){return new Jc(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),Wc.seconds=Wc.second.range,Wc.seconds.utc=Wc.second.utc.range,Wc.minute=Ci(function(n){return new Jc(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),Wc.minutes=Wc.minute.range,Wc.minutes.utc=Wc.minute.utc.range,Wc.hour=Ci(function(n){var t=n.getTimezoneOffset()/60;return new Jc(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),Wc.hours=Wc.hour.range,Wc.hours.utc=Wc.hour.utc.range,Wc.month=Ci(function(n){return n=Wc.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),Wc.months=Wc.month.range,Wc.months.utc=Wc.month.utc.range;var bl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],_l=[[Wc.second,1],[Wc.second,5],[Wc.second,15],[Wc.second,30],[Wc.minute,1],[Wc.minute,5],[Wc.minute,15],[Wc.minute,30],[Wc.hour,1],[Wc.hour,3],[Wc.hour,6],[Wc.hour,12],[Wc.day,1],[Wc.day,2],[Wc.week,1],[Wc.month,1],[Wc.month,3],[Wc.year,1]],wl=[[ji("%Y"),Vt],[ji("%B"),function(n){return n.getMonth()}],[ji("%b %d"),function(n){return 1!=n.getDate()}],[ji("%a %d"),function(n){return n.getDay()&&1!=n.getDate()}],[ji("%I %p"),function(n){return n.getHours()}],[ji("%I:%M"),function(n){return n.getMinutes()}],[ji(":%S"),function(n){return n.getSeconds()}],[ji(".%L"),function(n){return n.getMilliseconds()}]],Sl=go(wl);_l.year=Wc.year,Wc.scale=function(){return fo(mo.scale.linear(),_l,Sl)};var El={range:function(n,t,e){return mo.range(+n,+t,e).map(ho)}},kl=_l.map(function(n){return[n[0].utc,n[1]]}),Al=[[lo("%Y"),Vt],[lo("%B"),function(n){return n.getUTCMonth()}],[lo("%b %d"),function(n){return 1!=n.getUTCDate()}],[lo("%a %d"),function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],[lo("%I %p"),function(n){return n.getUTCHours()}],[lo("%I:%M"),function(n){return n.getUTCMinutes()}],[lo(":%S"),function(n){return n.getUTCSeconds()}],[lo(".%L"),function(n){return n.getUTCMilliseconds()}]],Nl=go(Al);return kl.year=Wc.year.utc,Wc.scale.utc=function(){return fo(mo.scale.linear(),kl,Nl)},mo.text=vt(function(n){return n.responseText}),mo.json=function(n,t){return mt(n,"application/json",po,t)},mo.html=function(n,t){return mt(n,"text/html",vo,t)},mo.xml=vt(function(n){return n.responseXML}),mo}();
/* "gauges using javascript d3.js" 
 * 
 * Originally taken October 2012 from http://bl.ocks.org/1499279
 * author allows commercial usage, see https://gist.github.com/1499279
 *    rubenfilteris commented 4 months ago: "Would you mind if I use these in a commercial project?"
 *    tomerd commented (gist owner) 4 months ago: Be my guest.
 *    
 *  adapted 2012 for PRTG by Dirk Paessler
 *  
 *  */
(function($, window, document, undefined) {
  _Prtg.Graphixs = _Prtg.Graphixs || { "___": '_Prtg.Graphixs' };
  $.extend(true, _Prtg.Graphixs, {
    Gauge: function Gauge(placeholderName, configuration){
    	this.placeholderName = placeholderName;
      this.pointer = [
        {"x":0,"y":-0.8},
        {"x":0.04,"y":0.05},
        {"x":0.03,"y":0.1},
        {"x":-0.03,"y":0.1},
        {"x":-0.04,"y":0.05},
        {"x":0,"y":-0.8}
      ];

    	var self = this; // some internal d3 functions do not "like" the "this" keyword, hence setting a local variable

    	this.configure = function(configuration)
    	{
    		this.config = configuration;

    		this.config.size = this.config.size * 0.9;

    		this.config.radius = this.config.size * 0.97 / 2;
    		this.config.cx = this.config.size / 2;
    		this.config.cy = this.config.size / 2;

    		this.config.min = configuration.min || 0; 
    		this.config.max = configuration.max || 100; 
    		this.config.range = this.config.max - this.config.min;

    		this.config.majorTicks = configuration.majorTicks || 2;
    		this.config.minorTicks = configuration.minorTicks || 1;

    		this.config.greenColor 	= "status3";
    		this.config.yellowColor = "status4";
    		this.config.redColor 	= "status5";
    		this.config.grayColor 	= "status0";
    		this.config.hidePointer = false;
    		this.config.maxtext='';
    		this.config.mintext='';
    	}

    	this.render = function(value)
    	{
    		this.body = d3.select(this.placeholderName)
    							.append("svg:svg")
    	   						.attr("class", "gauge")
    	   						.attr("width", this.config.size)
    	   						.attr("height", this.config.size*0.9+20);

    		for (var index in this.config.grayZones)
    		{
    			this.drawBand(this.config.grayZones[index].from, this.config.grayZones[index].to, self.config.grayColor);
    		}
    		
    		for (var index in this.config.greenZones)
    		{
    			this.drawBand(this.config.greenZones[index].from, this.config.greenZones[index].to, self.config.greenColor);
    		}

    		for (var index in this.config.yellowZones)
    		{
    			this.drawBand(this.config.yellowZones[index].from, this.config.yellowZones[index].to, self.config.yellowColor);
    		}

    		for (var index in this.config.redZones)
    		{
    			this.drawBand(this.config.redZones[index].from, this.config.redZones[index].to, self.config.redColor);
    		}
    		this.body.append("svg:circle")
    					.attr("cx", this.config.cx-this.config.size*0.05)						
    					.attr("cy", this.config.cy+this.config.size*0.05)								
    					.attr("r", this.config.radius*0.6)
    					.attr("class", "backgroundfill")
    					// .style("stroke","red")
    					// .style("stroke-width","3px")

    		var fontSize = 12;	
    		
    		if (this.config.size > 90) {
    			var major = this.config.min; // Scale Min value
    			var point = this.valueToPoint(major, 0.63);
    			var mytext = major;
    			if (this.config.mintext != "") {
    				mytext = $("<div>"+this.config.mintext+"</div>").text();
    			}
    			if (mytext.length > 14) {
    				mytext = mytext.substring(0, 13) + '...'
    			}
    			var mysize = fontSize;
    			this.body.append("svg:text").attr("x", point.x - this.config.size * 0.05).attr("y", point.y + this.config.size * 0.15+12).attr("dy", fontSize / 3).attr("text-anchor", "middle").text(mytext).style("font-family",'"Segoe UI", Tahoma, Arial, Helvetica, Verdana, sans-serif').style("font-size", mysize + "px").style("fill", "#333").style("stroke-width", "0px");
    			
    			major = this.config.max; // Scale Max value
    			point = this.valueToPoint(major, 0.63);
    			mytext = major;
    			if (this.config.maxtext != "") {
    				mytext = $("<div>"+this.config.maxtext+"</div>").text();
    			}
    			if (mytext.length > 14) {
    				mytext = mytext.substring(0, 13) + '...'
    			}
    			mysize = fontSize;
    			this.body.append("svg:text").attr("x", point.x + this.config.size * 0.05).attr("y", point.y + this.config.size * 0.15+12).attr("dy", fontSize / 3).attr("text-anchor", "middle").text(mytext).style("font-family",'"Segoe UI", Tahoma, Arial, Helvetica, Verdana, sans-serif').style("font-size", mysize + "px").style("fill", "#333").style("stroke-width", "0px");
    		}

    		var avgContainer = this.body.append("svg:g").attr("class", "avgContainer");		
    		var pointerContainer = this.body.append("svg:g").attr("class", "pointerContainer");		
    		this.drawAvg(this.config.avg);
    		if(value >= 0)
    			this.redraw(value)
    	}

    	this.drawBand = function(start, end, color)
    	{
    		if (0 >= end - start) return;

    		this.body.append("svg:path")
						.attr("class", color)
    					.attr("d", d3.svg.arc()
    						.startAngle(this.valueToRadians(start))
    						.endAngle(this.valueToRadians(end))
    						.innerRadius(0 * this.config.radius)
    						.outerRadius(0.85 * this.config.radius))
    					.attr("transform", "translate(" + self.config.cx + ", " + self.config.cy + ") rotate(270)");
    	}

    	this.redraw = function(value)
    	{
    		var angle = this.valueToDegrees(value);
          	this.drawPointer(
            this.body.append("svg:g")
              .attr("class", "pointerContainer")
              .attr("transform","translate(" + self.config.cx + "," + self.config.cy + ") rotate("+ (angle+270) +")")
              ,self.config.radius*1.1);
    	}


    	this.drawPointer = function(value,radius)
    	{
        value.selectAll("path")
          .data([self.pointer])
    	      .enter()
            .append("svg:path")
			.attr("class", "needle")
              .attr("d", d3.svg.line()
                  .x(function(d) { return d.x*radius })
                  .y(function(d) { return d.y*radius })
                  .interpolate("basis")
               );


    	}
    	this.drawAvg = function(value)
    	{
    		if (!value) return;
    		var delta = this.config.range / 45;
    		
    		var head = this.valueToPoint(value, 0.75+0.02);
    		var head3 = this.valueToPoint(value - delta, 0.80+0.1);
    		var head4 = this.valueToPoint(value + delta, 0.80+0.1);
    		var data = [head, head3, head4, head];

    		var line = d3.svg.line()
    							.x(function(d) { return d.x })
    							.y(function(d) { return d.y })
    							;
    		var avgContainer = this.body.select(".avgContainer");	

    		var pointer = avgContainer.selectAll("path").data([data])										

    		pointer.enter()
    				.append("svg:path")
    					.attr("d", line)
    					.style("class", "backgroundfill")
    					.style("fill-opacity", 0.9)
    					.style("opacity", 0.9)
            .append('svg:title').text(this.config.avgtxt);


    		var point = this.valueToPoint(value, 0.85+0.1);
          this.body.append("svg:text").attr("x", point.x ).attr("y", point.y )
          .attr("dy", this.config.size / 48)
          .attr("text-anchor", "middle")
          .text("x")
          .style("font-family",'"Segoe UI", Tahoma, Arial, Helvetica, Verdana, sans-serif')
          .style("font-size", this.config.size / 20+ "px")
          .style("fill", "#999").style("stroke-width", "0px");
          this.body.append("svg:text").attr("x", point.x -1).attr("y", point.y-this.config.size / 28 )
          .attr("dy", this.config.size / 48)
          .attr("text-anchor", "middle")
          .text("_")
          .style("font-family",'"Segoe UI", Tahoma, Arial, Helvetica, Verdana, sans-serif')
          .style("font-size", this.config.size / 20+ "px")
          .style("fill", "#999").style("stroke-width", "0px");
    	}

    	this.valueToDegrees = function(value)
    	{
    		return value / this.config.range * 270 - 45;
    	}

    	this.valueToRadians = function(value)
    	{
    		return this.valueToDegrees(value) * Math.PI / 180;
    	}

    	this.valueToPoint = function(value, factor)
    	{
    		var point = 
    		{
    			x: this.config.cx - this.config.radius * factor * Math.cos(this.valueToRadians(value)),
    			y: this.config.cy - this.config.radius * factor * Math.sin(this.valueToRadians(value))
    		}

    		return point;
    	}

    	// initialization
    	this.configure(configuration);	
    }
  })
})(jQuery,window,document);
// d3.legend.js 
// (C) 2012 ziggy.jonsson.nyc@gmail.com
// MIT licence
// http://bl.ocks.org/ZJONSSON/3918369
// pimped by Stefan Messner

(function() {
d3.legend = function(g) {
  g.each(function() {
    var g= d3.select(this),
        items = {},
        svg = d3.select(g.property("nearestViewportElement")),
        legendPadding = g.attr("data-style-padding") || 5,
        li = g.selectAll(".legend-items").data([true]);

    li.enter().append("g").classed("legend-items",true);

    svg.selectAll("[data-legend]").each(function() {
        var self = d3.select(this);
        items[self.attr("data-legend")] = {
          color : self.attr("data-legend-color") != undefined 
            ? self.attr("data-legend-color") 
            : self.attr("fill") != 'none' 
                ? self.attr("fill") 
                : self.attr("stroke") 
        };
      });

    items = d3.entries(items).sort(function(a,b) { return a.value.pos-b.value.pos});

    li.selectAll("text")
        .data(items,function(d) { return d.key})
        .call(function(d) { d.enter().append("text")})
        .call(function(d) { d.exit().remove()})
        .attr("y",function(d,i) { return i*2+0.4+"em"})
        .attr("x","1em")
        .text(function(d) {return d.key});
    
    li.selectAll("circle")
        .data(items,function(d) { return d.key})
        .call(function(d) { d.enter().append("circle")})
        .call(function(d) { d.exit().remove()})
        .attr("cy",function(d,i) { return i*1.5+"em"})
        .attr("cx",0)
        .attr("r","0.5em")
        .style("fill",function(d) {return d.value.color});
  })
  return g;
}
})();
/*
  totpjson.js V1 from http://d3js.org/topojson.v1.min.js
 */
!function(){function t(n,t){function r(t){var r,e=n.arcs[0>t?~t:t],o=e[0];return n.transform?(r=[0,0],e.forEach(function(n){r[0]+=n[0],r[1]+=n[1]})):r=e[e.length-1],0>t?[r,o]:[o,r]}function e(n,t){for(var r in n){var e=n[r];delete t[e.start],delete e.start,delete e.end,e.forEach(function(n){o[0>n?~n:n]=1}),f.push(e)}}var o={},i={},u={},f=[],c=-1;return t.forEach(function(r,e){var o,i=n.arcs[0>r?~r:r];i.length<3&&!i[1][0]&&!i[1][1]&&(o=t[++c],t[c]=r,t[e]=o)}),t.forEach(function(n){var t,e,o=r(n),f=o[0],c=o[1];if(t=u[f])if(delete u[t.end],t.push(n),t.end=c,e=i[c]){delete i[e.start];var a=e===t?t:t.concat(e);i[a.start=t.start]=u[a.end=e.end]=a}else i[t.start]=u[t.end]=t;else if(t=i[c])if(delete i[t.start],t.unshift(n),t.start=f,e=u[f]){delete u[e.end];var s=e===t?t:e.concat(t);i[s.start=e.start]=u[s.end=t.end]=s}else i[t.start]=u[t.end]=t;else t=[n],i[t.start=f]=u[t.end=c]=t}),e(u,i),e(i,u),t.forEach(function(n){o[0>n?~n:n]||f.push([n])}),f}function r(n,r,e){function o(n){var t=0>n?~n:n;(s[t]||(s[t]=[])).push({i:n,g:a})}function i(n){n.forEach(o)}function u(n){n.forEach(i)}function f(n){"GeometryCollection"===n.type?n.geometries.forEach(f):n.type in l&&(a=n,l[n.type](n.arcs))}var c=[];if(arguments.length>1){var a,s=[],l={LineString:i,MultiLineString:u,Polygon:u,MultiPolygon:function(n){n.forEach(u)}};f(r),s.forEach(arguments.length<3?function(n){c.push(n[0].i)}:function(n){e(n[0].g,n[n.length-1].g)&&c.push(n[0].i)})}else for(var h=0,p=n.arcs.length;p>h;++h)c.push(h);return{type:"MultiLineString",arcs:t(n,c)}}function e(r,e){function o(n){n.forEach(function(t){t.forEach(function(t){(f[t=0>t?~t:t]||(f[t]=[])).push(n)})}),c.push(n)}function i(n){return l(u(r,{type:"Polygon",arcs:[n]}).coordinates[0])>0}var f={},c=[],a=[];return e.forEach(function(n){"Polygon"===n.type?o(n.arcs):"MultiPolygon"===n.type&&n.arcs.forEach(o)}),c.forEach(function(n){if(!n._){var t=[],r=[n];for(n._=1,a.push(t);n=r.pop();)t.push(n),n.forEach(function(n){n.forEach(function(n){f[0>n?~n:n].forEach(function(n){n._||(n._=1,r.push(n))})})})}}),c.forEach(function(n){delete n._}),{type:"MultiPolygon",arcs:a.map(function(e){var o=[];if(e.forEach(function(n){n.forEach(function(n){n.forEach(function(n){f[0>n?~n:n].length<2&&o.push(n)})})}),o=t(r,o),(n=o.length)>1)for(var u,c=i(e[0][0]),a=0;n>a;++a)if(c===i(o[a])){u=o[0],o[0]=o[a],o[a]=u;break}return o})}}function o(n,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return i(n,t)})}:i(n,t)}function i(n,t){var r={type:"Feature",id:t.id,properties:t.properties||{},geometry:u(n,t)};return null==t.id&&delete r.id,r}function u(n,t){function r(n,t){t.length&&t.pop();for(var r,e=s[0>n?~n:n],o=0,i=e.length;i>o;++o)t.push(r=e[o].slice()),a(r,o);0>n&&f(t,i)}function e(n){return n=n.slice(),a(n,0),n}function o(n){for(var t=[],e=0,o=n.length;o>e;++e)r(n[e],t);return t.length<2&&t.push(t[0].slice()),t}function i(n){for(var t=o(n);t.length<4;)t.push(t[0].slice());return t}function u(n){return n.map(i)}function c(n){var t=n.type;return"GeometryCollection"===t?{type:t,geometries:n.geometries.map(c)}:t in l?{type:t,coordinates:l[t](n)}:null}var a=v(n.transform),s=n.arcs,l={Point:function(n){return e(n.coordinates)},MultiPoint:function(n){return n.coordinates.map(e)},LineString:function(n){return o(n.arcs)},MultiLineString:function(n){return n.arcs.map(o)},Polygon:function(n){return u(n.arcs)},MultiPolygon:function(n){return n.arcs.map(u)}};return c(t)}function f(n,t){for(var r,e=n.length,o=e-t;o<--e;)r=n[o],n[o++]=n[e],n[e]=r}function c(n,t){for(var r=0,e=n.length;e>r;){var o=r+e>>>1;n[o]<t?r=o+1:e=o}return r}function a(n){function t(n,t){n.forEach(function(n){0>n&&(n=~n);var r=o[n];r?r.push(t):o[n]=[t]})}function r(n,r){n.forEach(function(n){t(n,r)})}function e(n,t){"GeometryCollection"===n.type?n.geometries.forEach(function(n){e(n,t)}):n.type in u&&u[n.type](n.arcs,t)}var o={},i=n.map(function(){return[]}),u={LineString:t,MultiLineString:r,Polygon:r,MultiPolygon:function(n,t){n.forEach(function(n){r(n,t)})}};n.forEach(e);for(var f in o)for(var a=o[f],s=a.length,l=0;s>l;++l)for(var h=l+1;s>h;++h){var p,g=a[l],v=a[h];(p=i[g])[f=c(p,v)]!==v&&p.splice(f,0,v),(p=i[v])[f=c(p,g)]!==g&&p.splice(f,0,g)}return i}function s(n,t){function r(n){i.remove(n),n[1][2]=t(n),i.push(n)}var e=v(n.transform),o=m(n.transform),i=g();return t||(t=h),n.arcs.forEach(function(n){for(var u,f,c=[],a=0,s=0,l=n.length;l>s;++s)f=n[s],e(n[s]=[f[0],f[1],1/0],s);for(var s=1,l=n.length-1;l>s;++s)u=n.slice(s-1,s+2),u[1][2]=t(u),c.push(u),i.push(u);for(var s=0,l=c.length;l>s;++s)u=c[s],u.previous=c[s-1],u.next=c[s+1];for(;u=i.pop();){var h=u.previous,p=u.next;u[1][2]<a?u[1][2]=a:a=u[1][2],h&&(h.next=p,h[2]=u[2],r(h)),p&&(p.previous=h,p[0]=u[0],r(p))}n.forEach(o)}),n}function l(n){for(var t,r=-1,e=n.length,o=n[e-1],i=0;++r<e;)t=o,o=n[r],i+=t[0]*o[1]-t[1]*o[0];return.5*i}function h(n){var t=n[0],r=n[1],e=n[2];return Math.abs((t[0]-e[0])*(r[1]-t[1])-(t[0]-r[0])*(e[1]-t[1]))}function p(n,t){return n[1][2]-t[1][2]}function g(){function n(n,t){for(;t>0;){var r=(t+1>>1)-1,o=e[r];if(p(n,o)>=0)break;e[o._=t]=o,e[n._=t=r]=n}}function t(n,t){for(;;){var r=t+1<<1,i=r-1,u=t,f=e[u];if(o>i&&p(e[i],f)<0&&(f=e[u=i]),o>r&&p(e[r],f)<0&&(f=e[u=r]),u===t)break;e[f._=t]=f,e[n._=t=u]=n}}var r={},e=[],o=0;return r.push=function(t){return n(e[t._=o]=t,o++),o},r.pop=function(){if(!(0>=o)){var n,r=e[0];return--o>0&&(n=e[o],t(e[n._=0]=n,0)),r}},r.remove=function(r){var i,u=r._;if(e[u]===r)return u!==--o&&(i=e[o],(p(i,r)<0?n:t)(e[i._=u]=i,u)),u},r}function v(n){if(!n)return y;var t,r,e=n.scale[0],o=n.scale[1],i=n.translate[0],u=n.translate[1];return function(n,f){f||(t=r=0),n[0]=(t+=n[0])*e+i,n[1]=(r+=n[1])*o+u}}function m(n){if(!n)return y;var t,r,e=n.scale[0],o=n.scale[1],i=n.translate[0],u=n.translate[1];return function(n,f){f||(t=r=0);var c=(n[0]-i)/e|0,a=(n[1]-u)/o|0;n[0]=c-t,n[1]=a-r,t=c,r=a}}function y(){}var d={version:"1.6.18",mesh:function(n){return u(n,r.apply(this,arguments))},meshArcs:r,merge:function(n){return u(n,e.apply(this,arguments))},mergeArcs:e,feature:o,neighbors:a,presimplify:s};"function"==typeof define&&define.amd?define(d):"object"==typeof module&&module.exports?module.exports=d:this.topojson=d}();

// _Prtg.Globe.Plugin.js //
(function(_Prtg, $, window, document, undefined) {
  var pluginName = "prtg_globe"
    , world =  {"type":"Topology","objects":{"countries":{"type":"GeometryCollection","bbox":[-179.99999999999997,-90.00000000000003,180.00000000000014,83.64513000000001],"geometries":[{"type":"Polygon","id":4,"arcs":[[0,1,2,3,4,5]]},{"type":"MultiPolygon","id":24,"arcs":[[[6,7,8,9]],[[10,11,12]]]},{"type":"Polygon","id":8,"arcs":[[13,14,15,16,17]]},{"type":"Polygon","id":784,"arcs":[[18,19,20,21,22]]},{"type":"MultiPolygon","id":32,"arcs":[[[23,24]],[[25,26,27,28,29,30]]]},{"type":"Polygon","id":51,"arcs":[[31,32,33,34,35]]},{"type":"MultiPolygon","id":10,"arcs":[[[36]],[[37]],[[38]],[[39]],[[40]],[[41]],[[42]],[[43]]]},{"type":"Polygon","id":260,"arcs":[[44]]},{"type":"MultiPolygon","id":36,"arcs":[[[45]],[[46]]]},{"type":"Polygon","id":40,"arcs":[[47,48,49,50,51,52,53]]},{"type":"MultiPolygon","id":31,"arcs":[[[54,-35]],[[55,56,-33,57,58]]]},{"type":"Polygon","id":108,"arcs":[[59,60,61]]},{"type":"Polygon","id":56,"arcs":[[62,63,64,65,66]]},{"type":"Polygon","id":204,"arcs":[[67,68,69,70,71]]},{"type":"Polygon","id":854,"arcs":[[72,73,74,-70,75,76]]},{"type":"Polygon","id":50,"arcs":[[77,78,79]]},{"type":"Polygon","id":100,"arcs":[[80,81,82,83,84,85]]},{"type":"MultiPolygon","id":44,"arcs":[[[86]],[[87]],[[88]]]},{"type":"Polygon","id":70,"arcs":[[89,90,91]]},{"type":"Polygon","id":112,"arcs":[[92,93,94,95,96]]},{"type":"Polygon","id":84,"arcs":[[97,98,99]]},{"type":"Polygon","id":68,"arcs":[[100,101,102,103,-31]]},{"type":"Polygon","id":76,"arcs":[[-27,104,-103,105,106,107,108,109,110,111,112]]},{"type":"Polygon","id":96,"arcs":[[113,114]]},{"type":"Polygon","id":64,"arcs":[[115,116]]},{"type":"Polygon","id":72,"arcs":[[117,118,119,120]]},{"type":"Polygon","id":140,"arcs":[[121,122,123,124,125,126,127]]},{"type":"MultiPolygon","id":124,"arcs":[[[128]],[[129]],[[130]],[[131]],[[132]],[[133]],[[134]],[[135]],[[136]],[[137]],[[138,139,140,141]],[[142]],[[143]],[[144]],[[145]],[[146]],[[147]],[[148]],[[149]],[[150]],[[151]],[[152]],[[153]],[[154]],[[155]],[[156]],[[157]],[[158]],[[159]],[[160]]]},{"type":"Polygon","id":756,"arcs":[[-51,161,162,163]]},{"type":"MultiPolygon","id":152,"arcs":[[[-24,164]],[[-30,165,166,-101]]]},{"type":"MultiPolygon","id":156,"arcs":[[[167]],[[168,169,170,171,172,173,-117,174,175,176,177,-4,178,179,180,181,182,183]]]},{"type":"Polygon","id":384,"arcs":[[184,185,186,187,-73,188]]},{"type":"Polygon","id":120,"arcs":[[189,190,191,192,193,194,-128,195]]},{"type":"Polygon","id":180,"arcs":[[196,197,-60,198,199,-10,200,-13,201,-126,202]]},{"type":"Polygon","id":178,"arcs":[[-12,203,204,-196,-127,-202]]},{"type":"Polygon","id":170,"arcs":[[205,206,207,208,209,-107,210]]},{"type":"Polygon","id":188,"arcs":[[211,212,213,214]]},{"type":"Polygon","id":192,"arcs":[[215]]},{"type":"Polygon","id":-99,"arcs":[[216,217]]},{"type":"Polygon","id":196,"arcs":[[218,-218]]},{"type":"Polygon","id":203,"arcs":[[-53,219,220,221]]},{"type":"Polygon","id":276,"arcs":[[222,223,-220,-52,-164,224,225,-64,226,227,228]]},{"type":"Polygon","id":262,"arcs":[[229,230,231,232]]},{"type":"MultiPolygon","id":208,"arcs":[[[233]],[[-229,234]]]},{"type":"Polygon","id":214,"arcs":[[235,236]]},{"type":"Polygon","id":12,"arcs":[[237,238,239,240,241,242,243,244]]},{"type":"Polygon","id":218,"arcs":[[245,-206,246]]},{"type":"Polygon","id":818,"arcs":[[247,248,249,250,251]]},{"type":"Polygon","id":232,"arcs":[[252,253,254,-233]]},{"type":"Polygon","id":724,"arcs":[[255,256,257,258]]},{"type":"Polygon","id":233,"arcs":[[259,260,261]]},{"type":"Polygon","id":231,"arcs":[[-232,262,263,264,265,266,267,-253]]},{"type":"Polygon","id":246,"arcs":[[268,269,270,271]]},{"type":"MultiPolygon","id":242,"arcs":[[[272]],[[273]]]},{"type":"Polygon","id":238,"arcs":[[274]]},{"type":"MultiPolygon","id":250,"arcs":[[[275,276,277,-111]],[[278]],[[279,-225,-163,280,281,-257,282,-66]]]},{"type":"Polygon","id":266,"arcs":[[283,284,-190,-205]]},{"type":"MultiPolygon","id":826,"arcs":[[[285,286]],[[287]]]},{"type":"Polygon","id":268,"arcs":[[288,289,-58,-32,290]]},{"type":"Polygon","id":288,"arcs":[[291,-189,-77,292]]},{"type":"Polygon","id":324,"arcs":[[293,294,295,296,297,298,-187]]},{"type":"Polygon","id":270,"arcs":[[299,300]]},{"type":"Polygon","id":624,"arcs":[[301,302,-297]]},{"type":"Polygon","id":226,"arcs":[[303,-191,-285]]},{"type":"MultiPolygon","id":300,"arcs":[[[304]],[[305,-15,306,-84,307]]]},{"type":"Polygon","id":304,"arcs":[[308]]},{"type":"Polygon","id":320,"arcs":[[309,310,-100,311,312,313]]},{"type":"Polygon","id":328,"arcs":[[314,315,-109,316]]},{"type":"Polygon","id":340,"arcs":[[317,318,-313,319,320]]},{"type":"Polygon","id":191,"arcs":[[321,-92,322,323,324,325]]},{"type":"Polygon","id":332,"arcs":[[-237,326]]},{"type":"Polygon","id":348,"arcs":[[-48,327,328,329,330,-326,331]]},{"type":"MultiPolygon","id":360,"arcs":[[[332]],[[333,334]],[[335]],[[336]],[[337]],[[338]],[[339]],[[340]],[[341,342]],[[343]],[[344]],[[345,346]],[[347]]]},{"type":"Polygon","id":356,"arcs":[[-177,348,-175,-116,-174,349,-80,350,351]]},{"type":"Polygon","id":372,"arcs":[[352,-286]]},{"type":"Polygon","id":364,"arcs":[[353,-6,354,355,356,357,-55,-34,-57,358]]},{"type":"Polygon","id":368,"arcs":[[359,360,361,362,363,364,-357]]},{"type":"Polygon","id":352,"arcs":[[365]]},{"type":"Polygon","id":376,"arcs":[[366,367,368,-252,369,370,371]]},{"type":"MultiPolygon","id":380,"arcs":[[[372]],[[373]],[[374,375,-281,-162,-50]]]},{"type":"Polygon","id":388,"arcs":[[376]]},{"type":"Polygon","id":400,"arcs":[[-367,377,-363,378,379,-369,380]]},{"type":"MultiPolygon","id":392,"arcs":[[[381]],[[382]],[[383]]]},{"type":"Polygon","id":398,"arcs":[[384,385,386,387,-181,388]]},{"type":"Polygon","id":404,"arcs":[[389,390,391,392,-265,393]]},{"type":"Polygon","id":417,"arcs":[[-389,-180,394,395]]},{"type":"Polygon","id":116,"arcs":[[396,397,398,399]]},{"type":"Polygon","id":410,"arcs":[[400,401]]},{"type":"Polygon","id":-99,"arcs":[[-18,402,403,404]]},{"type":"Polygon","id":414,"arcs":[[405,406,-361]]},{"type":"Polygon","id":418,"arcs":[[407,408,-172,409,-398]]},{"type":"Polygon","id":422,"arcs":[[-371,410,411]]},{"type":"Polygon","id":430,"arcs":[[412,413,-294,-186]]},{"type":"Polygon","id":434,"arcs":[[414,-245,415,416,-250,417,418]]},{"type":"Polygon","id":144,"arcs":[[419]]},{"type":"Polygon","id":426,"arcs":[[420]]},{"type":"Polygon","id":440,"arcs":[[421,422,423,-93,424]]},{"type":"Polygon","id":442,"arcs":[[-226,-280,-65]]},{"type":"Polygon","id":428,"arcs":[[425,-262,426,-94,-424]]},{"type":"Polygon","id":504,"arcs":[[-242,427,428]]},{"type":"Polygon","id":498,"arcs":[[429,430]]},{"type":"Polygon","id":450,"arcs":[[431]]},{"type":"Polygon","id":484,"arcs":[[432,-98,-311,433,434]]},{"type":"Polygon","id":807,"arcs":[[-405,435,-85,-307,-14]]},{"type":"Polygon","id":466,"arcs":[[436,-239,437,-74,-188,-299,438]]},{"type":"Polygon","id":104,"arcs":[[439,-78,-350,-173,-409,440]]},{"type":"Polygon","id":499,"arcs":[[441,-323,-91,442,-403,-17]]},{"type":"Polygon","id":496,"arcs":[[443,-183]]},{"type":"Polygon","id":508,"arcs":[[444,445,446,447,448,449,450,451]]},{"type":"Polygon","id":478,"arcs":[[452,453,454,-240,-437]]},{"type":"Polygon","id":454,"arcs":[[-452,455,456]]},{"type":"MultiPolygon","id":458,"arcs":[[[457,458]],[[-346,459,-115,460]]]},{"type":"Polygon","id":516,"arcs":[[461,-8,462,-119,463]]},{"type":"Polygon","id":540,"arcs":[[464]]},{"type":"Polygon","id":562,"arcs":[[-75,-438,-238,-415,465,-194,466,-71]]},{"type":"Polygon","id":566,"arcs":[[467,-72,-467,-193]]},{"type":"Polygon","id":558,"arcs":[[468,-321,469,-213]]},{"type":"Polygon","id":528,"arcs":[[-227,-63,470]]},{"type":"MultiPolygon","id":578,"arcs":[[[471,-272,472,473]],[[474]],[[475]],[[476]]]},{"type":"Polygon","id":524,"arcs":[[-349,-176]]},{"type":"MultiPolygon","id":554,"arcs":[[[477]],[[478]]]},{"type":"MultiPolygon","id":512,"arcs":[[[479,480,-22,481]],[[-20,482]]]},{"type":"Polygon","id":586,"arcs":[[-178,-352,483,-355,-5]]},{"type":"Polygon","id":591,"arcs":[[484,-215,485,-208]]},{"type":"Polygon","id":604,"arcs":[[-167,486,-247,-211,-106,-102]]},{"type":"MultiPolygon","id":608,"arcs":[[[487]],[[488]],[[489]],[[490]],[[491]],[[492]],[[493]]]},{"type":"MultiPolygon","id":598,"arcs":[[[494]],[[495]],[[-342,496]],[[497]]]},{"type":"Polygon","id":616,"arcs":[[-224,498,499,-425,-97,500,501,-221]]},{"type":"Polygon","id":630,"arcs":[[502]]},{"type":"Polygon","id":408,"arcs":[[503,504,-402,505,-169]]},{"type":"Polygon","id":620,"arcs":[[-259,506]]},{"type":"Polygon","id":600,"arcs":[[-104,-105,-26]]},{"type":"Polygon","id":275,"arcs":[[-381,-368]]},{"type":"Polygon","id":634,"arcs":[[507,508]]},{"type":"Polygon","id":642,"arcs":[[509,-431,510,511,-81,512,-330]]},{"type":"MultiPolygon","id":643,"arcs":[[[513]],[[-500,514,-422]],[[515]],[[516]],[[517]],[[518]],[[519]],[[-504,-184,-444,-182,-388,520,-59,-290,521,522,-95,-427,-261,523,-269,-472,524]],[[525]],[[526]],[[527]]]},{"type":"Polygon","id":646,"arcs":[[528,-61,-198,529]]},{"type":"Polygon","id":732,"arcs":[[-241,-455,530,-428]]},{"type":"Polygon","id":682,"arcs":[[531,-379,-362,-407,532,-509,533,-23,-481,534]]},{"type":"Polygon","id":729,"arcs":[[535,536,-123,537,-418,-249,538,-254,-268,539]]},{"type":"Polygon","id":728,"arcs":[[540,-266,-393,541,-203,-125,542,-536]]},{"type":"Polygon","id":686,"arcs":[[543,-453,-439,-298,-303,544,-301]]},{"type":"MultiPolygon","id":90,"arcs":[[[545]],[[546]],[[547]],[[548]],[[549]]]},{"type":"Polygon","id":694,"arcs":[[550,-295,-414]]},{"type":"Polygon","id":222,"arcs":[[551,-314,-319]]},{"type":"Polygon","id":-99,"arcs":[[-263,-231,552,553]]},{"type":"Polygon","id":706,"arcs":[[-394,-264,-554,554]]},{"type":"Polygon","id":688,"arcs":[[-86,-436,-404,-443,-90,-322,-331,-513]]},{"type":"Polygon","id":740,"arcs":[[555,-277,556,-110,-316]]},{"type":"Polygon","id":703,"arcs":[[-502,557,-328,-54,-222]]},{"type":"Polygon","id":705,"arcs":[[-49,-332,-325,558,-375]]},{"type":"Polygon","id":752,"arcs":[[-473,-271,559]]},{"type":"Polygon","id":748,"arcs":[[560,-448]]},{"type":"Polygon","id":760,"arcs":[[-378,-372,-412,561,562,-364]]},{"type":"Polygon","id":148,"arcs":[[-466,-419,-538,-122,-195]]},{"type":"Polygon","id":768,"arcs":[[563,-293,-76,-69]]},{"type":"Polygon","id":764,"arcs":[[564,-459,565,-441,-408,-397]]},{"type":"Polygon","id":762,"arcs":[[-395,-179,-3,566]]},{"type":"Polygon","id":795,"arcs":[[-354,567,-386,568,-1]]},{"type":"Polygon","id":626,"arcs":[[569,-334]]},{"type":"Polygon","id":780,"arcs":[[570]]},{"type":"Polygon","id":788,"arcs":[[-244,571,-416]]},{"type":"MultiPolygon","id":792,"arcs":[[[-291,-36,-358,-365,-563,572]],[[-308,-83,573]]]},{"type":"Polygon","id":158,"arcs":[[574]]},{"type":"Polygon","id":834,"arcs":[[-391,575,-445,-457,576,-199,-62,-529,577]]},{"type":"Polygon","id":800,"arcs":[[-530,-197,-542,-392,-578]]},{"type":"Polygon","id":804,"arcs":[[-523,578,-511,-430,-510,-329,-558,-501,-96]]},{"type":"Polygon","id":858,"arcs":[[-113,579,-28]]},{"type":"MultiPolygon","id":840,"arcs":[[[580]],[[581]],[[582]],[[583]],[[584]],[[585,-435,586,-139]],[[587]],[[588]],[[589]],[[-141,590]]]},{"type":"Polygon","id":860,"arcs":[[-569,-385,-396,-567,-2]]},{"type":"Polygon","id":862,"arcs":[[591,-317,-108,-210]]},{"type":"Polygon","id":704,"arcs":[[592,-399,-410,-171]]},{"type":"MultiPolygon","id":548,"arcs":[[[593]],[[594]]]},{"type":"Polygon","id":887,"arcs":[[595,-535,-480]]},{"type":"Polygon","id":710,"arcs":[[-464,-118,596,-449,-561,-447,597],[-421]]},{"type":"Polygon","id":894,"arcs":[[-456,-451,598,-120,-463,-7,-200,-577]]},{"type":"Polygon","id":716,"arcs":[[-597,-121,-599,-450]]}]},"land":{"type":"MultiPolygon","arcs":[[[540,266,539],[123,542,536],[592,399,564,457,565,439,78,350,483,355,359,405,532,507,533,18,482,20,481,595,531,379,247,538,254,229,552,554,389,575,445,597,461,8,200,10,203,283,303,191,467,67,563,291,184,412,550,295,301,544,299,543,453,530,428,242,571,416,250,369,410,561,572,288,521,578,511,81,573,305,15,441,323,558,375,281,257,506,255,282,66,470,227,234,222,498,514,422,425,259,523,269,559,473,524,504,400,505,169],[386,520,55,358,567]],[[24,164]],[[556,275],[579,28,165,486,245,206,484,211,468,317,551,309,433,586,139,590,141,585,432,98,311,319,469,213,485,208,591,314,555,277,111]],[[36]],[[37]],[[38]],[[39]],[[40]],[[41]],[[42]],[[43]],[[44]],[[45]],[[46]],[[86]],[[87]],[[88]],[[459,113,460,346]],[[128]],[[129]],[[130]],[[131]],[[132]],[[133]],[[134]],[[135]],[[136]],[[137]],[[142]],[[143]],[[144]],[[145]],[[146]],[[147]],[[148]],[[149]],[[150]],[[151]],[[152]],[[153]],[[154]],[[155]],[[156]],[[157]],[[158]],[[159]],[[160]],[[167]],[[215]],[[216,218]],[[233]],[[235,326]],[[272]],[[273]],[[274]],[[278]],[[286,352]],[[287]],[[304]],[[308]],[[332]],[[334,569]],[[335]],[[336]],[[337]],[[338]],[[339]],[[340]],[[342,496]],[[343]],[[344]],[[347]],[[365]],[[372]],[[373]],[[376]],[[381]],[[382]],[[383]],[[419]],[[431]],[[464]],[[474]],[[475]],[[476]],[[477]],[[478]],[[487]],[[488]],[[489]],[[490]],[[491]],[[492]],[[493]],[[494]],[[495]],[[497]],[[502]],[[513]],[[515]],[[516]],[[517]],[[518]],[[519]],[[525]],[[526]],[[527]],[[545]],[[546]],[[547]],[[548]],[[549]],[[570]],[[574]],[[580]],[[581]],[[582]],[[583]],[[584]],[[587]],[[588]],[[589]],[[593]],[[594]]]}},"arcs":[[[67002,72360],[284,-219],[209,77],[58,261],[219,87],[157,175],[55,460],[234,112],[44,205],[131,-154],[84,-18]],[[68477,73346],[154,-4],[210,-122]],[[68841,73220],[85,-70],[201,185],[93,-111],[90,264],[166,-12],[43,84],[29,233],[120,200],[150,-131],[-30,-176],[84,-27],[-26,-484],[110,-189],[97,121],[123,57],[173,258],[192,-42],[286,-1]],[[70827,73379],[50,-165]],[[70877,73214],[-162,-65],[-141,-106],[-319,-67],[-298,-121],[-163,-251],[66,-244],[32,-287],[-139,-242],[12,-221],[-76,-207],[-265,18],[110,-381],[-177,-146],[-118,-347],[15,-346],[-108,-162],[-103,53],[-212,-75],[-31,-161],[-207,1],[-154,-326],[-10,-490],[-361,-239],[-194,50],[-56,-126],[-166,74],[-278,-87],[-465,294]],[[66909,69007],[252,523],[-23,370],[-210,97],[-22,366],[-91,460],[119,315],[-121,85],[76,419],[113,718]],[[56642,45537],[29,-179],[-32,-279],[49,-270],[-41,-216],[24,-199],[-579,7],[-13,-1832],[188,-471],[181,-360]],[[56448,41738],[-510,-235],[-673,82],[-192,276],[-1126,-25],[-42,-40],[-166,260],[-180,17],[-166,-98],[-134,-110]],[[53259,41865],[-26,363],[38,506],[96,527],[15,247],[90,519],[66,236],[159,377],[90,256],[29,427],[-15,326],[-83,206],[-74,350],[-68,345],[15,120],[85,228],[-84,557],[-57,385],[-139,364],[26,112]],[[53422,48316],[115,78],[80,-11],[98,69],[820,-7],[68,-430],[80,-345],[64,-186],[106,-301],[184,46],[91,81],[154,-81],[42,144],[69,336],[172,22],[15,100],[142,2],[-24,-207],[337,5],[5,-363],[56,-222],[-41,-347],[21,-354],[93,-214],[-15,-685],[68,53],[121,-15],[172,87],[127,-34]],[[53383,48495],[-74,433]],[[53309,48928],[112,249],[84,97],[104,-198]],[[53609,49076],[-101,-121],[-45,-148],[-9,-251],[-71,-61]],[[55719,75933],[-35,-196],[39,-247],[115,-140]],[[55838,75350],[-5,-151],[-91,-84],[-16,-187],[-129,-279]],[[55597,74649],[-48,40],[-5,127],[-154,193],[-24,274],[23,393],[38,179],[-47,91]],[[55380,75946],[-18,183],[120,284],[18,-109],[75,51]],[[55575,76355],[59,-154],[66,-59],[19,-209]],[[64327,65792],[49,28],[11,-158],[217,91],[230,-15],[168,-17],[190,389],[207,369],[176,355]],[[65575,66834],[52,-196]],[[65627,66638],[38,-455]],[[65665,66183],[-142,-2],[-23,-375],[50,-80],[-126,-114],[-1,-235],[-81,-238],[-7,-232]],[[65335,64907],[-56,-122],[-835,290],[-106,584],[-11,133]],[[31400,20215],[-168,16],[-297,0],[0,1286]],[[30935,21517],[106,-267],[139,-432],[361,-345],[389,-144],[-125,-288],[-264,-29],[-141,203]],[[32587,39017],[511,-940],[227,-88],[339,-425],[286,-225],[40,-254],[-273,-876],[280,-156],[312,-88],[220,92],[252,441],[45,509]],[[34826,37007],[138,110],[139,-332],[-6,-460],[-234,-318],[-186,-234],[-314,-559],[-370,-786]],[[33993,34428],[-70,-461],[-74,-592],[3,-573],[-61,-128],[-21,-372]],[[33770,32302],[-19,-301],[353,-493],[-38,-397],[173,-251],[-14,-282],[-267,-738],[-412,-309],[-557,-120],[-305,58],[59,-343],[-57,-431],[51,-291],[-167,-202],[-284,-80],[-267,210],[-108,-151],[39,-572],[188,-173],[152,181],[82,-299],[-255,-179],[-223,-358],[-41,-579],[-66,-309],[-262,-1],[-218,-295],[-80,-432],[273,-422],[266,-116],[-96,-517],[-328,-325],[-180,-675],[-254,-227],[-113,-270],[89,-598],[185,-333],[-117,29]],[[30952,21711],[-257,90],[-672,77],[-115,336],[6,431],[-185,-37],[-98,209],[-24,611],[213,253],[88,365],[-33,292],[148,491],[101,763],[-30,338],[122,109],[-30,217],[-129,115],[92,242],[-126,218],[-65,665],[112,117],[-47,702],[65,590],[75,513],[166,209],[-84,563],[-1,529],[210,376],[-7,481],[159,562],[1,530],[-72,105],[-128,994],[171,592],[-27,558],[100,523],[182,540],[196,358],[-83,226],[58,186],[-9,960],[302,284],[96,598],[-34,144]],[[31359,38736],[231,521],[364,-141],[163,-416],[109,464],[316,-24],[45,-123]],[[62106,75494],[386,89]],[[62492,75583],[57,-151],[106,-100],[-56,-144],[148,-198],[-78,-183],[118,-157],[124,-94],[7,-399]],[[62918,74157],[-101,-17]],[[62817,74140],[-113,333],[1,89],[-123,-2],[-82,155],[-58,-16]],[[62442,74699],[-109,168],[-207,144],[27,280],[-47,203]],[[33452,5736],[-82,-294],[-81,-259],[-582,79],[-621,-34],[-348,192],[0,22],[-152,170],[625,-23],[599,-56],[207,237],[147,203],[288,-237]],[[5775,6048],[-533,-79],[-364,204],[-163,203],[-11,34],[-180,158],[169,214],[517,-90],[277,-181],[212,-203],[76,-260]],[[37457,6883],[342,-248],[120,-350],[33,-248],[11,-293],[-430,-181],[-452,-146],[-522,-136],[-582,-113],[-658,34],[-365,192],[49,237],[593,158],[239,192],[174,248],[126,214],[168,203],[180,238],[0,-1],[141,0],[414,125],[419,-125]],[[16330,9501],[359,-90],[332,102],[-158,-203],[-261,-147],[-386,45],[-278,203],[60,192],[332,-102]],[[15122,9513],[425,-226],[-164,23],[-359,56],[-381,158],[202,124],[277,-135]],[[22505,10404],[305,-79],[304,68],[163,-327],[-217,45],[-337,-23],[-343,23],[-376,-34],[-283,113],[-146,237],[174,101],[353,-79],[403,-45]],[[30985,10967],[33,-259],[-49,-226],[-76,-214],[-326,-79],[-311,-113],[-364,11],[136,226],[-327,-79],[-310,-79],[-212,169],[-16,237],[305,226],[190,67],[321,-22],[82,293],[16,215],[-6,462],[158,271],[256,90],[147,-214],[65,-214],[120,-260],[92,-248],[76,-260]],[[0,3044],[16,-4],[245,335],[501,-181],[32,21],[294,183],[38,-6],[32,-5],[402,-239],[352,239],[63,33],[816,102],[265,-135],[130,-68],[419,-192],[789,-147],[625,-180],[1072,-136],[800,158],[1181,-113],[669,-180],[734,169],[773,158],[60,271],[-1094,22],[-898,136],[-234,225],[-745,125],[49,259],[103,237],[104,214],[-55,237],[-462,158],[-212,204],[-430,180],[675,-34],[642,91],[402,-192],[495,169],[457,214],[223,192],[-98,237],[-359,158],[-408,169],[-571,34],[-500,79],[-539,57],[-180,214],[-359,181],[-217,203],[-87,654],[136,-56],[250,-181],[457,57],[441,79],[228,-249],[441,57],[370,124],[348,158],[315,192],[419,56],[-11,215],[-97,214],[81,203],[359,102],[163,-192],[425,113],[321,146],[397,12],[375,56],[376,136],[299,124],[337,124],[218,-34],[190,-45],[414,79],[370,-102],[381,12],[364,79],[375,-57],[414,-56],[386,22],[403,-11],[413,-11],[381,22],[283,170],[337,90],[349,-124],[331,101],[300,203],[179,-180],[98,-203],[180,-192],[288,169],[332,-214],[375,-68],[321,-158],[392,34],[354,101],[418,-22],[376,-79],[381,-102],[147,249],[-180,191],[-136,204],[-359,45],[-158,214],[-60,214],[-98,429],[213,-79],[364,-34],[359,34],[327,-90],[283,-169],[119,-203],[376,-34],[359,79],[381,113],[342,67],[283,-135],[370,45],[239,440],[224,-259],[321,-102],[348,56],[228,-225],[365,-23],[337,-68],[332,-124],[218,215],[108,203],[278,-226],[381,57],[283,-125],[190,-191],[370,56],[288,124],[283,147],[337,79],[392,68],[354,79],[272,124],[163,180],[65,249],[-32,236],[-87,226],[-98,226],[-87,226],[-71,203],[-16,225],[27,226],[130,214],[109,237],[44,226],[-55,248],[-32,226],[136,260],[152,169],[180,214],[190,181],[223,169],[109,248],[152,158],[174,147],[267,34],[174,180],[196,113],[228,68],[202,147],[157,180],[218,68],[163,-147],[-103,-192],[-283,-169],[-120,-124],[-206,90],[-229,-56],[-190,-136],[-202,-146],[-136,-170],[-38,-225],[17,-215],[130,-191],[-190,-136],[-261,-45],[-153,-192],[-163,-180],[-174,-249],[-44,-214],[98,-237],[147,-181],[229,-135],[212,-181],[114,-225],[60,-215],[82,-225],[130,-192],[82,-215],[38,-530],[81,-214],[22,-226],[87,-226],[-38,-304],[-152,-237],[-163,-192],[-370,-79],[-125,-203],[-169,-192],[-419,-215],[-370,-90],[-348,-124],[-376,-124],[-223,-237],[-446,-23],[-489,23],[-441,-45],[-468,0],[87,-226],[424,-101],[311,-158],[174,-204],[-310,-180],[-479,56],[-397,-146],[-17,-237],[-11,-226],[327,-192],[60,-214],[353,-215],[588,-90],[500,-158],[398,-180],[506,-181],[690,-90],[681,-158],[473,-170],[517,-191],[272,-271],[136,-215],[337,204],[457,169],[484,180],[577,147],[495,158],[691,11],[680,-79],[560,-135],[180,248],[386,169],[702,12],[550,124],[522,124],[577,79],[614,102],[430,146],[-196,203],[-119,203],[0,215],[-539,-23],[-571,-90],[-544,0],[-77,214],[39,429],[125,124],[397,136],[468,135],[337,169],[337,170],[251,225],[380,102],[376,79],[190,45],[430,23],[408,79],[343,112],[337,136],[305,135],[386,181],[245,192],[261,169],[82,226],[-294,135],[98,237],[185,181],[288,112],[305,136],[283,180],[217,226],[136,271],[202,158],[331,-34],[136,-192],[332,-22],[11,214],[142,226],[299,-57],[71,-214],[331,-34],[360,102],[348,67],[315,-34],[120,-237],[305,192],[283,102],[315,79],[310,79],[283,135],[310,91],[240,124],[168,203],[207,-147],[288,79],[202,-271],[157,-203],[316,113],[125,226],[283,158],[365,-34],[108,-215],[229,215],[299,68],[326,22],[294,-11],[310,-68],[300,-34],[130,-192],[180,-169],[304,102],[327,22],[315,0],[310,12],[278,79],[294,67],[245,158],[261,102],[283,56],[212,158],[152,316],[158,192],[288,-90],[109,-203],[239,-136],[289,45],[196,-203],[206,-146],[283,135],[98,248],[250,102],[289,192],[272,79],[326,112],[218,125],[228,135],[218,124],[261,-68],[250,203],[180,158],[261,-11],[229,136],[54,203],[234,158],[228,113],[278,90],[256,45],[244,-34],[262,-56],[223,-158],[27,-249],[245,-191],[168,-158],[332,-68],[185,-158],[229,-158],[266,-34],[223,113],[240,237],[261,-124],[272,-68],[261,-68],[272,-45],[277,0],[229,-598],[-11,-147],[-33,-259],[-266,-147],[-218,-214],[38,-226],[310,11],[-38,-225],[-141,-215],[-131,-237],[212,-180],[321,-57],[321,102],[153,226],[92,214],[153,181],[174,169],[70,203],[147,282],[174,57],[316,22],[277,68],[283,90],[136,226],[82,214],[190,215],[272,146],[234,113],[153,192],[157,101],[202,91],[277,-57],[250,57],[272,67],[305,-33],[201,158],[142,383],[103,-158],[131,-271],[234,-112],[266,-46],[267,68],[283,-45],[261,-11],[174,56],[234,-34],[212,-124],[250,79],[300,0],[255,79],[289,-79],[185,192],[141,192],[191,158],[348,429],[179,-79],[212,-158],[185,-203],[354,-350],[272,-12],[256,0],[299,68],[299,79],[229,158],[190,169],[310,23],[207,124],[218,-113],[141,-180],[196,-181],[305,23],[190,-147],[332,-147],[348,-56],[288,45],[218,181],[185,180],[250,45],[251,-79],[288,-56],[261,90],[250,0],[245,-56],[256,-57],[250,102],[299,90],[283,23],[316,0],[255,56],[251,45],[76,282],[11,237],[174,-158],[49,-259],[92,-237],[115,-192],[234,-102],[315,34],[365,12],[250,33],[364,0],[262,12],[364,-23],[310,-45],[196,-181],[-54,-214],[179,-169],[299,-136],[310,-146],[360,-102],[375,-90],[283,-90],[315,-12],[180,192],[245,-158],[212,-180],[245,-136],[337,-56],[321,-68],[136,-226],[316,-135],[212,-203],[310,-90],[321,11],[299,-34],[332,11],[332,-45],[310,-79],[288,-135],[289,-113],[195,-169],[-32,-226],[-147,-203],[-125,-260],[-98,-203],[-131,-237],[-364,-90],[-163,-203],[-360,-124],[-125,-226],[-190,-214],[-201,-181],[-115,-237],[-70,-214],[-28,-260],[6,-214],[158,-226],[60,-214],[130,-204],[517,-78],[109,-249],[-501,-90],[-424,-124],[-528,-23],[-234,-327],[-49,-271],[-119,-214],[-147,-215],[370,-191],[141,-237],[239,-215],[338,-192],[386,-180],[419,-181],[636,-180],[142,-282],[800,-125],[53,-44],[208,-170],[767,147],[636,-181],[-99520,-139]],[[69148,23827],[179,-181],[263,-72],[9,-110],[-77,-262],[-427,-37],[-7,306],[41,238],[19,118]],[[90387,28338],[269,-199],[151,79],[217,111],[166,-39],[20,-684],[-95,-198],[-29,-463],[-97,157],[-193,-401],[-57,31],[-171,18],[-171,493],[-38,380],[-160,502],[7,264],[181,-51]],[[89877,43903],[100,-452],[179,217],[92,-243],[133,-225],[-29,-255],[60,-494],[42,-288],[70,-70],[75,-492],[-27,-299],[90,-390],[301,-301],[197,-274],[186,-251],[-37,-139],[159,-361],[108,-623],[111,126],[113,-249],[68,88],[48,-610],[197,-354],[129,-220],[217,-466],[78,-463],[7,-328],[-19,-356],[132,-490],[-16,-509],[-48,-267],[-75,-514],[6,-330],[-55,-413],[-123,-524],[-205,-283],[-102,-446],[-93,-284],[-82,-497],[-107,-287],[-70,-431],[-36,-397],[14,-182],[-159,-200],[-311,-21],[-257,-236],[-127,-223],[-168,-248],[-230,255],[-170,101],[43,301],[-152,-109],[-243,-417],[-240,156],[-158,91],[-159,41],[-269,167],[-179,355],[-52,437],[-64,291],[-137,233],[-267,70],[91,279],[-67,428],[-136,-399],[-247,-106],[146,319],[42,332],[107,282],[-22,427],[-226,-491],[-174,-197],[-106,-458],[-217,237],[9,305],[-174,418],[-147,216],[52,133],[-356,349],[-195,16],[-267,280],[-498,-54],[-359,-206],[-317,-192],[-265,38],[-294,-296],[-241,-132],[-53,-302],[-103,-234],[-236,-14],[-174,-52],[-246,105],[-199,-62],[-191,-27],[-165,-307],[-81,26],[-140,-163],[-133,-183],[-203,23],[-186,0],[-295,368],[-149,109],[6,330],[138,79],[47,131],[-10,207],[34,400],[-31,341],[-147,582],[-45,329],[12,328],[-111,375],[-7,169],[-123,230],[-35,451],[-158,456],[-39,245],[122,-249],[-93,535],[137,-167],[83,-223],[-5,294],[-138,454],[-26,181],[-65,173],[31,333],[56,141],[38,289],[-29,336],[114,415],[21,-439],[118,396],[225,193],[136,245],[212,212],[126,45],[77,-71],[219,214],[168,64],[42,126],[74,53],[153,-14],[292,169],[151,256],[71,307],[163,293],[13,229],[7,314],[194,489],[117,-497],[119,115],[-99,272],[87,279],[122,-125],[34,439],[152,283],[67,227],[140,98],[4,161],[122,-67],[5,145],[122,82],[134,78],[205,-264],[155,-342],[173,-3],[177,-54],[-59,316],[133,462],[126,150],[-44,144],[121,329],[168,203],[142,-68],[234,108],[-5,294],[-204,190],[148,84],[184,-143],[148,-236],[234,-148],[79,59],[172,-177],[162,164],[105,-50],[65,111],[127,-285],[-74,-308],[-105,-233],[-96,-19],[32,-230],[-81,-288],[-99,-283],[20,-163],[221,-318],[214,-184],[143,-199],[201,-341],[78,1],[145,-148],[43,-178],[265,-195],[183,197],[55,309],[56,255],[34,316],[85,458],[-39,279],[20,167],[-32,330],[37,434],[53,117],[-43,192],[67,305],[52,317],[7,164],[104,216],[78,-282],[19,-361],[70,-70],[11,-242],[101,-293],[21,-326],[-10,-209]],[[54716,79543],[-21,-236],[-156,-1],[53,-125],[-92,-370]],[[54500,78811],[-53,-97],[-243,-15],[-140,-130],[-229,44]],[[53835,78613],[-398,149],[-62,200],[-274,-100],[-32,-109],[-169,81]],[[52900,78834],[-142,16],[-125,105],[42,141],[-10,102]],[[52665,79198],[83,32],[141,-160],[39,152],[245,-25],[199,104],[133,-18],[87,-118],[26,98],[-40,375],[100,73],[98,266]],[[53776,79977],[206,-186],[157,236],[98,43],[215,-176],[131,30],[128,-109]],[[54711,79815],[-23,-73],[28,-199]],[[62817,74140],[-190,76],[-141,266],[-44,217]],[[63495,75906],[146,-303],[141,-408],[130,-27],[85,-156],[-228,-46],[-49,-447],[-48,-202],[-101,-135],[7,-285]],[[63578,73897],[-69,-28],[-173,301],[95,285],[-82,169],[-104,-43],[-327,-424]],[[62492,75583],[68,94],[207,-165],[149,-34],[38,67],[-136,312],[72,79]],[[62890,75936],[78,-19],[191,-350],[122,-39],[48,146],[166,232]],[[58149,49238],[-17,694],[-70,262]],[[58062,50194],[169,-45],[85,328],[147,-38]],[[58463,50439],[16,-227],[60,-130],[3,-187],[-69,-121],[-108,-300],[-101,-209],[-115,-27]],[[50920,81398],[204,-45],[257,120],[176,-252],[153,-135]],[[51710,81086],[-32,-389]],[[51678,80697],[-72,-22],[-30,-323]],[[51576,80352],[-243,263],[-143,-45],[-194,272],[-129,231],[-129,9],[-40,203]],[[50698,81285],[222,113]],[[50747,55434],[-229,-68]],[[50518,55366],[-69,398],[13,1322],[-56,119],[-11,283],[-96,201],[-85,170],[35,303]],[[50249,58162],[96,66],[56,251],[136,54],[61,172]],[[50598,58705],[93,169],[100,2],[212,-332]],[[51003,58544],[-11,-191],[62,-342],[-54,-232],[29,-154],[-135,-357],[-86,-176],[-52,-364],[7,-366],[-16,-928]],[[49214,57382],[-190,149],[-130,-22],[-97,-145],[-125,122],[-49,190],[-125,126]],[[48498,57802],[-18,334],[76,244],[-7,195],[221,477],[41,395],[76,141],[134,-78],[116,117],[38,148],[216,259],[53,180],[259,238],[153,82],[70,-110],[178,3]],[[50104,60427],[-22,-280],[37,-262],[156,-376],[9,-279],[320,-130],[-6,-395]],[[50249,58162],[-243,13]],[[50006,58175],[-128,46],[-90,-93],[-123,42],[-482,-27],[-7,-327],[38,-434]],[[75742,64522],[-6,-413],[-97,88],[18,-464]],[[75657,63733],[-79,301],[-16,293],[-53,277],[-116,335],[-256,23],[25,-237],[-87,-321],[-118,117],[-41,-105],[-78,63],[-108,52]],[[74730,64531],[-43,474],[-96,433],[47,347],[-171,154],[62,210],[173,215],[-200,305],[98,390],[220,-248],[133,-29],[24,-400],[265,-79],[257,8],[160,-98],[-128,-487],[-124,-34],[-86,-327],[152,-299],[46,368],[76,2],[147,-914]],[[56293,77303],[80,-236],[108,42],[213,-90],[408,-30],[138,147],[327,133],[202,-209],[163,-60]],[[57932,77000],[-144,-239],[-101,-412],[89,-328]],[[57776,76021],[-239,77],[-283,-181]],[[57254,75917],[-3,-287],[-252,-55],[-196,202],[-222,-159],[-206,17]],[[56375,75635],[-20,381],[-139,185]],[[56216,76201],[46,81],[-30,69],[47,183],[105,180],[-135,248],[-24,211],[68,130]],[[28462,65512],[-68,-29],[-70,332],[-104,167],[60,365],[84,-23],[97,-478],[1,-334]],[[28383,67136],[-303,-92],[-19,213],[130,46],[184,-17],[8,-150]],[[28611,67142],[-48,-409],[-51,73],[4,301],[-124,228],[-1,66],[220,-259]],[[55279,77663],[100,2],[-69,-253],[134,-222],[-41,-271],[-65,-25]],[[55338,76894],[-52,-53],[-90,-134],[-41,-316]],[[55155,76391],[-246,218],[-105,240],[-106,128],[-127,215],[-61,178],[-136,270],[59,239],[99,-133],[60,120],[130,13],[239,-96],[192,8],[126,-128]],[[56523,82877],[268,-4],[302,217],[64,325],[228,184],[-26,258]],[[57359,83857],[169,97],[298,222]],[[57826,84176],[293,-144],[39,-143],[146,68],[272,-137],[27,-270],[-60,-156],[174,-377],[113,-105],[-16,-104],[187,-101],[80,-154],[-108,-126],[-224,20],[-54,-53],[66,-192],[68,-368]],[[58829,81834],[-239,-34],[-85,-127],[-18,-290],[-111,56],[-250,-28],[-73,135],[-104,-100],[-105,83],[-218,11],[-310,139],[-281,45],[-215,-13],[-152,-156],[-133,-23]],[[56535,81532],[-6,257],[-85,267],[166,117],[2,230],[-77,219],[-12,255]],[[25238,62085],[-2,85],[33,26],[51,-68],[99,348],[53,7]],[[25472,62483],[1,-84],[53,-3],[-5,-157],[-45,-249],[24,-89],[-29,-206],[18,-55],[-32,-291],[-55,-153],[-50,-18],[-55,-199]],[[25297,60979],[-83,-1],[22,650],[2,457]],[[31359,38736],[-200,-79],[-109,794],[-150,646],[88,557],[-146,244],[-37,416],[-136,391]],[[30669,41705],[175,622],[-119,484],[63,194],[-49,213],[108,288],[6,490],[13,405],[60,195],[-240,926]],[[30686,45522],[206,-48],[143,12],[62,174],[243,234],[147,216],[363,98],[-29,-432],[34,-221],[-23,-386],[302,-516],[311,-95],[109,-216],[188,-114],[115,-167],[175,6],[161,-171],[12,-333],[55,-168],[3,-248],[-81,-10],[107,-671],[533,-23],[-41,-333],[30,-227],[151,-162],[66,-358],[-49,-453],[-77,-253],[27,-328],[-87,-119]],[[33842,40210],[-4,177],[-259,295],[-258,8],[-484,-167],[-133,-507],[-7,-310],[-110,-689]],[[34826,37007],[54,332],[38,340],[0,317],[-100,105],[-104,-94],[-103,26],[-33,222],[-26,527],[-52,172],[-187,156],[-114,-113],[-293,111],[18,782],[-82,320]],[[30686,45522],[-157,-99],[-126,66],[18,875],[-228,-339],[-245,15],[-105,307],[-184,33],[59,247],[-155,351],[-115,518],[73,106],[0,243],[168,166],[-28,312],[71,200],[20,269],[318,392],[227,111],[37,86],[251,-27]],[[30585,49354],[125,1579],[6,250],[-43,330],[-123,210],[1,418],[156,95],[56,-60],[9,221],[-162,60],[-4,360],[541,-13],[92,198],[77,-182],[55,-340],[52,71]],[[31423,52551],[153,-304],[216,37],[54,176],[206,135],[115,94],[32,244],[198,164],[-15,121],[-235,49],[-39,363],[12,386],[-125,149],[52,53],[206,-73],[221,-144],[80,136],[200,89],[310,216],[102,220],[-37,162]],[[33129,54824],[145,26],[64,-133],[-36,-253],[96,-87],[63,-268],[-77,-203],[-44,-490],[71,-291],[20,-267],[171,-270],[137,-28],[30,112],[88,25],[126,101],[90,153],[154,-48],[67,20]],[[34294,52923],[151,-47],[25,118],[-46,114],[28,167],[112,-51],[131,59],[159,-122]],[[34854,53161],[121,-119],[86,156],[62,-24],[38,-162],[133,41],[107,219],[85,424],[164,527]],[[35650,54223],[95,27],[69,-318],[155,-1008],[149,-95],[7,-397],[-208,-474],[86,-174],[491,-90],[10,-578],[211,378],[349,-207],[462,-351],[135,-338],[-45,-319],[323,178],[540,-305],[415,23],[411,-477],[355,-645],[214,-166],[237,-23],[101,-182],[94,-733],[46,-348],[-110,-953],[-142,-376],[-391,-801],[-177,-651],[-206,-499],[-69,-11],[-78,-424],[20,-1079],[-77,-888],[-30,-379],[-88,-228],[-49,-769],[-282,-752],[-47,-595],[-225,-250],[-65,-345],[-302,2],[-437,-222],[-195,-256],[-311,-168],[-327,-459],[-235,-571],[-41,-430],[46,-318],[-51,-582],[-63,-281],[-195,-317],[-308,-1013],[-244,-457],[-189,-269],[-127,-548],[-183,-329]],[[35174,32383],[-77,326],[122,273],[-160,392],[-218,318],[-286,369],[-103,-17],[-279,446],[-180,-62]],[[81723,54436],[110,215],[236,316]],[[82069,54967],[-13,-284],[-16,-368],[-133,18],[-58,-196],[-126,299]],[[75471,67823],[113,-184],[-20,-354],[-227,-17],[-234,39],[-175,-90],[-252,218],[-6,115]],[[74670,67550],[184,429],[150,146],[198,-134],[147,-14],[122,-154]],[[58175,39107],[-393,-424],[-249,-430],[-93,-383],[-83,-217],[-152,-46],[-48,-275],[-28,-180],[-178,-134],[-226,28],[-133,162],[-117,70],[-135,-134],[-68,-276],[-132,-173],[-139,-257],[-199,-59],[-62,202],[26,351],[-165,548],[-75,86]],[[55526,37566],[0,1681],[274,20],[8,2051],[207,19],[428,202],[106,-238],[177,226],[85,1],[156,130]],[[56967,41658],[50,-43]],[[57017,41615],[107,-460],[56,-103],[87,-333],[315,-633],[119,-62],[0,-203],[82,-365],[215,-88],[177,-261]],[[54244,56103],[229,44],[52,148],[46,-11],[69,-131],[350,221],[118,224],[145,202],[-28,202],[78,53],[269,-35],[261,266],[201,629],[141,233],[176,98]],[[56351,58246],[31,-246],[160,-360],[1,-235],[-45,-240],[18,-179],[96,-166]],[[56612,56820],[212,-252]],[[56824,56568],[152,-232],[2,-188],[187,-299],[116,-250],[70,-345],[208,-228],[44,-183]],[[57603,54843],[-91,-61],[-178,14],[-209,60],[-104,-49],[-41,-140],[-90,-17],[-110,121],[-309,-287],[-127,58],[-38,-45],[-83,-347],[-207,112],[-203,57],[-177,212],[-229,196],[-149,-186],[-108,-292],[-25,-402]],[[55125,53847],[-178,33],[-188,96],[-166,-305],[-146,-536]],[[54447,53135],[-29,167],[-12,263],[-127,185],[-103,297],[-23,207],[-132,301],[23,171],[-28,243],[21,446],[67,105],[140,583]],[[32315,78637],[202,-78],[257,16],[-137,-236],[-102,-37],[-353,244],[-69,193],[105,177],[97,-279]],[[32831,80108],[-135,-10],[-360,180],[-258,272],[96,49],[365,-145],[284,-240],[8,-106]],[[15692,79765],[-140,-80],[-456,262],[-84,204],[-248,202],[-50,164],[-286,103],[-107,314],[24,133],[291,-125],[171,-88],[261,-61],[94,-198],[138,-274],[277,-238],[115,-318]],[[34407,81019],[-184,-504],[181,195],[187,-124],[-98,-200],[247,-158],[128,140],[277,-177],[-86,-422],[194,99],[36,-306],[86,-358],[-117,-507],[-125,-21],[-183,109],[60,471],[-77,73],[-322,-499],[-166,20],[196,270],[-267,140],[-298,-34],[-539,17],[-43,171],[173,202],[-121,157],[234,347],[287,917],[172,328],[241,198],[129,-25],[-54,-156],[-148,-363]],[[13005,83025],[131,-75],[267,46],[-84,-654],[242,-463],[-111,1],[-167,264],[-103,265],[-140,179],[-51,253],[16,184]],[[27981,87625],[-108,-302],[-123,49],[-73,171],[13,40],[107,173],[114,-13],[70,-118]],[[27250,87943],[-325,-317],[-196,13],[-61,156],[207,265],[381,-5],[-6,-112]],[[26344,89640],[51,-253],[143,89],[161,-151],[304,-198],[318,-179],[25,-274],[204,45],[199,-191],[-247,-181],[-432,138],[-156,259],[-275,-306],[-396,-298],[-95,337],[-377,-55],[242,284],[35,454],[95,527],[201,-47]],[[28926,90499],[-312,-29],[-69,282],[118,323],[255,80],[217,-160],[3,-246],[-32,-80],[-180,-170]],[[23431,91627],[-173,-202],[-374,175],[-226,-63],[-380,259],[245,178],[194,250],[295,-164],[166,-103],[84,-110],[169,-220]],[[31350,77823],[-181,326],[0,785],[-123,166],[-187,-98],[-92,152],[-212,-435],[-84,-448],[-99,-262],[-118,-89],[-89,-29],[-28,-142],[-512,-1],[-422,-4],[-125,-106],[-294,-414],[-34,-45],[-89,-225],[-255,0],[-273,-2],[-125,-91],[44,-113],[25,-176],[-5,-58],[-363,-287],[-286,-90],[-323,-308],[-70,0],[-94,91],[-31,82],[6,60],[61,202],[131,317],[81,340],[-56,500],[-59,523],[-290,270],[35,103],[-41,70],[-76,0],[-56,91],[-14,137],[-54,-60],[-75,18],[17,57],[-65,57],[-27,151],[-216,185],[-224,191],[-272,223],[-261,209],[-248,-163],[-91,-6],[-342,150],[-225,-75],[-269,179],[-284,91],[-194,36],[-86,97],[-49,317],[-94,-3],[-1,-221],[-575,0],[-951,0],[-944,-1],[-833,1],[-834,0],[-819,0],[-847,0],[-273,0],[-825,0],[-788,0]],[[15878,80048],[-38,1],[-537,566],[-199,248],[-503,239],[-155,510],[40,353],[-356,245],[-48,464],[-336,419],[-6,296]],[[13740,83389],[154,278],[-7,363],[-473,367],[-284,657],[-173,413],[-255,259],[-187,236],[-147,298],[-279,-187],[-270,-321],[-247,378],[-194,252],[-271,160],[-273,17],[1,3279],[2,2137]],[[10837,91975],[518,-139],[438,-277],[289,-53],[244,241],[336,179],[413,-70],[416,253],[455,144],[191,-239],[207,134],[62,272],[192,-62],[470,-516],[369,390],[38,-437],[341,95],[105,168],[337,-33],[424,-242],[650,-211],[383,-98],[272,37],[374,-292],[-390,-286],[502,-123],[750,68],[236,100],[296,-345],[302,291],[-283,245],[179,197],[338,26],[223,58],[224,-138],[279,-312],[310,46],[491,-260],[431,91],[405,-13],[-32,358],[247,100],[431,-195],[-2,-545],[177,459],[223,-15],[126,579],[-298,355],[-324,233],[22,636],[329,418],[366,-92],[281,-255],[378,-649],[-247,-283],[517,-116],[-1,-589],[371,451],[332,-371],[-83,-427],[269,-388],[290,416],[202,497],[16,632],[394,-44],[411,-85],[373,-286],[17,-285],[-207,-307],[196,-309],[-36,-280],[-544,-403],[-386,-88],[-287,173],[-83,-289],[-268,-486],[-81,-252],[-322,-389],[-397,-38],[-220,-244],[-18,-374],[-323,-72],[-340,-467],[-301,-648],[-108,-454],[-16,-669],[409,-96],[125,-539],[130,-437],[388,114],[517,-250],[277,-219],[199,-272],[348,-158],[294,-243],[459,-33],[302,-56],[-45,-499],[86,-578],[201,-645],[414,-547],[214,188],[150,592],[-145,909],[-196,303],[445,270],[314,404],[154,401],[-23,385],[-188,489],[-338,434],[328,603],[-121,522],[-93,899],[194,133],[476,-157],[286,-56],[230,152],[258,-196],[342,-333],[85,-224],[495,-44],[-8,-483],[92,-728],[254,-90],[201,-339],[402,319],[266,636],[184,267],[216,-514],[362,-734],[307,-691],[-112,-362],[370,-325],[250,-329],[442,-149],[179,-183],[110,-488],[216,-76],[112,-217],[20,-647],[-202,-217],[-199,-202],[-458,-205],[-349,-473],[-470,-93],[-594,121],[-417,4],[-287,-40],[-233,-413],[-354,-255],[-401,-762],[-320,-532],[236,95],[446,756],[583,480],[415,58],[246,-283],[-262,-387],[88,-620],[91,-435],[361,-287],[459,83],[278,647],[19,-417],[180,-209],[-344,-377],[-615,-343],[-276,-233],[-310,-415],[-211,43],[-11,487],[483,476],[-445,-19],[-309,-70]],[[18287,93939],[-139,-270],[618,174],[386,-291],[314,294],[254,-188],[227,-566],[140,238],[-197,590],[244,85],[276,-93],[311,-232],[175,-561],[86,-406],[466,-285],[502,-273],[-31,-253],[-456,-47],[178,-221],[-94,-211],[-503,90],[-478,156],[-322,-35],[-522,-196],[-704,-86],[-494,-54],[-151,271],[-379,157],[-246,-64],[-343,456],[185,61],[429,99],[392,-26],[362,100],[-537,135],[-594,-46],[-394,11],[-146,213],[644,230],[-428,-8],[-485,152],[233,431],[193,229],[744,351],[284,-111]],[[20972,94111],[-244,-381],[-434,404],[95,80],[372,23],[211,-126]],[[28794,93928],[25,-159],[-296,16],[-299,13],[-304,-78],[-80,35],[-306,306],[12,207],[133,38],[636,-62],[479,-316]],[[25955,93959],[219,-359],[256,465],[704,236],[477,-596],[-42,-377],[550,168],[263,228],[616,-291],[383,-274],[36,-252],[515,131],[290,-367],[670,-228],[242,-232],[263,-539],[-510,-268],[654,-376],[441,-127],[400,-529],[437,-38],[-87,-404],[-487,-669],[-342,246],[-437,554],[-359,-72],[-35,-330],[292,-335],[377,-265],[114,-153],[181,-570],[-96,-414],[-350,156],[-697,461],[393,-496],[289,-348],[45,-201],[-753,230],[-596,334],[-337,281],[97,162],[-414,296],[-405,280],[5,-167],[-803,-92],[-235,198],[183,424],[522,10],[571,74],[-92,205],[96,287],[360,561],[-77,255],[-107,197],[-425,280],[-563,196],[178,145],[-294,358],[-245,33],[-219,196],[-149,-170],[-503,-74],[-1011,129],[-588,169],[-450,87],[-231,202],[290,263],[-394,2],[-88,583],[213,515],[286,235],[717,154],[-204,-373]],[[22123,94355],[331,-122],[496,73],[72,-167],[-259,-276],[420,-248],[-50,-518],[-455,-223],[-268,48],[-192,220],[-690,444],[5,185],[567,-72],[-306,377],[329,279]],[[24112,93737],[-298,-430],[-317,21],[-173,506],[4,287],[145,244],[276,157],[579,-20],[530,-140],[-415,-513],[-331,-112]],[[16539,92938],[-731,-278],[-147,253],[-641,304],[119,244],[192,421],[241,378],[-272,353],[939,90],[397,-119],[709,-32],[270,-167],[298,-243],[-349,-145],[-681,-405],[-344,-403],[0,-251]],[[23996,95009],[-151,-223],[-403,43],[-337,150],[148,259],[399,155],[243,-202],[101,-182]],[[22639,96011],[212,-267],[9,-295],[-127,-429],[-458,-59],[-298,92],[5,336],[-455,-44],[-18,445],[299,-18],[419,197],[390,-34],[22,76]],[[19941,95712],[109,-205],[247,97],[291,-25],[49,-282],[-169,-274],[-940,-89],[-701,-249],[-423,-13],[-35,187],[577,255],[-1255,-69],[-389,103],[379,563],[262,161],[782,-194],[493,-341],[485,-44],[-397,551],[255,210],[286,-67],[94,-275]],[[23699,96229],[308,-186],[547,2],[240,-190],[-64,-216],[319,-130],[177,-137],[374,-26],[406,-48],[441,125],[566,49],[451,-40],[298,-218],[62,-238],[-174,-153],[-414,-124],[-355,70],[-797,-88],[-570,-11],[-449,71],[-738,186],[-96,316],[-34,286],[-279,251],[-574,70],[-322,179],[104,236],[573,-36]],[[17722,96544],[-38,-443],[-214,-199],[-259,-29],[-517,-246],[-444,-88],[-377,124],[472,431],[570,373],[426,-8],[381,85]],[[23933,96472],[-126,-17],[-521,37],[-74,161],[559,-9],[195,-107],[-33,-65]],[[19392,96574],[-518,-166],[-411,186],[224,183],[406,59],[392,-90],[-93,-172]],[[19538,97095],[-339,-113],[-461,1],[5,82],[285,173],[149,-27],[361,-116]],[[23380,96781],[-411,-119],[-226,134],[-119,216],[-22,238],[360,-23],[162,-38],[332,-200],[-76,-208]],[[22205,96935],[108,-240],[-453,64],[-457,187],[-619,21],[268,171],[-335,139],[-21,221],[546,-79],[751,-210],[212,-274]],[[25828,97704],[334,-186],[-381,-171],[-513,-434],[-492,-41],[-575,74],[-299,235],[4,208],[220,154],[-508,-5],[-306,192],[-176,261],[193,256],[192,175],[285,41],[-122,132],[646,29],[355,-308],[468,-123],[455,-109],[220,-380]],[[30972,99689],[742,-45],[597,-74],[508,-156],[-12,-154],[-678,-250],[-672,-117],[-251,-129],[605,3],[-656,-349],[-452,-163],[-476,-470],[-573,-96],[-177,-117],[-841,-62],[383,-72],[-192,-103],[230,-284],[-264,-198],[-429,-163],[-132,-225],[-388,-172],[39,-130],[475,22],[6,-141],[-742,-345],[-726,159],[-816,-89],[-414,69],[-525,30],[-35,277],[514,130],[-137,415],[170,41],[742,-249],[-379,370],[-450,110],[225,223],[492,137],[79,201],[-392,225],[-118,297],[759,-25],[220,-63],[433,210],[-625,67],[-972,-37],[-491,196],[-232,232],[-324,169],[-61,197],[413,110],[324,18],[545,94],[409,214],[344,-30],[300,-161],[211,311],[367,92],[498,64],[849,24],[148,-63],[802,98],[601,-37],[602,-36]],[[52900,78834],[-22,-236],[-122,-97],[-206,72],[-60,-232],[-132,-18],[-48,91],[-156,-195],[-134,-28],[-120,124]],[[51900,78315],[-95,252],[-133,-90],[5,261],[203,323],[-9,147],[126,-53],[77,98]],[[52074,79253],[236,-4],[57,125],[298,-176]],[[31400,20215],[-92,-233],[-238,-178],[-137,18],[-164,46],[-202,174],[-291,83],[-350,322],[-283,309],[-383,645],[229,-121],[390,-384],[369,-207],[143,264],[90,394],[256,238],[198,-68]],[[30952,21711],[-247,4],[-134,-141],[-250,-208],[-45,-538],[-118,-14],[-313,188],[-318,401],[-346,329],[-87,365],[79,337],[-140,383],[-36,982],[119,554],[293,445],[-422,168],[265,509],[94,956],[309,-202],[145,1193],[-186,153],[-87,-719],[-175,81],[87,823],[95,1067],[127,394],[-80,562],[-22,649],[117,18],[170,930],[192,922],[118,858],[-64,863],[83,475],[-34,711],[163,703],[50,1114],[89,1196],[87,1287],[-20,943],[-58,811]],[[30452,41263],[143,147],[74,295]],[[80649,62586],[-240,-277],[-228,179],[-8,495],[137,261],[304,161],[159,-13],[62,-220],[-122,-254],[-64,-332]],[[86288,76244],[-179,340],[-111,-323],[-429,-248],[44,-304],[-241,21],[-131,181],[-191,-409],[-306,-309],[-227,-370]],[[84517,74823],[-388,-167],[-204,-269],[-300,-157],[148,267],[-58,224],[220,387],[-147,302],[-242,-204],[-314,-400],[-171,-372],[-272,-28],[-142,-268],[147,-390],[227,-94],[9,-259],[220,-168],[311,411],[247,-224],[179,-15],[45,-302],[-393,-161],[-130,-311],[-270,-289],[-142,-403],[299,-316],[109,-567],[169,-527],[189,-443],[-5,-428],[-174,-157],[66,-307],[164,-179],[-43,-469],[-71,-456],[-155,-52],[-203,-623],[-225,-756],[-258,-687],[-382,-532],[-386,-484],[-313,-67],[-170,-255],[-96,186],[-157,-286],[-388,-288],[-294,-88],[-95,-609],[-154,-33],[-73,418],[66,222],[-373,185],[-131,-94]],[[80013,64241],[-280,149],[-132,234],[44,332],[-254,105],[-134,216],[-236,-307],[-271,-66],[-221,3],[-149,-141]],[[78380,64766],[-144,-84],[42,-659],[-148,16],[-25,135]],[[78105,64174],[-9,238],[-203,-167],[-121,106],[-206,216],[81,478],[-176,112],[-66,530],[-293,-96],[33,684],[263,480],[11,475],[-8,441],[-121,137],[-93,339],[-162,-42]],[[77035,68105],[-300,86],[94,242],[-130,358],[-198,-243],[-233,142],[-321,-367],[-252,-428],[-224,-72]],[[74670,67550],[-23,454],[-170,-121]],[[74477,67883],[-324,56],[-314,132],[-225,253],[-216,114],[-93,276],[-157,83],[-280,375],[-223,177],[-115,-138]],[[72530,69211],[-386,403],[-273,365],[-78,635],[200,-78],[9,294],[-111,295],[28,470],[-298,675]],[[71621,72270],[-457,233],[-82,442],[-205,269]],[[70827,73379],[-42,328],[10,224],[-169,131],[-91,-58],[-70,533]],[[70465,74537],[79,132],[-39,135],[266,272],[192,112],[294,-77],[105,368],[356,68],[99,229],[438,312],[39,130]],[[72294,76218],[-22,328],[190,150],[-250,1000],[550,231],[143,128],[200,1031],[551,-190],[155,261],[13,577],[230,54],[212,383]],[[74266,80171],[109,48]],[[74375,80219],[73,-402],[233,-306],[396,-216],[192,-464],[-107,-673],[100,-249],[330,-99],[374,-80],[336,-359],[171,-64],[127,-531],[163,-342],[306,14],[574,-129],[369,80],[274,-86],[411,-350],[336,1],[123,-179],[324,309],[448,200],[417,21],[324,203],[200,309],[194,193],[-45,190],[-89,222],[146,371],[156,-52],[286,-117],[277,306],[423,223],[204,380],[195,164],[404,77],[219,-65],[30,204],[-251,403],[-223,184],[-214,-212],[-274,89],[-157,-73],[-72,236],[197,575],[135,434]],[[82410,80559],[333,-217],[392,364],[-3,253],[251,611],[155,184],[-4,318],[-152,137],[229,287],[345,104],[369,15],[415,-171],[244,-212],[172,-581],[104,-248],[97,-354],[103,-564],[483,-184],[329,-409],[112,-541],[423,-1],[240,227],[459,170],[-146,-518],[-107,-211],[-96,-631],[-186,-560],[-338,102],[-238,-203],[73,-494],[-40,-680],[-142,-16],[2,-292]],[[49206,54706],[-126,-6],[-194,112],[-178,-6],[-329,-101],[-193,-166],[-275,-211],[-54,15]],[[47857,54343],[22,474],[26,72],[-8,227],[-118,241],[-88,39],[-81,158],[60,256],[-28,278],[13,168]],[[47655,56256],[44,0],[17,251],[-22,112],[27,80],[103,69],[-69,461],[-64,238],[23,195],[55,45]],[[47769,57707],[36,52],[77,-86],[215,-5],[51,168],[48,-11],[80,65],[43,-246],[65,72],[114,86]],[[49214,57382],[74,-819],[-117,-484],[-73,-650],[121,-496],[-13,-227]],[[53632,53135],[-35,31],[-164,-74],[-169,77],[-132,-38]],[[53132,53131],[-452,14]],[[52680,53145],[40,454],[-108,381],[-127,98],[-56,258],[-72,82],[4,159]],[[52361,54577],[71,408],[132,556],[81,5],[165,337],[105,9],[156,-236],[191,194],[26,239],[63,232],[43,291],[148,238],[56,403],[59,128],[39,299],[74,368],[234,446],[14,191],[31,104],[-110,229]],[[53939,59018],[9,184],[78,33]],[[54026,59235],[111,-369],[18,-382],[-10,-383],[151,-523],[-155,6],[-78,-41],[-127,57],[-60,-271],[164,-336],[121,-98],[39,-239],[87,-397],[-43,-156]],[[54447,53135],[-20,-311],[-220,136],[-225,152],[-350,23]],[[58564,53850],[-16,-673],[111,-78],[-89,-205],[-107,-153],[-106,-300],[-59,-268],[-15,-462],[-65,-220],[-2,-434]],[[58216,51057],[-80,-161],[-10,-342],[-38,-45],[-26,-315]],[[58149,49238],[50,-530],[-27,-299],[55,-334],[161,-323],[150,-726]],[[58538,47026],[-109,59],[-373,-97],[-75,-69],[-79,-368],[62,-254],[-49,-681],[-34,-578],[75,-103],[194,-224],[76,105],[23,-621],[-212,4],[-114,317],[-103,246],[-213,80],[-62,302],[-170,-182],[-222,81],[-93,261],[-176,53],[-131,-14],[-15,179],[-96,15]],[[53422,48316],[-39,179]],[[53609,49076],[73,-59],[95,221],[152,-6],[17,-163],[104,-102],[164,361],[161,281],[71,185],[-10,473],[121,560],[127,296],[183,278],[32,184],[7,211],[45,200],[-14,326],[34,510],[55,360],[83,308],[16,347]],[[57603,54843],[169,-475],[124,-70],[75,97],[128,-38],[155,122],[66,-246],[244,-383]],[[53309,48928],[-228,610]],[[53081,49538],[212,318],[-105,381],[95,144],[187,71],[23,255],[148,-276],[245,-25],[85,273],[36,382],[-31,450],[-131,341],[120,667],[-69,114],[-207,-47],[-78,298],[21,251]],[[29063,51742],[-119,136],[-137,191],[-79,-92],[-235,80],[-68,248],[-52,-9],[-278,329]],[[28095,52625],[-37,178],[103,44],[-12,288],[65,209],[138,38],[117,362],[106,302],[-102,137],[52,335],[-62,526],[59,152],[-44,487],[-112,306]],[[28366,55989],[36,280],[89,-41],[52,171],[-64,339],[34,85]],[[28513,56823],[143,-19],[209,402],[114,62],[3,190],[51,487],[159,267],[175,11],[22,120],[218,-48],[218,291],[109,128],[134,278],[98,-36],[73,-151],[-54,-194]],[[30185,58611],[-178,-96],[-71,-288],[-107,-165],[-81,-215],[-34,-410],[-77,-337],[144,-39],[35,-265],[62,-126],[21,-232],[-33,-213],[10,-120],[69,-48],[66,-201],[357,55],[161,-73],[196,-496],[112,62],[200,-31],[158,66],[99,-99],[-50,-311],[-62,-193],[-22,-413],[56,-383],[79,-171],[9,-129],[-140,-286],[100,-127],[74,-202],[85,-574]],[[30585,49354],[-139,306],[-83,14],[179,586],[-213,270],[-166,-50],[-101,100],[-153,-152],[-207,72],[-163,603],[-129,149],[-89,272],[-184,272],[-74,-54]],[[26954,56566],[-151,128],[-56,121],[32,100],[-11,127],[-77,138],[-109,113],[-95,74],[-19,168],[-73,103],[18,-167],[-55,-138],[-64,160],[-89,57],[-38,116],[2,175],[36,182],[-78,81],[64,111]],[[26191,58215],[42,74],[183,-152],[63,75],[89,-48],[46,-119],[82,-38],[66,122]],[[26762,58129],[70,-313],[108,-232],[130,-246]],[[27070,57338],[-107,-51],[1,-232],[58,-86],[-41,-68],[10,-104],[-23,-117],[-14,-114]],[[27147,65183],[240,-41],[219,-6],[261,-197],[110,-210],[260,65],[98,-136],[235,-356],[173,-260],[92,8],[165,-118],[-20,-162],[205,-23],[210,-236],[-33,-135],[-185,-73],[-187,-29],[-191,46],[-398,-56],[186,321],[-113,150],[-179,38],[-96,166],[-66,328],[-157,-22],[-259,154],[-83,121],[-362,89],[-97,113],[104,144],[-273,29],[-199,-299],[-115,-8],[-40,-141],[-138,-63],[-118,55],[146,178],[60,208],[126,128],[142,112],[210,55],[67,63]],[[59092,72066],[19,3],[40,139],[200,-8],[253,172],[-188,-245],[21,-108]],[[59437,72019],[-30,20],[-53,-44],[-42,12],[-14,-22],[-5,59],[-20,35],[-54,6],[-75,-49],[-52,30]],[[59437,72019],[8,-46],[-285,-234],[-136,74],[-64,232],[132,21]],[[53776,79977],[-157,247],[-141,139],[-30,243],[-49,171],[202,125],[103,144],[200,111],[70,110],[73,-66],[124,60]],[[54171,81261],[132,-186],[207,-50],[-17,-158],[151,-119],[41,148],[191,-64],[26,-180],[207,-35],[127,-284]],[[55236,80333],[-82,0],[-43,-104],[-64,-25],[-18,-131],[-54,-28],[-7,-53],[-95,-60],[-123,10],[-39,-127]],[[52756,83493],[4,-222],[281,-135],[-3,-204],[283,108],[156,158],[313,-228],[132,-183]],[[53922,82787],[64,-293],[-77,-154],[101,-205],[69,-308],[-22,-199],[114,-367]],[[52074,79253],[35,410],[140,395],[-400,106],[-131,151]],[[51718,80315],[16,252],[-56,130]],[[51710,81086],[-47,604],[167,0],[70,217],[69,527],[-51,195]],[[51918,82629],[54,122],[232,31],[52,-127],[188,284],[-63,216],[-13,326]],[[52368,83481],[210,-76],[178,88]],[[61966,59143],[66,-178],[-9,-240],[-158,-137],[119,-158]],[[61984,58430],[-102,-308]],[[61882,58122],[-62,103],[-67,-41],[-155,9],[-4,176],[-22,159],[94,269],[98,255]],[[61764,59052],[119,-50],[83,141]],[[53524,83854],[-166,-466],[-291,325],[-39,239],[408,191],[88,-289]],[[52368,83481],[-113,320],[-8,589],[46,155],[80,173],[244,36],[98,159],[223,162],[-9,-296],[-82,-188],[33,-161],[151,-87],[-68,-217],[-83,62],[-200,-415],[76,-280]],[[30080,63183],[34,98],[217,-3],[165,-148],[73,14],[50,-204],[152,11],[-9,-171],[124,-21],[136,-211],[-103,-235],[-132,126],[-127,-25],[-92,28],[-50,-105],[-106,-36],[-43,140],[-92,-83],[-111,-394],[-71,92],[-14,165]],[[30081,62221],[5,157],[-71,172],[68,97],[21,222],[-24,314]],[[53333,65346],[-952,-1097],[-804,-1132],[-392,-257]],[[51185,62860],[-308,-56],[-3,366],[-129,94],[-173,165],[-66,270],[-937,1256],[-937,1257]],[[48632,66212],[-1045,1394]],[[47587,67606],[6,112],[-1,38]],[[47592,67756],[-2,682],[449,425],[277,88],[227,155],[107,288],[324,228],[12,427],[161,50],[126,213],[363,97],[51,224],[-73,122],[-96,608],[-17,350],[-104,369]],[[49397,72082],[267,315],[300,100],[175,238],[268,175],[471,102],[459,47],[140,-85],[262,227],[297,4],[113,-134],[190,35]],[[52339,73106],[-57,-295],[44,-549],[-65,-475],[-171,-322],[24,-433],[227,-344],[3,-139],[171,-232],[118,-1034]],[[52633,69283],[90,-509],[15,-267],[-49,-470],[21,-263],[-36,-315],[24,-362],[-110,-240],[164,-420],[11,-247],[99,-321],[130,105],[219,-267],[122,-361]],[[27693,49869],[148,430],[-60,251],[-106,-267],[-166,252],[56,163],[-47,522],[97,87],[52,359],[105,371],[-20,235],[153,123],[190,230]],[[29063,51742],[38,-438],[-86,-374],[-303,-603],[-334,-227],[-170,-501],[-53,-389],[-157,-237],[-116,291],[-113,62],[-114,-45],[-8,211],[79,137],[-33,240]],[[59700,68819],[-78,-232],[-60,-435],[-75,-300],[-65,-100],[-93,186],[-125,257],[-198,825],[-29,-52],[115,-608],[171,-579],[210,-897],[102,-313],[90,-325],[249,-638],[-55,-100],[9,-374],[323,-517],[49,-118]],[[60240,64499],[-1102,0],[-1077,0],[-1117,0]],[[56944,64499],[0,2120],[0,2048],[-83,464],[71,356],[-43,246],[101,276]],[[56990,70009],[369,10],[268,-152],[275,-171],[129,-89],[214,182],[114,165],[245,48],[198,-73],[75,-286],[65,189],[222,-136],[217,-33],[137,145]],[[59518,69808],[182,-989]],[[61764,59052],[-95,187],[-114,337],[-124,185],[-71,199],[-242,231],[-191,7],[-67,120],[-163,-135],[-168,261],[-87,-430],[-323,121]],[[60119,60135],[-30,230],[120,847],[27,382],[88,177],[204,95],[141,328]],[[60669,62194],[161,-666],[77,-529],[152,-281],[379,-544],[154,-328],[151,-332],[87,-198],[136,-173]],[[47490,75948],[14,410],[-114,250],[393,415],[340,-104],[373,4],[296,-98],[230,30],[449,-19]],[[49471,76836],[111,-224],[511,-262],[101,125],[313,-261],[322,75]],[[50829,76289],[15,-335],[-263,-383],[-356,-122],[-25,-194],[-171,-319],[-107,-469],[108,-329],[-160,-257],[-60,-374],[-210,-115],[-197,-443],[-352,-8],[-265,10],[-174,-203],[-106,-218],[-136,48],[-103,195],[-79,331],[-259,89]],[[47929,73193],[-23,191],[103,216],[38,156],[-96,172],[77,378],[-111,345],[120,48],[11,272],[45,84],[3,449],[129,156],[-78,289],[-162,20],[-47,-72],[-164,-1],[-70,282],[-113,-84],[-101,-146]],[[56753,85111],[32,340],[-102,-72],[-176,204],[-24,331],[351,161],[350,83],[301,-95],[287,17]],[[57772,86080],[42,-100],[-198,-332],[83,-537],[-120,-183]],[[57579,84928],[-229,1],[-239,214],[-121,70],[-237,-102]],[[61882,58122],[-61,-204],[103,-317],[102,-277],[106,-206],[909,-683],[233,3]],[[63274,56438],[-785,-1728],[-362,-26],[-247,-406],[-178,-10],[-76,-182]],[[61626,54086],[-190,0],[-112,195],[-254,-241],[-82,-240],[-185,45],[-62,67],[-65,-16],[-87,6],[-352,489],[-193,0],[-95,189],[0,324],[-145,96]],[[59804,55000],[-164,627],[-127,133],[-48,231],[-141,280],[-171,42],[95,328],[147,14],[42,176]],[[59437,56831],[-4,517]],[[59433,57348],[82,603],[132,161],[28,236],[119,440],[168,285],[112,567],[45,495]],[[57942,91602],[-41,-403],[425,-383],[-256,-435],[323,-655],[-187,-494],[250,-429],[-113,-375],[411,-394],[-105,-294],[-258,-333],[-594,-735]],[[57797,86672],[-504,-46],[-489,-211],[-452,-121],[-161,314],[-269,189],[62,567],[-135,520],[133,335],[252,362],[635,624],[185,121],[-28,243],[-387,272]],[[56639,89841],[-93,225],[-8,886],[-433,392],[-371,282]],[[55734,91626],[167,152],[309,-304],[362,29],[298,-140],[265,255],[137,422],[431,196],[356,-229],[-117,-405]],[[99547,41844],[96,-167],[-46,-300],[-172,-79],[-153,71],[-27,253],[107,198],[126,-71],[69,95]],[[0,42577],[57,26],[-34,-277],[-23,-31],[99822,-141],[-177,-122],[-36,215],[139,118],[88,32],[-99836,180]],[[33000,21970],[333,345],[236,-144],[167,231],[222,-259],[-83,-202],[-375,-173],[-125,202],[-236,-259],[-139,259]],[[34854,53161],[70,246],[24,262],[48,246],[-107,340]],[[34889,54255],[-22,394],[144,495]],[[35011,55144],[95,-63],[204,-136],[294,-486],[46,-236]],[[52655,76104],[-92,-445],[-126,118],[-64,387],[56,214],[179,220],[47,-494]],[[51576,80352],[62,-50],[80,13]],[[51900,78315],[-11,-163],[82,-216],[-97,-176],[72,-445],[151,-73],[-32,-250]],[[52065,76992],[-252,-326],[-548,156],[-404,-186],[-32,-347]],[[49471,76836],[144,345],[53,1147],[-287,605],[-205,291],[-424,222],[-28,420],[360,125],[466,-148],[-88,652],[263,-247],[646,449],[84,472],[243,116]],[[53081,49538],[-285,581],[-184,475],[-169,595],[9,192],[61,184],[67,419],[56,427]],[[52636,52411],[94,33],[404,-6],[-2,693]],[[48278,82851],[-210,118],[-172,-8],[57,309],[-57,309]],[[47896,83579],[233,23],[298,-356],[-149,-395]],[[49165,85596],[-297,-623],[283,79],[304,-3],[-72,-469],[-250,-516],[287,-37],[22,-61],[248,-679],[190,-93],[171,-656],[79,-227],[337,-110],[-34,-368],[-142,-169],[111,-298],[-250,-302],[-371,6],[-473,-159],[-130,114],[-183,-270],[-257,65],[-195,-220],[-148,115],[407,605],[249,125],[-2,0],[-434,96],[-79,229],[291,179],[-152,310],[52,377],[413,-52],[1,0],[40,334],[-186,355],[-4,8],[-337,101],[-66,156],[101,258],[-92,158],[-149,-272],[-17,555],[-140,294],[101,595],[216,467],[222,-45],[335,48]],[[61542,75749],[42,246],[-70,393],[-160,212],[-154,66],[-102,177]],[[61098,76843],[34,68],[235,-99],[409,-93],[378,-276],[48,-107],[169,90],[259,-120],[85,-236],[175,-134]],[[62106,75494],[-268,282],[-296,-27]],[[50294,55244],[-436,-337],[-154,-198],[-250,-167],[-248,164]],[[50006,58175],[-20,-180],[116,-297],[-1,-418],[27,-454],[69,-210],[-61,-518],[22,-287],[74,-365],[62,-202]],[[47655,56256],[-78,14],[-57,-232],[-78,3],[-55,123],[19,231],[-116,353],[-73,-65],[-59,-13]],[[47158,56670],[-77,-33],[3,211],[-44,151],[9,168],[-60,242],[-78,206],[-222,0],[-65,-108],[-76,-13],[-48,-125],[-32,-159],[-148,-254]],[[46320,56956],[-122,341],[-108,226],[-71,74],[-69,115],[-32,254],[-41,127],[-80,94]],[[45797,58187],[123,281],[84,-11],[73,97],[61,1],[44,76],[-24,191],[31,60],[5,195]],[[46194,59077],[134,-5],[200,-141],[61,13],[21,64],[151,-45],[40,32]],[[46801,58995],[16,-211],[44,1],[73,77],[46,-20],[77,-146],[119,-46],[76,125],[90,77],[67,80],[55,-15],[62,-126],[33,-159],[114,-241],[-57,-149],[-11,-187],[59,57],[35,-67],[-15,-172],[85,-166]],[[45321,59403],[36,255]],[[45357,59658],[302,17],[63,136],[88,10],[110,-142],[86,-3],[92,97],[56,-166],[-120,-130],[-121,11],[-119,121],[-103,-133],[-50,-5],[-67,-80],[-253,12]],[[45797,58187],[-149,241],[-117,38],[-63,162],[1,88],[-84,122],[-18,124]],[[45367,58962],[147,93],[92,-18],[75,65],[513,-25]],[[52636,52411],[-52,87],[96,647]],[[56583,72391],[152,-194],[216,33],[207,-41],[-7,-100],[151,69],[-35,-170],[-400,-49],[3,95],[-339,112],[52,245]],[[57237,75339],[-169,17],[-145,54],[-336,-150],[192,-323],[-141,-94],[-154,-1],[-147,297],[-52,-127],[62,-344],[139,-270],[-105,-126],[155,-265],[137,-167],[4,-326],[-257,153],[82,-294],[-176,-60],[105,-509],[-184,-7],[-228,251],[-104,460],[-49,384],[-108,264],[-143,329],[-18,164]],[[55838,75350],[182,51],[106,126],[150,-11],[46,100],[53,19]],[[57254,75917],[135,-153],[-86,-360],[-66,-65]],[[37010,99413],[932,344],[975,-26],[354,213],[982,55],[2219,-72],[1737,-457],[-513,-222],[-1062,-25],[-1496,-56],[140,-103],[984,63],[836,-198],[540,176],[231,-206],[-305,-335],[707,214],[1348,223],[833,-111],[156,-246],[-1132,-410],[-157,-133],[-888,-99],[643,-28],[-324,-420],[-224,-373],[9,-641],[333,-376],[-434,-24],[-457,-182],[513,-305],[65,-490],[-297,-53],[360,-495],[-617,-42],[322,-234],[-91,-203],[-391,-89],[-388,-2],[348,-390],[4,-256],[-549,238],[-143,-154],[375,-144],[364,-352],[105,-464],[-495,-111],[-214,222],[-344,331],[95,-391],[-322,-303],[732,-24],[383,-31],[-745,-502],[-755,-454],[-813,-199],[-306,-2],[-288,-222],[-386,-608],[-597,-404],[-192,-23],[-370,-142],[-399,-134],[-238,-357],[-4,-403],[-141,-378],[-453,-461],[112,-450],[-125,-476],[-142,-563],[-391,-35],[-410,471],[-556,3],[-269,315],[-186,563],[-481,716],[-141,375],[-38,517],[-384,532],[100,424],[-186,203],[275,673],[418,214],[110,241],[58,450],[-318,-204],[-151,-85],[-249,-83],[-341,188],[-19,392],[109,306],[258,8],[567,-153],[-478,366],[-249,197],[-276,-81],[-232,143],[310,536],[-169,215],[-220,398],[-335,611],[-353,223],[3,241],[-745,337],[-590,42],[-743,-23],[-677,-42],[-323,183],[-482,362],[729,181],[559,31],[-1188,149],[-627,236],[39,223],[1051,277],[1018,277],[107,210],[-750,206],[243,230],[961,402],[404,62],[-115,258],[658,152],[854,90],[853,6],[303,-180],[737,317],[663,-215],[390,-45],[577,-188],[-660,311],[38,246]],[[24973,59739],[-142,101],[-174,10],[-127,114],[-149,238]],[[24381,60202],[7,168],[32,135],[-39,107],[133,470],[357,1],[7,197],[-45,35],[-31,124],[-103,133],[-103,193],[125,1],[1,324],[259,1],[257,-6]],[[25297,60979],[90,-105],[24,86],[82,-73]],[[25493,60887],[-127,-220],[-131,-161],[-20,-111],[22,-113],[-58,-146]],[[25179,60136],[-65,-36],[15,-67],[-52,-64],[-95,-145],[-9,-85]],[[33400,56648],[183,-212],[171,-375],[8,-297],[105,-13],[149,-281],[109,-201]],[[34125,55269],[-44,-518],[-169,-150],[15,-136],[-51,-297],[123,-418],[89,-1],[37,-325],[169,-501]],[[33129,54824],[-188,437],[75,159],[-5,265],[171,93],[69,108],[-95,213],[24,210],[220,339]],[[25745,59307],[-48,180],[-84,50]],[[25613,59537],[19,231],[-38,62],[-57,41],[-122,-68],[-10,77],[-84,93],[-60,114],[-82,49]],[[25493,60887],[29,-23],[61,101],[79,9],[26,-47],[43,28],[129,-52],[128,15],[90,64],[32,65],[89,-30],[66,-39],[73,13],[55,50],[127,-80],[44,-13],[85,-107],[80,-129],[101,-88],[73,-159]],[[26903,60465],[-95,12],[-38,-79],[-97,-75],[-70,0],[-61,-73],[-56,26],[-47,88],[-29,-17],[-36,-138],[-27,5],[-4,-118],[-97,-159],[-51,-68],[-29,-72],[-82,117],[-60,-154],[-58,4],[-65,-14],[6,-283],[-41,-5],[-35,-131],[-86,-24]],[[55230,78267],[67,-223],[89,-164],[-107,-217]],[[55155,76391],[-31,-98]],[[55124,76293],[-261,213],[-161,207],[-254,171],[-233,424],[56,43],[-127,242],[-5,195],[-179,91],[-85,-249],[-82,193],[6,200],[10,9]],[[53809,78032],[194,-20],[51,98],[94,-94],[109,-12],[-1,161],[97,59],[27,233],[221,153]],[[54601,78610],[88,-71],[208,-247],[229,-111],[104,86]],[[30081,62221],[-185,98],[-131,-40],[-169,42],[-130,-108],[-149,179],[24,186],[256,-80],[210,-46],[100,128],[-127,250],[2,220],[-175,89],[62,159],[170,-25],[241,-90]],[[54716,79543],[141,-148],[103,-62],[233,70],[22,116],[111,17],[135,89],[30,-37],[130,72],[66,136],[91,35],[297,-175],[59,59]],[[56134,79715],[155,-157],[19,-154]],[[56308,79404],[-170,-121],[-131,-391],[-168,-390],[-223,-109]],[[55616,78393],[-173,26],[-213,-152]],[[54601,78610],[-54,194],[-47,7]],[[83531,45933],[-117,-11],[-368,403],[259,113],[146,-175],[97,-175],[-17,-155]],[[84713,46708],[28,-113],[5,-175]],[[84746,46420],[-181,-430],[-238,-127],[-33,69],[25,196],[119,351],[275,229]],[[82749,47167],[100,-153],[172,47],[69,-245],[-321,-116],[-193,-77],[-149,4],[95,332],[153,5],[74,203]],[[84139,47168],[-41,-320],[-417,-163],[-370,71],[0,210],[220,120],[174,-173],[185,44],[249,211]],[[80172,47926],[533,-57],[61,237],[515,-277],[101,-373],[417,-105],[341,-342],[-317,-220],[-306,232],[-251,-15],[-288,42],[-260,104],[-322,220],[-204,57],[-116,-72],[-506,237],[-48,247],[-255,43],[191,550],[337,-34],[224,-225],[115,-44],[38,-205]],[[87423,48251],[-143,-393],[-27,434],[49,207],[58,195],[63,-169],[0,-274]],[[85346,49837],[-104,-191],[-192,106],[-54,248],[281,27],[69,-190]],[[86241,50048],[101,-441],[-234,238],[-232,48],[-157,-38],[-192,20],[65,317],[344,24],[305,-168]],[[89166,50332],[5,-1877],[4,-1876]],[[89175,46579],[-247,472],[-282,116],[-69,-164],[-352,-18],[118,469],[175,160],[-72,626],[-134,483],[-538,488],[-229,48],[-417,532],[-82,-279],[-107,-51],[-63,211],[-1,250],[-212,283],[299,207],[198,-11],[-23,153],[-407,1],[-110,343],[-248,106],[-117,285],[374,140],[142,188],[446,-237],[44,-214],[78,-931],[287,-345],[232,611],[319,347],[247,1],[238,-201],[206,-206],[298,-110]],[[84788,52647],[-223,-571],[-209,-111],[-267,113],[-463,-29],[-243,-83],[-39,-436],[248,-512],[150,261],[518,196],[-22,-265],[-121,83],[-121,-337],[-245,-223],[263,-738],[-50,-198],[249,-665],[-2,-378],[-148,-170],[-109,203],[134,471],[-273,-222],[-69,159],[36,222],[-200,338],[21,561],[-186,-175],[24,-671],[11,-824],[-176,-84],[-119,169],[79,530],[-43,556],[-117,4],[-86,395],[115,377],[40,457],[139,868],[58,238],[237,427],[217,-170],[350,-80],[319,24],[275,419],[48,-129]],[[85746,52481],[-15,-503],[-143,57],[-42,-351],[114,-304],[-78,-69],[-112,365],[-82,736],[56,460],[92,210],[20,-315],[164,-50],[26,-236]],[[80461,52985],[47,-385],[190,-325],[179,117],[177,-42],[162,291],[133,51],[263,-162],[226,123],[143,801],[107,200],[96,655],[319,0],[241,-97]],[[82744,54212],[-158,-520],[204,-545],[-48,-265],[312,-533],[-329,-68],[-93,-393],[12,-522],[-267,-393],[-7,-574],[-107,-881],[-41,205],[-316,-259],[-110,352],[-198,33],[-139,184],[-330,-207],[-101,279],[-182,-32],[-229,67],[-43,772],[-138,160],[-134,493],[-38,504],[32,533],[165,383]],[[79393,48459],[-308,-12],[-234,481],[-356,471],[-119,349],[-210,469],[-138,432],[-212,806],[-244,480],[-81,495],[-103,449],[-250,363],[-145,493],[-209,322],[-290,635],[-24,293],[178,-23],[430,-111],[246,-564],[215,-390],[153,-240],[263,-619],[283,-9],[233,-394],[161,-482],[211,-263],[-111,-471],[159,-200],[100,-14],[47,-402],[97,-321],[204,-51],[135,-365],[-70,-716],[-11,-891]],[[72530,69211],[-176,-261],[-108,-538],[269,-218],[262,-283],[362,-323],[381,-75],[160,-293],[215,-54],[334,-135],[231,10],[32,228],[-36,366],[21,248]],[[77035,68105],[20,-219],[-97,-105],[23,-355],[-199,104],[-359,-397],[8,-330],[-153,-483],[-14,-281],[-124,-474],[-217,131],[-11,-596],[-63,-196],[30,-245],[-137,-137]],[[74730,64531],[-39,-210],[-189,7],[-343,-120],[16,-433],[-148,-341],[-400,-387],[-311,-678],[-209,-363],[-276,-377],[-1,-265],[-138,-142],[-251,-206],[-129,-31],[-84,-439],[58,-749],[15,-478],[-118,-547],[-1,-978],[-144,-28],[-126,-439],[84,-190],[-253,-163],[-93,-392],[-112,-165],[-263,537],[-128,807],[-107,581],[-97,272],[-148,553],[-69,720],[-48,360],[-253,791],[-115,1116],[-83,737],[1,698],[-54,539],[-404,-345],[-196,69],[-362,698],[133,208],[-82,226],[-326,489]],[[68937,65473],[185,384],[612,-1],[-56,494],[-156,292],[-31,444],[-182,258],[306,604],[323,-44],[290,604],[174,584],[270,578],[-4,411],[236,333],[-224,284],[-96,390],[-99,504],[137,249],[421,-141],[310,86],[268,484]],[[48278,82851],[46,-412],[-210,-514],[-493,-340],[-393,87],[225,601],[-145,586],[378,451],[210,269]],[[64978,73251],[244,112],[197,329],[186,-17],[122,108],[197,-53],[308,-292],[221,-63],[318,-510],[207,-21],[24,-484]],[[66909,69007],[137,-302],[112,-348],[266,-253],[7,-508],[133,-93],[23,-265],[-400,-298],[-105,-669]],[[67082,66271],[-523,174],[-303,133],[-313,74],[-118,707],[-133,102],[-214,-103],[-280,-279],[-339,191],[-281,443],[-267,164],[-186,546],[-205,768],[-149,-93],[-177,190],[-104,-224]],[[63490,69064],[-153,302],[-3,307],[-89,0],[46,417],[-143,438],[-340,315],[-193,548],[65,449],[139,199],[-21,336],[-182,173],[-180,687]],[[62436,73235],[-152,461],[55,179],[-87,660],[190,164]],[[63578,73897],[88,-424],[263,-120],[193,-289],[395,-100],[434,153],[27,134]],[[63490,69064],[-164,28]],[[63326,69092],[-187,48],[-204,-553]],[[62935,68587],[-516,46],[-784,1158],[-413,403],[-335,156]],[[60887,70350],[-112,701]],[[60775,71051],[615,600],[105,696],[-26,421],[152,142],[142,359]],[[61763,73269],[119,90],[324,-75],[97,-146],[133,97]],[[45969,90100],[-64,-373],[314,-392],[-361,-440],[-801,-394],[-240,-105],[-365,85],[-775,182],[273,254],[-605,282],[492,112],[-12,169],[-583,134],[188,375],[421,85],[433,-391],[422,314],[349,-163],[453,307],[461,-41]],[[59922,70666],[-49,-182]],[[59873,70484],[-100,80],[-58,-383],[69,-65],[-71,-79],[-12,-152],[131,78]],[[59832,69963],[7,-224],[-139,-920]],[[59518,69808],[80,190],[-19,32],[74,270],[56,434],[40,146],[8,6]],[[59757,70886],[93,-1],[25,101],[75,7]],[[59950,70993],[4,-236],[-38,-87],[6,-4]],[[54311,73846],[-100,-453],[41,-179],[-58,-296],[-213,217],[-141,62],[-387,293],[38,296],[325,-53],[284,63],[211,50]],[[52558,75561],[166,-408],[-39,-762],[-126,36],[-113,-192],[-105,153],[-11,694],[-64,330],[153,-29],[139,178]],[[53835,78613],[-31,-283],[67,-246]],[[53871,78084],[-221,84],[-226,-204],[15,-286],[-34,-164],[91,-293],[261,-290],[140,-476],[309,-464],[217,3],[68,-127],[-78,-115],[249,-208],[204,-174],[238,-301],[29,-107],[-52,-206],[-154,268],[-242,95],[-116,-372],[200,-214],[-33,-300],[-116,-34],[-148,-494],[-116,-45],[1,176],[57,309],[60,123],[-108,334],[-85,290],[-115,72],[-82,249],[-179,104],[-120,232],[-206,37],[-217,260],[-254,375],[-189,332],[-86,569],[-138,67],[-226,190],[-128,-78],[-161,-267],[-115,-42]],[[28453,62478],[187,-52],[147,-138],[46,-158],[-195,-11],[-84,-96],[-156,92],[-159,210],[34,132],[116,40],[64,-19]],[[59922,70666],[309,-228],[544,613]],[[60887,70350],[-53,-87],[-556,-289],[277,-575],[-92,-98],[-46,-193],[-212,-80],[-66,-207],[-120,-177],[-310,91]],[[59709,68735],[-9,84]],[[59832,69963],[41,169],[0,352]],[[87399,71495],[35,-197],[-156,-349],[-114,185],[-143,-134],[-73,-337],[-181,164],[2,273],[154,344],[158,-67],[114,242],[204,-124]],[[89159,73219],[-104,-460],[48,-288],[-145,-406],[-355,-271],[-488,-36],[-396,-657],[-186,221],[-12,431],[-483,-127],[-329,-271],[-325,-11],[282,-424],[-186,-979],[-179,-242],[-135,224],[69,519],[-176,167],[-113,395],[263,177],[145,362],[280,298],[203,394],[553,171],[297,-117],[291,1024],[185,-275],[408,575],[158,224],[174,704],[-47,648],[117,364],[295,105],[152,-798],[-9,-467],[-256,-580],[4,-594]],[[89974,77268],[195,-122],[197,244],[62,-647],[-412,-157],[-244,-572],[-436,393],[-152,-630],[-308,-9],[-39,573],[138,443],[296,32],[81,797],[83,449],[326,-600],[213,-194]],[[69711,76170],[-159,-107],[-367,-401],[-121,-412],[-104,-4],[-76,273],[-353,18],[-57,472],[-135,4],[21,578],[-333,421],[-476,-45],[-326,-84],[-265,519],[-227,218],[-431,412],[-52,50],[-715,-340],[11,-2124]],[[65546,75618],[-142,-28],[-195,452],[-188,161],[-315,-120],[-123,-191]],[[64583,75892],[-15,140],[68,240],[-53,201],[-322,196],[-125,517],[-154,146],[-9,187],[270,-54],[11,421],[236,93],[243,-86],[50,562],[-50,356],[-278,-28],[-236,141],[-321,-253],[-259,-121]],[[63639,78550],[-142,93],[29,296],[-177,385],[-207,-16],[-235,391],[160,436],[-81,118],[222,632],[285,-334],[35,421],[573,626],[434,15],[612,-399],[329,-233],[295,243],[440,12],[356,-298],[80,170],[391,-24],[69,272],[-450,396],[267,281],[-52,157],[266,150],[-200,394],[127,197],[1039,200],[136,142],[695,213],[250,239],[499,-124],[88,-597],[290,140],[356,-197],[-23,-314],[267,33],[696,543],[-102,-180],[355,-445],[620,-1463],[148,302],[383,-332],[399,148],[154,-104],[133,-332],[194,-112],[119,-244],[358,77],[147,-353]],[[72294,76218],[-171,84],[-140,207],[-412,61],[-461,15],[-100,-63],[-396,242],[-158,-119],[-43,-340],[-457,198],[-183,-81],[-62,-252]],[[61551,50860],[-195,-230],[-68,-240],[-104,-42],[-40,-406],[-89,-233],[-54,-383],[-112,-190]],[[60889,49136],[-399,576],[-19,334],[-1007,1173],[-47,63]],[[59417,51282],[-3,611],[80,233],[137,381],[101,420],[-123,661],[-32,289],[-132,400]],[[59445,54277],[171,344],[188,379]],[[61626,54086],[-243,-653],[3,-2098],[165,-475]],[[70465,74537],[-526,-87],[-343,187],[-301,-45],[26,332],[303,-96],[101,177]],[[69725,75005],[212,-56],[355,414],[-329,304],[-198,-144],[-205,217],[234,373],[-83,57]],[[78495,58847],[-66,696],[178,479],[359,110],[261,-83]],[[79227,60049],[229,-226],[126,397],[246,-212]],[[79828,60008],[64,-384],[-34,-690],[-467,-443],[122,-349],[-292,-42],[-240,-232]],[[78981,57868],[-233,84],[-112,301],[-141,594]],[[85652,74065],[240,-679],[68,-373],[3,-664],[-105,-316],[-252,-111],[-222,-239],[-250,-49],[-31,313],[51,432],[-122,600],[206,97],[-190,493]],[[85048,73569],[17,52],[124,-21],[108,260],[197,28],[118,38],[40,139]],[[55575,76355],[52,129]],[[55627,76484],[66,42],[38,191],[50,32],[40,-81],[52,-36],[36,-92],[46,-27],[54,-107],[39,3],[-31,-140],[-33,-68],[9,-43]],[[55993,76158],[-62,-23],[-164,-89],[-13,-118],[-35,5]],[[63326,69092],[58,-254],[-25,-132],[89,-434]],[[63448,68272],[-196,-15],[-69,274],[-248,56]],[[79227,60049],[90,260],[12,487],[-224,502],[-18,568],[-211,468],[-210,40],[-56,-201],[-163,-17],[-83,102],[-293,-344],[-6,517],[68,606],[-188,27],[-16,346],[-120,178]],[[77809,63588],[59,212],[237,374]],[[78380,64766],[162,-454],[125,-524],[342,-4],[108,-502],[-178,-151],[-80,-207],[333,-345],[231,-680],[175,-508],[210,-400],[70,-407],[-50,-576]],[[59757,70886],[99,469],[138,406],[5,20]],[[59999,71781],[125,-30],[45,-226],[-151,-217],[-68,-315]],[[47857,54343],[-73,-5],[-286,274],[-252,439],[-237,315],[-187,371]],[[46822,55737],[66,184],[15,168],[126,313],[129,268]],[[54125,64996],[-197,-214],[-156,316],[-439,248]],[[52633,69283],[136,133],[24,244],[-30,238],[191,222],[86,185],[135,165],[16,442]],[[53191,70912],[326,-198],[117,50],[232,-96],[368,-258],[130,-512],[250,-111],[391,-242],[296,-286],[136,150],[133,264],[-65,442],[87,280],[200,270],[192,78],[375,-118],[95,-257],[104,-3],[88,-98],[276,-67],[68,-191]],[[56944,64499],[0,-1150],[-320,-2],[-3,-242]],[[56621,63105],[-1108,1103],[-1108,1103],[-280,-315]],[[72718,56162],[-42,-600],[-116,-164],[-242,-132],[-132,458],[-49,828],[126,935],[192,-320],[129,-406],[134,-599]],[[58049,35154],[96,-173],[-85,-281],[-47,-187],[-155,-90],[-51,-184],[-99,-58],[-209,443],[148,365],[151,225],[130,118],[121,-178]],[[56314,83116],[-23,147],[30,157],[-123,92],[-291,100]],[[55907,83612],[-59,485]],[[55848,84097],[318,176],[466,-37],[273,57],[39,-120],[148,-37],[267,-279]],[[56523,82877],[-67,177],[-142,62]],[[55848,84097],[10,433],[136,362],[262,196],[221,-430],[223,11],[53,442]],[[57579,84928],[134,-133],[24,-279],[89,-340]],[[47592,67756],[-42,0],[7,-308],[-172,-19],[-90,-131],[-126,0],[-100,75],[-234,-62],[-91,-449],[-86,-42],[-131,-726],[-386,-621],[-92,-796],[-114,-258],[-33,-208],[-625,-46],[-5,1]],[[45272,64166],[13,267],[106,157],[91,300],[-18,195],[96,406],[155,366],[93,93],[74,336],[6,307],[100,356],[185,210],[177,588],[5,8],[139,221],[259,64],[218,393],[140,154],[232,481],[-70,716],[106,495],[37,304],[179,389],[278,263],[206,238],[186,596],[87,354],[205,-3],[167,-244],[264,39],[288,-127],[121,-6]],[[57394,79599],[66,85],[185,57],[204,-180],[115,-21],[125,-155],[-20,-195],[101,-95],[40,-240],[97,-147],[-19,-86],[52,-58],[-74,-43],[-164,17],[-27,80],[-58,-46],[20,-103],[-76,-184],[-49,-197],[-70,-63]],[[57842,78025],[-50,263],[30,246],[-9,253],[-160,342],[-89,243],[-86,171],[-84,56]],[[63761,44648],[74,-245],[69,-380],[45,-693],[72,-269],[-28,-277],[-49,-169],[-94,338],[-53,-171],[53,-427],[-24,-244],[-77,-133],[-18,-488],[-109,-671],[-137,-793],[-172,-1092],[-106,-800],[-125,-668],[-226,-136],[-243,-244],[-160,147],[-220,206],[-77,304],[-18,510],[-98,460],[-26,414],[50,415],[128,100],[1,191],[133,437],[25,367],[-65,272],[-52,364],[-23,530],[97,322],[38,366],[138,21],[155,118],[103,104],[122,8],[158,328],[229,355],[83,289],[-38,247],[118,-70],[153,401],[6,346],[92,257],[96,-247]],[[23016,66727],[-107,-505],[-49,-415],[-20,-771],[-27,-281],[48,-315],[86,-280],[56,-447],[184,-429],[65,-328],[109,-284],[295,-153],[114,-241],[244,161],[212,58],[208,104],[175,99],[176,235],[67,336],[22,483],[48,169],[188,151],[294,133],[246,-20],[169,49],[66,-122],[-9,-278],[-149,-342],[-66,-351],[51,-100],[-42,-249],[-69,-449],[-71,148],[-58,-10]],[[24381,60202],[-314,620],[-144,187],[-226,150],[-156,-42],[-223,-216],[-140,-57],[-196,152],[-208,109],[-260,264],[-208,81],[-314,268],[-233,275],[-70,154],[-155,34],[-284,183],[-116,262],[-299,327],[-139,363],[-66,281],[93,56],[-29,164],[64,150],[1,199],[-93,259],[-25,229],[-94,290],[-244,573],[-280,450],[-135,359],[-238,235],[-51,140],[42,356],[-142,135],[-164,279],[-69,402],[-149,47],[-162,303],[-130,281],[-12,180],[-149,434],[-99,441],[5,221],[-201,229],[-93,-26],[-159,159],[-44,-234],[46,-276],[27,-433],[95,-237],[206,-397],[46,-135],[42,-41],[37,-198],[49,8],[56,-372],[85,-146],[59,-204],[174,-293],[92,-536],[83,-252],[77,-270],[15,-304],[134,-19],[112,-261],[100,-257],[-6,-104],[-117,-211],[-49,3],[-74,350],[-181,328],[-201,278],[-142,147],[9,421],[-42,312],[-132,179],[-191,257],[-37,-75],[-70,151],[-171,139],[-164,334],[20,44],[115,-33],[103,215],[10,260],[-214,411],[-163,159],[-102,360],[-103,377],[-129,461],[-113,518]],[[17464,70566],[316,44],[353,63],[-26,-113],[419,-280],[634,-406],[552,5],[221,0],[0,237],[481,0],[102,-204],[142,-182],[165,-253],[92,-301],[69,-317],[144,-174],[230,-172],[175,455],[227,11],[196,-230],[139,-394],[96,-338],[164,-328],[61,-403],[78,-271],[217,-178],[197,-127],[108,17]],[[55993,76158],[95,33],[128,10]],[[46619,60247],[93,105],[47,339],[88,13],[194,-160],[157,114],[107,-38],[42,128],[1114,8],[62,404],[-48,71],[-134,2485],[-134,2485],[425,11]],[[51185,62860],[1,-1326],[-152,-384],[-24,-355],[-247,-92],[-379,-49],[-102,-205],[-178,-22]],[[46801,58995],[13,179],[-24,223],[-104,162],[-54,330],[-13,358]],[[77375,57550],[-27,427],[86,441],[-94,341],[23,627],[-113,299],[-90,689],[-50,727],[-121,477],[-183,-289],[-315,-410],[-156,51],[-172,135],[96,714],[-58,539],[-218,664],[34,208],[-163,74],[-197,469]],[[77809,63588],[-159,-134],[-162,-249],[-196,-26],[-127,-623],[-117,-104],[134,-506],[177,-420],[113,-380],[-101,-501],[-96,-106],[66,-289],[185,-458],[32,-321],[-4,-268],[108,-525],[-152,-537],[-135,-591]],[[55380,75946],[-58,44],[-78,188],[-120,115]],[[55338,76894],[74,-99],[40,-80],[91,-62],[106,-119],[-22,-50]],[[74375,80219],[292,99],[530,496],[423,271],[242,-176],[289,-9],[186,-269],[277,-21],[402,-144],[270,401],[-113,339],[288,596],[311,-238],[252,-67],[327,-148],[53,-432],[394,-242],[263,107],[351,75],[279,-76],[272,-276],[168,-295],[258,6],[350,-94],[255,143],[366,96],[407,405],[166,-62],[146,-193],[331,48]],[[59599,45195],[209,47],[334,-163],[73,73],[193,15],[99,173],[167,-10],[303,224],[221,334]],[[61198,45888],[45,-258],[-11,-574],[34,-505],[11,-900],[49,-282],[-83,-412],[-108,-400],[-177,-357],[-254,-219],[-313,-279],[-313,-618],[-107,-106],[-194,-409],[-115,-133],[-23,-411],[132,-436],[54,-337],[4,-173],[49,29],[-8,-565],[-45,-267],[65,-99],[-41,-239],[-116,-205],[-229,-195],[-334,-312],[-122,-213],[24,-242],[71,-39],[-24,-303]],[[59119,36429],[-211,5]],[[58908,36434],[-24,254],[-41,259]],[[58843,36947],[-23,206],[49,642],[-72,410],[-133,810]],[[58664,39015],[292,654],[74,415],[42,52],[31,339],[-45,171],[12,430],[54,400],[0,728],[-145,185],[-132,42],[-60,143],[-128,121],[-232,-11],[-18,215]],[[58409,42899],[-26,410],[843,474]],[[59226,43783],[159,-276],[77,53],[110,-146],[16,-231],[-59,-268],[21,-405],[181,-356],[85,399],[120,122],[-24,740],[-116,417],[-100,185],[-97,-8],[-77,748],[77,438]],[[46619,60247],[-184,395],[-168,424],[-184,153],[-133,169],[-155,-6],[-135,-126],[-138,50],[-96,-185]],[[45426,61121],[-24,311],[78,283],[34,543],[-30,569],[-34,286],[28,287],[-72,274],[-146,249]],[[45260,63923],[60,192],[1088,-4],[-53,832],[68,296],[261,51],[-9,1474],[911,-30],[1,872]],[[59226,43783],[-147,149],[85,535],[87,201],[-53,477],[56,467],[47,156],[-71,489],[-131,257]],[[59099,46514],[273,-108],[55,-159],[95,-269],[77,-783]],[[78372,55412],[64,-54],[164,-347],[116,-386],[16,-388],[-29,-262],[27,-198],[20,-340],[98,-159],[109,-509],[-5,-195],[-197,-38],[-263,426],[-329,457],[-32,294],[-161,385],[-38,477],[-100,314],[30,419],[-61,244]],[[77801,55552],[48,103],[227,-252],[22,-296],[183,69],[91,236]],[[80461,52985],[204,-198],[214,108],[56,488],[119,108],[333,125],[199,456],[137,364]],[[82069,54967],[214,400],[140,450],[112,2],[143,-291],[13,-251],[183,-160],[231,-173],[-20,-226],[-186,-29],[50,-281],[-205,-196]],[[54540,35373],[-207,435],[-108,420],[-62,561],[-68,417],[-93,887],[-7,689],[-35,314],[-108,237],[-144,476],[-146,691],[-60,361],[-226,563],[-17,441]],[[56448,41738],[228,131],[180,-33],[109,-130],[2,-48]],[[55526,37566],[0,-2127],[-248,-294],[-149,-42],[-175,108],[-125,42],[-47,247],[-109,157],[-133,-284]],[[96049,39690],[228,-357],[144,-265],[-105,-138],[-153,155],[-199,259],[-179,306],[-184,406],[-38,195],[119,-8],[156,-196],[122,-196],[89,-161]],[[54125,64996],[68,-895],[104,-150],[4,-183],[116,-198],[-60,-248],[-107,-1168],[-15,-749],[-354,-543],[-120,-759],[115,-213],[0,-371],[178,-13],[-28,-271]],[[53939,59018],[-52,-12],[-188,630],[-65,23],[-217,-322],[-215,168],[-150,34],[-80,-81],[-163,17],[-164,-245],[-141,-14],[-337,298],[-131,-142],[-142,10],[-104,218],[-279,214],[-298,-68],[-72,-124],[-39,-331],[-80,-233],[-19,-514]],[[52361,54577],[-289,-207],[-105,30],[-107,-129],[-222,13],[-149,360],[-91,417],[-197,379],[-209,-7],[-245,1]],[[26191,58215],[-96,181],[-130,233],[-61,194],[-117,181],[-140,260],[31,89],[46,-87],[21,41]],[[26903,60465],[-24,-55],[-14,-129],[29,-210],[-64,-197],[-30,-231],[-9,-254],[15,-148],[7,-260],[-43,-56],[-26,-247],[19,-152],[-56,-147],[12,-156],[43,-94]],[[50920,81398],[143,159],[244,847],[380,241],[231,-16]],[[58639,91887],[-473,-231],[-224,-54]],[[55734,91626],[-172,-23],[-41,-379],[-523,92],[-74,-321],[-267,2],[-183,-409],[-278,-639],[-431,-810],[101,-197],[-97,-228],[-275,10],[-180,-540],[17,-765],[177,-292],[-92,-677],[-231,-395],[-122,-332]],[[53063,85723],[-187,354],[-548,-666],[-371,-135],[-384,293],[-99,619],[-88,1329],[256,371],[733,483],[549,595],[508,802],[668,1112],[465,434],[763,722],[610,252],[457,-31],[423,477],[506,-25],[499,115],[869,-422],[-358,-154],[305,-361]],[[56867,96664],[-620,-236],[-490,134],[191,149],[-167,184],[575,115],[110,-216],[401,-130]],[[55069,97728],[915,-429],[-699,-227],[-155,-424],[-243,-108],[-132,-478],[-335,-22],[-598,351],[252,205],[-416,166],[-541,487],[-216,451],[757,206],[152,-202],[396,8],[105,197],[408,20],[350,-201]],[[57068,98134],[545,-202],[-412,-310],[-806,-68],[-819,96],[-50,159],[-398,10],[-304,264],[858,161],[403,-138],[281,172],[702,-144]],[[98060,28265],[63,-238],[198,233],[80,-243],[0,-242],[-103,-267],[-182,-424],[-142,-232],[103,-277],[-214,-7],[-238,-217],[-75,-377],[-157,-583],[-219,-257],[-138,-164],[-256,12],[-180,190],[-302,40],[-46,212],[149,427],[349,568],[179,109],[200,219],[238,301],[167,299],[123,429],[106,146],[41,321],[195,267],[61,-245]],[[98502,31008],[202,-607],[5,394],[126,-158],[41,-435],[224,-188],[188,-46],[158,220],[141,-67],[-67,-511],[-85,-336],[-212,12],[-74,-175],[26,-248],[-41,-107],[-105,-310],[-138,-395],[-214,-229],[-48,151],[-116,83],[160,474],[-91,317],[-299,230],[8,209],[201,200],[47,444],[-13,372],[-113,386],[8,102],[-133,237],[-218,510],[-117,408],[104,45],[151,-320],[216,-149],[78,-513]],[[64752,61418],[-91,403],[-217,950]],[[64444,62771],[833,576],[185,1152],[-127,408]],[[65665,66183],[125,-393],[155,-209],[203,-76],[165,-105],[125,-330],[75,-191],[100,-73],[-1,-128],[-101,-344],[-44,-161],[-117,-184],[-104,-395],[-126,30],[-58,-137],[-44,-292],[34,-385],[-26,-71],[-128,2],[-174,-215],[-27,-281],[-63,-121],[-173,4],[-109,-145],[1,-232],[-134,-160],[-153,54],[-186,-194],[-128,-33]],[[65575,66834],[80,196],[35,-50],[-26,-238],[-37,-104]],[[68937,65473],[-203,146],[-83,414],[-215,438],[-512,-108],[-451,-11],[-391,-81]],[[28366,55989],[-93,166],[-59,311],[68,154],[-70,40],[-52,190],[-138,160],[-122,-37],[-56,-200],[-112,-145],[-61,-20],[-27,-120],[132,-312],[-75,-74],[-40,-85],[-130,-29],[-48,344],[-36,-98],[-92,33],[-56,232],[-114,38],[-72,68],[-119,-1],[-8,-125],[-32,87]],[[27070,57338],[100,-206],[-6,-122],[111,-26],[26,47],[77,-142],[136,42],[119,145],[168,116],[95,172],[153,-33],[-10,-57],[155,-20],[124,-99],[90,-173],[105,-159]],[[30452,41263],[-279,331],[-24,236],[-551,578],[-498,630],[-214,355],[-115,476],[46,166],[-236,755],[-274,1063],[-262,1147],[-114,262],[-87,424],[-216,376],[-198,233],[90,257],[-134,550],[86,403],[221,364]],[[85104,56675],[28,-382],[16,-323],[-94,-527],[-102,587],[-130,-292],[89,-425],[-79,-270],[-327,335],[-78,416],[84,274],[-176,273],[-87,-239],[-131,22],[-205,-321],[-46,168],[109,486],[175,161],[151,217],[98,-260],[212,157],[45,257],[196,16],[-16,445],[225,-273],[23,-290],[20,-212]],[[84439,57749],[-100,-190],[-87,-363],[-87,-171],[-171,398],[57,154],[70,162],[30,357],[153,34],[-44,-388],[205,556],[-26,-549]],[[82917,57194],[-369,-546],[136,403],[200,355],[167,399],[146,572],[49,-470],[-183,-317],[-146,-396]],[[83856,58678],[166,-179],[177,1],[-5,-240],[-129,-245],[-176,-173],[-10,268],[20,293],[-43,275]],[[84861,58834],[78,-643],[-214,152],[5,-193],[68,-355],[-132,-129],[-11,405],[-84,30],[-43,348],[163,-46],[-4,218],[-169,440],[266,-13],[77,-214]],[[83757,59356],[-74,-498],[-119,288],[-142,438],[238,-21],[97,-207]],[[83700,62485],[171,-164],[85,150],[26,-146],[-46,-239],[95,-413],[-73,-478],[-164,-191],[-43,-465],[62,-458],[147,-64],[123,68],[347,-319],[-27,-313],[91,-139],[-29,-265],[-216,283],[-103,302],[-71,-211],[-177,345],[-253,-86],[-138,128],[14,238],[87,146],[-83,133],[-36,-207],[-137,331],[-41,251],[-11,551],[112,-190],[29,901],[90,522],[169,-1]],[[93299,47902],[-78,-58],[-120,221],[-122,366],[-59,439],[38,55],[30,-171],[84,-130],[135,-366],[131,-195],[-39,-161]],[[92217,48675],[-146,-48],[-44,-161],[-152,-140],[-142,-135],[-148,1],[-228,167],[-158,161],[23,178],[249,-84],[152,45],[42,276],[40,14],[27,-306],[158,44],[78,197],[155,206],[-30,339],[166,11],[56,-94],[-5,-320],[-93,-351]],[[89166,50332],[482,-397],[513,-329],[192,-295],[154,-290],[43,-339],[462,-356],[68,-306],[-256,-62],[62,-383],[248,-378],[180,-611],[159,19],[-11,-255],[215,-98],[-84,-108],[295,-243],[-30,-166],[-184,-40],[-69,149],[-238,65],[-281,86],[-216,368],[-158,316],[-144,504],[-362,252],[-235,-164],[-170,-190],[35,-425],[-218,-198],[-155,96],[-288,25]],[[92538,49238],[-87,-154],[-52,340],[-65,223],[-126,189],[-158,245],[-200,170],[77,139],[150,-162],[94,-126],[117,-139],[111,-241],[106,-185],[33,-299]],[[53922,82787],[189,169],[434,266],[350,195],[277,-97],[21,-140],[268,-8]],[[55461,83172],[342,-65],[511,9]],[[56535,81532],[139,-502],[-29,-162],[-138,-67],[-252,-479],[71,-259],[-60,34]],[[56266,80097],[-264,221],[-200,-81],[-131,59],[-165,-123],[-140,204],[-114,-78],[-16,34]],[[31588,62492],[142,-51],[50,-114],[-71,-146],[-209,4],[-163,-21],[-16,247],[40,84],[227,-3]],[[86288,76244],[39,-101]],[[86327,76143],[-106,35],[-120,-195],[-83,-196],[10,-414],[-143,-127],[-50,-102],[-104,-170],[-185,-95],[-121,-154],[-9,-250],[-32,-63],[111,-94],[157,-253]],[[85048,73569],[-135,109],[-34,-108],[-81,-48],[-10,109],[-72,52],[-75,92],[76,254],[66,67],[-25,105],[71,311],[-18,94],[-163,63],[-131,154]],[[47929,73193],[-112,-149],[-146,81],[-143,-64],[42,451],[-26,354],[-124,53],[-67,218],[22,377],[111,210],[20,232],[58,347],[-6,244],[-56,206],[-12,195]],[[64113,66085],[-18,419],[75,302],[76,62],[84,-180],[5,-337],[-61,-339]],[[64274,66012],[-77,-41],[-84,114]],[[56308,79404],[120,123],[172,-64],[178,-2],[129,-141],[95,89],[205,55],[69,135],[118,0]],[[57842,78025],[124,-106],[131,93],[126,-99]],[[58223,77913],[6,-149],[-135,-124],[-84,54],[-78,-694]],[[56293,77303],[-51,101],[65,97],[-69,72],[-87,-129],[-162,167],[-22,237],[-169,136],[-31,183],[-151,226]],[[89901,81054],[280,-1020],[-411,190],[-171,-832],[271,-590],[-8,-403],[-211,347],[-182,-445],[-51,483],[31,561],[-32,621],[64,436],[13,770],[-163,566],[24,787],[257,265],[-110,267],[123,81],[73,-381],[96,-555],[-7,-567],[114,-581]],[[55461,83172],[63,254],[383,186]],[[99999,92620],[-305,-29],[-49,183],[-99645,240],[36,24],[235,-1],[402,-165],[-24,-79],[-286,-138],[-363,-35],[99999,0]],[[89889,93991],[-421,-4],[-569,64],[-49,31],[263,227],[348,54],[394,-221],[34,-151]],[[91869,95069],[-321,-228],[-444,52],[-516,227],[66,187],[518,-87],[697,-151]],[[90301,95344],[-219,-427],[-1023,16],[-461,-136],[-550,374],[149,396],[366,108],[734,-25],[1004,-306]],[[65981,92556],[-164,-51],[-907,75],[-74,256],[-503,154],[-40,311],[284,124],[-10,314],[551,491],[-255,70],[665,506],[-75,261],[621,304],[917,370],[925,108],[475,214],[541,74],[193,-227],[-187,-179],[-984,-286],[-848,-274],[-863,-548],[-414,-563],[-435,-553],[56,-479],[531,-472]],[[63639,78550],[-127,-342],[-269,-95],[-276,-594],[252,-547],[-27,-388],[303,-678]],[[61098,76843],[-354,486],[-317,218],[-240,338],[202,92],[231,482],[-156,227],[410,236],[-8,125],[-249,-92]],[[60617,78955],[9,255],[143,161],[269,42],[44,192],[-62,318],[113,302],[-3,169],[-410,187],[-162,-6],[-172,270],[-213,-92],[-352,203],[6,113],[-99,250],[-222,28],[-23,178],[70,117],[-178,326],[-288,-56],[-84,29],[-70,-131],[-104,24]],[[57772,86080],[316,318],[-291,274]],[[58639,91887],[286,200],[456,-348],[761,-137],[1050,-652],[213,-273],[18,-384],[-308,-302],[-454,-154],[-1240,438],[-204,-73],[453,-422],[18,-267],[18,-589],[358,-175],[217,-150],[36,279],[-168,248],[177,218],[672,-358],[233,140],[-186,422],[647,564],[256,-33],[260,-202],[161,396],[-231,343],[136,345],[-204,357],[777,-185],[158,-322],[-351,-71],[1,-321],[219,-197],[429,125],[68,367],[580,274],[970,495],[209,-28],[-273,-350],[344,-60],[199,197],[521,16],[412,239],[317,-347],[315,381],[-291,334],[145,190],[820,-175],[385,-180],[1006,-658],[186,302],[-282,304],[-8,122],[-335,57],[92,273],[-149,449],[-8,185],[512,521],[183,523],[206,114],[736,-152],[57,-320],[-263,-468],[173,-183],[89,-403],[-63,-789],[307,-353],[-120,-384],[-544,-818],[318,-85],[110,207],[306,148],[74,285],[240,274],[-162,328],[130,380],[-304,47],[-67,321],[222,578],[-361,469],[497,389],[-64,409],[139,13],[145,-319],[-109,-556],[297,-105],[-127,415],[465,227],[577,30],[513,-328],[-247,479],[-28,614],[483,116],[669,-25],[602,75],[-226,301],[321,378],[319,16],[540,286],[734,77],[93,157],[729,54],[227,-129],[624,306],[510,-10],[77,249],[265,245],[656,236],[476,-186],[-378,-142],[629,-89],[75,-284],[254,140],[812,-8],[626,-281],[223,-215],[-69,-300],[-307,-170],[-730,-320],[-209,-171],[345,-80],[410,-146],[251,109],[141,-369],[122,149],[444,91],[892,-95],[67,-269],[1162,-86],[15,440],[590,-101],[443,3],[449,-303],[128,-369],[-165,-241],[349,-453],[437,-234],[268,605],[446,-260],[473,155],[538,-177],[204,162],[455,-81],[-201,534],[367,250],[2509,-374],[236,-342],[727,-440],[1122,109],[553,-95],[231,-238],[-33,-421],[342,-164],[372,118],[492,15],[525,-113],[526,64],[484,-512],[344,184],[-224,368],[123,256],[886,-161],[578,34],[799,-275],[-99610,-251],[681,-440],[728,-572],[-24,-358],[187,-143],[-64,418],[754,-86],[544,-539],[-276,-251],[-455,-59],[-7,-563],[-111,-120],[-260,17],[-212,201],[-369,168],[-62,250],[-283,94],[-315,-74],[-151,201],[60,214],[-333,-137],[126,-271],[-158,-244],[0,-3],[99640,-253],[-360,42],[250,-307],[166,-474],[128,-155],[32,-238],[-71,-153],[-518,126],[-777,-434],[-247,-67],[-425,-405],[-403,-353],[-102,-262],[-397,399],[-724,-453],[-126,214],[-268,-246],[-371,79],[-90,-379],[-333,-557],[10,-233],[316,-129],[-37,-839],[-258,-21],[-119,-482],[116,-248],[-486,-294],[-96,-657],[-415,-141],[-83,-585],[-400,-536],[-103,396],[-119,841],[-155,1279],[134,799],[234,344],[14,269],[432,129],[496,725],[479,592],[499,459],[223,812],[-337,-49],[-167,-474],[-705,-632],[-227,708],[-717,-196],[-696,-965],[230,-353],[-620,-151],[-430,-59],[20,417],[-431,87],[-344,-283],[-850,99],[-914,-171],[-899,-1124],[-1065,-1358],[438,-73],[136,-360],[270,-128],[178,288],[305,-38],[401,-633],[9,-490],[-217,-576],[-23,-687],[-126,-921],[-418,-833],[-94,-399],[-377,-670],[-374,-665],[-179,-340],[-370,-338],[-175,-8],[-175,280],[-373,-421],[-43,-192]],[[79187,96925],[-1566,-222],[507,756],[229,64],[208,-37],[704,-327],[-82,-234]],[[64204,98215],[-373,-76],[-250,-44],[-39,-94],[-324,-95],[-301,136],[158,180],[-618,17],[542,105],[422,7],[57,-155],[159,138],[262,95],[412,-126],[-107,-88]],[[77760,97255],[-606,-71],[-773,166],[-462,220],[-213,413],[-379,113],[722,394],[600,130],[540,-290],[640,-557],[-69,-518]],[[58449,51176],[110,-325],[-16,-339],[-80,-73]],[[58216,51057],[67,-59],[166,178]],[[45260,63923],[12,243]],[[61883,61244],[-37,246],[-83,173],[-22,230],[-143,206],[-148,483],[-79,469],[-192,397],[-124,94],[-184,549],[-32,400],[12,342],[-159,638],[-130,225],[-150,119],[-92,330],[15,130],[-77,299],[-81,128],[-108,429],[-170,464],[-141,395],[-139,-2],[44,316],[12,201],[34,230]],[[63448,68272],[109,-497],[137,-131],[47,-203],[190,-242],[16,-237],[-27,-192],[35,-193],[80,-162],[37,-189],[41,-141]],[[64274,66012],[53,-220]],[[64444,62771],[-801,-221],[-259,-259],[-199,-604],[-130,-96],[-70,191],[-106,-28],[-269,57],[-50,58],[-321,-13],[-75,-52],[-114,149],[-74,-283],[28,-243],[-121,-183]],[[59434,57280],[-39,11],[5,287],[-33,197],[-143,228],[-34,415],[34,425],[-129,40],[-19,-129],[-167,-29],[67,-169],[23,-346],[-152,-316],[-138,-415],[-144,-59],[-233,336],[-105,-119],[-29,-168],[-143,-109],[-9,-118],[-277,0],[-38,118],[-200,20],[-100,-99],[-77,50],[-143,336],[-48,158],[-200,-79],[-76,-267],[-72,-514],[-95,-109],[-85,-63]],[[56635,56793],[-23,27]],[[56351,58246],[3,140],[-102,169],[-3,335],[-58,222],[-98,-33],[28,211],[72,240],[-32,239],[92,176],[-58,135],[73,355],[127,425],[240,-41],[-14,2286]],[[60240,64499],[90,-565],[-61,-105],[40,-593],[102,-687],[106,-142],[152,-213]],[[59433,57348],[1,-68]],[[59434,57280],[3,-449]],[[59445,54277],[-171,-265],[-195,1],[-224,-135],[-176,129],[-115,-157]],[[56824,56568],[-189,225]],[[45357,59658],[-115,449],[-138,205],[122,109],[134,404],[66,296]],[[45367,58962],[-46,441]],[[95032,45793],[78,-198],[-194,3],[-106,355],[166,-140],[56,-20]],[[94680,46144],[-108,-13],[-170,58],[-58,89],[17,228],[183,-90],[91,-121],[45,-151]],[[94910,46301],[-42,-106],[-206,499],[-57,344],[94,0],[100,-461],[111,-276]],[[94409,47028],[12,-116],[-218,245],[-152,206],[-104,192],[41,59],[128,-138],[228,-265],[65,-183]],[[93760,47598],[-56,-33],[-121,131],[-114,237],[14,96],[166,-243],[111,-188]],[[46822,55737],[-75,43],[-200,232],[-144,308],[-49,211],[-34,425]],[[25613,59537],[-31,-135],[-161,8],[-100,55],[-115,115],[-154,36],[-79,123]],[[61984,58430],[91,-106],[54,-238],[125,-241],[138,-2],[262,147],[302,68],[245,179],[138,38],[99,105],[158,20]],[[63596,58400],[-2,-9],[-1,-237],[0,-581],[0,-301],[-125,-353],[-194,-481]],[[63596,58400],[89,12],[128,85],[147,58],[132,198],[105,1],[6,-159],[-25,-335],[1,-303],[-59,-208],[-78,-622],[-134,-644],[-172,-735],[-238,-844],[-237,-645],[-327,-785],[-278,-467],[-415,-571],[-259,-438],[-304,-698],[-64,-304],[-63,-136]],[[34125,55269],[333,-115],[30,104],[225,41],[298,-155]],[[34889,54255],[109,-341],[-49,-248],[-24,-263],[-71,-242]],[[56266,80097],[-77,-150],[-55,-232]],[[53809,78032],[62,52]],[[56639,89841],[-478,-163],[-269,-401],[43,-353],[-441,-463],[-537,-495],[-202,-811],[198,-406],[265,-320],[-255,-649],[-289,-135],[-106,-967],[-157,-539],[-337,55],[-158,-456],[-321,-27],[-89,545],[-232,653],[-211,814]],[[58908,36434],[-56,-256],[-163,-62],[-166,312],[-2,199],[76,216],[26,168],[80,41],[140,-105]],[[59999,71781],[-26,440],[68,237]],[[60041,72458],[74,126],[75,127],[15,321],[91,-112],[306,160],[147,-108],[229,1],[320,217],[149,-10],[316,89]],[[50518,55366],[-224,-122]],[[78495,58847],[-249,265],[-238,-11],[41,452],[-245,-3],[-22,-633],[-150,-841],[-90,-509],[19,-417],[181,-18],[113,-526],[50,-498],[155,-330],[168,-67],[144,-299]],[[77801,55552],[-110,221],[-47,285],[-148,325],[-135,274],[-45,-339],[-53,320],[30,359],[82,553]],[[68841,73220],[156,583],[-60,429],[-204,137],[72,254],[232,-27],[132,318],[89,370],[371,134],[-58,-267],[40,-161],[114,15]],[[64978,73251],[-52,408],[40,602],[-216,195],[71,394],[-184,34],[61,485],[262,-141],[244,184],[-202,346],[-80,329],[-224,-147],[-28,-422],[-87,374]],[[65546,75618],[313,8],[-45,290],[237,199],[234,334],[374,-304],[30,-460],[106,-118],[301,27],[93,-105],[137,-593],[317,-398],[181,-271],[291,-282],[369,-247],[-7,-352]],[[84713,46708],[32,136],[239,129],[194,20],[87,72],[105,-72],[-102,-156],[-289,-252],[-233,-165]],[[32866,58026],[160,75],[58,-20],[-11,-430],[-232,-63],[-50,52],[81,158],[-6,228]],[[52339,73106],[302,232],[195,-69],[-9,-291],[236,212],[20,-111],[-139,-282],[-2,-266],[96,-143],[-36,-499],[-183,-289],[53,-314],[143,-10],[70,-274],[106,-90]],[[60041,72458],[-102,261],[105,217],[-169,-49],[-233,132],[-191,-331],[-421,-65],[-225,309],[-300,19],[-64,-238],[-192,-69],[-268,307],[-303,-11],[-165,573],[-203,320],[135,447],[-176,276],[308,550],[428,23],[117,438],[529,-76],[334,373],[324,163],[459,13],[485,-406],[399,-223],[323,89],[239,-52],[328,301]],[[57776,76021],[33,-222],[243,-186],[-51,-141],[-330,-32],[-118,-178],[-232,-310],[-87,268],[3,119]],[[83826,65878],[-167,-924],[-119,-472],[-146,486],[-32,427],[163,566],[223,436],[127,-172],[-49,-347]],[[60889,49136],[-128,-710],[16,-326],[178,-210],[8,-149],[-76,-348],[16,-175],[-18,-275],[97,-361],[115,-568],[101,-126]],[[59099,46514],[-157,172],[-177,97],[-111,97],[-116,146]],[[58449,51176],[98,69],[304,-7],[566,44]],[[60617,78955],[-222,-46],[-185,-187],[-260,-30],[-239,-215],[16,-358],[136,-139],[284,35],[-55,-206],[-304,-100],[-377,-333],[-154,117],[61,271],[-304,169],[50,110],[265,191],[-80,132],[-432,146],[-19,215],[-257,-71],[-103,-317],[-215,-426]],[[35174,32383],[-121,-362],[-313,-320],[-205,115],[-151,-62],[-256,247],[-189,-18],[-169,319]],[[6794,62819],[-41,-96],[-69,82],[8,161],[-46,210],[14,64],[48,94],[-19,113],[16,54],[21,-11],[107,-97],[49,-50],[45,-77],[71,-202],[-7,-32],[-108,-123],[-89,-90]],[[6645,63718],[-94,-41],[-47,121],[-32,47],[-3,36],[27,49],[99,-55],[73,-88],[-23,-69]],[[6456,64025],[-9,-63],[-149,17],[21,70],[137,-24]],[[6207,64108],[-15,-33],[-19,8],[-97,20],[-35,130],[-11,23],[74,80],[23,-37],[80,-191]],[[5737,64488],[-33,-57],[-93,105],[14,42],[43,57],[64,-13],[5,-134]],[[31350,77823],[48,-189],[-296,-279],[-286,-198],[-293,-171],[-147,-342],[-47,-129],[-3,-306],[92,-305],[115,-14],[-29,210],[83,-128],[-22,-165],[-188,-93],[-133,11],[-205,-100],[-121,-29],[-162,-28],[-231,-167],[408,108],[82,-109],[-389,-173],[-177,-1],[8,71],[-84,-160],[82,-26],[-60,-414],[-203,-443],[-20,148],[-61,30],[-91,144],[57,-310],[69,-103],[5,-217],[-89,-224],[-157,-460],[-25,23],[86,392],[-142,220],[-33,478],[-53,-249],[59,-365],[-183,90],[191,-185],[12,-548],[79,-40],[29,-199],[39,-577],[-176,-427],[-288,-171],[-182,-338],[-139,-37],[-141,-211],[-39,-193],[-305,-374],[-157,-274],[-131,-342],[-43,-409],[50,-400],[92,-492],[124,-408],[1,-249],[132,-668],[-9,-388],[-12,-224],[-69,-352],[-83,-73],[-137,70],[-44,253],[-105,132],[-148,496],[-129,440],[-42,225],[57,383],[-77,316],[-217,482],[-108,89],[-281,-262],[-49,29],[-135,269],[-174,142],[-314,-72],[-247,63],[-212,-39],[-114,-90],[50,-153],[-5,-234],[59,-113],[-53,-76],[-103,85],[-104,-109],[-202,17],[-207,305],[-242,-72],[-202,133],[-173,-40],[-234,-135],[-253,-427],[-276,-248],[-152,-275],[-63,-259],[-3,-397],[14,-277],[52,-196]],[[17464,70566],[-46,294],[-180,331],[-130,69],[-30,165],[-156,29],[-100,156],[-258,57],[-71,93],[-33,316],[-270,578],[-231,801],[10,133],[-123,190],[-215,483],[-38,469],[-148,315],[61,477],[-10,494],[-89,441],[109,543],[34,523],[33,522],[-50,773],[-88,492],[-80,268],[33,112],[402,-195],[148,-544],[69,152],[-45,472],[-94,473]],[[7498,84721],[-277,-219],[-142,148],[-43,270],[252,205],[148,88],[185,-39],[117,-179],[-240,-274]],[[4006,86330],[-171,-89],[-182,107],[-168,157],[274,98],[220,-52],[27,-221]],[[2297,88560],[171,-109],[173,59],[225,-152],[276,-77],[-23,-63],[-211,-121],[-211,125],[-106,104],[-245,-33],[-66,51],[17,216]],[[13740,83389],[-153,217],[-245,183],[-78,503],[-358,466],[-150,543],[-267,38],[-441,14],[-326,165],[-574,598],[-266,109],[-486,206],[-385,-49],[-546,264],[-330,246],[-309,-122],[58,-400],[-154,-37],[-321,-120],[-245,-195],[-308,-122],[-39,339],[125,565],[295,177],[-76,145],[-354,-321],[-190,-383],[-400,-410],[203,-280],[-262,-413],[-299,-241],[-278,-176],[-69,-255],[-434,-297],[-87,-271],[-325,-246],[-191,44],[-259,-160],[-282,-196],[-231,-193],[-477,-164],[-43,96],[304,270],[271,177],[296,315],[345,65],[137,236],[385,345],[62,115],[205,204],[48,437],[141,340],[-320,-175],[-90,99],[-150,-209],[-181,292],[-75,-207],[-104,287],[-278,-230],[-170,0],[-24,343],[50,211],[-179,205],[-361,-110],[-235,270],[-190,138],[-1,327],[-214,245],[108,331],[226,322],[99,295],[225,42],[191,-92],[224,278],[201,-50],[212,179],[-52,263],[-155,104],[205,222],[-170,-7],[-295,-125],[-85,-127],[-219,127],[-392,-65],[-407,138],[-117,232],[-351,334],[390,241],[620,282],[228,0],[-38,-288],[586,22],[-225,357],[-342,219],[-197,288],[-267,246],[-381,182],[155,302],[493,19],[350,262],[66,280],[284,274],[271,66],[526,256],[256,-39],[427,307],[421,-121],[201,-260],[123,112],[469,-35],[-16,-132],[425,-98],[283,57],[585,-182],[534,-54],[214,-75],[370,94],[421,-173],[302,-81]],[[30185,58611],[-8,-136],[-163,-67],[91,-262],[-3,-301],[-123,-334],[105,-457],[120,37],[62,417],[-86,202],[-14,436],[346,234],[-38,272],[97,181],[100,-404],[195,-10],[180,-321],[11,-190],[249,-6],[297,60],[159,-258],[213,-71],[155,180],[4,145],[344,34],[333,8],[-236,-170],[95,-272],[222,-43],[210,-283],[45,-462],[144,13],[109,-135]],[[80013,64241],[-371,-493],[-231,-544],[-61,-399],[212,-607],[260,-753],[252,-356],[169,-462],[127,-1066],[-37,-1013],[-232,-379],[-318,-371],[-227,-480],[-346,-536],[-101,369],[78,390],[-206,327]],[[96623,42347],[-92,-76],[-93,252],[10,155],[175,-331]],[[96418,43229],[45,-464],[-75,72],[-58,-31],[-39,159],[-6,441],[133,-177]],[[64752,61418],[-201,-154],[-54,-256],[-6,-196],[-277,-244],[-444,-268],[-249,-406],[-122,-32],[-83,34],[-163,-239],[-177,-111],[-233,-30],[-70,-33],[-61,-152],[-73,-42],[-43,-146],[-137,12],[-89,-78],[-192,30],[-72,336],[8,315],[-46,170],[-54,426],[-80,236],[56,28],[-29,264],[34,111],[-12,251]],[[58175,39107],[113,-6],[134,-97],[94,69],[148,-58]],[[59119,36429],[-70,-419],[-32,-479],[-72,-260],[-190,-290],[-54,-84],[-118,-292],[-77,-296],[-158,-413],[-314,-594],[-196,-345],[-210,-262],[-290,-224],[-141,-30],[-36,-160],[-169,85],[-138,-109],[-301,111],[-168,-71],[-115,31],[-286,-228],[-238,-91],[-171,-218],[-127,-13],[-117,205],[-94,10],[-120,258],[-13,-80],[-37,155],[2,337],[-90,386],[89,105],[-7,442],[-182,539],[-139,488],[-1,1],[-199,749]],[[58409,42899],[-210,-79],[-159,-230],[-33,-199],[-100,-46],[-241,-473],[-154,-373],[-94,-13],[-90,66],[-311,63]]],"transform":{"scale":[0.0036000360003600037,0.0017364686646866468],"translate":[-180,-90]}}
    , acplaces = {
      'Singapore':{
        name : 'Singapore',
        point: [1.352083,103.819836]      
      },
      'Sydney':{
        name : 'Sydney',
        point: [-33.8674869,151.2069902]      
      },
      'Tokyo':{
        name : 'Tokyo',
        point: [35.6894875,139.6917064]
      },
      'Frankfurt':{
        name:'Frankfurt',
        point:[50.1109221,8.6821267]
      },
      'Ireland':{
        name: 'Dublin',
        point: [53.3498053,-6.2603097]
      },
      'Sao Paulo':{
        name: 'Sao Paulo',
        point: [-23.5505199,-46.6333094]
      },
      'N. Virginia':{
        name: 'Ashburn, Virginia',
        point: [39.0437567,-77.4874416]
      },
      'N. California':{
        name: 'Palo Alto, California',
        point: [37.4418834,-122.1430195]
      },
      'Oregon':{
        name: 'Boardman, Oregon',
        point: [45.839855,-119.7005834]
      }
    }
    , names = []
    , types = ['value','lookup']
    , i = -1
    , j = 0
    , places = {};

  function Globe(element, data, parent) {
    var map =  [3,0,2,1]
    this.element = element;
    this.$element = $(element);
    this.parent = parent;
    this.data = data;

    $.each(acplaces, function(i,d){d.data = {lookups:null,value:null}; });
    $.each(data, function(i,d){
      if(typeof(d) == 'object'){
        var name = d.name.split(')')[0]
          , type = !!d.info.data[0].lookups ? 'lookup': 'value'

        if(!name.length) return;
        name = name.split('(')[1];

        if(name && name.length && acplaces[name]){
          places[name] = acplaces[name];
          places[name].data[type] = d;

          if(type=='lookup'){
            places[name].data[type].info.data[0].lookups =
              places[name].data[type].info.data[0].lookups.sort(function(a,b){return map[a[2]]-map[b[2]]});
            // places[name].data[type].info.data[0].lastvalueraw  = (Math.floor(Math.random() * 5) + 1) * 100;
          }
        }
      }
    });
    names = Object.getOwnPropertyNames(places)
    if(names.length === 0){
      places[' '] = {
          name: ' '
        , point: [0,0]
        , data:{
            lookups: null
          , value: null
        }
      };
      names.push(' ')
    }
    this.init(this);
  }

  Globe.prototype.init = function(me){
    var radius = Math.max($(me.parent).height(),$(me.parent).width()) / 2
      , projection = d3.geo.orthographic()
          .scale(radius>>1)
          .translate([radius>>1, radius>>1])
          .clipAngle(90)
      , title = $(me.parent).find('.globetitle')
      , canvas = d3.select(me.element).append("canvas")
          .attr("width", radius)
          .attr("height", radius)
          .style({"margin-left": (($(me.parent).width()-radius)>>1)+'px'})
      , context = canvas.node().getContext("2d")
      , path = d3.geo.path()
        .projection(projection)
        .context(context)
      , globe = {type: "Sphere"}
      , land = topojson.feature(world, world.objects.land)
      , countries = topojson.feature(world, world.objects.countries).features
      , borders = topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; })
      , m = types.length-1
      , n = names.length-1
      , colors = {"0": _Prtg.Colors.statusunknown, "1":_Prtg.Colors.statusup,"2":_Prtg.Colors.statusdown,"3":_Prtg.Colors.statuswarning}
      , color = function(d){
            return colors[d];
          }
      , duration = 1250//_Prtg.Options.refreshInterval*1000 / (n+2) / (m+2)
      , type = types[j]
      , r = radius * 0.08
      , arc = function(colour, start, end, dir){
          dir = !!dir;
          context.strokeStyle= color(colour), context.lineWidth=r/3, context.beginPath(), context.arc(radius>>1,radius>>1, r, start, end, dir), context.stroke(), context.closePath();
        }
      ;



    (function transition() {
      var o;
      d3.transition()
          .duration(duration)
          .each("start", function() {
            if(i+1 > n) {
              i = 0;
              j = j+1 > m ? 0 : j+1;
              type = types[j];
            }else
              ++i;
            o = places[names[i]];
          })
          .tween("rotate", function() {
            var p = o.point
              , r = d3.interpolate(projection.rotate(), [-p[1], -p[0]]);
            return function(t) {
              projection.rotate(r(t));
              context.clearRect(0, 0, radius, radius);
              context.strokeStyle = "#818285", context.fillStyle= "#818285", context.lineWidth = .5, context.beginPath(), path(globe), context.stroke(), context.fill() , context.closePath();
              context.fillStyle = "#606362", context.beginPath(), path(land), context.fill(), context.closePath();
              context.strokeStyle = "#fff", context.lineWidth = .3, context.beginPath(), path(borders), context.stroke() , context.closePath();
            };
          })
          .each("end", function(){
            if(type == 'lookup' && !!o.data.lookup){
              o.data.lookup.info.data[0].lookups.forEach(function(e,i,a){
                var angle = 2*Math.PI/ a.length
                  , start = 1.5*Math.PI
                  , gap = angle * .08;
                arc(e[2], start + angle*i +gap, start + angle*i+angle - gap);
                if(o.data.lookup.info.data[0].lastvalueraw >= e[0] && o.data.lookup.info.data[0].lastvalueraw <= e[3])
                  context.strokeStyle = 'black', context.lineCap = 'round', context.lineWidth=r*0.13, context.beginPath(), context.moveTo(radius>>1,radius>>1), context.lineTo(((Math.cos(start + angle*(i+.5)))*r*1.2 + (radius>>1)), ((Math.sin(start + angle*(i+.5)))*r*1.2 + (radius>>1))), context.stroke(), context.lineCap = 'butt', context.closePath();
              });
            }else if(o.data.value){
                var start = .7 * Math.PI
                  , end =   .3 * Math.PI
                  , data = o.data.value.info.data[0]
                  , part = 1.6 * Math.PI / (data.graphmaxraw-data.graphminraw)
                  , angle = start + part * data.lastvalueraw;
              if(data.lastvalueraw >= 0){
                arc("1", start, end);
                if(data.limitmaxwarning)
                  arc("3", start + part * data.limitmaxwarning, end);
                if(data.limitmaxerror)
                  arc("2", start + part * data.limitmaxerror, end);
                if(data.limitminwarning)
                  arc("3", start , start + part * data.limitminwarning);
                if(data.limitminerror)
                  arc("2", start , start + part * data.limitminerror);
              }else{
                arc("0", start, end);
              }
              context.strokeStyle = 'black', context.lineCap = 'round', context.lineWidth=r*0.13, context.beginPath(), context.moveTo(radius>>1,radius>>1), context.lineTo(((Math.cos(angle))*r*1.2 + (radius>>1)), ((Math.sin(angle))*r*1.2 + (radius>>1))), context.stroke(), context.lineCap = 'butt', context.closePath();
            }
              context.fillStyle = 'white', context.fillText(o.name, (radius>>1)+r*1.3, (radius>>1)+3);
          })
        .transition()
          .each("end", transition);
    })();
  };

  Globe.prototype.refresh = function(){

  };

 _Prtg.Plugins.registerPlugin(pluginName, Globe);
})(_Prtg, jQuery, window, document);

// _Prtg.LookupsDonut.js
(function($, window, document, undefined) {
  _Prtg.Graphixs = _Prtg.Graphixs || { "___": '_Prtg.Graphixs' };
  $.extend(true, _Prtg.Graphixs, {
    LookupsDonut: function LookupsDonut(placeholderName, configuration){
      var self = this;

      this.placeholderName = placeholderName;
      this.pointer = [
        {"x":0,"y":-0.8},
        {"x":0.04,"y":0.05},
        {"x":0.03,"y":0.1},
        {"x":-0.03,"y":0.1},
        {"x":-0.04,"y":0.05},
        {"x":0,"y":-0.8}
      ];

      this.configure = function(configuration)
      {
        this.config = configuration;

        this.config.count = configuration.lookups.length;
        this.config.size = this.config.size * 0.9;

        this.config.radius = (this.config.size * 0.97 / 2) *0.85;
        this.config.innerradius = this.config.radius * 0.66;
        this.config.cx = this.config.size / 2;
        this.config.cy = this.config.size / 2;
        this.config.greenColor 	= "status3";
        this.config.yellowColor = "status4";
        this.config.redColor 	= "status5";
        this.config.grayColor 	= "status0";
        this.config.colors
        this.config.squarert    = Math.ceil(Math.sqrt(this.config.lookups.length));
        this.config.square =  this.config.squarert*this.config.squarert;
        this.config.status = configuration.status;
        this.render = function(){};
        if(!this.config.lookups || this.config.lastvalueraw === undefined)
          return;
        else if(this.config.lookups[0][4]==3)
            this.render = this.renderBoolean;
        else if(this.config.lookups[0][4]==1)
          this.render = this.renderBitfield;
        else
          this.render = this.renderDonut;
      };
      this.renderBoolean = function(){
        var color = {"0": self.config.grayColor, "1":self.config.greenColor,"2":self.config.redColor,"3":self.config.yellowColor}
          , map = [3,0,2,1]
          , data = []
          , x = this.config.squarert
          , z = ~~(this.config.size*0.8 / this.config.squarert)
          , s = ~~(z/10)
          , html = '<div class="boolean gauge" style="width:'+self.config.size+'px;height:'+self.config.size+'px;"><div class="status">';

          this.config.lookups.forEach(function(d,i){
            if((''+self.config.lastvalue).toLowerCase() == d[1].toLowerCase())
              html += '<div class="current"';
            else
              html += '<div class="other"';
            html += ' title="'+d[1]+'""><div class="'+color[d[2]]+'" /></div>';
          });

          $(this.placeholderName).html(html
          // '<div class="boolean" style="width:'+self.config.size+'px;height:'+self.config.size+'px;">'
          //   +'<div class="status ' +(currentlookup[5]!==''?'expected':'unexpected')+ '">'
          //     +'<div class="unexpected" title="' +(currentlookup[5]==''?currentlookup[1]:otherlookup[1])+ '"><div style="background-color:'+color[(currentlookup[5]==''?currentlookup[2]:otherlookup[2])]+'" /></div>'
          //     +'<div class="expected" title="' +(currentlookup[5]!==''?currentlookup[1]:otherlookup[1])+ '"><div style="background-color:'+color[(currentlookup[5]==''?currentlookup[2]:otherlookup[2])]+'" /></div>'
            +'</div></div>'
          );
      };

      this.renderBitfield = function(value){
        var color = {"0": self.config.grayColor, "1":self.config.greenColor,"2":self.config.redColor,"3":self.config.yellowColor}
          , map = [3,0,2,1]
          , data = []
          , x = this.config.squarert
          , z = ~~(this.config.size*0.8 / this.config.squarert)
          , s = ~~(z/10) == 0 ? 1 : ~~(z/10)
          , svg = d3.select(this.placeholderName).append("svg")
              .attr({
                  class: "gauge",
                  width: this.config.size,
                  height:this.config.size
              })
              .append('g')
              .attr({
                transform: function(){return 'translate('+self.config.size * 0.1+','+self.config.size * 0.1+')';}
              });
        data.length = this.config.square;
        this.config.lookups.forEach(function(d,i){
            data[i] = {
                color: self.config.status === 7 ? color[0] : color[d[2]],
                title: d[1],
                on: (((self.config.lastvalueraw & +d[0]) > 0) || (self.config.lastvalueraw === 0 && +d[0] === 0))
              };
        });
        svg.selectAll('rect')
          .data(data)
          .enter()
          .append('rect')
            .attr({
              class: function(d) { return (!!d && d.color?d.color:null); },
              transform: function(d,i){return "translate(" + (i % x) * z + "," + ~~(i / x) * z + ")";},
              width: z-s,
              height: z-s,
              rx:~~(z/2),
              ry:~~(z/2),
              title: function(d){return (!!d && d.title) || "";}
            })
            .style({
                "fill-opacity": function(d) {return (!!d && d.color && d.color !== 'status0'?d.on?null:0:0);},
                "stroke-width": s
                // "fill": function(d) { return (!!d && d.color?d.color:null); },
                // "fill-opacity": function(d) { return (!!d && d.color?d.on?null:0.5:0); },
                // "stroke": function(d){return !!d && d.color?d.color:null;},
                // "stroke-width": s

              });
      };
      this.renderDonut = function(value){
        var color = {"0": self.config.grayColor, "1":self.config.greenColor,"2":self.config.redColor,"3":self.config.yellowColor}
          , map = [3,0,2,1]
          , data = {}
          , count = 0
          , acount = 0
          , gap = 0
          , arc = d3.svg.arc()
                .outerRadius(this.config.radius)
                .innerRadius(this.config.innerradius)
          , svg = d3.select(this.placeholderName).append("svg")
                .attr({
                    class: "gauge",
                    width: this.config.size,
                    height: this.config.size
                });
        this.config.lookups.forEach(function(e){
          if(!data.hasOwnProperty(e[2])){
            data[e[2]] = {
              lookups: [e]
            };
            ++count;
          }else{
            data[e[2]].lookups.push(e);
          }
        });

        var angle = null
          , pie = d3.layout.pie()
              .sort(function(a, b) {
                 return d3.ascending(map[a[2]], map[b[2]]) || d3.ascending(parseInt(a[0], 10), parseInt(b[0], 10));})
              .value(function(d) {return 1;})
          , a = svg.append("g")
              .attr("transform", "translate(" + this.config.cx + "," + this.config.cy + ")")
          , g = a.selectAll(".arc")
              .data(pie(self.config.lookups))
              .enter().append("g")
              .attr("class", "arc lookups");
        acount++;
        g.append("path")
            .attr("d", arc)
            .attr("class", function(d,i) {
              switch(d.data[4]){
                case "1":
                  if((self.config.lastvalueraw & d.data[0]) == d.data[0])
                      angle= (d.startAngle + d.endAngle) / 2;
                  break;
                case "2":
                  if(self.config.lastvalueraw >= d.data[0] && self.config.lastvalueraw <= d.data[3])
                      angle= (d.startAngle + d.endAngle) / 2;
                  break;
                default:
                  if((''+self.config.lastvalueraw) == d.data[0].toLowerCase())
                      angle= (d.startAngle + d.endAngle) / 2;
                  break;
                }
              return color[d.data[2]]; })
            .style("stroke","#f3f2f2")
            .style("stroke-width","2px")
            .append("svg:title")
            .text(function(d){return d.data[1];});

        if(!!angle)
          this.drawPointer(
            svg.append("svg:g")
              .attr("class", "pointerContainer")
              .attr("transform","translate(" + self.config.cx + "," + self.config.cy + ") rotate("+ (angle * 180 / Math.PI) +")")
              ,self.config.radius*1.3);
      };

      this.drawPointer = function(pointerContainer,radius)
      {
        pointerContainer.selectAll("path")
          .data([self.pointer])
          .enter()
            .append("svg:path")
                .attr("class", "needle")
                .attr("d", d3.svg.line()
                  .x(function(d) { return d.x*radius;})
                  .y(function(d) { return d.y*radius;})
                  .interpolate("basis")
                  );
      };

      this.configure(configuration);
    }
  });
})(jQuery,window,document);


(function ($) {
	var nodestates = ['none',
					'undefined',
					'collecting',
					'up',
					'warn',
					'down',
					'noprobe',
					'paused',
					'paused',
					'paused',
					'unusual',
					'paused',
					'paused',
					'downack',
					'partialdown'];
	function RemoteModel(options) {

		this.sensPerLine = 1;
		this.collapsedSensPerLine = 5;
		this.layout = '';
		this.filters = [];

		// private
		var opts,
		defaults = {
			objid: 'objid',
			level: 'probegroupdevice',
			ROOTID: 0,
			PRELOAD: 99999,
			TOTALCOUNT: 0,
			url: '/must/override',
			data: {
				start: 0,
				count: 0
			},
			postDataLoad: null,
			delay: 0
		},
    height,
		req = null, // ajax request
		lastTopRow = 0,
		lastBottom = 0,
		startLevel = 0,
		data = [],
		idxByObjId = {},
		nodes = {},
		rows = [],
		positions = [0],
		collapsed = {},
		dummyCell = $('<div class="slick-cell lr c0 treeColumn"/>'),
		refreshInProgress = false,
		self = this,
		treedepth = 0,

		onDataLoading = new Slick.Event(),
		onDataLoaded = new Slick.Event(),
		onHeightsChanged = new Slick.Event(),
		onPostDataLoaded = new Slick.Event(),
		onRowCountChanged = new Slick.Event(),

		opts = $.extend(true, {}, defaults, options),

		regObjects = /probe|group|device|sensor|library/,
		regRootObjects = /probe|group|device/,
		regParentObjects = /probe|group|library|device/,
		regLibObjectTypes = /filter|linked|node/,
		regPausedInfo = /paused/,
		regFixedInfo = /fixed/,
		regIsFavorite = /isfavorite/,
    regIsSmallProbe = /smallprobe/,
    regIsRemoteProbe = /remoteprobe/,
    regIsLocalProbe = /localprobe/,
    regIsPOD = /pod/,
		regTreeSizes = /tiny|small|medium|large/,
		regDisconnected = /disconnected/,
		regIsNotAutodiscoverable = /isnotautodiscoverable/,
		regIsAutonomous = /autonomous/;

    if(opts.hasOwnProperty('filters'))
      self.filters = opts.filters;

		function chaining() {
			var ret = [0],
				p = this.parent,
				sib;

			if (this.last)
				ret[0] = this.last._idx;

			while (!!p) {
				sib = p._siblings.last;
				if (!!sib)
					ret.unshift(sib._idx);
				else
					ret.unshift(0);
				p = p._siblings.parent;
			}
			return ret;
		}


		function updateSiblings(newData, prev) {
			var parent;
			newData._siblings = { parent: null, last: null, chain: chaining };
			newData._children = [];

			if (!!prev && newData._level > 1) {

				// deeper level
				if (newData._level > prev._level) {
					newData._siblings.parent = prev;
					newData._siblings.last = newData;
				//shallower level
				} else if (newData._level < prev._level) {
					parent = prev;
					while (!!parent._siblings.parent && parent._level !== newData._level) {
						parent = parent._siblings.parent;
					}
					if(!parent._nextSibling) parent._nextSibling = newData;
					newData._siblings = parent._siblings;
					newData._siblings.last = newData;
				//sames level
				} else {
					if(!prev._nextSibling) prev._nextSibling = newData;
					newData._siblings = prev._siblings;
					newData._siblings.last = newData;
				}

				parent = newData._siblings.parent;
				if (parent._children.length !== 0
				&& parent._classes.indexOf('haschildren') === -1)
					parent._classes.push('haschildren');
				parent._children.push(newData);
			}
		}
		function classify(d) {
			var paused = ($.inArray(d.status, [7, 8, 9, 11, 12]) !== -1)
				, pausedbyparent = paused && (regPausedInfo.test(d.info) === false); //&& (regPausedUntilInfo.test(d.info) === false);
			d._classes = null;
			d._classes = [];
			d._classes.push(d.basetype);

			regDisconnected.test(d.info) && d._classes.push('disconnected');
      regIsNotAutodiscoverable.test(d.info) && d._classes.push('isnotautodiscoverable');

      if(d.condition.indexOf('%') > -1) d._classes.push('autodisco');

			if (opts.treetype === 'library' && regObjects.test(d.basetype) === true)
				d._classes.push('librarymenu');
			if(!!d._parent && regRootObjects.test(d.basetype) === true)
				d._classes.push('fold-ignore');
			if(d.basetype === 'group' && d.groupnum + d.devicenum === 0){
				d._classes.push('notoggle');
				d._collapsed = false;
			}

			d._classes.push((d._collapsed ? 'collapsed' : 'expanded'));
			d._classes.push((regIsFavorite.test(d.favorite) === true ? 'isfavorite' : 'isnotfavorite'));

			if(regIsAutonomous.test(d.info) === true){
				d._classes.push('isautonomous');
				d._classes.push('isnotautodiscoverable');
			}

      if(regIsSmallProbe.test(d.info) === true){
        d._classes.push('smallprobe');
        d.smallprobe = true;
      }else if(regIsLocalProbe.test(d.info) === true){
        d._classes.push('localprobe');
      }else if(regIsRemoteProbe.test(d.info) === true){
        d._classes.push('remoteprobe');
      }
      if(regIsPOD.test(d.info) === true){
        d._classes.push('pod');
      }

			d._classes.push((
				paused
				? pausedbyparent
					? 'ispausedbyparent'
					: 'ispaused'
				: 'isnotpaused'));
			if (d[opts.level][d[opts.level].length - 2] === 2
				&& regFixedInfo.test(d.info) === true)
				d._classes.push('clusterprobedevice');
			if (regFixedInfo.test(d.info)) d._classes.push('fixed');
			if (d._access == 100) d._classes.push('readonlycontextmenu');
            if (d._access == 0) d._classes.push('noaccess noContextMenu');
			var p = d;
			while (!!p && p.basetype !== 'probe') {
				p = p._siblings.parent;
			}
			if (!!p && p.condition !== _Prtg.Lang.sensorTree.strings.Connected)
				d._classes.push('offline');

      if(d.basetype !== 'device'
      && d.basetype !== 'library'
      && d._collapsed)
        d._loaderrors = (d['downsens']+d['downacksens']+d['partialdownsens'] <= _Prtg.Core.objects['sensor'].collapseSensorsCount['downs'] ? d['downsens']+d['downacksens']+d['partialdownsens'] : 0);

		}

		function getAccessLevel(access) {
			if (access != null && access !== '') {
				return access
			}
			return 400
		}

		function updateNode(idx, newData, startLevel) {
			var d = data[idx];

			d._invalid = false;
			for (var i in newData) {
				if (newData.hasOwnProperty(i)) {
					if (!$.isArray(newData[i]) && d[i] !== newData[i]) {
						d._changed = true;
						d[i] = newData[i];
					}
				}
			}
			d.name = "" + newData.name;
			d._id = newData[opts.level].join('-');
			d._idx = idx;
			d._level = newData[opts.level].length - startLevel;
			d._access = getAccessLevel(newData.access);

			updateSiblings(d, data[idx-1]);
			classify(d);

			if (d.hasOwnProperty('leafs'))
				d._updateLeafs = (!!newData.totalsens || newData.leafs === null);
			else
				!!d.errors && delete d.errors
			return d._changed;
		}

		function createNode(idx, newData, startLevel) {
			var parent
				, parents = null;
			newData.name = "" + newData.name;
			newData._id = newData[opts.level].join('-');
			idxByObjId[newData._id] = idx;
			newData._idx = idx;
			newData._invalid = false;
			newData._changed = true;
			newData._level = newData[opts.level].length - startLevel;
			treedepth = Math.max(newData._level, treedepth);
			newData._probe = 0;
			newData._group = 0;
			newData._device = 0;
			newData._library = 0;
			newData._access = getAccessLevel(newData.access);
			newData._collapsed = !(!idx || newData._access < 100 || newData.fold === false);
			newData._updateLeafs = false;

			if(!newData.libkind){
				if (newData.basetype === 'device') {
					newData.leafs = [];
				}
				if (newData.hasOwnProperty('leafs')) {
					newData._updateLeafs = (!!newData.totalsens || newData.leafs === null);
				}
			}
			newData._sensorcount = sensorCount;
			newData.estimatedHeight = estimateHeight;
			newData._colSpan = colSpan;

			updateSiblings(newData, data[idx-1]);
			classify(newData);

			data[idx] = newData;

			parents = newData[opts.level].slice(0);
			parents.pop();
			while (parents.length > 1) {
				parent = data[idxByObjId[parents.join('-')]];
				if (!parent)
					break;
				parent['_' + newData.basetype] += 1;
				parents.pop();
			}

			return;
		}
		function initializeData(from, junk, update, content) {
			var d = junk[content || opts.data.content],
				i = 0,
				l = d.length,
				ret, id,
				change = false,
				rowcountchange = false;

			if (data.length === 0) {
				data.length = junk['treesize'];
        if(data.length)
				  opts.startlevel = startLevel = d[0][opts.level].length - 1;
			}

			if (!!update) {
				_expandTemporary();
				while (i < l) {
					id = d[i][opts.level].join('-');
					if (idxByObjId.hasOwnProperty(id)) {
						if (idxByObjId[id] !== i + from) {
							change = true;
							data.splice(i + from, 0, data.splice(idxByObjId[id], 1)[0]);
							change = (updateNode(i + from, d[i], startLevel) || change);
							_idxByObjId();
						} else {
							change = (updateNode(idxByObjId[id], d[i], startLevel) || change);
						}
					} else {
						data.splice(i + from, 0, -1);
						createNode(from + i, d.slice(i, i + 1)[0], startLevel);
						_idxByObjId();
						data[i + from].estimatedHeight();
						data[i + from]._invalid = false;

						rowcountchange = true;
						change = true;
					}
					++i;
				}
				for (i = 0; i < data.length; ) {
					if (data[i]._invalid) {
						data.splice(i, 1);
					} else {
						rows[i] = i;
						++i;
					}
				}
				rows.length = data.length;
				positions.length = rows.length + 1;
				_idxByObjId();
				_collapseTemporary();
			} else {
				while (i < l) {
					createNode(from + i, d.slice(i, i + 1)[0], startLevel);
					rows.push(from + i);
					++i;
				}
			}
			ret = {
				from: from,
				to: from + d.length,
				update: !!update,
				change: change,
				rowcountchange: rowcountchange,
				treeDepth: treedepth
			};
			return ret;
		};

		function loadLibrary(grid) {
			var dfd = $.Deferred();
			_loadLibrary()
			.done(
				function loadLibrarySuccess(d) {
					var junk = d['library'];

					data = [];
					treedepth = 0;
					idxByObjId = {};
					nodes = {};
					grid._rows = rows = [];
					grid._positions = positions = [0];
					collapsed = {};

					$.when.apply($,opts.initLibraryData(junk)).always(function(){
						dfd.resolve(initializeData(0, d, false, 'library'));
					});
				}).fail(function loadLibraryError() {
					dfd.reject();
				});
			return dfd;
		}

		function loadData(f, t, d, b, o, x) {
			var dfd = new $.Deferred(),
				settings = o || opts,
				update;
			if (!!req) {
				if (req.abortable) {
					req.abort();
					req = null;
				} else {
					dfd.reject();
					return dfd;
				}
			}
			f = f < 0 ? 0 : f;
			t = !!data.length && t >= data.length ? data.length - 1 : t;


			while (f < t && !!data[f] && !data[f]._invalid && ++f);
			while (t > f && !!data[t] && !data[t]._invalid && --t);
			update = !!data[f] && !!data[t];
			if (f > t || (update && !data[f]._invalid && !data[t]._invalid)) {
				dfd.reject();
				return dfd;
			}
			onDataLoading.notify({ from: f, to: t });
			settings.data.start = f;
			settings.data.count = '*'; // t - f + 1;
			req = $.ajax({
				type: settings.type || 'GET',
				dataType: settings.dataType || 'text json',
				url: settings.url,
				data: settings.data,
				traditional: settings.traditional || false,
				cache: settings.cache || false,
				beforeSend: function(jqXHR){
					jqXHR.peNumber = 'PE1234'
				}
			}).done(function loadDataSuccess(ret) {
				req = null;
				if (!!x)
					dfd.resolve(initializeData(f, x(ret), update, settings.data.content));
				else
					dfd.resolve(initializeData(f, ret, update, settings.data.content));
			}).fail(function loadDataError() {
				dfd.reject();
			});
			req.from = f;
			req.to = t;
			req.abortable = !!d;
			return dfd;
		}

		//CRUD
		function refresh(grid, invalidate) {
			var dfd = null
				, vp = grid.getViewport()
				, top = vp.top
				, bottom = vp.bottom
				,i,l;
			if (refreshInProgress) {
				return $.when({});
			}
			refreshInProgress = true;
			if (opts.treetype === 'library') {
				dfd = loadLibrary(grid).done(function (args) {
					if (!!args && opts.postDataLoad && !!args.change) {
						vp = grid.getViewport();
						if (!!args.rowcountchange) {
							onRowCountChanged.notify(args, null, grid)
						} else if (!!invalidate || vp.top !== top || vp.bottom !== bottom) {
							grid.invalidate();
						} else {
							var column = grid.getColumns()[grid.getColumnIndex('tree')]
							for (i = vp.top; i <= vp.bottom; ++i)
								grid.updateCell(i, 0);
						}
					}
					onDataLoaded.notify(args, null, grid);
					refreshInProgress = false;
					dfd.resolve(args);
				});
			} else {
				for (i = 0, l = data.length; i < l; ++i) {
					data[i]._invalid = true;
				}

				dfd = loadData(0, data.length - 1).done(function (args) {
					if (!!args && opts.postDataLoad && !!args.change) {
						vp = grid.getViewport();
						if (args.rowcountchange) {
							onRowCountChanged.notify(args, null, grid)
						} else if (!!invalidate || vp.top !== top || vp.bottom !== bottom) {
							grid.invalidate();
						} else {
							var column = grid.getColumns()[grid.getColumnIndex('tree')]
							for (i = vp.top; i <= vp.bottom; ++i)
								grid.updateCell(i, 0);
						}
					}
					refreshInProgress = false;
					dfd.resolve(args);
					onDataLoaded.notify(args, null, grid);
				});
			}
			return dfd.promise();
		}
		function refreshLeafs(grid) {
			var vp = grid.getViewport();
			return opts.postDataLoad(grid, vp.top, vp.bottom, data, rows, idxByObjId, onPostDataLoaded, (vp.top - lastTopRow) || (vp.bottom - lastBottom)).always(function () {
				lastTopRow = vp.top;
				lastBottom = vp.bottom
			});

		}

		function getItemByRow(row) {
			return data[row];
		}
		function getItemByIndex(idx) {
			if (!data || !data[idx]) return;
			var l = data.length,
				i = 0, c = 0;
			while (i < l && (i < idx || data[i]._collapsed))
				if (data[i++]._collapsed)
					++c;
			return data[idx + c];
		}
		function getData(){
			return data;
		}
		function getPositionById(id) {
			return idxByObjId[id];
		}
		// function setPosition(id, pos) {
		// 	return $.ajax({
		// 		type: 'POST',
		// 		url: '/api/setposition.htm',
		// 		data: {
		// 			id: id,
		// 			newpos: pos
		// 		}
		// 	});
		// }
		function _moveNode(srcidx, dstidx, where) {
			var src = data[srcidx]
				, dst = data[dstidx]
				, pos = dst.position || _position(dstidx)
				, request = null;
			if (regFixedInfo.test(src.info) === false
			&&	(/group|library/.test(dst.basetype) === true
			|| (_parentId(srcidx) !== _parentId(dstidx)
				&& !_isParent(dstidx, srcidx)))) {
				if (dst.basetype === 'device') {
					pos = (where === 'after' || (!where && srcidx < dstidx))
						? _position(dstidx) + 1
						: _position(dstidx) - 1;
					dst = _parentData(dstidx);
				} else if (dst.basetype === 'library') {
					if (dst.libkind === 'node') {
						pos = 1;
					} else {
						dst = _parentData(dstidx);
						pos = _position(dstidx) - 1;
					}
				} else {
					pos = (where === 'insert' || (!where && srcidx < dstidx))
						? 1
						: (
							dst = _parentData(dstidx),
							_position(dstidx) +(where==='before'?-1:+1)
						);
				}
				request = _Prtg.api.move(src.objid, dst.objid)
					.then(_Prtg.api.position(src[opts.objid], pos));
			} else {
				if (_isParent(dstidx, srcidx)) {
					pos = 1;
				} else {
					pos = (where === 'after' || (!where && srcidx < dstidx))
						? _position(dstidx) + 1
						: _position(dstidx) - 1;
				}
				request = _Prtg.api.position(src[opts.objid], pos);
			}
			return request;
		}
		function moveNode(grid, srcid, dstid, where) {
			var dfd = $.Deferred();
			$.when(
				_moveNode(srcid, dstid, where)
			).then(
				function success() {
					if(!!data[srcid].leafs) data[srcid]._updateLeafs=true;
					if(!!data[dstid].leafs) data[dstid]._updateLeafs=true;
					dfd.resolve();
				},
				function error() {
					dfd.reject();
				}
			);
			return dfd.promise();
		}
		function cloneNode(grid, srcidx, dstidx, where){
			var src = data[srcidx]
				, pos = (where === 'insert' && data[dstidx].basetype !== 'device')
						? 1
						: (
							 (where === 'after' || (!where && srcidx < dstidx))
								? _position(dstidx) + 1
								: _position(dstidx) - 1
						)
				, dst = (
							data[dstidx].basetype === 'device'
							? data[dstidx]._siblings.parent
							: data[dstidx]
					)
				, dfd = $.Deferred()
				, _data = {
					id: src.objid,
					targetid: dst.objid
				};
			_Prtg.Dialogs.defaultDialog("/controls/duplicatedevicedialog.htm", _data)
				.done(function(result, action) {
					_data = $.extend(_data, result);
					return $.ajax({
							url: action,
							type: "POST",
							data: _data,
							dataType: 'json'
					}).done(function(d) {
							_Prtg.api.position(parseInt(d,10), pos).always(function(){
								dfd.resolve();
							});
					});
				}).fail(function(){
					dfd.reject();
				});
			return dfd.promise();
		}
		function _moveLeafe(row, srcid, dstid) {
			var id = data[row].leafs[srcid].objid
				, pos = (dstid[0] + 1) * 10;
			pos = srcid < dstid[0]
				? pos + 1
				: (dstid[0]++, pos - 1);

			return _Prtg.api.position(id, pos);
		}
		function moveLeafe(grid, idx, srcid, dstid) {
			srcid = typeof(srcid) === 'number' ? [srcid] : srcid;
			dstid = [dstid];
			var deferreds  = $.map(srcid, function(srcid){return _moveLeafe(idx, srcid, dstid);});
			return $.when.apply($,
					deferreds
				).then(function success() {
						var row = $.inArray(idx, rows);
						data[idx]._updateLeafs = true;
						opts.postDataLoad.apply(this, [grid, row, row, data, rows, idxByObjId, onPostDataLoaded]);
					}, function fails(){}
				);
		}
		function _cloneLeaf(srcid, name, dstid, pos){
			return $.ajax({
				type:'POST',
				url: "duplicateobject.htm",
				data: {
					"id": srcid,// data[srcrow].leafs[srcid].objid,
					"targetid": dstid, //data[dstrow].objid,
					"name": name,// $("#duplicatesensorname").val(),
					"giveid": "1",
					"position": (pos  * 10 + 1)
				},
				dataType: "text"
			});
		}
		function cloneLeaf(grid, srcrow, dstrow, srcid, dstid) {
			var pos = (dstid + 1) * 10 + 1
				,	dfd = $.Deferred()
				,	tarid = data[dstrow].objid
				, deferreds  = $.map((typeof(srcid) === 'number' ? [srcid] : srcid), function(srcid){
					return _cloneLeaf(data[srcrow].leafs[srcid].objid, data[srcrow].leafs[srcid].name, tarid, dstid++);
				});
			return $.when.apply($,deferreds)
				.done(function success(response) {
					var row = $.inArray(dstrow, rows)
						, item = data[dstrow];
					item._updateLeafs = true;
					opts.postDataLoad.apply(this, [grid, row, row, data, rows, idxByObjId, {
						notify: function notifyMoveLeafe(ready) {
							$.each(nodestates, function (key, val) { item[val + 'sens'] = 0; });
							item.totalsens = 0;
							$.each(data[dstrow].leafs, function (e, i) {
								item[nodestates[i.status] + 'sens'] += 1;
								item.totalsens++;
							});
							onPostDataLoaded.notify(ready, null, grid);
						}}]);
				}).fail(function fail(){});
		}
		function createLeafe(newData) {
			var node = newData[opts.level].slice(0);
			node.pop();
			node = data[idxByObjId[node.join('-')]];
			node.leafs.push(newData);
		}
		function deleteData(idx) {
			idx = idxByObjId[idx] || idx;
			data.splice(data[idx], 1);
			_idxByObjId();
		}

		function updateData(idx, newData) {
			idx = idxByObjId[idx] || idx;
			updateNode(idx, newData, opts.startLevel);
		}

		function _loadLibrary() {
			return $.ajax($.extend(true, {
				data: {
					id: data[0].objid
				}
			}, _Prtg.Core.objects.library));
		}

		function _addLibrary(targetid, linkedid) {
			return $.ajax({
				type: 'GET',
				dataType: 'json',
				url: '/api/libraryname.json',
			}).then(function(ret){
        var nextname = '';
        if (linkedid === -1) {
          nextname =ret.groupname;
        } else {
          nextname =ret.nodename;
        }
        return $.ajax({
          type: 'POST',
          url: 'editsettings',
          dataType: 'json',
          data: {
            ajaxrequest: 1,
            objecttype: 'library',
            targetid: targetid,
            linkedid_: linkedid,
            name_: nextname,
            id: 'new',
            targeturl: ''
          }
        });
      });
		}
		function addLibrary(grid, targetid, objid, dstrow, initLibraryData) {
			return _addLibrary(targetid, objid)
				.then(function(d){return _Prtg.api.position(d.objid, 1)})
				.then(function(d){return refresh(grid,true)});
		}

		//Filter
		function toggleFilter(filterType) {
			var pos = $.inArray(filterType, self.filters);
			if (pos === -1)
				self.filters.push(filterType);
			else
				self.filters.splice(pos, 1);
			try {
				if(self.filters.length > 0)
					window.sessionStorage.setItem('sensorfilter', self.filters);
				else
					window.sessionStorage.removeItem('sensorfilter');
				} catch (e) { }
			for (var i = 0; i < data.length; ++i)
				data[i].estimatedHeight();
		}
		function Filter(){
			var filter = (self.filters.length === 0) || new RegExp(self.filters.join('|'));
			return filter;
		}
		function senscorCountDevice(item, filter) {
			var count = 0;
			$.each(_Prtg.Core.objects.sensor.sensorTypesValues, function (key, val) {
				if (filter === true || filter.test(key) === false) {
					count += item[key + 'sens'];
				}
			});
			return count+1;
		}
		function sensorCountCollapsed(item, filter) {
			var count = 0;
			$.each(_Prtg.Core.objects.sensor.sensorTypesValuesCollapsed, function (key, val) {
				if ($.isPlainObject(val)) {
					var sum = 0, sum2 = 0;
					$.each(val, function (k, v) {
						if (filter === true || filter.test(k) === false) {
							sum += item[k + 'sens'];
							sum2 += item[k + 'sens'] > 0 ? 1 : 0;
						}
					});
					if (sum > 0) {
						if (regParentObjects.test(item.basetype) === true
						&& sum <= _Prtg.Core.objects.sensor.collapseSensorsCount[key])
							count += sum;
						else
							count += sum2;
					}
				} else {
					if (filter === true || filter.test(key) === false)
						count += item[key + 'sens'] > 0 ? 1 : 0;
				}
			});
			return count;
		}

		function sensorCount(element) {
			var item = element || this
				, collapsed = self.layout === 'tiny'
				, filter = Filter();
			if (item.basetype === 'library') {
				if (item.libkind === 'filter') {
					if (item._collapsed || collapsed) {
						return sensorCountCollapsed(item, filter);
					} else {
						return senscorCountDevice(item, filter);
					}
				} else {
					if (item._collapsed || collapsed)
						return sensorCountCollapsed(item, filter);
					else
						return 0;
				}
			} else if (item._collapsed || collapsed) {
				return sensorCountCollapsed(item, filter);
			} else if (item.basetype === 'device') {
				return senscorCountDevice(item, filter);
			}
			return 0;
		}

		function foldObject(data) {
			$.ajax({
				type: 'POST',
				url: '/api/foldobject.htm',
				data: {
					id: data.objid,
					fold: data._collapsed ? 2 : 1
				},
				error: function(){}
			});
		}
		function toggleLocal(idx, grid){
			onRowCountChanged.notify(_toggle(idx), null, grid);
		}
		function toggle(idx, grid) {
			onRowCountChanged.notify(_toggle(idx), null, grid);
			foldObject(data[rows[idx]]);
		}
		function _toggle(idx) {
			idx = parseInt(idx);
			var from = idx,
				l = rows.length,
				count = 0,
				nrows = [],
				i = 0,
				collapse = { positions: [], rows: [] };
			idx = rows[idx];
			data[idx]._collapsed = !data[idx]._collapsed;
			classify(data[idx]);
			data[idx]._changed = true;
			data[idx].estimatedHeight();
			if (data[idx]._collapsed) {
				i = from;
				while (++i < l && _isChild(idx, rows[i])) {
					++count;
				}
			}

			if (!!collapsed[data[idx]._id]) {
				collapse = collapsed[data[idx]._id];
				count = collapse.rows.length;
				collapse.rows.unshift((from + 1), 0);
				collapse.positions.unshift((from + 1), 0);
				rows.splice.apply(rows, collapse.rows);
				positions.splice.apply(positions, collapse.positions);
				delete collapsed[data[idx]._id];
			} else if (count) {
				nrows.unshift(from + 1, count);
				collapse.rows = rows.splice.apply(rows, nrows);
				collapse.positions = positions.splice.apply(positions, nrows);
				collapsed[data[idx]._id] = collapse;
			}
			return { from: from, to: from + count };
		}

		function _doCollapsed(from, to, grid, silent) {

			while (to >= from) {
				var d = data[rows[to]];
				if (!!d && d._collapsed && !collapsed[d._id]) {
					d._collapsed = false;
					if (d._id !== data[0]._id)
						_toggle(to);
				}
				to--;
			}
			if (!silent)
				onRowCountChanged.notify({ from: from }, null, grid);
			return;
		}
		function _expandTemporary() {
			var collapse = null;
			for (var i = 0; i < rows.length; ++i) {
				if (collapsed.hasOwnProperty(data[rows[i]]._id)) {
					collapse = collapsed[data[rows[i]]._id];
					collapse.rows.unshift((i + 1), 0);
					collapse.positions.unshift((i + 1), 0);
					rows.splice.apply(rows, collapse.rows);
					positions.splice.apply(positions, collapse.positions);
					delete collapsed[data[rows[i]]._id];
				}
			}
		}

		function _collapseTemporary() {
			var to = rows.length - 1;
			while (to >= 0) {
				var d = data[rows[to]];
				if (!!d && d._collapsed && !collapsed[d._id]) {
					d._collapsed = false;
					if (/treemap|sunburst/.test(self.layout.toLowerCase())===true || d._id !== data[0]._id)
						_toggle(to);
				}
				to--;
			}
		}
		//
		function _position(idx) {
			var pidx = _parentId(idx),
				pos = 1;
			for (var i = pidx; i < idx; ++i)
				if (_parentId(i) === pidx)
					++pos;
			return pos * 10;
		}
		function _parentData(idx) {
			return data[_parentId(idx)];
		}
		function _parentId(idx) {
			var parents = data[idx][opts.level].slice(0);
			parents.pop();
			return idxByObjId[parents.join('-')];
		}
		function _isParent(parentIdx, childIdx) {
			if (!data[childIdx] || !data[parentIdx]) return false;
			var parents = data[childIdx][opts.level];
			return parents[parents.length - 2] === data[parentIdx][opts.objid];
		}
		function _isChild(parentIdx, childIdx) {
			if (!data[childIdx] || !data[parentIdx]) return false;
			var parentpath = data[parentIdx]._id + '-';
			return data[childIdx]._id.substr(0, parentpath.length) === parentpath;
		}
		function _lastChild(idx) {
			var i = idx;
			while (_isChild(idx, i)) ++i;
			return i;
		}
		function _lastSibling(idx) {
			var pidx = _parentId(idx),
				i = idx;
			level = data[i]._level;
			while (_isChild(pidx, i) && data[i]._level === level) ++i;
			return i - 1;
		}
		function _hasChildren(idx) {
			return _isChild(idx, idx + 1);
		}
		function _idxByObjId() {
			var i = 0, l = data.length;
			idxByObjId = {}
			if (!!l) {
				while (i < l) {
					idxByObjId[data[i]._id] = i;
					++i;
				}
			}
		}

		function _isCollapsed(idx) {
			if (!data[idx]) return false;
			var parents = data[idx][opts.level].slice(0),
				d;
			parents.pop();
			while (parents.length > 1) {
				d = data[idxByObjId[parents.join('-')]]
				if (d && !!d._collapsed)
					return true;
				parents.pop();
			}
			return false;
		}

		function _find(value, type, result) {
			var t = type,
				res = result
			req = $.ajax({
				global: false,
				url: '/api/search.htm',
				dataType: 'json',
				data: {
					output: 'json',
					columns: 'basetype,probegroupdevice=treejson,name,position',
					noraw: 1,
					maxcount: 9999,
					count: '*',
					sortby: 'probegroupdevice',
					searchtype: type,
					searchtext: value
				}
			}).done(function (dd) {
				dd['multiobj'] = $.merge(dd['multiobj'], res['multiobj']);
			}).fail(function (dd) {
				dd['multiobj'] = $.merge(dd['multiobj'] || [], res['multiobj']);
			});
			return req;

		}
		function find(value) {
			var pipe = null;
			$.each('probenode group device sensor'.split(' '), function (i, e) {
				var type = e;
				if (!!pipe) {
					pipe = pipe.pipe(
					function (d) { return _find(value, type, d); },
					function (d) { return _find(value, type, d); }
				);
				} else {
					pipe = _find(value, type, { multiobj: [] });
				}
			});
			return pipe;
		}
		function ensureVisible(idx, grid) {
			var obj = data[idx],
				coll = [];

			while (!!obj) {
				if (!!collapsed[obj._id] || obj._collapsed) {
					coll.unshift(obj._idx);
				}
				obj = obj._siblings.parent;
			}
			for (var i = 0; i < coll.length; ++i)
				onRowCountChanged.notify(_toggle($.inArray(coll[i], rows)), null, grid);
			return $.inArray(idx, rows);
		}

		function switchLayout(x) {
			if (self.layout !== x) {
				self.layout = x;
				opts.layout = x;
				for (var i = 0; i < data.length; ++i)
					data[i].estimatedHeight();
			}
		}
		function estimateHeight(sensCountDelta) {
			if(self.sensorHeights === true) return 0;
			var sensors = 0,
				libbasetypes = {filter:'device',node:'node',linked:'group'},
				sensPerLine = this._collapsed? self.collapsedSensPerLine:self.sensPerLine,
				clp = [0,self.sensorHeights.length-1],
				basetype = ('library' === this.basetype ? libbasetypes[this.libkind] : this.basetype);

			sensCountDelta = sensCountDelta || 0;

			if (this._collapsed  || 'device' === basetype) {
				sensors = sensorCount(this) + sensCountDelta;

				if('device' === basetype) {
                    sensors = sensorCount(this) + sensCountDelta+1;
				}

				if (sensors > 0) {
						height = Math.ceil(sensors / sensPerLine) * self.sensorHeights[clp[0+this._collapsed]][basetype];
                    	height +=  self.sensorHeights[clp[0+this._collapsed]]['margin'];
				} else {
						height = self.sensorHeights[1][basetype];
				}
			}
			else {
				height = self.sensorHeights[clp[0+this._collapsed]][basetype];
			}

			if(sensors===0 && (this.totalsens + this.groupnum + this.devicenum === 0) && this._access == 200)
				switch (this.basetype) {
					case 'group':
					case 'library':
          			case 'probe':
						height = (opts.editMode === false ? {tiny:50,small:50,medium:50,large:50}[self.layout] : height);
						break;
					case 'device':
						height = (opts.editMode === false ? {tiny:26,small:26,medium:26,large:42}[self.layout] : height);
                        height +=  self.sensorHeights[clp[0+this._collapsed]]['margin'];
						break;
					default:
						break;
				}

			this._estimatedHeight = height;
			this._changed = false;
			return this._estimatedHeight;
		}
		function colSpan(item) {
			var rowData = item || this,
			layout = self.layout !== 'tiny';
			return (!!rowData
					&& (
					(!!layout
						&& (rowData.basetype === 'device'
						|| rowData._sensorcount() > 0
						|| (rowData._collapsed && rowData.totalsens + rowData.groupnum + rowData.devicenum === 0))
					||
					(!layout
						&& (rowData.basetype === 'device'
						|| rowData._collapsed))
					)
					||
					(rowData.basetype === 'group'
					&& rowData._collapsed)
					||
					(rowData.basetype === 'library'
					&& (rowData.libkind === 'filter' || rowData._collapsed)))
					? 1 : opts.columns.length
      );
		}


		// slick grid functions
		function getSize() {
			return data.lenght;
		}
		function getLength() {
			return rows.length;
		}
		function getItem(idx) {
			return data[rows[idx]];
		}
		function getItemsByName(name){
			var ret=[];
			for(var i=0, l=data.length; i < l; ++i)
				if(data[i].name === name)
					ret.push(data[i]);
			return ret;
		}
		function setLeafs(d) {
			for (var i = 0, l = d.lengt; i < l; ++i) {
				node = d[i].probegroupdevice.slice(0);
				node.pop();
				node = data[idxByObjId[node.join('-')]];
				if (!!node._updateLeafs) {
					node.leafs = [];
					node._updateLeafs = false;
				}
				node.leafs.push(d[i]);
			}
		}

		return {

			// grid methods properties
			"getItem": getItem,
			"getLength": getLength,
			"getSize": getSize,
			"postDataLoad": null,

			// methods
			'collapse': _doCollapsed,
			'estimateHeight': estimateHeight,
			'find': find,
			'initializeData': initializeData,
			'isChild': _isChild,
			'isParent': _isParent,
			"lastChild": _lastChild,
			"loadData": loadData,
			"refreshLeafs": refreshLeafs,
			//			"reloadData": reloadData,
			'toggle': toggle,
			'toggleLocal': toggleLocal,

			//properties
			'treeDepth': function () { return treedepth },
			'dynPositions': positions,
			'layout': switchLayout,

			'toggleFilter': toggleFilter,
			'Filter': Filter,
			'Filters': function(){return self.filters;},
			'sensPerLine': function (x) { self.sensPerLine = x; },
            'collapsedSensPerLine': function (x) { self.collapsedSensPerLine = x; },
			'sensorHeights': function (heights) { self.sensorHeights = heights; },
			'visibleRows': rows,

			// CRUD methods
			"createNode": createNode,
			"deleteData": deleteData,
			"getItemByRow": getItemByRow,
			"getItemByIndex": getItemByIndex,
			"getItemsByName" : getItemsByName,
			"getPositionById": getPositionById,
			"Data": getData,
			"setLeafs": setLeafs,

			//"updateData": updateData,
			"refresh": refresh,
			// NODE Methods
			"addLibrary": addLibrary,
			"cloneLeaf": cloneLeaf,
			"cloneNode": cloneNode,
			"ensureVisible": ensureVisible,
			"moveLeafe": moveLeafe,
			"moveNode": moveNode,
			// events
			"onDataLoading": onDataLoading,
			"onDataLoaded": onDataLoaded,
			"onHeightsChanged": onHeightsChanged,
			"onPostDataLoaded": onPostDataLoaded,
			"onRowCountChanged": onRowCountChanged
		};
	}

	// Slick.Data.RemoteModel
	$.extend(true, window, { Slick: { Data: { RemoteModel: RemoteModel}} });
})(jQuery);

(function ($) {
	$.extend(true, window, {
		"Slick": {
			"DynamicRowHeight": DynamicRowHeight
		}
	});
  var h;
	function DynamicRowHeight(grid) {
		//		var _grid = grid,
		//			self._positions,
		//			self._heights,
		//			_dynamic = this;

		/// SlickGrid overrides
		function appendRowHtml(stringArray, row) {
			var d = getDataItem(row);
			var dataLoading = row < getDataLength() && !d;
			var cellCss;
			var rowCss = "slick-row " +
					(dataLoading ? " loading" : "") +
					(row % 2 == 1 ? ' odd' : ' even');
      var colspan;

      stringArray.push("<div class='" + rowCss + "' row='" + row + "' style='min-height:"+d._estimatedHeight + "px'><row>");

			for (var i = 0, cols = columns.length; i < cols; i++) {
				var m = columns[i];
				colspan = d._colSpan();  // TODO:  don't calc unless we have to
				if (colspan > 1) {
					cellCss = "slick-cell lr l" + i + " r" + Math.min(columns.length - 1, i + colspan - 1) + (m.cssClass ? " " + (typeof(m.cssClass)==="function"?m.cssClass(d):m.cssClass) : "");
				}
				else {
					cellCss = "slick-cell lr c" + i + (!!m.cssClass ? " " + (typeof(m.cssClass)==="function"?m.cssClass(d):m.cssClass) : "");
				}

				if (row === activeRow && i === activeCell) {
					cellCss += (" active");
				}

				// TODO:  merge them together in the setter
				for (var key in cellCssClasses) {
					if (cellCssClasses[key][row] && cellCssClasses[key][row][m.id]) {
						cellCss += (" " + cellCssClasses[key][row][m.id]);
					}
				}

				stringArray.push("<div class='" + cellCss + " children" + (d.groupnum +''+d.devicenum) + "'>");

				// if there is a corresponding row (if not, this is the Add New row or this data hasn't been loaded yet)
				if (d) {
					stringArray.push(getFormatter(row, m)(row, i, d[m.field], m, d));
				}

				stringArray.push("</div>");

				if (colspan)
					i += (colspan - 1);
			}

			stringArray.push("</row></div>");
		}

		function asyncPostProcessRows() {
			var i = postProcessFromRow;
			var j = postProcessToRow;
			var range = {}, haselements = false;
			while (i <= j) {
				var row = (scrollDir >= 0) ? i++ : j--,
								rowNode = rowsCache[row],
								d = getDataItem(row),
								l = !d || d.leafs;
				if (!rowNode || !d || row >= getDataLength()) { continue; }
				range[d.objid] = row;
				haselements = true;
			}
			if(haselements){
				self.asyncPostProcessRange(range);
			}
		}

		function asyncPostProcessRangeV0(range) {
			var asyncCols = [];
			var content = '';
			var fragment = document.createDocumentFragment();

			for (var i = 0, j = 0, l = columns.length; i < l; ++i) {
				var m = columns[i];
				if (m.asyncPostRender)
					break;
				++j;
			}

			$.each(range, function (idx, row) {
				var rowNode = rowsCache[row];
				if (!rowNode || row >= getDataLength()) {
					return //continue;
				}

				var d = getDataItem(row)
					, cellNodes = rowNode.firstChild.childNodes;
				if (cellNodes.length > j) {
					content = m.asyncPostRender(cellNodes[j], row, d, m); //, self.layout);
					if (content.length) {
						rowNode = fragment.appendChild(rowNode.cloneNode(true));
						cellNodes = rowNode.firstChild.childNodes;
						cellNodes[j].innerHTML = content;
						rowsCache[row].parentNode.replaceChild(rowNode, rowsCache[row]);
						rowsCache[row] = rowNode;
					}
				}
			});
			self.onRefreshLeafs.notify();
		}


		function asyncPostProcessRangeV1(range) {
			// var asyncCols = [];
			var content = '';
			var m = columns[1];
			var r = document.createRange();

			$.each(range, function (idx, row) {
				var rowNode = rowsCache[row];
				var sensors = null;
				var cellNodes = null;
				var fragment = null;
				var clone = null;

				if (!rowNode || !rowNode.firstChild || row >= getDataLength()) {
					return //continue;
				}
				sensors = rowNode.firstChild.childNodes[1];
				if (!!sensors){
					content = m.asyncPostRender(sensors, row, getDataItem(row), m);

					if (content.length) {
						fragment = r.createContextualFragment(content);
						sensors.replaceChild(fragment.firstChild, sensors.firstChild);
					}
				}
			});
			self.onRefreshLeafs.notify();
		}
		function cleanupRows(rangeToKeep) {
			for (var i in rowsCache) {
				if (((i = parseInt(i, 10)) < rangeToKeep.top || i > rangeToKeep.bottom)) {
					removeRowFromCache(i);
				}
			}
		}
		function createCssRules() {
			$style = $("<style type='text/css' rel='stylesheet' name="+$.now()+"/>").appendTo($("head"));
			var rules = [];
			for (var i = 0, x = 0, w=0; i < columns.length; i++) {
				w = parseInt(columns[i].width);
				if(!isNaN(w)){
          i===0 && rules.push(("." + uid + " .c" + i + ", ." + uid + " .treeItem {min-width: "+w+"px;}"));
          i!==0 && rules.push(("." + uid + " .c" + i + "{max-width: "+w+"px;}"));
          i!==0 && rules.push(("." + uid + ".large sensor{width: "+(w-10)+"px;}"));
					rules.push(("." + uid + " .r" + i + " { width:" + (x+w +(i===1?3:0)) + "px; }"));
					x += w;
				}
			}
			rules.push(("." + uid + " .l0 { width:" +x+3+ "px;}"));
			if ($style[0].styleSheet) { // IE
				$style[0].styleSheet.cssText = rules.join(" ");
			}
			else {
				$style[0].appendChild(document.createTextNode(rules.join(" ")));
			}

			var sheets = document.styleSheets;
			for (var i = 0; i < sheets.length; i++) {
				if ((sheets[i].ownerNode || sheets[i].owningElement) == $style[0]) {
					stylesheet = sheets[i];
					break;
				}
			}
		}
		function getCellFromPoint(x, y) {
			var row = Math.floor((y + offset) / options.rowHeight);
			var cell = 0;

			var w = 0;
			for (var i = 0; i < columns.length && w < x; i++) {
				w += columns[i].width;
				cell++;
			}

			if (cell < 0) {
				cell = 0;
			}

			return { row: row, cell: cell - 1 };
		} //TODO: new calculation needed
		function getCellNodeBox(row, cell) {
			if (!cellExists(row, cell))
				return null;

			var y1 = row * options.rowHeight - offset;
			var y2 = y1 + options.rowHeight - 1;
			var x1 = 0;
			for (var i = 0; i < cell; i++) {
				x1 += columns[i].width;
			}
			var x2 = x1 + columns[cell].width;

			return {
				top: y1,
				left: x1,
				bottom: y2,
				right: x2
			};
		} //TODO: new calculation needed
		function getCellFromNode(node) {
			// read column number from .l1 or .c1 CSS classes
			var cls = /l\d+/.exec(node.className) || /c\d+/.exec(node.className);
			if (!cls)
				throw "getCellFromNode: cannot get cell - " + node.className;
			return parseInt(cls[0].substr(1, cls[0].length - 1), 10);
		}

		function getCellFromEvent(e) {
			var $cell = $(e.target).closest(".slick-cell", $canvas);
			if (!$cell.length)
				return null;

			return {
				row: $cell.parent().parent().attr("row") | 0,
				cell: getCellFromNode($cell[0])
			};
		}
		function getCellNode(row, cell) {
			if (rowsCache[row]) {
				var cells = $(rowsCache[row].firstChild).children();
				var nodeCell;
				for (var i = 0; i < cells.length; i++) {
					nodeCell = getCellFromNode(cells[i]);
					if (nodeCell === cell) {
						return cells[i];
					}
					else if (nodeCell > cell) {
						return null;
					}

				}
			}
			return null;
		}

		function getColspan(rowData, layout) {
			return rowData._colSpan();
		}

		function getRenderedRange(visibleRange) {
			var range = !!visibleRange ? visibleRange : getVisibleRange(),
					buffer = _Prtg.Core.objects.deviceCache;

			range.top -= buffer;
			range.bottom += buffer;
			range.top = Math.max(0, range.top);
			range.bottom = Math.min(getDataLength() - 1, range.bottom);
			return range;
		}
		function getVisibleRange(viewportTop) {
			if (viewportTop == null)
				viewportTop = scrollTop;
			return self.getTopAndBottom(scrollTop + offset, scrollTop + offset + viewportH);
		}
		function render() {
			var visible, rendered, top, bottom, buffer;
			buffer = _Prtg.Core.objects.deviceCache / 4
			visible = getVisibleRange();
			rendered = getRenderedRange({top: visible.top, bottom: visible.bottom});
			if(!lastrenderedRows
			|| (visible.top - lastrenderedRows.top) < buffer
			|| (lastrenderedRows.bottom - visible.bottom) < buffer){
					// remove rows no longer in the viewport
					cleanupRows(rendered);

					// add new rows
					renderRows(rendered);

					lastrenderedRows = rendered;
					postProcessFromRow = visible.top;
					postProcessToRow = visible.bottom; //Math.min(options.enableAddRow ? getDataLength() : getDataLength() - 1, visible.bottom);
					startPostProcessing();

					lastRenderedScrollTop = scrollTop;
					h_render = null;
					self.onPostRender.notify();
			}
		}

		function renderRowsV0(range) {
			var i, l,
				parentNode = $canvas[0],
				rowsBefore = renderedRows,
				stringArray = [],
				rows = [],
				startTimestamp = new Date(),
				needToReselectCell = false;
			//			self.layout = !$(parentNode).closest('.slickTree').is('.tiny');
			for (i = range.top; i <= range.bottom; i++) {
				if (rowsCache[i]) { continue; }
				renderedRows++;
				rows.push(i);
				appendRowHtml(stringArray, i);
				if (activeCellNode && activeRow === i) {
					needToReselectCell = true;
				}
				counter_rows_rendered++;
			}
			var x = document.createElement("div");
			x.innerHTML = stringArray.join("");
			var insert = (scrollDir === -1) ? parentNode.childNodes.length > 1 ? parentNode.childNodes[1] : null : null;

			for (i = 0, l = x.childNodes.length; i < l; i++) {
				rowsCache[rows[i]] = parentNode.insertBefore(x.firstChild, insert);
			}

			updateRowPositions();

			if (needToReselectCell) {
				activeCellNode = getCellNode(activeRow, activeCell);
			}

			if (renderedRows - rowsBefore > 5) {
				avgRowRenderTime = (new Date() - startTimestamp) / (renderedRows - rowsBefore);
			}
		}

		function renderRowsV1(range) {
			var i, l,x,
				parentNode = $canvas[0],
				rows = [],
				needToReselectCell = false,
				nodes = [],
				stringArray = [],
				r = document.createRange(),
				insert = (scrollDir === -1) ? parentNode.childNodes.length > 1 ? parentNode.childNodes[1] : null : null;

			for (i = range.top; i <= range.bottom; i++) {
				if (!!rowsCache[i]) { continue; }
				stringArray = [];
				renderedRows++;
				rows.push(i);
				appendRowHtml(stringArray, i);
				x = r.createContextualFragment(stringArray.join(""));
				rowsCache[i] = parentNode.insertBefore(x.firstChild, insert);
				counter_rows_rendered++;
			}
			updateRowPositions();
		}

		function scrollRowIntoView(row, doPaging) {
			var rowAtTop = self._positions[row];
			scrollTo(rowAtTop);
			render();
			return;
			var rowAtBottom = !!self._positions[row + 1]
							? self._positions[row + 1] - viewportH + (viewportHasHScroll ? scrollbarDimensions.height : 0)
							: null;
			// need to page down?
			if (!!self._positions[row + 1] && self._positions[row + 1] > scrollTop + viewportH + offset) {
				scrollTo(doPaging ? rowAtTop : rowAtBottom);
				render();
			}

			// or page up?
			else if (self._positions[row] < scrollTop + offset) {
				scrollTo(doPaging ? rowAtBottom : rowAtTop);
				render();
			}
		}
		function updateRowCount() {
			var newRowCount = getDataLength() + (options.enableAddRow ? 1 : 0) + (options.leaveSpaceForNewRows ? numVisibleRows - 1 : 0);
			var oldH = h;
			// remove the rows that are now outside of the data range
			// this helps avoid redundant calls to .removeRow() when the size of the data decreased by thousands of rows
			var l = options.enableAddRow ? getDataLength() : getDataLength() - 1;
			for (var i in rowsCache) {
				if (i >= l) {
					removeRowFromCache(i);
				}
			}
			if (options.fullHeight) {
				self.fullHeight();
			}
			th = Math.max(self._positions[self._positions.length - 1], viewportH - scrollbarDimensions.height);
			if (th < maxSupportedCssHeight) {
				// just one page
				h = ph = th;
				n = 1;
				cj = 0;
			}
			else {
				// break into pages
				h = maxSupportedCssHeight;
				ph = h / 100;
				n = Math.floor(th / ph);
				cj = (th - h) / (n - 1);
			}

			if (h !== oldH && !options.fullHeight && h > 0) {
				$canvas.css("height", h);
				scrollTop = $viewport[0].scrollTop;
			}

			var oldScrollTopInRange = (scrollTop + offset <= th - viewportH);

			if (th === 0 || scrollTop === 0) {
				page = offset = 0;
			}
			else if (oldScrollTopInRange) {
				// maintain virtual position
				scrollTo(scrollTop + offset);
			}
			else {
				// scroll to bottom
				scrollTo(th - viewportH);
			}

			if (h != oldH && options.fullHeight) {
				self.fullHeight();
			}
		}
		function updateRowPositions() {
			var rows = $canvas[0].childNodes,
				row = !rows[1] || parseInt(rows[1].getAttribute('row'));
			if (row !== true)
				rows[0].style.height = (self._positions[row] - offset) + "px";

		}

		/// Local functions
		function resizeCanvas() {
			if (options.autoHeight) {
				viewportH = options.rowHeight * (getDataLength() + (options.enableAddRow ? 1 : 0) + (options.leaveSpaceForNewRows ? numVisibleRows - 1 : 0));
			}
			else {
				viewportH = getViewportHeight();
			}
			if (!!options.fullHeight) {
				self.fullHeight();
			}

			numVisibleRows = Math.ceil(viewportH / options.rowHeight);
			viewportW = parseFloat($.css($container[0], "width", true));

			// var w = 0, i = columns.length;
			// while (i--) {
			// 	w += columns[i].width;
			// }
			// setCanvasWidth(w);

			updateRowCount();
			render();
		}


		function updateCanvasHeight() {
			if (options.fullHeight) {
				self.fullHeight();
			}
			var oldH = h;
			th = Math.max(self._positions[self._positions.length - 1], viewportH - scrollbarDimensions.height);
			if (th < maxSupportedCssHeight) {
				// just one page
				h = ph = th;
				n = 1;
				cj = 0;
			}
			else {
				// break into pages
				h = maxSupportedCssHeight;
				ph = h / 100;
				n = Math.floor(th / ph);
				cj = (th - h) / (n - 1);
			}

			if (h !== oldH && !options.fullHeight && h > 0) {
				$canvas.css("height", h);
				scrollTop = $viewport[0].scrollTop;
			}

		}
		function getTopAndBottom(top, bottom) {
			var _positions = this._positions,
				l = getDataLength(),
				i = 0,
				ret = { top: -1, bottom: -1 };
			while (i < l && _positions[i + 1] < top) ++i;
			ret.top = i;
			while (i < l && _positions[i] < bottom) ++i;
			ret.bottom = i;
			return ret;
		}
		function calculatePositions(start, stop) {
			var d, i;
			stop = getDataLength();
			if (!start) start = 0;
			for (i = start; i < stop; ++i) {
				d = getDataItem(i);
				this._positions[i + 1] = this._positions[i] + d._estimatedHeight;
			}
			this.updateCanvasHeight();
		}

		function initializeHeights(start, stop, all) {
			var d, i;
			if (!stop || stop > getDataLength()) stop = getDataLength();
			if (!start) start = 0;
			this._positions[0] = 0;
			for (i = start; i < stop; ++i) {
				d = getDataItem(i);
				if (d._changed || all)
					this._positions[i + 1] = this._positions[i] + d.estimatedHeight();
				else
					this._positions[i + 1] = this._positions[i] + d._estimatedHeight;
			}
			this.calculatePositions(stop);
			return true;
		}
		function parentHeight(){
			var parentH = null;
			try{
				parentH =  window.innerHeight
								- self.footer.offsetHeight
								+ (self.buttons ? self.buttons.offsetHeight : 0)
							 	- ($viewport.parent().is('.libTree') ? ($viewport.offset().top) : 0);
			}catch(e){
				parentH = $viewport.parents('.map_object').height();
			}
			return parentH;
		}
		function fullHeight() {
			var parentH = this.parentHeight();
			viewportH = this._positions[self._positions.length - 1] + 4;
			viewportH = parentH - viewportH > 0 ? parentH : viewportH;
			viewportH = viewportH < 640 ? 640 : viewportH;
			return viewportH;
		}

		function init(grid) {
			var modernDom = !!document.createRange().createContextualFragment && !window.winGUI ;
			// SlickGrid overrides
			grid.eval("self._positions=[]");
			grid.eval("self._heights=[]");
			grid.eval("self._rows=[]");
			grid.eval("self.onRefreshLeafs = new Slick.Event()");
			grid.eval("self.onPostRender = new Slick.Event()");
			grid.eval("self.footer = document.getElementsByTagName('footer')");
			grid.eval("self.buttons = document.getElementById('sensortreelinks')");

			grid.eval("cleanupRows=" + cleanupRows.toString());
			grid.eval("createCssRules=" + createCssRules.toString());
			grid.eval("createCssRules()");
			grid.eval("appendRowHtml=" + appendRowHtml.toString());
			grid.eval("asyncPostProcessRows=" + asyncPostProcessRows.toString());
			grid.eval("getCellFromEvent=" + getCellFromEvent.toString());
			grid.eval("getCellFromNode=" + getCellFromNode.toString());
			grid.eval("getCellNode=" + getCellNode.toString());
			grid.eval("getColspan=" + getColspan.toString());
			grid.eval("getRenderedRange=" + getRenderedRange.toString());
			grid.eval("getVisibleRange=self.getViewport=" + getVisibleRange.toString());
			grid.eval("render=" + render.toString());
			grid.eval("self.parentHeight=" + parentHeight.toString());
			grid.eval("self.fullHeight=" + fullHeight.toString());
			grid.eval("renderRows=" + (modernDom ? renderRowsV1.toString() :renderRowsV0.toString()));
			grid.eval("self.scrollRowIntoView = scrollRowIntoView=" + scrollRowIntoView.toString());
			grid.eval("updateRowPositions=self.updateRowPositions=" + updateRowPositions.toString());
			grid.eval("updateRowCount=" + updateRowCount.toString());
			grid.eval("var calculatePositions = self.calculatePositions=" + calculatePositions.toString());
			grid.eval("var updateCanvasHeight = self.updateCanvasHeight=" + updateCanvasHeight.toString());

			// Local functions
			grid.eval("self.getTopAndBottom=" + getTopAndBottom.toString());
			grid.eval("var initializeHeights = self.initializeHeights=" + initializeHeights.toString() + ";");
			grid.eval("self.asyncPostProcessRange=" + (modernDom ? asyncPostProcessRangeV1.toString() : asyncPostProcessRangeV0.toString()));
		};
		//Plugin
		function destroy() { };
		$.extend(this, {
			"init": init,
			"destroy": destroy
		});
	}
})(jQuery);

// _Prtg.ObjectTree.Sunburst.Plugin.js
(function ( $, window, document, undefined ) {
	var pluginName = "sunburst";
	function Sunburst(element,data,parent){
		this.$element = $(element);
		this.data = data;
		if(!this.data.dataview){
			this.data.dataview = new Slick.Data.RemoteModel(this.data);
			if(!!data.options.filter){
				var self = this;
				$.each(data.options.filter,function(i,v){
					self.data.dataview.toggleFilter(v);
				});
			}
		}
		if(!!data.objects){
			this.data.dataview.initializeData(0, data.objects, false, 'sensorxref');
			this.$element.removeAttr('data-objects');
			this.initialRender = this.update;
		}
		this.parent = parent;
		this.layout = {};
		this.zoom = 1;
		this.init(this);
		this.initialRender();
	};
	Sunburst.prototype.initialRender = function dummy(){};

	Sunburst.prototype.init = function(me){
		var $self = me.$element
			, data = me.data;

			me.filter = data.dataview.Filters();
			me.offsetX = 0;
			me.offsetY = 0;
			me.sizePriority = me.getSize ('sunburstSizePriority');
			me.sizeSensors = me.getSize ('sunburstSizeSensors');
			me.partition = d3.layout.partition()
				.sort(function (a, b) { return a.name > b.name ? 1 : a.name < b.name ? -1 : 0; })
				.children(function (d) { return d._children.length > 0 ? $.grep(d._children, function(d){
					var ret = true;
					if(me.filter !== true && !!d && d.basetype === 'device')
						$.each(me.filter, function (i,e) {
							var sum = 0
								, types = _Prtg.Core.objects.group.sensorTypes.slice(0);
							$.each(types.splice(0,types.indexOf(e)+1), function(i,e){
							 sum += d[e+'sens'];
							});
							ret = ret && (sum === 0 || sum > d[e+'sens']);
						});
					return ret;
				}) : null; })
				.value(function (d) { return d.basetype === 'device' || /filter/.test(d.libkind) === true ? Math.pow((Math.log((me.sizeSensors ? d.totalsens + 2 : 4)) / Math.LN2), (me.sizePriority ? parseInt(d.priority) : 1)) : 1; });
      me.container = $self.find('.slick-viewport,#viewport').closest('.mapobjectpreviewcontainer').addBack().eq(0);
			me.vis = d3.select(me.container[0])
				.append("svg:svg")
				.attr({
								"version": 1.1,
      					"xmlns": "http://www.w3.org/2000/svg",
      					"xmlns:xmlns:xlink":"http://www.w3.org/1999/xlink",
								"class": 'sunburst d3'
							});
			me.arc = d3.svg.arc()
				.startAngle(function (d) { return d.x; })
				.endAngle(function (d) { return d.x + d.dx; })
				.innerRadius(function (d) { return d.sunburst.sqrtY; })
				.outerRadius(function (d) { return d.sunburst.arcwidth; });
			me.layout.element = $(me.vis[0]);
			me.layout.element
				.on('destroyed',function() {
					_Prtg.Plugins['groupviewsize'] ={init:function(){}};
				});

		if (!me.data.options.hideControls){
			_Prtg.Plugins['groupviewsize'].init = function(){me.groupviewsize.call(this,me)};
			_Prtg.Plugins['groupviewsize'].init.call($(me.data.options.controlsParent).find('.size-by-switch.control'));
		}

   _Prtg.Events.subscribe('resize.objecttree',$.proxy(me.refresh, me, true));

   me.$element.on('resize.objecttree', function(){
      $.proxy(me.refresh, me, true);
    });
  };

	Sunburst.prototype.groupviewsize = function(me){
		$(this)
			.addClass('show')
			.html($.jqote(_Prtg.Core.getObject('sensorTree').sunburst.template, [{sizePriority:me.sizePriority,sizeSensors:me.sizeSensors}]))
			.find("#sunburstSizePriority").click(function () {
					me.sizePriority = !me.sizePriority;
					try { ret = window.localStorage.setItem('sunburstSizePriority', me.sizePriority) } catch (e) { }
					me.update();
					return;
			})
			.end()
			.find("#sunburstSizeSensors").click(function () {
				me.sizeSensors = !me.sizeSensors;
				try { ret = window.localStorage.setItem('sunburstSizeSensors', me.sizeSensors) } catch (e) { }
				me.update();
				return;
			});
	};

	Sunburst.prototype.refresh = function(resize){
		this.startT = new Date().getTime();
		var me = this
      , $self = this.$element
			, data = this.data.dataview.Data()
			, svg = this.vis[0][0]
      , w = me.container.width()
      , h = me.container.height() //closest('#objecttreecontainer,#showalibrary').addBack().eq(0).height()
			, mwh = Math.min(w, h)
			, r = this.rr(mwh>>1)
			, id = $self.attr('id')
      , notZoomable = this.data.options.nozoom
      , filter = [];

    // w = h = Math.min(w,h)
		this.layout.element.detach().empty();
		this.filter = this.data.dataview.Filters();
    jQuery.each(_Prtg.Core.objects.group.sensorTypes, function(i, key){
      if(me.filter.indexOf(key) === -1)
        filter.push(key);
    });
    this.partition.size([2 * Math.PI, r*r]);
		this.vis.attr({
			'width':  w,
			'height': h
		});
    if(!!resize){
      this.zoom = 1;
		  this.translate = [w>>1,h>>1]
    }

		var sun_burst = this.vis.append("svg:g")
      .attr("transform", "translate("+me.translate+") scale("+me.zoom+")");

		if(!notZoomable && _Prtg.Core.objects.sunburstZoomDeviceCount < data[0].devicenum){
      var dragstart = [0,0];
      var dragging = false;
      var drag  = d3.behavior.drag()
        .on("dragstart", function(e){
          dragging = false
        })
        .on("drag", function(){
          if(dragging || Math.abs(d3.event.dx) > 3 || Math.abs(d3.event.dy) > 3){
            d3.event.sourceEvent.stopPropagation();
            dragging = true
            sun_burst.style("cursor", "move");
            me.translate = [d3.event.x,d3.event.y];
            sun_burst.attr("transform", "translate("+me.translate+") scale(" + me.zoom + ")");
          }
        })
        .on("dragend", function(){
          if(dragging){
            dragging = false;
            d3.event.sourceEvent.stopPropagation();
            sun_burst.style("cursor", "auto");
        }
        });
		  sun_burst
	      .call(d3.behavior.zoom().on("zoom", function(){
          d3.event.sourceEvent.stopPropagation();
	      	me.zoom = d3.event.scale;
	      	//me.translate = [(w>>1)+d3.event.translate[0],(h>>1)+d3.event.translate[1]];
          sun_burst.attr("transform", "translate("+me.translate+") scale(" + me.zoom + ")");
	      }));
        sun_burst.call(drag);
      var d = this.vis
	      .append("foreignObject")
	      	.attr('width','30')
	      	.attr('height','50')
	      	.append('xhtml:body')
	      	.append('div')
	      		.attr('id', 'Zoom_Sunburst')
	      		.attr('class','olControlZoom olControlNoSelect');
	      	d.append('a')
	      		.attr('class','olControlZoomIn olButton')
	      		.text('+');
	      	d.append('a')
	      		.attr('class','olControlZoomOut olButton')
	      		.text('-');
			  $(me.container)
	      	.off('click.zoom')
	      	.on('click.zoom','.olControlZoomOut',function(e){
            e.stopImmediatePropagation();
	      		me.zoom -= me.zoom  >= 0.2 ? 0.1 : 0;
            sun_burst.attr("transform", "translate("+me.translate+") scale(" + me.zoom + ")");
          })
	      	.on('click.zoom','.olControlZoomIn',function(e){
            e.stopImmediatePropagation();
	      		me.zoom += me.zoom  <= 3.0 ? 0.1 : 0;
            sun_burst.attr("transform", "translate("+me.translate+") scale(" + me.zoom + ")");
	      	});
		}

    var path = sun_burst
			.data(data)
			.selectAll("path")
			.data(this.partition.nodes)
			.enter()
			.append("svg:g")
			.each(this.stash)
			.attr("class", function (d) {
				var status = 'none';
				jQuery.each(filter, function (i,key) {
					if (d[key + 'sens'] > 0 ) {
						status = key;
						return false;
					}
				});
				return (!!d.parent ? (d.libkind||d.basetype) + ' ' + status : "uplink")  + (d.sunburst.radialtext ? ' radial':' noradial');
			})
			.attr('type', function(d){ return !!d.parent ? d.basetype : "uplink";});

		if( data[0].probegroupdevice.length > 1
		&& (data[0].probegroupdevice[0] !== -6
			|| data[0].probegroupdevice.length>2)){
			this.vis.selectAll('.uplink')
	      .append("a")
	      .attr("xlink:href", function(d){
	      		if(d.probegroupdevice[0] === -6
	      		&& d.basetype === 'library'){
	      			return '/library' + (d.probegroupdevice.length === 3 ? '' : 'object') +'.htm?id=' + (d.probegroupdevice.length>1 ? d.probegroupdevice[d.probegroupdevice.length-2] : d.probegroupdevice[1]);
	      		}
	      	return  '/' +  (d.probegroupdevice.length === 3 ? 'probenode' : 'group') + '.htm?id=' + (d.probegroupdevice.length>1 ? d.probegroupdevice[d.probegroupdevice.length-2] : 0);
	      })
				.append("svg:path")
	      .attr("class",'arc')
	      .attr("fill",'white')
				.attr("d", this.arc)
				.append("svg:title")
	      .text("Up");

			this.vis.selectAll('.uplink a')
				.insert("svg:g")
				.append('text')
			this.vis.selectAll('.uplink a text')
				.insert('tspan')
				.attr('rotate','90')
				.text(String.fromCharCode(8629))
				.append("svg:title")
	      .text("Up");
			this.vis.selectAll('.uplink a text')
				.insert('tspan')
				.attr('rotate','180')
				.text(' '+String.fromCharCode(168))
				.append("svg:title")
	      .text("Up");
	  }

	    this.vis.selectAll('.probe, .group, .device, .filter, .node, .linked')
			.append("a")
			.on("click", function() { window.top.location.href=$(this).attr('href'); return false; })
			.attr("xlink:href", function(d){return '/' +  (d.basetype === 'probe' ? 'probenode' : d.basetype) + '.htm?id=' + d.objid;})
			.attr('data-id', function (d) { return d.objid; })
			.append("svg:path")
			.attr({
						'id': function (d) { return id+'-' + d._id },
						'path': function (d) { return d._id },
						'data-id': function (d) { return d.objid; },
						'objid': function(d){return d.objid;},
						'class': function(d){return 'arc ' + d.basetype + 'menu';},
						'type': function(d){return d.basetype;},
						'fill': function (d,i) {
								var status = 'none';
								jQuery.each(filter, function (i,key) {
									if (d[key + 'sens'] > 0 ) {
										status = 'status' + key;
										return false;
									}
								});
							return _Prtg.Colors[status];
						},
						'stroke': '#fff',
						'popup': 3333,
						'd': this.arc
					})
					.append("svg:title")
			.text(function(d){return d.name})
			.insert('icon')
			.attr('style', function(d){return 'background-image:url('+_Prtg.Core.objects.icons.icon(d)+');'});

	    this.vis
			.selectAll('g.probe.radial a,g.group.radial a,g.filter.radial a,g.node.radial a,g.linked.radial a')
			.append("svg:text")
		    .attr('class', 'fadeinpath')
			.attr('dy', function (d) { return ((Math.sqrt(d.y + d.dy) - d.sunburst.sqrtY) / 2 + d.sunburst.fontsize / 1.8)})
			.attr("style", 'display:none')
			.style("font-size", function (d) { return d.sunburst.fontsize +'px'; })
			.insert('svg:textPath')
			.attr("text-anchor", "middle")
			.attr('startOffset', '20%')
			.attr('xlink:href', function (d) { return '#'+id+ '-' + d._id })
			.text(function (d) { return d.sunburst.tanellipsis; });

		this.vis
			.selectAll('g.device a,g.probe.noradial a,g.group.noradial a,g.filter.noradial a,g.node.noradial a,g.linked.noradial a')
			.insert("svg:g")
			.attr("transform", this.rotate)
			.append("svg:text")
			.attr("text-anchor", function(d){return d.sunburst.leftside ? "end" : "start"})
  			.attr("dy", "0.9ex")
			.style('font-size', function (d) { return d.sunburst.fontsize + 'px'; })
			.text(function (d) { return d.sunburst.radellipsis})
			.append("svg:title")
			.text(function(d){return d.name})
			.insert('icon')
			.attr('style', function(d){return 'background-image:url('+_Prtg.Core.objects.icons.icon(d)+');'});



		if($self.parents('#mapeditor').length){
			this.layout.element.find('.fadeinpath').show();
			this.asImage(svg, w, h);
		}else{
			$self.find('.slick-viewport, #viewport').append(this.layout.element);
			setTimeout(function(){
				me.layout.element.find('.fadeinpath').show();
				// console.log((new Date()).getTime()-me.startT);
			}, 100);
		}
	};
	Sunburst.prototype.asImage = function(svg, w, h){
		var s = new XMLSerializer()
			, arr = _Prtg.Util.strToUTF8Arr((svg.outerHTML || s.serializeToString(svg)))
			, image = new Image()
			, $self =  this.$element
			, me = this;

		image.width = w;
		image.height = h;
		image.onload = function() {
			if(navigator.userAgent.toLowerCase().indexOf('firefox') > -1)
			 	$self.find('.slick-viewport, #viewport').append(image);
			else{
			  var canvas = document.createElement('canvas');
			  canvas.width = w;
			  canvas.height = h;
			  var context = canvas.getContext('2d');
				context.drawImage(image,0,0);
				$self.find('.slick-viewport, #viewport').append(canvas);
				// console.log((new Date()).getTime()-me.startT);
			}
		};
		image.src = 'data:image/svg+xml;base64,' + _Prtg.Util.base64EncArr(arr);
	};
	Sunburst.prototype.update = function(data){
		var me = this;
		if(!!data && typeof(data) != "boolean")
			this.data.dataview.initializeData(0, data, false, 'sensorxref');
		return this.refresh(!data);
	};
	Sunburst.prototype.element = function(){
		return this.layout.element;
	};
	Sunburst.prototype.getSize = function (type) {
		var data = this.data
			, ret;
		if(data.options.hasOwnProperty(type))
			return data.options[type];
		try {
			ret = window.localStorage.getItem(type) === 'true'
		} catch (e) {
			ret = false;
		}
		ret = ret === null ? false : ret;
		return ret;
	};
	Sunburst.prototype.stash = function(d) {
		var arcwidth = Math.sqrt(d.y + d.dy * (d.basetype === 'device' ? 3 : 1))
			, sqrtY = Math.sqrt(d.y);
		d.sunburst = {
			'sqrtY':      sqrtY,
			'arcwidth':   arcwidth,
			'radialtext': ((arcwidth - sqrtY)*0.9 < sqrtY * d.dx)
		};
		d.sunburst.fontsize=Math.floor(Math.min(11, 11 * (d.sunburst.radialtext ? arcwidth - sqrtY : sqrtY * d.dx) / 11));
		d.sunburst.rotation=(d.x + d.dx / 2 - Math.PI / 2) / Math.PI * 180;
		d.sunburst.leftside = d.sunburst.rotation > 90 && d.sunburst.rotation < 270;
		d.sunburst.radellipsis=d.name.centerellipsis((arcwidth - sqrtY-6) / d.sunburst.fontsize * 1.5);
		d.sunburst.tanellipsis=d.name.centerellipsis(sqrtY * d.dx / d.sunburst.fontsize * 1.5);
	};
	Sunburst.prototype.rotate = function(d) {
		return "rotate(" + d.sunburst.rotation + ") "  +
			(d.sunburst.rotation > 90 && d.sunburst.rotation < 270
				? "matrix(-1 0 0 -1 0 0) translate(" + -(d.sunburst.sqrtY+3) + ")"
				: "translate(" + (d.sunburst.sqrtY+3) + ")");
	};
	Sunburst.prototype.rr = function(r){
		return r - r/this.data.dataview.treeDepth()*0.9;
	};

	$.fn[pluginName] = function(options, parent){
		return this.map(function() {
			var ret = $.data(this, "plugin_" + pluginName);
			if (!ret) {
				ret = new Sunburst(this, options, parent);
				$.data(this, "plugin_" + pluginName, ret);
			}
			return ret;
		});
	};
})(jQuery, window, document );

// _Prtg.ObjectTree.TreeMap.Plugin.js
(function($,window,document,undefined){
	var pluginName = "treemap";
	function TreeMap(element,data,parent){
		this.$element = $(element);
		this.data = data;
		if(!this.data.dataview){
			this.data.dataview = new Slick.Data.RemoteModel(this.data);
			if(!!data.options.filter){
				var self = this;
				$.each(data.options.filter,function(i,v){
					self.data.dataview.toggleFilter(v);
				});
			}
		}
		if(!!data.objects){
			this.data.dataview.initializeData(0, data.objects, false, 'sensorxref');
			this.$element.removeAttr('data-objects');
			this.initialRender = this.update;
		}
		this.parent = parent;
		this.layout = {};
		this.init(this);
		this.initialRender();
	};
	TreeMap.prototype.initialRender = function dummy(){};
	TreeMap.prototype.init = function(me){
		var $self = me.$element
			,	data = me.data;

		me.filter = data.dataview.Filters();
		me.sizePriority = me.getSize('treeMapSizePriority');
		me.sizeSensors = me.getSize('treeMapSizeSensors');
		me.treemap = d3.layout.treemap()
			.round(true)
			.sticky(false)
			.value(function (d) { return d.basetype === 'device' || /filter/.test(d.libkind) === true ? Math.pow((Math.log((me.sizeSensors ? d.totalsens + 2 : 4)) / Math.LN2), (me.sizePriority ? parseInt(d.priority) : 1)) : 1; })
			.sort(function (a, b) { return a._id < b._id ? 1 : a._id > b._id ? -1 : 0; })
			.children(function (d) { return d._children.length > 0 ? $.grep(d._children, function(d){
				var ret = true;
				if(me.filter !== true && !!d && d.basetype === 'device')
					$.each(me.filter, function (i,e) {
						var sum = 0
							, types = _Prtg.Core.objects.group.sensorTypes.slice(0);
						$.each(types.splice(0,types.indexOf(e)+1), function(i,e){
						 sum += d[e+'sens'];
						});
						ret = ret && (sum === 0 || sum > d[e+'sens']);
					});
				return ret;
			}) : null; });
    me.container = $self.find('.slick-viewport,#viewport').closest('.mapobjectpreviewcontainer').addBack().eq(0);
		me.div = d3.select(me.container[0])
			.append("div")
			.attr("class", "treemap d3");

			me.$element
				.on('destroyed',function() {
					_Prtg.Plugins['groupviewsize'] ={init:function(){}};
				});

		if (!me.data.options.hideControls){
			_Prtg.Plugins['groupviewsize'].init = function(){me.groupviewsize.call(this,me)};
			_Prtg.Plugins['groupviewsize'].init.call($(me.data.options.controlsParent).find('.size-by-switch.control'));
		}
		me.layout.element = $(me.div[0]);

	};

	TreeMap.prototype.groupviewsize = function(me){
		$(this)
			.addClass('show')
			.html($.jqote(_Prtg.Core.getObject('sensorTree').treemap.template, [{sizePriority:me.sizePriority,sizeSensors:me.sizeSensors}]))
			.find("#treemapSizePriority").click(function () {
					me.sizePriority = !me.sizePriority;
					try { ret = window.localStorage.setItem('treeMapSizePriority', me.sizePriority) } catch (e) { }
					me.update();
					return;
			})
			.end()
			.find("#treemapSizeSensors").click(function () {
				me.sizeSensors = !me.sizeSensors;
				try { ret = window.localStorage.setItem('treeMapSizeSensors', me.sizeSensors) } catch (e) { }
				me.update();
				return;
			});
	};

	TreeMap.prototype.refresh = function(){
		var $self = this.$element
			, data = this.data
      , div = this.div[0][0]
      , w = this.container.width()-2
      , h = this.container.closest('#objecttreecontainer').addBack().eq(0).height()-2
      , container = $self.find('.slick-viewport,#viewport');
		this.layout.element.detach().empty();
		this.treemap.size([w, h]);
		this.filter = this.data.dataview.Filters();
		this.div
			.attr('style','width:' +w+'px;height:' +h+ 'px;')
			.data(data.dataview.Data())
			.selectAll("div")
			.data(this.treemap.nodes)
			.enter()
      .append("div")
      .call(this.cell)
			.attr("class", function (d) {
				var status = 'none';
				jQuery.each(_Prtg.Core.objects.group.sensorTypes, function (i,key) {
					if (d[key + 'sens'] > 0) {
						status = key;
						return false;
					}
				});
				return "cell " + d.basetype + ' ' + (d.libkind||'') + ' ' + status;
			})
			.attr("path", function(d){ return d._id;})
      .attr("objid", function(d){return d.objid;})
			.attr("title", function (d) { return !!d._siblings.parent ? d._siblings.parent.name : null; })
			.html(function (d) { return(
        '<a id="'+d.objid+'" class="'+d.basetype+'menu" href="' + '/' +  (d.basetype === 'probe' ? 'probenode' : d.basetype) + '.htm?id=' + d.objid
        + '"" style="background-image:url(' + _Prtg.Core.objects.icons.icon(d) + ')">'
        + d.name
       + '</a>'
        );
      });

			container.append(this.layout.element);
	};
	TreeMap.prototype.update = function(data){
		var me = this;
    if(!!data && typeof(data) != "boolean")
      this.data.dataview.initializeData(0, data, false, 'sensorxref');
		// if(!!data)
		// 	this.data.dataview.initializeData(0, data, false, 'sensorxref');
		// _Prtg.Plugins['groupviewsize'].init = function(){me.groupviewsize.call(this,me)};
		// _Prtg.Plugins['groupviewsize'].init.call($(this.data.options.controlsParent).find('.size-by-switch.control'));
		return this.refresh();
	};
	TreeMap.prototype.element = function(){
		return this.layout.element;
	};

	TreeMap.prototype.cell = function cell() {
		this
		.style("left", function (d) { return d.x + 1 + "px"; })
		.style("top", function (d) { return d.y + 1 + "px"; })
		.style("width", function (d) { return (d.dx > 0 ? d.dx - 1 : 0) + "px"; })
		.style("height", function (d) { return (d.dy > 0 ? d.dy- 1 : 0) + "px"; });
	}

	TreeMap.prototype.getSize = function (type) {
		var data = this.data
			, ret;
		if(data.options.hasOwnProperty(type))
			return data.options[type];
		try {
			ret = window.localStorage.getItem(type) === 'true'
		} catch (e) {
			ret = false;
		}
		ret = ret === null ? false : ret;
		return ret;
	};
	$.fn[pluginName] = function(options, parent){
		return this.map(function() {
			var ret = $.data(this, "plugin_" + pluginName);
			if (!ret) {
				ret = new TreeMap(this, options, parent);
				$.data(this, "plugin_" + pluginName, ret);
			}
			return ret;
		});
	};
})(jQuery, window, document );

// new geomaps via openlayer
/*

  OpenLayers.js -- OpenLayers Map Viewer Library

  Copyright (c) 2006-2013 by OpenLayers Contributors
  Published under the 2-clause BSD license.
  See http://openlayers.org/dev/license.txt for the full text of the license, and http://openlayers.org/dev/authors.txt for full list of contributors.

  Includes compressed code under the following licenses:

  (For uncompressed versions of the code used, please see the
  OpenLayers Github repository: <https://github.com/openlayers/openlayers>)

*/

/**
 * Contains XMLHttpRequest.js <http://code.google.com/p/xmlhttprequest/>
 * Copyright 2007 Sergey Ilinsky (http://www.ilinsky.com)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 */

/**
 * OpenLayers.Util.pagePosition is based on Yahoo's getXY method, which is
 * Copyright (c) 2006, Yahoo! Inc.
 * All rights reserved.
 * 
 * Redistribution and use of this software in source and binary forms, with or
 * without modification, are permitted provided that the following conditions
 * are met:
 * 
 * * Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * 
 * * Neither the name of Yahoo! Inc. nor the names of its contributors may be
 *   used to endorse or promote products derived from this software without
 *   specific prior written permission of Yahoo! Inc.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE 
 * POSSIBILITY OF SUCH DAMAGE.
 */
var OpenLayers={VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function(){for(var a=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,b=document.getElementsByTagName("script"),c,d="",e=0,f=b.length;e<f;e++)if(c=b[e].getAttribute("src"))if(c=c.match(a)){d=c[1];break}return function(){return d}}(),ImgPath:""};OpenLayers.Class=function(){var a=arguments.length,b=arguments[0],c=arguments[a-1],d="function"==typeof c.initialize?c.initialize:function(){b.prototype.initialize.apply(this,arguments)};1<a?(a=[d,b].concat(Array.prototype.slice.call(arguments).slice(1,a-1),c),OpenLayers.inherit.apply(null,a)):d.prototype=c;return d};
OpenLayers.inherit=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;var d,e,c=2;for(d=arguments.length;c<d;c++)e=arguments[c],"function"===typeof e&&(e=e.prototype),OpenLayers.Util.extend(a.prototype,e)};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(a,b){a=a||{};if(b){for(var c in b){var d=b[c];void 0!==d&&(a[c]=d)}"function"==typeof window.Event&&b instanceof window.Event||(!b.hasOwnProperty||!b.hasOwnProperty("toString"))||(a.toString=b.toString)}return a};OpenLayers.String={startsWith:function(a,b){return 0==a.indexOf(b)},contains:function(a,b){return-1!=a.indexOf(b)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(a){a=a.split("-");for(var b=a[0],c=1,d=a.length;c<d;c++)var e=a[c],b=b+(e.charAt(0).toUpperCase()+e.substring(1));return b},format:function(a,b,c){b||(b=window);return a.replace(OpenLayers.String.tokenRegEx,function(a,e){for(var f,g=e.split(/\.+/),h=0;h<g.length;h++){0==h&&(f=b);if(void 0===f)break;
f=f[g[h]]}"function"==typeof f&&(f=c?f.apply(null,c):f());return"undefined"==typeof f?"undefined":f})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a,b){var c=a;!0===b&&(null!=a&&a.replace)&&(a=a.replace(/^\s*|\s*$/g,""));return OpenLayers.String.isNumeric(a)?parseFloat(a):c}};
OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,b){var c=0;0<b&&(c=parseFloat(a.toPrecision(b)));return c},format:function(a,b,c,d){b="undefined"!=typeof b?b:0;c="undefined"!=typeof c?c:OpenLayers.Number.thousandsSeparator;d="undefined"!=typeof d?d:OpenLayers.Number.decimalSeparator;null!=b&&(a=parseFloat(a.toFixed(b)));var e=a.toString().split(".");1==e.length&&null==b&&(b=0);a=e[0];if(c)for(var f=/(-?[0-9]+)([0-9]{3})/;f.test(a);)a=a.replace(f,"$1"+c+"$2");
0==b?b=a:(c=1<e.length?e[1]:"0",null!=b&&(c+=Array(b-c.length+1).join("0")),b=a+d+c);return b},zeroPad:function(a,b,c){for(a=a.toString(c||10);a.length<b;)a="0"+a;return a}};
OpenLayers.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}};
OpenLayers.Array={filter:function(a,b,c){var d=[];if(Array.prototype.filter)d=a.filter(b,c);else{var e=a.length;if("function"!=typeof b)throw new TypeError;for(var f=0;f<e;f++)if(f in a){var g=a[f];b.call(c,g,f,a)&&d.push(g)}}return d}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d){OpenLayers.Util.isArray(a)&&(d=a[3],c=a[2],b=a[1],a=a[0]);null!=a&&(this.left=OpenLayers.Util.toFloat(a));null!=b&&(this.bottom=OpenLayers.Util.toFloat(b));null!=c&&(this.right=OpenLayers.Util.toFloat(c));null!=d&&(this.top=OpenLayers.Util.toFloat(d))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(a){var b=!1;null!=
a&&(b=this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom);return b},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(a){return!0===a?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(a,b){null==a&&(a=6);var c=Math.pow(10,a),d=Math.round(this.left*c)/c,e=Math.round(this.bottom*c)/c,f=Math.round(this.right*c)/c,c=Math.round(this.top*c)/c;return!0===b?e+","+d+","+c+","+f:d+
","+e+","+f+","+c},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},
getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat},scale:function(a,b){null==b&&(b=this.getCenterLonLat());var c,d;"OpenLayers.LonLat"==b.CLASS_NAME?(c=b.lon,d=b.lat):(c=b.x,d=b.y);return new OpenLayers.Bounds((this.left-c)*a+c,(this.bottom-d)*a+d,(this.right-c)*a+c,(this.top-d)*a+
d)},add:function(a,b){if(null==a||null==b)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)},extend:function(a){if(a)switch(a.CLASS_NAME){case "OpenLayers.LonLat":this.extendXY(a.lon,a.lat);break;case "OpenLayers.Geometry.Point":this.extendXY(a.x,a.y);break;case "OpenLayers.Bounds":this.centerLonLat=null;if(null==this.left||a.left<this.left)this.left=a.left;if(null==this.bottom||a.bottom<this.bottom)this.bottom=
a.bottom;if(null==this.right||a.right>this.right)this.right=a.right;if(null==this.top||a.top>this.top)this.top=a.top}},extendXY:function(a,b){this.centerLonLat=null;if(null==this.left||a<this.left)this.left=a;if(null==this.bottom||b<this.bottom)this.bottom=b;if(null==this.right||a>this.right)this.right=a;if(null==this.top||b>this.top)this.top=b},containsLonLat:function(a,b){"boolean"===typeof b&&(b={inclusive:b});b=b||{};var c=this.contains(a.lon,a.lat,b.inclusive),d=b.worldBounds;d&&!c&&(c=d.getWidth(),
d=Math.round((a.lon-(d.left+d.right)/2)/c),c=this.containsLonLat({lon:a.lon-d*c,lat:a.lat},{inclusive:b.inclusive}));return c},containsPixel:function(a,b){return this.contains(a.x,a.y,b)},contains:function(a,b,c){null==c&&(c=!0);if(null==a||null==b)return!1;a=OpenLayers.Util.toFloat(a);b=OpenLayers.Util.toFloat(b);var d=!1;return d=c?a>=this.left&&a<=this.right&&b>=this.bottom&&b<=this.top:a>this.left&&a<this.right&&b>this.bottom&&b<this.top},intersectsBounds:function(a,b){"boolean"===typeof b&&(b=
{inclusive:b});b=b||{};if(b.worldBounds){var c=this.wrapDateLine(b.worldBounds);a=a.wrapDateLine(b.worldBounds)}else c=this;null==b.inclusive&&(b.inclusive=!0);var d=!1,e=c.left==a.right||c.right==a.left||c.top==a.bottom||c.bottom==a.top;if(b.inclusive||!e)var d=a.top>=c.bottom&&a.top<=c.top||c.top>a.bottom&&c.top<a.top,e=a.left>=c.left&&a.left<=c.right||c.left>=a.left&&c.left<=a.right,f=a.right>=c.left&&a.right<=c.right||c.right>=a.left&&c.right<=a.right,d=(a.bottom>=c.bottom&&a.bottom<=c.top||c.bottom>=
a.bottom&&c.bottom<=a.top||d)&&(e||f);if(b.worldBounds&&!d){var g=b.worldBounds,e=g.getWidth(),f=!g.containsBounds(c),g=!g.containsBounds(a);f&&!g?(a=a.add(-e,0),d=c.intersectsBounds(a,{inclusive:b.inclusive})):g&&!f&&(c=c.add(-e,0),d=a.intersectsBounds(c,{inclusive:b.inclusive}))}return d},containsBounds:function(a,b,c){null==b&&(b=!1);null==c&&(c=!0);var d=this.contains(a.left,a.bottom,c),e=this.contains(a.right,a.bottom,c),f=this.contains(a.left,a.top,c);a=this.contains(a.right,a.top,c);return b?
d||e||f||a:d&&e&&f&&a},determineQuadrant:function(a){var b="",c=this.getCenterLonLat(),b=b+(a.lat<c.lat?"b":"t");return b+=a.lon<c.lon?"l":"r"},transform:function(a,b){this.centerLonLat=null;var c=OpenLayers.Projection.transform({x:this.left,y:this.bottom},a,b),d=OpenLayers.Projection.transform({x:this.right,y:this.bottom},a,b),e=OpenLayers.Projection.transform({x:this.left,y:this.top},a,b),f=OpenLayers.Projection.transform({x:this.right,y:this.top},a,b);this.left=Math.min(c.x,e.x);this.bottom=Math.min(c.y,
d.y);this.right=Math.max(d.x,f.x);this.top=Math.max(e.y,f.y);return this},wrapDateLine:function(a,b){b=b||{};var c=b.leftTolerance||0,d=b.rightTolerance||0,e=this.clone();if(a){for(var f=a.getWidth();e.left<a.left&&e.right-d<=a.left;)e=e.add(f,0);for(;e.left+c>=a.right&&e.right>a.right;)e=e.add(-f,0);c=e.left+c;c<a.right&&(c>a.left&&e.right-d>a.right)&&(e=e.add(-f,0))}return e},CLASS_NAME:"OpenLayers.Bounds"});
OpenLayers.Bounds.fromString=function(a,b){var c=a.split(",");return OpenLayers.Bounds.fromArray(c,b)};OpenLayers.Bounds.fromArray=function(a,b){return!0===b?new OpenLayers.Bounds(a[1],a[0],a[3],a[2]):new OpenLayers.Bounds(a[0],a[1],a[2],a[3])};OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(a){var b;b=""+("t"==a.charAt(0)?"b":"t");return b+="l"==a.charAt(1)?"r":"l"};OpenLayers.Element={visible:function(a){return"none"!=OpenLayers.Util.getElement(a).style.display},toggle:function(){for(var a=0,b=arguments.length;a<b;a++){var c=OpenLayers.Util.getElement(arguments[a]),d=OpenLayers.Element.visible(c)?"none":"";c.style.display=d}},remove:function(a){a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a)},getHeight:function(a){a=OpenLayers.Util.getElement(a);return a.offsetHeight},hasClass:function(a,b){var c=a.className;return!!c&&RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},
addClass:function(a,b){OpenLayers.Element.hasClass(a,b)||(a.className+=(a.className?" ":"")+b);return a},removeClass:function(a,b){var c=a.className;c&&(a.className=OpenLayers.String.trim(c.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")));return a},toggleClass:function(a,b){OpenLayers.Element.hasClass(a,b)?OpenLayers.Element.removeClass(a,b):OpenLayers.Element.addClass(a,b);return a},getStyle:function(a,b){a=OpenLayers.Util.getElement(a);var c=null;if(a&&a.style){c=a.style[OpenLayers.String.camelize(b)];
c||(document.defaultView&&document.defaultView.getComputedStyle?c=(c=document.defaultView.getComputedStyle(a,null))?c.getPropertyValue(b):null:a.currentStyle&&(c=a.currentStyle[OpenLayers.String.camelize(b)]));var d=["left","top","right","bottom"];window.opera&&(-1!=OpenLayers.Util.indexOf(d,b)&&"static"==OpenLayers.Element.getStyle(a,"position"))&&(c="auto")}return"auto"==c?null:c}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(a,b){OpenLayers.Util.isArray(a)&&(b=a[1],a=a[0]);this.lon=OpenLayers.Util.toFloat(a);this.lat=OpenLayers.Util.toFloat(b)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(a,b){if(null==a||null==b)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+
OpenLayers.Util.toFloat(a),this.lat+OpenLayers.Util.toFloat(b))},equals:function(a){var b=!1;null!=a&&(b=this.lon==a.lon&&this.lat==a.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(a.lon)&&isNaN(a.lat));return b},transform:function(a,b){var c=OpenLayers.Projection.transform({x:this.lon,y:this.lat},a,b);this.lon=c.x;this.lat=c.y;return this},wrapDateLine:function(a){var b=this.clone();if(a){for(;b.lon<a.left;)b.lon+=a.getWidth();for(;b.lon>a.right;)b.lon-=a.getWidth()}return b},CLASS_NAME:"OpenLayers.LonLat"});
OpenLayers.LonLat.fromString=function(a){a=a.split(",");return new OpenLayers.LonLat(a[0],a[1])};OpenLayers.LonLat.fromArray=function(a){var b=OpenLayers.Util.isArray(a);return new OpenLayers.LonLat(b&&a[0],b&&a[1])};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=!1;null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y));return b},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},add:function(a,b){if(null==a||null==b)throw new TypeError("Pixel.add cannot receive null values");
return new OpenLayers.Pixel(this.x+a,this.y+b)},offset:function(a){var b=this.clone();a&&(b=this.add(a.x,a.y));return b},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(a){var b=!1;null!=a&&(b=this.w==a.w&&this.h==a.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(a.w)&&isNaN(a.h));return b},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};
(function(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;b<c;++b)if(-1!=a[b].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}})();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code},setCode:function(a){var b;a||(a="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);a=a.split("-");a[0]=a[0].toLowerCase();"object"==typeof OpenLayers.Lang[a[0]]&&(b=a[0]);if(a[1]){var c=a[0]+"-"+a[1].toUpperCase();"object"==typeof OpenLayers.Lang[c]&&(b=c)}b||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+a.join("-")+" dictionary, falling back to default language"),
b=OpenLayers.Lang.defaultCode);OpenLayers.Lang.code=b},translate:function(a,b){var c=OpenLayers.Lang[OpenLayers.Lang.getCode()];(c=c&&c[a])||(c=a);b&&(c=OpenLayers.String.format(c,b));return c}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var a=[],b=0,c=arguments.length;b<c;b++){var d=arguments[b];"string"==typeof d&&(d=document.getElementById(d));if(1==arguments.length)return d;a.push(d)}return a};OpenLayers.Util.isElement=function(a){return!(!a||1!==a.nodeType)};OpenLayers.Util.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};OpenLayers.Util.removeItem=function(a,b){for(var c=a.length-1;0<=c;c--)a[c]==b&&a.splice(c,1);return a};
OpenLayers.Util.indexOf=function(a,b){if("function"==typeof a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1};OpenLayers.Util.dotless=/\./g;
OpenLayers.Util.modifyDOMElement=function(a,b,c,d,e,f,g,h){b&&(a.id=b.replace(OpenLayers.Util.dotless,"_"));c&&(a.style.left=c.x+"px",a.style.top=c.y+"px");d&&(a.style.width=d.w+"px",a.style.height=d.h+"px");e&&(a.style.position=e);f&&(a.style.border=f);g&&(a.style.overflow=g);0<=parseFloat(h)&&1>parseFloat(h)?(a.style.filter="alpha(opacity="+100*h+")",a.style.opacity=h):1==parseFloat(h)&&(a.style.filter="",a.style.opacity="")};
OpenLayers.Util.createDiv=function(a,b,c,d,e,f,g,h){var k=document.createElement("div");d&&(k.style.backgroundImage="url("+d+")");a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv"));e||(e="absolute");OpenLayers.Util.modifyDOMElement(k,a,b,c,e,f,g,h);return k};
OpenLayers.Util.createImage=function(a,b,c,d,e,f,g,h){var k=document.createElement("img");a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv"));e||(e="relative");OpenLayers.Util.modifyDOMElement(k,a,b,c,e,f,null,g);h&&(k.style.display="none",b=function(){k.style.display="";OpenLayers.Event.stopObservingElement(k)},OpenLayers.Event.observe(k,"load",b),OpenLayers.Event.observe(k,"error",b));k.style.alt=a;k.galleryImg="no";d&&(k.src=d);return k};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;
OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var a=navigator.appVersion.split("MSIE"),a=parseFloat(a[1]),b=!1;try{b=!!document.body.filters}catch(c){}OpenLayers.Util.alphaHackNeeded=b&&5.5<=a&&7>a}return OpenLayers.Util.alphaHackNeeded};
OpenLayers.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,k){OpenLayers.Util.modifyDOMElement(a,b,c,d,f,null,null,k);b=a.childNodes[0];e&&(b.src=e);OpenLayers.Util.modifyDOMElement(b,a.id+"_innerImage",null,d,"relative",g);OpenLayers.Util.alphaHack()&&("none"!=a.style.display&&(a.style.display="inline-block"),null==h&&(h="scale"),a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b.src+"', sizingMethod='"+h+"')",0<=parseFloat(a.style.opacity)&&1>parseFloat(a.style.opacity)&&
(a.style.filter+=" alpha(opacity="+100*a.style.opacity+")"),b.style.filter="alpha(opacity=0)")};OpenLayers.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,k){var l=OpenLayers.Util.createDiv();k=OpenLayers.Util.createImage(null,null,null,null,null,null,null,k);k.className="olAlphaImg";l.appendChild(k);OpenLayers.Util.modifyAlphaImageDiv(l,a,b,c,d,e,f,g,h);return l};OpenLayers.Util.upperCaseObject=function(a){var b={},c;for(c in a)b[c.toUpperCase()]=a[c];return b};
OpenLayers.Util.applyDefaults=function(a,b){a=a||{};var c="function"==typeof window.Event&&b instanceof window.Event,d;for(d in b)if(void 0===a[d]||!c&&b.hasOwnProperty&&b.hasOwnProperty(d)&&!a.hasOwnProperty(d))a[d]=b[d];!c&&(b&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&!a.hasOwnProperty("toString"))&&(a.toString=b.toString);return a};
OpenLayers.Util.getParameterString=function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d&&"function"!=typeof d){if("object"==typeof d&&d.constructor==Array){for(var e=[],f,g=0,h=d.length;g<h;g++)f=d[g],e.push(encodeURIComponent(null===f||void 0===f?"":f));d=e.join(",")}else d=encodeURIComponent(d);b.push(encodeURIComponent(c)+"="+d)}}return b.join("&")};OpenLayers.Util.urlAppend=function(a,b){var c=a;if(b)var d=(a+" ").split(/[?&]/),c=c+(" "===d.pop()?b:d.length?"&"+b:"?"+b);return c};
OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(a){return OpenLayers.Util.getImagesLocation()+a};OpenLayers.Util.Try=function(){for(var a=null,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a};
OpenLayers.Util.getXmlNodeValue=function(a){var b=null;OpenLayers.Util.Try(function(){b=a.text;b||(b=a.textContent);b||(b=a.firstChild.nodeValue)},function(){b=a.textContent});return b};OpenLayers.Util.mouseLeft=function(a,b){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;c!=b&&null!=c;)c=c.parentNode;return c!=b};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(a,b){null==b&&(b=OpenLayers.Util.DEFAULT_PRECISION);"number"!==typeof a&&(a=parseFloat(a));return 0===b?a:parseFloat(a.toPrecision(b))};
OpenLayers.Util.rad=function(a){return a*Math.PI/180};OpenLayers.Util.deg=function(a){return 180*a/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};
OpenLayers.Util.distVincenty=function(a,b){for(var c=OpenLayers.Util.VincentyConstants,d=c.a,e=c.b,c=c.f,f=OpenLayers.Util.rad(b.lon-a.lon),g=Math.atan((1-c)*Math.tan(OpenLayers.Util.rad(a.lat))),h=Math.atan((1-c)*Math.tan(OpenLayers.Util.rad(b.lat))),k=Math.sin(g),g=Math.cos(g),l=Math.sin(h),h=Math.cos(h),m=f,n=2*Math.PI,p=20;1E-12<Math.abs(m-n)&&0<--p;){var q=Math.sin(m),r=Math.cos(m),s=Math.sqrt(h*q*h*q+(g*l-k*h*r)*(g*l-k*h*r));if(0==s)return 0;var r=k*l+g*h*r,t=Math.atan2(s,r),u=Math.asin(g*h*
q/s),v=Math.cos(u)*Math.cos(u),q=r-2*k*l/v,w=c/16*v*(4+c*(4-3*v)),n=m,m=f+(1-w)*c*Math.sin(u)*(t+w*s*(q+w*r*(-1+2*q*q)))}if(0==p)return NaN;d=v*(d*d-e*e)/(e*e);c=d/1024*(256+d*(-128+d*(74-47*d)));return(e*(1+d/16384*(4096+d*(-768+d*(320-175*d))))*(t-c*s*(q+c/4*(r*(-1+2*q*q)-c/6*q*(-3+4*s*s)*(-3+4*q*q))))).toFixed(3)/1E3};
OpenLayers.Util.destinationVincenty=function(a,b,c){var d=OpenLayers.Util,e=d.VincentyConstants,f=e.a,g=e.b,h=e.f,e=a.lon;a=a.lat;var k=d.rad(b);b=Math.sin(k);k=Math.cos(k);a=(1-h)*Math.tan(d.rad(a));var l=1/Math.sqrt(1+a*a),m=a*l,n=Math.atan2(a,k);a=l*b;for(var p=1-a*a,f=p*(f*f-g*g)/(g*g),q=1+f/16384*(4096+f*(-768+f*(320-175*f))),r=f/1024*(256+f*(-128+f*(74-47*f))),f=c/(g*q),s=2*Math.PI;1E-12<Math.abs(f-s);)var t=Math.cos(2*n+f),u=Math.sin(f),v=Math.cos(f),w=r*u*(t+r/4*(v*(-1+2*t*t)-r/6*t*(-3+4*
u*u)*(-3+4*t*t))),s=f,f=c/(g*q)+w;c=m*u-l*v*k;g=Math.atan2(m*v+l*u*k,(1-h)*Math.sqrt(a*a+c*c));b=Math.atan2(u*b,l*v-m*u*k);k=h/16*p*(4+h*(4-3*p));t=b-(1-k)*h*a*(f+k*u*(t+k*v*(-1+2*t*t)));Math.atan2(a,-c);return new OpenLayers.LonLat(e+d.deg(t),d.deg(g))};
OpenLayers.Util.getParameters=function(a,b){b=b||{};a=null===a||void 0===a?window.location.href:a;var c="";if(OpenLayers.String.contains(a,"?"))var d=a.indexOf("?")+1,c=OpenLayers.String.contains(a,"#")?a.indexOf("#"):a.length,c=a.substring(d,c);for(var d={},c=c.split(/[&;]/),e=0,f=c.length;e<f;++e){var g=c[e].split("=");if(g[0]){var h=g[0];try{h=decodeURIComponent(h)}catch(k){h=unescape(h)}g=(g[1]||"").replace(/\+/g," ");try{g=decodeURIComponent(g)}catch(l){g=unescape(g)}!1!==b.splitArgs&&(g=g.split(","));
1==g.length&&(g=g[0]);d[h]=g}}return d};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a){a=null==a?"id_":a.replace(OpenLayers.Util.dotless,"_");OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;
OpenLayers.METERS_PER_INCH=0.0254000508001016;
OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:2.54E-5/OpenLayers.METERS_PER_INCH,Mil:2.54E-8/OpenLayers.METERS_PER_INCH,
Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1E3/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/
OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,
Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,
SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/
OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5E4/OpenLayers.METERS_PER_INCH,"150kilometers":15E4/OpenLayers.METERS_PER_INCH});
OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1E3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1E3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,
"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(a){return 1<a?1/a:a};OpenLayers.Util.getResolutionFromScale=function(a,b){var c;a&&(null==b&&(b="degrees"),c=1/(OpenLayers.Util.normalizeScale(a)*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH));return c};
OpenLayers.Util.getScaleFromResolution=function(a,b){null==b&&(b="degrees");return a*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH};
OpenLayers.Util.pagePosition=function(a){var b=[0,0],c=OpenLayers.Util.getViewportElement();if(!a||a==window||a==c)return b;var d=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(a,"position")&&(""==a.style.top||""==a.style.left),e=null;if(a.getBoundingClientRect)a=a.getBoundingClientRect(),e=window.pageYOffset||c.scrollTop,b[0]=a.left+(window.pageXOffset||c.scrollLeft),b[1]=a.top+e;else if(document.getBoxObjectFor&&!d)a=document.getBoxObjectFor(a),c=document.getBoxObjectFor(c),
b[0]=a.screenX-c.screenX,b[1]=a.screenY-c.screenY;else{b[0]=a.offsetLeft;b[1]=a.offsetTop;e=a.offsetParent;if(e!=a)for(;e;)b[0]+=e.offsetLeft,b[1]+=e.offsetTop,e=e.offsetParent;c=OpenLayers.BROWSER_NAME;if("opera"==c||"safari"==c&&"absolute"==OpenLayers.Element.getStyle(a,"position"))b[1]-=document.body.offsetTop;for(e=a.offsetParent;e&&e!=document.body;){b[0]-=e.scrollLeft;if("opera"!=c||"TR"!=e.tagName)b[1]-=e.scrollTop;e=e.offsetParent}}return b};
OpenLayers.Util.getViewportElement=function(){var a=arguments.callee.viewportElement;void 0==a&&(a="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=a);return a};
OpenLayers.Util.isEquivalentUrl=function(a,b,c){c=c||{};OpenLayers.Util.applyDefaults(c,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});a=OpenLayers.Util.createUrlObject(a,c);b=OpenLayers.Util.createUrlObject(b,c);for(var d in a)if("args"!==d&&a[d]!=b[d])return!1;for(d in a.args){if(a.args[d]!=b.args[d])return!1;delete b.args[d]}for(d in b.args)return!1;return!0};
OpenLayers.Util.createUrlObject=function(a,b){b=b||{};if(!/^\w+:\/\//.test(a)){var c=window.location,d=c.port?":"+c.port:"",d=c.protocol+"//"+c.host.split(":").shift()+d;0===a.indexOf("/")?a=d+a:(c=c.pathname.split("/"),c.pop(),a=d+c.join("/")+"/"+a)}b.ignoreCase&&(a=a.toLowerCase());c=document.createElement("a");c.href=a;d={};d.host=c.host.split(":").shift();d.protocol=c.protocol;d.port=b.ignorePort80?"80"==c.port||"0"==c.port?"":c.port:""==c.port||"0"==c.port?"80":c.port;d.hash=b.ignoreHash||"#"===
c.hash?"":c.hash;var e=c.search;e||(e=a.indexOf("?"),e=-1!=e?a.substr(e):"");d.args=OpenLayers.Util.getParameters(e,{splitArgs:b.splitArgs});d.pathname="/"==c.pathname.charAt(0)?c.pathname:"/"+c.pathname;return d};OpenLayers.Util.removeTail=function(a){var b=null,b=a.indexOf("?"),c=a.indexOf("#");return b=-1==b?-1!=c?a.substr(0,c):a:-1!=c?a.substr(0,Math.min(b,c)):a.substr(0,b)};OpenLayers.IS_GECKO=function(){var a=navigator.userAgent.toLowerCase();return-1==a.indexOf("webkit")&&-1!=a.indexOf("gecko")}();
OpenLayers.CANVAS_SUPPORTED=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var a="",b=navigator.userAgent.toLowerCase();-1!=b.indexOf("opera")?a="opera":-1!=b.indexOf("msie")?a="msie":-1!=b.indexOf("safari")?a="safari":-1!=b.indexOf("mozilla")&&(a=-1!=b.indexOf("firefox")?"firefox":"mozilla");return a}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};
OpenLayers.Util.getRenderedDimensions=function(a,b,c){var d,e,f=document.createElement("div");f.style.visibility="hidden";for(var g=c&&c.containerElement?c.containerElement:document.body,h=!1,k=null,l=g;l&&"body"!=l.tagName.toLowerCase();){var m=OpenLayers.Element.getStyle(l,"position");if("absolute"==m){h=!0;break}else if(m&&"static"!=m)break;l=l.parentNode}!h||0!==g.clientHeight&&0!==g.clientWidth||(k=document.createElement("div"),k.style.visibility="hidden",k.style.position="absolute",k.style.overflow=
"visible",k.style.width=document.body.clientWidth+"px",k.style.height=document.body.clientHeight+"px",k.appendChild(f));f.style.position="absolute";b&&(b.w?(d=b.w,f.style.width=d+"px"):b.h&&(e=b.h,f.style.height=e+"px"));c&&c.displayClass&&(f.className=c.displayClass);b=document.createElement("div");b.innerHTML=a;b.style.overflow="visible";if(b.childNodes)for(a=0,c=b.childNodes.length;a<c;a++)b.childNodes[a].style&&(b.childNodes[a].style.overflow="visible");f.appendChild(b);k?g.appendChild(k):g.appendChild(f);
d||(d=parseInt(b.scrollWidth),f.style.width=d+"px");e||(e=parseInt(b.scrollHeight));f.removeChild(b);k?(k.removeChild(f),g.removeChild(k)):g.removeChild(f);return new OpenLayers.Size(d,e)};
OpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(null==a){var b=null,c=null,b=a=0,b=document.createElement("div");b.style.position="absolute";b.style.top="-1000px";b.style.left="-1000px";b.style.width="100px";b.style.height="50px";b.style.overflow="hidden";c=document.createElement("div");c.style.width="100%";c.style.height="200px";b.appendChild(c);document.body.appendChild(b);a=c.offsetWidth;b.style.overflow="scroll";b=c.offsetWidth;document.body.removeChild(document.body.lastChild);
OpenLayers.Util._scrollbarWidth=a-b;a=OpenLayers.Util._scrollbarWidth}return a};
OpenLayers.Util.getFormattedLonLat=function(a,b,c){c||(c="dms");a=(a+540)%360-180;var d=Math.abs(a),e=Math.floor(d),f=d=(d-e)/(1/60),d=Math.floor(d),f=Math.round(10*((f-d)/(1/60))),f=f/10;60<=f&&(f-=60,d+=1,60<=d&&(d-=60,e+=1));10>e&&(e="0"+e);e+="\u00b0";0<=c.indexOf("dm")&&(10>d&&(d="0"+d),e+=d+"'",0<=c.indexOf("dms")&&(10>f&&(f="0"+f),e+=f+'"'));return e="lon"==b?e+(0>a?OpenLayers.i18n("W"):OpenLayers.i18n("E")):e+(0>a?OpenLayers.i18n("S"):OpenLayers.i18n("N"))};OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){},read:function(a){throw Error("Read not implemented.");},write:function(a){throw Error("Write not implemented.");},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.CSWGetRecords=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetRecords.DEFAULTS);var b=OpenLayers.Format.CSWGetRecords["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetRecords version: "+a.version;return new b(a)};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object)this.events.on(this.eventListeners);null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+
"_"))},destroy:function(){this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null);this.eventListeners=null;this.handler&&(this.handler.destroy(),this.handler=null);if(this.handlers){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&"function"==typeof this.handlers[a].destroy&&this.handlers[a].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null);this.div=null},setMap:function(a){this.map=a;this.handler&&
this.handler.setMap(a)},draw:function(a){null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title));null!=a&&(this.position=a.clone());this.moveTo(this.position);return this.div},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=
a.y+"px")},activate:function(){if(this.active)return!1;this.handler&&this.handler.activate();this.active=!0;this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("activate");return!0},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),
!0):!1},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isSingleTouch:function(a){return a.touches&&1==a.touches.length},isMultiTouch:function(a){return a.touches&&1<a.touches.length},isLeftClick:function(a){return a.which&&1==a.which||a.button&&1==a.button},isRightClick:function(a){return a.which&&3==a.which||a.button&&2==a.button},stop:function(a,
b){b||OpenLayers.Event.preventDefault(a);a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},findElement:function(a,b){for(var c=OpenLayers.Event.element(a);c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase());)c=c.parentNode;return c},observe:function(a,b,c,d){a=OpenLayers.Util.getElement(a);d=d||!1;"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent)&&(b="keydown");
this.observers||(this.observers={});if(!a._eventCacheID){var e="eventCacheID_";a.id&&(e=a.id+"_"+e);a._eventCacheID=OpenLayers.Util.createUniqueID(e)}e=a._eventCacheID;this.observers[e]||(this.observers[e]=[]);this.observers[e].push({element:a,name:b,observer:c,useCapture:d});a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)},stopObservingElement:function(a){a=OpenLayers.Util.getElement(a)._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[a])},
_removeElementObservers:function(a){if(a)for(var b=a.length-1;0<=b;b--){var c=a[b];OpenLayers.Event.stopObserving.apply(this,[c.element,c.name,c.observer,c.useCapture])}},stopObserving:function(a,b,c,d){d=d||!1;a=OpenLayers.Util.getElement(a);var e=a._eventCacheID;"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent)&&(b="keydown");var f=!1,g=OpenLayers.Event.observers[e];if(g)for(var h=0;!f&&h<g.length;){var k=g[h];if(k.name==b&&k.observer==c&&k.useCapture==d){g.splice(h,
1);0==g.length&&delete OpenLayers.Event.observers[e];f=!0;break}h++}f&&(a.removeEventListener?a.removeEventListener(b,c,d):a&&a.detachEvent&&a.detachEvent("on"+b,c));return f},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers)OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[a]]);OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"};
OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);
OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(a,b,c,d,e){OpenLayers.Util.extend(this,e);this.object=a;this.fallThrough=d;this.listeners={};this.extensions={};this.extensionCount=
{};this._msTouches=[];null!=b&&this.attachToElement(b)},destroy:function(){for(var a in this.extensions)"boolean"!==typeof this.extensions[a]&&this.extensions[a].destroy();this.extensions=null;this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener));this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(a){},attachToElement:function(a){this.element?
OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this));this.element=a;for(var b=!!window.navigator.msMaxTouchPoints,c,d=0,e=this.BROWSER_EVENTS.length;d<e;d++)c=this.BROWSER_EVENTS[d],OpenLayers.Event.observe(a,c,this.eventHandler),b&&0===c.indexOf("touch")&&this.addMsTouchListener(a,c,this.eventHandler);OpenLayers.Event.observe(a,"dragstart",
OpenLayers.Event.stop)},on:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.register(b,a.scope,a[b])},register:function(a,b,c,d){a in OpenLayers.Events&&!this.extensions[a]&&(this.extensions[a]=new OpenLayers.Events[a](this));if(null!=c){null==b&&(b=this.object);var e=this.listeners[a];e||(e=[],this.listeners[a]=e,this.extensionCount[a]=0);b={obj:b,func:c};d?(e.splice(this.extensionCount[a],0,b),"object"===typeof d&&d.extension&&this.extensionCount[a]++):e.push(b)}},registerPriority:function(a,
b,c){this.register(a,b,c,!0)},un:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.unregister(b,a.scope,a[b])},unregister:function(a,b,c){null==b&&(b=this.object);a=this.listeners[a];if(null!=a)for(var d=0,e=a.length;d<e;d++)if(a[d].obj==b&&a[d].func==c){a.splice(d,1);break}},remove:function(a){null!=this.listeners[a]&&(this.listeners[a]=[])},triggerEvent:function(a,b){var c=this.listeners[a];if(c&&0!=c.length){null==b&&(b={});b.object=this.object;b.element=this.element;b.type||(b.type=
a);for(var c=c.slice(),d,e=0,f=c.length;e<f&&(d=c[e],d=d.func.apply(d.obj,[b]),void 0==d||!1!=d);e++);this.fallThrough||OpenLayers.Event.stop(b,!0);return d}},handleBrowserEvent:function(a){var b=a.type,c=this.listeners[b];if(c&&0!=c.length){if((c=a.touches)&&c[0]){for(var d=0,e=0,f=c.length,g,h=0;h<f;++h)g=this.getTouchClientXY(c[h]),d+=g.clientX,e+=g.clientY;a.clientX=d/f;a.clientY=e/f}this.includeXY&&(a.xy=this.getMousePosition(a));this.triggerEvent(b,a)}},getTouchClientXY:function(a){var b=window.olMockWin||
window,c=b.pageXOffset,b=b.pageYOffset,d=a.clientX,e=a.clientY;if(0===a.pageY&&Math.floor(e)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(d)>Math.floor(a.pageX))d-=c,e-=b;else if(e<a.pageY-b||d<a.pageX-c)d=a.pageX-c,e=a.pageY-b;a.olClientX=d;a.olClientY=e;return{clientX:d,clientY:e}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(a){this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",
this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache();if(!this.element.scrolls){var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||b.scrollLeft,window.pageYOffset||b.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(a.clientX+this.element.scrolls[0]-
this.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(a,b,c){function d(a){c(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var a=e.length-1;0<=a;--a)e[a].stopPropagation()},preventDefault:function(){for(var a=e.length-1;0<=a;--a)e[a].preventDefault()},type:b},a))}var e=this._msTouches;switch(b){case "touchstart":return this.addMsTouchListenerStart(a,b,d);case "touchend":return this.addMsTouchListenerEnd(a,
b,d);case "touchmove":return this.addMsTouchListenerMove(a,b,d);default:throw"Unknown touch event type";}},addMsTouchListenerStart:function(a,b,c){var d=this._msTouches;OpenLayers.Event.observe(a,"MSPointerDown",function(a){for(var b=!1,g=0,h=d.length;g<h;++g)if(d[g].pointerId==a.pointerId){b=!0;break}b||d.push(a);a.touches=d.slice();c(a)});OpenLayers.Event.observe(a,"MSPointerUp",function(a){for(var b=0,c=d.length;b<c;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}})},addMsTouchListenerMove:function(a,
b,c){var d=this._msTouches;OpenLayers.Event.observe(a,"MSPointerMove",function(a){if(a.pointerType!=a.MSPOINTER_TYPE_MOUSE||0!=a.buttons)if(1!=d.length||d[0].pageX!=a.pageX||d[0].pageY!=a.pageY){for(var b=0,g=d.length;b<g;++b)if(d[b].pointerId==a.pointerId){d[b]=a;break}a.touches=d.slice();c(a)}})},addMsTouchListenerEnd:function(a,b,c){var d=this._msTouches;OpenLayers.Event.observe(a,"MSPointerUp",function(a){for(var b=0,g=d.length;b<g;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}a.touches=
d.slice();c(a)})},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(a){this.target=a;for(a=this.events.length-1;0<=a;--a)this.target.register(this.events[a],this,this.buttonClick,{extension:!0})},destroy:function(){for(var a=this.events.length-1;0<=a;--a)this.target.unregister(this.events[a],this,this.buttonClick);
delete this.target},getPressedButton:function(a){var b=3,c;do{if(OpenLayers.Element.hasClass(a,"olButton")){c=a;break}a=a.parentNode}while(0<--b&&a);return c},ignore:function(a){var b=3,c=!1;do{if("a"===a.nodeName.toLowerCase()){c=!0;break}a=a.parentNode}while(0<--b&&a);return c},buttonClick:function(a){var b=!0,c=OpenLayers.Event.element(a);if(c&&(OpenLayers.Event.isLeftClick(a)||!~a.type.indexOf("mouse")))if(c=this.getPressedButton(c)){if("keydown"===a.type)switch(a.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",
{buttonElement:c}),OpenLayers.Event.stop(a),b=!1}else if(this.startEvt){if(this.completeRegEx.test(a.type)){var b=OpenLayers.Util.pagePosition(c),d=OpenLayers.Util.getViewportElement(),e=window.pageYOffset||d.scrollTop;b[0]-=window.pageXOffset||d.scrollLeft;b[1]-=e;this.target.triggerEvent("buttonclick",{buttonElement:c,buttonXY:{x:this.startEvt.clientX-b[0],y:this.startEvt.clientY-b[1]}})}this.cancelRegEx.test(a.type)&&delete this.startEvt;OpenLayers.Event.stop(a);b=!1}this.startRegEx.test(a.type)&&
(this.startEvt=a,OpenLayers.Event.stop(a),b=!1)}else b=!this.ignore(OpenLayers.Event.element(a)),delete this.startEvt;return b}});OpenLayers.Util=OpenLayers.Util||{};
OpenLayers.Util.vendorPrefix=function(){function a(a){return a?a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function b(a,b){if(void 0===g[b]){var c,e=0,f=d.length,p="undefined"!==typeof a.cssText;for(g[b]=null;e<f;e++)if((c=d[e])?(p||(c=c.toLowerCase()),c=c+b.charAt(0).toUpperCase()+b.slice(1)):c=b,void 0!==a[c]){g[b]=c;break}}return g[b]}function c(a){return b(e,a)}var d=["","O","ms","Moz","Webkit"],e=document.createElement("div").style,f={},g={};return{css:function(b){if(void 0===
f[b]){var d=b.replace(/(-[\s\S])/g,function(a){return a.charAt(1).toUpperCase()}),d=c(d);f[b]=a(d)}return f[b]},js:b,style:c,cssCache:f,jsCache:g}}();OpenLayers.Animation=function(a){var b=OpenLayers.Util.vendorPrefix.js(a,"requestAnimationFrame"),c=!!b,d=function(){var c=a[b]||function(b,c){a.setTimeout(b,16)};return function(b,d){c.apply(a,[b,d])}}(),e=0,f={};return{isNative:c,requestFrame:d,start:function(a,b,c){b=0<b?b:Number.POSITIVE_INFINITY;var l=++e,m=+new Date;f[l]=function(){f[l]&&+new Date-m<=b?(a(),f[l]&&d(f[l],c)):delete f[l]};d(f[l],c);return l},stop:function(a){delete f[a]}}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(a){this.easing=a?a:OpenLayers.Easing.Expo.easeOut},start:function(a,b,c,d){this.playing=!0;this.begin=a;this.finish=b;this.duration=c;this.callbacks=d.callbacks;this.minFrameRate=d.minFrameRate||30;this.time=0;this.startTime=(new Date).getTime();OpenLayers.Animation.stop(this.animationId);this.animationId=null;
this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var a={},b;for(b in this.begin){var c=this.begin[b],d=this.finish[b];if(null==c||null==d||isNaN(c)||isNaN(d))throw new TypeError("invalid value for Tween");
a[b]=this.easing.apply(this,[this.time,c,d-c,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1E3/this.minFrameRate&&this.callbacks.eachStep.call(this,a);this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(a,b,c,d){return c*a/d+b},easeOut:function(a,b,c,d){return c*a/d+b},easeInOut:function(a,b,c,d){return c*a/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"};
OpenLayers.Easing.Expo={easeIn:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOut:function(a,b,c,d){return 0==a?b:a==d?b+c:1>(a/=d/2)?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},CLASS_NAME:"OpenLayers.Easing.Expo"};
OpenLayers.Easing.Quad={easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(a,b){OpenLayers.Util.extend(this,b);this.projCode=a;"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(a))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){var b=!1;a&&(a instanceof OpenLayers.Projection||(a=new OpenLayers.Projection(a)),"object"==
typeof Proj4js&&this.proj.defData&&a.proj.defData?b=this.proj.defData.replace(this.titleRegEx,"")==a.proj.defData.replace(this.titleRegEx,""):a.getCode&&(b=this.getCode(),a=a.getCode(),b=b==a||!!OpenLayers.Projection.transforms[b]&&OpenLayers.Projection.transforms[b][a]===OpenLayers.Projection.nullTransform));return b},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};
OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7]}};
OpenLayers.Projection.addTransform=function(a,b,c){if(c===OpenLayers.Projection.nullTransform){var d=OpenLayers.Projection.defaults[a];d&&!OpenLayers.Projection.defaults[b]&&(OpenLayers.Projection.defaults[b]=d)}OpenLayers.Projection.transforms[a]||(OpenLayers.Projection.transforms[a]={});OpenLayers.Projection.transforms[a][b]=c};
OpenLayers.Projection.transform=function(a,b,c){if(b&&c)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),c instanceof OpenLayers.Projection||(c=new OpenLayers.Projection(c)),b.proj&&c.proj)a=Proj4js.transform(b.proj,c.proj,a);else{b=b.getCode();c=c.getCode();var d=OpenLayers.Projection.transforms;if(d[b]&&d[b][c])d[b][c](a)}return a};OpenLayers.Projection.nullTransform=function(a){return a};
(function(){function a(a){a.x=180*a.x/d;a.y=180/Math.PI*(2*Math.atan(Math.exp(a.y/d*Math.PI))-Math.PI/2);return a}function b(a){a.x=a.x*d/180;var b=Math.log(Math.tan((90+a.y)*Math.PI/360))/Math.PI*d;a.y=Math.max(-2.003750834E7,Math.min(b,2.003750834E7));return a}function c(c,d){var e=OpenLayers.Projection.addTransform,f=OpenLayers.Projection.nullTransform,g,p,q,r,s;g=0;for(p=d.length;g<p;++g)for(q=d[g],e(c,q,b),e(q,c,a),s=g+1;s<p;++s)r=d[s],e(q,r,f),e(r,q,f)}var d=2.003750834E7,e=["EPSG:900913","EPSG:3857",
"EPSG:102113","EPSG:102100"],f=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],g;for(g=e.length-1;0<=g;--g)c(e[g],f);for(g=f.length-1;0<=g;--g)c(f[g],e)})();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1E3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,
maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(a,b){1===arguments.length&&"object"===typeof a&&(a=(b=a)&&b.div);this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,
OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend({},b);OpenLayers.Util.extend(this,b);OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]);!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));
!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent));!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(a);this.div||(this.div=document.createElement("div"),
this.div.style.height="1px",this.div.style.width="1px");OpenLayers.Element.addClass(this.div,"olMap");var c=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(c,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});OpenLayers.TileManager&&null!==
this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this));c=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(c);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.layerContainerOriginPx={x:0,y:0};this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object)this.events.on(this.eventListeners);
!0===this.autoUpdateSize&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy));if(this.theme){for(var c=!0,d=document.getElementsByTagName("link"),e=0,f=d.length;e<f;++e)if(OpenLayers.Util.isEquivalentUrl(d.item(e).href,this.theme)){c=!1;break}c&&(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(c))}null==
this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&
this.controls.push(new OpenLayers.Control.Attribution)));e=0;for(f=this.controls.length;e<f;e++)this.addControlToMap(this.controls[e]);this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);b&&b.layers&&(delete this.center,delete this.zoom,this.addLayers(b.layers),b.center&&!this.getCenter()&&this.setCenter(b.center,b.zoom));this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod));this.zoomMethod&&this.applyTransform.transform&&
(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(a){this.div=OpenLayers.Util.getElement(a);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;this.panTween&&(this.panTween.stop(),this.panTween=null);this.zoomTween&&(this.zoomTween.stop(),
this.zoomTween=null);OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy);this.paddingForPopups=null;if(null!=this.controls){for(var a=this.controls.length-1;0<=a;--a)this.controls[a].destroy();this.controls=null}if(null!=this.layers){for(a=this.layers.length-1;0<=a;--a)this.layers[a].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);
this.viewPortDiv=null;this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null);this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null);this.events.destroy();this.options=this.events=null},setOptions:function(a){var b=this.minPx&&a.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,a);b&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(a,b,c){var d="function"==
typeof c.test;return OpenLayers.Array.filter(this[a],function(a){return a[b]==c||d&&c.test(a[b])})},getLayersBy:function(a,b){return this.getBy("layers",a,b)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(a,b){return this.getBy("controls",a,b)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(a){for(var b=null,c=0,d=this.layers.length;c<d;c++){var e=
this.layers[c];if(e.id==a){b=e;break}}return b},setLayerZIndex:function(a,b){a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?"BaseLayer":"Overlay"]+5*b)},resetLayersZIndex:function(){for(var a=0,b=this.layers.length;a<b;a++)this.setLayerZIndex(this.layers[a],a)},addLayer:function(a){for(var b=0,c=this.layers.length;b<c;b++)if(this.layers[b]==a)return!1;if(!1===this.events.triggerEvent("preaddlayer",{layer:a}))return!1;this.allOverlays&&(a.isBaseLayer=!1);a.div.className="olLayerDiv";a.div.style.overflow=
"";this.setLayerZIndex(a,this.layers.length);a.isFixed?this.viewPortDiv.appendChild(a.div):this.layerContainerDiv.appendChild(a.div);this.layers.push(a);a.setMap(this);a.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(a):a.setVisibility(!1):a.redraw();this.events.triggerEvent("addlayer",{layer:a});a.events.triggerEvent("added",{map:this,layer:a});a.afterAdd();return!0},addLayers:function(a){for(var b=0,c=a.length;b<c;b++)this.addLayer(a[b])},removeLayer:function(a,
b){if(!1!==this.events.triggerEvent("preremovelayer",{layer:a})){null==b&&(b=!0);a.isFixed?this.viewPortDiv.removeChild(a.div):this.layerContainerDiv.removeChild(a.div);OpenLayers.Util.removeItem(this.layers,a);a.removeMap(this);a.map=null;if(this.baseLayer==a&&(this.baseLayer=null,b))for(var c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:a});a.events.triggerEvent("removed",
{map:this,layer:a})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(a,b){var c=this.getLayerIndex(a);0>b?b=0:b>this.layers.length&&(b=this.layers.length);if(c!=b){this.layers.splice(c,1);this.layers.splice(b,0,a);for(var c=0,d=this.layers.length;c<d;c++)this.setLayerZIndex(this.layers[c],c);this.events.triggerEvent("changelayer",{layer:a,property:"order"});this.allOverlays&&(0===b?this.setBaseLayer(a):
this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(a,b){var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)},setBaseLayer:function(a){if(a!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,a)){var b=this.getCachedCenter(),c=OpenLayers.Util.getResolutionFromScale(this.getScale(),a.units);null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1);this.baseLayer=a;if(!this.allOverlays||this.baseLayer.visibility)this.baseLayer.setVisibility(!0),
!1===this.baseLayer.inRange&&this.baseLayer.redraw();null!=b&&(a=this.getZoomForResolution(c||this.resolution,!0),this.setCenter(b,a,!1,!0));this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(a,b){this.controls.push(a);this.addControlToMap(a,b)},addControls:function(a,b){for(var c=1===arguments.length?[]:b,d=0,e=a.length;d<e;d++)this.addControl(a[d],c[d]?c[d]:null)},addControlToMap:function(a,b){a.outsideViewport=null!=a.div;this.displayProjection&&!a.displayProjection&&
(a.displayProjection=this.displayProjection);a.setMap(this);var c=a.draw(b);c&&!a.outsideViewport&&(c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(c));a.autoActivate&&a.activate()},getControl:function(a){for(var b=null,c=0,d=this.controls.length;c<d;c++){var e=this.controls[c];if(e.id==a){b=e;break}}return b},removeControl:function(a){a&&a==this.getControl(a.id)&&(a.div&&a.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.controls,
a))},addPopup:function(a,b){if(b)for(var c=this.popups.length-1;0<=c;--c)this.removePopup(this.popups[c]);a.map=this;this.popups.push(a);if(c=a.draw())c.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(c)},removePopup:function(a){OpenLayers.Util.removeItem(this.popups,a);if(a.div)try{this.layerContainerDiv.removeChild(a.div)}catch(b){}a.map=null},getSize:function(){var a=null;null!=this.size&&(a=this.size.clone());return a},updateSize:function(){var a=this.getCurrentSize();
if(a&&!isNaN(a.h)&&!isNaN(a.w)){this.events.clearMouseCache();var b=this.getSize();null==b&&(this.size=b=a);if(!a.equals(b)){this.size=a;a=0;for(b=this.layers.length;a<b;a++)this.layers[a].onMapResize();a=this.getCachedCenter();null!=this.baseLayer&&null!=a&&(b=this.getZoom(),this.zoom=null,this.setCenter(a,b))}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))a.w=this.div.offsetWidth,
a.h=this.div.offsetHeight;if(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))a.w=parseInt(this.div.style.width),a.h=parseInt(this.div.style.height);return a},calculateBounds:function(a,b){var c=null;null==a&&(a=this.getCachedCenter());null==b&&(b=this.getResolution());if(null!=a&&null!=b)var c=this.size.w*b/2,d=this.size.h*b/2,c=new OpenLayers.Bounds(a.lon-c,a.lat-d,a.lon+c,a.lat+d);return c},getCenter:function(){var a=null,b=this.getCachedCenter();b&&(a=b.clone());return a},getCachedCenter:function(){!this.center&&
this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2}));return this.center},getZoom:function(){return this.zoom},pan:function(a,b,c){c=OpenLayers.Util.applyDefaults(c,{animate:!0,dragging:!1});if(c.dragging)0==a&&0==b||this.moveByPx(a,b);else{var d=this.getViewPortPxFromLonLat(this.getCachedCenter());a=d.add(a,b);if(this.dragging||!a.equals(d))d=this.getLonLatFromViewPortPx(a),c.animate?this.panTo(d):(this.moveTo(d),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}},
panTo:function(a){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(a)){var b=this.getCachedCenter();if(!a.equals(b)){var b=this.getPixelFromLonLat(b),c=this.getPixelFromLonLat(a),d=0,e=0;this.panTween.start({x:0,y:0},{x:c.x-b.x,y:c.y-b.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(a){this.moveByPx(a.x-d,a.y-e);d=Math.round(a.x);e=Math.round(a.y)},this),done:OpenLayers.Function.bind(function(b){this.moveTo(a);this.dragging=!1;this.events.triggerEvent("moveend")},
this)}})}}else this.setCenter(a)},setCenter:function(a,b,c,d){this.panTween&&this.panTween.stop();this.zoomTween&&this.zoomTween.stop();this.moveTo(a,b,{dragging:c,forceZoomChange:d})},moveByPx:function(a,b){var c=this.size.w/2,d=this.size.h/2,e=c+a,f=d+b,g=this.baseLayer.wrapDateLine,h=0,k=0;this.restrictedExtent&&(h=c,k=d,g=!1);a=g||e<=this.maxPx.x-h&&e>=this.minPx.x+h?Math.round(a):0;b=f<=this.maxPx.y-k&&f>=this.minPx.y+k?Math.round(b):0;if(a||b){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart"));
this.center=null;a&&(this.layerContainerOriginPx.x-=a,this.minPx.x-=a,this.maxPx.x-=a);b&&(this.layerContainerOriginPx.y-=b,this.minPx.y-=b,this.maxPx.y-=b);this.applyTransform();d=0;for(e=this.layers.length;d<e;++d)c=this.layers[d],c.visibility&&(c===this.baseLayer||c.inRange)&&(c.moveByPx(a,b),c.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(a){if(this.baseLayer&&this.baseLayer.wrapDateLine){var b=this.baseLayer.resolutions,c=this.getMaxExtent().getWidth()/this.size.w;
if(this.getResolutionForZoom(a)>c)if(this.fractionalZoom)a=this.getZoomForResolution(c);else for(var d=a|0,e=b.length;d<e;++d)if(b[d]<=c){a=d;break}}return a},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(a,b,c){null==a||a instanceof OpenLayers.LonLat||(a=new OpenLayers.LonLat(a));c||(c={});null!=b&&(b=parseFloat(b),this.fractionalZoom||(b=Math.round(b)));var d=b;b=this.adjustZoom(b);b!==d&&(a=this.getCenter());var d=c.dragging||this.dragging,e=c.forceZoomChange;this.getCachedCenter()||
this.isValidLonLat(a)||(a=this.maxExtent.getCenterLonLat(),this.center=a.clone());if(null!=this.restrictedExtent){null==a&&(a=this.center);null==b&&(b=this.getZoom());var f=this.getResolutionForZoom(b),f=this.calculateBounds(a,f);if(!this.restrictedExtent.containsBounds(f)){var g=this.restrictedExtent.getCenterLonLat();f.getWidth()>this.restrictedExtent.getWidth()?a=new OpenLayers.LonLat(g.lon,a.lat):f.left<this.restrictedExtent.left?a=a.add(this.restrictedExtent.left-f.left,0):f.right>this.restrictedExtent.right&&
(a=a.add(this.restrictedExtent.right-f.right,0));f.getHeight()>this.restrictedExtent.getHeight()?a=new OpenLayers.LonLat(a.lon,g.lat):f.bottom<this.restrictedExtent.bottom?a=a.add(0,this.restrictedExtent.bottom-f.bottom):f.top>this.restrictedExtent.top&&(a=a.add(0,this.restrictedExtent.top-f.top))}}e=e||this.isValidZoomLevel(b)&&b!=this.getZoom();f=this.isValidLonLat(a)&&!a.equals(this.center);if(e||f||d){d||this.events.triggerEvent("movestart",{zoomChanged:e});f&&(!e&&this.center&&this.centerLayerContainer(a),
this.center=a.clone());a=e?this.getResolutionForZoom(b):this.getResolution();if(e||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var f=this.getMaxExtent({restricted:!0}),h=f.getCenterLonLat(),g=this.center.lon-h.lon,h=h.lat-this.center.lat,k=Math.round(f.getWidth()/a),l=Math.round(f.getHeight()/a);this.minPx={x:(this.size.w-k)/2-g/a,y:(this.size.h-l)/2-h/a};this.maxPx={x:this.minPx.x+
Math.round(f.getWidth()/a),y:this.minPx.y+Math.round(f.getHeight()/a)}}e&&(this.zoom=b,this.resolution=a);a=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(a,e,c.dragging),c.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:e}));a=this.baseLayer.getExtent();for(b=this.layers.length-1;0<=b;--b)f=this.layers[b],f===this.baseLayer||f.isBaseLayer||(g=f.calculateInRange(),f.inRange!=g&&((f.inRange=g)||f.display(!1),this.events.triggerEvent("changelayer",{layer:f,property:"visibility"})),
g&&f.visibility&&(f.moveTo(a,e,c.dragging),c.dragging||f.events.triggerEvent("moveend",{zoomChanged:e})));this.events.triggerEvent("move");d||this.events.triggerEvent("moveend");if(e){b=0;for(c=this.popups.length;b<c;b++)this.popups[b].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin),c=this.getViewPortPxFromLonLat(a);if(null!=b&&null!=c){var d=this.layerContainerOriginPx.x;a=this.layerContainerOriginPx.y;
var e=Math.round(b.x-c.x),b=Math.round(b.y-c.y);this.applyTransform(this.layerContainerOriginPx.x=e,this.layerContainerOriginPx.y=b);d-=e;a-=b;this.minPx.x-=d;this.maxPx.x-=d;this.minPx.y-=a;this.maxPx.y-=a}},isValidZoomLevel:function(a){return null!=a&&0<=a&&a<this.getNumZoomLevels()},isValidLonLat:function(a){var b=!1;null!=a&&(b=this.getMaxExtent(),b=b.containsLonLat(a,{worldBounds:this.baseLayer.wrapDateLine&&b}));return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():
null},getProjectionObject:function(){var a=null;null!=this.baseLayer&&(a=this.baseLayer.projection);return a},getMaxResolution:function(){var a=null;null!=this.baseLayer&&(a=this.baseLayer.maxResolution);return a},getMaxExtent:function(a){var b=null;a&&a.restricted&&this.restrictedExtent?b=this.restrictedExtent:null!=this.baseLayer&&(b=this.baseLayer.maxExtent);return b},getNumZoomLevels:function(){var a=null;null!=this.baseLayer&&(a=this.baseLayer.numZoomLevels);return a},getExtent:function(){var a=
null;null!=this.baseLayer&&(a=this.baseLayer.getExtent());return a},getResolution:function(){var a=null;null!=this.baseLayer?a=this.baseLayer.getResolution():!0===this.allOverlays&&0<this.layers.length&&(a=this.layers[0].getResolution());return a},getUnits:function(){var a=null;null!=this.baseLayer&&(a=this.baseLayer.units);return a},getScale:function(){var a=null;null!=this.baseLayer&&(a=this.getResolution(),a=OpenLayers.Util.getScaleFromResolution(a,this.baseLayer.units));return a},getZoomForExtent:function(a,
b){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getZoomForExtent(a,b));return c},getResolutionForZoom:function(a){var b=null;this.baseLayer&&(b=this.baseLayer.getResolutionForZoom(a));return b},getZoomForResolution:function(a,b){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getZoomForResolution(a,b));return c},zoomTo:function(a,b){var c=this;if(c.isValidZoomLevel(a))if(c.baseLayer.wrapDateLine&&(a=c.adjustZoom(a)),c.zoomTween){var d=c.getResolution(),e=c.getResolutionForZoom(a),f={scale:1},
d={scale:d/e};c.zoomTween.playing&&c.zoomTween.duration<3*c.zoomDuration?c.zoomTween.finish={scale:c.zoomTween.finish.scale*d.scale}:(b||(e=c.getSize(),b={x:e.w/2,y:e.h/2}),c.zoomTween.start(f,d,c.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(a){var d=c.layerContainerOriginPx;a=a.scale;c.applyTransform(d.x+((a-1)*(d.x-b.x)|0),d.y+((a-1)*(d.y-b.y)|0),a)},done:function(a){c.applyTransform();a=c.getResolution()/a.scale;var d=c.getZoomForResolution(a,!0);c.moveTo(c.getZoomTargetCenter(b,
a),d,!0)}}}))}else f=b?c.getZoomTargetCenter(b,c.getResolutionForZoom(a)):null,c.setCenter(f,a)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(a,b){a instanceof OpenLayers.Bounds||(a=new OpenLayers.Bounds(a));var c=a.getCenterLonLat();if(this.baseLayer.wrapDateLine){c=this.getMaxExtent();for(a=a.clone();a.right<a.left;)a.right+=c.getWidth();c=a.getCenterLonLat().wrapDateLine(c)}this.setCenter(c,this.getZoomForExtent(a,b))},
zoomToMaxExtent:function(a){a=this.getMaxExtent({restricted:a?a.restricted:!0});this.zoomToExtent(a)},zoomToScale:function(a,b){var c=OpenLayers.Util.getResolutionFromScale(a,this.baseLayer.units),d=this.size.w*c/2,c=this.size.h*c/2,e=this.getCachedCenter(),d=new OpenLayers.Bounds(e.lon-d,e.lat-c,e.lon+d,e.lat+c);this.zoomToExtent(d,b)},getLonLatFromViewPortPx:function(a){var b=null;null!=this.baseLayer&&(b=this.baseLayer.getLonLatFromViewPortPx(a));return b},getViewPortPxFromLonLat:function(a){var b=
null;null!=this.baseLayer&&(b=this.baseLayer.getViewPortPxFromLonLat(a));return b},getZoomTargetCenter:function(a,b){var c=null,d=this.getSize(),e=d.w/2-a.x,d=a.y-d.h/2,f=this.getLonLatFromPixel(a);f&&(c=new OpenLayers.LonLat(f.lon+e*b,f.lat+d*b));return c},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){a=this.getViewPortPxFromLonLat(a);a.x=Math.round(a.x);a.y=Math.round(a.y);return a},getGeodesicPixelSize:function(a){var b=a?this.getLonLatFromPixel(a):
this.getCachedCenter()||new OpenLayers.LonLat(0,0),c=this.getResolution();a=b.add(-c/2,0);var d=b.add(c/2,0),e=b.add(0,-c/2),b=b.add(0,c/2),c=new OpenLayers.Projection("EPSG:4326"),f=this.getProjectionObject()||c;f.equals(c)||(a.transform(f,c),d.transform(f,c),e.transform(f,c),b.transform(f,c));return new OpenLayers.Size(OpenLayers.Util.distVincenty(a,d),OpenLayers.Util.distVincenty(e,b))},getViewPortPxFromLayerPx:function(a){var b=null;null!=a&&(b=a.add(this.layerContainerOriginPx.x,this.layerContainerOriginPx.y));
return b},getLayerPxFromViewPortPx:function(a){var b=null;null!=a&&(b=a.add(-this.layerContainerOriginPx.x,-this.layerContainerOriginPx.y),isNaN(b.x)||isNaN(b.y))&&(b=null);return b},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){a=this.getPixelFromLonLat(a);return this.getLayerPxFromViewPortPx(a)},applyTransform:function(a,b,c){c=c||1;var d=this.layerContainerOriginPx,e=1!==c;a=a||d.x;b=b||d.y;var f=this.layerContainerDiv.style,
g=this.applyTransform.transform,h=this.applyTransform.template;if(void 0===g&&(g=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=g)){var k=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));k&&"none"===k||(h=["translate3d(",",0) ","scale3d(",",1)"],f[g]=[h[0],"0,0",h[1]].join(""));h&&~f[g].indexOf(h[0])||(h=["translate(",") ","scale(",")"]);this.applyTransform.template=h}null===g||"translate3d("!==h[0]&&!0!==e?(f.left=a+"px",f.top=
b+"px",null!==g&&(f[g]="")):(!0===e&&"translate("===h[0]&&(a-=d.x,b-=d.y,f.left=d.x+"px",f.top=d.y+"px"),f[g]=[h[0],a,"px,",b,"px",h[1],h[2],c,",",c,h[3]].join(""))},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(a,b,c){OpenLayers.Util.extend(this,c);this.control=a;this.callbacks=b;(a=this.map||a.map)&&this.setMap(a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){return null==this.keyMask?!0:((a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:
0)|(a.metaKey?OpenLayers.Handler.MOD_META:0))==this.keyMask},activate:function(){if(this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.register(a[b],this[a[b]]);return this.active=!0},deactivate:function(){if(!this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.unregister(a[b],this[a[b]]);this.active=this.touch=!1;return!0},startTouch:function(){if(!this.touch){this.touch=!0;
for(var a="mousedown mouseup mousemove click dblclick mouseout".split(" "),b=0,c=a.length;b<c;b++)this[a[b]]&&this.unregister(a[b],this[a[b]])}},callback:function(a,b){a&&this.callbacks[a]&&this.callbacks[a].apply(this.control,b)},register:function(a,b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){this.evt=a;return!0},
destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.MOD_META=8;OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(a){this.startTouch();this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return!0},touchmove:function(a){this.last=this.getEventInfo(a);return!0},touchend:function(a){this.down&&(a.xy=this.last.xy,a.lastTouches=this.last.touches,this.handleSingle(a),
this.down=null);return!0},mousedown:function(a){this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return!0},mouseup:function(a){var b=!0;this.checkModifiers(a)&&(this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a))&&(b=this.rightclick(a));return b},rightclick:function(a){if(this.passesTolerance(a)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[a]),!this.stopDouble;a=this["double"]?OpenLayers.Util.extend({},a):this.callback("rightclick",
[a]);a=OpenLayers.Function.bind(this.delayedRightCall,this,a);this.rightclickTimerId=window.setTimeout(a,this.delay)}return!this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null;a&&this.callback("rightclick",[a])},click:function(a){this.last||(this.last=this.getEventInfo(a));this.handleSingle(a);return!this.stopSingle},dblclick:function(a){this.handleDouble(a);return!this.stopDouble},handleDouble:function(a){this.passesDblclickTolerance(a)&&(this["double"]&&this.callback("dblclick",
[a]),this.clearTimer())},handleSingle:function(a){this.passesTolerance(a)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.preventDefault(a),this.handleDouble(a)),this.last.touches&&2===this.last.touches.length||this.clearTimer()):(this.first=this.getEventInfo(a),a=this.single?OpenLayers.Util.extend({},a):null,this.queuePotentialClick(a)))},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,
this,a),this.delay)},passesTolerance:function(a){var b=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(b=this.pixelTolerance>=this.down.xy.distanceTo(a.xy))&&this.touch&&this.down.touches.length===this.last.touches.length){a=0;for(var c=this.down.touches.length;a<c;++a)if(this.getTouchDistance(this.down.touches[a],this.last.touches[a])>this.pixelTolerance){b=!1;break}}return b},getTouchDistance:function(a,b){return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,
2))},passesDblclickTolerance:function(a){a=!0;this.down&&this.first&&(a=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return a},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(a){this.timerId=null;a&&this.callback("click",[a])},getEventInfo:function(a){var b;if(a.touches){var c=a.touches.length;b=Array(c);for(var d,
e=0;e<c;e++)d=a.touches[e],b[e]={clientX:d.olClientX,clientY:d.olClientY}}return{xy:a.xy,touches:b}},deactivate:function(){var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,a=!0);return a},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(!0===this.documentDrag){var d=this;this._docMove=function(a){d.mousemove({xy:{x:a.clientX,y:a.clientY},element:document})};this._docUp=function(a){d.mouseup({xy:{x:a.clientX,y:a.clientY}})}}},
dragstart:function(a){var b=!0;this.dragging=!1;this.checkModifiers(a)&&(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))?(this.started=!0,this.last=this.start=a.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(a),this.callback("down",[a.xy]),OpenLayers.Event.preventDefault(a),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,b=!this.stopDown):
(this.started=!1,this.last=this.start=null);return b},dragmove:function(a){this.lastMoveEvt=a;!this.started||(this.timeoutId||a.xy.x==this.last.x&&a.xy.y==this.last.y)||(!0===this.documentDrag&&this.documentEvents&&(a.element===document?(this.adjustXY(a),this.setEvent(a)):this.removeDocumentEvents()),0<this.interval&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(a),this.callback("move",[a.xy]),this.oldOnselectstart||(this.oldOnselectstart=
document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=a.xy);return!0},dragend:function(a){if(this.started){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(a),this.removeDocumentEvents());var b=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(a);this.callback("up",[a.xy]);b&&this.callback("done",[a.xy]);document.onselectstart=this.oldOnselectstart}return!0},down:function(a){},move:function(a){},
up:function(a){},out:function(a){},mousedown:function(a){return this.dragstart(a)},touchstart:function(a){this.startTouch();return this.dragstart(a)},mousemove:function(a){return this.dragmove(a)},touchmove:function(a){return this.dragmove(a)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(a){return this.dragend(a)},touchend:function(a){a.xy=this.last;return this.dragend(a)},mouseout:function(a){if(this.started&&OpenLayers.Util.mouseLeft(a,
this.map.viewPortDiv))if(!0===this.documentDrag)this.addDocumentEvents();else{var b=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(a);this.callback("out",[]);b&&this.callback("done",[a.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(a){return this.start==this.last},activate:function(){var a=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=
!1,a=!0);return a},deactivate:function(){var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=!1,this.last=this.start=null,a=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"));return a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0];a.xy.y-=b[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",
this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(a){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),
this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),
this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(0===this.layers.length)if(this.map.baseLayer)this.layers=[this.map.baseLayer.clone()];else return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;this.element=document.createElement("div");this.element.className=
this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1E3;this.extentRectangle.className=this.displayClass+
"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var a=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,a,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";this.maximizeTitle&&
(this.maximizeDiv.title=this.maximizeTitle);this.div.appendChild(this.maximizeDiv);a=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,a,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle);this.div.appendChild(this.minimizeDiv);this.minimizeControl()}this.map.getExtent()&&
this.update();this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});this.maximized&&this.maximizeControl();return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(a){var b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;if(0!=b||0!=c){var d=this.rectPxBounds.top,e=this.rectPxBounds.left;a=Math.abs(this.rectPxBounds.getHeight());var f=this.rectPxBounds.getWidth(),c=Math.max(0,
d-c),c=Math.min(c,this.ovmap.size.h-this.hComp-a),b=Math.max(0,e-b),b=Math.min(b,this.ovmap.size.w-this.wComp-f);this.setRectPxBounds(new OpenLayers.Bounds(b,c+a,b+f,c))}},mapDivClick:function(a){var b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left;a=Math.abs(this.rectPxBounds.getHeight());b=this.rectPxBounds.getWidth();d=Math.max(0,e+d);d=Math.min(d,this.ovmap.size.h-a);c=Math.max(0,f+c);c=Math.min(c,this.ovmap.size.w-b);this.setRectPxBounds(new OpenLayers.Bounds(c,
d+a,c+b,d));this.updateMapToRect()},onButtonClick:function(a){a.buttonElement===this.minimizeDiv?this.minimizeControl():a.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(a){this.element.style.display="";this.showToggle(!1);null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.element.style.display="none";this.showToggle(!0);null!=a&&OpenLayers.Event.stop(a)},showToggle:function(a){this.maximizeDiv&&(this.maximizeDiv.style.display=a?"":"none");this.minimizeDiv&&
(this.minimizeDiv.style.display=a?"none":"")},update:function(){null==this.ovmap&&this.createMap();!this.autoPan&&this.isSuitableOverview()||this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var a=this.map.getExtent(),b=this.map.getMaxExtent(),a=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));
b=this.ovmap.getResolution()/this.map.getResolution();return b>this.minRatio&&b<=this.maxRatio&&this.ovmap.getExtent().containsBounds(a)},updateOverview:function(){var a=this.map.getResolution(),b=this.ovmap.getResolution(),c=b/a;c>this.maxRatio?b=this.minRatio*a:c<=this.minRatio&&(b=this.maxRatio*a);this.ovmap.getProjection()!=this.map.getProjection()?(a=this.map.center.clone(),a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):a=this.map.center;this.ovmap.setCenter(a,
this.ovmap.getZoomForResolution(b*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var a=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,a);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=(this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,
"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")))?this.wComp:2;this.hComp=(this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")))?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},
{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register("mouseover",this,function(a){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()});this.rectEvents.register("mouseout",this,function(a){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var a=this.map.getProjectionObject().getUnits()||
this.map.units||this.map.baseLayer.units,b=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=a&&b?OpenLayers.INCHES_PER_UNIT[a]/OpenLayers.INCHES_PER_UNIT[b]:1}},updateRectToMap:function(){var a;a=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();(a=this.getRectBoundsFromMapBounds(a))&&this.setRectPxBounds(a)},updateMapToRect:function(){var a=
this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(a){var b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp);a=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp);var e=Math.max(a-c,0),f=Math.max(d-b,0);e<this.minRectSize||f<this.minRectSize?
(this.extentRectangle.className=this.displayClass+this.minRectDisplayClass,e=c+e/2-this.minRectSize/2,this.extentRectangle.style.top=Math.round(b+f/2-this.minRectSize/2)+"px",this.extentRectangle.style.left=Math.round(e)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"):(this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(b)+"px",this.extentRectangle.style.left=Math.round(c)+
"px",this.extentRectangle.style.height=Math.round(f)+"px",this.extentRectangle.style.width=Math.round(e)+"px");this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(a),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=this.getOverviewPxFromLonLat({lon:a.left,lat:a.bottom});a=this.getOverviewPxFromLonLat({lon:a.right,lat:a.top});var c=null;b&&a&&(c=new OpenLayers.Bounds(b.x,b.y,a.x,a.y));return c},getMapBoundsFromRectBounds:function(a){var b=this.getLonLatFromOverviewPx({x:a.left,
y:a.bottom});a=this.getLonLatFromOverviewPx({x:a.right,y:a.top});return new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat();return{lon:d.lon+(a.x-b.w/2)*c,lat:d.lat-(a.y-b.h/2)*c}},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution(),c=this.ovmap.getExtent();if(c)return{x:Math.round(1/b*(a.lon-c.left)),y:Math.round(1/b*(c.top-a.lat))}},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,
numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(a,b){this.metadata={};b=OpenLayers.Util.extend({},b);null!=this.alwaysInRange&&(b.alwaysInRange=this.alwaysInRange);this.addOptions(b);this.name=a;if(null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,
this.div),this.eventListeners instanceof Object))this.events.on(this.eventListeners)},destroy:function(a){null==a&&(a=!0);null!=this.map&&this.map.removeLayer(this,a);this.options=this.div=this.name=this.map=this.projection=null;this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy());this.events=this.eventListeners=null},clone:function(a){null==a&&(a=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(a,this);a.map=null;return a},
getOptions:function(){var a={},b;for(b in this.options)a[b]=this[b];return a},setName:function(a){a!=this.name&&(this.name=a,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(a,b){null==this.options&&(this.options={});a&&("string"==typeof a.projection&&(a.projection=new OpenLayers.Projection(a.projection)),a.projection&&OpenLayers.Util.applyDefaults(a,OpenLayers.Projection.defaults[a.projection.getCode()]),!a.maxExtent||a.maxExtent instanceof
OpenLayers.Bounds||(a.maxExtent=new OpenLayers.Bounds(a.maxExtent)),!a.minExtent||a.minExtent instanceof OpenLayers.Bounds||(a.minExtent=new OpenLayers.Bounds(a.minExtent)));OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a);this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits());if(this.map){var c=this.map.getResolution(),d=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]),e;for(e in a)if(a.hasOwnProperty(e)&&0<=OpenLayers.Util.indexOf(d,
e)){this.initResolutions();b&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(c),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var a=!1;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();b&&(this.inRange&&this.visibility)&&(this.moveTo(b,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),a=!0)}return a},moveTo:function(a,b,c){a=this.visibility;
this.isBaseLayer||(a=a&&this.inRange);this.display(a)},moveByPx:function(a,b){},setMap:function(a){null==this.map&&(this.map=a,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),
this.div.style.display=this.visibility&&this.inRange?"":"none"),this.setTileSize())},afterAdd:function(){},removeMap:function(a){},getImageSize:function(a){return this.imageSize||this.tileSize},setTileSize:function(a){this.tileSize=a=a?a:this.tileSize?this.tileSize:this.map.getTileSize();this.gutter&&(this.imageSize=new OpenLayers.Size(a.w+2*this.gutter,a.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(a){a!=this.visibility&&(this.visibility=a,this.display(a),
this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(a){a!=("none"!=this.div.style.display)&&(this.div.style.display=a&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var a=!1;this.alwaysInRange?a=!0:this.map&&(a=this.map.getResolution(),a=a>=this.minResolution&&a<=this.maxResolution);return a},setIsBaseLayer:function(a){a!=this.isBaseLayer&&(this.isBaseLayer=
a,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var a,b,c,d={},e=!0;a=0;for(b=this.RESOLUTION_PROPERTIES.length;a<b;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=this.options[c],e&&this.options[c]&&(e=!1);null==this.options.alwaysInRange&&(this.alwaysInRange=e);null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales));null==d.resolutions&&(d.resolutions=this.calculateResolutions(d));if(null==d.resolutions){a=0;for(b=this.RESOLUTION_PROPERTIES.length;a<
b;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=null!=this.options[c]?this.options[c]:this.map[c];null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales));null==d.resolutions&&(d.resolutions=this.calculateResolutions(d))}var f;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(f=this.options.maxResolution);this.options.minScale&&(f=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var g;this.options.minResolution&&"auto"!==this.options.minResolution&&
(g=this.options.minResolution);this.options.maxScale&&(g=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));d.resolutions&&(d.resolutions.sort(function(a,b){return b-a}),f||(f=d.resolutions[0]),g||(g=d.resolutions[d.resolutions.length-1]));if(this.resolutions=d.resolutions){b=this.resolutions.length;this.scales=Array(b);for(a=0;a<b;a++)this.scales[a]=OpenLayers.Util.getScaleFromResolution(this.resolutions[a],this.units);this.numZoomLevels=b}if(this.minResolution=g)this.maxScale=
OpenLayers.Util.getScaleFromResolution(g,this.units);if(this.maxResolution=f)this.minScale=OpenLayers.Util.getScaleFromResolution(f,this.units)},resolutionsFromScales:function(a){if(null!=a){var b,c,d;d=a.length;b=Array(d);for(c=0;c<d;c++)b[c]=OpenLayers.Util.getResolutionFromScale(a[c],this.units);return b}},calculateResolutions:function(a){var b,c,d=a.maxResolution;null!=a.minScale?d=OpenLayers.Util.getResolutionFromScale(a.minScale,this.units):"auto"==d&&null!=this.maxExtent&&(b=this.map.getSize(),
c=this.maxExtent.getWidth()/b.w,b=this.maxExtent.getHeight()/b.h,d=Math.max(c,b));c=a.minResolution;null!=a.maxScale?c=OpenLayers.Util.getResolutionFromScale(a.maxScale,this.units):"auto"==a.minResolution&&null!=this.minExtent&&(b=this.map.getSize(),c=this.minExtent.getWidth()/b.w,b=this.minExtent.getHeight()/b.h,c=Math.max(c,b));"number"!==typeof d&&("number"!==typeof c&&null!=this.maxExtent)&&(d=this.map.getTileSize(),d=Math.max(this.maxExtent.getWidth()/d.w,this.maxExtent.getHeight()/d.h));b=a.maxZoomLevel;
a=a.numZoomLevels;"number"===typeof c&&"number"===typeof d&&void 0===a?a=Math.floor(Math.log(d/c)/Math.log(2))+1:void 0===a&&null!=b&&(a=b+1);if(!("number"!==typeof a||0>=a||"number"!==typeof d&&"number"!==typeof c)){b=Array(a);var e=2;"number"==typeof c&&"number"==typeof d&&(e=Math.pow(d/c,1/(a-1)));var f;if("number"===typeof d)for(f=0;f<a;f++)b[f]=d/Math.pow(e,f);else for(f=0;f<a;f++)b[a-1-f]=c*Math.pow(e,f);return b}},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},
getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(a,b){var c=this.map.getSize(),c=Math.max(a.getWidth()/c.w,a.getHeight()/c.h);return this.getZoomForResolution(c,b)},getDataExtent:function(){},getResolutionForZoom:function(a){a=Math.max(0,Math.min(a,this.resolutions.length-1));if(this.map.fractionalZoom){var b=Math.floor(a),c=Math.ceil(a);a=this.resolutions[b]-(a-b)*(this.resolutions[b]-this.resolutions[c])}else a=this.resolutions[Math.round(a)];return a},getZoomForResolution:function(a,
b){var c,d;if(this.map.fractionalZoom){var e=0,f=this.resolutions[e],g=this.resolutions[this.resolutions.length-1],h;c=0;for(d=this.resolutions.length;c<d;++c)if(h=this.resolutions[c],h>=a&&(f=h,e=c),h<=a){g=h;break}c=f-g;c=0<c?e+(f-a)/c:e}else{f=Number.POSITIVE_INFINITY;c=0;for(d=this.resolutions.length;c<d;c++)if(b){e=Math.abs(this.resolutions[c]-a);if(e>f)break;f=e}else if(this.resolutions[c]<a)break;c=Math.max(0,c-1)}return c},getLonLatFromViewPortPx:function(a){var b=null,c=this.map;if(null!=
a&&c.minPx){var b=c.getResolution(),d=c.getMaxExtent({restricted:!0}),b=new OpenLayers.LonLat((a.x-c.minPx.x)*b+d.left,(c.minPx.y-a.y)*b+d.top);this.wrapDateLine&&(b=b.wrapDateLine(this.maxExtent))}return b},getViewPortPxFromLonLat:function(a,b){var c=null;null!=a&&(b=b||this.map.getResolution(),c=this.map.calculateBounds(null,b),c=new OpenLayers.Pixel(1/b*(a.lon-c.left),1/b*(c.top-a.lat)));return c},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=this.div.childNodes,c=0,d=b.length;c<
d;++c){var e=b[c].firstChild||b[c],f=b[c].lastChild;f&&"iframe"===f.nodeName.toLowerCase()&&(e=f.parentNode);OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,a)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(a){if(this.gutter){var b=this.gutter*this.map.getResolution();a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+
b,a.top+b)}this.wrapDateLine&&(b={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},a=a.wrapDateLine(this.maxExtent,b));return a},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Layer.SphericalMercator={getExtent:function(){var a=null;return a=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(a){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(a){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var a=0;a<=this.MAX_ZOOM_LEVEL;++a)this.RESOLUTIONS[a]=
156543.03390625/Math.pow(2,a);this.units="m";this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},a,b);return new OpenLayers.LonLat(e.x,e.y)}}(),inverseMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,
y:d},b,a);return new OpenLayers.LonLat(e.x,e.y)}}()};OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.pane=this.mapObject=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=
parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";"msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")");this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane);this.loadMapObject();null==this.mapObject&&this.loadWarningMessage()},removeMap:function(a){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane);
OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var a=this.map.getSize(),b=Math.min(a.w,300),c=Math.min(a.h,200),b=new OpenLayers.Size(b,c),a=(new OpenLayers.Pixel(a.w/2,a.h/2)).add(-b.w/2,-b.h/2),a=OpenLayers.Util.createDiv(this.name+"_warning",a,b,null,null,null,"auto");a.style.padding="7px";a.style.backgroundColor="yellow";a.innerHTML=this.getWarningHTML();this.div.appendChild(a)},getWarningHTML:function(){return""},
display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(a){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(a,b){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);this.dragPanMapObject?this.dragPanMapObject(a,-b):this.moveTo(this.map.getCachedCenter())},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,
arguments);if(null!=this.mapObject){var d=this.map.getCenter(),e=this.map.getZoom();if(null!=d){var f=this.getMapObjectCenter(),f=this.getOLLonLatFromMapObjectLonLat(f),g=this.getMapObjectZoom(),g=this.getOLZoomFromMapObjectZoom(g);d.equals(f)&&e==g||(!b&&f&&this.dragPanMapObject&&this.smoothDragPan?(e=this.map.getViewPortPxFromLonLat(f),d=this.map.getViewPortPxFromLonLat(d),this.dragPanMapObject(d.x-e.x,e.y-d.y)):(d=this.getMapObjectLonLatFromOLLonLat(d),e=this.getMapObjectZoomFromOLZoom(e),this.setMapObjectCenter(d,
e,c)))}}},getLonLatFromViewPortPx:function(a){var b=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(a=this.getMapObjectPixelFromOLPixel(a),a=this.getMapObjectLonLatFromMapObjectPixel(a),b=this.getOLLonLatFromMapObjectLonLat(a));return b},getViewPortPxFromLonLat:function(a){var b=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(a=this.getMapObjectLonLatFromOLLonLat(a),a=this.getMapObjectPixelFromMapObjectLonLat(a),b=this.getOLPixelFromMapObjectPixel(a));return b},getOLLonLatFromMapObjectLonLat:function(a){var b=
null;null!=a&&(b=this.getLongitudeFromMapObjectLonLat(a),a=this.getLatitudeFromMapObjectLonLat(a),b=new OpenLayers.LonLat(b,a));return b},getMapObjectLonLatFromOLLonLat:function(a){var b=null;null!=a&&(b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat));return b},getOLPixelFromMapObjectPixel:function(a){var b=null;null!=a&&(b=this.getXFromMapObjectPixel(a),a=this.getYFromMapObjectPixel(a),b=new OpenLayers.Pixel(b,a));return b},getMapObjectPixelFromOLPixel:function(a){var b=null;null!=a&&(b=this.getMapObjectPixelFromXY(a.x,
a.y));return b},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var a=["minZoomLevel","maxZoomLevel","numZoomLevels"],b=0,c=a.length;b<c;b++){var d=a[b];this[d]=null!=this.options[d]?this.options[d]:this.map[d]}if(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)this.minZoomLevel=this.MIN_ZOOM_LEVEL;a=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;b=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?
this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels;this.numZoomLevels=null!=b?Math.min(b,a):a;this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(null!=this.RESOLUTIONS){a=0;this.resolutions=[];for(b=this.minZoomLevel;b<=this.maxZoomLevel;b++)this.resolutions[a++]=this.RESOLUTIONS[b];this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,
arguments);var a=null,b=this.map.getSize(),c=this.getExtent();null!=b&&null!=c&&(a=Math.max(c.getWidth()/b.w,c.getHeight()/b.h));return a},getExtent:function(){var a=this.map.getSize(),b=this.getLonLatFromViewPortPx({x:0,y:0}),a=this.getLonLatFromViewPortPx({x:a.w,y:a.h});return null!=b&&null!=a?new OpenLayers.Bounds(b.lon,a.lat,a.lon,b.lat):null},getZoomForResolution:function(a){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var b=OpenLayers.Layer.prototype.getExtent.apply(this,
[]);return this.getZoomForExtent(b)},getOLZoomFromMapObjectZoom:function(a){var b=null;null!=a&&(b=a-this.minZoomLevel,this.map.baseLayer!==this&&(b=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(b))));return b},getMapObjectZoomFromOLZoom:function(a){var b=null;null!=a&&(b=a+this.minZoomLevel,this.map.baseLayer!==this&&(b=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(b))));return b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,6.866455078125E-4,3.4332275390625E-4,1.71661376953125E-4,8.58306884765625E-5,4.291534423828125E-5,2.145767211914062E-5,1.072883605957031E-5,5.36441802978515E-6,2.68220901489257E-6,1.341104507446289E-6,6.705522537231445E-7],
type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(a,b){b=b||{};b.version||(b.version="function"===typeof GMap2?"2":"3");var c=OpenLayers.Layer.Google["v"+b.version.replace(/\./g,"_")];if(c)OpenLayers.Util.applyDefaults(b,c);else throw"Unsupported Google Maps API version: "+b.version;OpenLayers.Util.applyDefaults(b,c.DEFAULTS);b.maxExtent&&(b.maxExtent=b.maxExtent.clone());OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[a,b]);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,
[a,b]);this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(a){var b=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(b)},display:function(a){this._dragging||this.setGMapVisibility(a);OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(a,
b,c){this._dragging=c;OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(a){a!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=a);if(this.getVisibility()){var b=this.getMapContainer();OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var a=OpenLayers.Layer.Google.cache[this.map.id];a&&1>=a.count&&
this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var a=OpenLayers.Layer.Google.cache[this.map.id];if(a){var b=this.mapObject&&this.getMapContainer();b&&b.parentNode&&b.parentNode.removeChild(b);(b=a.termsOfUse)&&b.parentNode&&b.parentNode.removeChild(b);(a=a.poweredBy)&&a.parentNode&&a.parentNode.removeChild(a);this.mapObject&&(window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners)&&google.maps.event.clearListeners(this.mapObject,
"tilesloaded")}},removeMap:function(a){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[a.id];b&&(1>=b.count?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[a.id]):--b.count);delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(a){var b=null;null!=a&&(b=a.getSouthWest(),a=a.getNorthEast(),this.sphericalMercator?
(b=this.forwardMercator(b.lng(),b.lat()),a=this.forwardMercator(a.lng(),a.lat())):(b=new OpenLayers.LonLat(b.lng(),b.lat()),a=new OpenLayers.LonLat(a.lng(),a.lat())),b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat));return b},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),
a.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lat:a.lat()},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.Google.cache={};
OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var a,b,c,d=OpenLayers.Layer.Google.cache[this.map.id];if(d)a=d.mapObject,b=d.termsOfUse,c=d.poweredBy,++d.count;else{var d=this.map.viewPortDiv,e=document.createElement("div");e.id=this.map.id+"_GMap2Container";e.style.position="absolute";e.style.width="100%";e.style.height="100%";d.appendChild(e);try{a=new GMap2(e),b=e.lastChild,d.appendChild(b),b.style.zIndex=
"1100",b.style.right="",b.style.bottom="",b.className="olLayerGoogleCopyright",c=e.lastChild,d.appendChild(c),c.style.zIndex="1100",c.style.right="",c.style.bottom="",c.className="olLayerGooglePoweredBy gmnoprint"}catch(f){throw f;}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:a,termsOfUse:b,poweredBy:c,count:1}}this.mapObject=a;this.termsOfUse=b;this.poweredBy=c;-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type);"function"==typeof a.getDragObject?
this.dragObject=a.getDragObject():this.dragPanMapObject=null;!1===this.isBaseLayer&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var a=this,b=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(b);delete a._resized;a.mapObject.checkResize();a.moveTo(a.map.getCenter(),a.map.getZoom())});this._resized=!0}},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id];
if(b){var c=this.mapObject.getContainer();!0===a?(this.mapObject.setMapType(this.type),c.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",b.displayed=this.id):(b.displayed===this.id&&delete b.displayed,b.displayed||(c.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(a){var b=
null;null!=a&&(b=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),a=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right),b=new GLatLngBounds(new GLatLng(b.lat,b.lon),new GLatLng(a.lat,a.lon)));return b},setMapObjectCenter:function(a,b){this.mapObject.setCenter(a,b)},dragPanMapObject:function(a,b){this.dragObject.moveBy(new GSize(-a,b))},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},
getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;this.sphericalMercator?(c=this.inverseMercator(a,b),c=new GLatLng(c.lat,c.lon)):c=new GLatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)}};OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[a]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var b in this.namespaces)this.namespaceAlias[this.namespaces[b]]=b},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,
arguments)},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a},read:function(a){var b=a.indexOf("<");0<b&&(a=a.substring(b));b=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var b;b=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom;b.loadXML(a);return b},this),function(){return(new DOMParser).parseFromString(a,"text/xml")},function(){var b=new XMLHttpRequest;b.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),!1);b.overrideMimeType&&
b.overrideMimeType("text/xml");b.send(null);return b.responseXML});this.keepData&&(this.data=b);return b},write:function(a){if(this.xmldom)a=a.xml;else{var b=new XMLSerializer;if(1==a.nodeType){var c=document.implementation.createDocument("","",null);c.importNode&&(a=c.importNode(a,!0));c.appendChild(a);a=b.serializeToString(c)}else a=b.serializeToString(a)}return a},createElementNS:function(a,b){return this.xmldom?"string"==typeof a?this.xmldom.createNode(1,b,a):this.xmldom.createNode(1,b,""):document.createElementNS(a,
b)},createDocumentFragment:function(){return this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(a){"string"!==typeof a&&(a=String(a));return this.xmldom?this.xmldom.createTextNode(a):document.createTextNode(a)},getElementsByTagNameNS:function(a,b,c){var d=[];if(a.getElementsByTagNameNS)d=a.getElementsByTagNameNS(b,c);else{a=a.getElementsByTagName("*");for(var e,f,g=0,h=a.length;g<h;++g)if(e=a[g],f=e.prefix?e.prefix+":"+c:c,"*"==c||f==e.nodeName)"*"!=
b&&b!=e.namespaceURI||d.push(e)}return d},getAttributeNodeNS:function(a,b,c){var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else{a=a.attributes;for(var e,f,g=0,h=a.length;g<h;++g)if(e=a[g],e.namespaceURI==b&&(f=e.prefix?e.prefix+":"+c:c,f==e.nodeName)){d=e;break}}return d},getAttributeNS:function(a,b,c){var d="";if(a.getAttributeNS)d=a.getAttributeNS(b,c)||"";else if(a=this.getAttributeNodeNS(a,b,c))d=a.nodeValue;return d},getChildValue:function(a,b){var c=b||"";if(a)for(var d=a.firstChild;d;d=
d.nextSibling)switch(d.nodeType){case 3:case 4:c+=d.nodeValue}return c},isSimpleContent:function(a){var b=!0;for(a=a.firstChild;a;a=a.nextSibling)if(1===a.nodeType){b=!1;break}return b},contentType:function(a){var b=!1,c=!1,d=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(a=a.firstChild;a;a=a.nextSibling){switch(a.nodeType){case 1:c=!0;break;case 8:break;default:b=!0}if(c&&b)break}if(c&&b)d=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(c)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(b)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return d},
hasAttributeNS:function(a,b,c){var d=!1;return d=a.hasAttributeNS?a.hasAttributeNS(b,c):!!this.getAttributeNodeNS(a,b,c)},setAttributeNS:function(a,b,c,d){if(a.setAttributeNS)a.setAttributeNS(b,c,d);else if(this.xmldom)b?(b=a.ownerDocument.createNode(2,c,b),b.nodeValue=d,a.setAttributeNode(b)):a.setAttribute(c,d);else throw"setAttributeNS not implemented";},createElementNSPlus:function(a,b){b=b||{};var c=b.uri||this.namespaces[b.prefix];c||(c=a.indexOf(":"),c=this.namespaces[a.substring(0,c)]);c||
(c=this.namespaces[this.defaultPrefix]);c=this.createElementNS(c,a);b.attributes&&this.setAttributes(c,b.attributes);var d=b.value;null!=d&&c.appendChild(this.createTextNode(d));return c},setAttributes:function(a,b){var c,d,e;for(e in b)null!=b[e]&&b[e].toString&&(c=b[e].toString(),d=this.namespaces[e.substring(0,e.indexOf(":"))]||null,this.setAttributeNS(a,d,e,c))},readNode:function(a,b){b||(b={});var c=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];if(c){var d=
a.localName||a.nodeName.split(":").pop();(c=c[d]||c["*"])&&c.apply(this,[a,b])}return b},readChildNodes:function(a,b){b||(b={});for(var c=a.childNodes,d,e=0,f=c.length;e<f;++e)d=c[e],1==d.nodeType&&this.readNode(d,b);return b},writeNode:function(a,b,c){var d,e=a.indexOf(":");0<e?(d=a.substring(0,e),a=a.substring(e+1)):d=c?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix;b=this.writers[d][a].apply(this,[b]);c&&c.appendChild(b);return b},getChildEl:function(a,b,c){return a&&this.getThisOrNextEl(a.firstChild,
b,c)},getNextEl:function(a,b,c){return a&&this.getThisOrNextEl(a.nextSibling,b,c)},getThisOrNextEl:function(a,b,c){a:for(;a;a=a.nextSibling)switch(a.nodeType){case 1:if(!(b&&b!==(a.localName||a.nodeName.split(":").pop())||c&&c!==a.namespaceURI))break a;a=null;break a;case 3:if(/^\s*$/.test(a.nodeValue))break;case 4:case 6:case 12:case 10:case 11:a=null;break a}return a||null},lookupNamespaceURI:function(a,b){var c=null;if(a)if(a.lookupNamespaceURI)c=a.lookupNamespaceURI(b);else a:switch(a.nodeType){case 1:if(null!==
a.namespaceURI&&a.prefix===b){c=a.namespaceURI;break a}if(c=a.attributes.length)for(var d,e=0;e<c;++e)if(d=a.attributes[e],"xmlns"===d.prefix&&d.name==="xmlns:"+b){c=d.value||null;break a}else if("xmlns"===d.name&&null===b){c=d.value||null;break a}c=this.lookupNamespaceURI(a.parentNode,b);break a;case 2:c=this.lookupNamespaceURI(a.ownerElement,b);break a;case 9:c=this.lookupNamespaceURI(a.documentElement,b);break a;case 6:case 12:case 10:case 11:break a;default:c=this.lookupNamespaceURI(a.parentNode,
b)}return c},getXMLDoc:function(){OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")));return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};
OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.WFST=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.WFST.DEFAULTS);var b=OpenLayers.Format.WFST["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFST version: "+a.version;return new b(a)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(a,b,c){this.layer=a;this.lonlat=b;this.data=null!=c?c:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup);null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker);this.data=this.lonlat=this.id=this.layer=null;null!=this.marker&&
(this.destroyMarker(this.marker),this.marker=null);null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var a=!1;null!=this.layer&&null!=this.layer.map&&(a=this.layer.map.getExtent().containsLonLat(this.lonlat));return a},createMarker:function(){null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(a){null!=this.lonlat&&(this.popup||(this.popup=new (this.popupClass?
this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,a)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this);return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};
OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(a,b,c){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]);this.lonlat=null;this.geometry=a?a:null;this.state=null;this.attributes={};b&&(this.attributes=OpenLayers.Util.extend(this.attributes,b));this.style=c?c:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=
null);this.modified=this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var b=!1;this.layer&&this.layer.map&&(b=this.layer.map.getExtent(),a?(a=this.geometry.getBounds(),b=b.intersectsBounds(a)):b=b.toGeometry().intersects(this.geometry));return b},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||
this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,b,c){var d=!1;this.geometry&&(d=this.geometry.atPoint(a,b,c));return d},destroyPopup:function(){},move:function(a){if(this.layer&&this.geometry.move){a="OpenLayers.LonLat"==a.CLASS_NAME?this.layer.getViewPortPxFromLonLat(a):a;var b=
this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),c=this.layer.map.getResolution();this.geometry.move(c*(a.x-b.x),c*(b.y-a.y));this.layer.drawFeature(this);return b}},toState:function(a){if(a==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a}else if(a==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a}else if(a==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=
a}else a==OpenLayers.State.UNKNOWN&&(this.state=a)},CLASS_NAME:"OpenLayers.Feature.Vector"});
OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:0.4,
hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,
strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(a,b){OpenLayers.Util.extend(this,b);this.rules=[];b&&b.rules&&this.addRules(b.rules);this.setDefaultStyle(a||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++)this.rules[a].destroy(),
this.rules[a]=null;this.defaultStyle=this.rules=null},createSymbolizer:function(a){for(var b=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),a),c=this.rules,d,e=[],f=!1,g=0,h=c.length;g<h;g++)d=c[g],d.evaluate(a)&&(d instanceof OpenLayers.Rule&&d.elseFilter?e.push(d):(f=!0,this.applySymbolizer(d,b,a)));if(!1==f&&0<e.length)for(f=!0,g=0,h=e.length;g<h;g++)this.applySymbolizer(e[g],b,a);0<c.length&&!1==f&&(b.display="none");null!=b.label&&"string"!==typeof b.label&&
(b.label=String(b.label));return b},applySymbolizer:function(a,b,c){var d=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];a=a.symbolizer[d]||a.symbolizer;!0===this.defaultsPerSymbolizer&&(d=this.defaultStyle,OpenLayers.Util.applyDefaults(a,{pointRadius:d.pointRadius}),!0!==a.stroke&&!0!==a.graphic||OpenLayers.Util.applyDefaults(a,{strokeWidth:d.strokeWidth,strokeColor:d.strokeColor,strokeOpacity:d.strokeOpacity,strokeDashstyle:d.strokeDashstyle,strokeLinecap:d.strokeLinecap}),
!0!==a.fill&&!0!==a.graphic||OpenLayers.Util.applyDefaults(a,{fillColor:d.fillColor,fillOpacity:d.fillOpacity}),!0===a.graphic&&OpenLayers.Util.applyDefaults(a,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset}));
return this.createLiterals(OpenLayers.Util.extend(b,a),c)},createLiterals:function(a,b){var c=OpenLayers.Util.extend({},b.attributes||b.data);OpenLayers.Util.extend(c,this.context);for(var d in this.propertyStyles)a[d]=OpenLayers.Style.createLiteral(a[d],c,b,d);return a},findPropertyStyles:function(){var a={};this.addPropertyStyles(a,this.defaultStyle);for(var b=this.rules,c,d,e=0,f=b.length;e<f;e++){c=b[e].symbolizer;for(var g in c)if(d=c[g],"object"==typeof d)this.addPropertyStyles(a,d);else{this.addPropertyStyles(a,
c);break}}return a},addPropertyStyles:function(a,b){var c,d;for(d in b)c=b[d],"string"==typeof c&&c.match(/\$\{\w+\}/)&&(a[d]=!0);return a},addRules:function(a){Array.prototype.push.apply(this.rules,a);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(a){for(var b=OpenLayers.Style.SYMBOLIZER_PREFIXES,c=0,d=b.length;c<d;c++)if(-1!=a.CLASS_NAME.indexOf(b[c]))return b[c]},clone:function(){var a=
OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;b<c;++b)a.rules.push(this.rules[b].clone())}a.context=this.context&&OpenLayers.Util.extend({},this.context);b=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(b,a)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(a,b,c,d){"string"==typeof a&&-1!=a.indexOf("${")&&(a=OpenLayers.String.format(a,b,[c,d]),a=isNaN(a)||!a?a:parseFloat(a));return a};
OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(a){return!0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(a){var b=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(a.geometry){var c=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(c=this.value.toGeometry());a.geometry.intersects(c)&&(b=!0)}break;default:throw Error("evaluate is not implemented for this filter type.");}return b},clone:function(){var a=
OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(a){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){for(var b=0,c=this.fids.length;b<c;b++)if((a.fid||a.id)==this.fids[b])return!0;return!1},clone:function(){var a=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(a,this);a.fids=this.fids.slice();return a},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(a){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]=
"wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(a,b){var c=b&&b.srsName;c||(c=a&&a.layer?a.layer.projection.getCode():this.srsName);return c},read:function(a,b){b=b||{};OpenLayers.Util.applyDefaults(b,{output:"features"});"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var c={};a&&this.readNode(a,c,!0);c.features&&"features"===b.output&&
(c=c.features);return c},readers:{wfs:{FeatureCollection:function(a,b){b.features=[];this.readChildNodes(a,b)}}},write:function(a,b){var c=this.writeNode("wfs:Transaction",{features:a,options:b}),d=this.schemaLocationAttr();d&&this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",d);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{wfs:{GetFeature:function(a){var b=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:a&&a.handle,
outputFormat:a&&a.outputFormat,maxFeatures:a&&a.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(a)}});if("string"==typeof this.featureType)this.writeNode("Query",a,b);else for(var c=0,d=this.featureType.length;c<d;c++)a.featureType=this.featureType[c],this.writeNode("Query",a,b);return b},Transaction:function(a){a=a||{};var b=a.options||{},c=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:b.handle}}),d,e=a.features;if(e){!0===b.multi&&OpenLayers.Util.extend(this.geometryTypes,
{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"});var f,g;a=0;for(d=e.length;a<d;++a)g=e[a],(f=this.stateName[g.state])&&this.writeNode(f,{feature:g,options:b},c);!0===b.multi&&this.setGeometryTypes()}if(b.nativeElements)for(a=0,d=b.nativeElements.length;a<d;++a)this.writeNode("wfs:Native",b.nativeElements[a],c);return c},Native:function(a){return this.createElementNSPlus("wfs:Native",
{attributes:{vendorId:a.vendorId,safeToIgnore:a.safeToIgnore},value:a.value})},Insert:function(a){var b=a.feature;a=a.options;a=this.createElementNSPlus("wfs:Insert",{attributes:{handle:a&&a.handle}});this.srsName=this.getSrsName(b);this.writeNode("feature:_typeName",b,a);return a},Update:function(a){var b=a.feature;a=a.options;a=this.createElementNSPlus("wfs:Update",{attributes:{handle:a&&a.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&a.setAttribute("xmlns:"+
this.featurePrefix,this.featureNS);var c=b.modified;null===this.geometryName||c&&void 0===c.geometry||(this.srsName=this.getSrsName(b),this.writeNode("Property",{name:this.geometryName,value:b.geometry},a));for(var d in b.attributes)void 0===b.attributes[d]||c&&c.attributes&&(!c.attributes||void 0===c.attributes[d])||this.writeNode("Property",{name:d,value:b.attributes[d]},a);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),a);return a},Property:function(a){var b=this.createElementNSPlus("wfs:Property");
this.writeNode("Name",a.name,b);null!==a.value&&this.writeNode("Value",a.value,b);return b},Name:function(a){return this.createElementNSPlus("wfs:Name",{value:a})},Value:function(a){var b;a instanceof OpenLayers.Geometry?(b=this.createElementNSPlus("wfs:Value"),a=this.writeNode("feature:_geometry",a).firstChild,b.appendChild(a)):b=this.createElementNSPlus("wfs:Value",{value:a});return b},Delete:function(a){var b=a.feature;a=a.options;a=this.createElementNSPlus("wfs:Delete",{attributes:{handle:a&&
a.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&a.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),a);return a}}},schemaLocationAttr:function(a){a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a);var b=OpenLayers.Util.extend({},this.schemaLocations);a.schema&&(b[a.featurePrefix]=a.schema);a=[];var c,d;for(d in b)(c=this.namespaces[d])&&
a.push(c+" "+b[d]);return a.join(" ")||void 0},setFilterProperty:function(a){if(a.filters)for(var b=0,c=a.filters.length;b<c;++b)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,a.filters[b]);else a instanceof OpenLayers.Filter.Spatial&&!a.property&&(a.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b={exceptionReport:null};a.documentElement&&(this.readChildNodes(a,b),null===b.exceptionReport&&(b=(new OpenLayers.Format.OWSCommon).read(a)));return b},readers:{ogc:{ServiceExceptionReport:function(a,
b){b.exceptionReport={exceptions:[]};this.readChildNodes(a,b.exceptionReport)},ServiceException:function(a,b){var c={code:a.getAttribute("code"),locator:a.getAttribute("locator"),text:this.getChildValue(a)};b.exceptions.push(c)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);a=this.CLASS_NAME;this.name=a.substring(a.lastIndexOf(".")+1)},getVersion:function(a,b){var c;a?(c=this.version,c||(c=a.getAttribute("version"),c||(c=this.defaultVersion))):c=b&&b.version||this.version||this.defaultVersion;return c},getParser:function(a){a=
a||this.defaultVersion;var b=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=a){var c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")+b];if(!c&&(""!==b&&this.allowFallback&&(b="",c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")]),!c))throw"Can't find a "+this.name+" parser for version "+a+b;this.parser=new c(this.options)}return this.parser},write:function(a,b){var c=this.getVersion(null,b);this.parser=this.getParser(c);c=this.parser.write(a,b);return!1===this.stringifyOutput?
c:OpenLayers.Format.XML.prototype.write.apply(this,[c])},read:function(a,b){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=this.getVersion(a.documentElement);this.parser=this.getParser(c);var d=this.parser.read(a,b),e=this.parser.errorProperty||null;null!==e&&void 0===d[e]&&(e=new OpenLayers.Format.OGCExceptionReport,d.error=e.read(a));d.version=c;return d},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(a){var b,c;switch(this.type){case OpenLayers.Filter.Logical.AND:b=0;for(c=this.filters.length;b<c;b++)if(!1==this.filters[b].evaluate(a))return!1;return!0;case OpenLayers.Filter.Logical.OR:b=0;for(c=this.filters.length;b<
c;b++)if(!0==this.filters[b].evaluate(a))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(a)}},clone:function(){for(var a=[],b=0,c=this.filters.length;b<c;++b)a.push(this.filters[b].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:a})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]);this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===a.matchCase&&(this.matchCase=null)},evaluate:function(a){a instanceof OpenLayers.Feature.Vector&&(a=a.attributes);var b=!1;a=a[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:b=this.value;
b=this.matchCase||"string"!=typeof a||"string"!=typeof b?a==b:a.toUpperCase()==b.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:b=this.value;b=this.matchCase||"string"!=typeof a||"string"!=typeof b?a!=b:a.toUpperCase()!=b.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:b=a<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:b=a>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:b=a<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:b=
a>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:b=a>=this.lowerBoundary&&a<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:b=RegExp(this.value,"gi").test(a);break;case OpenLayers.Filter.Comparison.IS_NULL:b=null===a}return b},value2regex:function(a,b,c){if("."==a)throw Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");a=a?a:"*";b=b?b:".";this.value=this.value.replace(RegExp("\\"+(c?c:"!")+"(.|$)","g"),"\\$1");this.value=this.value.replace(RegExp("\\"+
b,"g"),".");this.value=this.value.replace(RegExp("\\"+a,"g"),".*");this.value=this.value.replace(RegExp("\\\\.\\*","g"),"\\"+a);return this.value=this.value.replace(RegExp("\\\\\\.","g"),"\\"+b)},regex2value:function(){var a=this.value,a=a.replace(/!/g,"!!"),a=a.replace(/(\\)?\\\./g,function(a,c){return c?a:"!."}),a=a.replace(/(\\)?\\\*/g,function(a,c){return c?a:"!*"}),a=a.replace(/\\\\/g,"\\");return a=a.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,
this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Comparison.IS_NULL="NULL";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(a){return a.toISOString()}:function(a){return isNaN(a.getTime())?"Invalid Date":a.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(a.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(a.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(a.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCMinutes(),
2)+":"+OpenLayers.Number.zeroPad(a.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(a.getUTCMilliseconds(),3)+"Z"}}(),parse:function(a){var b;if((a=a.match(this.dateRegEx))&&(a[1]||a[7])){b=parseInt(a[1],10)||0;var c=parseInt(a[2],10)-1||0,d=parseInt(a[3],10)||1;b=new Date(Date.UTC(b,c,d));if(c=a[7]){var d=parseInt(a[4],10),e=parseInt(a[5],10),f=parseFloat(a[6]),g=f|0,f=Math.round(1E3*(f-g));b.setUTCHours(d,e,g,f);"Z"!==c&&(c=parseInt(c,10),a=parseInt(a[8],10)||0,a=-1E3*(60*60*c+60*a),b=new Date(b.getTime()+
a))}}else b=new Date("invalid");return b}};OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};this.readers.ogc.Filter.apply(this,[a,b]);return b.filter},readers:{ogc:{_expression:function(a){for(var b="",c=a.firstChild;c;c=
c.nextSibling)switch(c.nodeType){case 1:a=this.readNode(c);a.property?b+="${"+a.property+"}":void 0!==a.value&&(b+=a.value);break;case 3:case 4:b+=c.nodeValue}return b},Filter:function(a,b){var c={fids:[],filters:[]};this.readChildNodes(a,c);0<c.fids.length?b.filter=new OpenLayers.Filter.FeatureId({fids:c.fids}):0<c.filters.length&&(b.filter=c.filters[0])},FeatureId:function(a,b){var c=a.getAttribute("fid");c&&b.fids.push(c)},And:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});
this.readChildNodes(a,c);b.filters.push(c)},Or:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(a,c);b.filters.push(c)},Not:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLessThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsGreaterThan:function(a,
b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLessThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsGreaterThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},
PropertyIsBetween:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(a,c);b.filters.push(c)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a),!0)},PropertyName:function(a,b){b.property=this.getChildValue(a)},LowerBoundary:function(a,b){b.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},UpperBoundary:function(a,b){b.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,
a),!0)},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a));b.distanceUnits=a.getAttribute("units")},Function:function(a,b){},PropertyIsNull:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});
this.readChildNodes(a,c);b.filters.push(c)}}},readSpatial:function(a,b,c){c=new OpenLayers.Filter.Spatial({type:c});this.readChildNodes(a,c);c.value=c.components[0];delete c.components;b.filters.push(c)},encodeLiteral:function(a){a instanceof Date&&(a=OpenLayers.Date.toISOString(a));return a},writeOgcExpression:function(a,b){a instanceof OpenLayers.Filter.Function?this.writeNode("Function",a,b):this.writeNode("Literal",a,b);return b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},
writers:{ogc:{Filter:function(a){var b=this.createElementNSPlus("ogc:Filter");this.writeNode(this.getFilterType(a),a,b);return b},_featureIds:function(a){for(var b=this.createDocumentFragment(),c=0,d=a.fids.length;c<d;++c)this.writeNode("ogc:FeatureId",a.fids[c],b);return b},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(a){for(var b=this.createElementNSPlus("ogc:And"),c,d=0,e=a.filters.length;d<e;++d)c=a.filters[d],this.writeNode(this.getFilterType(c),
c,b);return b},Or:function(a){for(var b=this.createElementNSPlus("ogc:Or"),c,d=0,e=a.filters.length;d<e;++d)c=a.filters[d],this.writeNode(this.getFilterType(c),c,b);return b},Not:function(a){var b=this.createElementNSPlus("ogc:Not");a=a.filters[0];this.writeNode(this.getFilterType(a),a,b);return b},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsGreaterThan:function(a){var b=
this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);
return b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",a,b);this.writeNode("LowerBoundary",a,b);this.writeNode("UpperBoundary",a,b);return b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){return this.createElementNSPlus("ogc:Literal",{value:(this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral)(a)})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");
this.writeOgcExpression(a.lowerBoundary,b);return b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",a.upperBoundary,b);return b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");this.writeNode("Distance",a,b);return b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",
{attributes:{units:a.distanceUnits},value:a.distance})},Function:function(a){var b=this.createElementNSPlus("ogc:Function",{attributes:{name:a.name}});a=a.params;for(var c=0,d=a.length;c<d;c++)this.writeOgcExpression(a[c],b);return b},PropertyIsNull:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNull");this.writeNode("PropertyName",a,b);return b}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b)throw"Filter writing not supported for rule type: "+a.type;return b},filterMap:{"&&":"And",
"||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(a){a&&(this.bounds=a.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(a){this.getBounds()?this.bounds.extend(a):this.setBounds(a)},getBounds:function(){null==this.bounds&&this.calculateBounds();
return this.bounds},calculateBounds:function(){},distanceTo:function(a,b){},getVertices:function(a){},atPoint:function(a,b,c){var d=!1;null!=this.getBounds()&&null!=a&&(b=null!=b?b:0,c=null!=c?c:0,d=(new OpenLayers.Bounds(this.bounds.left-b,this.bounds.bottom-c,this.bounds.right+b,this.bounds.top+c)).containsLonLat(a));return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):
Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(a){var b;if(OpenLayers.Format&&OpenLayers.Format.WKT){var c=OpenLayers.Geometry.fromWKT.format;c||(c=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=c);a=c.read(a);if(a instanceof OpenLayers.Feature.Vector)b=a.geometry;else if(OpenLayers.Util.isArray(a)){b=a.length;for(var c=Array(b),d=0;d<b;++d)c[d]=a[d].geometry;b=new OpenLayers.Geometry.Collection(c)}}return b};
OpenLayers.Geometry.segmentsIntersect=function(a,b,c){var d=c&&c.point;c=c&&c.tolerance;var e=!1,f=a.x1-b.x1,g=a.y1-b.y1,h=a.x2-a.x1,k=a.y2-a.y1,l=b.y2-b.y1,m=b.x2-b.x1,n=l*h-m*k,l=m*g-l*f,g=h*g-k*f;0==n?0==l&&0==g&&(e=!0):(f=l/n,n=g/n,0<=f&&(1>=f&&0<=n&&1>=n)&&(d?(h=a.x1+f*h,n=a.y1+f*k,e=new OpenLayers.Geometry.Point(h,n)):e=!0));if(c)if(e){if(d)a:for(a=[a,b],b=0;2>b;++b)for(f=a[b],k=1;3>k;++k)if(h=f["x"+k],n=f["y"+k],d=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(n-e.y,2)),d<c){e.x=h;e.y=n;break a}}else a:for(a=
[a,b],b=0;2>b;++b)for(h=a[b],n=a[(b+1)%2],k=1;3>k;++k)if(f={x:h["x"+k],y:h["y"+k]},g=OpenLayers.Geometry.distanceToSegment(f,n),g.distance<c){e=d?new OpenLayers.Geometry.Point(f.x,f.y):!0;break a}return e};OpenLayers.Geometry.distanceToSegment=function(a,b){var c=OpenLayers.Geometry.distanceSquaredToSegment(a,b);c.distance=Math.sqrt(c.distance);return c};
OpenLayers.Geometry.distanceSquaredToSegment=function(a,b){var c=a.x,d=a.y,e=b.x1,f=b.y1,g=b.x2,h=b.y2,k=g-e,l=h-f,m=(k*(c-e)+l*(d-f))/(Math.pow(k,2)+Math.pow(l,2));0>=m||(1<=m?(e=g,f=h):(e+=m*k,f+=m*l));return{distance:Math.pow(e-c,2)+Math.pow(f-d,2),x:e,y:f,along:m}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b)},clone:function(a){null==a&&(a=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(a,this);return a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(a,b){var c=!(b&&!1===b.edge)&&b&&b.details,d,e,f,g,h;a instanceof
OpenLayers.Geometry.Point?(e=this.x,f=this.y,g=a.x,h=a.y,d=Math.sqrt(Math.pow(e-g,2)+Math.pow(f-h,2)),d=c?{x0:e,y0:f,x1:g,y1:h,distance:d}:d):(d=a.distanceTo(this,b),c&&(d={x0:d.x1,y0:d.y1,x1:d.x0,y1:d.y0,distance:d.distance}));return d},equals:function(a){var b=!1;null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y));return b},toShortString:function(){return this.x+", "+this.y},move:function(a,b){this.x+=a;this.y+=b;this.clearBounds()},rotate:function(a,b){a*=
Math.PI/180;var c=this.distanceTo(b),d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d);this.y=b.y+c*Math.sin(d);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(a,b,c){this.x=b.x+a*(void 0==c?1:c)*(this.x-b.x);this.y=b.y+a*(this.y-b.y);this.clearBounds();return this},intersects:function(a){var b=!1;return b="OpenLayers.Geometry.Point"==a.CLASS_NAME?this.equals(a):a.intersects(this)},transform:function(a,b){a&&b&&(OpenLayers.Projection.transform(this,
a,b),this.bounds=null);return this},getVertices:function(a){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=a&&this.addComponents(a)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var a=eval("new "+this.CLASS_NAME+"()"),b=0,c=this.components.length;b<c;b++)a.addComponent(this.components[b].clone());
OpenLayers.Util.applyDefaults(a,this);return a},getComponentsString:function(){for(var a=[],b=0,c=this.components.length;b<c;b++)a.push(this.components[b].toShortString());return a.join(",")},calculateBounds:function(){this.bounds=null;var a=new OpenLayers.Bounds,b=this.components;if(b)for(var c=0,d=b.length;c<d;c++)a.extend(b[c].getBounds());null!=a.left&&(null!=a.bottom&&null!=a.right&&null!=a.top)&&this.setBounds(a)},addComponents:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<
c;b++)this.addComponent(a[b])},addComponent:function(a,b){var c=!1;if(a&&(null==this.componentTypes||-1<OpenLayers.Util.indexOf(this.componentTypes,a.CLASS_NAME))){if(null!=b&&b<this.components.length){var c=this.components.slice(0,b),d=this.components.slice(b,this.components.length);c.push(a);this.components=c.concat(d)}else this.components.push(a);a.parent=this;this.clearBounds();c=!0}return c},removeComponents:function(a){var b=!1;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=a.length-1;0<=c;--c)b=
this.removeComponent(a[c])||b;return b},removeComponent:function(a){OpenLayers.Util.removeItem(this.components,a);this.clearBounds();return!0},getLength:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getLength();return a},getArea:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getArea();return a},getGeodesicArea:function(a){for(var b=0,c=0,d=this.components.length;c<d;c++)b+=this.components[c].getGeodesicArea(a);return b},getCentroid:function(a){if(!a)return this.components.length&&
this.components[0].getCentroid();a=this.components.length;if(!a)return!1;for(var b=[],c=[],d=0,e=Number.MAX_VALUE,f,g=0;g<a;++g){f=this.components[g];var h=f.getArea();f=f.getCentroid(!0);isNaN(h)||(isNaN(f.x)||isNaN(f.y))||(b.push(h),d+=h,e=h<e&&0<h?h:e,c.push(f))}a=b.length;if(0===d){for(g=0;g<a;++g)b[g]=1;d=b.length}else{for(g=0;g<a;++g)b[g]/=e;d/=e}for(var k=e=0,g=0;g<a;++g)f=c[g],h=b[g],e+=f.x*h,k+=f.y*h;return new OpenLayers.Geometry.Point(e/d,k/d)},getGeodesicLength:function(a){for(var b=0,
c=0,d=this.components.length;c<d;c++)b+=this.components[c].getGeodesicLength(a);return b},move:function(a,b){for(var c=0,d=this.components.length;c<d;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0;d<this.components.length;++d)this.components[d].resize(a,b,c);return this},distanceTo:function(a,b){for(var c=!(b&&!1===b.edge)&&b&&b.details,d,e,f,g=Number.POSITIVE_INFINITY,h=0,k=this.components.length;h<
k&&!(d=this.components[h].distanceTo(a,b),f=c?d.distance:d,f<g&&(g=f,e=d,0==g));++h);return e},equals:function(a){var b=!0;if(a&&a.CLASS_NAME&&this.CLASS_NAME==a.CLASS_NAME)if(OpenLayers.Util.isArray(a.components)&&a.components.length==this.components.length)for(var c=0,d=this.components.length;c<d;++c){if(!this.components[c].equals(a.components[c])){b=!1;break}}else b=!1;else b=!1;return b},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d;c++)this.components[c].transform(a,
b);this.bounds=null}return this},intersects:function(a){for(var b=!1,c=0,d=this.components.length;c<d&&!(b=a.intersects(this.components[c]));++c);return b},getVertices:function(a){for(var b=[],c=0,d=this.components.length;c<d;++c)Array.prototype.push.apply(b,this.components[c].getVertices(a));return b},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var a=0;if(this.components&&1<this.components.length)for(var b=1,c=this.components.length;b<c;b++)a+=this.components[b-1].distanceTo(this.components[b]);return a},getGeodesicLength:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}a=0;if(b.components&&1<b.components.length)for(var d,e=1,f=b.components.length;e<
f;e++)c=b.components[e-1],d=b.components[e],a+=OpenLayers.Util.distVincenty({lon:c.x,lat:c.y},{lon:d.x,lat:d.y});return 1E3*a},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(a){var b=this.components&&2<this.components.length;b&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return b},intersects:function(a){var b=!1,c=a.CLASS_NAME;if("OpenLayers.Geometry.LineString"==c||"OpenLayers.Geometry.LinearRing"==c||"OpenLayers.Geometry.Point"==c){var d=this.getSortedSegments();a="OpenLayers.Geometry.Point"==c?[{x1:a.x,y1:a.y,x2:a.x,y2:a.y}]:a.getSortedSegments();
var e,f,g,h,k,l,m,n=0,p=d.length;a:for(;n<p;++n){c=d[n];e=c.x1;f=c.x2;g=c.y1;h=c.y2;var q=0,r=a.length;for(;q<r;++q){k=a[q];if(k.x1>f)break;if(!(k.x2<e||(l=k.y1,m=k.y2,Math.min(l,m)>Math.max(g,h)||Math.max(l,m)<Math.min(g,h)||!OpenLayers.Geometry.segmentsIntersect(c,k)))){b=!0;break a}}}}else b=a.intersects(this);return b},getSortedSegments:function(){for(var a=this.components.length-1,b=Array(a),c,d,e=0;e<a;++e)c=this.components[e],d=this.components[e+1],b[e]=c.x<d.x?{x1:c.x,y1:c.y,x2:d.x,y2:d.y}:
{x1:d.x,y1:d.y,x2:c.x,y2:c.y};return b.sort(function(a,b){return a.x1-b.x1})},splitWithSegment:function(a,b){for(var c=!(b&&!1===b.edge),d=b&&b.tolerance,e=[],f=this.getVertices(),g=[],h=[],k=!1,l,m,n,p={point:!0,tolerance:d},q=null,r=0,s=f.length-2;r<=s;++r)if(d=f[r],g.push(d.clone()),l=f[r+1],m={x1:d.x,y1:d.y,x2:l.x,y2:l.y},m=OpenLayers.Geometry.segmentsIntersect(a,m,p),m instanceof OpenLayers.Geometry.Point&&((n=m.x===a.x1&&m.y===a.y1||m.x===a.x2&&m.y===a.y2||m.equals(d)||m.equals(l)?!0:!1)||c))m.equals(h[h.length-
1])||h.push(m.clone()),0===r&&m.equals(d)||m.equals(l)||(k=!0,m.equals(d)||g.push(m),e.push(new OpenLayers.Geometry.LineString(g)),g=[m.clone()]);k&&(g.push(l.clone()),e.push(new OpenLayers.Geometry.LineString(g)));if(0<h.length)var t=a.x1<a.x2?1:-1,u=a.y1<a.y2?1:-1,q={lines:e,points:h.sort(function(a,b){return t*a.x-t*b.x||u*a.y-u*b.y})};return q},split:function(a,b){var c=null,d=b&&b.mutual,e,f,g,h;if(a instanceof OpenLayers.Geometry.LineString){var k=this.getVertices(),l,m,n,p,q,r=[];g=[];for(var s=
0,t=k.length-2;s<=t;++s){l=k[s];m=k[s+1];n={x1:l.x,y1:l.y,x2:m.x,y2:m.y};h=h||[a];d&&r.push(l.clone());for(var u=0;u<h.length;++u)if(p=h[u].splitWithSegment(n,b))if(q=p.lines,0<q.length&&(q.unshift(u,1),Array.prototype.splice.apply(h,q),u+=q.length-2),d)for(var v=0,w=p.points.length;v<w;++v)q=p.points[v],q.equals(l)||(r.push(q),g.push(new OpenLayers.Geometry.LineString(r)),r=q.equals(m)?[]:[q.clone()])}d&&(0<g.length&&0<r.length)&&(r.push(m.clone()),g.push(new OpenLayers.Geometry.LineString(r)))}else c=
a.splitWith(this,b);h&&1<h.length?f=!0:h=[];g&&1<g.length?e=!0:g=[];if(f||e)c=d?[g,h]:h;return c},splitWith:function(a,b){return a.split(this,b)},getVertices:function(a){return!0===a?[this.components[0],this.components[this.components.length-1]]:!1===a?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(a,b){var c=!(b&&!1===b.edge)&&b&&b.details,d,e={},f=Number.POSITIVE_INFINITY;if(a instanceof OpenLayers.Geometry.Point){for(var g=this.getSortedSegments(),
h=a.x,k=a.y,l,m=0,n=g.length;m<n;++m)if(l=g[m],d=OpenLayers.Geometry.distanceToSegment(a,l),d.distance<f){if(f=d.distance,e=d,0===f)break}else if(l.x2>h&&(k>l.y1&&k<l.y2||k<l.y1&&k>l.y2))break;e=c?{distance:e.distance,x0:e.x,y0:e.y,x1:h,y1:k}:e.distance}else if(a instanceof OpenLayers.Geometry.LineString){var g=this.getSortedSegments(),h=a.getSortedSegments(),p,q,r=h.length,s={point:!0},m=0,n=g.length;a:for(;m<n;++m){k=g[m];l=k.x1;q=k.y1;for(var t=0;t<r;++t)if(d=h[t],p=OpenLayers.Geometry.segmentsIntersect(k,
d,s)){f=0;e={distance:0,x0:p.x,y0:p.y,x1:p.x,y1:p.y};break a}else d=OpenLayers.Geometry.distanceToSegment({x:l,y:q},d),d.distance<f&&(f=d.distance,e={distance:f,x0:l,y0:q,x1:d.x,y1:d.y})}c||(e=e.distance);0!==f&&k&&(d=a.distanceTo(new OpenLayers.Geometry.Point(k.x2,k.y2),b),m=c?d.distance:d,m<f&&(e=c?{distance:f,x0:d.x1,y0:d.y1,x1:d.x0,y1:d.y0}:m))}else e=a.distanceTo(this,b),c&&(e={distance:e.distance,x0:e.x1,y0:e.y1,x1:e.x0,y1:e.y0});return e},simplify:function(a){if(this&&null!==this){var b=this.getVertices();
if(3>b.length)return this;var c=function(a,b,d,k){for(var l=0,m=0,n=b,p;n<d;n++){p=a[b];var q=a[d],r=a[n],r=Math.abs(0.5*(p.x*q.y+q.x*r.y+r.x*p.y-q.x*p.y-r.x*q.y-p.x*r.y));p=Math.sqrt(Math.pow(p.x-q.x,2)+Math.pow(p.y-q.y,2));p=2*(r/p);p>l&&(l=p,m=n)}l>k&&m!=b&&(e.push(m),c(a,b,m,k),c(a,m,d,k))},d=b.length-1,e=[];e.push(0);for(e.push(d);b[0].equals(b[d]);)d--,e.push(d);c(b,0,d,a);a=[];e.sort(function(a,b){return a-b});for(d=0;d<e.length;d++)a.push(b[e[d]]);return new OpenLayers.Geometry.LineString(a)}return this},
CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(a,b){for(var c=null,d=b&&b.mutual,e,f,g,h,k=[],l=[a],m=0,n=this.components.length;m<n;++m){f=this.components[m];g=!1;for(var p=0;p<l.length;++p)if(e=f.split(l[p],b)){if(d){g=e[0];for(var q=0,r=g.length;q<r;++q)0===q&&k.length?k[k.length-1].addComponent(g[q]):k.push(new OpenLayers.Geometry.MultiLineString([g[q]]));g=!0;e=e[1]}if(e.length){e.unshift(p,
1);Array.prototype.splice.apply(l,e);break}}g||(k.length?k[k.length-1].addComponent(f.clone()):k=[new OpenLayers.Geometry.MultiLineString(f.clone())])}k&&1<k.length?g=!0:k=[];l&&1<l.length?h=!0:l=[];if(g||h)c=d?[k,l]:l;return c},splitWith:function(a,b){var c=null,d=b&&b.mutual,e,f,g,h,k,l;if(a instanceof OpenLayers.Geometry.LineString){l=[];k=[a];for(var m=0,n=this.components.length;m<n;++m){g=!1;f=this.components[m];for(var p=0;p<k.length;++p)if(e=k[p].split(f,b)){d&&(g=e[0],g.length&&(g.unshift(p,
1),Array.prototype.splice.apply(k,g),p+=g.length-2),e=e[1],0===e.length&&(e=[f.clone()]));g=0;for(var q=e.length;g<q;++g)0===g&&l.length?l[l.length-1].addComponent(e[g]):l.push(new OpenLayers.Geometry.MultiLineString([e[g]]));g=!0}g||(l.length?l[l.length-1].addComponent(f.clone()):l=[new OpenLayers.Geometry.MultiLineString([f.clone()])])}}else c=a.split(this);k&&1<k.length?h=!0:k=[];l&&1<l.length?g=!0:l=[];if(h||g)c=d?[k,l]:l;return c},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(a,b){var c=!1,d=this.components.pop();null==b&&a.equals(d)||(c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]);return c},removeComponent:function(a){var b=this.components&&3<this.components.length;b&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,
arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]));return b},move:function(a,b){for(var c=0,d=this.components.length;c<d-1;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d-1;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0,e=this.components.length;d<e-1;++d)this.components[d].resize(a,b,c);return this},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d-1;c++)this.components[c].transform(a,
b);this.bounds=null}return this},getCentroid:function(){if(this.components){var a=this.components.length;if(0<a&&2>=a)return this.components[0].clone();if(2<a){var b=0,c=0,d=this.components[0].x,e=this.components[0].y,f=-1*this.getArea();if(0!=f){for(var g=0;g<a-1;g++)var h=this.components[g],k=this.components[g+1],b=b+(h.x+k.x-2*d)*((h.x-d)*(k.y-e)-(k.x-d)*(h.y-e)),c=c+(h.y+k.y-2*e)*((h.x-d)*(k.y-e)-(k.x-d)*(h.y-e));b=d+b/(6*f);a=e+c/(6*f)}else{for(g=0;g<a-1;g++)b+=this.components[g].x,c+=this.components[g].y;
b/=a-1;a=c/(a-1)}return new OpenLayers.Geometry.Point(b,a)}return null}},getArea:function(){var a=0;if(this.components&&2<this.components.length){for(var b=a=0,c=this.components.length;b<c-1;b++)var d=this.components[b],e=this.components[b+1],a=a+(d.x+e.x)*(e.y-d.y);a=-a/2}return a},getGeodesicArea:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}a=0;c=b.components&&b.components.length;if(2<c){for(var d,e,f=0;f<c-1;f++)d=b.components[f],
e=b.components[f+1],a+=OpenLayers.Util.rad(e.x-d.x)*(2+Math.sin(OpenLayers.Util.rad(d.y))+Math.sin(OpenLayers.Util.rad(e.y)));a=40680631590769*a/2}return a},containsPoint:function(a){var b=OpenLayers.Number.limitSigDigs,c=b(a.x,14);a=b(a.y,14);for(var d=this.components.length-1,e,f,g,h,k,l=0,m=0;m<d;++m)if(e=this.components[m],g=b(e.x,14),e=b(e.y,14),f=this.components[m+1],h=b(f.x,14),f=b(f.y,14),e==f){if(a==e&&(g<=h&&c>=g&&c<=h||g>=h&&c<=g&&c>=h)){l=-1;break}}else{k=b((a-f)*((h-g)/(f-e))+h,14);if(k==
c&&(e<f&&a>=e&&a<=f||e>f&&a<=e&&a>=f)){l=-1;break}k<=c||g!=h&&(k<Math.min(g,h)||k>Math.max(g,h))||(e<f&&a>=e&&a<f||e>f&&a<e&&a>=f)&&++l}return-1==l?1:!!(l&1)},intersects:function(a){var b=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=a.intersects(this);else if("OpenLayers.Geometry.LinearRing"==a.CLASS_NAME)b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[a]);else for(var c=0,d=a.components.length;c<
d&&!(b=a.components[c].intersects(this));++c);return b},getVertices:function(a){return!0===a?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var a=0;if(this.components&&0<this.components.length)for(var a=a+Math.abs(this.components[0].getArea()),b=1,c=this.components.length;b<c;b++)a-=Math.abs(this.components[b].getArea());return a},getGeodesicArea:function(a){var b=0;if(this.components&&0<this.components.length)for(var b=b+Math.abs(this.components[0].getGeodesicArea(a)),c=1,d=this.components.length;c<
d;c++)b-=Math.abs(this.components[c].getGeodesicArea(a));return b},containsPoint:function(a){var b=this.components.length,c=!1;if(0<b&&(c=this.components[0].containsPoint(a),1!==c&&c&&1<b))for(var d,e=1;e<b;++e)if(d=this.components[e].containsPoint(a)){c=1===d?1:!1;break}return c},intersects:function(a){var b=!1,c,d;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){c=0;for(d=
this.components.length;c<d&&!(b=a.intersects(this.components[c]));++c);if(!b)for(c=0,d=a.components.length;c<d&&!(b=this.containsPoint(a.components[c]));++c);}else for(c=0,d=a.components.length;c<d&&!(b=this.intersects(a.components[c]));++c);if(!b&&"OpenLayers.Geometry.Polygon"==a.CLASS_NAME){var e=this.components[0];c=0;for(d=e.components.length;c<d&&!(b=a.containsPoint(e.components[c]));++c);}return b},distanceTo:function(a,b){return b&&!1===b.edge&&this.intersects(a)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,
[a,b])},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(a,b,c,d){var e=Math.PI*(1/c-0.5);d&&(e+=d/180*Math.PI);for(var f,g=[],h=0;h<c;++h)f=e+2*h*Math.PI/c,d=a.x+b*Math.cos(f),f=a.y+b*Math.sin(f),g.push(new OpenLayers.Geometry.Point(d,f));a=new OpenLayers.Geometry.LinearRing(g);return new OpenLayers.Geometry.Polygon([a])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==
typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a=this.getElementsByTagNameNS(a.documentElement,this.gmlns,this.featureName);for(var b=[],c=0;c<a.length;c++){var d=this.parseFeature(a[c]);d&&b.push(d)}return b},parseFeature:function(a){for(var b="MultiPolygon Polygon MultiLineString LineString MultiPoint Point Envelope".split(" "),c,d,e,f=0;f<b.length;++f)if(c=b[f],d=this.getElementsByTagNameNS(a,this.gmlns,c),0<d.length){if(e=this.parseGeometry[c.toLowerCase()])e=e.apply(this,
[d[0]]),this.internalProjection&&this.externalProjection&&e.transform(this.externalProjection,this.internalProjection);else throw new TypeError("Unsupported geometry type: "+c);break}var g;c=this.getElementsByTagNameNS(a,this.gmlns,"Box");for(f=0;f<c.length;++f)b=c[f],d=this.parseGeometry.box.apply(this,[b]),b=b.parentNode,"boundedBy"===(b.localName||b.nodeName.split(":").pop())?g=d:e=d.toGeometry();var h;this.extractAttributes&&(h=this.parseAttributes(a));h=new OpenLayers.Feature.Vector(e,h);h.bounds=
g;h.gml={featureType:a.firstChild.nodeName.split(":")[1],featureNS:a.firstChild.namespaceURI,featureNSPrefix:a.firstChild.prefix};a=a.firstChild;for(var k;a&&(1!=a.nodeType||!(k=a.getAttribute("fid")||a.getAttribute("id")));)a=a.nextSibling;h.fid=k;return h},parseGeometry:{point:function(a){var b,c;c=[];b=this.getElementsByTagNameNS(a,this.gmlns,"pos");0<b.length&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),c=c.split(this.regExes.splitSpace));0==c.length&&(b=this.getElementsByTagNameNS(a,
this.gmlns,"coordinates"),0<b.length&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,""),c=c.split(",")));0==c.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coord"),0<b.length&&(a=this.getElementsByTagNameNS(b[0],this.gmlns,"X"),b=this.getElementsByTagNameNS(b[0],this.gmlns,"Y"),0<a.length&&0<b.length&&(c=[a[0].firstChild.nodeValue,b[0].firstChild.nodeValue])));2==c.length&&(c[2]=null);return this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],
c[0],c[2])},multipoint:function(a){a=this.getElementsByTagNameNS(a,this.gmlns,"Point");var b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.point.apply(this,[a[d]]))&&b.push(c);return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a,b){var c,d;d=[];var e=[];c=this.getElementsByTagNameNS(a,this.gmlns,"posList");if(0<c.length){d=this.getChildValue(c[0]);d=d.replace(this.regExes.trimSpace,"");d=d.split(this.regExes.splitSpace);var f=parseInt(c[0].getAttribute("dimension")),
g,h,k;for(c=0;c<d.length/f;++c)g=c*f,h=d[g],k=d[g+1],g=2==f?null:d[g+2],this.xy?e.push(new OpenLayers.Geometry.Point(h,k,g)):e.push(new OpenLayers.Geometry.Point(k,h,g))}if(0==d.length&&(c=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),0<c.length))for(d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),d=d.replace(this.regExes.trimComma,","),f=d.split(this.regExes.splitSpace),c=0;c<f.length;++c)d=f[c].split(","),2==d.length&&(d[2]=null),this.xy?e.push(new OpenLayers.Geometry.Point(d[0],
d[1],d[2])):e.push(new OpenLayers.Geometry.Point(d[1],d[0],d[2]));d=null;0!=e.length&&(d=b?new OpenLayers.Geometry.LinearRing(e):new OpenLayers.Geometry.LineString(e));return d},multilinestring:function(a){a=this.getElementsByTagNameNS(a,this.gmlns,"LineString");var b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.linestring.apply(this,[a[d]]))&&b.push(c);return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){a=this.getElementsByTagNameNS(a,this.gmlns,"LinearRing");
var b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.linestring.apply(this,[a[d],!0]))&&b.push(c);return new OpenLayers.Geometry.Polygon(b)},multipolygon:function(a){a=this.getElementsByTagNameNS(a,this.gmlns,"Polygon");var b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.polygon.apply(this,[a[d]]))&&b.push(c);return new OpenLayers.Geometry.MultiPolygon(b)},envelope:function(a){var b=[],c,d,e=this.getElementsByTagNameNS(a,this.gmlns,"lowerCorner");if(0<e.length){c=
[];0<e.length&&(c=e[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),c=c.split(this.regExes.splitSpace));2==c.length&&(c[2]=null);var f=this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2])}a=this.getElementsByTagNameNS(a,this.gmlns,"upperCorner");if(0<a.length){c=[];0<a.length&&(c=a[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),c=c.split(this.regExes.splitSpace));2==c.length&&(c[2]=null);var g=this.xy?new OpenLayers.Geometry.Point(c[0],
c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2])}f&&g&&(b.push(new OpenLayers.Geometry.Point(f.x,f.y)),b.push(new OpenLayers.Geometry.Point(g.x,f.y)),b.push(new OpenLayers.Geometry.Point(g.x,g.y)),b.push(new OpenLayers.Geometry.Point(f.x,g.y)),b.push(new OpenLayers.Geometry.Point(f.x,f.y)),b=new OpenLayers.Geometry.LinearRing(b),d=new OpenLayers.Geometry.Polygon([b]));return d},box:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),c=a=null;0<b.length&&(b=b[0].firstChild.nodeValue,
b=b.split(" "),2==b.length&&(a=b[0].split(","),c=b[1].split(",")));if(null!==a&&null!==c)return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(c[0]),parseFloat(c[1]))}},parseAttributes:function(a){var b={};a=a.firstChild;for(var c,d,e;a;){if(1==a.nodeType){a=a.childNodes;for(c=0;c<a.length;++c)if(d=a[c],1==d.nodeType)if(e=d.childNodes,1==e.length){if(e=e[0],3==e.nodeType||4==e.nodeType)d=d.prefix?d.nodeName.split(":")[1]:d.nodeName,e=e.nodeValue.replace(this.regExes.trimSpace,
""),b[d]=e}else b[d.nodeName.split(":").pop()]=null;break}a=a.nextSibling}return b},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),c=0;c<a.length;c++)b.appendChild(this.createFeatureXML(a[c]));return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);c.appendChild(b);
var b=this.createElementNS(this.gmlns,"gml:"+this.featureName),d=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);d.setAttribute("fid",a.fid||a.id);d.appendChild(c);for(var e in a.attributes){var c=this.createTextNode(a.attributes[e]),f=e.substring(e.lastIndexOf(":")+1),f=this.createElementNS(this.featureNS,this.featurePrefix+":"+f);f.appendChild(c);d.appendChild(f)}b.appendChild(d);return b},buildGeometryNode:function(a){this.externalProjection&&this.internalProjection&&
(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME,b=b.substring(b.lastIndexOf(".")+1);return this.buildGeometry[b.toLowerCase()].apply(this,[a])},buildGeometry:{point:function(a){var b=this.createElementNS(this.gmlns,"gml:Point");b.appendChild(this.buildCoordinatesNode(a));return b},multipoint:function(a){var b=this.createElementNS(this.gmlns,"gml:MultiPoint");a=a.components;for(var c,d,e=0;e<a.length;e++)c=this.createElementNS(this.gmlns,"gml:pointMember"),
d=this.buildGeometry.point.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b},linestring:function(a){var b=this.createElementNS(this.gmlns,"gml:LineString");b.appendChild(this.buildCoordinatesNode(a));return b},multilinestring:function(a){var b=this.createElementNS(this.gmlns,"gml:MultiLineString");a=a.components;for(var c,d,e=0;e<a.length;++e)c=this.createElementNS(this.gmlns,"gml:lineStringMember"),d=this.buildGeometry.linestring.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);
return b},linearring:function(a){var b=this.createElementNS(this.gmlns,"gml:LinearRing");b.appendChild(this.buildCoordinatesNode(a));return b},polygon:function(a){var b=this.createElementNS(this.gmlns,"gml:Polygon");a=a.components;for(var c,d,e=0;e<a.length;++e)c=0==e?"outerBoundaryIs":"innerBoundaryIs",c=this.createElementNS(this.gmlns,"gml:"+c),d=this.buildGeometry.linearring.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b},multipolygon:function(a){var b=this.createElementNS(this.gmlns,
"gml:MultiPolygon");a=a.components;for(var c,d,e=0;e<a.length;++e)c=this.createElementNS(this.gmlns,"gml:polygonMember"),d=this.buildGeometry.polygon.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b},bounds:function(a){var b=this.createElementNS(this.gmlns,"gml:Box");b.appendChild(this.buildCoordinatesNode(a));return b}},buildCoordinatesNode:function(a){var b=this.createElementNS(this.gmlns,"gml:coordinates");b.setAttribute("decimal",".");b.setAttribute("cs",",");b.setAttribute("ts",
" ");var c=[];if(a instanceof OpenLayers.Bounds)c.push(a.left+","+a.bottom),c.push(a.right+","+a.top);else{a=a.components?a.components:[a];for(var d=0;d<a.length;d++)c.push(a[d].x+","+a[d].y)}c=this.createTextNode(c.join(" "));b.appendChild(c);return b},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});
OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},
initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.setGeometryTypes();a&&a.featureNS&&this.setNamespace("feature",a.featureNS);this.singleFeatureType=!a||"string"===typeof a.featureType},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b=[];this.readNode(a,{features:b},!0);if(0==b.length){var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(c.length){a=
0;for(var d=c.length;a<d;++a)this.readNode(c[a],{features:b},!0)}else c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMembers"),c.length&&this.readNode(c[0],{features:b},!0)}return b},readNode:function(a,b,c){!0===c&&!0===this.autoConfig&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null);this.featureNS||(a.prefix in this.namespaces||a.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(a.parentNode.nodeName))||
(this.featureType=a.nodeName.split(":").pop(),this.setNamespace("feature",a.namespaceURI),this.featureNS=a.namespaceURI,this.autoConfig=!0);return OpenLayers.Format.XML.prototype.readNode.apply(this,[a,b])},readers:{gml:{_inherit:function(a,b,c){},featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(a,b){var c={};this.readChildNodes(a,c);c.components&&0<c.components.length&&
(b.bounds=c.components[0])},Point:function(a,b){var c={points:[]};this.readChildNodes(a,c);b.components||(b.components=[]);b.components.push(c.points[0])},coordinates:function(a,b){for(var c=this.getChildValue(a).replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),c=c.split(this.regExes.splitSpace),d,e=c.length,f=Array(e),g=0;g<e;++g)d=c[g].split(","),f[g]=this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2]);b.points=f},coord:function(a,
b){var c={};this.readChildNodes(a,c);b.points||(b.points=[]);b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(a,
b){var c={};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components||(b.components=[]);b.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(a,b){var c={outer:null,inner:[]};this.readers.gml._inherit.apply(this,
[a,c,b]);this.readChildNodes(a,c);c.inner.unshift(c.outer);b.components||(b.components=[]);b.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.LinearRing(c.points)]},MultiPolygon:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},
polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(a,b){var c,d=a.localName||a.nodeName.split(":").pop();b.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,d)?d===this.featureType&&(c="_typeName"):c=
"_typeName":0==a.childNodes.length||1==a.childNodes.length&&3==a.firstChild.nodeType?this.extractAttributes&&(c="_attribute"):c="_geometry";c&&this.readers.feature[c].apply(this,[a,b])},_typeName:function(a,b){var c={components:[],attributes:{}};this.readChildNodes(a,c);c.name&&(c.attributes.name=c.name);var d=new OpenLayers.Feature.Vector(c.components[0],c.attributes);this.singleFeatureType||(d.type=a.nodeName.split(":").pop(),d.namespace=a.namespaceURI);var e=a.getAttribute("fid")||this.getAttributeNS(a,
this.namespaces.gml,"id");e&&(d.fid=e);this.internalProjection&&(this.externalProjection&&d.geometry)&&d.geometry.transform(this.externalProjection,this.internalProjection);c.bounds&&(d.bounds=c.bounds);b.features.push(d)},_geometry:function(a,b){this.geometryName||(this.geometryName=a.nodeName.split(":").pop());this.readChildNodes(a,b)},_attribute:function(a,b){var c=a.localName||a.nodeName.split(":").pop(),d=this.getChildValue(a);b.attributes[c]=d}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,
b)}}},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";a=this.writeNode("gml:"+b,a);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",a,b);return b},MultiPoint:function(a){var b=this.createElementNSPlus("gml:MultiPoint");a=a.components||[a];
for(var c=0,d=a.length;c<d;++c)this.writeNode("pointMember",a[c],b);return b},pointMember:function(a){var b=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",a,b);return b},MultiLineString:function(a){var b=this.createElementNSPlus("gml:MultiLineString");a=a.components||[a];for(var c=0,d=a.length;c<d;++c)this.writeNode("lineStringMember",a[c],b);return b},lineStringMember:function(a){var b=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",a,b);return b},
MultiPolygon:function(a){var b=this.createElementNSPlus("gml:MultiPolygon");a=a.components||[a];for(var c=0,d=a.length;c<d;++c)this.writeNode("polygonMember",a[c],b);return b},polygonMember:function(a){var b=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",a,b);return b},GeometryCollection:function(a){for(var b=this.createElementNSPlus("gml:GeometryCollection"),c=0,d=a.components.length;c<d;++c)this.writeNode("geometryMember",a.components[c],b);return b},geometryMember:function(a){var b=
this.createElementNSPlus("gml:geometryMember");a=this.writeNode("feature:_geometry",a);b.appendChild(a.firstChild);return b}},feature:{_typeName:function(a){var b=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:a.fid}});a.geometry&&this.writeNode("feature:_geometry",a.geometry,b);for(var c in a.attributes){var d=a.attributes[c];null!=d&&this.writeNode("feature:_attribute",{name:c,value:d},b)}return b},_geometry:function(a){this.externalProjection&&this.internalProjection&&(a=
a.clone().transform(this.internalProjection,this.externalProjection));var b=this.createElementNSPlus("feature:"+this.geometryName);a=this.writeNode("gml:"+this.geometryTypes[a.CLASS_NAME],a,b);this.srsName&&a.setAttribute("srsName",this.srsName);return b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(a){for(var b=this.createElementNSPlus("wfs:FeatureCollection"),c=0,d=a.length;c<d;++c)this.writeNode("gml:featureMember",
a[c],b);return b}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(a,b,c){if(a=parseInt(a.getAttribute("srsDimension"),10)||c&&c.srsDimension)b.srsDimension=a},featureMembers:function(a,
b){this.readChildNodes(a,b)},Curve:function(a,b){var c={points:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);b.components||(b.components=[]);b.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(a,b){var c={};this.readChildNodes(a,c);c.points&&Array.prototype.push.apply(b.points,c.points)},pos:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),
c=this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2]);b.points=[c]},posList:function(a,b){for(var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),d=b.srsDimension||parseInt(a.getAttribute("srsDimension")||a.getAttribute("dimension"),10)||2,e,f,g,h=Array(c.length/d),k=0,l=c.length;k<l;k+=d)e=c[k],f=c[k+1],g=2==d?void 0:c[k+2],h[k/d]=this.xy?new OpenLayers.Geometry.Point(e,f,g):new OpenLayers.Geometry.Point(f,
e,g);b.points=h},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(a,b){var c={};this.readChildNodes(a,c);b.outer=c.components[0]},interior:function(a,b){var c={};this.readChildNodes(a,c);b.inner.push(c.components[0])},MultiCurve:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);0<c.components.length&&(b.components=
[new OpenLayers.Geometry.MultiLineString(c.components)])},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]);this.readChildNodes(a,c);0<c.components.length&&(b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)])},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,
b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(a,b){var c={points:Array(2)};this.readChildNodes(a,c);b.components||(b.components=[]);var d=c.points[0],c=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,c.x,c.y))},lowerCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]);b.points[0]=c.points[0]},upperCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,
[a,c]);b.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";a=this.writeNode("gml:"+b,a);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a){for(var b=
this.createElementNSPlus("gml:featureMembers"),c=0,d=a.length;c<d;++c)this.writeNode("feature:_typeName",a[c],b);return b},Point:function(a){var b=this.createElementNSPlus("gml:Point");this.writeNode("pos",a,b);return b},pos:function(a){return this.createElementNSPlus("gml:pos",{value:this.xy?a.x+" "+a.y:a.y+" "+a.x})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");this.writeNode("posList",a.components,b);return b},Curve:function(a){var b=this.createElementNSPlus("gml:Curve");
this.writeNode("segments",a,b);return b},segments:function(a){var b=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",a,b);return b},LineStringSegment:function(a){var b=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",a.components,b);return b},posList:function(a){for(var b=a.length,c=Array(b),d,e=0;e<b;++e)d=a[e],c[e]=this.xy?d.x+" "+d.y:d.y+" "+d.x;return this.createElementNSPlus("gml:posList",{value:c.join(" ")})},Surface:function(a){var b=this.createElementNSPlus("gml:Surface");
this.writeNode("patches",a,b);return b},patches:function(a){var b=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",a,b);return b},PolygonPatch:function(a){var b=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;c<d;++c)this.writeNode("interior",a.components[c],b);return b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",a.components[0],
b);for(var c=1,d=a.components.length;c<d;++c)this.writeNode("interior",a.components[c],b);return b},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",a,b);return b},interior:function(a){var b=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",a.components,b);return b},MultiCurve:function(a){var b=this.createElementNSPlus("gml:MultiCurve");
a=a.components||[a];for(var c=0,d=a.length;c<d;++c)this.writeNode("curveMember",a[c],b);return b},curveMember:function(a){var b=this.createElementNSPlus("gml:curveMember");this.curve?this.writeNode("Curve",a,b):this.writeNode("LineString",a,b);return b},MultiSurface:function(a){var b=this.createElementNSPlus("gml:MultiSurface");a=a.components||[a];for(var c=0,d=a.length;c<d;++c)this.writeNode("surfaceMember",a[c],b);return b},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");
this.surface?this.writeNode("Surface",a,b):this.writeNode("Polygon",a,b);return b},Envelope:function(a){var b=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",a,b);this.writeNode("upperCorner",a,b);this.srsName&&b.setAttribute("srsName",this.srsName);return b},lowerCorner:function(a){return this.createElementNSPlus("gml:lowerCorner",{value:this.xy?a.left+" "+a.bottom:a.bottom+" "+a.left})},upperCorner:function(a){return this.createElementNSPlus("gml:upperCorner",{value:this.xy?
a.right+" "+a.top:a.top+" "+a.right})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.curve?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":!0===
this.surface?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=a.getAttribute("matchCase"),c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,
c);b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c=a.getAttribute("matchCase"),c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escapeChar");c.value2regex(d,e,
f);b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",
{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:a.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Envelope",
a.value);a.projection&&c.setAttribute("srsName",a.projection);b.appendChild(c);return b},SortBy:function(a){for(var b=this.createElementNSPlus("ogc:SortBy"),c=0,d=a.length;c<d;c++)this.writeNode("ogc:SortProperty",a[c],b);return b},SortProperty:function(a){var b=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",a,b);this.writeNode("ogc:SortOrder","DESC"==a.order?"DESC":"ASC",b);return b},SortOrder:function(a){return this.createElementNSPlus("ogc:SortOrder",{value:a})}},
OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);this.writeNode("PropertyName",a,c);if(a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Envelope",a.value);a.projection&&
d.setAttribute("srsName",a.projection);c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(a,b){var c=this.version;if(!c){var d=a.getAttribute("xmlns:ows");d&&"1.1"===d.substring(d.lastIndexOf("/")+1)&&(c="1.1.0");c||(c=this.defaultVersion)}return c},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a,b){OpenLayers.Util.applyDefaults(b,this.options);var c={};this.readChildNodes(a,c);return c},readers:{ows:{Exception:function(a,b){var c={code:a.getAttribute("exceptionCode"),locator:a.getAttribute("locator"),texts:[]};b.exceptions.push(c);this.readChildNodes(a,c)},ExceptionText:function(a,b){var c=this.getChildValue(a);b.texts.push(c)},
ServiceIdentification:function(a,b){b.serviceIdentification={};this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},Keywords:function(a,b){b.keywords={};this.readChildNodes(a,b.keywords)},Keyword:function(a,b){b[this.getChildValue(a)]=!0},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=
this.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={};this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")},ServiceContact:function(a,b){b.serviceContact={};this.readChildNodes(a,b.serviceContact)},IndividualName:function(a,
b){b.individualName=this.getChildValue(a)},PositionName:function(a,b){b.positionName=this.getChildValue(a)},ContactInfo:function(a,b){b.contactInfo={};this.readChildNodes(a,b.contactInfo)},Phone:function(a,b){b.phone={};this.readChildNodes(a,b.phone)},Voice:function(a,b){b.voice=this.getChildValue(a)},Address:function(a,b){b.address={};this.readChildNodes(a,b.address)},DeliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},AdministrativeArea:function(a,
b){b.administrativeArea=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ElectronicMailAddress:function(a,b){b.electronicMailAddress=this.getChildValue(a)},Role:function(a,b){b.role=this.getChildValue(a)},OperationsMetadata:function(a,b){b.operationsMetadata={};this.readChildNodes(a,b.operationsMetadata)},Operation:function(a,b){var c=a.getAttribute("name");b[c]={};this.readChildNodes(a,b[c])},DCP:function(a,
b){b.dcp={};this.readChildNodes(a,b.dcp)},HTTP:function(a,b){b.http={};this.readChildNodes(a,b.http)},Get:function(a,b){b.get||(b.get=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c);b.get.push(c)},Post:function(a,b){b.post||(b.post=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c);b.post.push(c)},Parameter:function(a,b){b.parameters||(b.parameters={});var c=a.getAttribute("name");b.parameters[c]={};this.readChildNodes(a,
b.parameters[c])},Constraint:function(a,b){b.constraints||(b.constraints={});var c=a.getAttribute("name");b.constraints[c]={};this.readChildNodes(a,b.constraints[c])},Value:function(a,b){b[this.getChildValue(a)]=!0},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)});this.readChildNodes(a,b)},WGS84BoundingBox:function(a,b){var c={};c.crs=a.getAttribute("crs");b.BoundingBox?b.BoundingBox.push(c):(b.projection=c.crs,c=b);this.readChildNodes(a,c)},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,
[a,b])},LowerCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),c=c.split(this.regExes.splitSpace);b.left=c[0];b.bottom=c[1]},UpperCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),c=c.split(this.regExes.splitSpace);b.right=c[0];b.top=c[1];b.bounds=new OpenLayers.Bounds(b.left,b.bottom,b.right,b.top);delete b.left;delete b.bottom;delete b.right;delete b.top},
Language:function(a,b){b.language=this.getChildValue(a)}}},writers:{ows:{BoundingBox:function(a,b){var c=this.createElementNSPlus(b||"ows:BoundingBox",{attributes:{crs:a.projection}});this.writeNode("ows:LowerCorner",a,c);this.writeNode("ows:UpperCorner",a,c);return c},LowerCorner:function(a){return this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom})},UpperCorner:function(a){return this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top})},
Identifier:function(a){return this.createElementNSPlus("ows:Identifier",{value:a})},Title:function(a){return this.createElementNSPlus("ows:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("ows:Abstract",{value:a})},OutputFormat:function(a){return this.createElementNSPlus("ows:OutputFormat",{value:a})}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.success=!1;b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("language"),exceptions:[]};this.readChildNodes(a,b.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},
CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(a,b,c){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,
b){b.numberOfFeatures=parseInt(a.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(a,b){b.insertIds=[];b.success=!1;this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=!0},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(a,b){var c={fids:[]};this.readChildNodes(a,c);b.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,
feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(a){var b=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);a&&this.setAttributes(b,{resultType:a.resultType,startIndex:a.startIndex,count:a.count});return b},Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,
featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType,srsName:a.srsName}});a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS);if(a.propertyNames)for(var b=0,d=a.propertyNames.length;b<d;b++)this.writeNode("wfs:PropertyName",{property:a.propertyNames[b]},c);a.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,a.filter),this.writeNode("ogc:Filter",
a.filter,c));return c},PropertyName:function(a){return this.createElementNSPlus("wfs:PropertyName",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(a){a=a||{};OpenLayers.Util.extend(this,a);this.options=a},mergeWithDefaultFilter:function(a){return a&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,a]}):a||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(a){a=a||{};a.filter=this.mergeWithDefaultFilter(a.filter)},create:function(){},
update:function(){},"delete":function(){},commit:function(){},abort:function(a){},createCallback:function(a,b,c){return OpenLayers.Function.bind(function(){a.apply(this,[b,c])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return 0<this.code},CLASS_NAME:"OpenLayers.Protocol.Response"});
OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(a,b){var c;if(this.nativeJSON)c=JSON.parse(a,b);else try{if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(c=eval("("+a+")"),"function"===
typeof b)){var d=function(a,c){if(c&&"object"===typeof c)for(var e in c)c.hasOwnProperty(e)&&(c[e]=d(e,c[e]));return b(a,c)};c=d("",c)}}catch(e){}this.keepData&&(this.data=c);return c},write:function(a,b){this.pretty=!!b;var c=null,d=typeof a;if(this.serialize[d])try{c=!this.pretty&&this.nativeJSON?JSON.stringify(a):this.serialize[d].apply(this,[a])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}return c},writeIndent:function(){var a=[];if(this.pretty)for(var b=0;b<this.level;++b)a.push(this.indent);
return a.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(a){if(null==a)return"null";if(a.constructor==Date)return this.serialize.date.apply(this,[a]);if(a.constructor==Array)return this.serialize.array.apply(this,[a]);var b=["{"];this.level+=1;var c,d,e,f=!1;for(c in a)a.hasOwnProperty(c)&&(d=OpenLayers.Format.JSON.prototype.write.apply(this,[c,this.pretty]),e=OpenLayers.Format.JSON.prototype.write.apply(this,
[a[c],this.pretty]),null!=d&&null!=e&&(f&&b.push(","),b.push(this.writeNewline(),this.writeIndent(),d,":",this.writeSpace(),e),f=!0));this.level-=1;b.push(this.writeNewline(),this.writeIndent(),"}");return b.join("")},array:function(a){var b,c=["["];this.level+=1;for(var d=0,e=a.length;d<e;++d)b=OpenLayers.Format.JSON.prototype.write.apply(this,[a[d],this.pretty]),null!=b&&(0<d&&c.push(","),c.push(this.writeNewline(),this.writeIndent(),b));this.level-=1;c.push(this.writeNewline(),this.writeIndent(),
"]");return c.join("")},string:function(a){var b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,d){var e=b[d];if(e)return e;e=d.charCodeAt();return"\\u00"+Math.floor(e/16).toString(16)+(e%16).toString(16)})+'"':'"'+a+'"'},number:function(a){return isFinite(a)?String(a):"null"},"boolean":function(a){return String(a)},date:function(a){function b(a){return 10>a?"0"+a:a}return'"'+a.getFullYear()+
"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(a,b,c){b=b?b:"FeatureCollection";var d=null,e=null,e="string"==typeof a?OpenLayers.Format.JSON.prototype.read.apply(this,[a,c]):a;if(!e)OpenLayers.Console.error("Bad JSON: "+a);else if("string"!=typeof e.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+a);else if(this.isValidType(e,b))switch(b){case "Geometry":try{d=this.parseGeometry(e)}catch(f){OpenLayers.Console.error(f)}break;case "Feature":try{d=
this.parseFeature(e),d.type="Feature"}catch(g){OpenLayers.Console.error(g)}break;case "FeatureCollection":switch(d=[],e.type){case "Feature":try{d.push(this.parseFeature(e))}catch(h){d=null,OpenLayers.Console.error(h)}break;case "FeatureCollection":a=0;for(b=e.features.length;a<b;++a)try{d.push(this.parseFeature(e.features[a]))}catch(k){d=null,OpenLayers.Console.error(k)}break;default:try{var l=this.parseGeometry(e);d.push(new OpenLayers.Feature.Vector(l))}catch(m){d=null,OpenLayers.Console.error(m)}}}return d},
isValidType:function(a,b){var c=!1;switch(b){case "Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),a.type)?OpenLayers.Console.error("Unsupported geometry type: "+a.type):c=!0;break;case "FeatureCollection":c=!0;break;default:a.type==b?c=!0:OpenLayers.Console.error("Cannot convert types from "+a.type+" to "+b)}return c},parseFeature:function(a){var b,c,d;c=a.properties?a.properties:{};d=a.geometry&&a.geometry.bbox||
a.bbox;try{b=this.parseGeometry(a.geometry)}catch(e){throw e;}b=new OpenLayers.Feature.Vector(b,c);d&&(b.bounds=OpenLayers.Bounds.fromArray(d));a.id&&(b.fid=a.id);return b},parseGeometry:function(a){if(null==a)return null;var b,c=!1;if("GeometryCollection"==a.type){if(!OpenLayers.Util.isArray(a.geometries))throw"GeometryCollection must have geometries array: "+a;b=a.geometries.length;for(var c=Array(b),d=0;d<b;++d)c[d]=this.parseGeometry.apply(this,[a.geometries[d]]);b=new OpenLayers.Geometry.Collection(c);
c=!0}else{if(!OpenLayers.Util.isArray(a.coordinates))throw"Geometry must have coordinates array: "+a;if(!this.parseCoords[a.type.toLowerCase()])throw"Unsupported geometry type: "+a.type;try{b=this.parseCoords[a.type.toLowerCase()].apply(this,[a.coordinates])}catch(e){throw e;}}this.internalProjection&&(this.externalProjection&&!c)&&b.transform(this.externalProjection,this.internalProjection);return b},parseCoords:{point:function(a){if(!1==this.ignoreExtraDims&&2!=a.length)throw"Only 2D points are supported: "+
a;return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f;}b.push(c)}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f;}b.push(c)}return new OpenLayers.Geometry.LineString(b)},multilinestring:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=
this.parseCoords.linestring.apply(this,[a[d]])}catch(f){throw f;}b.push(c)}return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){for(var b=[],c,d,e=0,f=a.length;e<f;++e){try{d=this.parseCoords.linestring.apply(this,[a[e]])}catch(g){throw g;}c=new OpenLayers.Geometry.LinearRing(d.components);b.push(c)}return new OpenLayers.Geometry.Polygon(b)},multipolygon:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.polygon.apply(this,[a[d]])}catch(f){throw f;}b.push(c)}return new OpenLayers.Geometry.MultiPolygon(b)},
box:function(a){if(2!=a.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(a,b){var c={type:null};if(OpenLayers.Util.isArray(a)){c.type="FeatureCollection";var d=
a.length;c.features=Array(d);for(var e=0;e<d;++e){var f=a[e];if(!f instanceof OpenLayers.Feature.Vector)throw"FeatureCollection only supports collections of features: "+f;c.features[e]=this.extract.feature.apply(this,[f])}}else 0==a.CLASS_NAME.indexOf("OpenLayers.Geometry")?c=this.extract.geometry.apply(this,[a]):a instanceof OpenLayers.Feature.Vector&&(c=this.extract.feature.apply(this,[a]),a.layer&&a.layer.projection&&(c.crs=this.createCRSObject(a)));return OpenLayers.Format.JSON.prototype.write.apply(this,
[c,b])},createCRSObject:function(a){a=a.layer.projection.toString();var b={};a.match(/epsg:/i)&&(a=parseInt(a.substring(a.indexOf(":")+1)),b=4326==a?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+a}});return b},extract:{feature:function(a){var b=this.extract.geometry.apply(this,[a.geometry]),b={type:"Feature",properties:a.attributes,geometry:b};null!=a.fid&&(b.id=a.fid);return b},geometry:function(a){if(null==a)return null;this.internalProjection&&
this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME.split(".")[2];a=this.extract[b.toLowerCase()].apply(this,[a]);return"Collection"==b?{type:"GeometryCollection",geometries:a}:{type:b,coordinates:a}},point:function(a){return[a.x,a.y]},multipoint:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},linestring:function(a){for(var b=[],c=0,d=a.components.length;c<
d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},polygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.polygon.apply(this,[a.components[c]]));return b},collection:function(a){for(var b=
a.components.length,c=Array(b),d=0;d<b;++d)c[d]=this.extract.geometry.apply(this,[a.components[d]]);return c}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(a){a=a||{};this.params={};this.pendingRequests={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);this.format||(this.format=new OpenLayers.Format.GeoJSON);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=
new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,d){return b.write(a,d)}}},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments);a=OpenLayers.Util.applyDefaults(a,this.options);a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params);a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.createRequest(a.url,a.params,OpenLayers.Function.bind(function(c){b.data=
c;this.handleRead(b,a)},this));b.priv=c;return b},createRequest:function(a,b,c){c=OpenLayers.Protocol.Script.register(c);var d=OpenLayers.String.format(this.callbackTemplate,{id:c});b=OpenLayers.Util.extend({},b);b[this.callbackKey]=this.callbackPrefix+d;a=OpenLayers.Util.urlAppend(a,OpenLayers.Util.getParameterString(b));b=document.createElement("script");b.type="text/javascript";b.src=a;b.id="OpenLayers_Protocol_Script_"+c;this.pendingRequests[b.id]=b;document.getElementsByTagName("head")[0].appendChild(b);
return b},destroyRequest:function(a){OpenLayers.Protocol.Script.unregister(a.id.split("_").pop());delete this.pendingRequests[a.id];a.parentNode&&a.parentNode.removeChild(a)},handleRead:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){b.callback&&(a.data?(a.features=this.parseFeatures(a.data),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(a.priv),b.callback.call(b.scope,a))},parseFeatures:function(a){return this.format.read(a)},
abort:function(a){if(a)this.destroyRequest(a.priv);else for(var b in this.pendingRequests)this.destroyRequest(this.pendingRequests[b])},destroy:function(){this.abort();delete this.params;delete this.format;OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"});(function(){var a=OpenLayers.Protocol.Script,b=0;a.registry={};a.register=function(c){var d="c"+ ++b;a.registry[d]=function(){c.apply(this,arguments)};return d};a.unregister=function(b){delete a.registry[b]}})();OpenLayers.Format.EncodedPolyline=OpenLayers.Class(OpenLayers.Format,{geometryType:"linestring",initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b;if("linestring"==this.geometryType)b=OpenLayers.Geometry.LineString;else if("linearring"==this.geometryType)b=OpenLayers.Geometry.LinearRing;else if("multipoint"==this.geometryType)b=OpenLayers.Geometry.MultiPoint;else if("point"!=this.geometryType&&"polygon"!=this.geometryType)return null;a=this.decodeDeltas(a,
2);for(var c=a.length,d=[],e=0;e+1<c;){var f=a[e++],g=a[e++];d.push(new OpenLayers.Geometry.Point(g,f))}return"point"==this.geometryType?new OpenLayers.Feature.Vector(d[0]):"polygon"==this.geometryType?new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)])):new OpenLayers.Feature.Vector(new b(d))},decode:function(a,b,c){a=this.decodeDeltas(a,b,c||1E5);c=a.length;for(var d=[],e=0;e+(b-1)<c;){for(var f=[],g=0;g<b;++g)f.push(a[e++]);d.push(f)}return d},
write:function(a){a=(a.constructor==Array?a[0]:a).geometry;var b=a.CLASS_NAME.split(".")[2].toLowerCase();if("point"==b)a=Array(a);else if("linestring"==b||"linearring"==b||"multipoint"==b)a=a.components;else if("polygon"==b)a=a.components[0].components;else return null;for(var b=[],c=a.length,d=0;d<c;++d){var e=a[d];b.push(e.y);b.push(e.x)}return this.encodeDeltas(b,2)},encode:function(a,b,c){c=c||1E5;for(var d=[],e=a.length,f=0;f<e;++f)for(var g=a[f],h=0;h<b;++h)d.push(g[h]);return this.encodeDeltas(d,
b,c)},encodeDeltas:function(a,b,c){var d,e=Array(b);for(d=0;d<b;++d)e[d]=0;for(var f=a.length,g=0;g<f;)for(d=0;d<b;++d,++g){var h=a[g],k=h-e[d];e[d]=h;a[g]=k}return this.encodeFloats(a,c||1E5)},decodeDeltas:function(a,b,c){var d,e=Array(b);for(d=0;d<b;++d)e[d]=0;a=this.decodeFloats(a,c||1E5);c=a.length;for(var f=0;f<c;)for(d=0;d<b;++d,++f)e[d]+=a[f],a[f]=e[d];return a},encodeFloats:function(a,b){for(var c=b||1E5,d=a.length,e=0;e<d;++e)a[e]=Math.round(a[e]*c);return this.encodeSignedIntegers(a)},decodeFloats:function(a,
b){for(var c=b||1E5,d=this.decodeSignedIntegers(a),e=d.length,f=0;f<e;++f)d[f]/=c;return d},encodeSignedIntegers:function(a){for(var b=a.length,c=0;c<b;++c){var d=a[c],e=d<<1;0>d&&(e=~e);a[c]=e}return this.encodeUnsignedIntegers(a)},decodeSignedIntegers:function(a){a=this.decodeUnsignedIntegers(a);for(var b=a.length,c=0;c<b;++c){var d=a[c];a[c]=d&1?~(d>>1):d>>1}return a},encodeUnsignedIntegers:function(a){for(var b="",c=a.length,d=0;d<c;++d)b+=this.encodeUnsignedInteger(a[d]);return b},decodeUnsignedIntegers:function(a){for(var b=
[],c=0,d=0,e=a.length,f=0;f<e;++f){var g=a.charCodeAt(f)-63,c=c|(g&31)<<d;32>g?(b.push(c),d=c=0):d+=5}return b},encodeFloat:function(a,b){a=Math.round(a*(b||1E5));return this.encodeSignedInteger(a)},decodeFloat:function(a,b){return this.decodeSignedInteger(a)/(b||1E5)},encodeSignedInteger:function(a){var b=a<<1;0>a&&(b=~b);return this.encodeUnsignedInteger(b)},decodeSignedInteger:function(a){a=this.decodeUnsignedInteger(a);return a&1?~(a>>1):a>>1},encodeUnsignedInteger:function(a){for(var b,c="";32<=
a;)b=(32|a&31)+63,c+=String.fromCharCode(b),a>>=5;return c+=String.fromCharCode(a+63)},decodeUnsignedInteger:function(a){for(var b=0,c=0,d=a.length,e=0;e<d;++e){var f=a.charCodeAt(e)-63,b=b|(f&31)<<c;if(32>f)break;c+=5}return b},CLASS_NAME:"OpenLayers.Format.EncodedPolyline"});OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.controls=[];this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;0<=b;b--)a=this.controls[b],a.events&&
a.events.un({activate:this.iconOn,deactivate:this.iconOff}),a.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;b<c;b++)a=this.controls[b],(a===this.defaultControl||this.saveState&&this.activeState[a.id])&&a.activate();!0===this.saveState&&(this.defaultControl=null);this.redraw();return!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var a,
b=0,c=this.controls.length;b<c;b++)a=this.controls[b],this.activeState[a.id]=a.deactivate();this.redraw();return!0}return!1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick);this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var a=this.div.childNodes.length-1;0<=a;a--)this.div.removeChild(this.div.childNodes[a]);
this.div.innerHTML="";if(this.active)for(var a=0,b=this.controls.length;a<b;a++)this.div.appendChild(this.controls[a].panel_div)},activateControl:function(a){if(!this.active)return!1;if(a.type==OpenLayers.Control.TYPE_BUTTON)a.trigger();else if(a.type==OpenLayers.Control.TYPE_TOGGLE)a.active?a.deactivate():a.activate();else if(this.allowDepress&&a.active)a.deactivate();else{for(var b,c=0,d=this.controls.length;c<d;c++)b=this.controls[c],b==a||b.type!==OpenLayers.Control.TYPE_TOOL&&null!=b.type||b.deactivate();
a.activate()}},addControls:function(a){OpenLayers.Util.isArray(a)||(a=[a]);this.controls=this.controls.concat(a);for(var b=0,c=a.length;b<c;b++){var d=a[b],e=this.createControlMarkup(d);OpenLayers.Element.addClass(e,d.displayClass+"ItemInactive");OpenLayers.Element.addClass(e,"olButton");""==d.title||e.title||(e.title=d.title);d.panel_div=e}this.map&&(this.addControlsToMap(a),this.redraw())},createControlMarkup:function(a){return document.createElement("div")},addControlsToMap:function(a){for(var b,
c=0,d=a.length;c<d;c++)b=a[c],!0===b.autoActivate?(b.autoActivate=!1,this.map.addControl(b),b.autoActivate=!0):(this.map.addControl(b),b.deactivate()),b.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var a=this.panel_div;a.className=a.className.replace(RegExp("\\b("+this.displayClass+"Item)Inactive\\b"),"$1Active")},iconOff:function(){var a=this.panel_div;a.className=a.className.replace(RegExp("\\b("+this.displayClass+"Item)Active\\b"),"$1Inactive")},onButtonClick:function(a){var b=
this.controls;a=a.buttonElement;for(var c=b.length-1;0<=c;--c)if(b[c].panel_div===a){this.activateControl(b[c]);break}},getControlsBy:function(a,b){var c="function"==typeof b.test;return OpenLayers.Array.filter(this.controls,function(d){return d[a]==b||c&&b.test(d[a])})},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(a,b,c,d){OpenLayers.Layer.prototype.initialize.apply(this,[a,d]);this.url=b;this.params||(this.params=OpenLayers.Util.extend({},c))},destroy:function(){this.params=this.url=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));
return a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=OpenLayers.Util.extend(this.params,a);a=this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});return a},redraw:function(a){return a?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(a,b){for(var c=1,d=0,e=a.length;d<e;d++)c*=a.charCodeAt(d)*this.URL_HASH_FACTOR,
c-=Math.floor(c);return b[Math.floor(c*b.length)]},getFullRequestString:function(a,b){var c=b||this.url,d=OpenLayers.Util.extend({},this.params),d=OpenLayers.Util.extend(d,a),e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var e=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c)),f;for(f in d)f.toUpperCase()in e&&delete d[f];e=OpenLayers.Util.getParameterString(d);return OpenLayers.Util.urlAppend(c,e)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(a,b,c,d,e,f){this.layer=a;this.position=b.clone();this.setBounds(c);this.url=d;e&&(this.size=e.clone());this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,f);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object)this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=
!1,this.events.triggerEvent("unload"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=this.eventListeners=null},draw:function(a){a||this.clear();var b=this.shouldDraw();b&&(!a&&!1===this.events.triggerEvent("beforedraw"))&&(b=null);return b},shouldDraw:function(){var a=!1,b=this.layer.maxExtent;if(b){var c=this.layer.map,c=c.baseLayer.wrapDateLine&&c.getMaxExtent();this.bounds.intersectsBounds(b,
{inclusive:!1,worldBounds:c})&&(a=!0)}return a||this.layer.displayOutsideMaxExtent},setBounds:function(a){a=a.clone();if(this.layer.map.baseLayer.wrapDateLine){var b=this.layer.map.getMaxExtent(),c=this.layer.map.getResolution();a=a.wrapDateLine(b,{leftTolerance:c,rightTolerance:c})}this.bounds=a},moveTo:function(a,b,c){null==c&&(c=!0);this.setBounds(a);this.position=b.clone();c&&this.draw()},clear:function(a){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(a,b,c,d,e,f){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=d;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)this.frame=document.createElement("div"),this.frame.style.position=
"absolute",this.frame.style.overflow="hidden";null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null);this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);a?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent=
"reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):!1===a&&this.unload();return a},renderTile:function(){if(this.layer.async){var a=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(b){a==this.asyncRequestId&&(this.url=b,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var a=this.getTile().style,b=this.frame?this.size:this.layer.getImageSize(this.bounds),
c=1;this.layer instanceof OpenLayers.Layer.Grid&&(c=this.layer.getServerResolution()/this.layer.map.getResolution());a.left=this.position.x+"px";a.top=this.position.y+"px";a.width=Math.round(c*b.w)+"px";a.height=Math.round(c*b.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var a=this.imgDiv;if(a){var b=this.getTile();b.parentNode===this.layer.div&&this.layer.div.removeChild(b);this.setImgSrc();!0===this.layerAlphaHack&&(a.style.filter="");OpenLayers.Element.removeClass(a,
"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var a=this.imgDiv.style;if(this.frame){var b=0,c=0;this.layer.gutter&&(b=100*(this.layer.gutter/this.layer.tileSize.w),c=100*(this.layer.gutter/this.layer.tileSize.h));a.left=-b+"%";a.top=-c+"%";a.width=2*b+100+"%";a.height=2*c+100+"%"}a.visibility="hidden";a.opacity=0;1>this.layer.opacity&&(a.filter="alpha(opacity="+100*this.layer.opacity+")");a.position="absolute";
this.layerAlphaHack&&(a.paddingTop=a.height,a.height="0",a.width="100%");this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(a){this.imgDiv=a},initImage:function(){if(this.url||this.imgDiv){this.events.triggerEvent("beforeload");this.layer.div.appendChild(this.getTile());this.events.triggerEvent(this._loadEvent);var a=this.getImage(),b=a.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(b,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,
this),0):(this.stopLoading(),this.crossOriginKeyword&&a.removeAttribute("crossorigin"),OpenLayers.Event.observe(a,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(a,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))}else this.isLoading=!1},setImgSrc:function(a){var b=this.imgDiv;a?(b.style.visibility="hidden",b.style.opacity=0,this.crossOriginKeyword&&("data:"!==a.substr(0,5)?b.setAttribute("crossorigin",this.crossOriginKeyword):
b.removeAttribute("crossorigin")),b.src=a):(this.stopLoading(),this.imgDiv=null,b.parentNode&&b.parentNode.removeChild(b))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var a;this.frame?(a=this.frame.cloneNode(!1),a.appendChild(this.imgDiv)):a=this.imgDiv;this.imgDiv=null;return a}},onImageLoad:function(){var a=this.imgDiv;this.stopLoading();a.style.visibility="inherit";a.style.opacity=this.layer.opacity;this.isLoading=
!1;this.canvasContext=null;this.events.triggerEvent("loadend");!0===this.layerAlphaHack&&(a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"', sizingMethod='scale')")},onImageError:function(){var a=this.imgDiv;null!=a.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(a,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv);
window.clearTimeout(this._loadTimeout);delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var a=document.createElement("canvas");a.width=this.size.w;a.height=this.size.h;this.canvasContext=a.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});
OpenLayers.Tile.Image.IMAGE=function(){var a=new Image;a.className="olTileImage";a.galleryImg="no";return a}();OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend",
"webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(a,b,c,d){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this);this.initProperties();this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500);void 0===this.options.className&&(this.className=this.singleTile?
"olLayerGridSingleTile":"olLayerGrid")},setMap:function(a){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,a);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(a){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer();this.clearGrid();this.tileSize=this.grid=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var a=0,b=this.grid.length;a<b;a++)for(var c=this.grid[a],d=0,e=c.length;d<e;d++)this.destroyTile(c[d]);
this.grid=[];this.gridLayout=this.gridResolution=null}},addOptions:function(a,b){var c=void 0!==a.singleTile&&a.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments);this.map&&c&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(a){null==a&&(a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,
[a]);null!=this.tileSize&&(a.tileSize=this.tileSize.clone());a.grid=[];a.gridResolution=null;a.backBuffer=null;a.backBufferTimerId=null;a.loading=!1;a.numLoadingTiles=0;return a},moveTo:function(a,b,c){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);a=a||this.map.getExtent();if(null!=a){var d=!this.grid.length||b,e=this.getTilesBounds(),f=this.map.getResolution();this.getServerResolution(f);if(this.singleTile){if(d||!c&&!e.containsBounds(a))b&&"resize"!==this.transitionEffect&&
this.removeBackBuffer(),b&&"resize"!==this.transitionEffect||this.applyBackBuffer(f),this.initSingleTile(a)}else(d=d||!e.intersectsBounds(a,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}))?(!b||"resize"!==this.transitionEffect&&this.gridResolution!==f||this.applyBackBuffer(f),this.initGriddedTiles(a)):this.moveGriddedTiles()}},getTileData:function(a){var b=null,c=a.lon,d=a.lat,e=this.grid.length;if(this.map&&e){var f=this.map.getResolution();a=this.tileSize.w;var g=this.tileSize.h,
h=this.grid[0][0].bounds,k=h.left,h=h.top;if(c<k&&this.map.baseLayer.wrapDateLine)var l=this.map.getMaxExtent().getWidth(),m=Math.ceil((k-c)/l),c=c+l*m;c=(c-k)/(f*a);d=(h-d)/(f*g);f=Math.floor(c);k=Math.floor(d);0<=k&&k<e&&(e=this.grid[k][f])&&(b={tile:e,i:Math.floor((c-f)*a),j:Math.floor((d-k)*g)})}return b},destroyTile:function(a){this.removeTileMonitoringHooks(a);a.destroy()},getServerResolution:function(a){var b=Number.POSITIVE_INFINITY;a=a||this.map.getResolution();if(this.serverResolutions&&
-1===OpenLayers.Util.indexOf(this.serverResolutions,a)){var c,d,e,f;for(c=this.serverResolutions.length-1;0<=c;c--){e=this.serverResolutions[c];d=Math.abs(e-a);if(d>b)break;b=d;f=e}a=f}return a},getServerZoom:function(){var a=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,a):this.map.getZoomForResolution(a)+(this.zoomOffset||0)},applyBackBuffer:function(a){null!==this.backBufferTimerId&&this.removeBackBuffer();var b=this.backBuffer;if(!b){b=
this.createBackBuffer();if(!b)return;a===this.gridResolution?this.div.insertBefore(b,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(b,this.map.baseLayer.div);this.backBuffer=b;var c=this.grid[0][0].bounds;this.backBufferLonLat={lon:c.left,lat:c.top};this.backBufferResolution=this.gridResolution}for(var c=this.backBufferResolution/a,d=b.childNodes,e,f=d.length-1;0<=f;--f)e=d[f],e.style.top=(c*e._i*e._h|0)+"px",e.style.left=(c*e._j*e._w|0)+"px",e.style.width=Math.round(c*e._w)+
"px",e.style.height=Math.round(c*e._h)+"px";a=this.getViewPortPxFromLonLat(this.backBufferLonLat,a);c=this.map.layerContainerOriginPx.y;b.style.left=Math.round(a.x-this.map.layerContainerOriginPx.x)+"px";b.style.top=Math.round(a.y-c)+"px"},createBackBuffer:function(){var a;if(0<this.grid.length){a=document.createElement("div");a.id=this.div.id+"_bb";a.className="olBackBuffer";a.style.position="absolute";var b=this.map;a.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:b.Z_INDEX_BASE.BaseLayer-
(b.getNumLayers()-b.getLayerIndex(this));for(var b=0,c=this.grid.length;b<c;b++)for(var d=0,e=this.grid[b].length;d<e;d++){var f=this.grid[b][d],g=this.grid[b][d].createBackBuffer();g&&(g._i=b,g._j=d,g._w=f.size.w,g._h=f.size.h,g.id=f.id+"_bb",a.appendChild(g))}}return a},removeBackBuffer:function(){if(this._transitionElement){for(var a=this.transitionendEvents.length-1;0<=a;--a)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[a],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&
(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(a,b){this.singleTile||this.moveGriddedTiles()},setTileSize:function(a){this.singleTile&&(a=this.map.getSize(),a.h=parseInt(a.h*this.ratio,10),a.w=parseInt(a.w*this.ratio,10));OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getTilesBounds:function(){var a=
null,b=this.grid.length;if(b)var a=this.grid[b-1][0].bounds,b=this.grid[0].length*a.getWidth(),c=this.grid.length*a.getHeight(),a=new OpenLayers.Bounds(a.left,a.bottom,a.left+b,a.bottom+c);return a},initSingleTile:function(a){this.events.triggerEvent("retile");var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio;a=a.getHeight()*this.ratio;b=new OpenLayers.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2);c=this.map.getLayerPxFromLonLat({lon:b.left,lat:b.top});this.grid.length||(this.grid[0]=[]);(a=this.grid[0][0])?
a.moveTo(b,c):(a=this.addTile(b,c),this.addTileMonitoringHooks(a),a.draw(),this.grid[0][0]=a);this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w;c*=this.tileSize.h;var e=Math.floor((a.left-b.lon)/d)-this.buffer,f=this.rowSign;a=Math[~f?"floor":"ceil"](f*(b.lat-a.top+c)/c)-this.buffer*f;return{tilelon:d,tilelat:c,startcol:e,startrow:a}},getTileOrigin:function(){var a=this.tileOrigin;if(!a)var a=this.getMaxExtent(),
b={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],a=new OpenLayers.LonLat(a[b[0]],a[b[1]]);return a},getTileBoundsForGridIndex:function(a,b){var c=this.getTileOrigin(),d=this.gridLayout,e=d.tilelon,f=d.tilelat,g=d.startcol,d=d.startrow,h=this.rowSign;return new OpenLayers.Bounds(c.lon+(g+b)*e,c.lat-(d+a*h)*f*h,c.lon+(g+b+1)*e,c.lat-(d+(a-1)*h)*f*h)},initGriddedTiles:function(a){this.events.triggerEvent("retile");var b=this.map.getSize(),c=this.getTileOrigin(),
d=this.map.getResolution(),e=this.getServerResolution(),f=d/e,d=this.tileSize.w/f,f=this.tileSize.h/f,g=Math.ceil(b.h/f)+2*this.buffer+1,b=Math.ceil(b.w/d)+2*this.buffer+1;this.gridLayout=e=this.calculateGridLayout(a,c,e);var c=e.tilelon,h=e.tilelat,e=this.map.layerContainerOriginPx.x,k=this.map.layerContainerOriginPx.y,l=this.getTileBoundsForGridIndex(0,0),m=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(l.left,l.top));m.x=Math.round(m.x)-e;m.y=Math.round(m.y)-k;var e=[],k=this.map.getCenter(),
n=0;do{var p=this.grid[n];p||(p=[],this.grid.push(p));var q=0;do{var l=this.getTileBoundsForGridIndex(n,q),r=m.clone();r.x+=q*Math.round(d);r.y+=n*Math.round(f);var s=p[q];s?s.moveTo(l,r,!1):(s=this.addTile(l,r),this.addTileMonitoringHooks(s),p.push(s));r=l.getCenterLonLat();e.push({tile:s,distance:Math.pow(r.lon-k.lon,2)+Math.pow(r.lat-k.lat,2)});q+=1}while(l.right<=a.right+c*this.buffer||q<b);n+=1}while(l.bottom>=a.bottom-h*this.buffer||n<g);this.removeExcessTiles(n,q);this.gridResolution=d=this.getServerResolution();
e.sort(function(a,b){return a.distance-b.distance});a=0;for(d=e.length;a<d;++a)e[a].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(a,b){var c=new this.tileClass(this,b,a,null,this.tileSize,this.tileOptions);this.events.triggerEvent("addtile",{tile:c});return c},addTileMonitoringHooks:function(a){a.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart"));this.events.triggerEvent("tileloadstart",{tile:a});this.numLoadingTiles++;
!this.singleTile&&(this.backBuffer&&this.gridResolution===this.backBufferResolution)&&OpenLayers.Element.addClass(a.getTile(),"olTileReplacing")};a.onLoadEnd=function(b){this.numLoadingTiles--;b="unload"===b.type;this.events.triggerEvent("tileloaded",{tile:a,aborted:b});if(!this.singleTile&&!b&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var c=a.getTile();if("none"===OpenLayers.Element.getStyle(c,"display")){var d=document.getElementById(a.id+"_bb");d&&d.parentNode.removeChild(d)}OpenLayers.Element.removeClass(c,
"olTileReplacing")}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=b?this.div.lastChild:a.imgDiv;b=this.transitionendEvents;for(c=b.length-1;0<=c;--c)OpenLayers.Event.observe(this._transitionElement,b[c],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1;this.events.triggerEvent("loadend")}};a.onLoadError=function(){this.events.triggerEvent("tileerror",
{tile:a})};a.events.on({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},moveGriddedTiles:function(){for(var a=this.buffer+1;;){var b=this.grid[0][0],c=b.position.x+this.map.layerContainerOriginPx.x,b=b.position.y+this.map.layerContainerOriginPx.y,d=this.getServerResolution()/this.map.getResolution(),
d={w:Math.round(this.tileSize.w*d),h:Math.round(this.tileSize.h*d)};if(c>-d.w*(a-1))this.shiftColumn(!0,d);else if(c<-d.w*a)this.shiftColumn(!1,d);else if(b>-d.h*(a-1))this.shiftRow(!0,d);else if(b<-d.h*a)this.shiftRow(!1,d);else break}},shiftRow:function(a,b){var c=this.grid,d=a?0:c.length-1,e=a?-1:1;this.gridLayout.startrow+=e*this.rowSign;for(var f=c[d],g=c[a?"pop":"shift"](),h=0,k=g.length;h<k;h++){var l=g[h],m=f[h].position.clone();m.y+=b.h*e;l.moveTo(this.getTileBoundsForGridIndex(d,h),m)}c[a?
"unshift":"push"](g)},shiftColumn:function(a,b){var c=this.grid,d=a?0:c[0].length-1,e=a?-1:1;this.gridLayout.startcol+=e;for(var f=0,g=c.length;f<g;f++){var h=c[f],k=h[d].position.clone(),l=h[a?"pop":"shift"]();k.x+=b.w*e;l.moveTo(this.getTileBoundsForGridIndex(f,d),k);h[a?"unshift":"push"](l)}},removeExcessTiles:function(a,b){for(var c,d;this.grid.length>a;){var e=this.grid.pop();c=0;for(d=e.length;c<d;c++){var f=e[c];this.destroyTile(f)}}c=0;for(d=this.grid.length;c<d;c++)for(;this.grid[c].length>
b;)e=this.grid[c],f=e.pop(),this.destroyTile(f)},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(a){var b=this.maxExtent,c=this.getResolution(),d=c*this.tileSize.w,c=c*this.tileSize.h,e=this.getLonLatFromViewPortPx(a);a=b.left+d*Math.floor((e.lon-b.left)/d);b=b.bottom+c*Math.floor((e.lat-b.bottom)/c);return new OpenLayers.Bounds(a,b,a+d,b+c)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:"antialiasing blockout font fontcolor fontsize fontstyle glowing interval outline printmode shadow transparency".split(" "),request:null,response:null,initialize:function(a){this.request=new OpenLayers.Format.ArcXML.Request;this.response=new OpenLayers.Format.ArcXML.Response;if(a)if("feature"==a.requesttype){this.request.get_image=null;var b=this.request.get_feature.query;this.addCoordSys(b.featurecoordsys,a.featureCoordSys);
this.addCoordSys(b.filtercoordsys,a.filterCoordSys);a.polygon?(b.isspatial=!0,b.spatialfilter.polygon=a.polygon):a.envelope&&(b.isspatial=!0,b.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(b.spatialfilter.envelope,a.envelope))}else"image"==a.requesttype?(this.request.get_feature=null,b=this.request.get_image.properties,this.parseEnvelope(b.envelope,a.envelope),this.addLayers(b.layerlist,a.layers),this.addImageSize(b.imagesize,a.tileSize),this.addCoordSys(b.featurecoordsys,
a.featureCoordSys),this.addCoordSys(b.filtercoordsys,a.filterCoordSys)):this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},parseEnvelope:function(a,b){b&&4==b.length&&(a.minx=b[0],a.miny=b[1],a.maxx=b[2],a.maxy=b[3])},addLayers:function(a,b){for(var c=0,d=b.length;c<d;c++)a.push(b[c])},addImageSize:function(a,b){null!==b&&(a.width=b.w,a.height=b.h,a.printwidth=b.w,a.printheight=b.h)},addCoordSys:function(a,b){"string"==typeof b?(a.id=parseInt(b),a.string=b):"object"==typeof b&&
null!==b.proj&&(a.id=b.proj.srsProjNumber,a.string=b.proj.srsCode)},iserror:function(a){var b=null;a?(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]),a=a.documentElement.getElementsByTagName("ERROR"),b=null!==a&&0<a.length):b=""!==this.response.error;return b},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null;a&&a.documentElement&&(b="ARCXML"==a.documentElement.nodeName?a.documentElement:a.documentElement.getElementsByTagName("ARCXML")[0]);
if(!b||"parsererror"===b.firstChild.nodeName){var c,d;try{c=a.firstChild.nodeValue,d=a.firstChild.childNodes[1].firstChild.nodeValue}catch(e){}throw{message:"Error parsing the ArcXML request",error:c,source:d};}return this.parseResponse(b)},write:function(a){a||(a=this.request);var b=this.createElementNS("","ARCXML");b.setAttribute("version","1.1");var c=this.createElementNS("","REQUEST");if(null!=a.get_image){var d=this.createElementNS("","GET_IMAGE");c.appendChild(d);var e=this.createElementNS("",
"PROPERTIES");d.appendChild(e);a=a.get_image.properties;null!=a.featurecoordsys&&(d=this.createElementNS("","FEATURECOORDSYS"),e.appendChild(d),0===a.featurecoordsys.id?d.setAttribute("string",a.featurecoordsys.string):d.setAttribute("id",a.featurecoordsys.id));null!=a.filtercoordsys&&(d=this.createElementNS("","FILTERCOORDSYS"),e.appendChild(d),0===a.filtercoordsys.id?d.setAttribute("string",a.filtercoordsys.string):d.setAttribute("id",a.filtercoordsys.id));null!=a.envelope&&(d=this.createElementNS("",
"ENVELOPE"),e.appendChild(d),d.setAttribute("minx",a.envelope.minx),d.setAttribute("miny",a.envelope.miny),d.setAttribute("maxx",a.envelope.maxx),d.setAttribute("maxy",a.envelope.maxy));d=this.createElementNS("","IMAGESIZE");e.appendChild(d);d.setAttribute("height",a.imagesize.height);d.setAttribute("width",a.imagesize.width);if(a.imagesize.height!=a.imagesize.printheight||a.imagesize.width!=a.imagesize.printwidth)d.setAttribute("printheight",a.imagesize.printheight),d.setArrtibute("printwidth",a.imagesize.printwidth);
null!=a.background&&(d=this.createElementNS("","BACKGROUND"),e.appendChild(d),d.setAttribute("color",a.background.color.r+","+a.background.color.g+","+a.background.color.b),null!==a.background.transcolor&&d.setAttribute("transcolor",a.background.transcolor.r+","+a.background.transcolor.g+","+a.background.transcolor.b));if(null!=a.layerlist&&0<a.layerlist.length)for(d=this.createElementNS("","LAYERLIST"),e.appendChild(d),e=0;e<a.layerlist.length;e++){var f=this.createElementNS("","LAYERDEF");d.appendChild(f);
f.setAttribute("id",a.layerlist[e].id);f.setAttribute("visible",a.layerlist[e].visible);if("object"==typeof a.layerlist[e].query){var g=a.layerlist[e].query;if(0>g.where.length)continue;var h=null,h="boolean"==typeof g.spatialfilter&&g.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY");h.setAttribute("where",g.where);"number"==typeof g.accuracy&&0<g.accuracy&&h.setAttribute("accuracy",g.accuracy);"number"==typeof g.featurelimit&&2E3>g.featurelimit&&h.setAttribute("featurelimit",
g.featurelimit);"string"==typeof g.subfields&&"#ALL#"!=g.subfields&&h.setAttribute("subfields",g.subfields);"string"==typeof g.joinexpression&&0<g.joinexpression.length&&h.setAttribute("joinexpression",g.joinexpression);"string"==typeof g.jointables&&0<g.jointables.length&&h.setAttribute("jointables",g.jointables);f.appendChild(h)}"object"==typeof a.layerlist[e].renderer&&this.addRenderer(f,a.layerlist[e].renderer)}}else null!=a.get_feature&&(d=this.createElementNS("","GET_FEATURES"),d.setAttribute("outputmode",
"newxml"),d.setAttribute("checkesc","true"),a.get_feature.geometry?d.setAttribute("geometry",a.get_feature.geometry):d.setAttribute("geometry","false"),a.get_feature.compact&&d.setAttribute("compact",a.get_feature.compact),"number"==a.get_feature.featurelimit&&d.setAttribute("featurelimit",a.get_feature.featurelimit),d.setAttribute("globalenvelope","true"),c.appendChild(d),null!=a.get_feature.layer&&0<a.get_feature.layer.length&&(e=this.createElementNS("","LAYER"),e.setAttribute("id",a.get_feature.layer),
d.appendChild(e)),a=a.get_feature.query,null!=a&&(e=null,e=a.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),d.appendChild(e),"number"==typeof a.accuracy&&e.setAttribute("accuracy",a.accuracy),null!=a.featurecoordsys&&(d=this.createElementNS("","FEATURECOORDSYS"),0==a.featurecoordsys.id?d.setAttribute("string",a.featurecoordsys.string):d.setAttribute("id",a.featurecoordsys.id),e.appendChild(d)),null!=a.filtercoordsys&&(d=this.createElementNS("","FILTERCOORDSYS"),
0===a.filtercoordsys.id?d.setAttribute("string",a.filtercoordsys.string):d.setAttribute("id",a.filtercoordsys.id),e.appendChild(d)),0<a.buffer&&(d=this.createElementNS("","BUFFER"),d.setAttribute("distance",a.buffer),e.appendChild(d)),a.isspatial&&(d=this.createElementNS("","SPATIALFILTER"),d.setAttribute("relation",a.spatialfilter.relation),e.appendChild(d),a.spatialfilter.envelope?(f=this.createElementNS("","ENVELOPE"),f.setAttribute("minx",a.spatialfilter.envelope.minx),f.setAttribute("miny",a.spatialfilter.envelope.miny),
f.setAttribute("maxx",a.spatialfilter.envelope.maxx),f.setAttribute("maxy",a.spatialfilter.envelope.maxy),d.appendChild(f)):"object"==typeof a.spatialfilter.polygon&&d.appendChild(this.writePolygonGeometry(a.spatialfilter.polygon))),null!=a.where&&0<a.where.length&&e.setAttribute("where",a.where)));b.appendChild(c);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},addGroupRenderer:function(a,b){var c=this.createElementNS("","GROUPRENDERER");a.appendChild(c);for(var d=0;d<b.length;d++)this.addRenderer(c,
b[d])},addRenderer:function(a,b){if(OpenLayers.Util.isArray(b))this.addGroupRenderer(a,b);else{var c=this.createElementNS("",b.type.toUpperCase()+"RENDERER");a.appendChild(c);"VALUEMAPRENDERER"==c.tagName?this.addValueMapRenderer(c,b):"VALUEMAPLABELRENDERER"==c.tagName?this.addValueMapLabelRenderer(c,b):"SIMPLELABELRENDERER"==c.tagName?this.addSimpleLabelRenderer(c,b):"SCALEDEPENDENTRENDERER"==c.tagName&&this.addScaleDependentRenderer(c,b)}},addScaleDependentRenderer:function(a,b){"string"!=typeof b.lower&&
"number"!=typeof b.lower||a.setAttribute("lower",b.lower);"string"!=typeof b.upper&&"number"!=typeof b.upper||a.setAttribute("upper",b.upper);this.addRenderer(a,b.renderer)},addValueMapLabelRenderer:function(a,b){a.setAttribute("lookupfield",b.lookupfield);a.setAttribute("labelfield",b.labelfield);if("object"==typeof b.exacts)for(var c=0,d=b.exacts.length;c<d;c++){var e=b.exacts[c],f=this.createElementNS("","EXACT");"string"==typeof e.value&&f.setAttribute("value",e.value);"string"==typeof e.label&&
f.setAttribute("label",e.label);"string"==typeof e.method&&f.setAttribute("method",e.method);a.appendChild(f);if("object"==typeof e.symbol){var g=null;"text"==e.symbol.type&&(g=this.createElementNS("","TEXTSYMBOL"));if(null!=g){for(var h=this.fontStyleKeys,k=0,l=h.length;k<l;k++){var m=h[k];e.symbol[m]&&g.setAttribute(m,e.symbol[m])}f.appendChild(g)}}}},addValueMapRenderer:function(a,b){a.setAttribute("lookupfield",b.lookupfield);if("object"==typeof b.ranges)for(var c=0,d=b.ranges.length;c<d;c++){var e=
b.ranges[c],f=this.createElementNS("","RANGE");f.setAttribute("lower",e.lower);f.setAttribute("upper",e.upper);a.appendChild(f);if("object"==typeof e.symbol){var g=null;"simplepolygon"==e.symbol.type&&(g=this.createElementNS("","SIMPLEPOLYGONSYMBOL"));null!=g&&("string"==typeof e.symbol.boundarycolor&&g.setAttribute("boundarycolor",e.symbol.boundarycolor),"string"==typeof e.symbol.fillcolor&&g.setAttribute("fillcolor",e.symbol.fillcolor),"number"==typeof e.symbol.filltransparency&&g.setAttribute("filltransparency",
e.symbol.filltransparency),f.appendChild(g))}}else if("object"==typeof b.exacts)for(c=0,d=b.exacts.length;c<d;c++)e=b.exacts[c],f=this.createElementNS("","EXACT"),"string"==typeof e.value&&f.setAttribute("value",e.value),"string"==typeof e.label&&f.setAttribute("label",e.label),"string"==typeof e.method&&f.setAttribute("method",e.method),a.appendChild(f),"object"==typeof e.symbol&&(g=null,"simplemarker"==e.symbol.type&&(g=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=g&&("string"==typeof e.symbol.antialiasing&&
g.setAttribute("antialiasing",e.symbol.antialiasing),"string"==typeof e.symbol.color&&g.setAttribute("color",e.symbol.color),"string"==typeof e.symbol.outline&&g.setAttribute("outline",e.symbol.outline),"string"==typeof e.symbol.overlap&&g.setAttribute("overlap",e.symbol.overlap),"string"==typeof e.symbol.shadow&&g.setAttribute("shadow",e.symbol.shadow),"number"==typeof e.symbol.transparency&&g.setAttribute("transparency",e.symbol.transparency),"string"==typeof e.symbol.usecentroid&&g.setAttribute("usecentroid",
e.symbol.usecentroid),"number"==typeof e.symbol.width&&g.setAttribute("width",e.symbol.width),f.appendChild(g)))},addSimpleLabelRenderer:function(a,b){a.setAttribute("field",b.field);for(var c="featureweight howmanylabels labelbufferratio labelpriorities labelweight linelabelposition rotationalangles".split(" "),d=0,e=c.length;d<e;d++){var f=c[d];b[f]&&a.setAttribute(f,b[f])}if("text"==b.symbol.type){var g=b.symbol,h=this.createElementNS("","TEXTSYMBOL");a.appendChild(h);c=this.fontStyleKeys;d=0;
for(e=c.length;d<e;d++)f=c[d],g[f]&&h.setAttribute(f,b[f])}},writePolygonGeometry:function(a){if(!(a instanceof OpenLayers.Geometry.Polygon))throw{message:"Cannot write polygon geometry to ArcXML with an "+a.CLASS_NAME+" object.",geometry:a};for(var b=this.createElementNS("","POLYGON"),c=0,d=a.components.length;c<d;c++){for(var e=a.components[c],f=this.createElementNS("","RING"),g=0,h=e.components.length;g<h;g++){var k=e.components[g],l=this.createElementNS("","POINT");l.setAttribute("x",k.x);l.setAttribute("y",
k.y);f.appendChild(l)}b.appendChild(f)}return b},parseResponse:function(a){"string"==typeof a&&(a=(new OpenLayers.Format.XML).read(a));var b=new OpenLayers.Format.ArcXML.Response,c=a.getElementsByTagName("ERROR");if(null!=c&&0<c.length)b.error=this.getChildValue(c,"Unknown error.");else{c=a.getElementsByTagName("RESPONSE");if(null==c||0==c.length)return b.error="No RESPONSE tag found in ArcXML response.",b;var d=c[0].firstChild.nodeName;"#text"==d&&(d=c[0].firstChild.nextSibling.nodeName);if("IMAGE"==
d)c=a.getElementsByTagName("ENVELOPE"),a=a.getElementsByTagName("OUTPUT"),null==c||0==c.length?b.error="No ENVELOPE tag found in ArcXML response.":null==a||0==a.length?b.error="No OUTPUT tag found in ArcXML response.":(c=this.parseAttributes(c[0]),d=this.parseAttributes(a[0]),b.image="string"==typeof d.type?{envelope:c,output:{type:d.type,data:this.getChildValue(a[0])}}:{envelope:c,output:d});else if("FEATURES"==d){if(a=c[0].getElementsByTagName("FEATURES"),c=a[0].getElementsByTagName("FEATURECOUNT"),
b.features.featurecount=c[0].getAttribute("count"),0<b.features.featurecount)for(c=a[0].getElementsByTagName("ENVELOPE"),b.features.envelope=this.parseAttributes(c[0],"number"),a=a[0].getElementsByTagName("FEATURE"),c=0;c<a.length;c++){for(var d=new OpenLayers.Feature.Vector,e=a[c].getElementsByTagName("FIELD"),f=0;f<e.length;f++){var g=e[f].getAttribute("name"),h=e[f].getAttribute("value");d.attributes[g]=h}e=a[c].getElementsByTagName("POLYGON");if(0<e.length){e=e[0].getElementsByTagName("RING");
f=[];for(g=0;g<e.length;g++){h=[];h.push(this.parsePointGeometry(e[g]));for(var k=e[g].getElementsByTagName("HOLE"),l=0;l<k.length;l++)h.push(this.parsePointGeometry(k[l]));f.push(new OpenLayers.Geometry.Polygon(h))}d.geometry=1==f.length?f[0]:new OpenLayers.Geometry.MultiPolygon(f)}b.features.feature.push(d)}}else b.error="Unidentified response type."}return b},parseAttributes:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].nodeName]="number"==b?parseFloat(a.attributes[d].nodeValue):
a.attributes[d].nodeValue;return c},parsePointGeometry:function(a){var b=[],c=a.getElementsByTagName("COORDS");if(0<c.length)for(a=this.getChildValue(c[0]),a=a.split(/;/),c=0;c<a.length;c++){var d=a[c].split(/ /);b.push(new OpenLayers.Geometry.Point(d[0],d[1]))}else if(a=a.getElementsByTagName("POINT"),0<a.length)for(c=0;c<a.length;c++)b.push(new OpenLayers.Geometry.Point(parseFloat(a[c].getAttribute("x")),parseFloat(a[c].getAttribute("y"))));return new OpenLayers.Geometry.LinearRing(b)},CLASS_NAME:"OpenLayers.Format.ArcXML"});
OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(a){return OpenLayers.Util.extend(this,{get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",
legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]})},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"});
OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(a){return OpenLayers.Util.extend(this,{image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""})},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"});(function(){function a(){this._object=f&&!k?new f:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function b(){return new a}function c(a){b.onreadystatechange&&b.onreadystatechange.apply(a);a.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function d(a){try{a.responseText=a._object.responseText}catch(b){}try{var c;var d=a._object,e=d.responseXML,f=d.responseText;h&&(f&&e&&!e.documentElement&&d.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/))&&
(e=new window.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.validateOnParse=!1,e.loadXML(f));c=e&&(h&&0!=e.parseError||!e.documentElement||e.documentElement&&"parsererror"==e.documentElement.tagName)?null:e;a.responseXML=c}catch(g){}try{a.status=a._object.status}catch(k){}try{a.statusText=a._object.statusText}catch(u){}}function e(a){a._object.onreadystatechange=new window.Function}var f=window.XMLHttpRequest,g=!!window.controllers,h=window.document.all&&!window.opera,k=h&&window.navigator.userAgent.match(/MSIE 7.0/);
b.prototype=a.prototype;g&&f.wrapped&&(b.wrapped=f.wrapped);b.UNSENT=0;b.OPENED=1;b.HEADERS_RECEIVED=2;b.LOADING=3;b.DONE=4;b.prototype.readyState=b.UNSENT;b.prototype.responseText="";b.prototype.responseXML=null;b.prototype.status=0;b.prototype.statusText="";b.prototype.priority="NORMAL";b.prototype.onreadystatechange=null;b.onreadystatechange=null;b.onopen=null;b.onsend=null;b.onabort=null;b.prototype.open=function(a,f,k,p,q){delete this._headers;3>arguments.length&&(k=!0);this._async=k;var r=this,
s=this.readyState,t;h&&k&&(t=function(){s!=b.DONE&&(e(r),r.abort())},window.attachEvent("onunload",t));b.onopen&&b.onopen.apply(this,arguments);4<arguments.length?this._object.open(a,f,k,p,q):3<arguments.length?this._object.open(a,f,k,p):this._object.open(a,f,k);this.readyState=b.OPENED;c(this);this._object.onreadystatechange=function(){if(!g||k)r.readyState=r._object.readyState,d(r),r._aborted?r.readyState=b.UNSENT:(r.readyState==b.DONE&&(delete r._data,e(r),h&&k&&window.detachEvent("onunload",t)),
s!=r.readyState&&c(r),s=r.readyState)}};b.prototype.send=function(a){b.onsend&&b.onsend.apply(this,arguments);arguments.length||(a=null);a&&a.nodeType&&(a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml"));this._data=a;a:if(this._object.send(this._data),g&&!this._async)for(this.readyState=b.OPENED,d(this);this.readyState<b.DONE;)if(this.readyState++,c(this),this._aborted)break a};
b.prototype.abort=function(){b.onabort&&b.onabort.apply(this,arguments);this.readyState>b.UNSENT&&(this._aborted=!0);this._object.abort();e(this);this.readyState=b.UNSENT;delete this._data};b.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};b.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a)};b.prototype.setRequestHeader=function(a,b){this._headers||(this._headers={});this._headers[a]=b;return this._object.setRequestHeader(a,b)};
b.prototype.addEventListener=function(a,b,c){for(var d=0,e;e=this._listeners[d];d++)if(e[0]==a&&e[1]==b&&e[2]==c)return;this._listeners.push([a,b,c])};b.prototype.removeEventListener=function(a,b,c){for(var d=0,e;(e=this._listeners[d])&&(e[0]!=a||e[1]!=b||e[2]!=c);d++);e&&this._listeners.splice(d,1)};b.prototype.dispatchEvent=function(a){a={type:a.type,target:this,currentTarget:this,eventPhase:2,bubbles:a.bubbles,cancelable:a.cancelable,timeStamp:a.timeStamp,stopPropagation:function(){},preventDefault:function(){},
initEvent:function(){}};"readystatechange"==a.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[a]);for(var b=0,c;c=this._listeners[b];b++)c[0]!=a.type||c[2]||(c[1].handleEvent||c[1]).apply(this,[a])};b.prototype.toString=function(){return"[object XMLHttpRequest]"};b.toString=function(){return"[XMLHttpRequest]"};window.Function.prototype.apply||(window.Function.prototype.apply=function(a,b){b||(b=[]);a.__func=this;a.__func(b[0],b[1],b[2],b[3],
b[4]);delete a.__func});OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Request.XMLHttpRequest=b})();OpenLayers.ProxyHost="";OpenLayers.Request||(OpenLayers.Request={});
OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(a,b){var c=0!==a.indexOf("http"),d=!c&&a.match(this.URL_SPLIT_REGEX);if(d){var e=window.location,c=d[1]==e.protocol&&d[3]==
e.hostname,d=d[4],e=e.port;if(80!=d&&""!=d||"80"!=e&&""!=e)c=c&&d==e}c||b&&(a="function"==typeof b?b(a):b+encodeURIComponent(a));return a},issue:function(a){var b=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});a=a||{};a.headers=a.headers||{};a=OpenLayers.Util.applyDefaults(a,b);a.headers=OpenLayers.Util.applyDefaults(a.headers,b.headers);var b=!1,c;for(c in a.headers)a.headers.hasOwnProperty(c)&&"x-requested-with"===c.toLowerCase()&&(b=!0);!1===b&&(a.headers["X-Requested-With"]=
"XMLHttpRequest");var d=new OpenLayers.Request.XMLHttpRequest,e=OpenLayers.Util.urlAppend(a.url,OpenLayers.Util.getParameterString(a.params||{})),e=OpenLayers.Request.makeSameOrigin(e,a.proxy);d.open(a.method,e,a.async,a.user,a.password);for(var f in a.headers)d.setRequestHeader(f,a.headers[f]);var g=this.events,h=this;d.onreadystatechange=function(){d.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==g.triggerEvent("complete",{request:d,config:a,requestUrl:e})&&h.runCallbacks({request:d,config:a,
requestUrl:e})};!1===a.async?d.send(a.data):window.setTimeout(function(){0!==d.readyState&&d.send(a.data)},0);return d},runCallbacks:function(a){var b=a.request,c=a.config,d=c.scope?OpenLayers.Function.bind(c.callback,c.scope):c.callback,e;c.success&&(e=c.scope?OpenLayers.Function.bind(c.success,c.scope):c.success);var f;c.failure&&(f=c.scope?OpenLayers.Function.bind(c.failure,c.scope):c.failure);"file:"==OpenLayers.Util.createUrlObject(c.url).protocol&&b.responseText&&(b.status=200);d(b);if(!b.status||
200<=b.status&&300>b.status)this.events.triggerEvent("success",a),e&&e(b);b.status&&(200>b.status||300<=b.status)&&(this.events.triggerEvent("failure",a),f&&f(b))},GET:function(a){a=OpenLayers.Util.extend(a,{method:"GET"});return OpenLayers.Request.issue(a)},POST:function(a){a=OpenLayers.Util.extend(a,{method:"POST"});a.headers=a.headers?a.headers:{};"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(a)},PUT:function(a){a=
OpenLayers.Util.extend(a,{method:"PUT"});a.headers=a.headers?a.headers:{};"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(a)},DELETE:function(a){a=OpenLayers.Util.extend(a,{method:"DELETE"});return OpenLayers.Request.issue(a)},HEAD:function(a){a=OpenLayers.Util.extend(a,{method:"HEAD"});return OpenLayers.Request.issue(a)},OPTIONS:function(a){a=OpenLayers.Util.extend(a,{method:"OPTIONS"});return OpenLayers.Request.issue(a)}});OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(a,b,c){this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults({ServiceName:c.serviceName},
this.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(c,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,this.params,c]);this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"));null===this.options.layers&&(this.options.layers=[])},getURL:function(a){var b="";a=this.adjustBounds(a);a=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",
envelope:a.toArray(),tileSize:this.tileSize}));a=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:a.write(),async:!1});null!=a&&(b=a.responseXML,b&&b.documentElement||(b=a.responseText),b=(new OpenLayers.Format.ArcXML).read(b),b=this.getUrlOrImage(b.image.output));return b},getURLasync:function(a,b,c){a=this.adjustBounds(a);a=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),
async:!0,data:a.write(),callback:function(a){var e=a.responseXML;e&&e.documentElement||(e=a.responseText);a=(new OpenLayers.Format.ArcXML).read(e);b.call(c,this.getUrlOrImage(a.image.output))},scope:this})},getUrlOrImage:function(a){var b="";a.url?b=a.url:a.data&&(b="data:image/"+a.type+";base64,"+a.data);return b},setLayerQuery:function(a,b){for(var c=0;c<this.options.layers.length;c++)if(a==this.options.layers[c].id){this.options.layers[c].query=b;return}this.options.layers.push({id:a,visible:!0,
query:b})},getFeatureInfo:function(a,b,c){var d=c.buffer||1,e=c.callback||function(){},f=c.scope||window,g={};OpenLayers.Util.extend(g,this.options);g.requesttype="feature";a instanceof OpenLayers.LonLat?(g.polygon=null,g.envelope=[a.lon-d,a.lat-d,a.lon+d,a.lat+d]):a instanceof OpenLayers.Geometry.Polygon&&(g.envelope=null,g.polygon=a);var h=new OpenLayers.Format.ArcXML(g);OpenLayers.Util.extend(h.request.get_feature,c);h.request.get_feature.layer=b.id;"number"==typeof b.query.accuracy?h.request.get_feature.query.accuracy=
b.query.accuracy:(a=this.map.getCenter(),c=this.map.getViewPortPxFromLonLat(a),c.x++,c=this.map.getLonLatFromPixel(c),h.request.get_feature.query.accuracy=c.lon-a.lon);h.request.get_feature.query.where=b.query.where;h.request.get_feature.query.spatialfilter.relation="area_intersection";OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:h.write(),callback:function(a){a=h.parseResponse(a.responseText);h.iserror()?e.call(f,null):e.call(f,a.features)}})},clone:function(a){null==
a&&(a=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"});OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);this.removeButtons();this.position=this.buttons=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},
setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position;this.buttons=[];var b={w:18,h:18},c=new OpenLayers.Pixel(a.x+b.w/2,a.y);this._addButton("panup","north-mini.png",c,b);a.y=c.y+b.h;this._addButton("panleft","west-mini.png",a,b);this._addButton("panright","east-mini.png",a.add(b.w,0),b);this._addButton("pandown","south-mini.png",
c.add(0,2*b.h),b);this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b);this._addButton("zoomworld","zoom-world-mini.png",c.add(0,4*b.h+5),b);this._addButton("zoomout","zoom-minus-mini.png",c.add(0,5*b.h+5),b);return this.div},_addButton:function(a,b,c,d){b=OpenLayers.Util.getImageLocation(b);c=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,c,d,b,"absolute");c.style.cursor="pointer";this.div.appendChild(c);c.action=a;c.className="olButton";this.buttons.push(c);return c},_removeButton:function(a){this.div.removeChild(a);
OpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;0<=a;--a)this._removeButton(this.buttons[a])},onButtonClick:function(a){switch(a.buttonElement.action){case "panup":this.map.pan(0,-this.getSlideFactor("h"));break;case "pandown":this.map.pan(0,this.getSlideFactor("h"));break;case "panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case "panright":this.map.pan(this.getSlideFactor("w"),0);break;case "zoomin":this.map.zoomIn();break;case "zoomout":this.map.zoomOut();
break;case "zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,
arguments);this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar());this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];var b={w:18,h:18};if(this.panIcons){var c=new OpenLayers.Pixel(a.x+b.w/2,a.y),d=b.w;this.zoomWorldIcon&&(c=new OpenLayers.Pixel(a.x+b.w,a.y));this._addButton("panup","north-mini.png",c,b);a.y=c.y+b.h;
this._addButton("panleft","west-mini.png",a,b);this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",a.add(b.w,0),b),d*=2);this._addButton("panright","east-mini.png",a.add(d,0),b);this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b);this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b);c=this._addZoomBar(c.add(0,4*b.h+5));this._addButton("zoomout","zoom-minus-mini.png",c,b)}else this._addButton("zoomin","zoom-plus-mini.png",a,b),c=this._addZoomBar(a.add(0,b.h)),
this._addButton("zoomout","zoom-minus-mini.png",c,b),this.zoomWorldIcon&&(c=c.add(0,b.h+3),this._addButton("zoomworld","zoom-world-mini.png",c,b));return this.div},_addZoomBar:function(a){var b=OpenLayers.Util.getImageLocation("slider.png"),c=this.id+"_"+this.map.id,d=this.map.getMinZoom(),e=this.map.getNumZoomLevels()-1-this.map.getZoom(),e=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,e*this.zoomStopHeight),{w:20,h:9},b,"absolute");e.style.cursor="move";this.slider=e;this.sliderEvents=new OpenLayers.Events(this,
e,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var f={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-d)},b=OpenLayers.Util.getImageLocation("zoombar.png"),c=null;OpenLayers.Util.alphaHack()?(c=this.id+"_"+this.map.id,c=OpenLayers.Util.createAlphaImageDiv(c,a,{w:f.w,h:this.zoomStopHeight},b,"absolute",null,"crop"),c.style.height=
f.h+"px"):c=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,f,b);c.style.cursor="pointer";c.className="olButton";this.zoombarDiv=c;this.div.appendChild(c);this.startTop=parseInt(c.style.top);this.div.appendChild(e);this.map.events.register("zoomend",this,this.moveZoomBar);return a=a.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-d))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,
mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(a){OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(a.buttonElement===this.zoombarDiv){var b=a.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom)b=
Math.floor(b);b=this.map.getNumZoomLevels()-1-b;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(b)}},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},zoomBarDown:function(a){if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone(),this.div.style.cursor=
"move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a)},zoomBarDrag:function(a){if(null!=this.mouseDragStart){var b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv);0<a.clientY-c[1]&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2&&(b=parseInt(this.slider.style.top)-b,this.slider.style.top=b+"px",this.mouseDragStart=a.xy.clone());this.deltaY=this.zoomStart.y-a.xy.y;OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if((OpenLayers.Event.isLeftClick(a)||"touchend"===
a.type)&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(b+=this.deltaY/this.zoomStopHeight,b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1)):(b+=this.deltaY/this.zoomStopHeight,b=Math.max(Math.round(b),0));this.map.zoomTo(b);this.zoomStart=this.mouseDragStart=null;this.deltaY=0;OpenLayers.Event.stop(a)}},
moveZoomBar:function(){var a=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},readers:{wfs:{WFS_Capabilities:function(a,
b){this.readChildNodes(a,b)},FeatureTypeList:function(a,b){b.featureTypeList={featureTypes:[]};this.readChildNodes(a,b.featureTypeList)},FeatureType:function(a,b){var c={};this.readChildNodes(a,c);b.featureTypes.push(c)},Name:function(a,b){var c=this.getChildValue(a);c&&(c=c.split(":"),b.name=c.pop(),0<c.length&&(b.featureNS=this.lookupNamespaceURI(a,c[0])))},Title:function(a,b){var c=this.getChildValue(a);c&&(b.title=c)},Abstract:function(a,b){var c=this.getChildValue(a);c&&(b["abstract"]=c)}}},
CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,b,c,d,e){this.url=b;this.maxExtent=this.extent=c;this.size=d;OpenLayers.Layer.prototype.initialize.apply(this,[a,e]);this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null);OpenLayers.Layer.prototype.destroy.apply(this,
arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions()));return a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setMap:function(a){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w);OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=null==this.tile;if(b||d){this.setTileSize();
var e=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});d?(this.tile=new OpenLayers.Tile.Image(this,e,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=e.clone());this.tile.draw()}},setTileSize:function(){var a=this.extent.getWidth()/this.map.getResolution(),b=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(a,b)},addTileMonitoringHooks:function(a){a.onLoadStart=
function(){this.events.triggerEvent("loadstart")};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.events.triggerEvent("loadend")};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a;this.tile.draw()},getURL:function(a){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a;this.active=!1},destroy:function(){this.deactivate();this.options=this.layer=null},setLayer:function(a){this.layer=a},activate:function(){return this.active?!1:this.active=!0},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a]);this.events=new OpenLayers.Events(this)},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a&&this.auto)if("number"===typeof this.auto)this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1E3*this.auto);else this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,
scope:this});return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&this.auto&&("number"===typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this}));return a},triggerSave:function(a){var b=a.feature;b.state!==OpenLayers.State.INSERT&&b.state!==OpenLayers.State.UPDATE&&b.state!==OpenLayers.State.DELETE||this.save([a.feature])},save:function(a){a||(a=this.layer.features);
this.events.triggerEvent("start",{features:a});var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b)){for(var d=a.length,e=Array(d),f,g,h=0;h<d;++h)f=a[h],g=f.clone(),g.fid=f.fid,g.state=f.state,f.url&&(g.url=f.url),g._original=f,g.geometry.transform(c,b),e[h]=g;a=e}this.layer.protocol.commit(a,{callback:this.onCommit,scope:this})},onCommit:function(a){var b={response:a};if(a.success()){for(var c=a.reqFeatures,d,e=[],f=a.insertIds||[],g=0,h=0,k=c.length;h<k;++h)if(d=c[h],
d=d._original||d,a=d.state)a==OpenLayers.State.DELETE?e.push(d):a==OpenLayers.State.INSERT&&(d.fid=f[g],++g),d.state=null;0<e.length&&this.layer.destroyFeatures(e);this.events.triggerEvent("success",b)}else this.events.triggerEvent("fail",b)},CLASS_NAME:"OpenLayers.Strategy.Save"});OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(a){this.target=a;if(a.object instanceof OpenLayers.Map)this.setMap(a.object);else if(a.object instanceof OpenLayers.Layer.Vector)a.object.map?this.setMap(a.object.map):a.object.events.register("added",this,function(b){this.setMap(a.object.map)});else throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";
for(var b=this.provides.length-1;0<=b;--b)a.extensions[this.provides[b]]=!0},setMap:function(a){this.map=a;this.cache={};a.events.register("mousedown",this,this.start,{extension:!0});a.events.register("mouseup",this,this.onClick,{extension:!0});a.events.register("touchstart",this,this.start,{extension:!0});a.events.register("touchmove",this,this.cancel,{extension:!0});a.events.register("touchend",this,this.onClick,{extension:!0});a.events.register("mousemove",this,this.onMousemove,{extension:!0})},
start:function(a){this.startEvt=a},cancel:function(a){delete this.startEvt},onClick:function(a){if(this.startEvt&&("touchend"===a.type||OpenLayers.Event.isLeftClick(a))){a=this.getFeatures(this.startEvt);delete this.startEvt;for(var b,c,d={},e=0,f=a.length;e<f&&(b=a[e],c=b.layer,d[c.id]=!0,b=this.triggerEvent("featureclick",{feature:b}),!1!==b);++e);e=0;for(f=this.map.layers.length;e<f;++e)c=this.map.layers[e],c instanceof OpenLayers.Layer.Vector&&!d[c.id]&&this.triggerEvent("nofeatureclick",{layer:c})}},
onMousemove:function(a){delete this.startEvt;var b=this.getFeatures(a),c={};a=[];for(var d,e=0,f=b.length;e<f;++e)d=b[e],c[d.id]=d,this.cache[d.id]||a.push(d);var b=[],g;for(g in this.cache)d=this.cache[g],d.layer&&d.layer.map?c[d.id]||b.push(d):delete this.cache[g];e=0;for(f=a.length;e<f&&(d=a[e],this.cache[d.id]=d,g=this.triggerEvent("featureover",{feature:d}),!1!==g);++e);e=0;for(f=b.length;e<f&&(d=b[e],delete this.cache[d.id],g=this.triggerEvent("featureout",{feature:d}),!1!==g);++e);},triggerEvent:function(a,
b){var c=b.feature?b.feature.layer:b.layer,d=this.target.object;if(d instanceof OpenLayers.Map||d===c)return this.target.triggerEvent(a,b)},getFeatures:function(a){var b=a.clientX,c=a.clientY,d=[],e=[],f=[],g,h,k,l;for(l=this.map.layers.length-1;0<=l;--l)if(g=this.map.layers[l],"none"!==g.div.style.display)if(g.renderer instanceof OpenLayers.Renderer.Elements){if(g instanceof OpenLayers.Layer.Vector)for(h=document.elementFromPoint(b,c);h&&h._featureId;)(k=g.getFeatureById(h._featureId))?(d.push(k),
h.style.display="none",e.push(h),h=document.elementFromPoint(b,c)):h=!1;f.push(g);g.div.style.display="none"}else g.renderer instanceof OpenLayers.Renderer.Canvas&&(k=g.renderer.getFeatureIdFromEvent(a))&&(d.push(k),f.push(g));l=0;for(a=e.length;l<a;++l)e[l].style.display="";for(l=f.length-1;0<=l;--l)f[l].div.style.display="block";return d},destroy:function(){for(var a=this.provides.length-1;0<=a;--a)delete this.target.extensions[this.provides[a]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,
mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this});delete this.cache;delete this.map;delete this.target}});OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick;OpenLayers.Events.featureover=OpenLayers.Events.featureclick;OpenLayers.Events.featureout=OpenLayers.Events.featureclick;OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(a){this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,
[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=[];if(this.extractTracks)for(var c=a.getElementsByTagName("trk"),d=0,e=c.length;d<e;d++){var f={};this.extractAttributes&&(f=this.parseAttributes(c[d]));for(var g=this.getElementsByTagNameNS(c[d],c[d].namespaceURI,"trkseg"),h=0,k=g.length;h<k;h++){var l=this.extractSegment(g[h],"trkpt");b.push(new OpenLayers.Feature.Vector(l,f))}}if(this.extractRoutes)for(e=a.getElementsByTagName("rte"),c=0,d=
e.length;c<d;c++)f={},this.extractAttributes&&(f=this.parseAttributes(e[c])),g=this.extractSegment(e[c],"rtept"),b.push(new OpenLayers.Feature.Vector(g,f));if(this.extractWaypoints)for(a=a.getElementsByTagName("wpt"),c=0,e=a.length;c<e;c++)f={},this.extractAttributes&&(f=this.parseAttributes(a[c])),d=new OpenLayers.Geometry.Point(a[c].getAttribute("lon"),a[c].getAttribute("lat")),b.push(new OpenLayers.Feature.Vector(d,f));if(this.internalProjection&&this.externalProjection)for(f=0,a=b.length;f<a;f++)b[f].geometry.transform(this.externalProjection,
this.internalProjection);return b},extractSegment:function(a,b){for(var c=this.getElementsByTagNameNS(a,a.namespaceURI,b),d=[],e=0,f=c.length;e<f;e++)d.push(new OpenLayers.Geometry.Point(c[e].getAttribute("lon"),c[e].getAttribute("lat")));return new OpenLayers.Geometry.LineString(d)},parseAttributes:function(a){var b={};a=a.firstChild;for(var c,d;a;)1==a.nodeType&&a.firstChild&&(c=a.firstChild,3==c.nodeType||4==c.nodeType)&&(d=a.prefix?a.nodeName.split(":")[1]:a.nodeName,"trkseg"!=d&&"rtept"!=d&&
(b[d]=c.nodeValue)),a=a.nextSibling;return b},write:function(a,b){a=OpenLayers.Util.isArray(a)?a:[a];var c=this.createElementNS(this.namespaces.gpx,"gpx");c.setAttribute("version","1.1");c.setAttribute("creator",this.creator);this.setAttributes(c,{"xsi:schemaLocation":this.schemaLocation});b&&"object"==typeof b&&c.appendChild(this.buildMetadataNode(b));for(var d=0,e=a.length;d<e;d++)c.appendChild(this.buildFeatureNode(a[d]));return OpenLayers.Format.XML.prototype.write.apply(this,[c])},buildMetadataNode:function(a){for(var b=
["name","desc","author"],c=this.createElementNS(this.namespaces.gpx,"metadata"),d=0;d<b.length;d++){var e=b[d];if(a[e]){var f=this.createElementNS(this.namespaces.gpx,e);f.appendChild(this.createTextNode(a[e]));c.appendChild(f)}}return c},buildFeatureNode:function(a){var b=a.geometry,b=b.clone();this.internalProjection&&this.externalProjection&&b.transform(this.internalProjection,this.externalProjection);if("OpenLayers.Geometry.Point"==b.CLASS_NAME){var c=this.buildWptNode(b);this.appendAttributesNode(c,
a);return c}c=this.createElementNS(this.namespaces.gpx,"trk");this.appendAttributesNode(c,a);a=this.buildTrkSegNode(b);a=OpenLayers.Util.isArray(a)?a:[a];for(var b=0,d=a.length;b<d;b++)c.appendChild(a[b]);return c},buildTrkSegNode:function(a){var b,c,d,e;if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){b=this.createElementNS(this.namespaces.gpx,"trkseg");c=0;for(d=a.components.length;c<d;c++)e=a.components[c],b.appendChild(this.buildTrkPtNode(e));
return b}b=[];c=0;for(d=a.components.length;c<d;c++)b.push(this.buildTrkSegNode(a.components[c]));return b},buildTrkPtNode:function(a){var b=this.createElementNS(this.namespaces.gpx,"trkpt");b.setAttribute("lon",a.x);b.setAttribute("lat",a.y);return b},buildWptNode:function(a){var b=this.createElementNS(this.namespaces.gpx,"wpt");b.setAttribute("lon",a.x);b.setAttribute("lat",a.y);return b},appendAttributesNode:function(a,b){var c=this.createElementNS(this.namespaces.gpx,"name");c.appendChild(this.createTextNode(b.attributes.name||
b.id));a.appendChild(c);c=this.createElementNS(this.namespaces.gpx,"desc");c.appendChild(this.createTextNode(b.attributes.description||this.defaultDesc));a.appendChild(c)},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(a){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=a.documentElement.childNodes,c={layerDescriptions:[]},d,e,f=0;f<b.length;++f)if(d=b[f],e=d.nodeName,"LayerDescription"==e){e=d.getAttribute("name");var g="",h="",k="";d.getAttribute("owsType")?(g=d.getAttribute("owsType"),
h=d.getAttribute("owsURL")):""!=d.getAttribute("wfs")?(g="WFS",h=d.getAttribute("wfs")):""!=d.getAttribute("wcs")&&(g="WCS",h=d.getAttribute("wcs"));d=d.getElementsByTagName("Query");0<d.length&&((k=d[0].getAttribute("typeName"))||(k=d[0].getAttribute("typename")));d={layerName:e,owsType:g,owsURL:h,typeName:k};c.layerDescriptions.push(d);c.length=c.layerDescriptions.length;c[c.length-1]=d}else if("ServiceException"==e)return{error:(new OpenLayers.Format.OGCExceptionReport).read(a)};return c},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"});
OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1;OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(a,b,c){if(c&&c.sphericalMercator||this.sphericalMercator)c=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a||this.name,b||this.url,{},c])},clone:function(a){null==a&&(a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,
[a])},getURL:function(a){a=this.getXYZ(a);var b=this.url;OpenLayers.Util.isArray(b)&&(b=this.selectUrl(""+a.x+a.y+a.z,b));return OpenLayers.String.format(b,a)},getXYZ:function(a){var b=this.getServerResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w));a=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h));b=this.getServerZoom();if(this.wrapDateLine)var d=Math.pow(2,b),c=(c%d+d)%d;return{x:c,y:a,z:b}},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,
arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=
OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(a){null==a&&(a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a);OpenLayers.Util.extend(this,b)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return!1},setExtent:function(a,b){this.extent=a.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var c=a.getWidth()/this.map.getExtent().getWidth();
a=a.scale(1/c);this.extent=a.wrapDateLine(this.map.getMaxExtent()).scale(c)}b&&(this.resolution=null);return!0},setSize:function(a){this.size=a.clone();this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(a,b){null==b&&(b=a.style);if(a.geometry){var c=a.geometry.getBounds();if(c){var d;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent());c.intersectsBounds(this.extent,{worldBounds:d})?this.calculateFeatureDx(c,
d):b={display:"none"};c=this.drawGeometry(a.geometry,b,a.id);if("none"!=b.display&&b.label&&!1!==c){d=a.geometry.getCentroid();if(b.labelXOffset||b.labelYOffset){var e=isNaN(b.labelXOffset)?0:b.labelXOffset,f=isNaN(b.labelYOffset)?0:b.labelYOffset,g=this.getResolution();d.move(e*g,f*g)}this.drawText(a.id,b,d)}else this.removeText(a.id);return c}}},calculateFeatureDx:function(a,b){this.featureDx=0;if(b){var c=b.getWidth();this.featureDx=Math.round(((a.left+a.right)/2-(this.extent.left+this.extent.right)/
2)/c)*c}},drawGeometry:function(a,b,c){},drawText:function(a,b,c){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<c;++b){var d=a[b];this.eraseGeometry(d.geometry,d.id);this.removeText(d.id)}},eraseGeometry:function(a,b){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(a){var b=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);
!1===a.stroke&&(delete b.strokeWidth,delete b.strokeColor);!1===a.fill&&delete b.fillColor;OpenLayers.Util.extend(b,a);return b},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};
OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},
setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return!1},eraseGeometry:function(a,b){this.eraseFeatures(this.features[b][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(a){this.size=a.clone();var b=this.root;b.style.width=a.w+"px";b.style.height=a.h+"px";b.width=a.w;b.height=a.h;this.resolution=null;this.hitDetection&&(b=this.hitCanvas,b.style.width=a.w+"px",b.style.height=a.h+"px",b.width=a.w,b.height=a.h)},drawFeature:function(a,
b){var c;if(a.geometry){b=this.applyDefaultSymbolizer(b||a.style);c=a.geometry.getBounds();var d;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent());d=c&&c.intersectsBounds(this.extent,{worldBounds:d});(c="none"!==b.display&&!!c&&d)?this.features[a.id]=[a,b]:delete this.features[a.id];this.pendingRedraw=!0}this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1);return c},drawGeometry:function(a,b,c){var d=a.CLASS_NAME;if("OpenLayers.Geometry.Collection"==
d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d)for(d=0;d<a.components.length;d++)this.drawGeometry(a.components[d],b,c);else switch(a.CLASS_NAME){case "OpenLayers.Geometry.Point":this.drawPoint(a,b,c);break;case "OpenLayers.Geometry.LineString":this.drawLineString(a,b,c);break;case "OpenLayers.Geometry.LinearRing":this.drawLinearRing(a,b,c);break;case "OpenLayers.Geometry.Polygon":this.drawPolygon(a,b,c)}},drawExternalGraphic:function(a,
b,c){var d=new Image,e=b.title||b.graphicTitle;e&&(d.title=e);var f=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth,f=f?f:2*b.pointRadius,g=g?g:2*b.pointRadius,h=void 0!=b.graphicXOffset?b.graphicXOffset:-(0.5*f),k=void 0!=b.graphicYOffset?b.graphicYOffset:-(0.5*g),l=b.graphicOpacity||b.fillOpacity;d.onload=OpenLayers.Function.bind(function(){if(this.features[c]){var b=this.getLocalXY(a),e=b[0],b=b[1];if(!isNaN(e)&&!isNaN(b)){var e=e+h|0,b=b+k|0,p=this.canvas;p.globalAlpha=l;var q=
OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);p.drawImage(d,e*q,b*q,f*q,g*q);this.hitDetection&&(this.setHitContextStyle("fill",c),this.hitContext.fillRect(e,b,f,g))}}},this);d.src=b.externalGraphic},drawNamedSymbol:function(a,b,c){var d,e,f,g;f=Math.PI/180;var h=OpenLayers.Renderer.symbol[b.graphicName];if(!h)throw Error(b.graphicName+" is not a valid symbol name");
if(!(!h.length||2>h.length||(a=this.getLocalXY(a),e=a[0],g=a[1],isNaN(e)||isNaN(g)))){this.canvas.lineCap="round";this.canvas.lineJoin="round";this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round");if(b.graphicName in this.cachedSymbolBounds)d=this.cachedSymbolBounds[b.graphicName];else{d=new OpenLayers.Bounds;for(a=0;a<h.length;a+=2)d.extend(new OpenLayers.LonLat(h[a],h[a+1]));this.cachedSymbolBounds[b.graphicName]=d}this.canvas.save();this.hitDetection&&this.hitContext.save();
this.canvas.translate(e,g);this.hitDetection&&this.hitContext.translate(e,g);a=f*b.rotation;isNaN(a)||(this.canvas.rotate(a),this.hitDetection&&this.hitContext.rotate(a));f=2*b.pointRadius/Math.max(d.getWidth(),d.getHeight());this.canvas.scale(f,f);this.hitDetection&&this.hitContext.scale(f,f);a=d.getCenterLonLat().lon;d=d.getCenterLonLat().lat;this.canvas.translate(-a,-d);this.hitDetection&&this.hitContext.translate(-a,-d);g=b.strokeWidth;b.strokeWidth=g/f;if(!1!==b.fill){this.setCanvasStyle("fill",
b);this.canvas.beginPath();for(a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",c,b);this.hitContext.beginPath();for(a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.canvas.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath();this.hitContext.fill()}}if(!1!==b.stroke){this.setCanvasStyle("stroke",b);this.canvas.beginPath();for(a=0;a<h.length;a+=2)d=h[a],
e=h[a+1],0==a&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",c,b,f);this.hitContext.beginPath();for(a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.hitContext.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath();this.hitContext.stroke()}}b.strokeWidth=g;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle("reset")}},setCanvasStyle:function(a,b){"fill"===
a?(this.canvas.globalAlpha=b.fillOpacity,this.canvas.fillStyle=b.fillColor):"stroke"===a?(this.canvas.globalAlpha=b.strokeOpacity,this.canvas.strokeStyle=b.strokeColor,this.canvas.lineWidth=b.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(a){a=Number(a.split("_").pop())+1;16777216<=a&&(this.hitOverflow=a-16777215,a=a%16777216+1);a="000000"+a.toString(16);var b=a.length;return a="#"+a.substring(b-6,b)},setHitContextStyle:function(a,b,c,d){b=this.featureIdToHex(b);
"fill"==a?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=b):"stroke"==a?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=b,"undefined"===typeof d?this.hitContext.lineWidth=c.strokeWidth+2:isNaN(d)||(this.hitContext.lineWidth=c.strokeWidth+2/d)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(a,b,c){if(!1!==b.graphic)if(b.externalGraphic)this.drawExternalGraphic(a,b,c);else if(b.graphicName&&"circle"!=b.graphicName)this.drawNamedSymbol(a,b,c);else{var d=
this.getLocalXY(a);a=d[0];d=d[1];if(!isNaN(a)&&!isNaN(d)){var e=2*Math.PI,f=b.pointRadius;!1!==b.fill&&(this.setCanvasStyle("fill",b),this.canvas.beginPath(),this.canvas.arc(a,d,f,0,e,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),this.hitContext.arc(a,d,f,0,e,!0),this.hitContext.fill()));!1!==b.stroke&&(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),this.canvas.arc(a,d,f,0,e,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",
c,b),this.hitContext.beginPath(),this.hitContext.arc(a,d,f,0,e,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(a,b,c){b=OpenLayers.Util.applyDefaults({fill:!1},b);this.drawLinearRing(a,b,c)},drawLinearRing:function(a,b,c){!1!==b.fill&&(this.setCanvasStyle("fill",b),this.renderPath(this.canvas,a,b,c,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.renderPath(this.hitContext,a,b,c,"fill")));!1!==b.stroke&&(this.setCanvasStyle("stroke",b),this.renderPath(this.canvas,
a,b,c,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.renderPath(this.hitContext,a,b,c,"stroke")));this.setCanvasStyle("reset")},renderPath:function(a,b,c,d,e){b=b.components;c=b.length;a.beginPath();d=this.getLocalXY(b[0]);var f=d[1];if(!isNaN(d[0])&&!isNaN(f)){a.moveTo(d[0],d[1]);for(d=1;d<c;++d)f=this.getLocalXY(b[d]),a.lineTo(f[0],f[1]);"fill"===e?a.fill():a.stroke()}},drawPolygon:function(a,b,c){a=a.components;var d=a.length;this.drawLinearRing(a[0],b,c);for(var e=1;e<
d;++e)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(a[e],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},b),c),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(a[e],OpenLayers.Util.applyDefaults({fill:!1},b),c)},drawText:function(a,b){var c=this.getLocalXY(a);this.setCanvasStyle("reset");
this.canvas.fillStyle=b.fontColor;this.canvas.globalAlpha=b.fontOpacity||1;var d=[b.fontStyle?b.fontStyle:"normal","normal",b.fontWeight?b.fontWeight:"normal",b.fontSize?b.fontSize:"1em",b.fontFamily?b.fontFamily:"sans-serif"].join(" "),e=b.label.split("\n"),f=e.length;if(this.canvas.fillText){this.canvas.font=d;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[1]]||"middle";var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];
null==g&&(g=-0.5);d=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;c[1]+=d*g*(f-1);for(g=0;g<f;g++)b.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=b.labelOutlineOpacity||b.fontOpacity||1,this.canvas.strokeStyle=b.labelOutlineColor,this.canvas.lineWidth=b.labelOutlineWidth,this.canvas.strokeText(e[g],c[0],c[1]+d*g+1),this.canvas.restore()),this.canvas.fillText(e[g],c[0],c[1]+d*g)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=d;var h=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[0]];
null==h&&(h=-0.5);g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-0.5);d=this.canvas.mozMeasureText("xx");c[1]+=d*(1+g*f);for(g=0;g<f;g++){var k=c[0]+h*this.canvas.mozMeasureText(e[g]),l=c[1]+g*d;this.canvas.translate(k,l);this.canvas.mozDrawText(e[g]);this.canvas.translate(-k,-l)}}this.setCanvasStyle("reset")},getLocalXY:function(a){var b=this.getResolution(),c=this.extent;return[(a.x-this.featureDx)/b+-c.left/b,c.top/b-a.y/b]},clear:function(){var a=this.root.height,b=this.root.width;
this.canvas.clearRect(0,0,b,a);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,b,a)},getFeatureIdFromEvent:function(a){var b;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging&&(a=a.xy,a=this.hitContext.getImageData(a.x|0,a.y|0,1,1).data,255===a[3]&&(a=a[2]+256*(a[1]+256*a[0])))){a="OpenLayers_Feature_Vector_"+(a-1+this.hitOverflow);try{b=this.features[a][0]}catch(c){}}return b},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0;b<a.length;++b)delete this.features[a[b].id];
this.redraw()},redraw:function(){if(!this.locked){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a);this.hitDetection&&this.hitContext.clearRect(0,0,b,a);var a=[],c,d,e=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent(),f;for(f in this.features)this.features.hasOwnProperty(f)&&(b=this.features[f][0],c=b.geometry,this.calculateFeatureDx(c.getBounds(),e),d=this.features[f][1],this.drawGeometry(c,d,b.id),d.label&&a.push([b,d]));b=0;for(c=a.length;b<c;++b)f=
a[b],this.drawText(f[0].geometry.getCentroid(),f[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(a){var b={interestingTagsExclude:"source source_ref source:ref history attribution created_by".split(" "),areaTags:"area building leisure tourism ruins historic landuse military natural sport".split(" ")},b=OpenLayers.Util.extend(b,a),c={};for(a=0;a<b.interestingTagsExclude.length;a++)c[b.interestingTagsExclude[a]]=!0;b.interestingTagsExclude=c;c={};for(a=0;a<b.areaTags.length;a++)c[b.areaTags[a]]=
!0;b.areaTags=c;this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=this.getNodes(a),c=this.getWays(a);a=Array(c.length);for(var d=0;d<c.length;d++){for(var e=Array(c[d].nodes.length),f=this.isWayArea(c[d])?1:0,g=0;g<c[d].nodes.length;g++){var h=b[c[d].nodes[g]],k=new OpenLayers.Geometry.Point(h.lon,h.lat);k.osm_id=parseInt(c[d].nodes[g]);
e[g]=k;h.used=!0}h=null;h=f?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(e)):new OpenLayers.Geometry.LineString(e);this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection);e=new OpenLayers.Feature.Vector(h,c[d].tags);e.osm_id=parseInt(c[d].id);e.fid="way."+e.osm_id;a[d]=e}for(var l in b){h=b[l];if(!h.used||this.checkTags){c=null;if(this.checkTags){c=this.getTags(h.node,!0);if(h.used&&!c[1])continue;c=c[0]}else c=this.getTags(h.node);
e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(h.lon,h.lat),c);this.internalProjection&&this.externalProjection&&e.geometry.transform(this.externalProjection,this.internalProjection);e.osm_id=parseInt(l);e.fid="node."+e.osm_id;a.push(e)}h.node=null}return a},getNodes:function(a){a=a.getElementsByTagName("node");for(var b={},c=0;c<a.length;c++){var d=a[c],e=d.getAttribute("id");b[e]={lat:d.getAttribute("lat"),lon:d.getAttribute("lon"),node:d}}return b},getWays:function(a){a=a.getElementsByTagName("way");
for(var b=[],c=0;c<a.length;c++){var d=a[c],e={id:d.getAttribute("id")};e.tags=this.getTags(d);d=d.getElementsByTagName("nd");e.nodes=Array(d.length);for(var f=0;f<d.length;f++)e.nodes[f]=d[f].getAttribute("ref");b.push(e)}return b},getTags:function(a,b){for(var c=a.getElementsByTagName("tag"),d={},e=!1,f=0;f<c.length;f++){var g=c[f].getAttribute("k");d[g]=c[f].getAttribute("v");b&&(this.interestingTagsExclude[g]||(e=!0))}return b?[d,e]:d},isWayArea:function(a){var b=!1,c=!1;a.nodes[0]==a.nodes[a.nodes.length-
1]&&(b=!0);if(this.checkTags)for(var d in a.tags)if(this.areaTags[d]){c=!0;break}return b&&(this.checkTags?c:!0)},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);this.osm_id=1;this.created_nodes={};var b=this.createElementNS(null,"osm");b.setAttribute("version","0.5");b.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var c=a.length-1;0<=c;c--)for(var d=this.createFeatureNodes(a[c]),e=0;e<d.length;e++)b.appendChild(d[e]);return OpenLayers.Format.XML.prototype.write.apply(this,
[b])},createFeatureNodes:function(a){var b=[],c=a.geometry.CLASS_NAME,c=c.substring(c.lastIndexOf(".")+1),c=c.toLowerCase();(c=this.createXML[c])&&(b=c.apply(this,[a]));return b},createXML:{point:function(a){var b=null,c=a.geometry?a.geometry:a;this.internalProjection&&this.externalProjection&&(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));var d=!1;a.osm_id?(b=a.osm_id,this.created_nodes[b]&&(d=!0)):(b=-this.osm_id,this.osm_id++);var e=d?this.created_nodes[b]:this.createElementNS(null,
"node");this.created_nodes[b]=e;e.setAttribute("id",b);e.setAttribute("lon",c.x);e.setAttribute("lat",c.y);a.attributes&&this.serializeTags(a,e);this.setState(a,e);return d?[]:[e]},linestring:function(a){var b,c=[],d=a.geometry;a.osm_id?b=a.osm_id:(b=-this.osm_id,this.osm_id++);var e=this.createElementNS(null,"way");e.setAttribute("id",b);for(b=0;b<d.components.length;b++){var f=this.createXML.point.apply(this,[d.components[b]]);if(f.length){var f=f[0],g=f.getAttribute("id");c.push(f)}else g=d.components[b].osm_id,
f=this.created_nodes[g];this.setState(a,f);f=this.createElementNS(null,"nd");f.setAttribute("ref",g);e.appendChild(f)}this.serializeTags(a,e);c.push(e);return c},polygon:function(a){var b=OpenLayers.Util.extend({area:"yes"},a.attributes),b=new OpenLayers.Feature.Vector(a.geometry.components[0],b);b.osm_id=a.osm_id;return this.createXML.linestring.apply(this,[b])}},serializeTags:function(a,b){for(var c in a.attributes){var d=this.createElementNS(null,"tag");d.setAttribute("k",c);d.setAttribute("v",
a.attributes[c]);b.appendChild(d)}},setState:function(a,b){if(a.state){var c=null;switch(a.state){case OpenLayers.State.UPDATE:case OpenLayers.State.DELETE:c="delete"}c&&b.setAttribute("action",c)}},CLASS_NAME:"OpenLayers.Format.OSM"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,
arguments)){this.observeElement=this.observeElement||document;for(var a=0,b=this.KEY_EVENTS.length;a<b;a++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[a],this.eventListener);return!0}return!1},deactivate:function(){var a=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var a=0,b=this.KEY_EVENTS.length;a<b;a++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[a],this.eventListener);a=!0}return a},handleKeyEvent:function(a){this.checkModifiers(a)&&
this.callback(a.type,[a])},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(a,b){b=b||{};this.layer=a;this.vertices=
[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,b.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[b]);OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var c={documentDrag:this.documentDrag,stopDown:!1};this.handlers=
{keyboard:new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeypress}),drag:new OpenLayers.Handler.Drag(this,{down:function(a){this.vertex=null;(a=this.layer.getFeatureFromEvent(this.handlers.drag.evt))?this.dragStart(a):this.clickout&&(this._unselect=this.feature)},move:function(a){delete this._unselect;this.vertex&&this.dragVertex(this.vertex,a)},up:function(){this.handlers.drag.stopDown=!1;this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(a){this.vertex&&
this.dragComplete(this.vertex)}},c)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});return this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},
deactivate:function(){var a=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate(),(a=this.feature)&&(a.geometry&&a.layer)&&this.unselectFeature(a),a=!0);return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",
{feature:a})},selectFeature:function(a){if(!(this.feature===a||this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME))){!1!==this.beforeSelectFeature(a)&&(this.feature&&this.unselectFeature(this.feature),this.feature=a,this.layer.selectedFeatures.push(a),this.layer.drawFeature(a,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var b=a.modified;!a.geometry||b&&b.geometry||(this._originalGeometry=a.geometry.clone())}},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,
{silent:!0});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:!0});this.virtualVertices=[];this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle);this.layer.drawFeature(this.feature,"default");this.feature=null;OpenLayers.Util.removeItem(this.layer.selectedFeatures,a);this.onModificationEnd(a);this.layer.events.triggerEvent("afterfeaturemodified",
{feature:a,modified:this.modified});this.modified=!1},dragStart:function(a){var b="OpenLayers.Geometry.Point"==a.geometry.CLASS_NAME;this.standalone||(a._sketch||!b)&&a._sketch||(this.toggle&&this.feature===a&&(this._unselect=a),this.selectFeature(a));if(a._sketch||b)this.vertex=a,this.handlers.drag.stopDown=!0},dragVertex:function(a,b){var c=this.map.getLonLatFromViewPortPx(b),d=a.geometry;d.move(c.lon-d.x,c.lat-d.y);this.modified=!0;"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?
this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}):(a._index?(a.geometry.parent.addComponent(a.geometry,a._index),delete a._index,OpenLayers.Util.removeItem(this.virtualVertices,a),this.vertices.push(a)):a==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):a!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",
{vertex:a.geometry,feature:this.feature,pixel:b}),0<this.virtualVertices.length&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"));this.layer.drawFeature(a)},dragComplete:function(a){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&
this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var a=this.feature;a.modified=OpenLayers.Util.extend(a.modified,{geometry:this._originalGeometry});delete this._originalGeometry}},resetVertices:function(){0<this.vertices.length&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]);0<this.virtualVertices.length&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]);this.dragHandle&&
(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null);this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&
(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(a){var b=a.keyCode;this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,b)&&(b=this.layer.getFeatureFromEvent(this.handlers.drag.evt))&&(-1!=OpenLayers.Util.indexOf(this.vertices,b)&&!this.handlers.drag.dragging&&b.geometry.parent)&&(b.geometry.parent.removeComponent(b.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:b.geometry,feature:this.feature,pixel:a.xy}),this.layer.drawFeature(this.feature,
this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))},collectVertices:function(){function a(c){var d,e,f;if("OpenLayers.Geometry.Point"==c.CLASS_NAME)e=new OpenLayers.Feature.Vector(c),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e);else{f=c.components.length;"OpenLayers.Geometry.LinearRing"==c.CLASS_NAME&&(f-=1);for(d=0;d<f;++d)e=
c.components[d],"OpenLayers.Geometry.Point"==e.CLASS_NAME?(e=new OpenLayers.Feature.Vector(e),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e)):a(e);if(b.createVertices&&"OpenLayers.Geometry.MultiPoint"!=c.CLASS_NAME)for(d=0,f=c.components.length;d<f-1;++d){e=c.components[d];var g=c.components[d+1];"OpenLayers.Geometry.Point"==e.CLASS_NAME&&"OpenLayers.Geometry.Point"==g.CLASS_NAME&&(e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((e.x+g.x)/2,(e.y+g.y)/2),null,b.virtualStyle),
e.geometry.parent=c,e._index=d+1,e._sketch=!0,b.virtualVertices.push(e))}}}this.vertices=[];this.virtualVertices=[];var b=this;a.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:!0});this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var a=this.feature.geometry,b=a.getBounds().getCenterLonLat(),b=new OpenLayers.Geometry.Point(b.lon,b.lat),c=new OpenLayers.Feature.Vector(b);b.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,
b,c);a.move(b,c)};c._sketch=!0;this.dragHandle=c;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),b=new OpenLayers.Geometry.Point(b.right,b.bottom),c=new OpenLayers.Feature.Vector(b),e=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,f=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,g=this.mode&
OpenLayers.Control.ModifyFeature.ROTATE;b.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var l=this.x-d.x,m=this.y-d.y,n=l-b,p=m-c;if(g){var q=Math.atan2(p,n),q=Math.atan2(m,l)-q,q=q*(180/Math.PI);a.rotate(q,d)}if(e){var r;f?(m/=p,r=l/n/m):(n=Math.sqrt(n*n+p*p),m=Math.sqrt(l*l+m*m)/n);a.resize(m,d,r)}};c._sketch=!0;this.radiusHandle=c;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(a){this.handlers.drag.setMap(a);
OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(a){"removelayer"!=a.type&&"order"!=a.property||this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});
OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677,0.14929107084870338,0.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',
metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(a){a=OpenLayers.Util.applyDefaults({sphericalMercator:!0},a);OpenLayers.Layer.XYZ.prototype.initialize.apply(this,[a.name||"Bing "+(a.type||this.type),null,a]);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId=
"_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var a=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),a=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(a),b=document.createElement("script");b.type="text/javascript";b.src=a;b.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(b)},
initLayer:function(){var a=this.metadata.resourceSets[0].resources[0],b=a.imageUrl.replace("{quadkey}","${quadkey}"),b=b.replace("{culture}",this.culture),b=b.replace(this.protocolRegex,this.protocol);this.url=[];for(var c=0;c<a.imageUrlSubdomains.length;++c)this.url.push(b.replace("{subdomain}",a.imageUrlSubdomains[c]));this.addOptions({maxResolution:Math.min(this.serverResolutions[a.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(a.zoomMax+1-a.zoomMin,this.numZoomLevels)},
!0);this.isBaseLayer||this.redraw();this.updateAttribution()},getURL:function(a){if(this.url){var b=this.getXYZ(a);a=b.x;for(var c=b.y,b=b.z,d=[],e=b;0<e;--e){var f="0",g=1<<e-1;0!=(a&g)&&f++;0!=(c&g)&&(f++,f++);d.push(f)}d=d.join("");a=this.selectUrl(""+a+c+b,this.url);return OpenLayers.String.format(a,{quadkey:d})}},updateAttribution:function(){var a=this.metadata;if(a.resourceSets&&this.map&&this.map.center){var b=a.resourceSets[0].resources[0],c=this.map.getExtent().transform(this.map.getProjectionObject(),
new OpenLayers.Projection("EPSG:4326")),d=b.imageryProviders||[],e=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),b="",f,g,h,k,l,m,n;g=0;for(h=d.length;g<h;++g)for(f=d[g],k=0,l=f.coverageAreas.length;k<l;++k)n=f.coverageAreas[k],m=OpenLayers.Bounds.fromArray(n.bbox,!0),c.intersectsBounds(m)&&(e<=n.zoomMax&&e>=n.zoomMin)&&(b+=f.attribution+" ");a=a.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),
logo:a,copyrights:b});this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.updateAttribution)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Bing(this.options));return a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);OpenLayers.Layer.XYZ.prototype.destroy.apply(this,
arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"});OpenLayers.Layer.Bing.processMetadata=function(a){this.metadata=a;this.initLayer();a=document.getElementById(this._callbackId);a.parentNode.removeChild(a);window[this._callbackId]=void 0;delete this._callbackId};OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(a,b){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(a instanceof OpenLayers.Style)this.styles["default"]=a,this.styles.select=a,this.styles.temporary=a,this.styles["delete"]=
a;else if("object"==typeof a)for(var c in a)if(a[c]instanceof OpenLayers.Style)this.styles[c]=a[c];else if("object"==typeof a[c])this.styles[c]=new OpenLayers.Style(a[c]);else{this.styles["default"]=new OpenLayers.Style(a);this.styles.select=new OpenLayers.Style(a);this.styles.temporary=new OpenLayers.Style(a);this.styles["delete"]=new OpenLayers.Style(a);break}OpenLayers.Util.extend(this,b)},destroy:function(){for(var a in this.styles)this.styles[a].destroy();this.styles=null},createSymbolizer:function(a,
b){a||(a=new OpenLayers.Feature.Vector);this.styles[b]||(b="default");a.renderIntent=b;var c={};this.extendDefault&&"default"!=b&&(c=this.styles["default"].createSymbolizer(a));return OpenLayers.Util.extend(c,this.styles[b].createSymbolizer(a))},addUniqueValueRules:function(a,b,c,d){var e=[],f;for(f in c)e.push(new OpenLayers.Rule({symbolizer:c[f],context:d,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:f})}));this.styles[a].addRules(e)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.renderer&&this.renderer.supported()||this.assignRenderer();this.renderer&&this.renderer.supported()||
(this.renderer=null,this.displayError());this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies)for(var c=0,d=this.strategies.length;c<d;c++)this.strategies[c].setLayer(this)},destroy:function(){if(this.strategies){var a,b,c;b=0;for(c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoDestroy&&a.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=
null);this.destroyFeatures();this.unrenderedFeatures=this.selectedFeatures=this.features=null;this.renderer&&this.renderer.destroy();this.drawn=this.geometryType=this.renderer=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Vector(this.name,this.getOptions()));a=OpenLayers.Layer.prototype.clone.apply(this,[a]);for(var b=this.features,c=b.length,d=Array(c),e=0;e<c;++e)d[e]=b[e].clone();a.features=d;return a},refresh:function(a){this.calculateInRange()&&
this.visibility&&this.events.triggerEvent("refresh",a)},assignRenderer:function(){for(var a=0,b=this.renderers.length;a<b;a++){var c=this.renderers[a];if((c="function"==typeof c?c:OpenLayers.Renderer[c])&&c.prototype.supported()){this.renderer=new c(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,
arguments);if(this.renderer){this.renderer.map=this.map;var b=this.map.getSize();b.w*=this.ratio;b.h*=this.ratio;this.renderer.setSize(b)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var a,b,c;b=0;for(c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoActivate&&a.activate()}},removeMap:function(a){this.drawn=!1;if(this.strategies){var b,c;b=0;for(c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoActivate&&a.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,
arguments);var a=this.map.getSize();a.w*=this.ratio;a.h*=this.ratio;this.renderer.setSize(a)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=!0;if(!c){this.renderer.root.style.visibility="hidden";var d=this.map.getSize(),e=d.w,d=d.h,e=e/2*this.ratio-e/2,d=d/2*this.ratio-d/2,e=e+this.map.layerContainerOriginPx.x,e=-Math.round(e),d=d+this.map.layerContainerOriginPx.y,d=-Math.round(d);this.div.style.left=e+"px";this.div.style.top=d+"px";e=this.map.getExtent().scale(this.ratio);
d=this.renderer.setExtent(e,b);this.renderer.root.style.visibility="visible";!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft);if(!b&&d)for(var f in this.unrenderedFeatures)e=this.unrenderedFeatures[f],this.drawFeature(e)}if(!this.drawn||b||!d)for(this.drawn=!0,f=0,d=this.features.length;f<d;f++)this.renderer.locked=f!==d-1,e=this.features[f],this.drawFeature(e)},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;b!=this.renderer.root.style.display&&
(this.renderer.root.style.display=b)},addFeatures:function(a,b){OpenLayers.Util.isArray(a)||(a=[a]);var c=!b||!b.silent;if(c){var d={features:a};if(!1===this.events.triggerEvent("beforefeaturesadded",d))return;a=d.features}for(var d=[],e=0,f=a.length;e<f;e++){this.renderer.locked=e!=a.length-1?!0:!1;var g=a[e];if(this.geometryType&&!(g.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);g.layer=this;!g.style&&this.style&&
(g.style=OpenLayers.Util.extend({},this.style));if(c){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:g}))continue;this.preFeatureInsert(g)}d.push(g);this.features.push(g);this.drawFeature(g);c&&(this.events.triggerEvent("featureadded",{feature:g}),this.onFeatureInsert(g))}c&&this.events.triggerEvent("featuresadded",{features:d})},removeFeatures:function(a,b){if(a&&0!==a.length){if(a===this.features)return this.removeAllFeatures(b);OpenLayers.Util.isArray(a)||(a=[a]);a===this.selectedFeatures&&
(a=a.slice());var c=!b||!b.silent;c&&this.events.triggerEvent("beforefeaturesremoved",{features:a});for(var d=a.length-1;0<=d;d--){this.renderer.locked=0!=d&&a[d-1].geometry?!0:!1;var e=a[d];delete this.unrenderedFeatures[e.id];c&&this.events.triggerEvent("beforefeatureremoved",{feature:e});this.features=OpenLayers.Util.removeItem(this.features,e);e.layer=null;e.geometry&&this.renderer.eraseFeatures(e);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,e)&&OpenLayers.Util.removeItem(this.selectedFeatures,
e);c&&this.events.triggerEvent("featureremoved",{feature:e})}c&&this.events.triggerEvent("featuresremoved",{features:a})}},removeAllFeatures:function(a){a=!a||!a.silent;var b=this.features;a&&this.events.triggerEvent("beforefeaturesremoved",{features:b});for(var c,d=b.length-1;0<=d;d--)c=b[d],a&&this.events.triggerEvent("beforefeatureremoved",{feature:c}),c.layer=null,a&&this.events.triggerEvent("featureremoved",{feature:c});this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=
[];a&&this.events.triggerEvent("featuresremoved",{features:b})},destroyFeatures:function(a,b){void 0==a&&(a=this.features);if(a){this.removeFeatures(a,b);for(var c=a.length-1;0<=c;c--)a[c].destroy()}},drawFeature:function(a,b){if(this.drawn){if("object"!=typeof b){b||a.state!==OpenLayers.State.DELETE||(b="delete");var c=b||a.renderIntent;(b=a.style||this.style)||(b=this.styleMap.createSymbolizer(a,c))}c=this.renderer.drawFeature(a,b);!1===c||null===c?this.unrenderedFeatures[a.id]=a:delete this.unrenderedFeatures[a.id]}},
eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer)throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var b=null;(a=this.renderer.getFeatureIdFromEvent(a))&&(b="string"===typeof a?this.getFeatureById(a):a);return b},getFeatureBy:function(a,b){for(var c=null,d=0,e=this.features.length;d<e;++d)if(this.features[d][a]==b){c=this.features[d];
break}return c},getFeatureById:function(a){return this.getFeatureBy("id",a)},getFeatureByFid:function(a){return this.getFeatureBy("fid",a)},getFeaturesByAttribute:function(a,b){var c,d,e=this.features.length,f=[];for(c=0;c<e;c++)(d=this.features[c])&&d.attributes&&d.attributes[a]===b&&f.push(d);return f},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var a=null,b=this.features;if(b&&0<b.length)for(var c=null,d=0,e=b.length;d<e;d++)if(c=b[d].geometry)null===a&&
(a=new OpenLayers.Bounds),a.extend(c.getBounds());return a},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(a){a=a||{};OpenLayers.Layer.Vector.prototype.initialize.apply(this,[a.name,a])},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);a.events.register("moveend",this,this.onMoveEnd)},removeMap:function(a){a.events.unregister("moveend",this,this.onMoveEnd);OpenLayers.Layer.Vector.prototype.removeMap.apply(this,
arguments)},setRatio:function(a){this.ratio=a;this.updateGrid(!0)},setMaxFeatures:function(a){this.maxFeatures=a;this.updateGrid(!0)},setSpacing:function(a,b){this.dx=a;this.dy=b||a;this.updateGrid(!0)},setOrigin:function(a){this.origin=a;this.updateGrid(!0)},getOrigin:function(){this.origin||(this.origin=this.map.getExtent().getCenterLonLat());return this.origin},setRotation:function(a){this.rotation=a;this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var a=this.map.getExtent();
if(this.rotation){var b=this.getOrigin(),b=new OpenLayers.Geometry.Point(b.lon,b.lat),a=a.toGeometry();a.rotate(-this.rotation,b);a=a.getBounds()}return a},updateGrid:function(a){if(a||this.invalidBounds()){var b=this.getViewBounds(),c=this.getOrigin();a=new OpenLayers.Geometry.Point(c.lon,c.lat);var d=b.getWidth(),e=b.getHeight(),f=d/e,g=Math.sqrt(this.dx*this.dy*this.maxFeatures/f),d=Math.min(d*this.ratio,g*f),e=Math.min(e*this.ratio,g),b=b.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(b.lon-
d/2,b.lat-e/2,b.lon+d/2,b.lat+e/2);for(var b=Math.floor(e/this.dy),d=Math.floor(d/this.dx),e=c.lon+this.dx*Math.ceil((this.gridBounds.left-c.lon)/this.dx),c=c.lat+this.dy*Math.ceil((this.gridBounds.bottom-c.lat)/this.dy),g=Array(b*d),h,k=0;k<d;++k)for(var f=e+k*this.dx,l=0;l<b;++l)h=c+l*this.dy,h=new OpenLayers.Geometry.Point(f,h),this.rotation&&h.rotate(this.rotation,a),g[k*b+l]=new OpenLayers.Feature.Vector(h);this.destroyFeatures(this.features,{silent:!0});this.addFeatures(g,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||
!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(a){if(this.map&&this.checkModifiers(a)){for(var b=
!1,c=!1,d=!1,e=OpenLayers.Event.element(a);null!=e&&!d&&!b;){if(!b)try{var f,b=(f=e.currentStyle?e.currentStyle.overflow:document.defaultView.getComputedStyle(e,null).getPropertyValue("overflow"))&&"auto"==f||"scroll"==f}catch(g){}if(!c&&(c=OpenLayers.Element.hasClass(e,"olScrollable"),!c))for(var d=0,h=this.map.layers.length;d<h;d++){var k=this.map.layers[d];if(e==k.div||e==k.pane){c=!0;break}}d=e==this.map.div;e=e.parentNode}if(!b&&d){if(c)if(b=0,a.wheelDelta?(b=a.wheelDelta,0===b%160&&(b*=0.75),
b/=120):a.detail&&(b=-(a.detail/Math.abs(a.detail))),this.delta+=b,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var l=OpenLayers.Util.extend({},a);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(l)},this),this.interval)}else this.wheelZoom(a);OpenLayers.Event.stop(a)}}},wheelZoom:function(a){var b=this.delta;this.delta=0;b&&(a.xy=this.map.events.getMousePosition(a),0>b?this.callback("down",[a,this.cumulative?Math.max(-this.maxDelta,
b):-1]):this.callback("up",[a,this.cumulative?Math.min(this.maxDelta,b):1]))},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",b);OpenLayers.Event.observe(window,"mousewheel",b);OpenLayers.Event.observe(document,"mousewheel",b);return!0}return!1},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.stopObserving(window,
"DOMMouseScroll",b);OpenLayers.Event.stopObserving(window,"mousewheel",b);OpenLayers.Event.stopObserving(document,"mousewheel",b);return!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(a){OpenLayers.Util.extend(this,a)},clone:function(){return new (eval(this.CLASS_NAME))(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"});OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={};OpenLayers.Util.extend(this,a);this.symbolizers&&delete this.symbolizer;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer)this.symbolizer[a]=null;this.symbolizer=null;delete this.symbolizers},evaluate:function(a){var b=
this.getContext(a),c=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var d=a.layer.map.getScale();this.minScaleDenominator&&(c=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b));c&&this.maxScaleDenominator&&(c=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b));c&&this.filter&&(c="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(a):this.filter.evaluate(b));return c},getContext:function(a){var b=this.context;b||(b=a.attributes||a.data);"function"==
typeof this.context&&(b=this.context(a));return b},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.symbolizers){var b=this.symbolizers.length;a.symbolizers=Array(b);for(var c=0;c<b;++c)a.symbolizers[c]=this.symbolizers[c].clone()}else{a.symbolizer={};for(var d in this.symbolizer)b=this.symbolizer[d],c=typeof b,"object"===c?a.symbolizer[d]=OpenLayers.Util.extend({},b):"string"===c&&(a.symbolizer[d]=b)}a.filter=this.filter&&this.filter.clone();a.context=this.context&&OpenLayers.Util.extend({},
this.context);return new OpenLayers.Rule(a)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c);b.outer=c.components[0]},innerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c);b.inner.push(c.components[0])},Box:function(a,b){var c=
{};this.readChildNodes(a,c);b.components||(b.components=[]);var d=c.points[0],c=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,c.x,c.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"wfs:FeatureCollection":"gml:featureMember";a=this.writeNode(b,a);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(a){var b=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[a],b);return b},coordinates:function(a){for(var b=a.length,c=Array(b),d,e=0;e<b;++e)d=a[e],c[e]=this.xy?d.x+","+d.y:d.y+","+d.x,void 0!=d.z&&(c[e]+=","+d.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==b?c[0]:c.join(" ")})},LineString:function(a){var b=
this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",a.components,b);return b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",a.components[0],b);for(var c=1;c<a.components.length;++c)this.writeNode("innerBoundaryIs",a.components[c],b);return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",a,b);return b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");
this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",a.components,b);return b},Box:function(a){var b=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:a.left,y:a.bottom},{x:a.right,y:a.top}],b);this.srsName&&b.setAttribute("srsName",this.srsName);return b}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},
CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsNotEqualTo:function(a,
b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escape");c.value2regex(d,e,f);b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,
feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",a,b);this.writeOgcExpression(a.value,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",
{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Box",a.value,b);a.projection&&c.setAttribute("srsName",a.projection);return b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},
writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);this.writeNode("PropertyName",a,c);if(a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Box",a.value);a.projection&&d.setAttribute("srsName",a.projection);c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(a,b,c){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(a,
b){b.insertIds=[];b.success=!1;this.readChildNodes(a,b)},InsertResult:function(a,b){var c={fids:[]};this.readChildNodes(a,c);b.insertIds=b.insertIds.concat(c.fids)},TransactionResult:function(a,b){this.readChildNodes(a,b)},Status:function(a,b){this.readChildNodes(a,b)},SUCCESS:function(a,b){b.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},
writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType}});a.srsNameInQuery&&a.srsName&&c.setAttribute("srsName",a.srsName);a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS);if(a.propertyNames)for(var b=0,d=a.propertyNames.length;b<
d;b++)this.writeNode("ogc:PropertyName",{property:a.propertyNames[b]},c);a.filter&&(this.setFilterProperty(a.filter),this.writeNode("ogc:Filter",a.filter,c));return c}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(a){this.exists(a)&&this.remove(a);var b=a.id;this.determineZIndex(a);for(var c=-1,d=this.order.length,e;1<d-c;)e=parseInt((c+d)/2),0<this.compare(this,a,OpenLayers.Util.getElement(this.order[e]))?c=e:d=e;this.order.splice(d,
0,b);this.indices[b]=this.getZIndex(a);return this.getNextElement(d)},remove:function(a){a=a.id;var b=OpenLayers.Util.indexOf(this.order,a);0<=b&&(this.order.splice(b,1),delete this.indices[a],this.maxZIndex=0<this.order.length?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(a){return null!=this.indices[a.id]},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;
null==b?(b=this.maxZIndex,a._style.graphicZIndex=b):b>this.maxZIndex&&(this.maxZIndex=b)},getNextElement:function(a){a+=1;if(a<this.order.length){var b=OpenLayers.Util.getElement(this.order[a]);void 0==b&&(b=this.getNextElement(a));return b}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"});
OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,b,c){b=a.getZIndex(b);var d=0;c&&(a=a.getZIndex(c),d=b-a);return d},Z_ORDER_DRAWING_ORDER:function(a,b,c){a=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);c&&0==a&&(a=1);return a},Z_ORDER_Y_ORDER:function(a,b,c){a=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);c&&0===a&&(b=c._boundsBottom-b._boundsBottom,a=0===b?1:b);return a}};
OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);
this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);b&&(b.zIndexing||b.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering))},destroy:function(){this.clear();this.xmlns=this.root=this.rendererRoot=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var a,b=this.vectorRoot;if(b)for(;a=b.firstChild;)b.removeChild(a);if(b=this.textRoot)for(;a=b.firstChild;)b.removeChild(a);this.indexer&&
this.indexer.clear()},setExtent:function(a,b){var c=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),d=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var e,f=a.getWidth()/this.map.getExtent().getWidth();a=a.scale(1/f);f=this.map.getMaxExtent();f.right>a.left&&f.right<a.right?e=!0:f.left>a.left&&f.left<a.right&&(e=!1);if(e!==this.rightOfDateLine||b)c=!1,this.xOffset=!0===e?f.getWidth()/d:0;this.rightOfDateLine=e}return c},getNodeType:function(a,b){},drawGeometry:function(a,
b,c){var d=a.CLASS_NAME,e=!0;if("OpenLayers.Geometry.Collection"==d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d){for(var d=0,f=a.components.length;d<f;d++)e=this.drawGeometry(a.components[d],b,c)&&e;return e}d=e=!1;"none"!=b.display&&(b.backgroundGraphic?this.redrawBackgroundNode(a.id,a,b,c):d=!0,e=this.redrawNode(a.id,a,b,c));!1==e&&(b=document.getElementById(a.id))&&(b._style.backgroundGraphic&&(d=!0),b.parentNode.removeChild(b));
d&&(b=document.getElementById(a.id+this.BACKGROUND_ID_SUFFIX))&&b.parentNode.removeChild(b);return e},redrawNode:function(a,b,c,d){c=this.applyDefaultSymbolizer(c);a=this.nodeFactory(a,this.getNodeType(b,c));a._featureId=d;a._boundsBottom=b.getBounds().bottom;a._geometryClass=b.CLASS_NAME;a._style=c;b=this.drawGeometryNode(a,b,c);if(!1===b)return!1;a=b.node;this.indexer?(c=this.indexer.insert(a))?this.vectorRoot.insertBefore(a,c):this.vectorRoot.appendChild(a):a.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(a);
this.postDraw(a);return b.complete},redrawBackgroundNode:function(a,b,c,d){c=OpenLayers.Util.extend({},c);c.externalGraphic=c.backgroundGraphic;c.graphicXOffset=c.backgroundXOffset;c.graphicYOffset=c.backgroundYOffset;c.graphicZIndex=c.backgroundGraphicZIndex;c.graphicWidth=c.backgroundWidth||c.graphicWidth;c.graphicHeight=c.backgroundHeight||c.graphicHeight;c.backgroundGraphic=null;c.backgroundXOffset=null;c.backgroundYOffset=null;c.backgroundGraphicZIndex=null;return this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,
b,c,null)},drawGeometryNode:function(a,b,c){c=c||a._style;var d={isFilled:void 0===c.fill?!0:c.fill,isStroked:void 0===c.stroke?!!c.strokeWidth:c.stroke},e;switch(b.CLASS_NAME){case "OpenLayers.Geometry.Point":!1===c.graphic&&(d.isFilled=!1,d.isStroked=!1);e=this.drawPoint(a,b);break;case "OpenLayers.Geometry.LineString":d.isFilled=!1;e=this.drawLineString(a,b);break;case "OpenLayers.Geometry.LinearRing":e=this.drawLinearRing(a,b);break;case "OpenLayers.Geometry.Polygon":e=this.drawPolygon(a,b);break;
case "OpenLayers.Geometry.Rectangle":e=this.drawRectangle(a,b)}a._options=d;return!1!=e?{node:this.setStyle(a,c,d,b),complete:e}:!1},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},removeText:function(a){var b=document.getElementById(a+this.LABEL_ID_SUFFIX);b&&this.textRoot.removeChild(b);(a=document.getElementById(a+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(a)},
getFeatureIdFromEvent:function(a){var b=a.target,c=b&&b.correspondingUseElement;return(c?c:b||a.srcElement)._featureId},eraseGeometry:function(a,b){if("OpenLayers.Geometry.MultiPoint"==a.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==a.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==a.CLASS_NAME||"OpenLayers.Geometry.Collection"==a.CLASS_NAME)for(var c=0,d=a.components.length;c<d;c++)this.eraseGeometry(a.components[c],b);else(c=OpenLayers.Util.getElement(a.id))&&c.parentNode&&(c.geometry&&(c.geometry.destroy(),
c.geometry=null),c.parentNode.removeChild(c),this.indexer&&this.indexer.remove(c),c._style.backgroundGraphic&&(c=OpenLayers.Util.getElement(a.id+this.BACKGROUND_ID_SUFFIX))&&c.parentNode&&c.parentNode.removeChild(c))},nodeFactory:function(a,b){var c=OpenLayers.Util.getElement(a);c?this.nodeTypeCompare(c,b)||(c.parentNode.removeChild(c),c=this.nodeFactory(a,b)):c=this.createNode(b,a);return c},nodeTypeCompare:function(a,b){},createNode:function(a,b){},moveRoot:function(a){var b=this.root;a.root.parentNode==
this.rendererRoot&&(b=a.root);b.parentNode.removeChild(b);a.rendererRoot.appendChild(b)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return"circle"!=a&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(a){a=a||window.location.href;var b=OpenLayers.Util.getParameters(a),c=a.indexOf("#");0<c&&(a="?"+a.substring(c+1,a.length),OpenLayers.Util.extend(b,OpenLayers.Util.getParameters(a)));return b},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b<c;b++){var d=this.map.controls[b];if(d!=this&&
"OpenLayers.Control.ArgParser"==d.CLASS_NAME){d.displayProjection!=this.displayProjection&&(this.displayProjection=d.displayProjection);break}}b==this.map.controls.length&&(b=this.getParameters(),b.layers&&(this.layers=b.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),b.lat&&b.lon&&(this.center=new OpenLayers.LonLat(parseFloat(b.lon),parseFloat(b.lat)),b.zoom&&(this.zoom=parseFloat(b.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),
this.setCenter()))},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var a=0,b=this.layers.length;a<b;a++){var c=this.map.layers[a],d=this.layers.charAt(a);
"B"==d?this.map.setBaseLayer(c):"T"!=d&&"F"!=d||c.setVisibility("T"==d)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(a,b,c){null===a||"object"!=typeof a||OpenLayers.Util.isElement(a)?(OpenLayers.Control.prototype.initialize.apply(this,[c]),this.element=OpenLayers.Util.getElement(a),this.base=b||document.location.href):(this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[a]),null!=this.element&&(this.element=
OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null);this.map&&this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b<c;b++){var d=this.map.controls[b];if(d.CLASS_NAME==this.argParserClass.CLASS_NAME){d.displayProjection!=
this.displayProjection&&(this.displayProjection=d.displayProjection);break}}b==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element));this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,
changebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var a=this.anchor?"#":"?",b=this.base,c=null;-1!=b.indexOf("#")&&!1==this.anchor&&(c=b.substring(b.indexOf("#"),b.length));-1!=b.indexOf(a)&&(b=b.substring(0,b.indexOf(a)));b=b.split("#")[0]+a+OpenLayers.Util.getParameterString(this.createParams());c&&(b+=c);this.anchor&&!this.element?window.location.href=b:this.element.href=b},createParams:function(a,b,c){a=a||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);
if(a)for(d.zoom=b||this.map.getZoom(),b=a.lat,a=a.lon,this.displayProjection&&(b=OpenLayers.Projection.transform({x:a,y:b},this.map.getProjectionObject(),this.displayProjection),a=b.x,b=b.y),d.lat=Math.round(1E5*b)/1E5,d.lon=Math.round(1E5*a)/1E5,c=c||this.map.layers,d.layers="",a=0,b=c.length;a<b;a++){var e=c[a];d.layers=e.isBaseLayer?d.layers+(e==this.map.baseLayer?"B":"0"):d.layers+(e.getVisibility()?"T":"F")}return d},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(a,b,c){var d=[];d.push(a,b,{},c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){null==a&&(a=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.getServerResolution(),
c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w));a=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h));b=this.getServerZoom();c=this.serviceVersion+"/"+this.layername+"/"+b+"/"+c+"/"+a+"."+this.type;a=this.url;OpenLayers.Util.isArray(a)&&(a=this.selectUrl(c,a));return a+c},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"});OpenLayers.Format.WCSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WCSCapabilities"});OpenLayers.Format.WCSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,splitSpace:/\s+/},defaultPrefix:"wcs",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1"});OpenLayers.Format.WCSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"service",readers:{wcs:{WCS_Capabilities:function(a,b){this.readChildNodes(a,b)},Service:function(a,b){b.service={};this.readChildNodes(a,b.service)},name:function(a,b){b.name=this.getChildValue(a)},label:function(a,b){b.label=
this.getChildValue(a)},keywords:function(a,b){b.keywords=[];this.readChildNodes(a,b.keywords)},keyword:function(a,b){b.push(this.getChildValue(a))},responsibleParty:function(a,b){b.responsibleParty={};this.readChildNodes(a,b.responsibleParty)},individualName:function(a,b){b.individualName=this.getChildValue(a)},organisationName:function(a,b){b.organisationName=this.getChildValue(a)},positionName:function(a,b){b.positionName=this.getChildValue(a)},contactInfo:function(a,b){b.contactInfo={};this.readChildNodes(a,
b.contactInfo)},phone:function(a,b){b.phone={};this.readChildNodes(a,b.phone)},voice:function(a,b){b.voice=this.getChildValue(a)},facsimile:function(a,b){b.facsimile=this.getChildValue(a)},address:function(a,b){b.address={};this.readChildNodes(a,b.address)},deliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},city:function(a,b){b.city=this.getChildValue(a)},postalCode:function(a,b){b.postalCode=this.getChildValue(a)},country:function(a,b){b.country=this.getChildValue(a)},electronicMailAddress:function(a,
b){b.electronicMailAddress=this.getChildValue(a)},fees:function(a,b){b.fees=this.getChildValue(a)},accessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ContentMetadata:function(a,b){b.contentMetadata=[];this.readChildNodes(a,b.contentMetadata)},CoverageOfferingBrief:function(a,b){var c={};this.readChildNodes(a,c);b.push(c)},name:function(a,b){b.name=this.getChildValue(a)},label:function(a,b){b.label=this.getChildValue(a)},lonLatEnvelope:function(a,b){var c=this.getElementsByTagNameNS(a,
"http://www.opengis.net/gml","pos");if(2==c.length){var d={},e={};OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[0],d]);OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[1],e]);b.lonLatEnvelope={};b.lonLatEnvelope.srsName=a.getAttribute("srsName");b.lonLatEnvelope.min=d.points[0];b.lonLatEnvelope.max=e.points[0]}}}},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_0_0"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(a)if(this.layer.events.on({refresh:this.load,scope:this}),!0==this.layer.visibility||this.preload)this.load();else this.layer.events.on({visibilitychanged:this.load,scope:this});return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,
scope:this});return a},load:function(a){var b=this.layer;b.events.triggerEvent("loadstart",{filter:b.filter});b.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:b.filter,scope:this},a));b.events.un({visibilitychanged:this.load,scope:this})},merge:function(a){var b=this.layer;b.destroyFeatures();var c=a.features;if(c&&0<c.length){var d=b.projection,e=b.map.getProjectionObject();if(!e.equals(d))for(var f,g=0,h=c.length;g<h;++g)(f=c[g].geometry)&&f.transform(d,e);b.addFeatures(c)}b.events.triggerEvent("loadend",
{response:a})},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"\u2212",zoomOutId:"olZoomOutLink",draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this),b=this.getOrCreateLinks(a),c=b.zoomIn,b=b.zoomOut,d=this.map.events;b.parentNode!==a&&(d=this.events,d.attachToElement(b.parentNode));d.register("buttonclick",this,this.onZoomClick);this.zoomInLink=c;this.zoomOutLink=b;return a},getOrCreateLinks:function(a){var b=document.getElementById(this.zoomInId),
c=document.getElementById(this.zoomOutId);b||(b=document.createElement("a"),b.href="#zoomIn",b.appendChild(document.createTextNode(this.zoomInText)),b.className="olControlZoomIn",a.appendChild(b));OpenLayers.Element.addClass(b,"olButton");c||(c=document.createElement("a"),c.href="#zoomOut",c.appendChild(document.createTextNode(this.zoomOutText)),c.className="olControlZoomOut",a.appendChild(c));OpenLayers.Element.addClass(c,"olButton");return{zoomIn:b,zoomOut:c}},onZoomClick:function(a){a=a.buttonElement;
a===this.zoomInLink?this.map.zoomIn():a===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick);delete this.zoomInLink;delete this.zoomOutLink;OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(a,b){if(2>a.length)throw Error("At least two point features have to be added to create a line from");for(var c=Array(a.length-1),d,e,f,g=0,h=a.length;g<h;g++){d=a[g];f=d.geometry;if(!f)f=d.lonlat,f=new OpenLayers.Geometry.Point(f.lon,f.lat);else if("OpenLayers.Geometry.Point"!=f.CLASS_NAME)throw new TypeError("Only features with point geometries are supported.");if(0<g){d=null!=this.dataFrom?
a[g+this.dataFrom].data||a[g+this.dataFrom].attributes:null;var k=null!=this.styleFrom?a[g+this.styleFrom].style:null;e=new OpenLayers.Geometry.LineString([e,f]);c[g-1]=new OpenLayers.Feature.Vector(e,d,k)}e=f}this.addFeatures(c,b)},CLASS_NAME:"OpenLayers.Layer.PointTrack"});OpenLayers.Layer.PointTrack.SOURCE_NODE=-1;OpenLayers.Layer.PointTrack.TARGET_NODE=0;OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Protocol.WFS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.WFS.DEFAULTS);var b=OpenLayers.Protocol.WFS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFS version: "+a.version;return new b(a)};
OpenLayers.Protocol.WFS.fromWMSLayer=function(a,b){var c,d;c=a.params.LAYERS;c=(OpenLayers.Util.isArray(c)?c[0]:c).split(":");1<c.length&&(d=c[0]);c=c.pop();d={url:a.url,featureType:c,featurePrefix:d,srsName:a.projection&&a.projection.getCode()||a.map&&a.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(b,d))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;a=0;for(var b=this.markers.length;a<b;a++)this.markers[a].setOpacity(this.opacity)}},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,
arguments);if(b||!this.drawn){for(var d=0,e=this.markers.length;d<e;d++)this.drawMarker(this.markers[d]);this.drawn=!0}},addMarker:function(a){this.markers.push(a);1>this.opacity&&a.setOpacity(this.opacity);this.map&&this.map.getExtent()&&(a.map=this.map,this.drawMarker(a))},removeMarker:function(a){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,a),a.erase())},clearMarkers:function(){if(null!=this.markers)for(;0<this.markers.length;)this.removeMarker(this.markers[0])},
drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);null==b?a.display(!1):a.isDrawn()?a.icon&&a.icon.moveTo(b):(a=a.draw(b),this.div.appendChild(a))},getDataExtent:function(){var a=null;if(this.markers&&0<this.markers.length)for(var a=new OpenLayers.Bounds,b=0,c=this.markers.length;b<c;b++)a.extend(this.markers[b].lonlat);return a},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(a,b){this.direction=a;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[b])},trigger:function(){if(this.map){var a=OpenLayers.Function.bind(function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-a("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,
a("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-a("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(a("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Format.CSWGetDomain=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetDomain.DEFAULTS);var b=OpenLayers.Format.CSWGetDomain["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetDomain version: "+a.version;return new b(a)};OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"};OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==
a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},readers:{csw:{GetDomainResponse:function(a,b){this.readChildNodes(a,b)},DomainValues:function(a,b){OpenLayers.Util.isArray(b.DomainValues)||(b.DomainValues=[]);for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;this.readChildNodes(a,d);b.DomainValues.push(d)},PropertyName:function(a,b){b.PropertyName=this.getChildValue(a)},ParameterName:function(a,b){b.ParameterName=this.getChildValue(a)},ListOfValues:function(a,
b){OpenLayers.Util.isArray(b.ListOfValues)||(b.ListOfValues=[]);this.readChildNodes(a,b.ListOfValues)},Value:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a);b.push({Value:d})},ConceptualScheme:function(a,b){b.ConceptualScheme={};this.readChildNodes(a,b.ConceptualScheme)},Name:function(a,b){b.Name=this.getChildValue(a)},Document:function(a,b){b.Document=this.getChildValue(a)},Authority:function(a,b){b.Authority=this.getChildValue(a)},
RangeOfValues:function(a,b){b.RangeOfValues={};this.readChildNodes(a,b.RangeOfValues)},MinValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a);b.MinValue=d},MaxValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a);b.MaxValue=d}}},write:function(a){a=this.writeNode("csw:GetDomain",a);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{csw:{GetDomain:function(a){var b=
this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});a.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",a.PropertyName||this.PropertyName,b):(a.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",a.ParameterName||this.ParameterName,b);this.readChildNodes(b,a);return b},PropertyName:function(a){return this.createElementNSPlus("csw:PropertyName",{value:a})},ParameterName:function(a){return this.createElementNSPlus("csw:ParameterName",
{value:a})}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"});OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(a){return(new OpenLayers.Format.ArcXML).read(a).features.feature}});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};this.options.layer&&this.setLayer(this.options.layer);a=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(a,this.DEFAULTS);this.setTargets(this.options.targets);
0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer);this.geoToleranceCache={}},setLayer:function(a){this.active?(this.deactivate(),this.layer=a,this.activate()):this.layer=a},setTargets:function(a){this.targets=[];if(a&&a.length)for(var b,c=0,d=a.length;c<d;++c)b=a[c],b instanceof OpenLayers.Layer.Vector?this.addTargetLayer(b):this.addTarget(b)},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults);a.nodeTolerance=
a.nodeTolerance||a.tolerance;a.vertexTolerance=a.vertexTolerance||a.tolerance;a.edgeTolerance=a.edgeTolerance||a.tolerance;this.targets.push(a)},removeTargetLayer:function(a){for(var b,c=this.targets.length-1;0<=c;--c)b=this.targets[c],b.layer===a&&this.removeTarget(b)},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a&&this.layer&&this.layer.events)this.layer.events.on({sketchstarted:this.onSketchModified,
sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this});return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);a&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this});this.point=this.feature=null;return a},onSketchModified:function(a){this.feature=a.feature;this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=
a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(a,b){for(var c={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},d=!1,e,f,g=0,h=this.targets.length;g<h;++g)if(f=this.targets[g],e=this.testTarget(f,b))if(this.greedy){c=e;c.target=f;d=!0;break}else if(e.rank<c.rank||e.rank===c.rank&&e.dist<c.dist)c=e,c.target=f,d=!0;d&&(!1!==this.events.triggerEvent("beforesnap",
{point:a,x:c.x,y:c.y,distance:c.dist,layer:c.target.layer,snapType:this.precedence[c.rank]})?(a.x=c.x,a.y=c.y,this.point=a,this.events.triggerEvent("snap",{point:a,snapType:this.precedence[c.rank],layer:c.target.layer,distance:c.dist})):d=!1);this.point&&!d&&(a.x=b.x,a.y=b.y,this.point=null,this.events.triggerEvent("unsnap",{point:a}))},testTarget:function(a,b){var c=this.layer.map.getResolution();if("minResolution"in a&&c<a.minResolution||"maxResolution"in a&&c>=a.maxResolution)return null;for(var c=
{node:this.getGeoTolerance(a.nodeTolerance,c),vertex:this.getGeoTolerance(a.vertexTolerance,c),edge:this.getGeoTolerance(a.edgeTolerance,c)},d=Math.max(c.node,c.vertex,c.edge),e={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},f=!1,g=a.layer.features,h,k,l,m,n,p,q=this.precedence.length,r=new OpenLayers.LonLat(b.x,b.y),s=0,t=g.length;s<t;++s)if(h=g[s],h!==this.feature&&(!h._sketch&&h.state!==OpenLayers.State.DELETE&&(!a.filter||a.filter.evaluate(h)))&&h.atPoint(r,d,d))for(var u=0,v=Math.min(e.rank+
1,q);u<v;++u)if(k=this.precedence[u],a[k])if("edge"===k){if(l=h.geometry.distanceTo(b,{details:!0}),n=l.distance,n<=c[k]&&n<e.dist){e={rank:u,dist:n,x:l.x0,y:l.y0};f=!0;break}}else{l=h.geometry.getVertices("node"===k);p=!1;for(var w=0,x=l.length;w<x;++w)m=l[w],n=m.distanceTo(b),n<=c[k]&&(u<e.rank||u===e.rank&&n<e.dist)&&(e={rank:u,dist:n,x:m.x,y:m.y},p=f=!0);if(p)break}return f?e:null},getGeoTolerance:function(a,b){b!==this.resolution&&(this.resolution=b,this.geoToleranceCache={});var c=this.geoToleranceCache[a];
void 0===c&&(c=a*b,this.geoToleranceCache[a]=c);return c},destroy:function(){this.active&&this.deactivate();delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(a,b.exceptionReport)},AllowedValues:function(a,b){b.allowedValues={};this.readChildNodes(a,b.allowedValues)},AnyValue:function(a,b){b.anyValue=
!0},DataType:function(a,b){b.dataType=this.getChildValue(a)},Range:function(a,b){b.range={};this.readChildNodes(a,b.range)},MinimumValue:function(a,b){b.minValue=this.getChildValue(a)},MaximumValue:function(a,b){b.maxValue=this.getChildValue(a)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},SupportedCRS:function(a,b){b.supportedCRS=this.getChildValue(a)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(a){var b=this.createElementNSPlus("ows:Range",
{attributes:{"ows:rangeClosure":a.closure}});this.writeNode("ows:MinimumValue",a.minValue,b);this.writeNode("ows:MaximumValue",a.maxValue,b);return b},MinimumValue:function(a){return this.createElementNSPlus("ows:MinimumValue",{value:a})},MaximumValue:function(a){return this.createElementNSPlus("ows:MaximumValue",{value:a})},Value:function(a){return this.createElementNSPlus("ows:Value",{value:a})}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(a){a=this.writeNode("wcs:GetCoverage",
a);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{wcs:{GetCoverage:function(a){var b=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:a.version||this.VERSION,service:"WCS"}});this.writeNode("ows:Identifier",a.identifier,b);this.writeNode("wcs:DomainSubset",a.domainSubset,b);this.writeNode("wcs:Output",a.output,b);return b},DomainSubset:function(a){var b=this.createElementNSPlus("wcs:DomainSubset",
{});this.writeNode("ows:BoundingBox",a.boundingBox,b);a.temporalSubset&&this.writeNode("wcs:TemporalSubset",a.temporalSubset,b);return b},TemporalSubset:function(a){for(var b=this.createElementNSPlus("wcs:TemporalSubset",{}),c=0,d=a.timePeriods.length;c<d;++c)this.writeNode("wcs:TimePeriod",a.timePeriods[c],b);return b},TimePeriod:function(a){var b=this.createElementNSPlus("wcs:TimePeriod",{});this.writeNode("wcs:BeginPosition",a.begin,b);this.writeNode("wcs:EndPosition",a.end,b);a.resolution&&this.writeNode("wcs:TimeResolution",
a.resolution,b);return b},BeginPosition:function(a){return this.createElementNSPlus("wcs:BeginPosition",{value:a})},EndPosition:function(a){return this.createElementNSPlus("wcs:EndPosition",{value:a})},TimeResolution:function(a){return this.createElementNSPlus("wcs:TimeResolution",{value:a})},Output:function(a){var b=this.createElementNSPlus("wcs:Output",{attributes:{format:a.format,store:a.store}});a.gridCRS&&this.writeNode("wcs:GridCRS",a.gridCRS,b);return b},GridCRS:function(a){var b=this.createElementNSPlus("wcs:GridCRS",
{});this.writeNode("wcs:GridBaseCRS",a.baseCRS,b);a.type&&this.writeNode("wcs:GridType",a.type,b);a.origin&&this.writeNode("wcs:GridOrigin",a.origin,b);this.writeNode("wcs:GridOffsets",a.offsets,b);a.CS&&this.writeNode("wcs:GridCS",a.CS,b);return b},GridBaseCRS:function(a){return this.createElementNSPlus("wcs:GridBaseCRS",{value:a})},GridOrigin:function(a){return this.createElementNSPlus("wcs:GridOrigin",{value:a})},GridType:function(a){return this.createElementNSPlus("wcs:GridType",{value:a})},GridOffsets:function(a){return this.createElementNSPlus("wcs:GridOffsets",
{value:a})},GridCS:function(a){return this.createElementNSPlus("wcs:GridCS",{value:a})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"});OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a){this.regExes=
{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){this.features=[];this.styles={};this.fetched={};return this.parseData(a,{depth:0,styleBaseUrl:this.styleBaseUrl})},parseData:function(a,b){"string"==typeof a&&
(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var c=["Link","NetworkLink","Style","StyleMap","Placemark"],d=0,e=c.length;d<e;++d){var f=c[d],g=this.getElementsByTagNameNS(a,"*",f);if(0!=g.length)switch(f.toLowerCase()){case "link":case "networklink":this.parseLinks(g,b);break;case "style":this.extractStyles&&this.parseStyles(g,b);break;case "stylemap":this.extractStyles&&this.parseStyleMaps(g,b);break;case "placemark":this.parseFeatures(g,b)}}return this.features},parseLinks:function(a,
b){if(b.depth>=this.maxDepth)return!1;var c=OpenLayers.Util.extend({},b);c.depth++;for(var d=0,e=a.length;d<e;d++){var f=this.parseProperty(a[d],"*","href");f&&!this.fetched[f]&&(this.fetched[f]=!0,(f=this.fetchLink(f))&&this.parseData(f,c))}},fetchLink:function(a){if(a=OpenLayers.Request.GET({url:a,async:!1}))return a.responseText},parseStyles:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=this.parseStyle(a[c]);e&&(this.styles[(b.styleBaseUrl||"")+"#"+e.id]=e)}},parseKmlColor:function(a){var b=
null;a&&(a=a.match(this.regExes.kmlColor))&&(b={color:"#"+a[4]+a[3]+a[2],opacity:parseInt(a[1],16)/255});return b},parseStyle:function(a){for(var b={},c=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],d,e,f=0,g=c.length;f<g;++f)if(d=c[f],e=this.getElementsByTagNameNS(a,"*",d)[0])switch(d.toLowerCase()){case "linestyle":d=this.parseProperty(e,"*","color");if(d=this.parseKmlColor(d))b.strokeColor=d.color,b.strokeOpacity=d.opacity;(d=this.parseProperty(e,"*","width"))&&(b.strokeWidth=
d);break;case "polystyle":d=this.parseProperty(e,"*","color");if(d=this.parseKmlColor(d))b.fillOpacity=d.opacity,b.fillColor=d.color;"0"==this.parseProperty(e,"*","fill")&&(b.fillColor="none");"0"==this.parseProperty(e,"*","outline")&&(b.strokeWidth="0");break;case "iconstyle":var h=parseFloat(this.parseProperty(e,"*","scale")||1);d=32*h;var k=32*h,l=this.getElementsByTagNameNS(e,"*","Icon")[0];if(l){var m=this.parseProperty(l,"*","href");if(m){var n=this.parseProperty(l,"*","w"),p=this.parseProperty(l,
"*","h");!OpenLayers.String.startsWith(m,"http://maps.google.com/mapfiles/kml")||(n||p)||(p=n=64,h/=2);n=n||p;p=p||n;n&&(d=parseInt(n)*h);p&&(k=parseInt(p)*h);if(p=m.match(this.regExes.kmlIconPalette))n=p[1],p=p[2],m=this.parseProperty(l,"*","x"),l=this.parseProperty(l,"*","y"),m="http://maps.google.com/mapfiles/kml/pal"+n+"/icon"+(8*(l?7-l/32:7)+(m?m/32:0))+p;b.graphicOpacity=1;b.externalGraphic=m}}if(e=this.getElementsByTagNameNS(e,"*","hotSpot")[0])m=parseFloat(e.getAttribute("x")),l=parseFloat(e.getAttribute("y")),
n=e.getAttribute("xunits"),"pixels"==n?b.graphicXOffset=-m*h:"insetPixels"==n?b.graphicXOffset=-d+m*h:"fraction"==n&&(b.graphicXOffset=-d*m),e=e.getAttribute("yunits"),"pixels"==e?b.graphicYOffset=-k+l*h+1:"insetPixels"==e?b.graphicYOffset=-(l*h)+1:"fraction"==e&&(b.graphicYOffset=-k*(1-l)+1);b.graphicWidth=d;b.graphicHeight=k;break;case "balloonstyle":(e=OpenLayers.Util.getXmlNodeValue(e))&&(b.balloonStyle=e.replace(this.regExes.straightBracket,"${$1}"));break;case "labelstyle":if(d=this.parseProperty(e,
"*","color"),d=this.parseKmlColor(d))b.fontColor=d.color,b.fontOpacity=d.opacity}!b.strokeColor&&b.fillColor&&(b.strokeColor=b.fillColor);(a=a.getAttribute("id"))&&b&&(b.id=a);return b},parseStyleMaps:function(a,b){for(var c=0,d=a.length;c<d;c++)for(var e=a[c],f=this.getElementsByTagNameNS(e,"*","Pair"),e=e.getAttribute("id"),g=0,h=f.length;g<h;g++){var k=f[g],l=this.parseProperty(k,"*","key");(k=this.parseProperty(k,"*","styleUrl"))&&"normal"==l&&(this.styles[(b.styleBaseUrl||"")+"#"+e]=this.styles[(b.styleBaseUrl||
"")+k])}},parseFeatures:function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d],g=this.parseFeature.apply(this,[f]);if(g){this.extractStyles&&(g.attributes&&g.attributes.styleUrl)&&(g.style=this.getStyle(g.attributes.styleUrl,b));if(this.extractStyles){var h=this.getElementsByTagNameNS(f,"*","Style")[0];h&&(h=this.parseStyle(h))&&(g.style=OpenLayers.Util.extend(g.style,h))}this.extractTracks?(f=this.getElementsByTagNameNS(f,this.namespaces.gx,"Track"))&&0<f.length&&(g={features:[],feature:g},
this.readNode(f[0],g),0<g.features.length&&c.push.apply(c,g.features)):c.push(g)}else throw"Bad Placemark: "+d;}this.features=this.features.concat(c)},readers:{kml:{when:function(a,b){b.whens.push(OpenLayers.Date.parse(this.getChildValue(a)))},_trackPointAttribute:function(a,b){var c=a.nodeName.split(":").pop();b.attributes[c].push(this.getChildValue(a))}},gx:{Track:function(a,b){var c={whens:[],points:[],angles:[]};if(this.trackAttributes){var d;c.attributes={};for(var e=0,f=this.trackAttributes.length;e<
f;++e)d=this.trackAttributes[e],c.attributes[d]=[],d in this.readers.kml||(this.readers.kml[d]=this.readers.kml._trackPointAttribute)}this.readChildNodes(a,c);if(c.whens.length!==c.points.length)throw Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:coord ("+c.points.length+") elements.");var g=0<c.angles.length;if(g&&c.whens.length!==c.angles.length)throw Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:angles ("+c.angles.length+") elements.");for(var h,
e=0,f=c.whens.length;e<f;++e){h=b.feature.clone();h.fid=b.feature.fid||b.feature.id;d=c.points[e];h.geometry=d;"z"in d&&(h.attributes.altitude=d.z);this.internalProjection&&this.externalProjection&&h.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes)for(var k=0,l=this.trackAttributes.length;k<l;++k)d=this.trackAttributes[k],h.attributes[d]=c.attributes[d][e];h.attributes.when=c.whens[e];h.attributes.trackId=b.feature.id;g&&(d=c.angles[e],h.attributes.heading=
parseFloat(d[0]),h.attributes.tilt=parseFloat(d[1]),h.attributes.roll=parseFloat(d[2]));b.features.push(h)}},coord:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(/\s+/),d=new OpenLayers.Geometry.Point(c[0],c[1]);2<c.length&&(d.z=parseFloat(c[2]));b.points.push(d)},angles:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(/\s+/);b.angles.push(c)}}},parseFeature:function(a){for(var b=["MultiGeometry","Polygon","LineString","Point"],
c,d,e,f=0,g=b.length;f<g;++f)if(c=b[f],this.internalns=a.namespaceURI?a.namespaceURI:this.kmlns,d=this.getElementsByTagNameNS(a,this.internalns,c),0<d.length){if(b=this.parseGeometry[c.toLowerCase()])e=b.apply(this,[d[0]]),this.internalProjection&&this.externalProjection&&e.transform(this.externalProjection,this.internalProjection);else throw new TypeError("Unsupported geometry type: "+c);break}var h;this.extractAttributes&&(h=this.parseAttributes(a));c=new OpenLayers.Feature.Vector(e,h);a=a.getAttribute("id")||
a.getAttribute("name");null!=a&&(c.fid=a);return c},getStyle:function(a,b){var c=OpenLayers.Util.removeTail(a),d=OpenLayers.Util.extend({},b);d.depth++;d.styleBaseUrl=c;!this.styles[a]&&!OpenLayers.String.startsWith(a,"#")&&d.depth<=this.maxDepth&&!this.fetched[c]&&(c=this.fetchLink(c))&&this.parseData(c,d);return OpenLayers.Util.extend({},this.styles[a])},parseGeometry:{point:function(a){var b=this.getElementsByTagNameNS(a,this.internalns,"coordinates");a=[];if(0<b.length){var c=b[0].firstChild.nodeValue,
c=c.replace(this.regExes.removeSpace,"");a=c.split(",")}b=null;if(1<a.length)2==a.length&&(a[2]=null),b=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);else throw"Bad coordinate string: "+c;return b},linestring:function(a,b){var c=this.getElementsByTagNameNS(a,this.internalns,"coordinates"),d=null;if(0<c.length){for(var c=this.getChildValue(c[0]),c=c.replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),d=c.split(this.regExes.splitSpace),e=d.length,f=Array(e),g,h,k=0;k<e;++k)if(g=
d[k].split(","),h=g.length,1<h)2==g.length&&(g[2]=null),f[k]=new OpenLayers.Geometry.Point(g[0],g[1],g[2]);else throw"Bad LineString point coordinates: "+d[k];if(e)d=b?new OpenLayers.Geometry.LinearRing(f):new OpenLayers.Geometry.LineString(f);else throw"Bad LineString coordinates: "+c;}return d},polygon:function(a){a=this.getElementsByTagNameNS(a,this.internalns,"LinearRing");var b=a.length,c=Array(b);if(0<b)for(var d=0,e=a.length;d<e;++d)if(b=this.parseGeometry.linestring.apply(this,[a[d],!0]))c[d]=
b;else throw"Bad LinearRing geometry: "+d;return new OpenLayers.Geometry.Polygon(c)},multigeometry:function(a){for(var b,c=[],d=a.childNodes,e=0,f=d.length;e<f;++e)a=d[e],1==a.nodeType&&(b=a.prefix?a.nodeName.split(":")[1]:a.nodeName,(b=this.parseGeometry[b.toLowerCase()])&&c.push(b.apply(this,[a])));return new OpenLayers.Geometry.Collection(c)}},parseAttributes:function(a){var b={},c=a.getElementsByTagName("ExtendedData");c.length&&(b=this.parseExtendedData(c[0]));var d,e,f;a=a.childNodes;for(var c=
0,g=a.length;c<g;++c)if(d=a[c],1==d.nodeType&&(e=d.childNodes,1<=e.length&&3>=e.length)){switch(e.length){case 1:f=e[0];break;case 2:f=e[0];e=e[1];f=3==f.nodeType||4==f.nodeType?f:e;break;default:f=e[1]}if(3==f.nodeType||4==f.nodeType)if(d=d.prefix?d.nodeName.split(":")[1]:d.nodeName,f=OpenLayers.Util.getXmlNodeValue(f))f=f.replace(this.regExes.trimSpace,""),b[d]=f}return b},parseExtendedData:function(a){var b={},c,d,e,f,g=a.getElementsByTagName("Data");c=0;for(d=g.length;c<d;c++){e=g[c];f=e.getAttribute("name");
var h={},k=e.getElementsByTagName("value");k.length&&(h.value=this.getChildValue(k[0]));this.kvpAttributes?b[f]=h.value:(e=e.getElementsByTagName("displayName"),e.length&&(h.displayName=this.getChildValue(e[0])),b[f]=h)}a=a.getElementsByTagName("SimpleData");c=0;for(d=a.length;c<d;c++)h={},e=a[c],f=e.getAttribute("name"),h.value=this.getChildValue(e),this.kvpAttributes?b[f]=h.value:(h.displayName=f,b[f]=h);return b},parseProperty:function(a,b,c){var d;a=this.getElementsByTagNameNS(a,b,c);try{d=OpenLayers.Util.getXmlNodeValue(a[0])}catch(e){d=
null}return d},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS(this.kmlns,"kml"),c=this.createFolderXML(),d=0,e=a.length;d<e;++d)c.appendChild(this.createPlacemarkXML(a[d]));b.appendChild(c);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var a=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var b=this.createElementNS(this.kmlns,"name"),c=this.createTextNode(this.foldersName);b.appendChild(c);a.appendChild(b)}this.foldersDesc&&
(b=this.createElementNS(this.kmlns,"description"),c=this.createTextNode(this.foldersDesc),b.appendChild(c),a.appendChild(b));return a},createPlacemarkXML:function(a){var b=this.createElementNS(this.kmlns,"name"),c=a.style&&a.style.label?a.style.label:a.id;b.appendChild(this.createTextNode(a.attributes.name||c));var d=this.createElementNS(this.kmlns,"description");d.appendChild(this.createTextNode(a.attributes.description||this.placemarksDesc));c=this.createElementNS(this.kmlns,"Placemark");null!=
a.fid&&c.setAttribute("id",a.fid);c.appendChild(b);c.appendChild(d);b=this.buildGeometryNode(a.geometry);c.appendChild(b);a.attributes&&(a=this.buildExtendedData(a.attributes))&&c.appendChild(a);return c},buildGeometryNode:function(a){var b=a.CLASS_NAME,b=b.substring(b.lastIndexOf(".")+1),b=this.buildGeometry[b.toLowerCase()],c=null;b&&(c=b.apply(this,[a]));return c},buildGeometry:{point:function(a){var b=this.createElementNS(this.kmlns,"Point");b.appendChild(this.buildCoordinatesNode(a));return b},
multipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(a){var b=this.createElementNS(this.kmlns,"LineString");b.appendChild(this.buildCoordinatesNode(a));return b},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(a){var b=this.createElementNS(this.kmlns,"LinearRing");b.appendChild(this.buildCoordinatesNode(a));return b},polygon:function(a){var b=this.createElementNS(this.kmlns,"Polygon");a=a.components;
for(var c,d,e=0,f=a.length;e<f;++e)c=0==e?"outerBoundaryIs":"innerBoundaryIs",c=this.createElementNS(this.kmlns,c),d=this.buildGeometry.linearring.apply(this,[a[e]]),c.appendChild(d),b.appendChild(c);return b},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(a){for(var b=this.createElementNS(this.kmlns,"MultiGeometry"),c,d=0,e=a.components.length;d<e;++d)(c=this.buildGeometryNode.apply(this,[a.components[d]]))&&b.appendChild(c);return b}},buildCoordinatesNode:function(a){var b=
this.createElementNS(this.kmlns,"coordinates"),c;if(c=a.components){for(var d=c.length,e=Array(d),f=0;f<d;++f)a=c[f],e[f]=this.buildCoordinates(a);c=e.join(" ")}else c=this.buildCoordinates(a);c=this.createTextNode(c);b.appendChild(c);return b},buildCoordinates:function(a){this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));return a.x+","+a.y},buildExtendedData:function(a){var b=this.createElementNS(this.kmlns,"ExtendedData"),
c;for(c in a)if(a[c]&&"name"!=c&&"description"!=c&&"styleUrl"!=c){var d=this.createElementNS(this.kmlns,"Data");d.setAttribute("name",c);var e=this.createElementNS(this.kmlns,"value");if("object"==typeof a[c]){if(a[c].value&&e.appendChild(this.createTextNode(a[c].value)),a[c].displayName){var f=this.createElementNS(this.kmlns,"displayName");f.appendChild(this.getXMLDoc().createCDATASection(a[c].displayName));d.appendChild(f)}}else e.appendChild(this.createTextNode(a[c]));d.appendChild(e);b.appendChild(d)}return this.isSimpleContent(b)?
null:b},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a;a&&9==a.nodeType&&(a=a.documentElement);var c={};this.readNode(a,c);void 0===c.service&&(a=new OpenLayers.Format.OGCExceptionReport,c.error=a.read(b));return c},readers:{wms:{Service:function(a,
b){b.service={};this.readChildNodes(a,b.service)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},BoundingBox:function(a,b){var c={};c.bbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))];var d={x:parseFloat(a.getAttribute("resx")),y:parseFloat(a.getAttribute("resy"))};isNaN(d.x)&&isNaN(d.y)||(c.res=
d);return c},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},ContactInformation:function(a,b){b.contactInformation={};this.readChildNodes(a,b.contactInformation)},ContactPersonPrimary:function(a,b){b.personPrimary={};this.readChildNodes(a,b.personPrimary)},ContactPerson:function(a,b){b.person=this.getChildValue(a)},ContactOrganization:function(a,b){b.organization=this.getChildValue(a)},ContactPosition:function(a,b){b.position=this.getChildValue(a)},ContactAddress:function(a,
b){b.contactAddress={};this.readChildNodes(a,b.contactAddress)},AddressType:function(a,b){b.type=this.getChildValue(a)},Address:function(a,b){b.address=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a)},PostCode:function(a,b){b.postcode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a)},ContactFacsimileTelephone:function(a,
b){b.fax=this.getChildValue(a)},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a)},Fees:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.accessConstraints=c)},Capability:function(a,b){b.capability={nestedLayers:[],layers:[]};this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={};this.readChildNodes(a,b.request)},GetCapabilities:function(a,
b){b.getcapabilities={formats:[]};this.readChildNodes(a,b.getcapabilities)},Format:function(a,b){OpenLayers.Util.isArray(b.formats)?b.formats.push(this.getChildValue(a)):b.format=this.getChildValue(a)},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b)},Get:function(a,b){b.get={};this.readChildNodes(a,b.get);b.href||(b.href=b.get.href)},Post:function(a,b){b.post={};this.readChildNodes(a,b.post);b.href||(b.href=b.get.href)},GetMap:function(a,b){b.getmap={formats:[]};
this.readChildNodes(a,b.getmap)},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]};this.readChildNodes(a,b.getfeatureinfo)},Exception:function(a,b){b.exception={formats:[]};this.readChildNodes(a,b.exception)},Layer:function(a,b){var c,d;b.capability?(d=b.capability,c=b):d=b;var e=a.getAttributeNode("queryable"),f=e&&e.specified?a.getAttribute("queryable"):null,g=(e=a.getAttributeNode("cascaded"))&&e.specified?a.getAttribute("cascaded"):null,e=(e=a.getAttributeNode("opaque"))&&e.specified?
a.getAttribute("opaque"):null,h=a.getAttribute("noSubsets"),k=a.getAttribute("fixedWidth"),l=a.getAttribute("fixedHeight"),m=c||{},n=OpenLayers.Util.extend;c={nestedLayers:[],styles:c?[].concat(c.styles):[],srs:c?n({},m.srs):{},metadataURLs:[],bbox:c?n({},m.bbox):{},llbbox:m.llbbox,dimensions:c?n({},m.dimensions):{},authorityURLs:c?n({},m.authorityURLs):{},identifiers:{},keywords:[],queryable:f&&""!==f?"1"===f||"true"===f:m.queryable||!1,cascaded:null!==g?parseInt(g):m.cascaded||0,opaque:e?"1"===
e||"true"===e:m.opaque||!1,noSubsets:null!==h?"1"===h||"true"===h:m.noSubsets||!1,fixedWidth:null!=k?parseInt(k):m.fixedWidth||0,fixedHeight:null!=l?parseInt(l):m.fixedHeight||0,minScale:m.minScale,maxScale:m.maxScale,attribution:m.attribution};b.nestedLayers.push(c);c.capability=d;this.readChildNodes(a,c);delete c.capability;c.name&&(f=c.name.split(":"),g=d.request,e=g.getfeatureinfo,0<f.length&&(c.prefix=f[0]),d.layers.push(c),void 0===c.formats&&(c.formats=g.getmap.formats),void 0===c.infoFormats&&
e&&(c.infoFormats=e.formats))},Attribution:function(a,b){b.attribution={};this.readChildNodes(a,b.attribution)},LogoURL:function(a,b){b.logo={width:a.getAttribute("width"),height:a.getAttribute("height")};this.readChildNodes(a,b.logo)},Style:function(a,b){var c={};b.styles.push(c);this.readChildNodes(a,c)},LegendURL:function(a,b){var c={width:a.getAttribute("width"),height:a.getAttribute("height")};b.legend=c;this.readChildNodes(a,c)},MetadataURL:function(a,b){var c={type:a.getAttribute("type")};
b.metadataURLs.push(c);this.readChildNodes(a,c)},DataURL:function(a,b){b.dataURL={};this.readChildNodes(a,b.dataURL)},FeatureListURL:function(a,b){b.featureListURL={};this.readChildNodes(a,b.featureListURL)},AuthorityURL:function(a,b){var c=a.getAttribute("name"),d={};this.readChildNodes(a,d);b.authorityURLs[c]=d.href},Identifier:function(a,b){var c=a.getAttribute("authority");b.identifiers[c]=this.getChildValue(a)},KeywordList:function(a,b){this.readChildNodes(a,b)},SRS:function(a,b){b.srs[this.getChildValue(a)]=
!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b)},Keyword:function(a,b){b.keywords&&b.keywords.push(this.getChildValue(a))},DescribeLayer:function(a,b){b.describelayer={formats:[]};this.readChildNodes(a,b.describelayer)},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]};this.readChildNodes(a,b.getlegendgraphic)},GetStyles:function(a,b){b.getstyles=
{formats:[]};this.readChildNodes(a,b.getstyles)},PutStyles:function(a,b){b.putstyles={formats:[]};this.readChildNodes(a,b.putstyles)},UserDefinedSymbolization:function(a,b){var c={supportSLD:1==parseInt(a.getAttribute("SupportSLD")),userLayer:1==parseInt(a.getAttribute("UserLayer")),userStyle:1==parseInt(a.getAttribute("UserStyle")),remoteWFS:1==parseInt(a.getAttribute("RemoteWFS"))};b.userSymbols=c},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),
parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))]},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("SRS");b.bbox[c.srs]=c},ScaleHint:function(a,b){var c=a.getAttribute("min"),d=a.getAttribute("max"),e=Math.pow(2,0.5),f=OpenLayers.INCHES_PER_UNIT.m;0!=c&&(b.maxScale=parseFloat((c/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13)));d!=Number.POSITIVE_INFINITY&&(b.minScale=parseFloat((d/e*f*
OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(a,b){var c={name:a.getAttribute("name").toLowerCase(),units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol")};b.dimensions[c.name]=c},Extent:function(a,b){var c=a.getAttribute("name").toLowerCase();if(c in b.dimensions){c=b.dimensions[c];c.nearestVal="1"===a.getAttribute("nearestValue");c.multipleVal="1"===a.getAttribute("multipleValues");c.current="1"===a.getAttribute("current");c["default"]=a.getAttribute("default")||
"";var d=this.getChildValue(a);c.values=d.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){for(var c=this.getChildValue(a).split(/ +/),d=0,e=c.length;d<e;d++)b.srs[c[d]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]);a.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,
srsName:this.srsName,schema:this.schema},this.formatOptions)));!a.geometryName&&1<parseFloat(this.format.version)&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments);a=OpenLayers.Util.extend({},a);OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),
c=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",a)]);b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c});return b},setFeatureType:function(a){this.featureType=a;this.format.featureType=a},setGeometryName:function(a){this.geometryName=a;this.format.geometryName=a},handleRead:function(a,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);if(b.callback){var c=
a.priv;200<=c.status&&300>c.status?(c=this.parseResponse(c,b.readOptions))&&!1!==c.success?(b.readOptions&&"object"==b.readOptions.output?OpenLayers.Util.extend(a,c):a.features=c,a.code=OpenLayers.Protocol.Response.SUCCESS):(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=c):a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},parseResponse:function(a,b){var c=a.responseXML;c&&c.documentElement||(c=a.responseText);if(!c||0>=c.length)return null;c=null!==this.readFormat?this.readFormat.read(c):
this.format.read(c,b);if(!this.featureNS){var d=this.readFormat||this.format;this.featureNS=d.featureNS;d.autoConfig=!1;this.geometryName||this.setGeometryName(d.geometryName)}return c},commit:function(a,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:a});c.priv=OpenLayers.Request.POST({url:b.url,headers:b.headers,data:this.format.write(a,b),callback:this.createCallback(this.handleCommit,c,b)});
return c},handleCommit:function(a,b){if(b.callback){var c=a.priv,d=c.responseXML;d&&d.documentElement||(d=c.responseText);c=this.format.read(d)||{};a.insertIds=c.insertIds||[];c.success?a.code=OpenLayers.Protocol.Response.SUCCESS:(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=c);b.callback.call(b.scope,a)}},filterDelete:function(a,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);new OpenLayers.Protocol.Response({requestType:"commit"});var c=this.format.createElementNSPlus("wfs:Transaction",
{attributes:{service:"WFS",version:this.version}}),d=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(b.featureNS?this.featurePrefix+":":"")+b.featureType}});b.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,b.featureNS);var e=this.format.writeNode("ogc:Filter",a);d.appendChild(e);c.appendChild(d);c=OpenLayers.Format.XML.prototype.write.apply(this.format,[c]);return OpenLayers.Request.POST({url:this.url,callback:b.callback||function(){},data:c})},abort:function(a){a&&a.priv.abort()},
CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(a,b,c,d){OpenLayers.Handler.prototype.initialize.apply(this,[a,c,d]);this.layer=
b},touchstart:function(a){this.startTouch();return OpenLayers.Event.isMultiTouch(a)?!0:this.mousedown(a)},touchmove:function(a){OpenLayers.Event.preventDefault(a)},mousedown:function(a){if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))this.down=a.xy;return this.handle(a)?!this.stopDown:!0},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:!0},click:function(a){return this.handle(a)?!this.stopClick:!0},mousemove:function(a){if(!this.callbacks.over&&!this.callbacks.out)return!0;
this.handle(a);return!0},dblclick:function(a){return!this.handle(a)},geometryTypeMatches:function(a){return null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)},handle:function(a){this.feature&&!this.feature.layer&&(this.feature=null);var b=a.type,c=!1,d=!!this.feature,e="click"==b||"dblclick"==b||"touchstart"==b;(this.feature=this.layer.getFeatureFromEvent(a))&&!this.feature.layer&&(this.feature=null);this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=
null);this.feature?("touchstart"===b&&OpenLayers.Event.preventDefault(a),a=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(d&&a?(this.lastFeature&&this.triggerCallback(b,"out",[this.lastFeature]),this.triggerCallback(b,"in",[this.feature])):d&&!e||this.triggerCallback(b,"in",[this.feature]),this.lastFeature=this.feature,c=!0):(this.lastFeature&&(d&&a||e)&&this.triggerCallback(b,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(d||e)&&this.triggerCallback(b,"out",
[this.lastFeature]);return c},triggerCallback:function(a,b,c){if(b=this.EVENTMAP[a][b])"click"==a&&this.up&&this.down?(Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(b,c),this.up=this.down=null):this.callback(b,c)},activate:function(){var a=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0);
return a},deactivate:function(){var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0);return a},handleMapEvents:function(a){"removelayer"!=a.type&&"order"!=a.property||this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},
moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(a){for(var b=this.layers,c,d=0;d<b.length;d++)if(c=b[d].getFeatureFromEvent(a))return c},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer);
this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var a,b=0;b<this.map.layers.length;++b)a=this.map.layers[b],-1!=OpenLayers.Util.indexOf(this.layers,a)&&a.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var a,b=0;b<this.layers.length;++b)a=this.layers[b],this.renderer&&a.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(a.renderer)},handleChangeLayer:function(a){var b=a.layer;"order"==a.property&&-1!=OpenLayers.Util.indexOf(this.layers,
b)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);null===this.scope&&(this.scope=this);this.initLayer(a);var c=
{click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(c.over=this.overFeature,c.out=this.outFeature);this.callbacks=OpenLayers.Util.extend(c,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(a){OpenLayers.Util.isArray(a)?(this.layers=a,this.layer=
new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})):this.layer=a},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer);OpenLayers.Control.prototype.destroy.apply(this,arguments);this.layers&&this.layer.destroy()},activate:function(){this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate());return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.active&&
(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer));return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var b=this.layers||[this.layer],c,d,e,f;for(e=0;e<b.length;++e)if(c=b[e],f=0,null!=c.selectedFeatures)for(;c.selectedFeatures.length>f;)d=c.selectedFeatures[f],a&&a.except==d?++f:this.unselect(d)},clickFeature:function(a){this.hover||(-1<OpenLayers.Util.indexOf(a.layer.selectedFeatures,
a)?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(a){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(a){var b=
a.layer;this.hover&&(this.highlightOnly?this.highlight(a):-1==OpenLayers.Util.indexOf(b.selectedFeatures,a)&&this.select(a))},outFeature:function(a){if(this.hover)if(this.highlightOnly){if(a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a)},highlight:function(a){var b=a.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:a})&&
(a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id,b.drawFeature(a,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",{feature:a}))},unhighlight:function(a){var b=a.layer;void 0==a._prevHighlighter?delete a._lastHighlighter:(a._prevHighlighter!=this.id&&(a._lastHighlighter=a._prevHighlighter),delete a._prevHighlighter);b.drawFeature(a,a.style||a.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:a})},select:function(a){var b=
this.onBeforeSelect.call(this.scope,a),c=a.layer;!1!==b&&(b=c.events.triggerEvent("beforefeatureselected",{feature:a}),!1!==b&&(c.selectedFeatures.push(a),this.highlight(a),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=c.selectedFeatures[0]),c.events.triggerEvent("featureselected",{feature:a}),this.onSelect.call(this.scope,a)))},unselect:function(a){var b=a.layer;this.unhighlight(a);OpenLayers.Util.removeItem(b.selectedFeatures,a);b.events.triggerEvent("featureunselected",
{feature:a});this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom});a=this.map.getLonLatFromPixel({x:a.right,y:a.top});b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat);this.multipleSelect()||this.unselectAll();a=this.multiple;this.multiple=!0;var c=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:c});for(var d,e=0;e<c.length;++e){d=c[e];for(var f=0,g=d.features.length;f<g;++f){var h=
d.features[f];h.getVisibility()&&(null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,h.geometry.CLASS_NAME))&&b.toGeometry().intersects(h.geometry)&&-1==OpenLayers.Util.indexOf(d.selectedFeatures,h)&&this.select(h)}}this.multiple=a;this.events.triggerEvent("boxselectionend",{layers:c})}},setMap:function(a){this.handlers.feature.setMap(a);this.box&&this.handlers.box.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(a){var b=this.active;this.unselectAll();
this.deactivate();this.layers&&(this.layer.destroy(),this.layers=null);this.initLayer(a);this.handlers.feature.layer=this.layer;b&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{}));OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,
arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return!0},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();
this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments))return!1;this.cancel();null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1));this.layer=null;return!0},destroyFeature:function(a){!this.layer||!a&&this.persist||this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var a=this.layer;a&&1<a.features.length&&this.layer.features[0].destroy()},finalize:function(a){this.mouseDown=
!1;this.lastTouchPx=this.lastUp=this.lastDown=null;this.callback(a?"cancel":"done",[this.geometryClone()]);this.destroyFeature(a)},cancel:function(){this.finalize(!0)},click:function(a){OpenLayers.Event.stop(a);return!1},dblclick:function(a){OpenLayers.Event.stop(a);return!1},modifyFeature:function(a){this.point||this.createFeature(a);a=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();
this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;a&&this.multi&&(a=new OpenLayers.Geometry.MultiPoint([a]));return a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){return this.down(a)},touchstart:function(a){this.startTouch();this.lastTouchPx=a.xy;return this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){this.lastTouchPx=a.xy;
return this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){a.xy=this.lastTouchPx;return this.up(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},move:function(a){this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy);return!0},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(!this.checkModifiers(a)||this.lastUp&&this.lastUp.equals(a.xy)||!this.lastDown||
!this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance))return!0;this.touch&&this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.lastUp=a.xy;this.finalize();return!this.stopUp},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(a,b,c){var d=!0;null!=c&&a&&b&&a.distanceTo(b)>c&&(d=!1);return d},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);
this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(a){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,a);this.line=null},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(a){this.layer.removeFeatures([this.point]);a=this.layer.getLonLatFromViewPortPx(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.lon,
a.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(a,b){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(a,b),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(a,b){var c=this.getCurrentPointIndex()-
1,c=this.line.geometry.components[c];!c||(isNaN(c.x)||isNaN(c.y))||this.insertXY(c.x+a,c.y+b)},insertDirectionLength:function(a,b){a*=Math.PI/180;var c=b*Math.cos(a),d=b*Math.sin(a);this.insertDeltaXY(c,d)},insertDeflectionLength:function(a,b){var c=this.getCurrentPointIndex()-1;if(0<c){var d=this.line.geometry.components[c],c=this.line.geometry.components[c-1],d=Math.atan2(d.y-c.y,d.x-c.x);this.insertDirectionLength(180*d/Math.PI+a,b)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-
1},undo:function(){var a=this.line.geometry,b=a.components,c=this.getCurrentPointIndex()-1,d=b[c],e=a.removeComponent(d);e&&(this.touch&&0<c&&(b=a.components,a=b[c-1],c=this.getCurrentPointIndex(),b=b[c],b.x=a.x,b.y=a.y),this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature());return e},redo:function(){var a=this.redoStack&&this.redoStack.pop();a&&(this.line.geometry.addComponent(a,this.getCurrentPointIndex()),this.drawFeature());return!!a},freehandMode:function(a){return this.freehandToggle&&
a[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(a,b){this.line||this.createFeature(a);var c=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=c.lon;this.point.geometry.y=c.lat;this.callback("modify",[this.point.geometry,this.getSketch(),b]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=
this.line&&this.line.geometry;a&&this.multi&&(a=new OpenLayers.Geometry.MultiLineString([a]));return a},touchstart:function(a){if(this.timerId&&this.passesTolerance(this.lastTouchPx,a.xy,this.doubleTouchTolerance))return this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1;this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,
a)},down:function(a){var b=this.stopDown;this.freehandMode(a)&&(b=!0,this.touch&&(this.modifyFeature(a.xy,!!this.lastUp),OpenLayers.Event.stop(a)));this.touch||this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||this.modifyFeature(a.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=a.xy;this.stoppedDown=b;return!b},move:function(a){if(this.stoppedDown&&this.freehandMode(a))return this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===
this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(a.xy),!1;this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy,!!this.lastUp);return!0},up:function(a){!this.mouseDown||this.lastUp&&this.lastUp.equals(a.xy)||(this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),
this.addPoint(a.xy),this.lastUp=a.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry()));this.stoppedDown=this.stopDown;this.mouseDown=!1;return!this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]);this.removePoint();this.finalize()},dblclick:function(a){this.freehandMode(a)||this.finishGeometry();return!1},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Spherical=OpenLayers.Spherical||{};OpenLayers.Spherical.DEFAULT_RADIUS=6378137;OpenLayers.Spherical.computeDistanceBetween=function(a,b,c){c=c||OpenLayers.Spherical.DEFAULT_RADIUS;var d=Math.sin(Math.PI*(b.lon-a.lon)/360),e=Math.sin(Math.PI*(b.lat-a.lat)/360);a=e*e+d*d*Math.cos(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180);return 2*c*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))};
OpenLayers.Spherical.computeHeading=function(a,b){var c=Math.sin(Math.PI*(a.lon-b.lon)/180)*Math.cos(Math.PI*b.lat/180),d=Math.cos(Math.PI*a.lat/180)*Math.sin(Math.PI*b.lat/180)-Math.sin(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180)*Math.cos(Math.PI*(a.lon-b.lon)/180);return 180*Math.atan2(c,d)/Math.PI};OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;0<=b;--b)this.addLayer({layer:c[b]});if(!this.layers)a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},removeLayer:function(a){a.layer.events.un({tileloadstart:this.makeSameOrigin,
tileloaded:this.onTileLoaded,scope:this})},makeSameOrigin:function(a){if(this.active&&(a=a.tile,a instanceof OpenLayers.Tile.Image&&!a.crossOriginKeyword&&"data:"!==a.url.substr(0,5))){var b=OpenLayers.Request.makeSameOrigin(a.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[b]=a.url;a.url=b}},onTileLoaded:function(a){this.active&&(!a.aborted&&a.tile instanceof OpenLayers.Tile.Image&&"data:"!==a.tile.url.substr(0,5))&&(this.cache({tile:a.tile}),delete OpenLayers.Control.CacheWrite.urlMap[a.tile.url])},
cache:function(a){if(window.localStorage){a=a.tile;try{var b=a.getCanvasContext();b&&window.localStorage.setItem("olCache_"+(OpenLayers.Control.CacheWrite.urlMap[a.url]||a.url),b.canvas.toDataURL(this.imageFormat))}catch(c){(b=c.name||c.message)&&this.quotaRegEx.test(b)?this.events.triggerEvent("cachefull",{tile:a}):OpenLayers.Console.error(c.toString())}}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;0<=a;--a)this.removeLayer({layer:b[a]})}this.map&&
this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"});OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var a,b;for(a=window.localStorage.length-1;0<=a;--a)b=window.localStorage.key(a),"olCache_"===b.substr(0,8)&&window.localStorage.removeItem(b)}};OpenLayers.Control.CacheWrite.urlMap={};OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(a,b){var c=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(b&&b.map)if(this.context=c,b.map instanceof OpenLayers.Map)c=this.mergeContextToMap(c,b.map);else{var d=b.map;if(OpenLayers.Util.isElement(d)||"string"==typeof d)d={div:d};c=this.contextToMap(c,d)}return c},getLayerFromContext:function(a){var b,c,d={queryable:a.queryable,visibility:a.visibility,
maxExtent:a.maxExtent,metadata:OpenLayers.Util.applyDefaults(a.metadata,{styles:a.styles,formats:a.formats,"abstract":a["abstract"],dataURL:a.dataURL}),numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.tileSize?new OpenLayers.Size(a.tileSize.width,a.tileSize.height):void 0,minScale:a.minScale||a.maxScaleDenominator,maxScale:a.maxScale||a.minScaleDenominator,srs:a.srs,dimensions:a.dimensions,
metadataURL:a.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(d,this.layerOptions);var e={layers:a.name,transparent:a.transparent,version:a.version};if(a.formats&&0<a.formats.length)for(e.format=a.formats[0].value,b=0,c=a.formats.length;b<c;b++){var f=a.formats[b];if(!0==f.current){e.format=f.value;break}}if(a.styles&&0<a.styles.length)for(b=0,c=a.styles.length;b<c;b++)if(f=a.styles[b],!0==f.current){f.href?e.sld=f.href:f.body?e.sld_body=f.body:e.styles=f.name;break}this.layerParams&&
OpenLayers.Util.applyDefaults(e,this.layerParams);b=null;c=a.service;c==OpenLayers.Format.Context.serviceTypes.WFS?(d.strategies=[new OpenLayers.Strategy.BBOX],d.protocol=new OpenLayers.Protocol.WFS({url:a.url,featurePrefix:a.name.split(":")[0],featureType:a.name.split(":").pop()}),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):c==OpenLayers.Format.Context.serviceTypes.KML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.KML}),
b=new OpenLayers.Layer.Vector(a.title||a.name,d)):c==OpenLayers.Format.Context.serviceTypes.GML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.GML}),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):a.features?(b=new OpenLayers.Layer.Vector(a.title||a.name,d),b.addFeatures(a.features)):!0!==a.categoryLayer&&(b=new OpenLayers.Layer.WMS(a.title||a.name,a.url,e,d));return b},getLayersFromContext:function(a){for(var b=[],c=
0,d=a.length;c<d;c++){var e=this.getLayerFromContext(a[c]);null!==e&&b.push(e)}return b},contextToMap:function(a,b){b=OpenLayers.Util.applyDefaults({maxExtent:a.maxExtent,projection:a.projection,units:a.units},b);b.maxExtent&&(b.maxResolution=b.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);b.metadata={contactInformation:a.contactInformation,"abstract":a["abstract"],keywords:a.keywords,logo:a.logo,descriptionURL:a.descriptionURL};var c=new OpenLayers.Map(b);c.addLayers(this.getLayersFromContext(a.layersContext));
c.setCenter(a.bounds.getCenterLonLat(),c.getZoomForExtent(a.bounds,!0));return c},mergeContextToMap:function(a,b){b.addLayers(this.getLayersFromContext(a.layersContext));return b},write:function(a,b){a=this.toContext(a);return OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"});
OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"};OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(a){var b=this.getParser(),c={queryable:a.queryable,visibility:a.visibility,name:a.params.LAYERS,title:a.name,"abstract":a.metadata["abstract"],dataURL:a.metadata.dataURL,metadataURL:a.metadataURL,server:{version:a.params.VERSION,url:a.url},maxExtent:a.maxExtent,transparent:a.params.TRANSPARENT,numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:1==a.opacity?void 0:
a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.singleTile||!a.tileSize?void 0:{width:a.tileSize.w,height:a.tileSize.h},minScale:a.options.resolutions||a.options.scales||a.options.maxResolution||a.options.minScale?a.minScale:void 0,maxScale:a.options.resolutions||a.options.scales||a.options.minResolution||a.options.maxScale?a.maxScale:void 0,formats:[],styles:[],srs:a.srs,dimensions:a.dimensions};a.metadata.servertitle&&(c.server.title=a.metadata.servertitle);
if(a.metadata.formats&&0<a.metadata.formats.length)for(var d=0,e=a.metadata.formats.length;d<e;d++){var f=a.metadata.formats[d];c.formats.push({value:f.value,current:f.value==a.params.FORMAT})}else c.formats.push({value:a.params.FORMAT,current:!0});if(a.metadata.styles&&0<a.metadata.styles.length)for(d=0,e=a.metadata.styles.length;d<e;d++)b=a.metadata.styles[d],b.current=b.href==a.params.SLD||b.body==a.params.SLD_BODY||b.name==a.params.STYLES?!0:!1,c.styles.push(b);else c.styles.push({href:a.params.SLD,
body:a.params.SLD_BODY,name:a.params.STYLES||b.defaultStyleName,title:b.defaultStyleTitle,current:!0});return c},toContext:function(a){var b={},c=a.layers;if("OpenLayers.Map"==a.CLASS_NAME){var d=a.metadata||{};b.size=a.getSize();b.bounds=a.getExtent();b.projection=a.projection;b.title=a.title;b.keywords=d.keywords;b["abstract"]=d["abstract"];b.logo=d.logo;b.descriptionURL=d.descriptionURL;b.contactInformation=d.contactInformation;b.maxExtent=a.maxExtent}else OpenLayers.Util.applyDefaults(b,a),void 0!=
b.layers&&delete b.layers;void 0==b.layersContext&&(b.layersContext=[]);if(void 0!=c&&OpenLayers.Util.isArray(c))for(a=0,d=c.length;a<d;a++){var e=c[a];e instanceof OpenLayers.Layer.WMS&&b.layersContext.push(this.layerToContext(e))}return b},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(a){var b=null;if(null==a)b=this.namespaces[this.defaultPrefix];else for(b in this.namespaces)if(this.namespaces[b]==a)break;return b},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",
defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a=a.documentElement;this.rootPrefix=a.prefix;var b={version:a.getAttribute("version")};this.runChildNodes(b,a);return b},runChildNodes:function(a,b){for(var c=b.childNodes,d,e,f,g=0,h=c.length;g<h;++g)d=c[g],1==d.nodeType&&(e=this.getNamespacePrefix(d.namespaceURI),f=d.nodeName.split(":").pop(),
(e=this["read_"+e+"_"+f])&&e.apply(this,[a,d]))},read_wmc_General:function(a,b){this.runChildNodes(a,b)},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS");a.bounds=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"))},read_wmc_LayerList:function(a,b){a.layersContext=[];this.runChildNodes(a,b)},read_wmc_Layer:function(a,b){var c={visibility:"1"!=b.getAttribute("hidden"),queryable:"1"==b.getAttribute("queryable"),formats:[],
styles:[],metadata:{}};this.runChildNodes(c,b);a.layersContext.push(c)},read_wmc_Extension:function(a,b){this.runChildNodes(a,b)},read_ol_units:function(a,b){a.units=this.getChildValue(b)},read_ol_maxExtent:function(a,b){var c=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));a.maxExtent=c},read_ol_transparent:function(a,b){a.transparent=this.getChildValue(b)},read_ol_numZoomLevels:function(a,b){a.numZoomLevels=parseInt(this.getChildValue(b))},
read_ol_opacity:function(a,b){a.opacity=parseFloat(this.getChildValue(b))},read_ol_singleTile:function(a,b){a.singleTile="true"==this.getChildValue(b)},read_ol_tileSize:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height")};a.tileSize=c},read_ol_isBaseLayer:function(a,b){a.isBaseLayer="true"==this.getChildValue(b)},read_ol_displayInLayerSwitcher:function(a,b){a.displayInLayerSwitcher="true"==this.getChildValue(b)},read_wmc_Server:function(a,b){a.version=b.getAttribute("version");
a.url=this.getOnlineResource_href(b);a.metadata.servertitle=b.getAttribute("title")},read_wmc_FormatList:function(a,b){this.runChildNodes(a,b)},read_wmc_Format:function(a,b){var c={value:this.getChildValue(b)};"1"==b.getAttribute("current")&&(c.current=!0);a.formats.push(c)},read_wmc_StyleList:function(a,b){this.runChildNodes(a,b)},read_wmc_Style:function(a,b){var c={};this.runChildNodes(c,b);"1"==b.getAttribute("current")&&(c.current=!0);a.styles.push(c)},read_wmc_SLD:function(a,b){this.runChildNodes(a,
b)},read_sld_StyledLayerDescriptor:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_sld_FeatureTypeStyle:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_wmc_OnlineResource:function(a,b){a.href=this.getAttributeNS(b,this.namespaces.xlink,"href")},read_wmc_Name:function(a,b){var c=this.getChildValue(b);c&&(a.name=c)},read_wmc_Title:function(a,b){var c=this.getChildValue(b);c&&(a.title=c)},read_wmc_MetadataURL:function(a,
b){a.metadataURL=this.getOnlineResource_href(b)},read_wmc_KeywordList:function(a,b){a.keywords=[];this.runChildNodes(a.keywords,b)},read_wmc_Keyword:function(a,b){a.push(this.getChildValue(b))},read_wmc_Abstract:function(a,b){var c=this.getChildValue(b);c&&(a["abstract"]=c)},read_wmc_LogoURL:function(a,b){a.logo={width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),href:this.getOnlineResource_href(b)}},read_wmc_DescriptionURL:function(a,b){a.descriptionURL=
this.getOnlineResource_href(b)},read_wmc_ContactInformation:function(a,b){var c={};this.runChildNodes(c,b);a.contactInformation=c},read_wmc_ContactPersonPrimary:function(a,b){var c={};this.runChildNodes(c,b);a.personPrimary=c},read_wmc_ContactPerson:function(a,b){var c=this.getChildValue(b);c&&(a.person=c)},read_wmc_ContactOrganization:function(a,b){var c=this.getChildValue(b);c&&(a.organization=c)},read_wmc_ContactPosition:function(a,b){var c=this.getChildValue(b);c&&(a.position=c)},read_wmc_ContactAddress:function(a,
b){var c={};this.runChildNodes(c,b);a.contactAddress=c},read_wmc_AddressType:function(a,b){var c=this.getChildValue(b);c&&(a.type=c)},read_wmc_Address:function(a,b){var c=this.getChildValue(b);c&&(a.address=c)},read_wmc_City:function(a,b){var c=this.getChildValue(b);c&&(a.city=c)},read_wmc_StateOrProvince:function(a,b){var c=this.getChildValue(b);c&&(a.stateOrProvince=c)},read_wmc_PostCode:function(a,b){var c=this.getChildValue(b);c&&(a.postcode=c)},read_wmc_Country:function(a,b){var c=this.getChildValue(b);
c&&(a.country=c)},read_wmc_ContactVoiceTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.phone=c)},read_wmc_ContactFacsimileTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.fax=c)},read_wmc_ContactElectronicMailAddress:function(a,b){var c=this.getChildValue(b);c&&(a.email=c)},read_wmc_DataURL:function(a,b){a.dataURL=this.getOnlineResource_href(b)},read_wmc_LegendURL:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),
href:this.getOnlineResource_href(b)};a.legend=c},read_wmc_DimensionList:function(a,b){a.dimensions={};this.runChildNodes(a.dimensions,b)},read_wmc_Dimension:function(a,b){var c={name:b.getAttribute("name").toLowerCase(),units:b.getAttribute("units")||"",unitSymbol:b.getAttribute("unitSymbol")||"",userValue:b.getAttribute("userValue")||"",nearestValue:"1"===b.getAttribute("nearestValue"),multipleValues:"1"===b.getAttribute("multipleValues"),current:"1"===b.getAttribute("current"),"default":b.getAttribute("default")||
""},d=this.getChildValue(b);c.values=d.split(",");a[c.name]=c},write:function(a,b){var c=this.createElementDefaultNS("ViewContext");this.setAttributes(c,{version:this.VERSION,id:b&&"string"==typeof b.id?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);c.appendChild(this.write_wmc_General(a));c.appendChild(this.write_wmc_LayerList(a));return OpenLayers.Format.XML.prototype.write.apply(this,[c])},createElementDefaultNS:function(a,
b,c){a=this.createElementNS(this.namespaces[this.defaultPrefix],a);b&&a.appendChild(this.createTextNode(b));c&&this.setAttributes(a,c);return a},setAttributes:function(a,b){var c,d;for(d in b)c=b[d].toString(),c.match(/[A-Z]/)?this.setAttributeNS(a,null,d,c):a.setAttribute(d,c)},write_wmc_General:function(a){var b=this.createElementDefaultNS("General");a.size&&b.appendChild(this.createElementDefaultNS("Window",null,{width:a.size.w,height:a.size.h}));var c=a.bounds;b.appendChild(this.createElementDefaultNS("BoundingBox",
null,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18),SRS:a.projection}));b.appendChild(this.createElementDefaultNS("Title",a.title));a.keywords&&b.appendChild(this.write_wmc_KeywordList(a.keywords));a["abstract"]&&b.appendChild(this.createElementDefaultNS("Abstract",a["abstract"]));a.logo&&b.appendChild(this.write_wmc_URLType("LogoURL",a.logo.href,a.logo));a.descriptionURL&&b.appendChild(this.write_wmc_URLType("DescriptionURL",a.descriptionURL));
a.contactInformation&&b.appendChild(this.write_wmc_ContactInformation(a.contactInformation));b.appendChild(this.write_ol_MapExtension(a));return b},write_wmc_KeywordList:function(a){for(var b=this.createElementDefaultNS("KeywordList"),c=0,d=a.length;c<d;c++)b.appendChild(this.createElementDefaultNS("Keyword",a[c]));return b},write_wmc_ContactInformation:function(a){var b=this.createElementDefaultNS("ContactInformation");a.personPrimary&&b.appendChild(this.write_wmc_ContactPersonPrimary(a.personPrimary));
a.position&&b.appendChild(this.createElementDefaultNS("ContactPosition",a.position));a.contactAddress&&b.appendChild(this.write_wmc_ContactAddress(a.contactAddress));a.phone&&b.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",a.phone));a.fax&&b.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",a.fax));a.email&&b.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",a.email));return b},write_wmc_ContactPersonPrimary:function(a){var b=this.createElementDefaultNS("ContactPersonPrimary");
a.person&&b.appendChild(this.createElementDefaultNS("ContactPerson",a.person));a.organization&&b.appendChild(this.createElementDefaultNS("ContactOrganization",a.organization));return b},write_wmc_ContactAddress:function(a){var b=this.createElementDefaultNS("ContactAddress");a.type&&b.appendChild(this.createElementDefaultNS("AddressType",a.type));a.address&&b.appendChild(this.createElementDefaultNS("Address",a.address));a.city&&b.appendChild(this.createElementDefaultNS("City",a.city));a.stateOrProvince&&
b.appendChild(this.createElementDefaultNS("StateOrProvince",a.stateOrProvince));a.postcode&&b.appendChild(this.createElementDefaultNS("PostCode",a.postcode));a.country&&b.appendChild(this.createElementDefaultNS("Country",a.country));return b},write_ol_MapExtension:function(a){var b=this.createElementDefaultNS("Extension");if(a=a.maxExtent){var c=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(c,{minx:a.left.toPrecision(18),miny:a.bottom.toPrecision(18),maxx:a.right.toPrecision(18),
maxy:a.top.toPrecision(18)});b.appendChild(c)}return b},write_wmc_LayerList:function(a){for(var b=this.createElementDefaultNS("LayerList"),c=0,d=a.layersContext.length;c<d;++c)b.appendChild(this.write_wmc_Layer(a.layersContext[c]));return b},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});b.appendChild(this.write_wmc_Server(a));b.appendChild(this.createElementDefaultNS("Name",a.name));b.appendChild(this.createElementDefaultNS("Title",
a.title));a["abstract"]&&b.appendChild(this.createElementDefaultNS("Abstract",a["abstract"]));a.dataURL&&b.appendChild(this.write_wmc_URLType("DataURL",a.dataURL));a.metadataURL&&b.appendChild(this.write_wmc_URLType("MetadataURL",a.metadataURL));return b},write_wmc_LayerExtension:function(a){var b=this.createElementDefaultNS("Extension"),c=a.maxExtent,d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),
maxy:c.top.toPrecision(18)});b.appendChild(d);a.tileSize&&!a.singleTile&&(c=this.createElementNS(this.namespaces.ol,"ol:tileSize"),this.setAttributes(c,a.tileSize),b.appendChild(c));for(var c="transparent numZoomLevels units isBaseLayer opacity displayInLayerSwitcher singleTile".split(" "),e=0,f=c.length;e<f;++e)(d=this.createOLPropertyNode(a,c[e]))&&b.appendChild(d);return b},createOLPropertyNode:function(a,b){var c=null;null!=a[b]&&(c=this.createElementNS(this.namespaces.ol,"ol:"+b),c.appendChild(this.createTextNode(a[b].toString())));
return c},write_wmc_Server:function(a){a=a.server;var b=this.createElementDefaultNS("Server"),c={service:"OGC:WMS",version:a.version};a.title&&(c.title=a.title);this.setAttributes(b,c);b.appendChild(this.write_wmc_OnlineResource(a.url));return b},write_wmc_URLType:function(a,b,c){a=this.createElementDefaultNS(a);a.appendChild(this.write_wmc_OnlineResource(b));if(c){b=["width","height","format"];for(var d=0;d<b.length;d++)b[d]in c&&a.setAttribute(b[d],c[b[d]])}return a},write_wmc_DimensionList:function(a){var b=
this.createElementDefaultNS("DimensionList"),c;for(c in a.dimensions){var d={},e=a.dimensions[c],f;for(f in e)d[f]="boolean"==typeof e[f]?Number(e[f]):e[f];e="";d.values&&(e=d.values.join(","),delete d.values);b.appendChild(this.createElementDefaultNS("Dimension",e,d))}return b},write_wmc_FormatList:function(a){for(var b=this.createElementDefaultNS("FormatList"),c=0,d=a.formats.length;c<d;c++){var e=a.formats[c];b.appendChild(this.createElementDefaultNS("Format",e.value,e.current&&!0==e.current?{current:"1"}:
null))}return b},write_wmc_StyleList:function(a){var b=this.createElementDefaultNS("StyleList");if((a=a.styles)&&OpenLayers.Util.isArray(a))for(var c,d=0,e=a.length;d<e;d++){var f=a[d],g=this.createElementDefaultNS("Style",null,f.current&&!0==f.current?{current:"1"}:null);f.href?(c=this.createElementDefaultNS("SLD"),f.name&&c.appendChild(this.createElementDefaultNS("Name",f.name)),f.title&&c.appendChild(this.createElementDefaultNS("Title",f.title)),f.legend&&c.appendChild(this.write_wmc_URLType("LegendURL",
f.legend.href,f.legend)),f=this.write_wmc_OnlineResource(f.href),c.appendChild(f),g.appendChild(c)):f.body?(c=this.createElementDefaultNS("SLD"),f.name&&c.appendChild(this.createElementDefaultNS("Name",f.name)),f.title&&c.appendChild(this.createElementDefaultNS("Title",f.title)),f.legend&&c.appendChild(this.write_wmc_URLType("LegendURL",f.legend.href,f.legend)),f=OpenLayers.Format.XML.prototype.read.apply(this,[f.body]).documentElement,c.ownerDocument&&c.ownerDocument.importNode&&(f=c.ownerDocument.importNode(f,
!0)),c.appendChild(f),g.appendChild(c)):(g.appendChild(this.createElementDefaultNS("Name",f.name)),g.appendChild(this.createElementDefaultNS("Title",f.title)),f["abstract"]&&g.appendChild(this.createElementDefaultNS("Abstract",f["abstract"])),f.legend&&g.appendChild(this.write_wmc_URLType("LegendURL",f.legend.href,f.legend)));b.appendChild(g)}return b},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(b,this.namespaces.xlink,"xlink:type",
"simple");this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a);return b},getOnlineResource_href:function(a){var b={};a=a.getElementsByTagName("OnlineResource");0<a.length&&this.read_wmc_OnlineResource(b,a[0]);return b.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);a={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,a)])},
CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,
addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var a=[];if(this.map&&this.map.layers){for(var b=0,c=this.map.layers.length;b<c;b++){var d=this.map.layers[b];d.attribution&&d.getVisibility()&&-1===OpenLayers.Util.indexOf(a,d.attribution)&&a.push(d.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:a.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(a){OpenLayers.Util.extend(this,a)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]},update:function(a){this.points.unshift({xy:a,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(a){for(var b,c=(new Date).getTime(),d=0,e=this.points.length,f;d<e;d++){f=this.points[d];if(c-
f.tick>this.delay)break;b=f}if(b&&(d=(new Date).getTime()-b.tick,c=Math.sqrt(Math.pow(a.x-b.xy.x,2)+Math.pow(a.y-b.xy.y,2)),d=c/d,!(0==d||d<this.threshold)))return c=Math.asin((a.y-b.xy.y)/c),b.xy.x<=a.x&&(c=Math.PI-c),{speed:d,theta:c}},move:function(a,b){var c=a.speed,d=Math.cos(a.theta),e=-Math.sin(a.theta),f=(new Date).getTime(),g=0,h=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var a=(new Date).getTime()-f,l=-this.deceleration*Math.pow(a,
2)/2+c*a,m=l*d,l=l*e,n,p;n=!1;0>=-this.deceleration*a+c&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,n=!0);a=m-g;p=l-h;g=m;h=l;b(a,p,n)}},this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",
schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(a){},write:function(a){var b;window.ActiveXObject?this.xmldom=b=new ActiveXObject("Microsoft.XMLDOM"):b=document.implementation.createDocument("","",null);a=this.writeNode("wps:Execute",a,b);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},read:function(a){"string"==typeof a&&(a=
OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},writers:{wps:{Execute:function(a){var b=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});this.writeNode("ows:Identifier",a.identifier,b);this.writeNode("wps:DataInputs",a.dataInputs,b);this.writeNode("wps:ResponseForm",a.responseForm,b);return b},ResponseForm:function(a){var b=this.createElementNSPlus("wps:ResponseForm",{});a.rawDataOutput&&
this.writeNode("wps:RawDataOutput",a.rawDataOutput,b);a.responseDocument&&this.writeNode("wps:ResponseDocument",a.responseDocument,b);return b},ResponseDocument:function(a){var b=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:a.storeExecuteResponse,lineage:a.lineage,status:a.status}});if(a.outputs)for(var c=0,d=a.outputs.length;c<d;c++)this.writeNode("wps:Output",a.outputs[c],b);return b},Output:function(a){var b=this.createElementNSPlus("wps:Output",{attributes:{asReference:a.asReference,
mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});this.writeNode("ows:Identifier",a.identifier,b);this.writeNode("ows:Title",a.title,b);this.writeNode("ows:Abstract",a["abstract"],b);return b},RawDataOutput:function(a){var b=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});this.writeNode("ows:Identifier",a.identifier,b);return b},DataInputs:function(a){for(var b=this.createElementNSPlus("wps:DataInputs",{}),c=0,d=a.length;c<
d;++c)this.writeNode("wps:Input",a[c],b);return b},Input:function(a){var b=this.createElementNSPlus("wps:Input",{});this.writeNode("ows:Identifier",a.identifier,b);a.title&&this.writeNode("ows:Title",a.title,b);a.data&&this.writeNode("wps:Data",a.data,b);a.reference&&this.writeNode("wps:Reference",a.reference,b);a.boundingBoxData&&this.writeNode("wps:BoundingBoxData",a.boundingBoxData,b);return b},Data:function(a){var b=this.createElementNSPlus("wps:Data",{});a.literalData?this.writeNode("wps:LiteralData",
a.literalData,b):a.complexData?this.writeNode("wps:ComplexData",a.complexData,b):a.boundingBoxData&&this.writeNode("ows:BoundingBox",a.boundingBoxData,b);return b},LiteralData:function(a){return this.createElementNSPlus("wps:LiteralData",{attributes:{uom:a.uom},value:a.value})},ComplexData:function(a){var b=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}}),c=a.value;"string"===typeof c?b.appendChild(this.getXMLDoc().createCDATASection(a.value)):
b.appendChild(c);return b},Reference:function(a){var b=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:a.mimeType,"xlink:href":a.href,method:a.method,encoding:a.encoding,schema:a.schema}});a.body&&this.writeNode("wps:Body",a.body,b);return b},BoundingBoxData:function(a,b){this.writers.ows.BoundingBox.apply(this,[a,b,"wps:BoundingBoxData"])},Body:function(a){var b=this.createElementNSPlus("wps:Body",{});a.wcs?this.writeNode("wcs:GetCoverage",a.wcs,b):a.wfs?(this.featureType=a.wfs.featureType,
this.version=a.wfs.version,this.writeNode("wfs:GetFeature",a.wfs,b)):this.writeNode("wps:Execute",a,b);return b}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(a,b){b.executeResponse={lang:a.getAttribute("lang"),statusLocation:a.getAttribute("statusLocation"),serviceInstance:a.getAttribute("serviceInstance"),
service:a.getAttribute("service")};this.readChildNodes(a,b.executeResponse)},Process:function(a,b){b.process={};this.readChildNodes(a,b.process)},Status:function(a,b){b.status={creationTime:a.getAttribute("creationTime")};this.readChildNodes(a,b.status)},ProcessSucceeded:function(a,b){b.processSucceeded=!0},ProcessOutputs:function(a,b){b.processOutputs=[];this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c);b.push(c)},Reference:function(a,b){b.reference=
{href:a.getAttribute("href"),mimeType:a.getAttribute("mimeType"),encoding:a.getAttribute("encoding"),schema:a.getAttribute("schema")}},Data:function(a,b){b.data={};this.readChildNodes(a,b)},LiteralData:function(a,b){b.literalData={dataType:a.getAttribute("dataType"),uom:a.getAttribute("uom"),value:this.getChildValue(a)}},ComplexData:function(a,b){b.complexData={mimeType:a.getAttribute("mimeType"),schema:a.getAttribute("schema"),encoding:a.getAttribute("encoding"),value:""};if(this.isSimpleContent(a)){var c;
for(c=a.firstChild;c;c=c.nextSibling)switch(c.nodeType){case 3:case 4:b.complexData.value+=c.nodeValue}}else for(c=a.firstChild;c;c=c.nextSibling)1==c.nodeType&&(b.complexData.value=c)},BoundingBox:function(a,b){b.boundingBoxData={dimensions:a.getAttribute("dimensions"),crs:a.getAttribute("crs")};this.readChildNodes(a,b.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(a,b,c){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[a,c]);this.location=b;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,
success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(a,b,c){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(a){var b=a.responseXML;b&&b.documentElement||(b=OpenLayers.Format.XML.prototype.read(a.responseText));if(this.useFeedTitle){a=null;try{a=b.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(c){a=b.getElementsByTagName("title")[0].firstChild.nodeValue}a&&this.setName(a)}a={};OpenLayers.Util.extend(a,
this.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(a.externalProjection=this.projection,a.internalProjection=this.map.getProjectionObject());b=(new OpenLayers.Format.GeoRSS(a)).read(b);a=0;for(var d=b.length;a<d;a++){var e={},f=b[a];if(f.geometry){var g=f.attributes.title?f.attributes.title:"Untitled",h=f.attributes.description?f.attributes.description:"No description.",k=f.attributes.link?f.attributes.link:"",f=f.geometry.getBounds().getCenterLonLat();e.icon=
null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone();e.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(g||h){e.title=g;e.description=h;var l='<div class="olLayerGeoRSSClose">[x]</div>',l=l+'<div class="olLayerGeoRSSTitle">';k&&(l+='<a class="link" href="'+k+'" target="_blank">');l+=g;k&&(l+="</a>");l+="</div>";l+='<div style="" class="olLayerGeoRSSDescription">';l+=h;l+="</div>";e.popupContentHTML=l}f=new OpenLayers.Feature(this,f,e);this.features.push(f);
e=f.createMarker();e.events.register("click",f,this.markerClick);this.addMarker(e)}}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;c<d;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||(b=this.createPopup(),OpenLayers.Event.observe(b.div,"click",OpenLayers.Function.bind(function(){for(var a=0,b=this.layer.map.popups.length;a<b;a++)this.layer.map.removePopup(this.layer.map.popups[a])},
this)),this.layer.map.addPopup(b));OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;0<this.features.length;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"});OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"});OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,
graphicName:"square"},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={namedLayers:!0===b.namedLayersAsArray?[]:{}};this.readChildNodes(a,c);return c},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version");this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(a,b){var c=
{userStyles:[],namedStyles:[]};this.readChildNodes(a,c);for(var d=0,e=c.userStyles.length;d<e;++d)c.userStyles[d].layerName=c.name;OpenLayers.Util.isArray(b.namedLayers)?b.namedLayers.push(c):b.namedLayers[c.name]=c},NamedStyle:function(a,b){b.namedStyles.push(this.getChildName(a.firstChild))},UserStyle:function(a,b){var c={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(a,c);this.multipleSymbolizers?(delete c.defaultsPerSymbolizer,c=new OpenLayers.Style2(c)):c=new OpenLayers.Style(this.defaultSymbolizer,
c);b.userStyles.push(c)},IsDefault:function(a,b){"1"==this.getChildValue(a)&&(b.isDefault=!0)},FeatureTypeStyle:function(a,b){++this.featureTypeCounter;var c={rules:this.multipleSymbolizers?b.rules:[]};this.readChildNodes(a,c);this.multipleSymbolizers||(b.rules=c.rules)},Rule:function(a,b){var c;this.multipleSymbolizers&&(c={symbolizers:[]});c=new OpenLayers.Rule(c);this.readChildNodes(a,c);b.rules.push(c)},ElseFilter:function(a,b){b.elseFilter=!0},MinScaleDenominator:function(a,b){b.minScaleDenominator=
parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(a,b){var c={};this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Text(c))):b.symbolizer.Text=OpenLayers.Util.applyDefaults(c,b.symbolizer.Text)},LabelPlacement:function(a,b){this.readChildNodes(a,b)},PointPlacement:function(a,b){var c={};this.readChildNodes(a,c);c.labelRotation=
c.rotation;delete c.rotation;var d,e=b.labelAnchorPointX,f=b.labelAnchorPointY;e<=1/3?d="l":e>1/3&&e<2/3?d="c":e>=2/3&&(d="r");f<=1/3?d+="b":f>1/3&&f<2/3?d+="m":f>=2/3&&(d+="t");c.labelAlign=d;OpenLayers.Util.applyDefaults(b,c)},AnchorPoint:function(a,b){this.readChildNodes(a,b)},AnchorPointX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointX=c)},AnchorPointY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointY=c)},Displacement:function(a,
b){this.readChildNodes(a,b)},DisplacementX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelXOffset=c)},DisplacementY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelYOffset=c)},LinePlacement:function(a,b){this.readChildNodes(a,b)},PerpendicularOffset:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelPerpendicularOffset=c)},Label:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.label=c)},Font:function(a,b){this.readChildNodes(a,
b)},Halo:function(a,b){var c={};this.readChildNodes(a,c);b.haloRadius=c.haloRadius;b.haloColor=c.fillColor;b.haloOpacity=c.fillOpacity},Radius:function(a,b){var c=this.readers.ogc._expression.call(this,a);null!=c&&(b.haloRadius=c)},RasterSymbolizer:function(a,b){var c={};this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Raster(c))):b.symbolizer.Raster=OpenLayers.Util.applyDefaults(c,b.symbolizer.Raster)},Geometry:function(a,
b){b.geometry={};this.readChildNodes(a,b.geometry)},ColorMap:function(a,b){b.colorMap=[];this.readChildNodes(a,b.colorMap)},ColorMapEntry:function(a,b){var c=a.getAttribute("quantity"),d=a.getAttribute("opacity");b.push({color:a.getAttribute("color"),quantity:null!==c?parseFloat(c):void 0,label:a.getAttribute("label")||void 0,opacity:null!==d?parseFloat(d):void 0})},LineSymbolizer:function(a,b){var c={};this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Line(c))):
b.symbolizer.Line=OpenLayers.Util.applyDefaults(c,b.symbolizer.Line)},PolygonSymbolizer:function(a,b){var c={fill:!1,stroke:!1};this.multipleSymbolizers||(c=b.symbolizer.Polygon||c);this.readChildNodes(a,c);this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Polygon(c))):b.symbolizer.Polygon=c},PointSymbolizer:function(a,b){var c={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(c=b.symbolizer.Point||c);this.readChildNodes(a,c);this.multipleSymbolizers?
(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Point(c))):b.symbolizer.Point=c},Stroke:function(a,b){b.stroke=!0;this.readChildNodes(a,b)},Fill:function(a,b){b.fill=!0;this.readChildNodes(a,b)},CssParameter:function(a,b){var c=a.getAttribute("name"),d=this.cssMap[c];b.label&&("fill"===c?d="fontColor":"fill-opacity"===c&&(d="fontOpacity"));d&&(c=this.readers.ogc._expression.call(this,a))&&(b[d]=c)},Graphic:function(a,b){b.graphic=!0;var c={};this.readChildNodes(a,c);
for(var d="stroke strokeColor strokeWidth strokeOpacity strokeLinecap fill fillColor fillOpacity graphicName rotation graphicFormat".split(" "),e,f,g=0,h=d.length;g<h;++g)e=d[g],f=c[e],void 0!=f&&(b[e]=f);void 0!=c.opacity&&(b.graphicOpacity=c.opacity);void 0!=c.size&&(isNaN(c.size/2)?b.graphicWidth=c.size:b.pointRadius=c.size/2);void 0!=c.href&&(b.externalGraphic=c.href);void 0!=c.rotation&&(b.rotation=c.rotation)},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,
b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.opacity=c)},Size:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.size=c)},Rotation:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.rotation=c)},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),
cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null,c;for(c in this.cssMap)if(this.cssMap[c]==a){b=c;break}return b},getGraphicFormat:function(a){var b,c;for(c in this.graphicFormats)if(this.graphicFormats[c].test(a)){b=
c;break}return b||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(a,b){var c=this.createElementNSPlus(a),d="string"==typeof b?b.split("${"):[b];c.appendChild(this.createTextNode(d[0]));for(var e,f,g=1,h=d.length;g<h;g++)e=d[g],f=e.indexOf("}"),0<f?(this.writeNode("ogc:PropertyName",
{property:e.substring(0,f)},c),c.appendChild(this.createTextNode(e.substring(++f)))):c.appendChild(this.createTextNode("${"+e));return c},StyledLayerDescriptor:function(a){var b=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});b.setAttribute("xmlns:ogc",this.namespaces.ogc);b.setAttribute("xmlns:gml",this.namespaces.gml);a.name&&this.writeNode("Name",a.name,b);a.title&&this.writeNode("Title",a.title,b);a.description&&
this.writeNode("Abstract",a.description,b);if(OpenLayers.Util.isArray(a.namedLayers))for(var c=0,d=a.namedLayers.length;c<d;++c)this.writeNode("NamedLayer",a.namedLayers[c],b);else for(c in a.namedLayers)this.writeNode("NamedLayer",a.namedLayers[c],b);return b},Name:function(a){return this.createElementNSPlus("sld:Name",{value:a})},Title:function(a){return this.createElementNSPlus("sld:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("sld:Abstract",{value:a})},NamedLayer:function(a){var b=
this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",a.name,b);if(a.namedStyles)for(var c=0,d=a.namedStyles.length;c<d;++c)this.writeNode("NamedStyle",a.namedStyles[c],b);if(a.userStyles)for(c=0,d=a.userStyles.length;c<d;++c)this.writeNode("UserStyle",a.userStyles[c],b);return b},NamedStyle:function(a){var b=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",a,b);return b},UserStyle:function(a){var b=this.createElementNSPlus("sld:UserStyle");a.name&&this.writeNode("Name",
a.name,b);a.title&&this.writeNode("Title",a.title,b);a.description&&this.writeNode("Abstract",a.description,b);a.isDefault&&this.writeNode("IsDefault",a.isDefault,b);if(this.multipleSymbolizers&&a.rules){for(var c={0:[]},d=[0],e,f,g,h,k,l=0,m=a.rules.length;l<m;++l)if(e=a.rules[l],e.symbolizers){f={};for(var n=0,p=e.symbolizers.length;n<p;++n)g=e.symbolizers[n],h=g.zIndex,h in f||(k=e.clone(),k.symbolizers=[],f[h]=k),f[h].symbolizers.push(g.clone());for(h in f)h in c||(d.push(h),c[h]=[]),c[h].push(f[h])}else c[0].push(e.clone());
d.sort();l=0;for(m=d.length;l<m;++l)e=c[d[l]],0<e.length&&(k=a.clone(),k.rules=c[d[l]],this.writeNode("FeatureTypeStyle",k,b))}else this.writeNode("FeatureTypeStyle",a,b);return b},IsDefault:function(a){return this.createElementNSPlus("sld:IsDefault",{value:a?"1":"0"})},FeatureTypeStyle:function(a){for(var b=this.createElementNSPlus("sld:FeatureTypeStyle"),c=0,d=a.rules.length;c<d;++c)this.writeNode("Rule",a.rules[c],b);return b},Rule:function(a){var b=this.createElementNSPlus("sld:Rule");a.name&&
this.writeNode("Name",a.name,b);a.title&&this.writeNode("Title",a.title,b);a.description&&this.writeNode("Abstract",a.description,b);a.elseFilter?this.writeNode("ElseFilter",null,b):a.filter&&this.writeNode("ogc:Filter",a.filter,b);void 0!=a.minScaleDenominator&&this.writeNode("MinScaleDenominator",a.minScaleDenominator,b);void 0!=a.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",a.maxScaleDenominator,b);var c,d;if(this.multipleSymbolizers&&a.symbolizers)for(var e=0,f=a.symbolizers.length;e<
f;++e)d=a.symbolizers[e],c=d.CLASS_NAME.split(".").pop(),this.writeNode(c+"Symbolizer",d,b);else for(var f=OpenLayers.Style.SYMBOLIZER_PREFIXES,e=0,g=f.length;e<g;++e)c=f[e],(d=a.symbolizer[c])&&this.writeNode(c+"Symbolizer",d,b);return b},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("sld:MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("sld:MaxScaleDenominator",
{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",a,b);return b},Stroke:function(a){var b=this.createElementNSPlus("sld:Stroke");void 0!=a.strokeColor&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b);void 0!=a.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b);void 0!=a.strokeWidth&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b);void 0!=a.strokeDashstyle&&"solid"!==
a.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeDashstyle"},b);void 0!=a.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeLinecap"},b);return b},CssParameter:function(a){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("sld:TextSymbolizer");null!=a.label&&this.writeNode("Label",a.label,b);null==a.fontFamily&&null==a.fontSize&&
null==a.fontWeight&&null==a.fontStyle||this.writeNode("Font",a,b);null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign&&null==a.labelXOffset&&null==a.labelYOffset&&null==a.labelRotation&&null==a.labelPerpendicularOffset||this.writeNode("LabelPlacement",a,b);null==a.haloRadius&&null==a.haloColor&&null==a.haloOpacity||this.writeNode("Halo",a,b);null==a.fontColor&&null==a.fontOpacity||this.writeNode("Fill",{fillColor:a.fontColor,fillOpacity:a.fontOpacity},b);return b},LabelPlacement:function(a){var b=
this.createElementNSPlus("sld:LabelPlacement");null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign&&null==a.labelXOffset&&null==a.labelYOffset&&null==a.labelRotation||null!=a.labelPerpendicularOffset||this.writeNode("PointPlacement",a,b);null!=a.labelPerpendicularOffset&&this.writeNode("LinePlacement",a,b);return b},LinePlacement:function(a){var b=this.createElementNSPlus("sld:LinePlacement");this.writeNode("PerpendicularOffset",a.labelPerpendicularOffset,b);return b},PerpendicularOffset:function(a){return this.createElementNSPlus("sld:PerpendicularOffset",
{value:a})},PointPlacement:function(a){var b=this.createElementNSPlus("sld:PointPlacement");null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign||this.writeNode("AnchorPoint",a,b);null==a.labelXOffset&&null==a.labelYOffset||this.writeNode("Displacement",a,b);null!=a.labelRotation&&this.writeNode("Rotation",a.labelRotation,b);return b},AnchorPoint:function(a){var b=this.createElementNSPlus("sld:AnchorPoint"),c=a.labelAnchorPointX,d=a.labelAnchorPointY;null!=c&&this.writeNode("AnchorPointX",
c,b);null!=d&&this.writeNode("AnchorPointY",d,b);if(null==c&&null==d){var e=a.labelAlign.substr(0,1);a=a.labelAlign.substr(1,1);"l"===e?c=0:"c"===e?c=0.5:"r"===e&&(c=1);"b"===a?d=0:"m"===a?d=0.5:"t"===a&&(d=1);this.writeNode("AnchorPointX",c,b);this.writeNode("AnchorPointY",d,b)}return b},AnchorPointX:function(a){return this.createElementNSPlus("sld:AnchorPointX",{value:a})},AnchorPointY:function(a){return this.createElementNSPlus("sld:AnchorPointY",{value:a})},Displacement:function(a){var b=this.createElementNSPlus("sld:Displacement");
null!=a.labelXOffset&&this.writeNode("DisplacementX",a.labelXOffset,b);null!=a.labelYOffset&&this.writeNode("DisplacementY",a.labelYOffset,b);return b},DisplacementX:function(a){return this.createElementNSPlus("sld:DisplacementX",{value:a})},DisplacementY:function(a){return this.createElementNSPlus("sld:DisplacementY",{value:a})},Font:function(a){var b=this.createElementNSPlus("sld:Font");a.fontFamily&&this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b);a.fontSize&&this.writeNode("CssParameter",
{symbolizer:a,key:"fontSize"},b);a.fontWeight&&this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b);a.fontStyle&&this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b);return b},Label:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Label",a)},Halo:function(a){var b=this.createElementNSPlus("sld:Halo");a.haloRadius&&this.writeNode("Radius",a.haloRadius,b);(a.haloColor||a.haloOpacity)&&this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b);
return b},Radius:function(a){return this.createElementNSPlus("sld:Radius",{value:a})},RasterSymbolizer:function(a){var b=this.createElementNSPlus("sld:RasterSymbolizer");a.geometry&&this.writeNode("Geometry",a.geometry,b);a.opacity&&this.writeNode("Opacity",a.opacity,b);a.colorMap&&this.writeNode("ColorMap",a.colorMap,b);return b},Geometry:function(a){var b=this.createElementNSPlus("sld:Geometry");a.property&&this.writeNode("ogc:PropertyName",a,b);return b},ColorMap:function(a){for(var b=this.createElementNSPlus("sld:ColorMap"),
c=0,d=a.length;c<d;++c)this.writeNode("ColorMapEntry",a[c],b);return b},ColorMapEntry:function(a){var b=this.createElementNSPlus("sld:ColorMapEntry");b.setAttribute("color",a.color);void 0!==a.opacity&&b.setAttribute("opacity",parseFloat(a.opacity));void 0!==a.quantity&&b.setAttribute("quantity",parseFloat(a.quantity));void 0!==a.label&&b.setAttribute("label",a.label);return b},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("sld:PolygonSymbolizer");!1!==a.fill&&this.writeNode("Fill",
a,b);!1!==a.stroke&&this.writeNode("Stroke",a,b);return b},Fill:function(a){var b=this.createElementNSPlus("sld:Fill");a.fillColor&&this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b);null!=a.fillOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b);return b},PointSymbolizer:function(a){var b=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",a,b);return b},Graphic:function(a){var b=this.createElementNSPlus("sld:Graphic");void 0!=a.externalGraphic?
this.writeNode("ExternalGraphic",a,b):this.writeNode("Mark",a,b);void 0!=a.graphicOpacity&&this.writeNode("Opacity",a.graphicOpacity,b);void 0!=a.pointRadius?this.writeNode("Size",2*a.pointRadius,b):void 0!=a.graphicWidth&&this.writeNode("Size",a.graphicWidth,b);void 0!=a.rotation&&this.writeNode("Rotation",a.rotation,b);return b},ExternalGraphic:function(a){var b=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);a=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);
this.writeNode("Format",a,b);return b},Mark:function(a){var b=this.createElementNSPlus("sld:Mark");a.graphicName&&this.writeNode("WellKnownName",a.graphicName,b);!1!==a.fill&&this.writeNode("Fill",a,b);!1!==a.stroke&&this.writeNode("Stroke",a,b);return b},WellKnownName:function(a){return this.createElementNSPlus("sld:WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("sld:Opacity",{value:a})},Size:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Size",
a)},Rotation:function(a){return this.createElementNSPlus("sld:Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("sld:Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c);1.3<=parseFloat(c.VERSION)&&!c.EXCEPTIONS&&(c.EXCEPTIONS="INIMAGE");e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));
!this.noMagic&&(this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase())&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(a){null==a&&(a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},reverseAxisOrder:function(){var a=this.projection.getCode();return 1.3<=parseFloat(this.params.VERSION)&&
!!(this.yx[a]||OpenLayers.Projection.defaults[a]&&OpenLayers.Projection.defaults[a].yx)},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize(),c={},d=this.reverseAxisOrder();c.BBOX=this.encodeBBOX?a.toBBOX(null,d):a.toArray(d);c.WIDTH=b.w;c.HEIGHT=b.h;return this.getFullRequestString(c)},mergeNewParams:function(a){a=[OpenLayers.Util.upperCaseObject(a)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},getFullRequestString:function(a,b){var c=this.map.getProjectionObject(),
c=this.projection&&this.projection.equals(c)?this.projection.getCode():c.getCode(),c="none"==c?null:c;1.3<=parseFloat(this.params.VERSION)?this.params.CRS=c:this.params.SRS=c;"boolean"==typeof this.params.TRANSPARENT&&(a.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1E4*this.map.getScale())/1E4,d=Math.round(a.left/b);a=-Math.round(a.top/b);return this.getFullRequestString({t:a,l:d,s:c})},calculateGridLayout:function(a,
b,c){b=c*this.tileSize.w;c*=this.tileSize.h;return{tilelon:b,tilelat:c,startcol:Math.floor(a.left/b)-this.buffer,startrow:Math.floor(a.top/c)+this.buffer}},getTileBoundsForGridIndex:function(a,b){this.getTileOrigin();var c=this.gridLayout,d=c.tilelon,e=c.tilelat,f=(c.startcol+b)*d,c=(c.startrow-a)*e;return new OpenLayers.Bounds(f,c,f+d,c+e)},clone:function(a){null==a&&(a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions()));a=OpenLayers.Layer.Grid.prototype.clone.apply(this,
[a]);null!=this.tileSize&&(a.tileSize=this.tileSize.clone());a.grid=[];return a},getTileBounds:function(a){var b=this.getResolution(),c=b*this.tileSize.w,b=b*this.tileSize.h,d=this.getLonLatFromViewPortPx(a);a=c*Math.floor(d.lon/c);d=b*Math.floor(d.lat/b);return new OpenLayers.Bounds(a,d,a+c,d+b)},CLASS_NAME:"OpenLayers.Layer.KaMap"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_sld_MinScaleDenominator:function(a,b){var c=parseFloat(this.getChildValue(b));0<c&&(a.maxScale=c)},read_sld_MaxScaleDenominator:function(a,b){a.minScale=parseFloat(this.getChildValue(b))},read_wmc_SRS:function(a,b){"srs"in
a||(a.srs={});a.srs[this.getChildValue(b)]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.maxScale){var c=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");c.appendChild(this.createTextNode(a.maxScale.toPrecision(16)));b.appendChild(c)}a.minScale&&(c=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator"),c.appendChild(this.createTextNode(a.minScale.toPrecision(16))),b.appendChild(c));if(a.srs)for(var d in a.srs)b.appendChild(this.createElementDefaultNS("SRS",
d));b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a));b.appendChild(this.write_wmc_LayerExtension(a));return b},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"});OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(a,b){OpenLayers.Util.applyDefaults(b,this.options);var c={};this.readChildNodes(a,c);return c},readers:{xls:{XLS:function(a,b){b.version=a.getAttribute("version");
this.readChildNodes(a,b)},Response:function(a,b){this.readChildNodes(a,b)},GeocodeResponse:function(a,b){b.responseLists=[];this.readChildNodes(a,b)},GeocodeResponseList:function(a,b){var c={features:[],numberOfGeocodedAddresses:parseInt(a.getAttribute("numberOfGeocodedAddresses"))};b.responseLists.push(c);this.readChildNodes(a,c)},GeocodedAddress:function(a,b){var c=new OpenLayers.Feature.Vector;b.features.push(c);this.readChildNodes(a,c);c.geometry=c.components[0]},GeocodeMatchCode:function(a,b){b.attributes.matchCode=
{accuracy:parseFloat(a.getAttribute("accuracy")),matchType:a.getAttribute("matchType")}},Address:function(a,b){var c={countryCode:a.getAttribute("countryCode"),addressee:a.getAttribute("addressee"),street:[],place:[]};b.attributes.address=c;this.readChildNodes(a,c)},freeFormAddress:function(a,b){b.freeFormAddress=this.getChildValue(a)},StreetAddress:function(a,b){this.readChildNodes(a,b)},Building:function(a,b){b.building={number:a.getAttribute("number"),subdivision:a.getAttribute("subdivision"),
buildingName:a.getAttribute("buildingName")}},Street:function(a,b){b.street.push(this.getChildValue(a))},Place:function(a,b){b.place[a.getAttribute("type")]=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(a){return this.writers.xls.XLS.apply(this,[a])},writers:{xls:{XLS:function(a){var b=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});
this.writeNode("RequestHeader",a.header,b);this.writeNode("Request",a,b);return b},RequestHeader:function(a){return this.createElementNSPlus("xls:RequestHeader")},Request:function(a){var b=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:a.requestID||"",version:this.VERSION}});this.writeNode("GeocodeRequest",a.addresses,b);return b},GeocodeRequest:function(a){for(var b=this.createElementNSPlus("xls:GeocodeRequest"),c=0,d=a.length;c<d;c++)this.writeNode("Address",
a[c],b);return b},Address:function(a){var b=this.createElementNSPlus("xls:Address",{attributes:{countryCode:a.countryCode}});a.freeFormAddress?this.writeNode("freeFormAddress",a.freeFormAddress,b):(a.street&&this.writeNode("StreetAddress",a,b),a.municipality&&this.writeNode("Municipality",a.municipality,b),a.countrySubdivision&&this.writeNode("CountrySubdivision",a.countrySubdivision,b),a.postalCode&&this.writeNode("PostalCode",a.postalCode,b));return b},freeFormAddress:function(a){return this.createElementNSPlus("freeFormAddress",
{value:a})},StreetAddress:function(a){var b=this.createElementNSPlus("xls:StreetAddress");a.building&&this.writeNode(b,"Building",a.building);a=a.street;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=0,d=a.length;c<d;c++)this.writeNode("Street",a[c],b);return b},Building:function(a){return this.createElementNSPlus("xls:Building",{attributes:{number:a.number,subdivision:a.subdivision,buildingName:a.buildingName}})},Street:function(a){return this.createElementNSPlus("xls:Street",{value:a})},Municipality:function(a){return this.createElementNSPlus("xls:Place",
{attributes:{type:"Municipality"},value:a})},CountrySubdivision:function(a){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:a})},PostalCode:function(a){return this.createElementNSPlus("xls:PostalCode",{value:a})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"});OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"});OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0;OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15E3,translationParameters:null,symbolMetrics:null,initialize:function(a){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG",
"1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(a,b,c){a+=c?0:this.translationParameters.x;b+=c?0:this.translationParameters.y;return a>=-this.MAX_PIXEL&&a<=this.MAX_PIXEL&&b>=-this.MAX_PIXEL&&b<=this.MAX_PIXEL},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=-a.left/d,d=a.top/d;if(b)return this.left=e,this.top=d,this.rendererRoot.setAttributeNS(null,
"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0;(e=this.translate(e-this.left+this.xOffset,d-this.top))||this.setExtent(a,!0);return c&&e},translate:function(a,b){if(this.inValidRange(a,b,!0)){var c="";if(a||b)c="translate("+a+","+b+")";this.root.setAttributeNS(null,"transform",c);this.translationParameters={x:a,y:b};return!0}return!1},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);
this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case "OpenLayers.Geometry.Point":c=b.externalGraphic?"image":this.isComplexSymbol(b.graphicName)?"svg":"circle";break;case "OpenLayers.Geometry.Rectangle":c="rect";break;case "OpenLayers.Geometry.LineString":c="polyline";break;case "OpenLayers.Geometry.LinearRing":c="polygon";break;case "OpenLayers.Geometry.Polygon":case "OpenLayers.Geometry.Curve":c="path"}return c},setStyle:function(a,
b,c){b=b||a._style;c=c||a._options;var d=b.title||b.graphicTitle;if(d){a.setAttributeNS(null,"title",d);var e=a.getElementsByTagName("title");0<e.length?e[0].firstChild.textContent=d:(e=this.nodeFactory(null,"title"),e.textContent=d,a.appendChild(e))}var e=parseFloat(a.getAttributeNS(null,"r")),d=1,f;if("OpenLayers.Geometry.Point"==a._geometryClass&&e){a.style.visibility="";if(!1===b.graphic)a.style.visibility="hidden";else if(b.externalGraphic){f=this.getPosition(a);b.graphicWidth&&b.graphicHeight&&
a.setAttributeNS(null,"preserveAspectRatio","none");var e=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth,e=e?e:2*b.pointRadius,g=g?g:2*b.pointRadius,h=void 0!=b.graphicYOffset?b.graphicYOffset:-(0.5*g),k=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,"x",(f.x+(void 0!=b.graphicXOffset?b.graphicXOffset:-(0.5*e))).toFixed());a.setAttributeNS(null,"y",(f.y+h).toFixed());a.setAttributeNS(null,"width",e);a.setAttributeNS(null,"height",g);a.setAttributeNS(this.xlinkns,"xlink:href",
b.externalGraphic);a.setAttributeNS(null,"style","opacity: "+k);a.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(b.graphicName)){var e=3*b.pointRadius,g=2*e,l=this.importSymbol(b.graphicName);f=this.getPosition(a);d=3*this.symbolMetrics[l.id][0]/g;h=a.parentNode;k=a.nextSibling;h&&h.removeChild(a);a.firstChild&&a.removeChild(a.firstChild);a.appendChild(l.firstChild.cloneNode(!0));a.setAttributeNS(null,"viewBox",l.getAttributeNS(null,"viewBox"));a.setAttributeNS(null,"width",
g);a.setAttributeNS(null,"height",g);a.setAttributeNS(null,"x",f.x-e);a.setAttributeNS(null,"y",f.y-e);k?h.insertBefore(a,k):h&&h.appendChild(a)}else a.setAttributeNS(null,"r",b.pointRadius);e=b.rotation;void 0===e&&void 0===a._rotation||!f||(a._rotation=e,e|=0,"svg"!==a.nodeName?a.setAttributeNS(null,"transform","rotate("+e+" "+f.x+" "+f.y+")"):(f=this.symbolMetrics[l.id],a.firstChild.setAttributeNS(null,"transform","rotate("+e+" "+f[1]+" "+f[2]+")")))}c.isFilled?(a.setAttributeNS(null,"fill",b.fillColor),
a.setAttributeNS(null,"fill-opacity",b.fillOpacity)):a.setAttributeNS(null,"fill","none");c.isStroked?(a.setAttributeNS(null,"stroke",b.strokeColor),a.setAttributeNS(null,"stroke-opacity",b.strokeOpacity),a.setAttributeNS(null,"stroke-width",b.strokeWidth*d),a.setAttributeNS(null,"stroke-linecap",b.strokeLinecap||"round"),a.setAttributeNS(null,"stroke-linejoin","round"),b.strokeDashstyle&&a.setAttributeNS(null,"stroke-dasharray",this.dashStyle(b,d))):a.setAttributeNS(null,"stroke","none");b.pointerEvents&&
a.setAttributeNS(null,"pointer-events",b.pointerEvents);null!=b.cursor&&a.setAttributeNS(null,"cursor",b.cursor);return a},dashStyle:function(a,b){var c=a.strokeWidth*b,d=a.strokeDashstyle;switch(d){case "solid":return"none";case "dot":return[1,4*c].join();case "dash":return[4*c,4*c].join();case "dashdot":return[4*c,4*c,1,4*c].join();case "longdash":return[8*c,4*c].join();case "longdashdot":return[8*c,4*c,1,4*c].join();default:return OpenLayers.String.trim(d).replace(/\s+/g,",")}},createNode:function(a,
b){var c=document.createElementNS(this.xmlns,a);b&&c.setAttributeNS(null,"id",b);return c},nodeTypeCompare:function(a,b){return b==a.nodeName},createRenderRoot:function(){var a=this.nodeFactory(this.container.id+"_svgRoot","svg");a.style.display="block";return a},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,
b,1)},drawCircle:function(a,b,c){var d=this.getResolution(),e=(b.x-this.featureDx)/d+this.left;b=this.top-b.y/d;return this.inValidRange(e,b)?(a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",b),a.setAttributeNS(null,"r",c),a):!1},drawLineString:function(a,b){var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,"points",c.path),c.complete?a:null):!1},drawLinearRing:function(a,b){var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,
"points",c.path),c.complete?a:null):!1},drawPolygon:function(a,b){for(var c="",d=!0,e=!0,f,g,h=0,k=b.components.length;h<k;h++)c+=" M",f=this.getComponentsString(b.components[h].components," "),(g=f.path)?(c+=" "+g,e=f.complete&&e):d=!1;return d?(a.setAttributeNS(null,"d",c+" z"),a.setAttributeNS(null,"fill-rule","evenodd"),e?a:null):!1},drawRectangle:function(a,b){var c=this.getResolution(),d=(b.x-this.featureDx)/c+this.left,e=this.top-b.y/c;return this.inValidRange(d,e)?(a.setAttributeNS(null,"x",
d),a.setAttributeNS(null,"y",e),a.setAttributeNS(null,"width",b.width/c),a.setAttributeNS(null,"height",b.height/c),a):!1},drawText:function(a,b,c){var d=!!b.labelOutlineWidth;if(d){var e=OpenLayers.Util.extend({},b);e.fontColor=e.labelOutlineColor;e.fontStrokeColor=e.labelOutlineColor;e.fontStrokeWidth=b.labelOutlineWidth;b.labelOutlineOpacity&&(e.fontOpacity=b.labelOutlineOpacity);delete e.labelOutlineWidth;this.drawText(a,e,c)}var f=this.getResolution(),e=(c.x-this.featureDx)/f+this.left,g=c.y/
f-this.top,d=d?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,f=this.nodeFactory(a+d,"text");f.setAttributeNS(null,"x",e);f.setAttributeNS(null,"y",-g);b.fontColor&&f.setAttributeNS(null,"fill",b.fontColor);b.fontStrokeColor&&f.setAttributeNS(null,"stroke",b.fontStrokeColor);b.fontStrokeWidth&&f.setAttributeNS(null,"stroke-width",b.fontStrokeWidth);b.fontOpacity&&f.setAttributeNS(null,"opacity",b.fontOpacity);b.fontFamily&&f.setAttributeNS(null,"font-family",b.fontFamily);b.fontSize&&f.setAttributeNS(null,
"font-size",b.fontSize);b.fontWeight&&f.setAttributeNS(null,"font-weight",b.fontWeight);b.fontStyle&&f.setAttributeNS(null,"font-style",b.fontStyle);!0===b.labelSelect?(f.setAttributeNS(null,"pointer-events","visible"),f._featureId=a):f.setAttributeNS(null,"pointer-events","none");g=b.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;f.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[g[0]]||"middle");!0===OpenLayers.IS_GECKO&&f.setAttributeNS(null,"dominant-baseline",
OpenLayers.Renderer.SVG.LABEL_ALIGN[g[1]]||"central");for(var h=b.label.split("\n"),k=h.length;f.childNodes.length>k;)f.removeChild(f.lastChild);for(var l=0;l<k;l++){var m=this.nodeFactory(a+d+"_tspan_"+l,"tspan");!0===b.labelSelect&&(m._featureId=a,m._geometry=c,m._geometryClass=c.CLASS_NAME);!1===OpenLayers.IS_GECKO&&m.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[g[1]]||"-35%");m.setAttribute("x",e);if(0==l){var n=OpenLayers.Renderer.SVG.LABEL_VFACTOR[g[1]];null==n&&
(n=-0.5);m.setAttribute("dy",n*(k-1)+"em")}else m.setAttribute("dy","1em");m.textContent=""===h[l]?" ":h[l];m.parentNode||f.appendChild(m)}f.parentNode||this.textRoot.appendChild(f)},getComponentsString:function(a,b){for(var c=[],d=!0,e=a.length,f=[],g,h=0;h<e;h++)g=a[h],c.push(g),(g=this.getShortString(g))?f.push(g):(0<h&&this.getShortString(a[h-1])&&f.push(this.clipLine(a[h],a[h-1])),h<e-1&&this.getShortString(a[h+1])&&f.push(this.clipLine(a[h],a[h+1])),d=!1);return{path:f.join(b||","),complete:d}},
clipLine:function(a,b){if(b.equals(a))return"";var c=this.getResolution(),d=this.MAX_PIXEL-this.translationParameters.x,e=this.MAX_PIXEL-this.translationParameters.y,f=(b.x-this.featureDx)/c+this.left,g=this.top-b.y/c,h=(a.x-this.featureDx)/c+this.left,c=this.top-a.y/c,k;if(h<-d||h>d)k=(c-g)/(h-f),h=0>h?-d:d,c=g+(h-f)*k;if(c<-e||c>e)k=(h-f)/(c-g),c=0>c?-e:e,h=f+(c-g)*k;return h+","+c},getShortString:function(a){var b=this.getResolution(),c=(a.x-this.featureDx)/b+this.left;a=this.top-a.y/b;return this.inValidRange(c,
a)?c+","+a:!1},getPosition:function(a){return{x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))}},importSymbol:function(a){this.defs||(this.defs=this.createDefs());var b=this.container.id+"-"+a,c=document.getElementById(b);if(null!=c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw Error(a+" is not a valid symbol name");a=this.nodeFactory(b,"symbol");var e=this.nodeFactory(null,"polygon");a.appendChild(e);for(var c=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,
0,0),f=[],g,h,k=0;k<d.length;k+=2)g=d[k],h=d[k+1],c.left=Math.min(c.left,g),c.bottom=Math.min(c.bottom,h),c.right=Math.max(c.right,g),c.top=Math.max(c.top,h),f.push(g,",",h);e.setAttributeNS(null,"points",f.join(" "));d=c.getWidth();e=c.getHeight();a.setAttributeNS(null,"viewBox",[c.left-d,c.bottom-e,3*d,3*e].join(" "));this.symbolMetrics[b]=[Math.max(d,e),c.getCenterLonLat().lon,c.getCenterLonLat().lat];this.defs.appendChild(a);return a},getFeatureIdFromEvent:function(a){var b=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,
arguments);b||(b=a.target,b=b.parentNode&&b!=this.rendererRoot?b.parentNode._featureId:void 0);return b},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(a){OpenLayers.Event.preventDefault(a)};OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(a,b){var c=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);"0.3.0"===c&&(c=this.defaultVersion);return c},toContext:function(a){var b={};"OpenLayers.Map"==a.CLASS_NAME&&(b.bounds=a.getExtent(),b.maxExtent=a.maxExtent,b.projection=a.projection,b.size=a.getSize(),b.layers=a.layers);return b},CLASS_NAME:"OpenLayers.Format.OWSContext"});OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",
defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(a){if(a.layersContext)for(var b=0,c=a.layersContext.length;b<c;b++){var d=
a.layersContext[b],e=[],f=a.title||"";a.metadata&&a.metadata.nestingPath&&(e=a.metadata.nestingPath.slice());""!=f&&e.push(f);d.metadata.nestingPath=e;d.layersContext&&this.setNestingPath(d)}},decomposeNestingPath:function(a){var b=[];if(OpenLayers.Util.isArray(a)){for(a=a.slice();0<a.length;)b.push(a.slice()),a.pop();b.reverse()}return b},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,
b);this.setNestingPath({layersContext:b.layersContext});a=[];this.processLayer(a,b);delete b.layersContext;b.layersContext=a;return b},processLayer:function(a,b){if(b.layersContext)for(var c=0,d=b.layersContext.length;c<d;c++){var e=b.layersContext[c];a.push(e);e.layersContext&&this.processLayer(a,e)}},write:function(a,b){this.nestingLayerLookup={};b=b||{};OpenLayers.Util.applyDefaults(b,a);var c=this.writeNode("OWSContext",b);this.nestingLayerLookup=null;this.setAttributeNS(c,this.namespaces.xsi,
"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},readers:{kml:{Document:function(a,b){b.features=(new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0})).read(a)}},owc:{OWSContext:function(a,b){this.readChildNodes(a,b)},General:function(a,b){this.readChildNodes(a,b)},ResourceList:function(a,b){this.readChildNodes(a,b)},Layer:function(a,b){var c={metadata:{},visibility:"1"!=a.getAttribute("hidden"),queryable:"1"==a.getAttribute("queryable"),
opacity:null!=a.getAttribute("opacity")?parseFloat(a.getAttribute("opacity")):null,name:a.getAttribute("name"),categoryLayer:null==a.getAttribute("name"),formats:[],styles:[]};b.layersContext||(b.layersContext=[]);b.layersContext.push(c);this.readChildNodes(a,c)},InlineGeometry:function(a,b){b.features=[];var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember"),d;1<=c.length&&(d=c[0]);d&&d.firstChild&&(c=d.firstChild.nextSibling?d.firstChild.nextSibling:d.firstChild,this.setNamespace("feature",
c.namespaceURI),this.featureType=c.localName||c.nodeName.split(":").pop(),this.readChildNodes(a,b))},Server:function(a,b){if(!b.service&&!b.version||b.service!=OpenLayers.Format.Context.serviceTypes.WMS)b.service=a.getAttribute("service"),b.version=a.getAttribute("version"),this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a);this.readChildNodes(a,b)},Title:function(a,b){b.title=this.getChildValue(a);this.readChildNodes(a,b)},StyleList:function(a,b){this.readChildNodes(a,b.styles)},
Style:function(a,b){var c={};b.push(c);this.readChildNodes(a,c)},LegendURL:function(a,b){var c={};b.legend=c;this.readChildNodes(a,c)},OnlineResource:function(a,b){b.url=this.getAttributeNS(a,this.namespaces.xlink,"href");this.readChildNodes(a,b)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(a){var b=
this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:a.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});this.writeNode("General",a,b);this.writeNode("ResourceList",a,b);return b},General:function(a){var b=this.createElementNSPlus("General");this.writeNode("ows:BoundingBox",a,b);this.writeNode("ows:Title",a.title||"OpenLayers OWSContext",b);return b},ResourceList:function(a){for(var b=this.createElementNSPlus("ResourceList"),c=0,d=a.layers.length;c<d;c++){var e=
a.layers[c],f=this.decomposeNestingPath(e.metadata.nestingPath);this.writeNode("_Layer",{layer:e,subPaths:f},b)}return b},Server:function(a){var b=this.createElementNSPlus("Server",{attributes:{version:a.version,service:a.service}});this.writeNode("OnlineResource",a,b);return b},OnlineResource:function(a){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":a.url}})},InlineGeometry:function(a){var b=this.createElementNSPlus("InlineGeometry"),c=a.getDataExtent();null!==c&&this.writeNode("gml:boundedBy",
c,b);for(var c=0,d=a.features.length;c<d;c++)this.writeNode("gml:featureMember",a.features[c],b);return b},StyleList:function(a){for(var b=this.createElementNSPlus("StyleList"),c=0,d=a.length;c<d;c++)this.writeNode("Style",a[c],b);return b},Style:function(a){var b=this.createElementNSPlus("Style");this.writeNode("Name",a,b);this.writeNode("Title",a,b);a.legend&&this.writeNode("LegendURL",a,b);return b},Name:function(a){return this.createElementNSPlus("Name",{value:a.name})},Title:function(a){return this.createElementNSPlus("Title",
{value:a.title})},LegendURL:function(a){var b=this.createElementNSPlus("LegendURL");this.writeNode("OnlineResource",a.legend,b);return b},_WMS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.params.LAYERS,queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1",opacity:a.hasOwnProperty("opacity")?a.opacity:null}});this.writeNode("ows:Title",a.name,b);this.writeNode("ows:OutputFormat",a.params.FORMAT,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,
version:a.params.VERSION,url:a.url},b);a.metadata.styles&&0<a.metadata.styles.length&&this.writeNode("StyleList",a.metadata.styles,b);return b},_Layer:function(a){var b,c,d;b=a.layer;c=a.subPaths;d=null;0<c.length?(b=c[0].join("/"),c=b.lastIndexOf("/"),d=this.nestingLayerLookup[b],c=0<c?b.substring(c+1,b.length):b,d||(d=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",c,d),this.nestingLayerLookup[b]=d),a.subPaths.shift(),this.writeNode("_Layer",a,d)):(b instanceof OpenLayers.Layer.WMS?
d=this.writeNode("_WMS",b):b instanceof OpenLayers.Layer.Vector&&(b.protocol instanceof OpenLayers.Protocol.WFS.v1?d=this.writeNode("_WFS",b):b.protocol instanceof OpenLayers.Protocol.HTTP?b.protocol.format instanceof OpenLayers.Format.GML?(b.protocol.format.version="2.1.2",d=this.writeNode("_GML",b)):b.protocol.format instanceof OpenLayers.Format.KML&&(b.protocol.format.version="2.2",d=this.writeNode("_KML",b)):(this.setNamespace("feature",this.featureNS),d=this.writeNode("_InlineGeometry",b))),
b.options.maxScale&&this.writeNode("sld:MinScaleDenominator",b.options.maxScale,d),b.options.minScale&&this.writeNode("sld:MaxScaleDenominator",b.options.minScale,d),this.nestingLayerLookup[b.name]=d);return d},_WFS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.protocol.featurePrefix+":"+a.protocol.featureType,hidden:a.visibility?"0":"1"}});this.writeNode("ows:Title",a.name,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:a.protocol.version,
url:a.protocol.url},b);return b},_InlineGeometry:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:a.visibility?"0":"1"}});this.writeNode("ows:Title",a.name,b);this.writeNode("InlineGeometry",a,b);return b},_GML:function(a){var b=this.createElementNSPlus("Layer");this.writeNode("ows:Title",a.name,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:a.protocol.url,version:a.protocol.format.version},b);return b},_KML:function(a){var b=
this.createElementNSPlus("Layer");this.writeNode("ows:Title",a.name,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:a.protocol.format.version,url:a.protocol.url},b);return b}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(a){var b=this.createElementNSPlus("gml:boundedBy");this.writeNode("gml:Box",a,b);return b}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,
feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,
keepInMap:!1,closeOnMove:!1,map:null,initialize:function(a,b,c,d,e,f){null==a&&(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=a;this.lonlat=b;this.contentSize=null!=c?c:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=d&&(this.contentHTML=d);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;
this.groupDiv=OpenLayers.Util.createDiv(this.id+"_GroupDiv",null,null,null,"relative",null,"hidden");a=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);e&&this.addCloseBox(f);this.registerEvents()},destroy:function(){this.border=this.opacity=this.backgroundColor=this.contentHTML=this.size=this.lonlat=this.id=
null;this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide);this.events.destroy();this.events=null;this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv));this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;null!=this.map&&this.map.removePopup(this);this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null},draw:function(a){null==a&&null!=this.lonlat&&null!=
this.map&&(a=this.map.getLayerPxFromLonLat(this.lonlat));this.closeOnMove&&this.map.events.register("movestart",this,this.hide);this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var a=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");"hidden"!=a&&(this.contentDiv._oldOverflow=a,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var a=this.contentDiv._oldOverflow;
a&&(this.contentDiv.style.overflow=a,this.contentDiv._oldOverflow=null)}));this.moveTo(a);this.autoSize||this.size||this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();this.panMapIfOutOfView&&this.panIntoView();return this.div},updatePosition:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);a&&this.moveTo(a)}},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=
a.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="";this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(a){this.size=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;this.fixPadding();c+=this.padding.left+this.padding.right;d+=this.padding.top+this.padding.bottom;if(this.closeDiv)var e=parseInt(this.closeDiv.style.width),
c=c+(e+b.right);this.size.w+=c;this.size.h+=d;"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=b.left+b.right,this.contentSize.h+=b.bottom+b.top);null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px");null!=this.contentDiv&&(this.contentDiv.style.width=a.w+"px",this.contentDiv.style.height=a.h+"px")},updateSize:function(){var a="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",b=this.map?this.map.div:document.body,c=OpenLayers.Util.getRenderedDimensions(a,
null,{displayClass:this.displayClass,containerElement:b}),d=this.getSafeContentSize(c),e=null;d.equals(c)?e=c:(c={w:d.w<c.w?d.w:null,h:d.h<c.h?d.h:null},c.w&&c.h?e=d:(a=OpenLayers.Util.getRenderedDimensions(a,c,{displayClass:this.contentDisplayClass,containerElement:b}),"hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&a.equals(d)&&(d=OpenLayers.Util.getScrollbarWidth(),c.w?a.h+=d:a.w+=d),e=this.getSafeContentSize(a)));this.setSize(e)},setBackgroundColor:function(a){void 0!=a&&(this.backgroundColor=
a);null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(a){void 0!=a&&(this.opacity=a);null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(a){void 0!=a&&(this.border=a);null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(a){null!=a&&(this.contentHTML=a);null!=this.contentDiv&&(null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML)&&(this.contentDiv.innerHTML=
this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var a=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},b=this.contentDiv.getElementsByTagName("img"),c=0,d=b.length;c<d;c++){var e=b[c];if(0==e.width||0==e.height)e._onImgLoad=OpenLayers.Function.bind(a,{popup:this,img:e}),
OpenLayers.Event.observe(e,"load",e._onImgLoad)}},getSafeContentSize:function(a){a=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;this.fixPadding();c+=this.padding.left+this.padding.right;d+=this.padding.top+this.padding.bottom;if(this.closeDiv)var e=parseInt(this.closeDiv.style.width),c=c+(e+b.right);this.minSize&&(a.w=Math.max(a.w,this.minSize.w-c),a.h=Math.max(a.h,this.minSize.h-d));this.maxSize&&(a.w=Math.min(a.w,this.maxSize.w-c),a.h=Math.min(a.h,this.maxSize.h-
d));if(this.map&&this.map.size){e=b=0;if(this.keepInMap&&!this.panMapIfOutOfView)switch(e=this.map.getPixelFromLonLat(this.lonlat),this.relativePosition){case "tr":b=e.x;e=this.map.size.h-e.y;break;case "tl":b=this.map.size.w-e.x;e=this.map.size.h-e.y;break;case "bl":b=this.map.size.w-e.x;e=e.y;break;case "br":b=e.x;e=e.y;break;default:b=e.x,e=this.map.size.h-e.y}d=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-d-e;a.w=Math.min(a.w,this.map.size.w-this.map.paddingForPopups.left-
this.map.paddingForPopups.right-c-b);a.h=Math.min(a.h,d)}return a},getContentDivPadding:function(){var a=this._contentDivPadding;a||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),this._contentDivPadding=a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,
"padding-top")),this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display=""));return a},addCloseBox:function(a){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17});this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px";this.closeDiv.style.top=b.top+"px";this.groupDiv.appendChild(this.closeDiv);a=a||function(a){this.hide();OpenLayers.Event.stop(a)};OpenLayers.Event.observe(this.closeDiv,
"touchend",OpenLayers.Function.bindAsEventListener(a,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(a,this))},panIntoView:function(){var a=this.map.getSize(),b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),c=b.clone();b.x<this.map.paddingForPopups.left?c.x=this.map.paddingForPopups.left:b.x+this.size.w>a.w-this.map.paddingForPopups.right&&(c.x=a.w-this.map.paddingForPopups.right-this.size.w);
b.y<this.map.paddingForPopups.top?c.y=this.map.paddingForPopups.top:b.y+this.size.h>a.h-this.map.paddingForPopups.bottom&&(c.y=a.h-this.map.paddingForPopups.bottom-this.size.h);this.map.pan(b.x-c.x,b.y-c.y)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(a){OpenLayers.Event.stop(a,!0)},
scope:this})},onmousedown:function(a){this.mousedown=!0;OpenLayers.Event.stop(a,!0)},onmousemove:function(a){this.mousedown&&OpenLayers.Event.stop(a,!0)},onmouseup:function(a){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(a,!0))},onclick:function(a){OpenLayers.Event.stop(a,!0)},onmouseout:function(a){this.mousedown=!1},ondblclick:function(a){OpenLayers.Event.stop(a,!0)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";
OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),
this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible");this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(a){var b=parseInt(Math.log(a)/Math.log(10)),b=Math.pow(10,b);a=parseInt(a/b);return(5<a?5:2<a?2:1)*b},update:function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*
a*c[b],e=1;!0===this.geodesic&&(e=(this.map.getGeodesicPixelSize().w||1E-6)*this.maxWidth/(d/c.km),d*=e);var f,g;1E5<d?(f=this.topOutUnits,g=this.bottomOutUnits):(f=this.topInUnits,g=this.bottomInUnits);var h=d/c[f],k=d/c[g],d=this.getBarLen(h),l=this.getBarLen(k),h=d/c[b]*c[f],k=l/c[b]*c[g],b=h/a/e,a=k/a/e;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(a)+"px",this.eBottom.innerHTML=l+" "+g);"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(b)+
"px",this.eTop.innerHTML=d+" "+f)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,c,d){this.url=a;this.size=b||{w:20,h:20};this.offset=c||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=d;a=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(a)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,
this.size,this.offset,this.calculateOffset)},setSize:function(a){null!=a&&(this.size=a);this.draw()},setUrl:function(a){null!=a&&(this.url=a);this.draw()},draw:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,
null,null,null,a)},moveTo:function(a){null!=a&&(this.px=a);null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(a){this.imageDiv.style.display=a?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(a,b){this.lonlat=a;var c=b?b:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=c:(this.icon.url=c.url,this.icon.size=c.size,this.icon.offset=c.offset,this.icon.calculateOffset=c.calculateOffset);this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;null!=this.icon&&(this.icon.destroy(),this.icon=null)},
draw:function(a){return this.icon.draw(a)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(a){null!=a&&null!=this.icon&&this.icon.moveTo(a);this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var a=!1;this.map&&(a=this.map.getExtent().containsLonLat(this.lonlat));return a},inflate:function(a){this.icon&&this.icon.setSize({w:this.icon.size.w*a,h:this.icon.size.h*a})},setOpacity:function(a){this.icon.setOpacity(a)},
setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(a,b,c,d){this.layername=c;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,{},d]);this.extension=this.format.split("/")[1].toLowerCase();this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(a){null==a&&(a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,
[a])},getURL:function(a){var b=this.getServerResolution(),c=this.maxExtent,d=this.tileSize,e=Math.round((a.left-c.left)/(b*d.w));a=Math.round((a.bottom-c.bottom)/(b*d.h));b=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoom();e=[this.layername,OpenLayers.Number.zeroPad(b,2),OpenLayers.Number.zeroPad(parseInt(e/1E6),3),OpenLayers.Number.zeroPad(parseInt(e/1E3)%1E3,3),OpenLayers.Number.zeroPad(parseInt(e)%1E3,3),OpenLayers.Number.zeroPad(parseInt(a/1E6),
3),OpenLayers.Number.zeroPad(parseInt(a/1E3)%1E3,3),OpenLayers.Number.zeroPad(parseInt(a)%1E3,3)+"."+this.extension].join("/");b=this.url;OpenLayers.Util.isArray(b)&&(b=this.selectUrl(e,b));b="/"==b.charAt(b.length-1)?b:b+"/";return b+e},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a)this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this});return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this}));return a},cacheFeatures:function(a){this.paging||(this.clearCache(),
this.features=a.features,this.pageNext(a))},clearCache:function(){if(this.features)for(var a=0;a<this.features.length;++a)this.features[a].destroy();this.num=this.features=null},pageCount:function(){return Math.ceil((this.features?this.features.length:0)/this.length)},pageNum:function(){return this.num},pageLength:function(a){a&&0<a&&(this.length=a);return this.length},pageNext:function(a){var b=!1;this.features&&(null===this.num&&(this.num=-1),b=this.page((this.num+1)*this.length,a));return b},pagePrevious:function(){var a=
!1;this.features&&(null===this.num&&(this.num=this.pageCount()),a=this.page((this.num-1)*this.length));return a},page:function(a,b){var c=!1;if(this.features&&0<=a&&a<this.features.length){var d=Math.floor(a/this.length);d!=this.num&&(this.paging=!0,c=this.features.slice(a,a+this.length),this.layer.removeFeatures(this.layer.features),this.num=d,b&&b.features?b.features=c:this.layer.addFeatures(c),this.paging=!1,c=!0)}return c},CLASS_NAME:"OpenLayers.Strategy.Paging"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(a,b){},onDrag:function(a,b){},onComplete:function(a,b){},onEnter:function(a){},onLeave:function(a){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer=a;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,
up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(a){this.handlers.feature.touch&&(!this.over&&this.overFeature(a))&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=
!1)},clickoutFeature:function(a){this.handlers.feature.touch&&this.over&&(this.outFeature(a),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,
this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){var b=!1;this.handlers.drag.dragging?this.over=this.feature.id==a.id?!0:!1:(this.feature=a,this.handlers.drag.activate(),this.over=b=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(a));return b},downFeature:function(a){this.lastPixel=a;this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*
(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y));this.layer.drawFeature(this.feature);this.lastPixel=a;this.onDrag(this.feature,a)},upFeature:function(a){this.over||this.handlers.drag.deactivate()},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){this.handlers.drag.dragging?this.feature.id==a.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(a),this.feature=null)},
cancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(a){this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer=a;this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,
cursor:"pointer"});this.createBox();this.createControl()},activate:function(){var a=!1;OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),a=!0);return a},deactivate:function(){var a=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),
this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),a=!0);return a},setMap:function(a){this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(a,b){b=OpenLayers.Util.applyDefaults(b,{rotation:0,scale:1,ratio:1});var c=this.rotation,d=this.center;OpenLayers.Util.extend(this,b);if(!1!==this.events.triggerEvent("beforesetfeature",{feature:a})){this.feature=a;this.activate();this._setfeature=!0;var e=this.feature.geometry.getBounds();this.box.move(e.getCenterLonLat());
this.box.geometry.rotate(-c,d);this._angle=0;this.rotation?(c=a.geometry.clone(),c.rotate(-this.rotation,this.center),c=new OpenLayers.Feature.Vector(c.getBounds().toGeometry()),c.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(c.geometry.getBounds().getCenterLonLat()),c=c.geometry.components[0].components[0].getBounds().getCenterLonLat()):c=new OpenLayers.LonLat(e.left,e.bottom);this.handles[0].move(c);delete this._setfeature;this.events.triggerEvent("setfeature",
{feature:a})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.ratio=this.scale=1)},createBox:function(){var a=this;this.center=new OpenLayers.Geometry.Point(0,0);this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,
1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent);this.box.geometry.move=function(b,c){a._moving=!0;OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);a.center.move(b,c);delete a._moving};for(var b=function(a,b){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(a,b);this._handle.geometry.move(a,b)},c=function(a,b,c){OpenLayers.Geometry.Point.prototype.resize.apply(this,
arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(a,b,c);this._handle.geometry.resize(a,b,c)},d=function(a,b){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(a,b);this._handle.geometry.rotate(a,b)},e=function(b,c){var d=this.x,e=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,b,c);if(!a._moving){var f=a.dragControl.handlers.drag.evt,g=!(!a._setfeature&&a.preserveAspectRatio)&&!(f&&f.shiftKey),
h=new OpenLayers.Geometry.Point(d,e),f=a.center;this.rotate(-a.rotation,f);h.rotate(-a.rotation,f);var k=this.x-f.x,l=this.y-f.y,m=k-(this.x-h.x),n=l-(this.y-h.y);a.irregular&&!a._setfeature&&(k-=(this.x-h.x)/2,l-=(this.y-h.y)/2);this.x=d;this.y=e;h=1;g?(l=1E-5>Math.abs(n)?1:l/n,h=(1E-5>Math.abs(m)?1:k/m)/l):(m=Math.sqrt(m*m+n*n),l=Math.sqrt(k*k+l*l)/m);a._moving=!0;a.box.geometry.rotate(-a.rotation,f);delete a._moving;a.box.geometry.resize(l,f,h);a.box.geometry.rotate(a.rotation,f);a.transformFeature({scale:l,
ratio:h});a.irregular&&!a._setfeature&&(k=f.clone(),k.x+=1E-5>Math.abs(d-f.x)?0:this.x-d,k.y+=1E-5>Math.abs(e-f.y)?0:this.y-e,a.box.geometry.move(this.x-d,this.y-e),a.transformFeature({center:k}))}},f=function(b,c){var d=this.x,e=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,b,c);if(!a._moving){var f=a.dragControl.handlers.drag.evt,f=f&&f.shiftKey?45:1,g=a.center,h=this.x-g.x,k=this.y-g.y;this.x=d;this.y=e;d=Math.atan2(k-c,h-b);d=Math.atan2(k,h)-d;d*=180/Math.PI;a._angle=(a._angle+d)%
360;d=a.rotation%f;if(Math.abs(a._angle)>=f||0!==d)d=Math.round(a._angle/f)*f-d,a._angle=0,a.box.geometry.rotate(d,g),a.transformFeature({rotation:d})}},g=Array(8),h=Array(4),k,l,m,n="sw s se e ne n nw w".split(" "),p=0;8>p;++p)k=this.box.geometry.components[p],l=new OpenLayers.Feature.Vector(k.clone(),{role:n[p]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),0==p%2&&(m=new OpenLayers.Feature.Vector(k.clone(),{role:n[p]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?
null:this.rotationHandleSymbolizer),m.geometry.move=f,k._rotationHandle=m,h[p/2]=m),k.move=b,k.resize=c,k.rotate=d,l.geometry.move=e,k._handle=l,g[p]=l;this.rotationHandles=h;this.handles=g},createControl:function(){var a=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(b){this.feature===a.feature&&(this.feature=a.box);OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(b,c){b===a.box&&a.transformFeature({center:a.center})},
onStart:function(b,c){var d=!a.geometryTypes||-1!==OpenLayers.Util.indexOf(a.geometryTypes,b.geometry.CLASS_NAME),e=OpenLayers.Util.indexOf(a.handles,b),e=e+OpenLayers.Util.indexOf(a.rotationHandles,b);b!==a.feature&&(b!==a.box&&-2==e&&d)&&a.setFeature(b)},onComplete:function(b,c){a.events.triggerEvent("transformcomplete",{feature:a.feature})}})},drawHandles:function(){for(var a=this.layer,b=0;8>b;++b)this.rotate&&0===b%2&&a.drawFeature(this.rotationHandles[b/2],this.rotationHandleSymbolizer),a.drawFeature(this.handles[b],
this.renderIntent)},transformFeature:function(a){if(!this._setfeature){this.scale*=a.scale||1;this.ratio*=a.ratio||1;var b=this.rotation;this.rotation=(this.rotation+(a.rotation||0))%360;if(!1!==this.events.triggerEvent("beforetransform",a)){var c=this.feature,d=c.geometry,e=this.center;d.rotate(-b,e);a.scale||a.ratio?d.resize(a.scale,e,a.ratio):a.center&&c.move(a.center.getBounds().getCenterLonLat());d.rotate(this.rotation,e);this.layer.drawFeature(c);c.toState(OpenLayers.State.UPDATE);this.events.triggerEvent("transform",
a)}}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){for(var a,b=0;8>b;++b)a=this.box.geometry.components[b],a._handle.destroy(),a._handle=null,a._rotationHandle&&a._rotationHandle.destroy(),a._rotationHandle=null;this.rotationHandles=this.rotationHandleSymbolizer=this.handles=this.feature=this.center=null;this.box.destroy();this.layer=this.box=null;this.dragControl.destroy();this.dragControl=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},
CLASS_NAME:"OpenLayers.Control.TransformFeature"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=
null)},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(a)},startBox:function(a){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(a){var b=this.dragHandler.start.x,
c=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y),f=this.getBoxOffsets();this.zoomBox.style.width=d+f.width+1+"px";this.zoomBox.style.height=e+f.height+1+"px";this.zoomBox.style.left=(a.x<b?b-d-f.left:b-f.left)+"px";this.zoomBox.style.top=(a.y<c?c-e-f.top:c-f.top)+"px"},endBox:function(a){var b;if(5<Math.abs(this.dragHandler.start.x-a.x)||5<Math.abs(this.dragHandler.start.y-a.y)){var c=this.dragHandler.start;b=Math.min(c.y,a.y);var d=Math.max(c.y,a.y),e=Math.min(c.x,a.x);a=Math.max(c.x,
a.x);b=new OpenLayers.Bounds(e,d,a,b)}else b=this.dragHandler.start.clone();this.removeBox();this.callback("done",[b])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.boxOffsets=this.zoomBox=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?
(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var a=document.createElement("div");a.style.position="absolute";a.style.border="1px solid black";a.style.width="3px";document.body.appendChild(a);var b=3==a.clientWidth;document.body.removeChild(a);var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,
"border-top-width")),e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:a,right:c,top:d,bottom:e,width:!1===b?a+c:0,height:!1===b?d+e:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(a){if(a instanceof OpenLayers.Bounds){var b,c=a.getCenterPixel();if(this.out){b=Math.min(this.map.size.h/(a.bottom-a.top),this.map.size.w/(a.right-a.left));var d=this.map.getExtent(),e=this.map.getLonLatFromPixel(c),f=e.lon-d.getWidth()/
2*b;a=e.lon+d.getWidth()/2*b;var g=e.lat-d.getHeight()/2*b;b=e.lat+d.getHeight()/2*b;b=new OpenLayers.Bounds(f,g,a,b)}else f=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),a=this.map.getLonLatFromPixel({x:a.right,y:a.top}),b=new OpenLayers.Bounds(f.lon,f.lat,a.lon,a.lat);f=this.map.getZoom();g=this.map.getSize();a=g.w/2;g=g.h/2;b=this.map.getZoomForExtent(b);d=this.map.getResolution();e=this.map.getResolutionForZoom(b);d==e?this.map.setCenter(this.map.getLonLatFromPixel(c)):this.map.zoomTo(b,
{x:(d*c.x-e*a)/(d-e),y:(d*c.y-e*g)/(d-e)});f==this.map.getZoom()&&!0==this.alwaysZoom&&this.map.zoomTo(f+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,a):this.map.zoomTo(this.map.getZoom()+1,a))},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var a={interval:this.kineticInterval};"object"===typeof this.enableKinetic&&(a=OpenLayers.Util.extend(a,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(a)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},
{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(a){this.kinetic&&this.kinetic.update(a);this.panned=!0;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!0,animate:!1})},panMapDone:function(a){if(this.panned){var b=null;this.kinetic&&(b=this.kinetic.end(a));this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!!b,animate:!1});if(b){var c=this;this.kinetic.move(b,function(a,b,
f){c.map.pan(a,b,{dragging:!f,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;
this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();this.zoomWheelEnabled&&this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBoxEnabled&&this.zoomBox.activate();this.pinchZoom&&this.pinchZoom.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.pinchZoom&&this.pinchZoom.deactivate();
this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},{"double":!0,stopDouble:!0});this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,
documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6},this.mouseWheelOptions));OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},
this.pinchZoomOptions)))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.zoomTo(this.map.zoom+1,a.xy)},defaultDblRightClick:function(a){this.map.zoomTo(this.map.zoom-1,a.xy)},wheelChange:function(a,b){this.map.fractionalZoom||(b=Math.round(b));var c=this.map.getZoom(),d;d=Math.max(c+b,0);d=Math.min(d,this.map.getNumZoomLevels());d!==c&&this.map.zoomTo(d,a.xy)},wheelUp:function(a,b){this.wheelChange(a,b||1)},wheelDown:function(a,
b){this.wheelChange(a,b||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(a,b){this.layer.events.triggerEvent("sketchmodified",{vertex:a,feature:b})},create:function(a,b){this.layer.events.triggerEvent("sketchstarted",{vertex:a,feature:b})}},this.callbacks);this.layer=a;this.handlerOptions=
this.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:a.renderers,rendererOptions:a.rendererOptions});"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);if(a=this.layer.styleMap&&this.layer.styleMap.styles.temporary)this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":a})});this.handler=new b(this,this.callbacks,this.handlerOptions)},
drawFeature:function(a){a=new OpenLayers.Feature.Vector(a);!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:a})&&(a.state=OpenLayers.State.INSERT,this.layer.addFeatures([a]),this.featureAdded(a),this.events.triggerEvent("featureadded",{feature:a}))},insertXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertXY(a,b)},insertDeltaXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeltaXY(a,b)},insertDirectionLength:function(a,b){this.handler&&this.handler.line&&
this.handler.insertDirectionLength(a,b)},insertDeflectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(a,b)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,
this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(a){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var b=this.point.geometry,c=this.control.layer.features,d,e=c.length-1;0<=e;--e)if(d=c[e].geometry,(d instanceof OpenLayers.Geometry.Polygon||d instanceof OpenLayers.Geometry.MultiPolygon)&&d.intersects(b)){b=c[e];this.control.layer.removeFeatures([b],{silent:!0});this.control.layer.events.registerPriority("sketchcomplete",
this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);b.geometry.addComponent(this.line.geometry);this.polygon=b;this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(a){a=a.vertex;var b=this.line.geometry.components;this.polygon.geometry.intersects(a)||(b=b[b.length-3],a.x=b.x,a.y=b.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-
2]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var a=this.line.geometry,b=0!==a.getArea();if(b){for(var c=this.polygon.geometry.components,d=c.length-2;0<=d;--d)if(a.intersects(c[d])){b=!1;break}if(b)a:for(d=c.length-2;0<d;--d)for(var e=c[d].components,f=0,g=e.length;f<g;++f)if(a.containsPoint(e[f])){b=!1;break a}}b?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(a);this.restoreFeature();return!1},
cancel:function(){this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0));return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(a){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=
!1;a||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(a){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,a);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;a&&this.multi&&(a=new OpenLayers.Geometry.MultiPolygon([a]));return a},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(a,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation]);var c=[new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),
new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];this.addControls(c)},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);a&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update());return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,
scope:this});return a},update:function(a){var b=this.getMapBounds();null!==b&&(a&&a.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(b))&&(this.calculateBounds(b),this.resolution=this.layer.map.getResolution(),this.triggerRead(a))},getMapBounds:function(){if(null===this.layer.map)return null;var a=this.layer.map.getExtent();a&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection));
return a},invalidBounds:function(a){a||(a=this.getMapBounds());a=!this.bounds||!this.bounds.containsBounds(a);!a&&this.resFactor&&(a=this.resolution/this.layer.map.getResolution(),a=a>=this.resFactor||a<=1/this.resFactor);return a},calculateBounds:function(a){a||(a=this.getMapBounds());var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio;a=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2)},triggerRead:function(a){!this.response||a&&!0===a.noAbort||
(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var b={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",b);this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:b.filter,callback:this.merge,scope:this},a))},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});this.layer.filter&&(a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,
filters:[this.layer.filter,a]}));return a},merge:function(a){this.layer.destroyFeatures();if(a.success()){var b=a.features;if(b&&0<b.length){var c=this.layer.projection,d=this.layer.map.getProjectionObject();if(!d.equals(c))for(var e,f=0,g=b.length;f<g;++f)(e=b[f].geometry)&&e.transform(c,d);this.layer.addFeatures(b)}}else this.bounds=null;this.response=null;this.layer.events.triggerEvent("loadend",{response:a})},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(a,b,c,d,e,f){this.lzd=c;this.zoomLevels=d;c=[];c.push(a,b,e,f);OpenLayers.Layer.Grid.prototype.initialize.apply(this,c);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var a=this.map.getZoom();this.map.getMaxExtent();return a-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(a){a=this.adjustBounds(a);
var b=this.getZoom(),c=this.map.getMaxExtent(),d=this.lzd/Math.pow(2,this.getZoom()),e=Math.floor((a.left-c.left)/d);a=Math.floor((a.bottom-c.bottom)/d);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:b,X:e,Y:a}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"});OpenLayers.Protocol.CSW=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.CSW.DEFAULTS);var b=OpenLayers.Protocol.CSW["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSW version: "+a.version;return new b(a)};OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"};OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(a,b){if(!("layer"in b))throw Error("Missing property 'layer' in configuration.");for(var c=a.contents,d,e=0,f=c.layers.length;e<f;++e)if(c.layers[e].identifier===b.layer){d=c.layers[e];break}if(!d)throw Error("Layer not found");var g=b.format;!g&&(d.formats&&d.formats.length)&&(g=d.formats[0]);var h;b.matrixSet?h=c.tileMatrixSets[b.matrixSet]:
1<=d.tileMatrixSetLinks.length&&(h=c.tileMatrixSets[d.tileMatrixSetLinks[0].tileMatrixSet]);if(!h)throw Error("matrixSet not found");for(var k,e=0,f=d.styles.length;e<f&&(k=d.styles[e],!k.isDefault);++e);c=b.requestEncoding;if(!c&&(c="KVP",a.operationsMetadata.GetTile.dcp.http)){var l=a.operationsMetadata.GetTile.dcp.http;l.get[0].constraints&&(l=l.get[0].constraints.GetEncoding.allowedValues,l.KVP||!l.REST&&!l.RESTful||(c="REST"))}var l=[],m=b.params||{};delete b.params;for(var n=0,p=d.dimensions.length;n<
p;n++){var q=d.dimensions[n];l.push(q.identifier);m.hasOwnProperty(q.identifier)||(m[q.identifier]=q["default"])}var n=b.projection||h.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),p=b.units||("EPSG:4326"===n?"degrees":"m"),q=[],r;for(r in h.matrixIds)h.matrixIds.hasOwnProperty(r)&&q.push(2.8E-4*h.matrixIds[r].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[p]);if("REST"===c&&d.resourceUrls){r=[];for(var f=0,s=d.resourceUrls.length;f<s;++f)e=d.resourceUrls[f],
e.format===g&&"tile"===e.resourceType&&r.push(e.template)}else{s=a.operationsMetadata.GetTile.dcp.http.get;r=[];for(var t,e=0,f=s.length;e<f;e++)t=s[e].constraints,(!t||t&&t.GetEncoding.allowedValues[c])&&r.push(s[e].url)}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(b,{url:r,requestEncoding:c,name:d.title,style:k.identifier,format:g,matrixIds:h.matrixIds,matrixSet:h.identifier,projection:n,units:p,resolutions:!1===b.isBaseLayer?void 0:q,serverResolutions:q,tileFullExtent:h.bounds,
dimensions:l,params:m}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var a,b=OpenLayers.Layer.Google.cache[this.map.id];b?(a=b.mapObject,++b.count):(a=this.map.getCenter(),b=document.createElement("div"),b.className="olForeignContainer",b.style.width="100%",b.style.height="100%",a=new google.maps.Map(b,{center:a?new google.maps.LatLng(a.lat,a.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||
0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),b=document.createElement("div"),b.style.width="100%",b.style.height="100%",a.controls[google.maps.ControlPosition.TOP_LEFT].push(b),b={googleControl:b,mapObject:a,count:1},OpenLayers.Layer.Google.cache[this.map.id]=b);this.mapObject=a;this.setGMapVisibility(this.visibility)},onMapResize:function(){this.visibility&&google.maps.event.trigger(this.mapObject,"resize")},
setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id],c=this.map;if(b){for(var d=this.type,e=c.layers,f,g=e.length-1;0<=g;--g)if(f=e[g],f instanceof OpenLayers.Layer.Google&&!0===f.visibility&&!0===f.inRange){d=f.type;a=!0;break}e=this.mapObject.getDiv();if(!0===a){if(e.parentNode!==c.div)if(b.rendered)c.div.appendChild(e),b.googleControl.appendChild(c.viewPortDiv),google.maps.event.trigger(this.mapObject,"resize");else{var h=this;google.maps.event.addListenerOnce(this.mapObject,
"tilesloaded",function(){b.rendered=!0;h.setGMapVisibility(h.getVisibility());h.moveTo(h.map.getCenter())})}this.mapObject.setMapTypeId(d)}else b.googleControl.hasChildNodes()&&(c.div.appendChild(c.viewPortDiv),c.div.removeChild(e))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(a){var b=null;null!=a&&(b=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),a=this.sphericalMercator?this.inverseMercator(a.top,
a.right):new OpenLayers.LonLat(a.top,a.right),b=new google.maps.LatLngBounds(new google.maps.LatLng(b.lat,b.lon),new google.maps.LatLng(a.lat,a.lon)));return b},getMapObjectLonLatFromMapObjectPixel:function(a){var b=this.map.getSize(),c=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),d=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),e=this.map.getResolution();a=new OpenLayers.LonLat(c+(a.x-b.w/2)*e,d-(a.y-b.h/2)*e);this.wrapDateLine&&(a=a.wrapDateLine(this.maxExtent));return this.getMapObjectLonLatFromLonLat(a.lon,
a.lat)},getMapObjectPixelFromMapObjectLonLat:function(a){var b=this.getLongitudeFromMapObjectLonLat(a);a=this.getLatitudeFromMapObjectLonLat(a);var c=this.map.getResolution(),d=this.map.getExtent();return this.getMapObjectPixelFromXY(1/c*(b-d.left),1/c*(d.top-a))},setMapObjectCenter:function(a,b){if(!1===this.animationEnabled&&b!=this.mapObject.zoom){var c=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){c.style.visibility=""});c.style.visibility="hidden"}this.mapObject.setOptions({center:a,
zoom:b})},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;this.sphericalMercator?(c=this.inverseMercator(a,b),c=new google.maps.LatLng(c.lat,c.lon)):c=new google.maps.LatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new google.maps.Point(a,b)}};OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,
[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},readers:{wps:{ProcessDescriptions:function(a,b){b.processDescriptions={};this.readChildNodes(a,b.processDescriptions)},ProcessDescription:function(a,b){var c={processVersion:this.getAttributeNS(a,this.namespaces.wps,"processVersion"),statusSupported:"true"===a.getAttribute("statusSupported"),storeSupported:"true"===a.getAttribute("storeSupported")};this.readChildNodes(a,c);b[c.identifier]=c},DataInputs:function(a,
b){b.dataInputs=[];this.readChildNodes(a,b.dataInputs)},ProcessOutputs:function(a,b){b.processOutputs=[];this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c);b.push(c)},ComplexOutput:function(a,b){b.complexOutput={};this.readChildNodes(a,b.complexOutput)},LiteralOutput:function(a,b){b.literalOutput={};this.readChildNodes(a,b.literalOutput)},Input:function(a,b){var c={maxOccurs:parseInt(a.getAttribute("maxOccurs")),minOccurs:parseInt(a.getAttribute("minOccurs"))};
this.readChildNodes(a,c);b.push(c)},BoundingBoxData:function(a,b){b.boundingBoxData={};this.readChildNodes(a,b.boundingBoxData)},CRS:function(a,b){b.CRSs||(b.CRSs={});b.CRSs[this.getChildValue(a)]=!0},LiteralData:function(a,b){b.literalData={};this.readChildNodes(a,b.literalData)},ComplexData:function(a,b){b.complexData={};this.readChildNodes(a,b.complexData)},Default:function(a,b){b["default"]={};this.readChildNodes(a,b["default"])},Supported:function(a,b){b.supported={};this.readChildNodes(a,b.supported)},
Format:function(a,b){var c={};this.readChildNodes(a,c);b.formats||(b.formats={});b.formats[c.mimeType]=!0},MimeType:function(a,b){b.mimeType=this.getChildValue(a)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b,c;a=a.replace(/[\n\r]/g," ");if(c=this.regExes.typeStr.exec(a))if(a=c[1].toLowerCase(),c=c[2],this.parse[a]&&(b=this.parse[a].apply(this,[c])),this.internalProjection&&this.externalProjection)if(b&&
"OpenLayers.Feature.Vector"==b.CLASS_NAME)b.geometry.transform(this.externalProjection,this.internalProjection);else if(b&&"geometrycollection"!=a&&"object"==typeof b)for(a=0,c=b.length;a<c;a++)b[a].geometry.transform(this.externalProjection,this.internalProjection);return b},write:function(a){var b,c;a.constructor==Array?c=!0:(a=[a],c=!1);var d=[];c&&d.push("GEOMETRYCOLLECTION(");for(var e=0,f=a.length;e<f;++e)c&&0<e&&d.push(","),b=a[e].geometry,d.push(this.extractGeometry(b));c&&d.push(")");return d.join("")},
extractGeometry:function(a){var b=a.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[b])return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));return("collection"==b?"GEOMETRYCOLLECTION":b.toUpperCase())+"("+this.extract[b].apply(this,[a])+")"},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.point.apply(this,[a.components[c]])+
")");return b.join(",")},linestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(",")},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},polygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},multipolygon:function(a){for(var b=
[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.polygon.apply(this,[a.components[c]])+")");return b.join(",")},collection:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extractGeometry.apply(this,[a.components[c]]));return b.join(",")}},parse:{point:function(a){a=OpenLayers.String.trim(a).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a[0],a[1]))},multipoint:function(a){for(var b=OpenLayers.String.trim(a).split(","),
c=[],d=0,e=b.length;d<e;++d)a=b[d].replace(this.regExes.trimParens,"$1"),c.push(this.parse.point.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(c))},linestring:function(a){a=OpenLayers.String.trim(a).split(",");for(var b=[],c=0,d=a.length;c<d;++c)b.push(this.parse.point.apply(this,[a[c]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(b))},multilinestring:function(a){for(var b=OpenLayers.String.trim(a).split(this.regExes.parenComma),
c=[],d=0,e=b.length;d<e;++d)a=b[d].replace(this.regExes.trimParens,"$1"),c.push(this.parse.linestring.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(c))},polygon:function(a){var b;a=OpenLayers.String.trim(a).split(this.regExes.parenComma);for(var c=[],d=0,e=a.length;d<e;++d)b=a[d].replace(this.regExes.trimParens,"$1"),b=this.parse.linestring.apply(this,[b]).geometry,b=new OpenLayers.Geometry.LinearRing(b.components),c.push(b);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(c))},
multipolygon:function(a){for(var b=OpenLayers.String.trim(a).split(this.regExes.doubleParenComma),c=[],d=0,e=b.length;d<e;++d)a=b[d].replace(this.regExes.trimParens,"$1"),c.push(this.parse.polygon.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(c))},geometrycollection:function(a){a=a.replace(/,\s*([A-Za-z])/g,"|$1");a=OpenLayers.String.trim(a).split("|");for(var b=[],c=0,d=a.length;c<d;++c)b.push(OpenLayers.Format.WKT.prototype.read.apply(this,[a[c]]));
return b}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.executeCallbacks=[];this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(a){a=a||{};if(!this.description)this.client.describeProcess(this.server,this.identifier,function(b){this.description||this.parseDescription(b);
a.callback&&a.callback.call(a.scope,this.description)},this);else if(a.callback){var b=this.description;window.setTimeout(function(){a.callback.call(a.scope,b)},0)}},configure:function(a){this.describe({callback:function(){var b=this.description,c=a.inputs,d,e,f;e=0;for(f=b.dataInputs.length;e<f;++e)d=b.dataInputs[e],this.setInputData(d,c[d.identifier]);a.callback&&a.callback.call(a.scope)},scope:this});return this},execute:function(a){this.configure({inputs:a.inputs,callback:function(){var b=this,
c=this.getOutputIndex(b.description.processOutputs,a.output);b.setResponseForm({outputIndex:c});(function e(){OpenLayers.Util.removeItem(b.executeCallbacks,e);0!==b.chained?b.executeCallbacks.push(e):OpenLayers.Request.POST({url:b.client.servers[b.server].url,data:(new OpenLayers.Format.WPSExecute).write(b.description),success:function(e){var g=b.findMimeType(b.description.processOutputs[c].complexOutput.supported.formats);e=b.formats[g].read(e.responseText);e instanceof OpenLayers.Feature.Vector&&
(e=[e]);a.success&&(g={},g[a.output||"result"]=e,a.success.call(a.scope,g))},scope:b})})()},scope:this})},output:function(a){return new OpenLayers.WPSProcess.ChainLink({process:this,output:a})},parseDescription:function(a){a=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(a.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(a,b){delete a.data;delete a.reference;if(b instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,
a.reference={method:"POST",href:b.process.server===this.server?this.localWPS:this.client.servers[b.process.server].url},b.process.describe({callback:function(){--this.chained;this.chainProcess(a,b)},scope:this});else{a.data={};var c=a.complexData;c?(c=this.findMimeType(c.supported.formats),a.data.complexData={mimeType:c,value:this.formats[c].write(this.toFeatures(b))}):a.data.literalData={value:b}}},setResponseForm:function(a){a=a||{};var b=this.description.processOutputs[a.outputIndex||0];this.description.responseForm=
{rawDataOutput:{identifier:b.identifier,mimeType:this.findMimeType(b.complexOutput.supported.formats,a.supportedFormats)}}},getOutputIndex:function(a,b){var c;if(b)for(var d=a.length-1;0<=d;--d){if(a[d].identifier===b){c=d;break}}else c=0;return c},chainProcess:function(a,b){var c=this.getOutputIndex(b.process.description.processOutputs,b.output);a.reference.mimeType=this.findMimeType(a.complexData.supported.formats,b.process.description.processOutputs[c].complexOutput.supported.formats);var d={};
d[a.reference.mimeType]=!0;b.process.setResponseForm({outputIndex:c,supportedFormats:d});for(a.reference.body=b.process.description;0<this.executeCallbacks.length;)this.executeCallbacks[0]()},toFeatures:function(a){var b=OpenLayers.Util.isArray(a);b||(a=[a]);for(var c=Array(a.length),d,e=0,f=a.length;e<f;++e)d=a[e],c[e]=d instanceof OpenLayers.Feature.Vector?d:new OpenLayers.Feature.Vector(d);return b?c:c[0]},findMimeType:function(a,b){b=b||this.formats;for(var c in a)if(c in b)return c},CLASS_NAME:"OpenLayers.WPSProcess"});
OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(a){OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"});OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this);this.servers={};for(var b in a.servers)this.servers[b]="string"==typeof a.servers[b]?{url:a.servers[b],version:this.version,processDescription:{}}:a.servers[b]},execute:function(a){this.getProcess(a.server,a.process).execute({inputs:a.inputs,success:a.success,scope:a.scope})},getProcess:function(a,b){var c=new OpenLayers.WPSProcess({client:this,
server:a,identifier:b});this.lazy||c.describe();return c},describeProcess:function(a,b,c,d){var e=this.servers[a];e.processDescription[b]?window.setTimeout(function(){c.call(d,e.processDescription[b])},0):b in e.processDescription?this.events.register("describeprocess",this,function g(a){a.identifier===b&&(this.events.unregister("describeprocess",this,g),c.call(d,a.raw))}):(e.processDescription[b]=null,OpenLayers.Request.GET({url:e.url,params:{SERVICE:"WPS",VERSION:e.version,REQUEST:"DescribeProcess",
IDENTIFIER:b},success:function(a){e.processDescription[b]=a.responseText;this.events.triggerEvent("describeprocess",{identifier:b,raw:a.responseText})},scope:this}))},destroy:function(){this.events.destroy();this.servers=this.events=null},CLASS_NAME:"OpenLayers.WPSClient"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",
requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},
readers:{csw:{GetRecordsResponse:function(a,b){b.records=[];this.readChildNodes(a,b);var c=this.getAttributeNS(a,"","version");""!=c&&(b.version=c)},RequestId:function(a,b){b.RequestId=this.getChildValue(a)},SearchStatus:function(a,b){b.SearchStatus={};var c=this.getAttributeNS(a,"","timestamp");""!=c&&(b.SearchStatus.timestamp=c)},SearchResults:function(a,b){this.readChildNodes(a,b);for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]="numberOfRecordsMatched"==c[e].name||"numberOfRecordsReturned"==
c[e].name||"nextRecord"==c[e].name?parseInt(c[e].nodeValue):c[e].nodeValue;b.SearchResults=d},SummaryRecord:function(a,b){var c={type:"SummaryRecord"};this.readChildNodes(a,c);b.records.push(c)},BriefRecord:function(a,b){var c={type:"BriefRecord"};this.readChildNodes(a,c);b.records.push(c)},DCMIRecord:function(a,b){var c={type:"DCMIRecord"};this.readChildNodes(a,c);b.records.push(c)},Record:function(a,b){var c={type:"Record"};this.readChildNodes(a,c);b.records.push(c)},"*":function(a,b){var c=a.localName||
a.nodeName.split(":").pop();b[c]=this.getChildValue(a)}},geonet:{info:function(a,b){var c={};this.readChildNodes(a,c);b.gninfo=c}},dc:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);for(var d={},e=a.attributes,f=0,g=e.length;f<g;++f)d[e[f].name]=e[f].nodeValue;d.value=this.getChildValue(a);""!=d.value&&b[c].push(d)}},dct:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);b[c].push(this.getChildValue(a))}},
ows:OpenLayers.Util.applyDefaults({BoundingBox:function(a,b){b.bounds&&(b.BoundingBox=[{crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]}],delete b.projection,delete b.bounds);OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(a){a=this.writeNode("csw:GetRecords",a);a.setAttribute("xmlns:gmd",this.namespaces.gmd);return OpenLayers.Format.XML.prototype.write.apply(this,
[a])},writers:{csw:{GetRecords:function(a){a||(a={});var b=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:a.requestId||this.requestId,resultType:a.resultType||this.resultType,outputFormat:a.outputFormat||this.outputFormat,outputSchema:a.outputSchema||this.outputSchema,startPosition:a.startPosition||this.startPosition,maxRecords:a.maxRecords||this.maxRecords}});(a.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",
a.DistributedSearch||this.DistributedSearch,b);var c=a.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(c)&&0<c.length)for(var d=0,e=c.length;d<e;d++)this.writeNode("csw:ResponseHandler",c[d],b);this.writeNode("Query",a.Query||this.Query,b);return b},DistributedSearch:function(a){return this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:a.hopCount}})},ResponseHandler:function(a){return this.createElementNSPlus("csw:ResponseHandler",{value:a.value})},Query:function(a){a||
(a={});var b=this.createElementNSPlus("csw:Query",{attributes:{typeNames:a.typeNames||"csw:Record"}}),c=a.ElementName;if(OpenLayers.Util.isArray(c)&&0<c.length)for(var d=0,e=c.length;d<e;d++)this.writeNode("csw:ElementName",c[d],b);else this.writeNode("csw:ElementSetName",a.ElementSetName||{value:"summary"},b);a.Constraint&&this.writeNode("csw:Constraint",a.Constraint,b);a.SortBy&&this.writeNode("ogc:SortBy",a.SortBy,b);return b},ElementName:function(a){return this.createElementNSPlus("csw:ElementName",
{value:a.value})},ElementSetName:function(a){return this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:a.typeNames},value:a.value})},Constraint:function(a){var b=this.createElementNSPlus("csw:Constraint",{attributes:{version:a.version}});if(a.Filter){var c=new OpenLayers.Format.Filter({version:a.version});b.appendChild(c.write(a.Filter))}else a.CqlText&&(a=this.createElementNSPlus("CqlText",{value:a.CqlText.value}),b.appendChild(a));return b}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},
CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});/*
 Apache 2 

 Contains portions of Rico <http://openrico.org/>

 Copyright 2005 Sabre Airline Solutions  

 Licensed under the Apache License, Version 2.0 (the "License"); you
 may not use this file except in compliance with the License. You
 may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0  

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 implied. See the License for the specific language governing
 permissions and limitations under the License. 
*/
OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(a,b,c){this.bounds=a;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div);this.setBorder(b,c)},destroy:function(){this.div=this.bounds=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){a||(a="red");b||(b=2);this.div.style.border=b+"px solid "+a},draw:function(a,b){OpenLayers.Util.modifyDOMElement(this.div,
null,a,b);return this.div},onScreen:function(){var a=!1;this.map&&(a=this.map.getExtent().containsBounds(this.bounds,!0,!0));return a},display:function(a){this.div.style.display=a?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(a){a=a||{};!1!==a.extractStyles&&(a.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5});OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){a=a.split("\n");for(var b,c=[],d=0;d<a.length-1;d++){var e=a[d].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=e.charAt(0))if(b){for(var e=
e.split("\t"),f=new OpenLayers.Geometry.Point(0,0),g={},h=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,k=!1,l=0;l<e.length;l++)if(e[l])if("point"==b[l])k=e[l].split(","),f.y=parseFloat(k[0]),f.x=parseFloat(k[1]),k=!0;else if("lat"==b[l])f.y=parseFloat(e[l]),k=!0;else if("lon"==b[l])f.x=parseFloat(e[l]),k=!0;else if("title"==b[l])g.title=e[l];else if("image"==b[l]||"icon"==b[l]&&h)h.externalGraphic=e[l];else if("iconSize"==b[l]&&h){var m=e[l].split(",");h.graphicWidth=
parseFloat(m[0]);h.graphicHeight=parseFloat(m[1])}else"iconOffset"==b[l]&&h?(m=e[l].split(","),h.graphicXOffset=parseFloat(m[0]),h.graphicYOffset=parseFloat(m[1])):"description"==b[l]?g.description=e[l]:"overflow"==b[l]?g.overflow=e[l]:g[b[l]]=e[l];k&&(this.internalProjection&&this.externalProjection&&f.transform(this.externalProjection,this.internalProjection),e=new OpenLayers.Feature.Vector(f,g,h),c.push(e))}else b=e.split("\t")}return c},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){this.loaded||null==this.location||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,
success:this.parseData,failure:function(a){this.events.triggerEvent("loadend")},scope:this}),this.loaded=!0)},moveTo:function(a,b,c){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadText()},parseData:function(a){a=a.responseText;var b={};OpenLayers.Util.extend(b,this.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(b.externalProjection=this.projection,b.internalProjection=this.map.getProjectionObject());a=(new OpenLayers.Format.Text(b)).read(a);
for(var b=0,c=a.length;b<c;b++){var d={},e=a[b],f,g,h;f=new OpenLayers.LonLat(e.geometry.x,e.geometry.y);e.style.graphicWidth&&e.style.graphicHeight&&(g=new OpenLayers.Size(e.style.graphicWidth,e.style.graphicHeight));void 0!==e.style.graphicXOffset&&void 0!==e.style.graphicYOffset&&(h=new OpenLayers.Pixel(e.style.graphicXOffset,e.style.graphicYOffset));null!=e.style.externalGraphic?d.icon=new OpenLayers.Icon(e.style.externalGraphic,g,h):(d.icon=OpenLayers.Marker.defaultIcon(),null!=g&&d.icon.setSize(g));
null!=e.attributes.title&&null!=e.attributes.description&&(d.popupContentHTML="<h2>"+e.attributes.title+"</h2><p>"+e.attributes.description+"</p>");d.overflow=e.attributes.overflow||"auto";d=new OpenLayers.Feature(this,f,d);this.features.push(d);f=d.createMarker();null!=e.attributes.title&&null!=e.attributes.description&&f.events.register("click",d,this.markerClick);this.addMarker(f)}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=
b?null:this;for(var c=0,d=this.layer.map.popups.length;c<d;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||this.layer.map.addPopup(this.createPopup());OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;0<this.features.length;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{}));OpenLayers.Handler.Drag.prototype.initialize.apply(this,[a,b,c]);this.options=c?c:{}},setOptions:function(a){OpenLayers.Util.extend(this.options,
a);OpenLayers.Util.extend(this,a)},activate:function(){var a=!1;OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&&(a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a),this.map.addLayer(this.layer),a=!0);return a},deactivate:function(){var a=!1;OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),
null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.feature=this.layer=null,a=!0);return a},down:function(a){this.fixedRadius=!!this.radius;a=this.layer.getLonLatFromViewPortPx(a.xy);this.origin=new OpenLayers.Geometry.Point(a.lon,a.lat);if(!this.fixedRadius||this.irregular)this.radius=this.map.getResolution();this.persist&&this.clear();this.feature=new OpenLayers.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],
{silent:!0});this.layer.drawFeature(this.feature,this.style)},move:function(a){var b=this.layer.getLonLatFromViewPortPx(a.xy),b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.irregular?(a=Math.sqrt(2)*Math.abs(b.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,a)):this.fixedRadius?this.origin=b:(this.calculateAngle(b,a),this.radius=Math.max(this.map.getResolution()/2,b.distanceTo(this.origin)));this.modifyGeometry();if(this.irregular){a=b.x-this.origin.x;var b=b.y-this.origin.y,
c;c=0==b?a/(this.radius*Math.sqrt(2)):a/b;this.feature.geometry.resize(1,this.origin,c);this.feature.geometry.move(a/2,b/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize();this.start==this.last&&this.callback("done",[a.xy])},out:function(a){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-0.5);this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180));this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,
this.sides,this.snapAngle)},modifyGeometry:function(){var a,b,c=this.feature.geometry.components[0];c.components.length!=this.sides+1&&(this.createGeometry(),c=this.feature.geometry.components[0]);for(var d=0;d<this.sides;++d)b=c.components[d],a=this.angle+2*d*Math.PI/this.sides,b.x=this.origin.x+this.radius*Math.cos(a),b.y=this.origin.y+this.radius*Math.sin(a),b.clearBounds()},calculateAngle:function(a,b){var c=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!b[this.snapToggle]){var d=
Math.PI/180*this.snapAngle;this.angle=Math.round(c/d)*d}else this.angle=c},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(a,b){this.callbacks[a]&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone()]);this.persist||"done"!=a&&"cancel"!=a||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks);
this.handlerOptions=this.handlerOptions||{};this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}});this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})}));this.handler=new a(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var a in this.layerCache)delete this.layerCache[a];for(a in this.wfsCache)delete this.wfsCache[a];
OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(a){this.setVisibility(a.object.getVisibility())},createSelectionLayer:function(a){var b;if(this.layerCache[a.id])b=this.layerCache[a.id];else{b=new OpenLayers.Layer.WMS(a.name,a.url,a.params,OpenLayers.Util.applyDefaults(this.layerOptions,a.getOptions()));this.layerCache[a.id]=b;if(!1===this.layerOptions.displayInLayerSwitcher)a.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:b});this.map.addLayer(b)}return b},
createSLD:function(a,b,c){for(var d={version:"1.0.0",namedLayers:{}},e=(""+a.params.LAYERS).split(","),f=0,g=e.length;f<g;f++){var h=e[f];d.namedLayers[h]={name:h,userStyles:[]};var k=this.selectionSymbolizer,l=c[f];0<=l.type.indexOf("Polygon")?k={Polygon:this.selectionSymbolizer.Polygon}:0<=l.type.indexOf("LineString")?k={Line:this.selectionSymbolizer.Line}:0<=l.type.indexOf("Point")&&(k={Point:this.selectionSymbolizer.Point});d.namedLayers[h].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:k,
filter:b[f],maxScaleDenominator:a.options.minScale})]})}return(new OpenLayers.Format.SLD({srsName:this.map.getProjection()})).write(d)},parseDescribeLayer:function(a){var b=new OpenLayers.Format.WMSDescribeLayer,c=a.responseXML;c&&c.documentElement||(c=a.responseText);a=b.read(c);for(var b=[],c=null,d=0,e=a.length;d<e;d++)"WFS"==a[d].owsType&&(b.push(a[d].typeName),c=a[d].owsURL);OpenLayers.Request.GET({url:c,params:{SERVICE:"WFS",TYPENAME:b.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},
callback:function(a){var b=new OpenLayers.Format.WFSDescribeFeatureType,c=a.responseXML;c&&c.documentElement||(c=a.responseText);a=b.read(c);this.control.wfsCache[this.layer.id]=a;this.control._queue&&this.control.applySelection()},scope:this})},getGeometryAttributes:function(a){var b=[];a=this.wfsCache[a.id];for(var c=0,d=a.featureTypes.length;c<d;c++)for(var e=a.featureTypes[c].properties,f=0,g=e.length;f<g;f++){var h=e[f],k=h.type;(0<=k.indexOf("LineString")||0<=k.indexOf("GeometryAssociationType")||
0<=k.indexOf("GeometryPropertyType")||0<=k.indexOf("Point")||0<=k.indexOf("Polygon"))&&b.push(h)}return b},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a)for(var b=0,c=this.layers.length;b<c;b++){var d=this.layers[b];d&&!this.wfsCache[d.id]&&OpenLayers.Request.GET({url:d.url,params:{SERVICE:"WMS",VERSION:d.params.VERSION,LAYERS:d.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:d,control:this}})}return a},deactivate:function(){var a=
OpenLayers.Control.prototype.deactivate.call(this);if(a)for(var b=0,c=this.layers.length;b<c;b++){var d=this.layers[b];if(d&&!0===this.clearOnDeactivate){var e=this.layerCache,f=e[d.id];f&&(d.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:f}),f.destroy(),delete e[d.id])}}return a},setLayers:function(a){this.active?(this.deactivate(),this.layers=a,this.activate()):this.layers=a},createFilter:function(a,b){var c=null;this.handler instanceof OpenLayers.Handler.RegularPolygon?c=!0===this.handler.irregular?
new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:a.name,value:b.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Polygon?c=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Path?c=0<=a.type.indexOf("Point")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,
property:a.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Click&&(c=0<=a.type.indexOf("Polygon")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:0.01*this.map.getExtent().getWidth(),
distanceUnits:this.map.getUnits(),value:b}));return c},select:function(a){this._queue=function(){for(var b=0,c=this.layers.length;b<c;b++){for(var d=this.layers[b],e=this.getGeometryAttributes(d),f=[],g=0,h=e.length;g<h;g++){var k=e[g];if(null!==k){if(!(a instanceof OpenLayers.Geometry)){var l=this.map.getLonLatFromPixel(a.xy);a=new OpenLayers.Geometry.Point(l.lon,l.lat)}k=this.createFilter(k,a);null!==k&&f.push(k)}}g=this.createSelectionLayer(d);this.events.triggerEvent("selected",{layer:d,filters:f});
d=this.createSLD(d,f,e);g.mergeNewParams({SLD_BODY:d});delete this._queue}};this.applySelection()},applySelection:function(){for(var a=!0,b=0,c=this.layers.length;b<c;b++)if(!this.wfsCache[this.layers[b].id]){a=!1;break}a&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.element=OpenLayers.Util.getElement(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element));this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var a;
if(!0===this.geodesic){if(!this.map.getUnits())return;a=OpenLayers.INCHES_PER_UNIT;a=(this.map.getGeodesicPixelSize().w||1E-6)*a.km*OpenLayers.DOTS_PER_INCH}else a=this.map.getScale();a&&(a=9500<=a&&95E4>=a?Math.round(a/1E3)+"K":95E4<=a?Math.round(a/1E6)+"M":Math.round(a),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:a}))},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,
300),tileOriginCorner:"tl",initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(null==d||null==d.isBaseLayer)this.isBaseLayer="true"!=this.transparent&&!0!=this.transparent;d&&null!=d.useOverlay&&(this.useOverlay=d.useOverlay);this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?
OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(a){null==a&&(a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b;b=a.getCenterLonLat();var c=this.map.getSize();this.singleTile?(a={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:c.h*this.ratio,setdisplaywidth:c.w*
this.ratio,setviewcenterx:b.lon,setviewcentery:b.lat,setviewscale:this.map.getScale()},this.useOverlay&&!this.useAsyncOverlay&&(b={},b=OpenLayers.Util.extend(b,a),b.operation="GETVISIBLEMAPEXTENT",b.version="1.0.0",b.session=this.params.session,b.mapName=this.params.mapName,b.format="text/xml",b=this.getFullRequestString(b),OpenLayers.Request.GET({url:b,async:!1})),b=this.getFullRequestString(a)):(c=this.map.getResolution(),b=Math.floor((a.left-this.maxExtent.left)/c),b=Math.round(b/this.tileSize.w),
a=Math.floor((this.maxExtent.top-a.top)/c),a=Math.round(a/this.tileSize.h),b=this.useHttpTile?this.getImageFilePath({tilecol:b,tilerow:a,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:b,tilerow:a,scaleindex:this.resolutions.length-this.map.zoom-1}));return b},getFullRequestString:function(a,b){var c=null==b?this.url:b;"object"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d=c,e=OpenLayers.Util.extend({},this.params),e=OpenLayers.Util.extend(e,a),
f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c)),g;for(g in e)g.toUpperCase()in f&&delete e[g];e=OpenLayers.Util.getParameterString(e);e=e.replace(/,/g,"+");""!=e&&(f=c.charAt(c.length-1),d="&"==f||"?"==f?d+e:-1==c.indexOf("?")?d+("?"+e):d+("&"+e));return d},getImageFilePath:function(a,b){var c=null==b?this.url:b;"object"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d="",e="";0>a.tilerow&&(d="-");d=0==a.tilerow?d+"0":d+Math.floor(Math.abs(a.tilerow/this.params.tileRowsPerFolder))*
this.params.tileRowsPerFolder;0>a.tilecol&&(e="-");e=0==a.tilecol?e+"0":e+Math.floor(Math.abs(a.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;d="/S"+Math.floor(a.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+d+"/C"+e+"/"+a.tilerow%this.params.tileRowsPerFolder+"_"+a.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;this.params.querystring&&(d+="?"+this.params.querystring);return c+d},CLASS_NAME:"OpenLayers.Layer.MapGuide"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);var c={done:this.measureComplete,point:this.measurePartial};this.immediate&&(c.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(c,this.callbacks);
this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new a(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(a){(this.immediate=a)?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(a,b){var c=this.active;c&&this.deactivate();
this.handler=new a(this,this.callbacks,b);c&&this.activate()},measureComplete:function(a){this.cancelDelay();this.measure(a,"measure")},measurePartial:function(a,b){this.cancelDelay();b=b.clone();this.handler.freehandMode(this.handler.evt)?this.measure(b,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(b,"measurepartial")},this),this.partialDelay)},measureImmediate:function(a,b,c){c&&!this.handler.freehandMode(this.handler.evt)&&
(this.cancelDelay(),this.measure(b.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(a,b){var c,d;-1<a.CLASS_NAME.indexOf("LineString")?(c=this.getBestLength(a),d=1):(c=this.getBestArea(a),d=2);this.events.triggerEvent(b,{measure:c[0],units:c[1],order:d,geometry:a})},getBestArea:function(a){for(var b=this.displaySystemUnits[this.displaySystem],c,d,e=0,f=b.length;e<f&&!(c=b[e],d=this.getArea(a,
c),1<d);++e);return[d,c]},getArea:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicArea(this.map.getProjectionObject()),d="m"):(c=a.getArea(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];e&&(c*=Math.pow(OpenLayers.INCHES_PER_UNIT[d]/e,2));return c},getBestLength:function(a){for(var b=this.displaySystemUnits[this.displaySystem],c,d,e=0,f=b.length;e<f&&!(c=b[e],d=this.getLength(a,c),1<d);++e);return[d,c]},getLength:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicLength(this.map.getProjectionObject()),
d="m"):(c=a.getLength(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];e&&(c*=OpenLayers.INCHES_PER_UNIT[d]/e);return c},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_wmc_SRS:function(a,b){var c=this.getChildValue(b);"object"!=typeof a.projections&&(a.projections={});for(var c=c.split(/ +/),d=0,e=c.length;d<e;d++)a.projections[c[d]]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,
[a]);if(a.srs){var c=[],d;for(d in a.srs)c.push(d);b.appendChild(this.createElementDefaultNS("SRS",c.join(" ")))}b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a));b.appendChild(this.write_wmc_LayerExtension(a))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(a,b,c,d,e,f,g){OpenLayers.Popup.prototype.initialize.apply(this,[a,b,c,d,f,g]);this.anchor=null!=e?e:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.relativePosition=this.anchor=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},
moveTo:function(a){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(a);OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(a));this.relativePosition!=b&&this.updateRelativePosition()},setSize:function(a){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if(this.lonlat&&this.map){var b=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(b)}},calculateRelativePosition:function(a){a=this.map.getLonLatFromLayerPx(a);a=this.map.getExtent().determineQuadrant(a);
return OpenLayers.Bounds.oppositeQuadrant(a)},updateRelativePosition:function(){},calculateNewPx:function(a){a=a.offset(this.anchor.offset);var b=this.size||this.contentSize,c="t"==this.relativePosition.charAt(0);a.y+=c?-b.h:this.anchor.size.h;c="l"==this.relativePosition.charAt(1);a.x+=c?-b.w:this.anchor.size.w;return a},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(a,b,c,d,e,f,g){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(a){return this.relativePosition});this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;f&&(this.closeDiv.style.zIndex=
1);this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.isAlphaImage=this.imageSize=this.imageSrc=null;this.fixedRelativePosition=!1;this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];b.image&&b.div.removeChild(b.image);b.image=null;b.div&&this.groupDiv.removeChild(b.div);b.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,
arguments)},setBackgroundColor:function(a){},setBorder:function(){},setOpacity:function(a){},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px";this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(a){var b=
OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return b=b.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var a=null,b;for(b in this.positionBlocks){a=b;break}a=this.positionBlocks[a];for(b=0;b<a.blocks.length;b++){var c={};this.blocks.push(c);c.div=OpenLayers.Util.createDiv(this.id+"_FrameDecorationDiv_"+b,null,null,null,"absolute",null,"hidden",null);c.image=(this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage)(this.id+
"_FrameDecorationImg_"+b,null,this.imageSize,this.imageSrc,"absolute",null,null,null);c.div.appendChild(c.image);this.groupDiv.appendChild(c.div)}},updateBlocks:function(){this.blocks||this.createBlocks();if(this.size&&this.relativePosition){for(var a=this.positionBlocks[this.relativePosition],b=0;b<a.blocks.length;b++){var c=a.blocks[b],d=this.blocks[b],e=c.anchor.left,f=c.anchor.bottom,g=c.anchor.right,h=c.anchor.top,k=isNaN(c.size.w)?this.size.w-(g+e):c.size.w,l=isNaN(c.size.h)?this.size.h-(f+
h):c.size.h;d.div.style.width=(0>k?0:k)+"px";d.div.style.height=(0>l?0:l)+"px";d.div.style.left=null!=e?e+"px":"";d.div.style.bottom=null!=f?f+"px":"";d.div.style.right=null!=g?g+"px":"";d.div.style.top=null!=h?h+"px":"";d.image.style.left=c.position.x+"px";d.image.style.top=c.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,
50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto",
"auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,
0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,
21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,
0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(a,b,c,d,e,f,g){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");
OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){if(OpenLayers.Tile.Image.prototype.shouldDraw.call(this)){var a=this.layer.getURL(this.bounds),b=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&a.length>this.maxGetUrlLength;a=b&&!this.useIFrame;b=!b&&this.useIFrame;if(a||b)this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=
null,a&&this.frame.removeChild(this.frame.firstChild)}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(!0===this.useIFrame){if(!this.frame.childNodes.length){var a=document.createElement("div"),b=a.style;b.position="absolute";b.width="100%";b.height="100%";b.zIndex=1;b.backgroundImage="url("+this.blankImageUrl+")";this.frame.appendChild(a)}a=this.id+"_iFrame";9>parseFloat(navigator.appVersion.split("MSIE")[1])?(b=document.createElement('<iframe name="'+a+'">'),
b.style.backgroundColor="#FFFFFF",b.style.filter="chroma(color=#FFFFFF)"):(b=document.createElement("iframe"),b.style.backgroundColor="transparent",b.name=a);b.scrolling="no";b.marginWidth="0px";b.marginHeight="0px";b.frameBorder="0";b.style.position="absolute";b.style.width="100%";b.style.height="100%";1>this.layer.opacity&&OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,this.layer.opacity);this.frame.appendChild(b);return this.imgDiv=b}return OpenLayers.Tile.Image.prototype.getImage.apply(this,
arguments)},createRequestForm:function(){var a=document.createElement("form");a.method="POST";var b=this.layer.params._OLSALT,b=(b?b+"_":"")+this.bounds.toBBOX();a.action=OpenLayers.Util.urlAppend(this.layer.url,b);a.target=this.id+"_iFrame";this.layer.getImageSize();var b=OpenLayers.Util.getParameters(this.url),c,d;for(d in b)c=document.createElement("input"),c.type="hidden",c.name=d,c.value=b[d],a.appendChild(c);return a},setImgSrc:function(a){if(!0===this.useIFrame)if(a){var b=this.createRequestForm();
this.frame.appendChild(b);b.submit();this.frame.removeChild(b)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments);!0===this.useIFrame&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var a;!1===this.useIFrame&&(a=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this));
return a}};OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"});OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,
[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);return b},readers:{gml:OpenLayers.Util.applyDefaults({name:function(a,b){b.name=this.getChildValue(a)},TimePeriod:function(a,b){b.timePeriod={};this.readChildNodes(a,b.timePeriod)},beginPosition:function(a,b){b.beginPosition=this.getChildValue(a)},endPosition:function(a,b){b.endPosition=this.getChildValue(a)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,
b){b.contents={};this.readChildNodes(a,b.contents)},ObservationOfferingList:function(a,b){b.offeringList={};this.readChildNodes(a,b.offeringList)},ObservationOffering:function(a,b){var c=this.getAttributeNS(a,this.namespaces.gml,"id");b[c]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]};this.readChildNodes(a,b[c])},time:function(a,b){b.time={};this.readChildNodes(a,b.time)},procedure:function(a,b){b.procedures.push(this.getAttributeNS(a,
this.namespaces.xlink,"href"))},observedProperty:function(a,b){b.observedProperties.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},featureOfInterest:function(a,b){b.featureOfInterestIds.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},responseFormat:function(a,b){b.responseFormats.push(this.getChildValue(a))},resultModel:function(a,b){b.resultModels.push(this.getChildValue(a))},responseMode:function(a,b){b.responseModes.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},
CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(a){var b=!0;this.pinching=!1;if(OpenLayers.Event.isMultiTouch(a))this.started=!0,this.last=this.start={distance:this.getDistance(a.touches),delta:0,scale:1},this.callback("start",[a,this.start]),b=!this.stopDown;else{if(this.started)return!1;this.started=!1;this.last=this.start=null}OpenLayers.Event.preventDefault(a);return b},touchmove:function(a){if(this.started&&
OpenLayers.Event.isMultiTouch(a)){this.pinching=!0;var b=this.getPinchData(a);this.callback("move",[a,b]);this.last=b;OpenLayers.Event.stop(a)}else if(this.started)return!1;return!0},touchend:function(a){return this.started&&!OpenLayers.Event.isMultiTouch(a)?(this.pinching=this.started=!1,this.callback("done",[a,this.start,this.last]),this.last=this.start=null,!1):!0},activate:function(){var a=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,a=!0);return a},deactivate:function(){var a=
!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,a=!0);return a},getDistance:function(a){var b=a[0];a=a[1];return Math.sqrt(Math.pow(b.olClientX-a.olClientX,2)+Math.pow(b.olClientY-a.olClientY,2))},getPinchData:function(a){a=this.getDistance(a.touches);return{distance:a,delta:this.last.distance-a,scale:a/this.start.distance}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);a&&(!0===this.layer.visibility&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this}));return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&(this.stop(),this.layer.events.un({visibilitychanged:this.reset,scope:this}));return a},reset:function(){!0===this.layer.visibility?
this.start():this.stop()},start:function(){this.interval&&("number"===typeof this.interval&&0<this.interval)&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&(this.layer.refresh&&"function"==typeof this.layer.refresh)&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"});OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c);e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&
(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(a){null==a&&(a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.projection.getCode().split(":"),b=b[b.length-1],c=this.getImageSize();a={BBOX:a.toBBOX(),SIZE:c.w+","+c.h,F:"image",BBOXSR:b,IMAGESR:b};if(this.layerDefs){var b=[],d;for(d in this.layerDefs)this.layerDefs.hasOwnProperty(d)&&
this.layerDefs[d]&&(b.push(d),b.push(":"),b.push(this.layerDefs[d]),b.push(";"));0<b.length&&(a.LAYERDEFS=b.join(""))}return this.getFullRequestString(a)},setLayerFilter:function(a,b){this.layerDefs||(this.layerDefs={});b?this.layerDefs[a]=b:delete this.layerDefs[a]},clearLayerFilter:function(a){a?delete this.layerDefs[a]:delete this.layerDefs},mergeNewParams:function(a){a=[OpenLayers.Util.upperCaseObject(a)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(a){this.passesTolerance(a.xy)&&(this.clearTimer(),this.callback("move",[a]),this.px=a.xy,a=OpenLayers.Util.extend({},a),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay));return!this.stopMove},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[a]));return!0},
passesTolerance:function(a){var b=!0;this.pixelTolerance&&this.px&&Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2))<this.pixelTolerance&&(b=!1);return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),a=!0);return a},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(a){a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);this.features={};this.handlers={};this.click&&(this.handlers.click=
new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{}));this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"})));this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var a in this.handlers)this.handlers[a].activate();
return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var a in this.handlers)this.handlers[a].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(a){var b=this.pixelToBounds(a.xy);this.setModifiers(a);this.request(b,{single:this.single})},selectBox:function(a){var b;if(a instanceof OpenLayers.Bounds)b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),a=this.map.getLonLatFromPixel({x:a.right,
y:a.top}),b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat);else{if(this.click)return;b=this.pixelToBounds(a)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(b)},selectHover:function(a){a=this.pixelToBounds(a.xy);this.request(a,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(a,b){b=b||{};var c=new OpenLayers.Filter.Spatial({type:this.filterType,
value:a});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");c=this.protocol.read({maxFeatures:!0==b.single?this.maxFeatures:void 0,filter:c,callback:function(c){c.success()&&(c.features.length?!0==b.single?this.selectBestFeature(c.features,a.getCenterLonLat(),b):this.select(c.features):b.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll()));OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});!0==b.hover&&(this.hoverResponse=
c)},selectBestFeature:function(a,b,c){c=c||{};if(a.length){b=new OpenLayers.Geometry.Point(b.lon,b.lat);for(var d,e,f,g=Number.MAX_VALUE,h=0;h<a.length&&!(d=a[h],d.geometry&&(f=b.distanceTo(d.geometry,{edge:!1}),f<g&&(g=f,e=d,0==g)));++h);!0==c.hover?this.hoverSelect(e):this.select(e||a)}},setModifiers:function(a){this.modifiers={multiple:this.multiple||this.multipleKey&&a[this.multipleKey],toggle:this.toggle||this.toggleKey&&a[this.toggleKey]}},select:function(a){this.modifiers.multiple||this.modifiers.toggle||
this.unselectAll();OpenLayers.Util.isArray(a)||(a=[a]);var b=this.events.triggerEvent("beforefeaturesselected",{features:a});if(!1!==b){for(var c=[],d,e=0,f=a.length;e<f;++e)d=a[e],this.features[d.fid||d.id]?this.modifiers.toggle&&this.unselect(this.features[d.fid||d.id]):(b=this.events.triggerEvent("beforefeatureselected",{feature:d}),!1!==b&&(this.features[d.fid||d.id]=d,c.push(d),this.events.triggerEvent("featureselected",{feature:d})));this.events.triggerEvent("featuresselected",{features:c})}},
hoverSelect:function(a){var b=a?a.fid||a.id:null,c=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;c&&c!=b&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null);b&&b!=c&&(this.events.triggerEvent("hoverfeature",{feature:a}),this.hoverFeature=a)},unselect:function(a){delete this.features[a.fid||a.id];this.events.triggerEvent("featureunselected",{feature:a})},unselectAll:function(){for(var a in this.features)this.unselect(this.features[a])},
setMap:function(a){for(var b in this.handlers)this.handlers[b].setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(a){var b=a.add(-this.clickTolerance/2,this.clickTolerance/2);a=a.add(this.clickTolerance/2,-this.clickTolerance/2);b=this.map.getLonLatFromPixel(b);a=this.map.getLonLatFromPixel(a);return new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});OpenLayers.Format.QueryStringFilter=function(){function a(a){a=a.replace(/%/g,"\\%");a=a.replace(/\\\\\.(\*)?/g,function(a,b){return b?a:"\\\\_"});a=a.replace(/\\\\\.\*/g,"\\\\%");a=a.replace(/(\\)?\.(\*)?/g,function(a,b,c){return b||c?a:"_"});a=a.replace(/(\\)?\.\*/g,function(a,b){return b?a:"%"});a=a.replace(/\\\./g,".");return a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"*"})}var b={};b[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";b[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";b[OpenLayers.Filter.Comparison.LESS_THAN]=
"lt";b[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";b[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";b[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";b[OpenLayers.Filter.Comparison.LIKE]="ilike";return OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(c,d){d=d||{};var e=c.CLASS_NAME,e=e.substring(e.lastIndexOf(".")+1);switch(e){case "Spatial":switch(c.type){case OpenLayers.Filter.Spatial.BBOX:d.bbox=c.value.toArray();this.srsInBBOX&&c.projection&&
d.bbox.push(c.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:d.tolerance=c.distance;case OpenLayers.Filter.Spatial.WITHIN:d.lon=c.value.x;d.lat=c.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+c.type)}break;case "Comparison":e=b[c.type];if(void 0!==e){var f=c.value;c.type==OpenLayers.Filter.Comparison.LIKE&&(f=a(f),this.wildcarded&&(f="%"+f+"%"));d[c.property+"__"+e]=f;d.queryable=d.queryable||[];d.queryable.push(c.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+
c.type);break;case "Logical":if(c.type===OpenLayers.Filter.Logical.AND)for(e=0,f=c.filters.length;e<f;e++)d=this.write(c.filters[e],d);else OpenLayers.Console.warn("Unsupported logical filter type "+c.type);break;default:OpenLayers.Console.warn("Unknown filter type "+e)}return d},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}();OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),
this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.div.left="",this.div.top="",this.element=this.div);return this.div},redraw:function(a){var b;if(null==a)this.reset();else if(null==this.lastXy||Math.abs(a.xy.x-
this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity)this.lastXy=a.xy;else if(b=this.map.getLonLatFromPixel(a.xy))this.displayProjection&&b.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=a.xy,a=this.formatOutput(b),a!=this.element.innerHTML&&(this.element.innerHTML=a)},reset:function(a){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(a){var b=parseInt(this.numDigits);return this.prefix+a.lon.toFixed(b)+
this.separator+a.lat.toFixed(b)+this.suffix},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:null,available:"geolocation"in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.available&&!this.geolocation&&(this.geolocation=navigator.geolocation);return this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,
this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId);return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(a){var b=(new OpenLayers.LonLat(a.coords.longitude,a.coords.latitude)).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&
this.map.setCenter(b);this.events.triggerEvent("locationupdated",{position:a,point:new OpenLayers.Geometry.Point(b.lon,b.lat)})},getCurrentLocation:function(){if(!this.active||this.watch)return!1;this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);return!0},failure:function(a){this.events.triggerEvent("locationfailed",{error:a})},CLASS_NAME:"OpenLayers.Control.Geolocate"});OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(a)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var b=new OpenLayers.Protocol.Script({url:this.url,
callback:function(a){this.isLoading=!1;this.events.triggerEvent("loadend");this.json=a.data},scope:this});b.read();this.request=b}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(a){this.isLoading=!1;this.events.triggerEvent("loadend");200===a.status&&this.parseData(a.responseText)},scope:this});else this.unload();return a},abortLoading:function(){this.request&&(this.request.abort(),delete this.request);this.isLoading=!1},getFeatureInfo:function(a,b){var c=null;if(this.json){var d=
this.getFeatureId(a,b);null!==d&&(c={id:d,data:this.json.data[d]})}return c},getFeatureId:function(a,b){var c=null;if(this.json){var d=this.utfgridResolution,d=this.json.grid[Math.floor(b/d)].charCodeAt(Math.floor(a/d)),d=this.indexFromCharCode(d),e=this.json.keys;!isNaN(d)&&d in e&&(c=e[d])}return c},indexFromCharCode:function(a){93<=a&&a--;35<=a&&a--;return a-32},parseData:function(a){this.format||(this.format=new OpenLayers.Format.JSON);this.json=this.format.read(a)},clear:function(){this.json=
null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(a){a=a||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=
function(a,d){return b.write(a,d)}}},destroy:function(){this.headers=this.params=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments);a=a||{};a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params);a=OpenLayers.Util.applyDefaults(a,this.options);a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=void 0!==a.readWithPOST?a.readWithPOST:this.readWithPOST,c=new OpenLayers.Protocol.Response({requestType:"read"});
b?(b=a.headers||{},b["Content-Type"]="application/x-www-form-urlencoded",c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:b})):c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers});return c},handleRead:function(a,b){this.handleResponse(a,b)},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:a,
requestType:"create"});c.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)});return c},handleCreate:function(a,b){this.handleResponse(a,b)},update:function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"update"});d.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"]({url:c,callback:this.createCallback(this.handleUpdate,
d,b),headers:b.headers,data:this.format.write(a)});return d},handleUpdate:function(a,b){this.handleResponse(a,b)},"delete":function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"delete"}),e=this.deleteWithPOST?"POST":"DELETE",c={url:c,callback:this.createCallback(this.handleDelete,d,b),headers:b.headers};this.deleteWithPOST&&(c.data=this.format.write(a));d.priv=OpenLayers.Request[e](c);
return d},handleDelete:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){var c=a.priv;b.callback&&(200<=c.status&&300>c.status?("delete"!=a.requestType&&(a.features=this.parseFeatures(c)),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a))},parseFeatures:function(a){var b=a.responseXML;b&&b.documentElement||(b=a.responseText);return!b||0>=b.length?null:this.format.read(b)},commit:function(a,b){function c(a){for(var b=
a.features?a.features.length:0,c=Array(b),e=0;e<b;++e)c[e]=a.features[e].fid;r.insertIds=c;d.apply(this,[a])}function d(a){this.callUserCallback(a,b);q=q&&a.success();f++;f>=p&&b.callback&&(r.code=q?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,b.callback.apply(b.scope,[r]))}b=OpenLayers.Util.applyDefaults(b,this.options);var e=[],f=0,g={};g[OpenLayers.State.INSERT]=[];g[OpenLayers.State.UPDATE]=[];g[OpenLayers.State.DELETE]=[];for(var h,k,l=[],m=0,n=a.length;m<n;++m)if(h=
a[m],k=g[h.state])k.push(h),l.push(h);var p=(0<g[OpenLayers.State.INSERT].length?1:0)+g[OpenLayers.State.UPDATE].length+g[OpenLayers.State.DELETE].length,q=!0,r=new OpenLayers.Protocol.Response({reqFeatures:l});h=g[OpenLayers.State.INSERT];0<h.length&&e.push(this.create(h,OpenLayers.Util.applyDefaults({callback:c,scope:this},b.create)));h=g[OpenLayers.State.UPDATE];for(m=h.length-1;0<=m;--m)e.push(this.update(h[m],OpenLayers.Util.applyDefaults({callback:d,scope:this},b.update)));h=g[OpenLayers.State.DELETE];
for(m=h.length-1;0<=m;--m)e.push(this["delete"](h[m],OpenLayers.Util.applyDefaults({callback:d,scope:this},b["delete"])));return e},abort:function(a){a&&a.priv.abort()},callUserCallback:function(a,b){var c=b[a.requestType];c&&c.callback&&c.callback.call(c.scope,a)},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a)this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this});return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,
featuresremoved:this.clearCache,moveend:this.cluster,scope:this}));return a},cacheFeatures:function(a){var b=!0;this.clustering||(this.clearCache(),this.features=a.features,this.cluster(),b=!1);return b},clearCache:function(){this.clustering||(this.features=null)},cluster:function(a){if((!a||a.zoomChanged)&&this.features&&(a=this.layer.map.getResolution(),a!=this.resolution||!this.clustersExist())){this.resolution=a;a=[];for(var b,c,d,e=0;e<this.features.length;++e)if(b=this.features[e],b.geometry){c=
!1;for(var f=a.length-1;0<=f;--f)if(d=a[f],this.shouldCluster(d,b)){this.addToCluster(d,b);c=!0;break}c||a.push(this.createCluster(this.features[e]))}this.clustering=!0;this.layer.removeAllFeatures();this.clustering=!1;if(0<a.length){if(1<this.threshold)for(b=a.slice(),a=[],e=0,d=b.length;e<d;++e)c=b[e],c.attributes.count<this.threshold?Array.prototype.push.apply(a,c.cluster):a.push(c);this.clustering=!0;this.layer.addFeatures(a);this.clustering=!1}this.clusters=a}},clustersExist:function(){var a=
!1;if(this.clusters&&0<this.clusters.length&&this.clusters.length==this.layer.features.length)for(var a=!0,b=0;b<this.clusters.length;++b)if(this.clusters[b]!=this.layer.features[b]){a=!1;break}return a},shouldCluster:function(a,b){var c=a.geometry.getBounds().getCenterLonLat(),d=b.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(c.lon-d.lon,2)+Math.pow(c.lat-d.lat,2))/this.resolution<=this.distance},addToCluster:function(a,b){a.cluster.push(b);a.attributes.count+=1},createCluster:function(a){var b=
a.geometry.getBounds().getCenterLonLat(),b=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});b.cluster=[a];return b},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);a&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}));return a},deactivate:function(){this.cache=null;this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this});
return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(a){if(!this.caching&&this.filter){var b=a.features;a.features=[];for(var c,d=0,e=b.length;d<e;++d)c=b[d],this.filter.evaluate(c)?a.features.push(c):this.cache.push(c)}},handleRemove:function(a){this.caching||(this.cache=[])},setFilter:function(a){this.filter=a;a=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});0<this.cache.length&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),
this.caching=!1);0<a.length&&(a={features:a},this.handleAdd(a),0<a.features.length&&(this.caching=!0,this.layer.addFeatures(a.features),this.caching=!1))},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Protocol.SOS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.SOS.DEFAULTS);var b=OpenLayers.Protocol.SOS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported SOS version: "+a.version;return new b(a)};OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(a,b){var c=[],d={},e,f;this.readChildNodes(a,{complexTypes:c,customTypes:d});var g=a.attributes,h,k;e=0;for(f=g.length;e<f;++e)h=g[e],k=h.name,0===k.indexOf("xmlns")?this.setNamespace(k.split(":")[1]||"",h.value):b[k]=h.value;b.featureTypes=c;b.targetPrefix=this.namespaceAlias[b.targetNamespace];e=0;for(f=
c.length;e<f;++e)g=c[e],h=d[g.typeName],d[g.typeName]&&(g.typeName=h.name)},complexType:function(a,b){var c={typeName:a.getAttribute("name")};this.readChildNodes(a,c);b.complexTypes.push(c)},complexContent:function(a,b){this.readChildNodes(a,b)},extension:function(a,b){this.readChildNodes(a,b)},sequence:function(a,b){var c={elements:[]};this.readChildNodes(a,c);b.properties=c.elements},element:function(a,b){var c;if(b.elements){var d={};c=a.attributes;for(var e,f=0,g=c.length;f<g;++f)e=c[f],d[e.name]=
e.value;c=d.type;c||(c={},this.readChildNodes(a,c),d.restriction=c,d.type=c.base);d.localType=(c.base||c).split(":").pop();b.elements.push(d);this.readChildNodes(a,d)}b.complexTypes&&(c=a.getAttribute("type"),d=c.split(":").pop(),b.customTypes[d]={name:a.getAttribute("name"),type:c})},annotation:function(a,b){b.annotation={};this.readChildNodes(a,b.annotation)},appinfo:function(a,b){b.appinfo||(b.appinfo=[]);b.appinfo.push(this.getChildValue(a))},documentation:function(a,b){b.documentation||(b.documentation=
[]);var c=this.getChildValue(a);b.documentation.push({lang:a.getAttribute("xml:lang"),textContent:c.replace(this.regExes.trimSpace,"")})},simpleType:function(a,b){this.readChildNodes(a,b)},restriction:function(a,b){b.base=a.getAttribute("base");this.readRestriction(a,b)}}},readRestriction:function(a,b){for(var c=a.childNodes,d,e,f=0,g=c.length;f<g;++f)d=c[f],1==d.nodeType&&(e=d.nodeName.split(":").pop(),d=d.getAttribute("value"),b[e]?("string"==typeof b[e]&&(b[e]=[b[e]]),b[e].push(d)):b[e]=d)},read:function(a){"string"==
typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};if("ExceptionReport"===a.nodeName.split(":").pop()){var c=new OpenLayers.Format.OGCExceptionReport;b.error=c.read(a)}else this.readNode(a,b);return b},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(a){var b=this.getElementsByTagNameNS(a,this.georssns,"point"),c=this.getElementsByTagNameNS(a,this.geons,"lat"),d=this.getElementsByTagNameNS(a,
this.geons,"long"),e=this.getElementsByTagNameNS(a,this.georssns,"line"),f=this.getElementsByTagNameNS(a,this.georssns,"polygon"),g=this.getElementsByTagNameNS(a,this.georssns,"where");a=this.getElementsByTagNameNS(a,this.georssns,"box");if(0<b.length||0<c.length&&0<d.length){0<b.length?(c=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s+/),2!=c.length&&(c=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s*,\s*/))):c=[parseFloat(c[0].firstChild.nodeValue),parseFloat(d[0].firstChild.nodeValue)];
var h=new OpenLayers.Geometry.Point(c[1],c[0])}else if(0<e.length){c=OpenLayers.String.trim(this.getChildValue(e[0])).split(/\s+/);d=[];e=0;for(f=c.length;e<f;e+=2)b=new OpenLayers.Geometry.Point(c[e+1],c[e]),d.push(b);h=new OpenLayers.Geometry.LineString(d)}else if(0<f.length){c=OpenLayers.String.trim(this.getChildValue(f[0])).split(/\s+/);d=[];e=0;for(f=c.length;e<f;e+=2)b=new OpenLayers.Geometry.Point(c[e+1],c[e]),d.push(b);h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)])}else 0<
g.length?(this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})),h=this.gmlParser.parseFeature(g[0]).geometry):0<a.length&&(c=OpenLayers.String.trim(a[0].firstChild.nodeValue).split(/\s+/),d=[],3<c.length&&(b=new OpenLayers.Geometry.Point(c[1],c[0]),d.push(b),b=new OpenLayers.Geometry.Point(c[1],c[2]),d.push(b),b=new OpenLayers.Geometry.Point(c[3],c[2]),d.push(b),b=new OpenLayers.Geometry.Point(c[3],c[0]),d.push(b),b=new OpenLayers.Geometry.Point(c[1],c[0]),d.push(b)),h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)]));
h&&(this.internalProjection&&this.externalProjection)&&h.transform(this.externalProjection,this.internalProjection);return h},createFeatureFromItem:function(a){var b=this.createGeometryFromItem(a),c=this._getChildValue(a,"*","title",this.featureTitle),d=this._getChildValue(a,"*","description",this._getChildValue(a,"*","content",this._getChildValue(a,"*","summary",this.featureDescription))),e=this._getChildValue(a,"*","link");if(!e)try{e=this.getElementsByTagNameNS(a,"*","link")[0].getAttribute("href")}catch(f){e=
null}a=this._getChildValue(a,"*","id",null);b=new OpenLayers.Feature.Vector(b,{title:c,description:d,link:e});b.fid=a;return b},_getChildValue:function(a,b,c,d){return(a=this.getElementsByTagNameNS(a,b,c))&&a[0]&&a[0].firstChild&&a[0].firstChild.nodeValue?this.getChildValue(a[0]):void 0==d?"":d},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null,b=this.getElementsByTagNameNS(a,"*","item");0==b.length&&(b=this.getElementsByTagNameNS(a,"*","entry"));
a=b.length;for(var c=Array(a),d=0;d<a;d++)c[d]=this.createFeatureFromItem(b[d]);return c},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNS(this.rssns,"rss");for(var c=0,d=a.length;c<d;c++)b.appendChild(this.createFeatureXML(a[c]))}else b=this.createFeatureXML(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.rssns,"item"),d=this.createElementNS(this.rssns,"title");
d.appendChild(this.createTextNode(a.attributes.title?a.attributes.title:""));var e=this.createElementNS(this.rssns,"description");e.appendChild(this.createTextNode(a.attributes.description?a.attributes.description:""));c.appendChild(d);c.appendChild(e);a.attributes.link&&(d=this.createElementNS(this.rssns,"link"),d.appendChild(this.createTextNode(a.attributes.link)),c.appendChild(d));for(var f in a.attributes)"link"!=f&&("title"!=f&&"description"!=f)&&(d=this.createTextNode(a.attributes[f]),e=f,-1!=
f.search(":")&&(e=f.split(":")[1]),e=this.createElementNS(this.featureNS,"feature:"+e),e.appendChild(d),c.appendChild(e));c.appendChild(b);return c},buildGeometryNode:function(a){this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b;if("OpenLayers.Geometry.Polygon"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:polygon"),b.appendChild(this.buildCoordinatesNode(a.components[0]));else if("OpenLayers.Geometry.LineString"==
a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:line"),b.appendChild(this.buildCoordinatesNode(a));else if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:point"),b.appendChild(this.buildCoordinatesNode(a));else throw"Couldn't parse "+a.CLASS_NAME;return b},buildCoordinatesNode:function(a){var b=null;a.components&&(b=a.components);if(b){a=b.length;for(var c=Array(a),d=0;d<a;d++)c[d]=b[d].y+" "+b[d].x;b=c.join(" ")}else b=a.y+" "+a.x;return this.createTextNode(b)},
CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"});OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);
var b={};this.readNode(a,b);return b},readers:{wps:{Capabilities:function(a,b){this.readChildNodes(a,b)},ProcessOfferings:function(a,b){b.processOfferings={};this.readChildNodes(a,b.processOfferings)},Process:function(a,b){var c={processVersion:this.getAttributeNS(a,this.namespaces.wps,"processVersion")};this.readChildNodes(a,c);b[c.identifier]=c},Languages:function(a,b){b.languages=[];this.readChildNodes(a,b.languages)},Default:function(a,b){var c={isDefault:!0};this.readChildNodes(a,c);b.push(c)},
Supported:function(a,b){var c={};this.readChildNodes(a,c);b.push(c)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(a,b){var c=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy;this.currentCenter=
this.pinchOrigin=c},pinchMove:function(a,b){var c=b.scale,d=this.map.layerContainerOriginPx,e=this.pinchOrigin,f=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy,g=Math.round(d.x+f.x-e.x+(c-1)*(d.x-e.x)),d=Math.round(d.y+f.y-e.y+(c-1)*(d.y-e.y));this.map.applyTransform(g,d,c);this.currentCenter=f},pinchDone:function(a,b,c){this.map.applyTransform();a=this.map.getZoomForResolution(this.map.getResolution()/c.scale,!0);if(a!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){b=
this.map.getResolutionForZoom(a);c=this.map.getLonLatFromPixel(this.pinchOrigin);var d=this.currentCenter,e=this.map.getSize();c.lon+=b*(e.w/2-d.x);c.lat-=b*(e.h/2-d.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(c,a)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom);OpenLayers.Control.prototype.destroy.apply(this,
arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var a={click:this.defaultClick,dblclick:this.defaultDblClick},b=OpenLayers.Util.extend({"double":!0,stopDouble:!0,
pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.zoomTo(this.map.zoom+
1,a.xy)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};
OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(a,b,c){this.rgb={r:a,g:b,b:c}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(a){var b=this.asHSB();b.h=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setSaturation:function(a){var b=this.asHSB();b.s=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setBrightness:function(a){var b=this.asHSB();b.b=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},
darken:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.max(b.b-a,0))},brighten:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.min(b.b+a,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){this.asHSB();return 0.5<this.asHSB().b},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+
this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});
OpenLayers.Rico.Color.createFromHex=function(a){if(4==a.length){var b=a;a="#";for(var c=1;4>c;c++)a+=b.charAt(c)+b.charAt(c)}0==a.indexOf("#")&&(a=a.substring(1));b=a.substring(0,2);c=a.substring(2,4);a=a.substring(4,6);return new OpenLayers.Rico.Color(parseInt(b,16),parseInt(c,16),parseInt(a,16))};
OpenLayers.Rico.Color.createColorFromBackground=function(a){var b=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(a),"backgroundColor");return"transparent"==b&&a.parentNode?OpenLayers.Rico.Color.createColorFromBackground(a.parentNode):null==b?new OpenLayers.Rico.Color(255,255,255):0==b.indexOf("rgb(")?(a=b.substring(4,b.length-1).split(","),new OpenLayers.Rico.Color(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]))):0==b.indexOf("#")?OpenLayers.Rico.Color.createFromHex(b):new OpenLayers.Rico.Color(255,
255,255)};
OpenLayers.Rico.Color.HSBtoRGB=function(a,b,c){var d=0,e=0,f=0;if(0==b)f=e=d=parseInt(255*c+0.5);else{a=6*(a-Math.floor(a));var g=a-Math.floor(a),h=c*(1-b),k=c*(1-b*g);b=c*(1-b*(1-g));switch(parseInt(a)){case 0:d=255*c+0.5;e=255*b+0.5;f=255*h+0.5;break;case 1:d=255*k+0.5;e=255*c+0.5;f=255*h+0.5;break;case 2:d=255*h+0.5;e=255*c+0.5;f=255*b+0.5;break;case 3:d=255*h+0.5;e=255*k+0.5;f=255*c+0.5;break;case 4:d=255*b+0.5;e=255*h+0.5;f=255*c+0.5;break;case 5:d=255*c+0.5,e=255*h+0.5,f=255*k+0.5}}return{r:parseInt(d),g:parseInt(e),
b:parseInt(f)}};OpenLayers.Rico.Color.RGBtoHSB=function(a,b,c){var d,e=a>b?a:b;c>e&&(e=c);var f=a<b?a:b;c<f&&(f=c);d=0!=e?(e-f)/e:0;if(0==d)a=0;else{var g=(e-a)/(e-f),h=(e-b)/(e-f);c=(e-c)/(e-f);a=(a==e?c-h:b==e?2+g-c:4+h-g)/6;0>a&&(a+=1)}return{h:a,s:d,b:e/255}};OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++)this.rules[a].destroy();delete this.rules},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;b<c;++b)a.rules.push(this.rules[b].clone())}return new OpenLayers.Style2(a)},
CLASS_NAME:"OpenLayers.Style2"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(a,b){OpenLayers.Format.GML.prototype.initialize.apply(this,[a]);this.layer=b;this.layer.featureNS&&(this.featureNS=this.layer.featureNS);this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column);this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(a){var b=this.createElementNS(this.wfsns,
"wfs:Transaction");b.setAttribute("version","1.0.0");b.setAttribute("service","WFS");for(var c=0;c<a.length;c++)switch(a[c].state){case OpenLayers.State.INSERT:b.appendChild(this.insert(a[c]));break;case OpenLayers.State.UPDATE:b.appendChild(this.update(a[c]));break;case OpenLayers.State.DELETE:b.appendChild(this.remove(a[c]))}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,"feature:"+
this.geometryName);c.appendChild(b);b=this.createElementNS(this.featureNS,"feature:"+this.featureName);b.appendChild(c);for(var d in a.attributes){var c=this.createTextNode(a.attributes[d]),e=d;-1!=d.search(":")&&(e=d.split(":")[1]);e=this.createElementNS(this.featureNS,"feature:"+e);e.appendChild(c);b.appendChild(e)}return b},insert:function(a){var b=this.createElementNS(this.wfsns,"wfs:Insert");b.appendChild(this.createFeatureXML(a));return b},update:function(a){a.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));
var b=this.createElementNS(this.wfsns,"wfs:Update");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName);b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),e=this.createTextNode(this.geometryName);d.appendChild(e);c.appendChild(d);d=this.createElementNS(this.wfsns,"wfs:Value");e=this.buildGeometryNode(a.geometry);a.layer&&e.setAttribute("srsName",a.layer.projection.getCode());
d.appendChild(e);c.appendChild(d);b.appendChild(c);for(var f in a.attributes)c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),d.appendChild(this.createTextNode(f)),c.appendChild(d),d=this.createElementNS(this.wfsns,"wfs:Value"),d.appendChild(this.createTextNode(a.attributes[f])),c.appendChild(d),b.appendChild(c);c=this.createElementNS(this.ogcns,"ogc:Filter");f=this.createElementNS(this.ogcns,"ogc:FeatureId");f.setAttribute("fid",a.fid);c.appendChild(f);
b.appendChild(c);return b},remove:function(a){if(!a.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var b=this.createElementNS(this.wfsns,"wfs:Delete");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName);b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.ogcns,"ogc:Filter"),d=this.createElementNS(this.ogcns,"ogc:FeatureId");d.setAttribute("fid",a.fid);c.appendChild(d);b.appendChild(c);return b},destroy:function(){this.layer=
null},CLASS_NAME:"OpenLayers.Format.WFS"});OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.priority=c)},VendorOption:function(a,b){b.vendorOptions||(b.vendorOptions={});b.vendorOptions[a.getAttribute("name")]=this.getChildValue(a)},TextSymbolizer:function(a,b){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,
arguments);var c=this.multipleSymbolizers?b.symbolizers[b.symbolizers.length-1]:b.symbolizer.Text;void 0===c.graphic&&(c.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Priority",a)},VendorOption:function(a){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:a.name},
value:a.value})},TextSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.TextSymbolizer.apply(this,arguments);!1!==a.graphic&&(a.externalGraphic||a.graphicName)&&this.writeNode("Graphic",a,b);"priority"in a&&this.writeNode("Priority",a.priority,b);return this.addVendorOptions(b,a)},PointSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(b,a)},LineSymbolizer:function(a){var b=
OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(b,a)},PolygonSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(b,a)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(a,b){if(b.vendorOptions)for(var c in b.vendorOptions)this.writeNode("VendorOption",{name:c,
value:b.vendorOptions[c]},a);return a},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(a){var b=this.map.getLayerPxFromLonLat({lon:a.bounds.left,lat:a.bounds.top}),c=this.map.getLayerPxFromLonLat({lon:a.bounds.right,lat:a.bounds.bottom});null==c||null==b?a.display(!1):(b=a.draw(b,{w:Math.max(1,c.x-b.x),h:Math.max(1,c.y-b.y)}),a.drawn||(this.div.appendChild(b),a.drawn=!0))},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a);null!=a.div&&a.div.parentNode==this.div&&this.div.removeChild(a.div)},
CLASS_NAME:"OpenLayers.Layer.Boxes"});OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(a,b){b.service={};this.readChildNodes(a,b.service)},Fees:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.accessConstraints=c)},OnlineResource:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.onlineResource=
c)},Keywords:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.keywords=c.split(", "))},Capability:function(a,b){b.capability={};this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={};this.readChildNodes(a,b.request)},GetFeature:function(a,b){b.getfeature={href:{},formats:[]};this.readChildNodes(a,b.getfeature)},ResultFormat:function(a,b){for(var c=a.childNodes,d,e=0;e<c.length;e++)d=c[e],1==d.nodeType&&b.formats.push(d.nodeName)},DCPType:function(a,b){this.readChildNodes(a,
b)},HTTP:function(a,b){this.readChildNodes(a,b.href)},Get:function(a,b){b.get=a.getAttribute("onlineResource")},Post:function(a,b){b.post=a.getAttribute("onlineResource")},SRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(a,b){this.readChildNodes(a,b)},LayerLimit:function(a,b){b.layerLimit=parseInt(this.getChildValue(a))},MaxWidth:function(a,b){b.maxWidth=parseInt(this.getChildValue(a))},MaxHeight:function(a,b){b.maxHeight=parseInt(this.getChildValue(a))},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,
[a,b]);c.srs=a.getAttribute("CRS");b.bbox[c.srs]=c},CRS:function(a,b){this.readers.wms.SRS.apply(this,[a,b])},EX_GeographicBoundingBox:function(a,b){b.llbbox=[];this.readChildNodes(a,b.llbbox)},westBoundLongitude:function(a,b){b[0]=this.getChildValue(a)},eastBoundLongitude:function(a,b){b[2]=this.getChildValue(a)},southBoundLatitude:function(a,b){b[1]=this.getChildValue(a)},northBoundLatitude:function(a,b){b[3]=this.getChildValue(a)},MinScaleDenominator:function(a,b){b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16)},
MaxScaleDenominator:function(a,b){b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16)},Dimension:function(a,b){var c={name:a.getAttribute("name").toLowerCase(),units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol"),nearestVal:"1"===a.getAttribute("nearestValue"),multipleVal:"1"===a.getAttribute("multipleValues"),"default":a.getAttribute("default")||"",current:"1"===a.getAttribute("current"),values:this.getChildValue(a).split(",")};b.dimensions[c.name]=c},Keyword:function(a,
b){var c={value:this.getChildValue(a),vocabulary:a.getAttribute("vocabulary")};b.keywords&&b.keywords.push(c)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(a,b){this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]);b.userSymbols.inlineFeature=1==parseInt(a.getAttribute("InlineFeature"));b.userSymbols.remoteWCS=1==parseInt(a.getAttribute("RemoteWCS"))},DescribeLayer:function(a,b){this.readers.wms.DescribeLayer.apply(this,[a,b])},GetLegendGraphic:function(a,
b){this.readers.wms.GetLegendGraphic.apply(this,[a,b])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(a,b,c,d){this.initializeZoomify(c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,c,{},d])},initializeZoomify:function(a){var b=a.clone();this.size=a.clone();a=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize));this.tierSizeInTiles=
[a];for(this.tierImageSize=[b];b.w>this.standardTileSize||b.h>this.standardTileSize;)b=new OpenLayers.Size(Math.floor(b.w/2),Math.floor(b.h/2)),a=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize)),this.tierSizeInTiles.push(a),this.tierImageSize.push(b);this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;b=[1];this.tileCountUpToTier=[0];for(a=1;a<this.numberOfTiers;a++)b.unshift(Math.pow(2,a)),this.tileCountUpToTier.push(this.tierSizeInTiles[a-
1].w*this.tierSizeInTiles[a-1].h+this.tileCountUpToTier[a-1]);this.serverResolutions||(this.serverResolutions=b)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(a){null==a&&(a=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=
this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w));a=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h));b=this.getZoomForResolution(b);c="TileGroup"+Math.floor((c+a*this.tierSizeInTiles[b].w+this.tileCountUpToTier[b])/256)+"/"+b+"-"+c+"-"+a+".jpg";b=this.url;OpenLayers.Util.isArray(b)&&(b=this.selectUrl(c,b));return b+c},getImageSize:function(){if(0<arguments.length){var a=this.adjustBounds(arguments[0]),b=this.getServerResolution(),c=Math.round((a.left-
this.tileOrigin.lon)/(b*this.tileSize.w)),a=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),b=this.getZoomForResolution(b),d=this.standardTileSize,e=this.standardTileSize;c==this.tierSizeInTiles[b].w-1&&(d=this.tierImageSize[b].w%this.standardTileSize);a==this.tierSizeInTiles[b].h-1&&(e=this.tierImageSize[b].h%this.standardTileSize);return new OpenLayers.Size(d,e)}return this.tileSize},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,
this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(null==d||null==d.isBaseLayer)this.isBaseLayer="true"!=this.params.transparent&&!0!=this.params.transparent},clone:function(a){null==a&&(a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions()));
return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);a=[a.left,a.bottom,a.right,a.top];var b=this.getImageSize();return this.getFullRequestString({mapext:a,imgext:a,map_size:[b.w,b.h],imgx:b.w/2,imgy:b.h/2,imgxy:[b.w,b.h]})},getFullRequestString:function(a,b){var c=null==b?this.url:b,d=OpenLayers.Util.extend({},this.params),d=OpenLayers.Util.extend(d,a),e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));
var e=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c)),f;for(f in d)f.toUpperCase()in e&&delete d[f];e=OpenLayers.Util.getParameterString(d);d=c;e=e.replace(/,/g,"+");""!=e&&(f=c.charAt(c.length-1),d="&"==f||"?"==f?d+e:-1==c.indexOf("?")?d+("?"+e):d+("&"+e));return d},CLASS_NAME:"OpenLayers.Layer.MapServer"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(a){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var b=document.createStyleSheet(),c="shape rect oval fill stroke imagedata group textbox".split(" "),d=0,e=c.length;d<e;d++)b.addRule("olv\\:"+c[d],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,
arguments)}},supported:function(){return!!document.namespaces},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=a.left/d|0,d=a.top/d-this.size.h|0;b||!this.offset?(this.offset={x:e,y:d},d=e=0):(e-=this.offset.x,d-=this.offset.y);this.root.coordorigin=e-this.xOffset+" "+d;for(var e=[this.root,this.vectorRoot,this.textRoot],f=0,g=e.length;f<g;++f)d=e[f],d.coordsize=this.size.w+" "+this.size.h;this.root.style.flip="y";return c},
setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var b=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],c=this.size.w+"px",d=this.size.h+"px",e,f=0,g=b.length;f<g;++f)e=b[f],e.style.width=c,e.style.height=d},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case "OpenLayers.Geometry.Point":c=b.externalGraphic?"olv:rect":this.isComplexSymbol(b.graphicName)?"olv:shape":"olv:oval";break;case "OpenLayers.Geometry.Rectangle":c="olv:rect";break;case "OpenLayers.Geometry.LineString":case "OpenLayers.Geometry.LinearRing":case "OpenLayers.Geometry.Polygon":case "OpenLayers.Geometry.Curve":c=
"olv:shape"}return c},setStyle:function(a,b,c,d){b=b||a._style;c=c||a._options;var e=b.fillColor,f=b.title||b.graphicTitle;f&&(a.title=f);if("OpenLayers.Geometry.Point"===a._geometryClass)if(b.externalGraphic){c.isFilled=!0;var e=b.graphicWidth||b.graphicHeight,f=b.graphicHeight||b.graphicWidth,e=e?e:2*b.pointRadius,f=f?f:2*b.pointRadius,g=this.getResolution(),h=void 0!=b.graphicXOffset?b.graphicXOffset:-(0.5*e),k=void 0!=b.graphicYOffset?b.graphicYOffset:-(0.5*f);a.style.left=((d.x-this.featureDx)/
g-this.offset.x+h|0)+"px";a.style.top=(d.y/g-this.offset.y-(k+f)|0)+"px";a.style.width=e+"px";a.style.height=f+"px";a.style.flip="y";e="none";c.isStroked=!1}else this.isComplexSymbol(b.graphicName)?(f=this.importSymbol(b.graphicName),a.path=f.path,a.coordorigin=f.left+","+f.bottom,f=f.size,a.coordsize=f+","+f,this.drawCircle(a,d,b.pointRadius),a.style.flip="y"):this.drawCircle(a,d,b.pointRadius);c.isFilled?a.fillcolor=e:a.filled="false";d=a.getElementsByTagName("fill");d=0==d.length?null:d[0];c.isFilled?
(d||(d=this.createNode("olv:fill",a.id+"_fill")),d.opacity=b.fillOpacity,"OpenLayers.Geometry.Point"===a._geometryClass&&b.externalGraphic&&(b.graphicOpacity&&(d.opacity=b.graphicOpacity),d.src=b.externalGraphic,d.type="frame",b.graphicWidth&&b.graphicHeight||(d.aspect="atmost")),d.parentNode!=a&&a.appendChild(d)):d&&a.removeChild(d);e=b.rotation;if(void 0!==e||void 0!==a._rotation)a._rotation=e,b.externalGraphic?(this.graphicRotate(a,h,k,b),d.opacity=0):"OpenLayers.Geometry.Point"===a._geometryClass&&
(a.style.rotation=e||0);h=a.getElementsByTagName("stroke");h=0==h.length?null:h[0];c.isStroked?(h||(h=this.createNode("olv:stroke",a.id+"_stroke"),a.appendChild(h)),h.on=!0,h.color=b.strokeColor,h.weight=b.strokeWidth+"px",h.opacity=b.strokeOpacity,h.endcap="butt"==b.strokeLinecap?"flat":b.strokeLinecap||"round",b.strokeDashstyle&&(h.dashstyle=this.dashStyle(b))):(a.stroked=!1,h&&(h.on=!1));"inherit"!=b.cursor&&null!=b.cursor&&(a.style.cursor=b.cursor);return a},graphicRotate:function(a,b,c,d){d=
d||a._style;var e=d.rotation||0,f,g;if(d.graphicWidth&&d.graphicHeight){g=Math.max(d.graphicWidth,d.graphicHeight);f=d.graphicWidth/d.graphicHeight;var h=Math.round(d.graphicWidth||g*f),k=Math.round(d.graphicHeight||g);a.style.width=h+"px";a.style.height=k+"px";var l=document.getElementById(a.id+"_image");l||(l=this.createNode("olv:imagedata",a.id+"_image"),a.appendChild(l));l.style.width=h+"px";l.style.height=k+"px";l.src=d.externalGraphic;l.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";
l=e*Math.PI/180;e=Math.sin(l);l=Math.cos(l);e="progid:DXImageTransform.Microsoft.Matrix(M11="+l+",M12="+-e+",M21="+e+",M22="+l+",SizingMethod='auto expand')\n";(l=d.graphicOpacity||d.fillOpacity)&&1!=l&&(e+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+l+")\n");a.style.filter=e;e=new OpenLayers.Geometry.Point(-b,-c);h=(new OpenLayers.Bounds(0,0,h,k)).toGeometry();h.rotate(d.rotation,e);h=h.getBounds();a.style.left=Math.round(parseInt(a.style.left)+h.left)+"px";a.style.top=Math.round(parseInt(a.style.top)-
h.bottom)+"px"}else{var m=new Image;m.onreadystatechange=OpenLayers.Function.bind(function(){if("complete"==m.readyState||"interactive"==m.readyState)f=m.width/m.height,g=Math.max(2*d.pointRadius,d.graphicWidth||0,d.graphicHeight||0),b*=f,d.graphicWidth=g*f,d.graphicHeight=g,this.graphicRotate(a,b,c,d)},this);m.src=d.externalGraphic}},postDraw:function(a){a.style.visibility="visible";var b=a._style.fillColor,c=a._style.strokeColor;"none"==b&&a.fillcolor!=b&&(a.fillcolor=b);"none"==c&&a.strokecolor!=
c&&(a.strokecolor=c)},setNodeDimension:function(a,b){var c=b.getBounds();if(c){var d=this.getResolution(),c=new OpenLayers.Bounds((c.left-this.featureDx)/d-this.offset.x|0,c.bottom/d-this.offset.y|0,(c.right-this.featureDx)/d-this.offset.x|0,c.top/d-this.offset.y|0);a.style.left=c.left+"px";a.style.top=c.top+"px";a.style.width=c.getWidth()+"px";a.style.height=c.getHeight()+"px";a.coordorigin=c.left+" "+c.top;a.coordsize=c.getWidth()+" "+c.getHeight()}},dashStyle:function(a){a=a.strokeDashstyle;switch(a){case "solid":case "dot":case "dash":case "dashdot":case "longdash":case "longdashdot":return a;
default:return a=a.split(/[ ,]/),2==a.length?1*a[0]>=2*a[1]?"longdash":1==a[0]||1==a[1]?"dot":"dash":4==a.length?1*a[0]>=2*a[1]?"longdashdot":"dashdot":"solid"}},createNode:function(a,b){var c=document.createElement(a);b&&(c.id=b);c.unselectable="on";c.onselectstart=OpenLayers.Function.False;return c},nodeTypeCompare:function(a,b){var c=b,d=c.indexOf(":");-1!=d&&(c=c.substr(d+1));var e=a.nodeName,d=e.indexOf(":");-1!=d&&(e=e.substr(d+1));return c==e},createRenderRoot:function(){return this.nodeFactory(this.container.id+
"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){if(!isNaN(b.x)&&!isNaN(b.y)){var d=this.getResolution();a.style.left=((b.x-this.featureDx)/d-this.offset.x|0)-c+"px";a.style.top=(b.y/d-this.offset.y|0)-c+"px";b=2*c;a.style.width=b+"px";a.style.height=b+"px";return a}return!1},drawLineString:function(a,b){return this.drawLine(a,b,!1)},drawLinearRing:function(a,b){return this.drawLine(a,
b,!0)},drawLine:function(a,b,c){this.setNodeDimension(a,b);for(var d=this.getResolution(),e=b.components.length,f=Array(e),g,h,k=0;k<e;k++)g=b.components[k],h=(g.x-this.featureDx)/d-this.offset.x|0,g=g.y/d-this.offset.y|0,f[k]=" "+h+","+g+" l ";b=c?" x e":" e";a.path="m"+f.join("")+b;return a},drawPolygon:function(a,b){this.setNodeDimension(a,b);var c=this.getResolution(),d=[],e,f,g,h,k,l,m,n,p,q;e=0;for(f=b.components.length;e<f;e++){d.push("m");g=b.components[e].components;h=0===e;l=k=null;m=0;
for(n=g.length;m<n;m++)p=g[m],q=(p.x-this.featureDx)/c-this.offset.x|0,p=p.y/c-this.offset.y|0,q=" "+q+","+p,d.push(q),0==m&&d.push(" l"),h||(k?k!=q&&(l?l!=q&&(h=!0):l=q):k=q);d.push(h?" x ":" ")}d.push("e");a.path=d.join("");return a},drawRectangle:function(a,b){var c=this.getResolution();a.style.left=((b.x-this.featureDx)/c-this.offset.x|0)+"px";a.style.top=(b.y/c-this.offset.y|0)+"px";a.style.width=(b.width/c|0)+"px";a.style.height=(b.height/c|0)+"px";return a},drawText:function(a,b,c){var d=this.nodeFactory(a+
this.LABEL_ID_SUFFIX,"olv:rect"),e=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),f=this.getResolution();d.style.left=((c.x-this.featureDx)/f-this.offset.x|0)+"px";d.style.top=(c.y/f-this.offset.y|0)+"px";d.style.flip="y";e.innerText=b.label;"inherit"!=b.cursor&&null!=b.cursor&&(e.style.cursor=b.cursor);b.fontColor&&(e.style.color=b.fontColor);b.fontOpacity&&(e.style.filter="alpha(opacity="+100*b.fontOpacity+")");b.fontFamily&&(e.style.fontFamily=b.fontFamily);b.fontSize&&(e.style.fontSize=
b.fontSize);b.fontWeight&&(e.style.fontWeight=b.fontWeight);b.fontStyle&&(e.style.fontStyle=b.fontStyle);!0===b.labelSelect&&(d._featureId=a,e._featureId=a,e._geometry=c,e._geometryClass=c.CLASS_NAME);e.style.whiteSpace="nowrap";e.inset="1px,0px,0px,0px";d.parentNode||(d.appendChild(e),this.textRoot.appendChild(d));b=b.labelAlign||"cm";1==b.length&&(b+="m");a=e.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[b.substr(0,1)];e=e.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[b.substr(1,1)];d.style.left=
parseInt(d.style.left)-a-1+"px";d.style.top=parseInt(d.style.top)+e+"px"},moveRoot:function(a){var b=this.map.getLayer(a.container.id);b instanceof OpenLayers.Layer.Vector.RootContainer&&(b=this.map.getLayer(this.container.id));b&&b.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);b&&b.redraw()},importSymbol:function(a){var b=this.container.id+"-"+a,c=this.symbolCache[b];if(c)return c;c=OpenLayers.Renderer.symbol[a];if(!c)throw Error(a+" is not a valid symbol name");
a=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);for(var d=["m"],e=0;e<c.length;e+=2){var f=c[e],g=c[e+1];a.left=Math.min(a.left,f);a.bottom=Math.min(a.bottom,g);a.right=Math.max(a.right,f);a.top=Math.max(a.top,g);d.push(f);d.push(g);0==e&&d.push("l")}d.push("x e");c=d.join(" ");d=(a.getWidth()-a.getHeight())/2;0<d?(a.bottom-=d,a.top+=d):(a.left+=d,a.right-=d);c={path:c,size:a.getWidth(),left:a.left,bottom:a.bottom};return this.symbolCache[b]=c},CLASS_NAME:"OpenLayers.Renderer.VML"});
OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;0<=b;--b)this.addLayer({layer:c[b]});if(!this.layers)a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(a){a.layer.events.unregister(this.fetchEvent,
this,this.fetch)},fetch:function(a){if(this.active&&window.localStorage&&a.tile instanceof OpenLayers.Tile.Image){var b=a.tile,c=b.url;!b.layer.crossOriginKeyword&&(OpenLayers.ProxyHost&&0===c.indexOf(OpenLayers.ProxyHost))&&(c=OpenLayers.Control.CacheWrite.urlMap[c]);if(c=window.localStorage.getItem("olCache_"+c))b.url=c,"tileerror"===a.type&&b.setImgSrc(c)}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;0<=a;--a)this.removeLayer({layer:b[a]})}this.map&&
this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a.documentElement;if(b){var c=this["read_"+b.nodeName];a=c?c.call(this,b):(new OpenLayers.Format.GML(this.options?this.options:{})).read(a)}return a},read_msGMLOutput:function(a){var b=
[];if(a=this.getSiblingNodesByTagCriteria(a,this.layerIdentifier))for(var c=0,d=a.length;c<d;++c){var e=a[c],f=e.nodeName;e.prefix&&(f=f.split(":")[1]);f=f.replace(this.layerIdentifier,"");if(e=this.getSiblingNodesByTagCriteria(e,this.featureIdentifier))for(var g=0;g<e.length;g++){var h=e[g],k=this.parseGeometry(h),h=this.parseAttributes(h),h=new OpenLayers.Feature.Vector(k.geometry,h,null);h.bounds=k.bounds;h.type=f;b.push(h)}}return b},read_FeatureInfoResponse:function(a){var b=[];a=this.getElementsByTagNameNS(a,
"*","FIELDS");for(var c=0,d=a.length;c<d;c++){var e=a[c],f={},g,h=e.attributes.length;if(0<h)for(g=0;g<h;g++){var k=e.attributes[g];f[k.nodeName]=k.nodeValue}else for(e=e.childNodes,g=0,h=e.length;g<h;++g)k=e[g],3!=k.nodeType&&(f[k.getAttribute("name")]=k.getAttribute("value"));b.push(new OpenLayers.Feature.Vector(null,f,null))}return b},getSiblingNodesByTagCriteria:function(a,b){var c=[],d,e,f,g;if(a&&a.hasChildNodes()){d=a.childNodes;f=d.length;for(var h=0;h<f;h++){for(g=d[h];g&&1!=g.nodeType;)g=
g.nextSibling,h++;e=g?g.nodeName:"";0<e.length&&-1<e.indexOf(b)?c.push(g):(e=this.getSiblingNodesByTagCriteria(g,b),0<e.length&&(0==c.length?c=e:c.push(e)))}}return c},parseAttributes:function(a){var b={};if(1==a.nodeType){a=a.childNodes;for(var c=a.length,d=0;d<c;++d){var e=a[d];if(1==e.nodeType){var f=e.childNodes,e=e.prefix?e.nodeName.split(":")[1]:e.nodeName;0==f.length?b[e]=null:1==f.length&&(f=f[0],3==f.nodeType||4==f.nodeType)&&(f=f.nodeValue.replace(this.regExes.trimSpace,""),b[e]=f)}}}return b},
parseGeometry:function(a){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);a=this.gmlFormat.parseFeature(a);var b,c=null;a&&(b=a.geometry&&a.geometry.clone(),c=a.bounds&&a.bounds.clone(),a.destroy());return{geometry:b,bounds:c}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(a){a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions));
!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(a={},a[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,a,this.handlerOptions.click||{}))},getInfoForClick:function(a){this.request(a.xy,{})},getInfoForHover:function(a){this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,
0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a=this.layers||this.map.layers,b=[],c,d=a.length-1;0<=d&&(c=a[d],!(c instanceof OpenLayers.Layer.WMTS)||(c.requestEncoding!==this.requestEncoding||this.queryVisible&&!c.getVisibility())||(b.push(c),this.drillDown&&!this.hover));--d);return b},buildRequestOptions:function(a,b){var c=this.map.getLonLatFromPixel(b),d=a.getURL(new OpenLayers.Bounds(c.lon,
c.lat,c.lon,c.lat)),d=OpenLayers.Util.getParameters(d),c=a.getTileInfo(c);OpenLayers.Util.extend(d,{service:"WMTS",version:a.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:c.i,j:c.j});OpenLayers.Util.applyDefaults(d,this.vendorParams);return{url:OpenLayers.Util.isArray(a.url)?a.url[0]:a.url,params:OpenLayers.Util.upperCaseObject(d),callback:function(c){this.handleResponse(b,c,a)},scope:this}},request:function(a,b){b=b||{};var c=this.findLayers();if(0<c.length){for(var d,e,f=0,g=c.length;f<
g;f++)e=c[f],d=this.events.triggerEvent("beforegetfeatureinfo",{xy:a,layer:e}),!1!==d&&(++this.pending,d=this.buildRequestOptions(e,a),d=OpenLayers.Request.GET(d),!0===b.hover&&(this.hoverRequest=d));0<this.pending&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(a,b,c){--this.pending;0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0);if(b.status&&(200>b.status||300<=b.status))this.events.triggerEvent("exception",
{xy:a,request:b,layer:c});else{var d=b.responseXML;d&&d.documentElement||(d=b.responseText);var e,f;try{e=this.format.read(d)}catch(g){f=!0,this.events.triggerEvent("exception",{xy:a,request:b,error:g,layer:c})}f||this.events.triggerEvent("getfeatureinfo",{text:b.responseText,features:e,request:b,xy:a,layer:c})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"});OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]);a.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a);OpenLayers.Util.applyDefaults(a,
this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.format.write(a.params||a);b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c});return b},handleRead:function(a,b){if(b.callback){var c=a.priv;200<=c.status&&300>c.status?(a.data=this.parseData(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},parseData:function(a){var b=
a.responseXML;b&&b.documentElement||(b=a.responseText);return!b||0>=b.length?null:this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"});OpenLayers.Format.WCSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1"},errorProperty:"operationsMetadata",readers:{wcs:OpenLayers.Util.applyDefaults({Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contentMetadata=[];this.readChildNodes(a,b.contentMetadata)},CoverageSummary:function(a,
b){var c={};this.readChildNodes(a,c);b.push(c)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},SupportedCRS:function(a,b){var c=this.getChildValue(a);c&&(b.supportedCRS||(b.supportedCRS=[]),b.supportedCRS.push(c))},SupportedFormat:function(a,b){var c=this.getChildValue(a);c&&(b.supportedFormat||(b.supportedFormat=[]),b.supportedFormat.push(c))}},OpenLayers.Format.WCSCapabilities.v1.prototype.readers.wcs),
ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_1_0"});OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,0.5,0.2,0.1,0.05,0.01,0.005,0.002,0.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:0.5},labelSymbolizer:{},gratLayer:null,initialize:function(a){a=a||{};a.layerName=a.layerName||OpenLayers.i18n("Graticule");OpenLayers.Control.prototype.initialize.apply(this,[a]);
this.labelSymbolizer.stroke=!1;this.labelSymbolizer.fill=!1;this.labelSymbolizer.label="${label}";this.labelSymbolizer.labelAlign="${labelAlign}";this.labelSymbolizer.labelXOffset="${xOffset}";this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.gratLayer){var a=new OpenLayers.Style({},
{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":a}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,
arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var a=this.map.getExtent();if(a){this.gratLayer.destroyFeatures();var b=new OpenLayers.Projection("EPSG:4326"),c=this.map.getProjectionObject(),d=this.map.getResolution();c.proj&&"longlat"==c.proj.projName&&(this.numPoints=1);var e=this.map.getCenter(),f=new OpenLayers.Pixel(e.lon,e.lat);OpenLayers.Projection.transform(f,c,b);for(var e=this.targetSize*d,e=e*e,g,d=0;d<this.intervals.length;++d){g=
this.intervals[d];var h=g/2,k=f.offset({x:-h,y:-h}),h=f.offset({x:h,y:h});OpenLayers.Projection.transform(k,b,c);OpenLayers.Projection.transform(h,b,c);if((k.x-h.x)*(k.x-h.x)+(k.y-h.y)*(k.y-h.y)<=e)break}f.x=Math.floor(f.x/g)*g;f.y=Math.floor(f.y/g)*g;var d=0,e=[f.clone()],h=f.clone(),l;do h=h.offset({x:0,y:g}),l=OpenLayers.Projection.transform(h.clone(),b,c),e.unshift(h);while(a.containsPixel(l)&&1E3>++d);h=f.clone();do h=h.offset({x:0,y:-g}),l=OpenLayers.Projection.transform(h.clone(),b,c),e.push(h);
while(a.containsPixel(l)&&1E3>++d);d=0;k=[f.clone()];h=f.clone();do h=h.offset({x:-g,y:0}),l=OpenLayers.Projection.transform(h.clone(),b,c),k.unshift(h);while(a.containsPixel(l)&&1E3>++d);h=f.clone();do h=h.offset({x:g,y:0}),l=OpenLayers.Projection.transform(h.clone(),b,c),k.push(h);while(a.containsPixel(l)&&1E3>++d);g=[];for(d=0;d<k.length;++d){l=k[d].x;for(var f=[],m=null,n=Math.min(e[0].y,90),h=Math.max(e[e.length-1].y,-90),p=(n-h)/this.numPoints,n=h,h=0;h<=this.numPoints;++h){var q=new OpenLayers.Geometry.Point(l,
n);q.transform(b,c);f.push(q);n+=p;q.y>=a.bottom&&!m&&(m=q)}this.labelled&&(m=new OpenLayers.Geometry.Point(m.x,a.bottom),l={value:l,label:this.labelled?OpenLayers.Util.getFormattedLonLat(l,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(m,l)));f=new OpenLayers.Geometry.LineString(f);g.push(new OpenLayers.Feature.Vector(f))}for(h=0;h<e.length;++h)if(n=e[h].y,!(-90>n||90<n)){f=[];d=k[0].x;p=(k[k.length-1].x-d)/this.numPoints;
l=d;m=null;for(d=0;d<=this.numPoints;++d)q=new OpenLayers.Geometry.Point(l,n),q.transform(b,c),f.push(q),l+=p,q.x<a.right&&(m=q);this.labelled&&(m=new OpenLayers.Geometry.Point(a.right,m.y),l={value:n,label:this.labelled?OpenLayers.Util.getFormattedLonLat(n,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(m,l)));f=new OpenLayers.Geometry.LineString(f);g.push(new OpenLayers.Feature.Vector(f))}this.gratLayer.addFeatures(g)}},CLASS_NAME:"OpenLayers.Control.Graticule"});OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};
OpenLayers.Rico.Corner={round:function(a,b){a=OpenLayers.Util.getElement(a);this._setOptions(b);var c=this.options.color;"fromElement"==this.options.color&&(c=this._background(a));var d=this.options.bgColor;"fromParent"==this.options.bgColor&&(d=this._background(a.offsetParent));this._roundCornersImpl(a,c,d)},changeColor:function(a,b){a.style.backgroundColor=b;for(var c=a.parentNode.getElementsByTagName("span"),d=0;d<c.length;d++)c[d].style.backgroundColor=b},changeOpacity:function(a,b){var c="alpha(opacity="+
100*b+")";a.style.opacity=b;a.style.filter=c;for(var d=a.parentNode.getElementsByTagName("span"),e=0;e<d.length;e++)d[e].style.opacity=b,d[e].style.filter=c},reRound:function(a,b){var c=a.parentNode.childNodes[2];a.parentNode.removeChild(a.parentNode.childNodes[0]);a.parentNode.removeChild(c);this.round(a.parentNode,b)},_roundCornersImpl:function(a,b,c){this.options.border&&this._renderBorder(a,c);this._isTopRounded()&&this._roundTopCorners(a,b,c);this._isBottomRounded()&&this._roundBottomCorners(a,
b,c)},_renderBorder:function(a,b){var c="1px solid "+this._borderColor(b);a.innerHTML="<div "+("style='border-left: "+c+";"+("border-right: "+c)+"'")+">"+a.innerHTML+"</div>"},_roundTopCorners:function(a,b,c){for(var d=this._createCorner(c),e=0;e<this.options.numSlices;e++)d.appendChild(this._createCornerSlice(b,c,e,"top"));a.style.paddingTop=0;a.insertBefore(d,a.firstChild)},_roundBottomCorners:function(a,b,c){for(var d=this._createCorner(c),e=this.options.numSlices-1;0<=e;e--)d.appendChild(this._createCornerSlice(b,
c,e,"bottom"));a.style.paddingBottom=0;a.appendChild(d)},_createCorner:function(a){var b=document.createElement("div");b.style.backgroundColor=this._isTransparent()?"transparent":a;return b},_createCornerSlice:function(a,b,c,d){var e=document.createElement("span"),f=e.style;f.backgroundColor=a;f.display="block";f.height="1px";f.overflow="hidden";f.fontSize="1px";a=this._borderColor(a,b);this.options.border&&0==c?(f.borderTopStyle="solid",f.borderTopWidth="1px",f.borderLeftWidth="0px",f.borderRightWidth=
"0px",f.borderBottomWidth="0px",f.height="0px",f.borderColor=a):a&&(f.borderColor=a,f.borderStyle="solid",f.borderWidth="0px 1px");this.options.compact||c!=this.options.numSlices-1||(f.height="2px");this._setMargin(e,c,d);this._setBorder(e,c,d);return e},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1};OpenLayers.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;this._isTransparent()&&(this.options.blend=
!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")||0<=this.options.corners.indexOf("tl")&&0<=this.options.corners.indexOf("tr")?"":0<=this.options.corners.indexOf("tl")?"left":0<=this.options.corners.indexOf("tr")?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")||0<=this.options.corners.indexOf("bl")&&0<=this.options.corners.indexOf("br")?"":0<=this.options.corners.indexOf("bl")?"left":0<=this.options.corners.indexOf("br")?
"right":""},_borderColor:function(a,b){return"transparent"==a?b:this.options.border?this.options.border:this.options.blend?this._blend(b,a):""},_setMargin:function(a,b,c){b=this._marginSize(b);c="top"==c?this._whichSideTop():this._whichSideBottom();"left"==c?(a.style.marginLeft=b+"px",a.style.marginRight="0px"):"right"==c?(a.style.marginRight=b+"px",a.style.marginLeft="0px"):(a.style.marginLeft=b+"px",a.style.marginRight=b+"px")},_setBorder:function(a,b,c){b=this._borderSize(b);c="top"==c?this._whichSideTop():
this._whichSideBottom();"left"==c?(a.style.borderLeftWidth=b+"px",a.style.borderRightWidth="0px"):"right"==c?(a.style.borderRightWidth=b+"px",a.style.borderLeftWidth="0px"):(a.style.borderLeftWidth=b+"px",a.style.borderRightWidth=b+"px");!1!=this.options.border&&(a.style.borderLeftWidth=b+"px",a.style.borderRightWidth=b+"px")},_marginSize:function(a){if(this._isTransparent())return 0;var b=[5,3,2,1],c=[3,2,1,0],d=[2,1],e=[1,0];return this.options.compact&&this.options.blend?e[a]:this.options.compact?
d[a]:this.options.blend?c[a]:b[a]},_borderSize:function(a){var b=[5,3,2,1],c=[2,1,1,1],d=[1,0],e=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?d[a]:this.options.blend?c[a]:this.options.border?e[a]:this._isTransparent()?b[a]:0},_hasString:function(a){for(var b=1;b<arguments.length;b++)if(0<=a.indexOf(arguments[b]))return!0;return!1},_blend:function(a,b){var c=OpenLayers.Rico.Color.createFromHex(a);c.blend(OpenLayers.Rico.Color.createFromHex(b));
return c},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(a){return 1==a.childNodes.length&&3==a.childNodes[0].nodeType}};OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);a={trigger:OpenLayers.Function.bind(this.previousTrigger,
this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(a,this.previousOptions);this.previous=new OpenLayers.Control.Button(a);a={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(a,this.nextOptions);this.next=new OpenLayers.Control.Button(a);this.clear()},onPreviousChange:function(a,b){a&&!this.previous.active?this.previous.activate():!a&&this.previous.active&&this.previous.deactivate()},
onNextChange:function(a,b){a&&!this.next.active?this.next.activate():!a&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this)this[a]=null},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var a=this.previousStack.shift(),
b=this.previousStack.shift();void 0!=b?(this.nextStack.unshift(a),this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(a);return b},nextTrigger:function(){var a=this.nextStack.shift();void 0!=a&&(this.previousStack.unshift(a),this.restoring=!0,this.restore(a),this.restoring=!1,this.onNextChange(this.nextStack[0],
this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1));return a},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(a){var b,c;if(this.map.getProjectionObject()==
a.projection)c=this.map.getZoomForResolution(a.resolution),b=a.center;else{b=a.center.clone();b.transform(a.projection,this.map.getProjectionObject());c=a.units;var d=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;c=this.map.getZoomForResolution((c&&d?OpenLayers.INCHES_PER_UNIT[c]/OpenLayers.INCHES_PER_UNIT[d]:1)*a.resolution)}this.map.setCenter(b,c)},setListeners:function(){this.listeners={};for(var a in this.registry)this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=
this.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(1<this.previousStack.length)this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);this.previousStack.length>this.limit+1&&this.previousStack.pop();0<this.nextStack.length&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var b in this.listeners)this.map.events.register(b,
this,this.listeners[b]);a=!0;0==this.previousStack.length&&this.initStack()}return a},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var b in this.listeners)this.map.events.unregister(b,this,this.listeners[b]);this.clearOnDeactivate&&this.clear();a=!0}return a},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(a){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,{},a]);this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},createBackBuffer:function(){},clone:function(a){null==a&&(a=new OpenLayers.Layer.UTFGrid(this.getOptions()));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,
[a])},getFeatureInfo:function(a){var b=null;(a=this.getTileData(a))&&a.tile&&(b=a.tile.getFeatureInfo(a.i,a.j));return b},getFeatureId:function(a){var b=null;a=this.getTileData(a);a.tile&&(b=a.tile.getFeatureId(a.i,a.j));return b},CLASS_NAME:"OpenLayers.Layer.UTFGrid"});OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.maps=[];this.tileQueueId={};this.tileQueue={};this.tileCache={};this.tileCacheIndex=[]},addMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(a);this.tileQueue[a.id]=[];for(var b=0,c=a.layers.length;b<c;++b)this.addLayer({layer:a.layers[b]});
a.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){window.clearTimeout(this.tileQueueId[a.id]);if(a.layers)for(var b=0,c=a.layers.length;b<c;++b)this.removeLayer({layer:a.layers[b]});a.events&&a.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this});
delete this.tileQueue[a.id];delete this.tileQueueId[a.id];OpenLayers.Util.removeItem(this.maps,a)}},move:function(a){this.updateTimeout(a.object,this.moveDelay,!0)},zoomEnd:function(a){this.updateTimeout(a.object,this.zoomDelay)},changeLayer:function(a){"visibility"!==a.property&&"params"!==a.property||this.updateTimeout(a.object,0)},addLayer:function(a){a=a.layer;if(a instanceof OpenLayers.Layer.Grid){a.events.on({addtile:this.addTile,retile:this.clearTileQueue,scope:this});var b,c,d;for(b=a.grid.length-
1;0<=b;--b)for(c=a.grid[b].length-1;0<=c;--c)d=a.grid[b][c],this.addTile({tile:d}),d.url&&!d.imgDiv&&this.manageTileCache({object:d})}},removeLayer:function(a){a=a.layer;if(a instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:a}),a.events&&a.events.un({addtile:this.addTile,retile:this.clearTileQueue,scope:this}),a.grid)){var b,c,d;for(b=a.grid.length-1;0<=b;--b)for(c=a.grid[b].length-1;0<=c;--c)d=a.grid[b][c],this.unloadTile({object:d})}},updateTimeout:function(a,b,c){window.clearTimeout(this.tileQueueId[a.id]);
var d=this.tileQueue[a.id];if(!c||d.length)this.tileQueueId[a.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(a);d.length&&this.updateTimeout(a,this.frameDelay)},this),b)},addTile:function(a){if(a.tile instanceof OpenLayers.Tile.Image)a.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this});else this.removeLayer({layer:a.tile.layer})},unloadTile:function(a){a=a.object;a.events.un({beforedraw:this.queueTileDraw,
beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this});OpenLayers.Util.removeItem(this.tileQueue[a.layer.map.id],a)},queueTileDraw:function(a){a=a.object;var b=!1,c=a.layer,d=c.getURL(a.bounds),e=this.tileCache[d];e&&"olTileImage"!==e.className&&(delete this.tileCache[d],OpenLayers.Util.removeItem(this.tileCacheIndex,d),e=null);!c.url||!c.async&&e||(b=this.tileQueue[c.map.id],~OpenLayers.Util.indexOf(b,a)||b.push(a),b=!0);return!b},drawTilesFromQueue:function(a){var b=
this.tileQueue[a.id],c=this.tilesPerFrame;for(a=a.zoomTween&&a.zoomTween.playing;!a&&b.length&&c;)b.shift().draw(!0),--c},manageTileCache:function(a){a=a.object;var b=this.tileCache[a.url];b&&(b.parentNode&&OpenLayers.Element.hasClass(b.parentNode,"olBackBuffer")&&(b.parentNode.removeChild(b),b.id=null),b.parentNode||(b.style.visibility="hidden",b.style.opacity=0,a.setImage(b),OpenLayers.Util.removeItem(this.tileCacheIndex,a.url),this.tileCacheIndex.push(a.url)))},addToCache:function(a){a=a.object;
this.tileCache[a.url]||OpenLayers.Element.hasClass(a.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[a.url]=a.imgDiv,this.tileCacheIndex.push(a.url))},clearTileQueue:function(a){a=a.object;for(var b=this.tileQueue[a.map.id],c=b.length-1;0<=c;--c)b[c].layer===a&&b.splice(c,1)},destroy:function(){for(var a=this.maps.length-1;0<=a;--a)this.removeMap(this.maps[a]);this.tileCacheIndex=this.tileCache=
this.tileQueueId=this.tileQueue=this.maps=null;this._destroyed=!0}});OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0]));if(this.layerInfo){var d=this.layerInfo,e=new OpenLayers.Bounds(d.fullExtent.xmin,d.fullExtent.ymin,
d.fullExtent.xmax,d.fullExtent.ymax);this.projection="EPSG:"+d.spatialReference.wkid;this.sphericalMercator=102100==d.spatialReference.wkid;this.units="esriFeet"==d.units?"ft":"m";if(d.tileInfo){this.tileSize=new OpenLayers.Size(d.tileInfo.width||d.tileInfo.cols,d.tileInfo.height||d.tileInfo.rows);this.tileOrigin=new OpenLayers.LonLat(d.tileInfo.origin.x,d.tileInfo.origin.y);var f=new OpenLayers.Geometry.Point(e.left,e.top),e=new OpenLayers.Geometry.Point(e.right,e.bottom);this.useScales?this.scales=
[]:this.resolutions=[];this.lods=[];for(var g in d.tileInfo.lods)if(d.tileInfo.lods.hasOwnProperty(g)){var h=d.tileInfo.lods[g];this.useScales?this.scales.push(h.scale):this.resolutions.push(h.resolution);var k=this.getContainingTileCoords(f,h.resolution);h.startTileCol=k.x;h.startTileRow=k.y;k=this.getContainingTileCoords(e,h.resolution);h.endTileCol=k.x;h.endTileRow=k.y;this.lods.push(h)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);this.serverResolutions=this.resolutions;this.overrideDPI&&
d.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=d.tileInfo.dpi)}}},getContainingTileCoords:function(a,b){return new OpenLayers.Pixel(Math.max(Math.floor((a.x-this.tileOrigin.lon)/(this.tileSize.w*b)),0),Math.max(Math.floor((this.tileOrigin.lat-a.y)/(this.tileSize.h*b)),0))},calculateMaxExtentWithLOD:function(a){var b=this.tileOrigin.lon+a.startTileCol*this.tileSize.w*a.resolution,c=this.tileOrigin.lat-a.startTileRow*this.tileSize.h*a.resolution;return new OpenLayers.Bounds(b,c-(a.endTileRow-a.startTileRow+
1)*this.tileSize.h*a.resolution,b+(a.endTileCol-a.startTileCol+1)*this.tileSize.w*a.resolution,c)},calculateMaxExtentWithExtent:function(a,b){var c=new OpenLayers.Geometry.Point(a.left,a.top),d=new OpenLayers.Geometry.Point(a.right,a.bottom),c=this.getContainingTileCoords(c,b),d=this.getContainingTileCoords(d,b);return this.calculateMaxExtentWithLOD({resolution:b,startTileCol:c.x,startTileRow:c.y,endTileCol:d.x,endTileRow:d.y})},getUpperLeftTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.left,
this.maxExtent.top);return this.getContainingTileCoords(b,a)},getLowerRightTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(b,a)},getMaxExtentForResolution:function(a){var b=this.getUpperLeftTileCoord(a),c=this.getLowerRightTileCoord(a),d=this.tileOrigin.lon+b.x*this.tileSize.w*a,e=this.tileOrigin.lat-b.y*this.tileSize.h*a;return new OpenLayers.Bounds(d,e-(c.y-b.y+1)*this.tileSize.h*a,d+(c.x-b.x+1)*this.tileSize.w*
a,e)},clone:function(a){null==a&&(a=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options));return OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},initGriddedTiles:function(a){delete this._tileOrigin;OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var a=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(a)},getTileOrigin:function(){if(!this._tileOrigin){var a=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(a.left,
a.bottom)}return this._tileOrigin},getURL:function(a){var b=this.getResolution(),c=this.tileOrigin.lon+b*this.tileSize.w/2,d=this.tileOrigin.lat-b*this.tileSize.h/2;a=a.getCenterLonLat();c=Math.round(Math.abs((a.lon-c)/(b*this.tileSize.w)));d=Math.round(Math.abs((d-a.lat)/(b*this.tileSize.h)));a=this.map.getZoom();if(this.lods){if(b=this.lods[this.map.getZoom()],c<b.startTileCol||c>b.endTileCol||d<b.startTileRow||d>b.endTileRow)return null}else{var e=this.getUpperLeftTileCoord(b),b=this.getLowerRightTileCoord(b);
if(c<e.x||c>=b.x||d<e.y||d>=b.y)return null}b=this.url;e=""+c+d+a;OpenLayers.Util.isArray(b)&&(b=this.selectUrl(e,b));this.useArcGISServer?b+="/tile/${z}/${y}/${x}":(c="C"+OpenLayers.Number.zeroPad(c,8,16),d="R"+OpenLayers.Number.zeroPad(d,8,16),a="L"+OpenLayers.Number.zeroPad(a,2,10),b=b+"/${z}/${y}/${x}."+this.type);b=OpenLayers.String.format(b,{x:c,y:d,z:a});return OpenLayers.Util.urlAppend(b,OpenLayers.Util.getParameterString(this.params))},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(a){a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions));
!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(a={},a[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,a,this.handlerOptions.click||{}))},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,
{})},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a=this.layers||this.map.layers,b=[],c,d,e=a.length-1;0<=e;--e)c=a[e],c instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||c.getVisibility())&&(d=OpenLayers.Util.isArray(c.url)?c.url[0]:c.url,!1!==this.drillDown||this.url||(this.url=d),(!0===this.drillDown||
this.urlMatches(d))&&b.push(c));return b},urlMatches:function(a){var b=OpenLayers.Util.isEquivalentUrl(this.url,a);if(!b&&this.layerUrls)for(var c=0,d=this.layerUrls.length;c<d;++c)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],a)){b=!0;break}return b},buildWMSOptions:function(a,b,c,d){for(var e=[],f=[],g=0,h=b.length;g<h;g++)null!=b[g].params.LAYERS&&(e=e.concat(b[g].params.LAYERS),f=f.concat(this.getStyleNames(b[g])));b=b[0];g=this.map.getProjection();(h=b.projection)&&h.equals(this.map.getProjectionObject())&&
(g=h.getCode());d=OpenLayers.Util.extend({service:"WMS",version:b.params.VERSION,request:"GetFeatureInfo",exceptions:b.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,b.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:d,info_format:b.params.INFO_FORMAT||this.infoFormat},1.3<=parseFloat(b.params.VERSION)?{crs:g,i:parseInt(c.x),j:parseInt(c.y)}:{srs:g,x:parseInt(c.x),y:parseInt(c.y)});0!=e.length&&(d=OpenLayers.Util.extend({layers:e,
query_layers:e,styles:f},d));OpenLayers.Util.applyDefaults(d,this.vendorParams);return{url:a,params:OpenLayers.Util.upperCaseObject(d),callback:function(b){this.handleResponse(c,b,a)},scope:this}},getStyleNames:function(a){return a.params.STYLES?a.params.STYLES:OpenLayers.Util.isArray(a.params.LAYERS)?Array(a.params.LAYERS.length):a.params.LAYERS.replace(/[^,]/g,"")},request:function(a,b){var c=this.findLayers();if(0==c.length)this.events.triggerEvent("nogetfeatureinfo"),OpenLayers.Element.removeClass(this.map.viewPortDiv,
"olCursorWait");else if(b=b||{},!1===this.drillDown){var c=this.buildWMSOptions(this.url,c,a,c[0].params.FORMAT),d=OpenLayers.Request.GET(c);!0===b.hover&&(this.hoverRequest=d)}else{this._numRequests=this._requestCount=0;this.features=[];for(var d={},e,f=0,g=c.length;f<g;f++){var h=c[f];e=OpenLayers.Util.isArray(h.url)?h.url[0]:h.url;e in d?d[e].push(h):(this._numRequests++,d[e]=[h])}for(e in d)c=d[e],c=this.buildWMSOptions(e,c,a,c[0].params.FORMAT),OpenLayers.Request.GET(c)}},triggerGetFeatureInfo:function(a,
b,c){this.events.triggerEvent("getfeatureinfo",{text:a.responseText,features:c,request:a,xy:b});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(a,b,c){var d=b.responseXML;d&&d.documentElement||(d=b.responseText);d=this.format.read(d);!1===this.drillDown?this.triggerGetFeatureInfo(b,a,d):(this._requestCount++,this._features="object"===this.output?(this._features||[]).concat({url:c,features:d}):(this._features||[]).concat(d),this._requestCount===this._numRequests&&
(this.triggerGetFeatureInfo(b,a,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a){"string"==
typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={features:[]};this.readNode(a,b);a=[];for(var c=0,d=b.features.length;c<d;c++){var e=b.features[c];this.internalProjection&&(this.externalProjection&&e.components[0])&&e.components[0].transform(this.externalProjection,this.internalProjection);e=new OpenLayers.Feature.Vector(e.components[0],e.attributes);a.push(e)}return a},readers:{sa:{SamplingPoint:function(a,b){if(!b.attributes){var c=
{attributes:{}};b.features.push(c);b=c}b.attributes.id=this.getAttributeNS(a,this.namespaces.gml,"id");this.readChildNodes(a,b)},position:function(a,b){this.readChildNodes(a,b)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){this.readChildNodes(a,b)},featureMember:function(a,b){var c={attributes:{}};b.features.push(c);this.readChildNodes(a,c)},name:function(a,b){b.attributes.name=this.getChildValue(a)},pos:function(a,b){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(a.getAttribute("srsName")));
OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[a,b])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(a){for(var b=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),c=0,d=a.fois.length;c<d;c++)this.writeNode("FeatureOfInterestId",{foi:a.fois[c]},b);return b},FeatureOfInterestId:function(a){return this.createElementNSPlus("FeatureOfInterestId",{value:a.foi})}}},
CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"});OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",
defaultPrefix:"sos",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={measurements:[],observations:[]};this.readNode(a,b);return b},write:function(a){a=this.writeNode("sos:GetObservation",a);a.setAttribute("xmlns:om",this.namespaces.om);a.setAttribute("xmlns:ogc",this.namespaces.ogc);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,
[a])},readers:{om:{ObservationCollection:function(a,b){b.id=this.getAttributeNS(a,this.namespaces.gml,"id");this.readChildNodes(a,b)},member:function(a,b){this.readChildNodes(a,b)},Measurement:function(a,b){var c={};b.measurements.push(c);this.readChildNodes(a,c)},Observation:function(a,b){var c={};b.observations.push(c);this.readChildNodes(a,c)},samplingTime:function(a,b){var c={};b.samplingTime=c;this.readChildNodes(a,c)},observedProperty:function(a,b){b.observedProperty=this.getAttributeNS(a,this.namespaces.xlink,
"href");this.readChildNodes(a,b)},procedure:function(a,b){b.procedure=this.getAttributeNS(a,this.namespaces.xlink,"href");this.readChildNodes(a,b)},featureOfInterest:function(a,b){var c={features:[]};b.fois=[];b.fois.push(c);this.readChildNodes(a,c);for(var d=[],e=0,f=c.features.length;e<f;e++){var g=c.features[e];d.push(new OpenLayers.Feature.Vector(g.components[0],g.attributes))}c.features=d},result:function(a,b){var c={};b.result=c;""!==this.getChildValue(a)?(c.value=this.getChildValue(a),c.uom=
a.getAttribute("uom")):this.readChildNodes(a,c)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(a,b){var c={};b.timeInstant=c;this.readChildNodes(a,c)},timePosition:function(a,b){b.timePosition=this.getChildValue(a)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(a){var b=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",
a,b);a.eventTime&&this.writeNode("eventTime",a,b);for(var c in a.procedures)this.writeNode("procedure",a.procedures[c],b);for(var d in a.observedProperties)this.writeNode("observedProperty",a.observedProperties[d],b);a.foi&&this.writeNode("featureOfInterest",a.foi,b);this.writeNode("responseFormat",a,b);a.resultModel&&this.writeNode("resultModel",a,b);a.responseMode&&this.writeNode("responseMode",a,b);return b},featureOfInterest:function(a){var b=this.createElementNSPlus("featureOfInterest");this.writeNode("ObjectID",
a.objectId,b);return b},ObjectID:function(a){return this.createElementNSPlus("ObjectID",{value:a})},responseFormat:function(a){return this.createElementNSPlus("responseFormat",{value:a.responseFormat})},procedure:function(a){return this.createElementNSPlus("procedure",{value:a})},offering:function(a){return this.createElementNSPlus("offering",{value:a.offering})},observedProperty:function(a){return this.createElementNSPlus("observedProperty",{value:a})},eventTime:function(a){var b=this.createElementNSPlus("eventTime");
"latest"===a.eventTime&&this.writeNode("ogc:TM_Equals",a,b);return b},resultModel:function(a){return this.createElementNSPlus("resultModel",{value:a.resultModel})},responseMode:function(a){return this.createElementNSPlus("responseMode",{value:a.responseMode})}},ogc:{TM_Equals:function(a){var b=this.createElementNSPlus("ogc:TM_Equals");this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},b);"latest"===a.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},b);return b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",
{value:a.property})}},gml:{TimeInstant:function(a){var b=this.createElementNSPlus("gml:TimeInstant");this.writeNode("gml:timePosition",a,b);return b},timePosition:function(a){return this.createElementNSPlus("gml:timePosition",{value:a.value})}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"});OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(a){this.handlerMode=a;this.resetHandler()},resetHandler:function(){this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null);"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},
this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions));return this.handler?!0:!1},initialize:function(a){a=a||{};a.handlerOptions=a.handlerOptions||this.defaultHandlerOptions;OpenLayers.Control.prototype.initialize.apply(this,[a]);this.resetHandler()},handleEvent:function(a){if(null==
a)this.reset();else{var b=this.map.getLonLatFromPixel(a.xy);if(b){var c=this.findLayers();if(0<c.length){for(var d={},e,f,g=0,h=c.length;g<h;g++)e=c[g],f=OpenLayers.Util.indexOf(this.map.layers,e),d[f]=e.getFeatureInfo(b);this.callback(d,b,a.xy)}}}},callback:function(a){},reset:function(a){this.callback(null)},findLayers:function(){for(var a=this.layers||this.map.layers,b=[],c,d=a.length-1;0<=d;--d)c=a[d],c instanceof OpenLayers.Layer.UTFGrid&&b.push(c);return b},CLASS_NAME:"OpenLayers.Control.UTFGrid"});OpenLayers.Format.CQL=function(){function a(a){function b(){var a=e.pop();switch(a.type){case "LOGICAL":var c=b(),g=b();return new OpenLayers.Filter.Logical({filters:[g,c],type:f[a.text.toUpperCase()]});case "NOT":return a=b(),new OpenLayers.Filter.Logical({filters:[a],type:OpenLayers.Filter.Logical.NOT});case "BETWEEN":return e.pop(),g=b(),a=b(),c=b(),new OpenLayers.Filter.Comparison({property:c,lowerBoundary:a,upperBoundary:g,type:OpenLayers.Filter.Comparison.BETWEEN});case "COMPARISON":return g=
b(),c=b(),new OpenLayers.Filter.Comparison({property:c,value:g,type:d[a.text.toUpperCase()]});case "IS_NULL":return c=b(),new OpenLayers.Filter.Comparison({property:c,type:d[a.text.toUpperCase()]});case "VALUE":return(c=a.text.match(/^'(.*)'$/))?c[1].replace(/''/g,"'"):Number(a.text);case "SPATIAL":switch(a.text.toUpperCase()){case "BBOX":var a=b(),c=b(),g=b(),h=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:k,value:OpenLayers.Bounds.fromArray([h,g,c,
a])});case "INTERSECTS":return g=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:c,value:g});case "WITHIN":return g=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:c,value:g});case "CONTAINS":return g=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:c,value:g});case "DWITHIN":return a=b(),g=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:g,
property:c,distance:Number(a)})}case "GEOMETRY":return OpenLayers.Geometry.fromWKT(a.text);default:return a.text}}for(var c=[],e=[];a.length;){var g=a.shift();switch(g.type){case "PROPERTY":case "GEOMETRY":case "VALUE":e.push(g);break;case "COMPARISON":case "BETWEEN":case "IS_NULL":case "LOGICAL":for(var k=h[g.type];0<c.length&&h[c[c.length-1].type]<=k;)e.push(c.pop());c.push(g);break;case "SPATIAL":case "NOT":case "LPAREN":c.push(g);break;case "RPAREN":for(;0<c.length&&"LPAREN"!=c[c.length-1].type;)e.push(c.pop());
c.pop();0<c.length&&"SPATIAL"==c[c.length-1].type&&e.push(c.pop());case "COMMA":case "END":break;default:throw Error("Unknown token type "+g.type);}}for(;0<c.length;)e.push(c.pop());a=b();if(0<e.length){a="Remaining tokens after building AST: \n";for(c=e.length-1;0<=c;c--)a+=e[c].type+": "+e[c].text+"\n";throw Error(a);}return a}var b={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,
RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(a){var b=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(a);if(b){var c=a.length,b=a.indexOf("(",b[0].length);if(-1<b)for(var d=1;b<c&&0<d;)switch(b++,a.charAt(b)){case "(":d++;break;case ")":d--}return[a.substr(0,b+1)]}},END:/^$/},c={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON",
"BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},d={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,
">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL},e={},f={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},g={},h={RPAREN:3,LOGICAL:2,COMPARISON:1},k;for(k in d)d.hasOwnProperty(k)&&(e[d[k]]=k);for(k in f)f.hasOwnProperty(k)&&(g[f[k]]=k);return OpenLayers.Class(OpenLayers.Format,{read:function(d){var e=d;d=[];var f,g=["NOT","GEOMETRY","SPATIAL",
"PROPERTY","LPAREN"];do{a:{f=g;for(var h=void 0,g=void 0,k=f.length,h=0;h<k;h++){var g=f[h],s=b[g]instanceof RegExp?b[g].exec(e):(0,b[g])(e);if(s){f=s[0];e=e.substr(f.length).replace(/^\s*/,"");f={type:g,text:f,remainder:e};break a}}d="ERROR: In parsing: ["+e+"], expected one of: ";for(h=0;h<k;h++)g=f[h],d+="\n    "+g+": "+b[g];throw Error(d);}e=f.remainder;g=c[f.type];if("END"!=f.type&&!g)throw Error("No follows list for "+f.type);d.push(f)}while("END"!=f.type);d=a(d);this.keepData&&(this.data=d);
return d},write:function(a){if(a instanceof OpenLayers.Geometry)return a.toString();switch(a.CLASS_NAME){case "OpenLayers.Filter.Spatial":switch(a.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+a.property+","+a.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+a.property+", "+this.write(a.value)+", "+a.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+
a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+a.property+", "+this.write(a.value)+")";default:throw Error("Unknown spatial filter type: "+a.type);}case "OpenLayers.Filter.Logical":if(a.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(a.filters[0])+")";for(var b="(",c=!0,d=0;d<a.filters.length;d++)c?c=!1:b+=") "+g[a.type]+" (",b+=this.write(a.filters[d]);return b+")";case "OpenLayers.Filter.Comparison":return a.type==OpenLayers.Filter.Comparison.BETWEEN?
a.property+" BETWEEN "+this.write(a.lowerBoundary)+" AND "+this.write(a.upperBoundary):null!==a.value?a.property+" "+e[a.type]+" "+this.write(a.value):a.property+" "+e[a.type];case void 0:if("string"===typeof a)return"'"+a.replace(/'/g,"''")+"'";if("number"===typeof a)return String(a);default:throw Error("Can't encode: "+a.CLASS_NAME+" "+a);}},CLASS_NAME:"OpenLayers.Format.CQL"})}();OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};this.options.source&&this.setSource(this.options.source)},setSource:function(a){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=a,this.activate()):this.source=
a},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a)if(!this.source)this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(a){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(a)})}},{layerOptions:this.sourceOptions})),this.handler.activate();else if(this.source.events)this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this});return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);
a&&this.source&&this.source.events&&this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this});return a},onSketchComplete:function(a){this.feature=null;return!this.considerSplit(a.feature)},afterFeatureModified:function(a){a.modified&&"function"===typeof a.feature.geometry.split&&(this.feature=a.feature,this.considerSplit(a.feature))},removeByGeometry:function(a,b){for(var c=0,d=a.length;c<d;++c)if(a[c].geometry===b){a.splice(c,1);break}},
isEligible:function(a){return a.geometry?a.state!==OpenLayers.State.DELETE&&"function"===typeof a.geometry.split&&this.feature!==a&&(!this.targetFilter||this.targetFilter.evaluate(a.attributes)):!1},considerSplit:function(a){var b=!1,c=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(a.attributes)){for(var d=this.layer&&this.layer.features||[],e,f,g=[],h=[],k=this.layer===this.source&&this.mutual,l={edge:this.edge,tolerance:this.tolerance,mutual:k},m=[a.geometry],n,p,q,r=0,s=d.length;r<s;++r)if(n=
d[r],this.isEligible(n)){p=[n.geometry];for(var t=0;t<m.length;++t){q=m[t];for(var u=0;u<p.length;++u)if(e=p[u],q.getBounds().intersectsBounds(e.getBounds())&&(e=q.split(e,l)))f=this.events.triggerEvent("beforesplit",{source:a,target:n}),!1!==f&&(k&&(f=e[0],1<f.length&&(f.unshift(t,1),Array.prototype.splice.apply(m,f),t+=f.length-3),e=e[1]),1<e.length&&(e.unshift(u,1),Array.prototype.splice.apply(p,e),u+=e.length-3))}p&&1<p.length&&(this.geomsToFeatures(n,p),this.events.triggerEvent("split",{original:n,
features:p}),Array.prototype.push.apply(g,p),h.push(n),c=!0)}m&&1<m.length&&(this.geomsToFeatures(a,m),this.events.triggerEvent("split",{original:a,features:m}),Array.prototype.push.apply(g,m),h.push(a),b=!0);if(b||c){if(this.deferDelete){d=[];r=0;for(s=h.length;r<s;++r)c=h[r],c.state===OpenLayers.State.INSERT?d.push(c):(c.state=OpenLayers.State.DELETE,this.layer.drawFeature(c));this.layer.destroyFeatures(d,{silent:!0});r=0;for(s=g.length;r<s;++r)g[r].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(h,
{silent:!0});this.layer.addFeatures(g,{silent:!0});this.events.triggerEvent("aftersplit",{source:a,features:g})}}return b},geomsToFeatures:function(a,b){var c=a.clone();delete c.geometry;for(var d,e=0,f=b.length;e<f;++e)d=c.clone(),d.geometry=b[e],d.state=OpenLayers.State.INSERT,b[e]=d},destroy:function(){this.active&&this.deactivate();OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(a){var b=
{url:!0,layer:!0,style:!0,matrixSet:!0},c;for(c in b)if(!(c in a))throw Error("Missing property '"+c+"' in layer configuration.");a.params=OpenLayers.Util.upperCaseObject(a.params);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,a.params,a]);this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop());if(this.matrixIds&&(a=this.matrixIds.length)&&"string"===typeof this.matrixIds[0])for(b=this.matrixIds,this.matrixIds=Array(a),c=0;c<a;++c)this.matrixIds[c]=
{identifier:b[c]}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){if(this.matrix=this.getMatrix())this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=
this.maxExtent)},moveTo:function(a,b,c){!b&&this.matrix||this.updateMatrixProperties();return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.WMTS(this.options));return a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var a;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var b=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*
this.getServerResolution()/2.8E-4,c=Number.POSITIVE_INFINITY,d,e=0,f=this.matrixIds.length;e<f;++e)d=Math.abs(1-this.matrixIds[e].scaleDenominator/b),d<c&&(c=d,a=this.matrixIds[e]);else a=this.matrixIds[this.getIdentifier()];else a={identifier:this.getIdentifier()};return a},getTileInfo:function(a){var b=this.getServerResolution(),c=(a.lon-this.tileOrigin.lon)/(b*this.tileSize.w);a=(this.tileOrigin.lat-a.lat)/(b*this.tileSize.h);var b=Math.floor(c),d=Math.floor(a);return{col:b,row:d,i:Math.floor((c-
b)*this.tileSize.w),j:Math.floor((a-d)*this.tileSize.h)}},getURL:function(a){a=this.adjustBounds(a);var b="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(a)){a=a.getCenterLonLat();var c=this.getTileInfo(a);a=this.dimensions;var d,b=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,c.row,c.col].join(),this.url):this.url;if("REST"===this.requestEncoding.toUpperCase())if(d=this.params,-1!==b.indexOf("{")){b=b.replace(/\{/g,
"${");c={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:c.row,TileCol:c.col};if(a){var e,f;for(f=a.length-1;0<=f;--f)e=a[f],c[e]=d[e.toUpperCase()]}b=OpenLayers.String.format(b,c)}else{e=this.version+"/"+this.layer+"/"+this.style+"/";if(a)for(f=0;f<a.length;f++)d[a[f]]&&(e=e+d[a[f]]+"/");e=e+this.matrixSet+"/"+this.matrix.identifier+"/"+c.row+"/"+c.col+"."+this.formatSuffix;b.match(/\/$/)||(b+="/");b+=e}else"KVP"===this.requestEncoding.toUpperCase()&&
(d={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:c.row,TILECOL:c.col,FORMAT:this.format},b=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[d]))}return b},mergeNewParams:function(a){if("KVP"===this.requestEncoding.toUpperCase())return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)])},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]);a.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a);OpenLayers.Util.applyDefaults(a,this.options||
{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.format,c=OpenLayers.Format.XML.prototype.write.apply(c,[c.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),data:c});return b},handleRead:function(a,b){if(b.callback){var c=a.priv;200<=c.status&&300>c.status?(a.features=this.parseFeatures(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE;
b.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;b&&b.documentElement||(b=a.responseText);return!b||0>=b.length?null:this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(a,b,c,d){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1E4*this.map.getScale())/1E4,d=Math.round(a.left/b);a=
-Math.round(a.top/b);var b=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,e=Math.floor(a/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,c=["/",this.params.map,"/",c,"/",this.params.g.replace(/\s/g,"_"),"/def/t",e,"/l",b,"/t",a,"l",d,".",this.extension],d=this.url;OpenLayers.Util.isArray(d)&&(d=this.selectUrl(c.join(""),d));return d+c.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(a){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(a,b){b.vendorSpecific={tileSets:[]};this.readChildNodes(a,b.vendorSpecific)},TileSet:function(a,b){var c={srs:{},bbox:{},resolutions:[]};this.readChildNodes(a,c);b.tileSets.push(c)},Resolutions:function(a,b){for(var c=this.getChildValue(a).split(" "),d=0,e=c.length;d<e;d++)""!=c[d]&&b.resolutions.push(parseFloat(c[d]))},
Width:function(a,b){b.width=parseInt(this.getChildValue(a))},Height:function(a,b){b.height=parseInt(this.getChildValue(a))},Layers:function(a,b){b.layers=this.getChildValue(a)},Styles:function(a,b){b.styles=this.getChildValue(a)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]},destroy:function(){this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,
removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):
this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();this.outsideViewport||this.minimizeControl();this.redraw();return this.div},onButtonClick:function(a){a=a.buttonElement;a===this.minimizeDiv?this.minimizeControl():a===this.maximizeDiv?this.maximizeControl():a._layerSwitcher===this.id&&(a["for"]&&(a=document.getElementById(a["for"])),a.disabled||("radio"==a.type?(a.checked=!0,this.map.setBaseLayer(this.map.getLayer(a._layer))):
(a.checked=!a.checked,this.updateMap())))},clearLayersArray:function(a){this[a+"LayersDiv"].innerHTML="";this[a+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)return!0;for(var a=0,b=this.layerStates.length;a<b;a++){var c=this.layerStates[a],d=this.map.layers[a];if(c.name!=d.name||c.inRange!=d.inRange||c.id!=d.id||c.visibility!=d.visibility)return!0}return!1},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base");
this.clearLayersArray("data");var a=!1,b=!1,c=this.map.layers.length;this.layerStates=Array(c);for(var d=0;d<c;d++){var e=this.map.layers[d];this.layerStates[d]={name:e.name,visibility:e.visibility,inRange:e.inRange,id:e.id}}var f=this.map.layers.slice();this.ascending||f.reverse();d=0;for(c=f.length;d<c;d++){var e=f[d],g=e.isBaseLayer;if(e.displayInLayerSwitcher){g?b=!0:a=!0;var h=g?e==this.map.baseLayer:e.getVisibility(),k=document.createElement("input"),l=OpenLayers.Util.createUniqueID(this.id+
"_input_");k.id=l;k.name=g?this.id+"_baseLayers":e.name;k.type=g?"radio":"checkbox";k.value=e.name;k.checked=h;k.defaultChecked=h;k.className="olButton";k._layer=e.id;k._layerSwitcher=this.id;g||e.inRange||(k.disabled=!0);h=document.createElement("label");h["for"]=k.id;OpenLayers.Element.addClass(h,"labelSpan olButton");h._layer=e.id;h._layerSwitcher=this.id;g||e.inRange||(h.style.color="gray");h.innerHTML=e.name;h.style.verticalAlign=g?"bottom":"baseline";l=document.createElement("br");(g?this.baseLayers:
this.dataLayers).push({layer:e,inputElem:k,labelSpan:h});e=g?this.baseLayersDiv:this.dataLayersDiv;e.appendChild(k);e.appendChild(h);e.appendChild(l)}}this.dataLbl.style.display=a?"":"none";this.baseLbl.style.display=b?"":"none";return this.div},updateMap:function(){for(var a=0,b=this.baseLayers.length;a<b;a++){var c=this.baseLayers[a];c.inputElem.checked&&this.map.setBaseLayer(c.layer,!1)}a=0;for(b=this.dataLayers.length;a<b;a++)c=this.dataLayers[a],c.layer.setVisibility(c.inputElem.checked)},maximizeControl:function(a){this.div.style.width=
"";this.div.style.height="";this.showControls(!1);null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.div.style.width="0px";this.div.style.height="0px";this.showControls(!0);null!=a&&OpenLayers.Event.stop(a)},showControls:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":"";this.layersDiv.style.display=a?"none":""},loadContents:function(){this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";OpenLayers.Element.addClass(this.layersDiv,
"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer");OpenLayers.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("Overlays");OpenLayers.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.dataLayersDiv,
"dataLayersDiv");this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv));this.div.appendChild(this.layersDiv);var a=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=
OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,a,"absolute");OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton");this.maximizeDiv.style.display="none";this.div.appendChild(this.maximizeDiv);a=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,a,"absolute");OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton");this.minimizeDiv.style.display=
"none";this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));return this.parseFeatures(a)},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNSPlus("atom:feed");b.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));
for(var c=0,d=a.length;c<d;c++)b.appendChild(this.buildEntryNode(a[c]))}else b=this.buildEntryNode(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},buildContentNode:function(a){var b=this.createElementNSPlus("atom:content",{attributes:{type:a.type||null}});if(a.src)b.setAttribute("src",a.src);else if("text"==a.type||null==a.type)b.appendChild(this.createTextNode(a.value));else if("html"==a.type){if("string"!=typeof a.value)throw"HTML content must be in form of an escaped string";b.appendChild(this.createTextNode(a.value))}else"xhtml"==
a.type?b.appendChild(a.value):"xhtml"==a.type||a.type.match(/(\+|\/)xml$/)?b.appendChild(a.value):b.appendChild(this.createTextNode(a.value));return b},buildEntryNode:function(a){var b=a.attributes,c=b.atom||{},d=this.createElementNSPlus("atom:entry");if(c.authors)for(var e=OpenLayers.Util.isArray(c.authors)?c.authors:[c.authors],f=0,g=e.length;f<g;f++)d.appendChild(this.buildPersonConstructNode("author",e[f]));if(c.categories)for(var e=OpenLayers.Util.isArray(c.categories)?c.categories:[c.categories],
h,f=0,g=e.length;f<g;f++)h=e[f],d.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:h.term,scheme:h.scheme||null,label:h.label||null}}));c.content&&d.appendChild(this.buildContentNode(c.content));if(c.contributors)for(e=OpenLayers.Util.isArray(c.contributors)?c.contributors:[c.contributors],f=0,g=e.length;f<g;f++)d.appendChild(this.buildPersonConstructNode("contributor",e[f]));a.fid&&d.appendChild(this.createElementNSPlus("atom:id",{value:a.fid}));if(c.links)for(e=OpenLayers.Util.isArray(c.links)?
c.links:[c.links],f=0,g=e.length;f<g;f++)h=e[f],d.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:h.href,rel:h.rel||null,type:h.type||null,hreflang:h.hreflang||null,title:h.title||null,length:h.length||null}}));c.published&&d.appendChild(this.createElementNSPlus("atom:published",{value:c.published}));c.rights&&d.appendChild(this.createElementNSPlus("atom:rights",{value:c.rights}));(c.summary||b.description)&&d.appendChild(this.createElementNSPlus("atom:summary",{value:c.summary||
b.description}));d.appendChild(this.createElementNSPlus("atom:title",{value:c.title||b.title||this.defaultEntryTitle}));c.updated&&d.appendChild(this.createElementNSPlus("atom:updated",{value:c.updated}));a.geometry&&(b=this.createElementNSPlus("georss:where"),b.appendChild(this.buildGeometryNode(a.geometry)),d.appendChild(b));return d},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,
externalProjection:this.externalProjection})},buildGeometryNode:function(a){this.gmlParser||this.initGmlParser();return this.gmlParser.writeNode("feature:_geometry",a).firstChild},buildPersonConstructNode:function(a,b){var c=["uri","email"],d=this.createElementNSPlus("atom:"+a);d.appendChild(this.createElementNSPlus("atom:name",{value:b.name}));for(var e=0,f=c.length;e<f;e++)b[c[e]]&&d.appendChild(this.createElementNSPlus("atom:"+c[e],{value:b[c[e]]}));return d},getFirstChildValue:function(a,b,c,
d){return(a=this.getElementsByTagNameNS(a,b,c))&&0<a.length?this.getChildValue(a[0],d):d},parseFeature:function(a){var b={},c=null,d=null,e=null,f=this.namespaces.atom;this.parsePersonConstructs(a,"author",b);d=this.getElementsByTagNameNS(a,f,"category");0<d.length&&(b.categories=[]);for(var g=0,h=d.length;g<h;g++){c={};c.term=d[g].getAttribute("term");if(e=d[g].getAttribute("scheme"))c.scheme=e;if(e=d[g].getAttribute("label"))c.label=e;b.categories.push(c)}d=this.getElementsByTagNameNS(a,f,"content");
if(0<d.length){c={};if(e=d[0].getAttribute("type"))c.type=e;(e=d[0].getAttribute("src"))?c.src=e:("text"==c.type||"html"==c.type||null==c.type?c.value=this.getFirstChildValue(a,f,"content",null):"xhtml"==c.type||c.type.match(/(\+|\/)xml$/)?c.value=this.getChildEl(d[0]):c.value=this.getFirstChildValue(a,f,"content",null),b.content=c)}this.parsePersonConstructs(a,"contributor",b);b.id=this.getFirstChildValue(a,f,"id",null);d=this.getElementsByTagNameNS(a,f,"link");0<d.length&&(b.links=Array(d.length));
for(var k=["rel","type","hreflang","title","length"],g=0,h=d.length;g<h;g++){c={};c.href=d[g].getAttribute("href");for(var l=0,m=k.length;l<m;l++)(e=d[g].getAttribute(k[l]))&&(c[k[l]]=e);b.links[g]=c}if(c=this.getFirstChildValue(a,f,"published",null))b.published=c;if(c=this.getFirstChildValue(a,f,"rights",null))b.rights=c;if(c=this.getFirstChildValue(a,f,"summary",null))b.summary=c;b.title=this.getFirstChildValue(a,f,"title",null);b.updated=this.getFirstChildValue(a,f,"updated",null);c={title:b.title,
description:b.summary,atom:b};a=this.parseLocations(a)[0];a=new OpenLayers.Feature.Vector(a,c);a.fid=b.id;return a},parseFeatures:function(a){var b=[],c=this.getElementsByTagNameNS(a,this.namespaces.atom,"entry");0==c.length&&(c=[a]);a=0;for(var d=c.length;a<d;a++)b.push(this.parseFeature(c[a]));return b},parseLocations:function(a){var b=this.namespaces.georss,c={components:[]},d=this.getElementsByTagNameNS(a,b,"where");if(d&&0<d.length){this.gmlParser||this.initGmlParser();for(var e=0,f=d.length;e<
f;e++)this.gmlParser.readChildNodes(d[e],c)}c=c.components;if((d=this.getElementsByTagNameNS(a,b,"point"))&&0<d.length)for(e=0,f=d.length;e<f;e++){var g=OpenLayers.String.trim(d[e].firstChild.nodeValue).split(/\s+/);2!=g.length&&(g=OpenLayers.String.trim(d[e].firstChild.nodeValue).split(/\s*,\s*/));c.push(new OpenLayers.Geometry.Point(g[1],g[0]))}var h=this.getElementsByTagNameNS(a,b,"line");if(h&&0<h.length)for(var k,e=0,f=h.length;e<f;e++){d=OpenLayers.String.trim(h[e].firstChild.nodeValue).split(/\s+/);
k=[];for(var l=0,m=d.length;l<m;l+=2)g=new OpenLayers.Geometry.Point(d[l+1],d[l]),k.push(g);c.push(new OpenLayers.Geometry.LineString(k))}if((a=this.getElementsByTagNameNS(a,b,"polygon"))&&0<a.length)for(e=0,f=a.length;e<f;e++){d=OpenLayers.String.trim(a[e].firstChild.nodeValue).split(/\s+/);k=[];l=0;for(m=d.length;l<m;l+=2)g=new OpenLayers.Geometry.Point(d[l+1],d[l]),k.push(g);c.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(k)]))}if(this.internalProjection&&this.externalProjection)for(e=
0,f=c.length;e<f;e++)c[e]&&c[e].transform(this.externalProjection,this.internalProjection);return c},parsePersonConstructs:function(a,b,c){var d=[],e=this.namespaces.atom;a=this.getElementsByTagNameNS(a,e,b);for(var f=["uri","email"],g=0,h=a.length;g<h;g++){var k={};k.name=this.getFirstChildValue(a[g],e,"name",null);for(var l=0,m=f.length;l<m;l++){var n=this.getFirstChildValue(a[g],e,f[l],null);n&&(k[f[l]]=n)}d.push(k)}0<d.length&&(c[b+"s"]=d)},CLASS_NAME:"OpenLayers.Format.Atom"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:this.observeElement||document})},defaultKeyPress:function(a){var b,c=!0;b=OpenLayers.Event.element(a);if(!b||"INPUT"!=b.tagName&&"TEXTAREA"!=b.tagName&&"SELECT"!=b.tagName){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,
0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:b=this.map.getSize();this.map.pan(0,-0.75*b.h);break;case 34:b=this.map.getSize();this.map.pan(0,0.75*b.h);break;case 35:b=this.map.getSize();this.map.pan(0.75*b.w,0);break;case 36:b=this.map.getSize();this.map.pan(-0.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();
break;default:c=!1}c&&OpenLayers.Event.stop(a)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a;a=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(a,this.yx)},read:function(a){"string"==
typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b);b.version=this.version;return b},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={};b.contents.layers=[];b.contents.tileMatrixSets={};this.readChildNodes(a,b.contents)},Layer:function(a,b){var c={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[],layers:[]};this.readChildNodes(a,c);b.layers.push(c)},Style:function(a,
b){var c={};c.isDefault="true"===a.getAttribute("isDefault");this.readChildNodes(a,c);b.styles.push(c)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(a,b){var c={};this.readChildNodes(a,c);b.tileMatrixSetLinks.push(c)},TileMatrixSet:function(a,b){if(b.layers){var c={matrixIds:[]};this.readChildNodes(a,c);b.tileMatrixSets[c.identifier]=c}else b.tileMatrixSet=this.getChildValue(a)},TileMatrix:function(a,b){var c={supportedCRS:b.supportedCRS};this.readChildNodes(a,
c);b.matrixIds.push(c)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(a,b){var c=this.getChildValue(a).split(" "),d;b.supportedCRS&&(d=b.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2"),d=!!this.yx[d]);b.topLeftCorner=d?new OpenLayers.LonLat(c[1],c[0]):new OpenLayers.LonLat(c[0],c[1])},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},
MatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},ResourceURL:function(a,b){b.resourceUrl=b.resourceUrl||{};var c=a.getAttribute("resourceType");b.resourceUrls||(b.resourceUrls=[]);c=b.resourceUrl[c]={format:a.getAttribute("format"),template:a.getAttribute("template"),resourceType:c};b.resourceUrls.push(c)},WSDL:function(a,b){b.wsdl={};b.wsdl.href=a.getAttribute("xlink:href")},ServiceMetadataURL:function(a,
b){b.serviceMetadataUrl={};b.serviceMetadataUrl.href=a.getAttribute("xlink:href")},LegendURL:function(a,b){b.legend={};b.legend.href=a.getAttribute("xlink:href");b.legend.format=a.getAttribute("format")},Dimension:function(a,b){var c={values:[]};this.readChildNodes(a,c);b.dimensions.push(c)},Default:function(a,b){b["default"]=this.getChildValue(a)},Value:function(a,b){b.values.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});
;
OpenLayers.Events.prototype.BROWSER_EVENTS = ["mouseover", "mouseout", "mousedown", "mouseup", "mousemove", "click", "dblclick", "rightclick", "dblrightclick", "resize", "focus", "blur", "keydown"];
_Prtg.Lang = _Prtg.Lang || { ___: '_Prtg.Lang' };
$.extend(true, _Prtg.Lang, {
	Geomaps: {
		strings: {
			'information': 'Information for Geo Maps',
			'gotosystemsettings':'Go to System & Website Settings',
			'disablegeomaps': 'Disable Geo Maps',
			'geomapserrortitle': 'Geo Maps Error'
			// 'infostring':'<div><p>Select a geo maps provider to use geographical maps in PRTG. Some of them require an API key, but you can use others right away, too.</p><p>Click the &apos;Go to System & Website Settings&apos; button to activate Geo Maps.</p><p>Alternatively, you can disable Geo Maps completely by clicking the &apos;Disable Geo Maps&apos; button.</p></div>'

		}
	}
});
;
/*
_Prtg.GeoMaps.js
*/

(function($){
	var states = {0:'unknown', 1:'unknown', 2:'paused', 3:'up',4:'unusual',5:'warn',6:'downack',7:'down'}
		, methods = {
				init: function init(data, parent) {
					return this.each(function () {
						var $me = $(this)
							, domobj = $me.parent()[0]
							, data = $me.data()
							, initmap = function(domobj, data, parent){
								$me.parent().data('geomap',new geomap(domobj, data.markers.locationlist, data, data.apiKey, null, parent));
								$me.remove();
							};
						$me.children('div').remove();
						if($me.parent().is(':visible'))
							initmap(domobj, data, parent);
						else
							if($me.parent().is('.mobile'))
								$(document).one('pageshow', function(e){
									initmap(domobj, data, parent);
								});
							else
								$me.closest('fieldset').one('groupshow.prtg', function(e){
									e.stopPropagation()
									initmap(domobj, data, parent);
								});
					});
				}
			},

	geomap = function geomap(domobj, data, opts, apiKey, callback, parent){
		var geocoder = this.geolocator()
			, locatortimer = null
			, renderer = OpenLayers.Util.getParameters(window.location.href).renderer
			, me = this
			, i =0
			, bounds = new OpenLayers.Bounds();
		this.renderer = (renderer) ? [renderer] : OpenLayers.Layer.Vector.prototype.renderers;
		this.timer = (function(){if($(parent).Events) return $(parent).Events(); else return null;})();
		this.objectid = opts.objectId;
		this.domobj = domobj;
		this.data = data || {};
		this.callback = callback || null;
		this.apiKey = apiKey;
		this.options = $.extend(true, {
			edit: false,
			provider: 'mapquest',
			maptype: 'roadmap',
			layers:{
				'ovi': {
					"roadmap":{
						"tiles":[
							"/api/tiles.htm?cache=true&dom=ovi1&path=maptile/2.1/maptile/newest/normal.day/${z}/${x}/${y}/256/png8",
							"/api/tiles.htm?cache=true&dom=ovi2&path=maptile/2.1/maptile/newest/normal.day/${z}/${x}/${y}/256/png8",
							"/api/tiles.htm?cache=true&dom=ovi3&path=maptile/2.1/maptile/newest/normal.day/${z}/${x}/${y}/256/png8"
						],
						"opts": {transitionEffect: 'resize', numZoomLevels: _Prtg.Options.geomapZoomLevels, attribution: "Here Maps"}
					},
					"ovisatelite":{
            "tiles":[
              "/api/tiles.htm?cache=true&dom=mqos1&path=maptile/2.1/maptile/newest/hybrid.day/${z}/${x}/${y}/256/png8",
              "/api/tiles.htm?cache=true&dom=mqos2&path=maptile/2.1/maptile/newest/hybrid.day/${z}/${x}/${y}/256/png8",
              "/api/tiles.htm?cache=true&dom=mqos3&path=maptile/2.1/maptile/newest/hybrid.day/${z}/${x}/${y}/256/png8",
              "/api/tiles.htm?cache=true&dom=mqos4&path=maptile/2.1/maptile/newest/hybrid.day/${z}/${x}/${y}/256/png8"
            ],
            "opts": {transitionEffect: 'resize', numZoomLevels: _Prtg.Options.geomapZoomLevels, attribution: "Here Maps"}
					}
				},
				'mapquest':{
					"roadmap": {
            "tiles":[
              "/api/tiles.htm?cache=true&dom=ovi1&path=maptile/2.1/maptile/newest/normal.day/${z}/${x}/${y}/256/png8",
              "/api/tiles.htm?cache=true&dom=ovi2&path=maptile/2.1/maptile/newest/normal.day/${z}/${x}/${y}/256/png8",
              "/api/tiles.htm?cache=true&dom=ovi3&path=maptile/2.1/maptile/newest/normal.day/${z}/${x}/${y}/256/png8"
            ],
            "opts": {transitionEffect: 'resize', numZoomLevels: _Prtg.Options.geomapZoomLevels, attribution: "Here Maps"}
					},
					"mqaerial":{
            "tiles":[
              "/api/tiles.htm?cache=true&dom=mqos1&path=maptile/2.1/maptile/newest/hybrid.day/${z}/${x}/${y}/256/png8",
              "/api/tiles.htm?cache=true&dom=mqos2&path=maptile/2.1/maptile/newest/hybrid.day/${z}/${x}/${y}/256/png8",
              "/api/tiles.htm?cache=true&dom=mqos3&path=maptile/2.1/maptile/newest/hybrid.day/${z}/${x}/${y}/256/png8",
              "/api/tiles.htm?cache=true&dom=mqos4&path=maptile/2.1/maptile/newest/hybrid.day/${z}/${x}/${y}/256/png8"
            ],
            "opts": {transitionEffect: 'resize', numZoomLevels: _Prtg.Options.geomapZoomLevels, attribution: "Here Maps"}
					}
				}
			}
		},opts.options || {});
		this.layers = [];
		this.markers = [];
		this.projection = new OpenLayers.Projection("EPSG:4326");
		this.maxSizeWithIcons = 18;
		this.size = new OpenLayers.Size(_Prtg.Core.objects.geomapIconSize,_Prtg.Core.objects.geomapIconSize);
		this.offset = new OpenLayers.Pixel(-(this.size.w/2), -this.size.h);
		this.controls = [];
		this.vectors = new OpenLayers.Layer.Vector("Vector Layer", {
					renderers: self.renderer
		 });
		this.boxes = new OpenLayers.Layer.Boxes("Boxes");
		this.style_mark={
				cursor:'move',
				fillColor: '#fff',
				fillOpacity:1,
				strokeWidth: 1,
				graphicWidth:14,
				graphicHeight:14,
				graphicXOffset:-7,
				graphicYOffset :-7,
				externalGraphic:'/images/geoflag.png'
				// graphicTitle:'Please drag and drop marker for positioning'
			};
		this.icon = new OpenLayers.Icon('', this.size,0);

		if(this.options.provider.toLowerCase() !== 'google')
			init.call(this);

		function init(){
			$(domobj)
				.removeClass('geomap refreshable')
				.addClass('loading geomap-active geomap-type-'+this.options.provider.toLowerCase());
            if ($(domobj).find('.loadspinner').length == 0){
                $(domobj).append('<div class="loadspinner"></div>')
            }
			this.map = new OpenLayers.Map(domobj, {
					theme: null,
					controls: [
						new OpenLayers.Control.TouchNavigation({
								dragPanOptions: {
										enableKinetic: true
								}
						}),
						new OpenLayers.Control.Zoom(),
						new OpenLayers.Control.Navigation({'zoomWheelEnabled':true,'zoomBoxEnabled':true})
					]
			});
			switch(this.options.provider.toLowerCase()){
				case 'ovi':
					this.layers.push(new OpenLayers.Layer.OSM(this.options.maptype,
							this.options.layers['ovi'][this.options.maptype].tiles,
							this.options.layers['ovi'][this.options.maptype].opts));
					break;
				case 'mapquest':
					this.layers.push(new OpenLayers.Layer.OSM(this.options.maptype,
							this.options.layers['mapquest'][this.options.maptype].tiles,
							this.options.layers['mapquest'][this.options.maptype].opts));
					break;
				default: //mapquest
					this.layers.push(new OpenLayers.Layer.OSM('roadmap',
							this.options.layers['mapquest']['roadmap'].tiles,
							this.options.layers['mapquest']['roadmap'].opts));
					break;

			}
			this.map.addLayers(this.layers);
			this.layers[0].events.register("loadend", this.layers[0], function() {
				$(domobj)
					.removeClass('loading')
					.find('.olMapViewport div:first-child, .olControlDragFeature')
						.css('z-Index','')
        $(domobj).find('.loadspinner').remove()
      });
			this.map.addLayer(this.vectors);
			this.map.addLayer(this.boxes);
			$(this.boxes.div).addClass('boxes')
			this.mapprojection = this.map.getProjectionObject();
			// if(this.layers.length > 1)
				// this.map.addControl(new OpenLayers.Control.LayerSwitcher());
			try{
				this.map.zoomToMaxExtent();
				this.map.setCenter(new OpenLayers.LonLat(0,33).transform(this.projection,this.map.getProjectionObject()));
				this.markers = new OpenLayers.Layer.Markers( "Markers" );
				this.map.addLayer(this.markers);
				this.callback && this.callback.call(domobj);
			}catch(e){if(!!console && console.log)console.log('BAD GEOMAP ERROR:',e);return;}

			this.sparklines = $('#geomapsparkline').parent().css('display','block').end().contents();
			this.sparklines.detach();
			if(!this.options.edit){
				for(var i in this.data){
					if(this.data[i].coordinates[0] !== -1 && this.data[i].coordinates[1] !== -1){
						this.data[i].lonlat = new OpenLayers.LonLat(this.data[i].coordinates[0], this.data[i].coordinates[1])
							.transform(this.projection,this.map.getProjectionObject());
						this.data[i].marker = this.addMarker(this.data[i]);
					}
					if(!!this.data[i].track){
						this.tracking(this, this.data[i]).done(function(d){
							bounds = null;
							bounds = me.markers.getDataExtent();
							if(!!d['values'] && !!d['values'].length){
								bounds.extend(me.vectors.getDataExtent());
								$('#geomapsparkline').append(me.sparklines);
								me.sparkline($('#geomapsparkline'), me.data[i].location, d['values']);
							}else{
								me.map.zoomTo(0);
							}
							me.map.zoomToExtent(bounds, false);
						});
					}
				}
				if(this.markers.markers.length){
					bounds = this.markers.getDataExtent();
					this.map.zoomToExtent(bounds, false);
				}
				for(var marker in this.markers.markers)
					this.markers.markers[marker].icon.imageDiv.firstChild.id = this.markers.markers[marker].icon.imageDiv.id;

				if(this.timer){
					this.timer.subscribe('refresh.events.prtg',$.proxy(this.refresh, this));
					this.timer.subscribeOnce('navigate.prtg', $.proxy(function(e){
						this.timer.unsubscribe('refresh.events.prtg',$.proxy(this.refresh, this));
					}, this));
				}

			} else {
				var $input = $(domobj).next() //parent().find('input[name="lonlat_"]')
					, loc = (function(){
							var ret = $input.val().split(',');
							if(ret.length < 2) {ret=[0,0];} return [parseFloat(ret[0]),parseFloat(ret[1])];
						})()
					, nomarker = (loc[0]===0 && loc[1]===0);
				loc = new OpenLayers.LonLat(loc[0],loc[1])
					.transform(this.projection,this.map.getProjectionObject());

				var geometry = new OpenLayers.Geometry.Point(loc.lon,loc.lat)
					, marker = new OpenLayers.Marker(loc, this.icon);

				this.vectors.addFeatures([new OpenLayers.Feature.Vector(geometry,null,this.style_mark)]);
				if(!nomarker){
					this.markers.addMarker(marker);
					$(marker.icon.imageDiv).hide();
				}
				this.controls.push(new OpenLayers.Control.DragFeature(this.vectors, {
					'onComplete': function(vector, pixel){
						var lonlat = this.map.getLonLatFromPixel(pixel);
						lonlat = lonlat.transform(
								me.map.getProjectionObject(),
								me.projection
						);
            			$input.val(lonlat.lon +',' + lonlat.lat);
						$input.trigger('formchange');
					}
				}));
				// this.controls.push(new OpenLayers.Control.MousePosition());
				$.each(this.controls,function(i,control){
					me.map.addControl(control);
					control.activate();
				});
				if(!nomarker)
					me.map.zoomToExtent(this.markers.getDataExtent(), false);
				else
					this.map.zoomToMaxExtent();
				if(geocoder){
					$('#location_').bind('keyup', function(){
						clearTimeout(locatortimer);
						var elm = this
							, self = me
							, obj = domobj
							, lastsearch = ""
							, locator = function(){
									var search = $(elm).val();
									if(lastsearch !== search)
										geocoder.geocode(search, obj).done(function(result){
											$input.val(result.location|| '0,0');
											var loc = result.location.split(',');
											nomarker = (loc[0]==='0' && loc[1]==='0');

											loc = new OpenLayers.LonLat(loc[0],loc[1])
												.transform(
													self.projection,
													self.map.getProjectionObject()
												);

											self.vectors.destroyFeatures();
											self.markers.destroy();
											self.markers = new OpenLayers.Layer.Markers( "Markers" );
											var geometry = new OpenLayers.Geometry.Point(loc.lon,loc.lat)
												, marker = new OpenLayers.Marker(loc, self.icon.clone());
											self.vectors.addFeatures([new OpenLayers.Feature.Vector(geometry,null,self.style_mark)]);
											if(nomarker)
												self.map.zoomToMaxExtent();
											else{
												self.markers.addMarker(marker);
												$(marker.icon.imageDiv).hide();
												self.map.zoomToExtent(self.markers.getDataExtent(), false);
											}

										});
								lastsearch=search;
								$('#submitbuttonbox').addClass("active");
							};
							locatortimer = setTimeout(locator,1000);
					});
				}
			}
		}
	};
	geomap.prototype.refresh = function geomapRefresh(e){
		var self = this
		$.ajax({
			type: 'GET',
			url:'/api/geomarkers.json',
			data: {id:self.objectid},
			dataType: 'json',
			beforeSend: function(jqXHR){
				jqXHR.peNumber = 'PE1003'
			}
		}).done(function(json){
			self.vectors.removeAllFeatures();
			while(self.markers.markers.length){
				m = self.markers.markers[0];
				self.markers.removeMarker(m);
				m.destroy();
			}
			while(self.boxes.markers.length){
				m = self.boxes.markers[0];
				self.boxes.removeMarker(m);
				m.destroy();
			}
			self.data = json.locationlist;
			for(var i in self.data){
				if(!!self.data[i].track)
					self.tracking(self, self.data[i]);
				if(self.data[i].coordinates[0] !== -1 && self.data[i].coordinates[1] !== -1){
					self.data[i].lonlat = new OpenLayers.LonLat(self.data[i].coordinates[0], self.data[i].coordinates[1])
						.transform(self.projection,self.map.getProjectionObject());
					self.data[i].marker = self.addMarker.apply(self, [self.data[i]]);
				}
			}
		});
	};
	geomap.prototype.geolocator = function(){
		self = this;
		return {
			geocode: function(search, elm){
				var dfd = $.Deferred()
					, loc = search.replace(/(\r\n|\n|\r)/g," ").replace(/(\{(.*)\})/g,"").match( /-?\d+\.\d+/g ) || []
					, func = {
						"0": function(search){
							$.ajax({
								dataType: "json",
								global: false,
								url: '/api/geolocator.htm',
								data: {
									cache: false,
									dom: 0,
									path: search.replace(/ /g,'+') + '&key=' + self.apiKey
								}
							}).done(function (resp, status) {
								if(!!resp
								&& resp.status === "OK"
								&& resp.results.length > 0
								&& !!resp.results[0].geometry
								&& !!resp.results[0].geometry.location) {
									loc[0] = resp.results[0].geometry.location.lng;
									loc[1] = resp.results[0].geometry.location.lat;
									resp.location =  loc.join(',');
									dfd.resolve(resp);
									return;
								} else {
									func['2'](search);
								}
							}).fail(function(resp){
									func['2'](search);
							});
						},
						"2": function(search){
							$.ajax({
								dataType: "json",
								global: false,
								url: '/api/geolocator.htm',
								data: {
									cache: false,
									dom: 2,
									path: search.replace(/ /g,'+')
								}
							}).done(function (resp, status) {
								if(!!resp
								&& resp.Response.View.length > 0
                				&& resp.Response.View[0].Result.length > 0
                				&& !!resp.Response.View[0].Result[0].Location.DisplayPosition) {
									loc[0] = resp.Response.View[0].Result[0].Location.DisplayPosition.Longitude;
									loc[1] = resp.Response.View[0].Result[0].Location.DisplayPosition.Latitude;
									resp.location =  loc.join(',');
									dfd.resolve(resp);
									return;
								} else {
                                    resp.nomarker = true;
                                    dfd.reject(resp);
								}
							}).fail(function(resp){
                                resp.nomarker = true;
                                dfd.reject(resp);
							});
						}
					};
		var apiEntry = !!self.apiKey ? "0" : "2";
        if(loc.length !== 2)
				  func[apiEntry](search.split('\n')[0].trim());
        else
          dfd.resolve({location:loc[1]+','+loc[0]});
				return dfd.promise();
			}
		};
	};
	geomap.prototype.sparkline = function sparkline($elm,location, data){
		$elm.find('[locationname]').html(location).removeAttr('locationname');
		$elm.find('[data-x-axis]').each(function(){
	    var $elm = $(this)
	    	, xpart = $elm.data().xAxis
	    	, ypart = $elm.data().yAxis;
	    if(data[0][xpart.property]===undefined){
	    	$elm.hide();
	    	return;
	    }
	    var pxwidth = $elm.width()
	      , pxheight = $elm.height()
	      , top = ((parseInt($elm.css('font-size'),10)||10) >> 1)
	      , graph = d3.select($elm[0])
	      	.append("svg:svg")
	      	.attr("width","100%")
	      	.attr("height","100%")
	      	.append('g')
	      	.attr("transform", "translate("+((pxwidth-xpart.xrange[1])/2) +","+top+")")
	      , xtime = (typeof(data[0][xpart.property])==='object')
	      , x = (xtime
	      		? d3.time.scale().range(xpart.xrange)
	      		: d3.scale.linear().range(xpart.xrange))
	      , xAxis = (xpart.display ? d3.svg.axis().scale(x).orient(xpart.display.split(' ')[0]) : null);
	    $elm.removeAttr('data-x-axis');
	    graph.append('svg:rect')
	      .attr('width', "100%")
	      .attr('height',"100%")
	      .attr('fill', "white");

	    if(xtime){
	    	if(!!xAxis){
					xAxis
						.tickSize(3)
						.tickPadding(1)
						.outerTickSize(0);
			  }
		    x.domain([
		    	d3.min(data.map(function(d){return d[xpart.property];})),
		    	d3.max(data.map(function(d){return d[xpart.property];}))
		    	// d3.extent(data,function(d){return d[xpart.property];})
		    ]);
				graph.append("g")
		      .attr("class", "x axis " +xpart.display)
		      .attr("transform", "translate(0," + (xpart.display==="top"?0:xpart.yrange[0]) + ")")
		      .call(xAxis)
				  .selectAll("text")
						.attr("transform", "rotate(62)")
				    .style("text-anchor", "start");
				graph.append("text")
					.attr('class','x-label')
					.attr("transform", 'translate(' + (xpart.xrange[1] / 2) + ',' + (pxheight - 3*top) + ')')
					.style("text-anchor", "middle")
					.text(xpart.label);
		  }else{
				xAxis
					.tickSize(3)
					.tickPadding(1)
					.outerTickSize(0);
		    x.domain([
		    	0,
		    	d3.max(data.map(function(d){return d[xpart.property];}))
		    ]);
				graph.append("g")
		      .attr("class", "x axis " +xpart.display)
		      .attr("transform", "translate(0," + (xpart.display==="top"?0:xpart.yrange[0]) + ")")
		      .call(xAxis)
				  .selectAll("text")
				    .style("text-anchor", "middle");
				graph.append("text")
					.attr('class','x-label')
					.attr("transform", 'translate(' + (xpart.xrange[1] / 2) + ',' + (pxheight - 7*top) + ')')
					.style("text-anchor", "middle")
					.text(xpart.label);
		  }

	    if(!!xAxis){
				graph.append("g")
		      .attr("class", "x axis ticksonly " +(xpart.display==="top"?"bottom":"top"))
		      .attr("transform", "translate(0," + (xpart.display==="top"?xpart.yrange[0]:0) + ")")
		      .call(xAxis)
			}

      ypart.forEach(function(ypart){
      	if(data[0][ypart.property]===undefined){
					graph.append("g")
			      .attr("class", "y axis " +ypart.display)
						.attr("transform", "translate("+(ypart.display==='left'?0:xpart.xrange[1])+",0)")
						.append("path")
							.attr('class', 'domain')
							.attr('d','M0,0H0V'+xpart.yrange[0]+'H0');
      		return;
      	}
	      var y = d3.scale.linear().range(xpart.yrange)
			  , yAxis = (ypart.display ? d3.svg.axis().scale(y).orient(ypart.display.split(' ')[0]) : null)
	      , chart = d3.svg[ypart.chart.split(' ')[0]]()
	        .x(function(d){return  x(d[xpart.property]); })
	       	.interpolate('linear');

		    if(!!chart.y0)
		    	chart
		        .y0(xpart.yrange[0])
		        .y1(function(d){return y(d[ypart.property]);})
		    else
		    	chart
		        .y(function(d){return y(d[ypart.property]);})
		 	 	y.domain([0, d3.max(data.map(function(d){return d[ypart.property];}))]);
				graph.append("svg:path")
					.attr('class',ypart.property + ' data ' + ypart.chart)
					.attr("d", chart(data));
				if(!!yAxis){
					yAxis
						.tickSize(3)
						.tickPadding(1)
						.outerTickSize(0);
					graph.append("g")
			      .attr("class", "y axis " +ypart.display)
						.attr("transform", "translate("+(ypart.display==='left'?0:xpart.xrange[1])+",0)")
			      .call(yAxis);
			  }else{
					graph.append("g")
			      .attr("class", "y axis " +ypart.display)
						.attr("transform", "translate("+(ypart.display==='left'?0:xpart.xrange[1])+",0)")
						.append("path")
							.attr('class', 'domain')
							.attr('d','M0,0H0V'+xpart.yrange[0]+'H0');
			  }
				graph.append("text")
					.attr('class','y-label ' +ypart.property)
					.attr("transform", "rotate(-90)")
					.attr("y", (ypart.display==='left'?0:xpart.xrange[1]))
					.attr("x", xpart.yrange[0] / -2)
					.attr("dy", (ypart.display==='left'?"-3.4em":"4em"))
					.style("text-anchor", "middle")
					.text(ypart.label);

    	});
    });
	},
	geomap.prototype.tracking = function tracking(self, item){
		var style = $.extend(true,{
					  strokeColor: '#0000ff',
					  strokeOpacity: 0.5,
					  strokeWidth: 5
					},(item.track.style||{}))
				, pt = null
				, vt = null
				, publicmapid = _Prtg.Util.getUrlVars()["mapid"];
		if(!!publicmapid)
			item.track.mapid = publicmapid;
		item.track.style && delete item.track.style;
		return $.ajax({
			'url': '/api/table.json',
			// 'url': '/historicdata_1.htm',
			'dataType': 'json',
			'data': $.extend(true,item.track,{
				content:'values',
				sortby:'-datetime',
				columns:'datetime=treejson,value_',
				graphid:0,
				usecaption:true
			}),
			'type':'post',
			beforeSend: function(jqXHR){
				jqXHR.ignoreError = true;
				jqXHR.peNumber = 'PE1003b';
				jqXHR.ignoreManager = true;
			}
		})
		.fail(function(){})
		.done(function(d){
			var points=[]
				, olElm
				, olElx

			if(!!d['values']){
				d['values'] = $.map(d['values'].reverse(), function(elm){
					var lg = elm['Longitude'];
					var lt = elm['Latitude'];
					if(!!lg && !!lt && lg!=="Error" && lt !== "Error"){
						elm.point = new OpenLayers.Geometry.Point(lg,lt).transform(self.projection, self.mapprojection);

						if(!!pt){
							elm['Distance'] = (Math.round(elm.point.distanceTo(pt.point)) / 1000);
							elm['Speed'] = elm.Distance * 3600000 / (elm.datetime - vt.datetime);
							elm['Distance'] += pt.Distance;
							if(elm['Speed'] > 1235.0 || elm['Speed'] < 0.0001){
								vt = elm;
								return null;
							}
						}else{
							elm['Distance'] = 0;
							elm['Speed'] = 0;
						}
						points.push(elm.point);
						// elm.date = new Date((25569 - elm.datetime) * -86400); convert delphi tdatetime
						elm['Date'] = new Date(elm.datetime);
						pt = elm;
						vt = elm;
						if(!!item.track.waypointmarker){
							var boxclass = item.track.waypointstyle || 'box';
							self.boxes.addMarker(
								(
									olElm = new OpenLayers.Marker.Box(
										OpenLayers.Bounds.fromArray([pt.point.x-item.track.waypointmarker,pt.point.y-item.track.waypointmarker,pt.point.x+item.track.waypointmarker,pt.point.y+item.track.waypointmarker])
									)
								)
							);
							olElm.setBorder(style.strokeColor, style.strokeWidth);

							$(olElm.div)
								.css({
									'opacity':style.strokeOpacity,
									'background-color':style.strokeColor
								})
								.addClass(boxclass)
								.attr('title',elm.Date.toPrtgString()+' ['+lg+','+lt+']')
								.attr('data-original-title',elm.Date.toPrtgString()+' ['+lg+','+lt+']')
								.html('<span>'+elm.Date.toLocaleTimeString()+'</span>');
						}
						return elm;
					} else {
						return null;
					}
				});
				if(points.length){
					item.coordinates[0] = pt['Longitude'];
					item.coordinates[1] = pt['Latitude'];
					item.lonlat = new OpenLayers.LonLat(item.coordinates[0], item.coordinates[1])
						.transform(self.projection,self.mapprojection);
					item.marker.lonlat = item.lonlat;
					item.marker.moveTo(self.map.getLayerPxFromLonLat(item.lonlat));
					self.vectors.addFeatures(
						new OpenLayers.Feature.Vector(
							(
								olElm = OpenLayers.Geometry.Polygon.createRegularPolygon(
									pt.point
									,Math.round((pt['Accuracy']||0))
									, 50
								)
							)
						)
					);
					olElx = new OpenLayers.Feature.Vector(olElm, null, style);
					self.vectors.addFeatures([olElx]);
					self.vectors.addFeatures(
						new OpenLayers.Feature.Vector(
							(
								olElm = new OpenLayers.Geometry.LineString(points.reverse())
							)
						)
					);
					olElx = new OpenLayers.Feature.Vector(olElm, null, style);
					self.vectors.addFeatures([olElx]);
				}else{
					item.coordinates[0] = 0;
					item.coordinates[1] = 0;
					item.lonlat = new OpenLayers.LonLat(item.coordinates[0], item.coordinates[1])
						.transform(self.projection,self.mapprojection);
					item.marker.lonlat = item.lonlat;
					item.marker.moveTo(self.map.getLayerPxFromLonLat(item.lonlat));
				}
			}
		});
	}
	geomap.prototype.addMarker = function addMarker(data){
		var $link = $(data.link)
						.addClass('mapmarker')
						.attr('href', "/devices.htm?filter_location=@sub("+encodeURIComponent(data.location)+")")
			, marker = new OpenLayers.Marker(data.lonlat)
			, icon = marker.icon;

		icon.url = '';
    if(!!_Prtg.supportsTouch)
      marker.events.register("touchstart", marker,  function(){});

		$link.addClass('locationlist');
		if(this.size.w < this.maxSizeWithIcons){
			$link.removeAttr('style');
			$link.removeClass('devicemenu probemenu groupmenu');
		}

		icon.imageDiv.id = icon.imageDiv.firstChild.id = data.id;
		this.markers.addMarker(marker);
		// marker.icon.imageDiv.title = data.location;
		$(marker.icon.imageDiv)
			.addClass(states[data.state] + ' map-marker' +(this.size.w < this.maxSizeWithIcons?' map-marker-small':''))
			.html($link.text('')[0].outerHTML)
			.attr('data-delay','500')
			.attr('data-title',data.location);
		return marker;
	};

	geomap.prototype.disable = function disable(active){
		for(var i=0, l = this.map.controls.length; i<l; ++i)
			if(this.map.controls[i].displayClass === "olControlDragFeature"){
				if(!active)
					this.map.controls[i].deactivate();
				else
					this.map.controls[i].activate();
				break;
			}
	}

	try{_Prtg.Core.objects.geomapMaxZoomLevel}catch(e){
		$.extend(true,window,{"_Prtg":{Core:{objects:{geomapMaxZoomLevel:15,geomapIconSize:22}}}});
	}

	$.fn.geomap = function (method) {
		if (methods[method]) {
			return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if (typeof method === 'object' || !method) {
			return methods.init.apply(this, arguments);
		} else {
			$.error('Method ' + method + ' does not exist on jQuery.sensortree');
		}
	};

})(jQuery);
;

//_Prtg.SensorTree.js
(function sensortree($) {
  $.extend(true, window._Prtg,{Plugins:{'groupviewsize': {init:function(){}}}});

    var regSimulated = /simulated/
      , regPaused = /paused/
      , regAutodisco = /autodisco/
      , regCopy = /copy/
      , regFixed = /fixed/
      , regDisconnected = /disconnected/
      , regUnapproved = /unapproved/;

    _Prtg.ObjectTree={printErrors: function prinErrors(group, res, objid, errors, librarymenu){
      var result = res.sensorxref
        , $sensors = $("sensor.replace"+objid)
        , push = false;
        if(!group.errors){
          group.errors = [];
          push = true;
        }
      for(var x=0, m=result.length; x < m && errors > 0; ++x){
        if(result[x].probegroupdevice.indexOf(objid) > -1){
          var sensor = result[x]
            , simulated = (regSimulated.test(sensor.info) === true)
            , paused = ($.inArray(sensor.status, [7,8,9,11,12]) !== -1) || simulated
            , pausedbyparent = paused && (regPaused.test(sensor.info) === false)
            , classes = [];

            push && group.errors.push(sensor);

            if(!sensor.access) classes.push('noContextMenu');
            if(librarymenu) classes.push('librarymenu');
            classes.push((regFixed.test(sensor.info) === true ? 'fixed' : ''));
            classes.push((paused ? (pausedbyparent && !simulated ? 'ispausedbyparent' : 'ispaused') : 'isnotpaused'));
            classes.push((sensor.favorite === ''?'isnotfavorite':'isfavorite'));
            classes.push(($.inArray(sensor.status, [5,13,14]) > -1?'sensorred':''));

          var c = (sensor.access
                ?'<icon popup="333"></icon><name popup="3333">'+sensor.name+"</name>"
                :"<icon></icon><name>"+sensor.name+"</name>")
                +"<value>"+(sensor.lastvalue==='-'?'':sensor.lastvalue)+"</value>"
                +"<favorit><span class='" + (sensor.favorite?'objectisfavorite':'objectisnotfavorite icon-gray') +" ui-icon ui-icon-flag' onclick='_Prtg.objectTools.faveObject.call(this,"+sensor.objid+",\"toggle\");return false;'></span></favorit>";
            $sensors.eq(--errors).replaceWith($('<sensor/>',{
              'idx':x,
              'objid':sensor.objid,
              'type':"sensor",
              'class':classes.join(' ').trim() + ' group status'+sensor.status,
              'title':(''+sensor.name).replace('"',' ')+' (' + (sensor.lastvalue === '-' ? '?' : sensor.lastvalue) +')',
              'goto':"true"}).html(c));
          $s = null;
        }
      }
      $sensors = null;
    }
  };
  var Layouts = {},
      _Layouts = {
          'sensortreesmall': {
              layout: 'tiny', action: 1,
              sensheight: {
                  'overview': [{'default': 20, 'probe': 20, 'group': 20, 'device': 15, 'library': 20, 'node': 20, 'margin': 10}, //expanded
                              {'default': 15, 'probe': 15, 'group': 15, 'device': 17, 'library': 15, 'node': 15, 'margin': 10}]  //collapsed
              }
          },
          'sensortreenormal': {
              layout: 'small', action: 2,
              sensheight: {
                  'overview': [{'default': 24, 'probe': 24, 'group': 24, 'device': 30, 'library': 35, 'node': 24, 'margin': 24}, //expanded
                              {'default': 20, 'probe': 20, 'group': 20, 'device': 20, 'library': 20, 'node': 20, 'margin': 28}], //collapsed
                  'managed': [{'default': 20, 'probe': 20, 'group': 20, 'device': 32, 'library': 26, 'node': 26, 'margin': 16},
                              {'default': 15, 'probe': 15, 'group': 15, 'device': 17, 'library': 15, 'node': 15, 'margin': 10}]
              }
          },
          'sensortreel': {
              layout: 'medium', action: 3,
              sensheight: {
                  'overview': [{'default': 24, 'probe': 24, 'group': 24, 'device': 59, 'library': 33, 'node': 33, 'margin': 26},
                              {'default': 26, 'probe': 26, 'group': 26, 'device': 26, 'library': 26, 'node': 26, 'margin': 23}]
              }
          },
          'sensortreexl': {
              layout: 'large', action: 4,
              sensheight: {
                  'overview': [{'default': 24, 'probe': 24, 'group': 24, 'device': 31, 'library': 31, 'node': 31, 'margin': 0},  //expanded
                                {'default': 0, 'probe': 0, 'group': 0, 'device': 0, 'library': 0, 'node': 0, 'margin': 46}]  //collapsed
              }
          },
      'treemap': { layout: 'treemap', action: 5, 'update': null},
      'sunburst': { layout: 'sunburst', action: 7, 'update': null}
    },
    Views = {},
    dataViews = function dataViews(view, opts) {
      if (Views[view] === undefined)
        Views[view] = new Slick.Data.RemoteModel(opts);
      return Views[view];
    },
    calcSensorColumns = null,
    postDataLoadRequest = null,
    postDataLoadTimer = null,
    setStyle = function setStyle($style, rules) {
      if ($style[0].styleSheet) { // IE
        $style[0].styleSheet.cssText = rules.join(' ');
      }
      else {
        $style[0].appendChild(document.createTextNode(rules.join(' ')));
      }
    },
    removeStyles = function removeStyles($style) {
      if (!!$style) {
        $style.remove();
      } else {
        for (var i = 0; i < document.styleSheets.length; ++i)
          if (document.styleSheets[i].title === 'sensortree')
            if (document.styleSheets[i].ownerNode)
              document.styleSheets[i].ownerNode.parentNode.removeChild(document.styleSheets[i].ownerNode);
      }
    },
    methods = {
      init: function init(options, junk, sensors) {
        var defaults = {
          layout: 'sensortreenormal',
          enableEditMode: true,
          editMode: false,
          dragMode: false,
          url: '/url/must/override',
          data: {},
          dataModel: 'RemoteModel',
          cached: false,
          hideControls: false,
          controlsParent: null,
          levelIndentCssWidth: '19px',
          loadDataOnRefresh: false,
          gridOptions: {
            fullHeight: false,
            editable: false,
            enableAddRow: false,
            enableCellNavigation: false,
            enableAsyncPostRender: true,
            multiSelect: false,
            asyncPostRenderDelay: 0
          },
          adornerOffsetX: 1,
          adornerOffsetY: 1,
          ___: 'defaults'
        };

        return this.each(function () {
          var $this = $(this)
            , $blocker
            , grid = null
            , data = $this.data('sensortree')
            , loadingIndicator = null
            , id = 'Prtg-ST-' + $.now()
            , lastFrom = -1
            , dataView = null
            , sensWidth = 0
            , collapsedSensWidth = 0
            , dragging = false
            , popupTimer = null
            , currentCursor = 'cursor-notallowed'
            , opts = null
            , $style = $("<style type='text/css' rel='stylesheet' />").appendTo($("head"))
            , $searchStyle = null
            , indent = 0
            , units = 'px'
            , rules = []
            , $controlsParent= $(this)
            , update = null
            , fixedColumnsToatalWidth = 0;

          Layouts[id] = $.extend(true,{},_Layouts);
          removeStyles();
          $this.on("destroyed",function(){
            if (!!$searchStyle && $searchStyle.length)
              removeStyles($searchStyle);
          });
          opts = $.extend(true, {}, defaults, options || {});
          $controlsParent = opts.controlsParent ? $(opts.controlsParent) : $controlsParent;
          opts.dragMode = opts.editMode || opts.dragMode;
          jQuery.event.special.drag.defaults.distance = _Prtg.Core.objects.dndSensitivity;
          //load filters
          try { if(!opts.filters) opts.filters = window.sessionStorage.getItem('sensorfilter').split(',');}catch(e){}
          //setting up the dataview
          if (!!opts.cached)
            dataView = dataViews(opts.url + '?' + jQuery.param(opts.data), opts);
          else
            dataView = dataViews(id, opts);
          opts.layout = opts.layout.toLowerCase();
          dataView.sensorHeights(!Layouts[id][opts.layout].sensheight || Layouts[id][opts.layout].sensheight[!!opts.displayMode ? opts.displayMode : 'overview']);
          opts.layout = Layouts[id][opts.layout].layout;
          $this.attr('id', id).addClass(opts.layout);
          $style.title = id;
          indent = parseFloat(opts.levelIndentCssWidth);
          units = opts.levelIndentCssWidth.slice(-2);
          if (/px|em|ex|pt|cm|in/.test(units) === false)
            units = 'px';
          rules.push('#' + id + ' level, #' + id + ' toggler{width:' + indent + units + ';}');
          for (var i = 1; i < 100; ++i) {
            rules.push('#' + id + ' .level' + i + ' {left:' + (indent * (i-1)) + units + ';}');
          }

          if(!!opts.filters)
            $this.addClass('hide'+ opts.filters.join(' hide'));
          // rules.push(("#" + id + " .treeItem>level:first-child *{ width:0px; }"));
          // rules.push(("#" + id + " .treeItem>level:first-child{ width:0px; }"));
          setStyle($style, rules);
          // Subscribe to Data View Events
          var onDataLoaded = function onDataLoaded(e, args, callback) {
            var self = this;
            if (!args.update) {
              $.when(self.initializeHeights(null, null, true)).done(function () {
                self.getData().collapse.call(self.getData(), args.from, args.to, self, true);
                self.updateCanvasHeight();
              });
            }
            $.when(self.initializeHeights(null, null, true)).done(function () {
              self.getData().refreshLeafs.call(self.getData(), self).always(function () {
                if (!!dragging && !!dragEvent && !!dragData) {
                  $.event.special.drop.reinit.apply(self);
                }
              });
            });
            if (!args.update) {
              self.invalidate();
              !!callback && callback();
            }
            $this.triggerHandler('dataloaded',self.getData().getItem(0));
            !!$this.data('sensortree') && !!$this.data('sensortree').dataview.update && $this.data('sensortree').dataview.update(true);
          };
          var onRowCountChanged = function onRowCountChanged(e, args) {
            var self = this;
            $.when(self.initializeHeights(args.from, args.to, true)).done(function () {
              self.invalidate();
            });

          };
          dataView.onRowCountChanged.subscribe(onRowCountChanged);
          dataView.onDataLoaded.subscribe(onDataLoaded);
          var initResizer=false;
          if (opts.columns.length > 1 && opts.columns[opts.columns.length - 1].width === "*") {
            var fillColumnWidth = -1
              , initColumns = function initColumns(treedepth, minWidth) {
                  opts.columns[0].width = minWidth + indent * treedepth;
                  for (var i = 0; i < opts.columns.length; ++i) {
                    if (opts.columns[i].width !== '*') {
                      fixedColumnsToatalWidth += opts.columns[i].width;
                    } else {
                      fillColumnWidth = i;
                    }
                  }
                  if(fillColumnWidth > -1)
                    opts.columns[fillColumnWidth].width = $this.width() - fixedColumnsToatalWidth -5; //padding

                  grid.setColumns(grid.getColumns());
                };
            function doResize(e) {
              var canvas = $(grid.getCanvasNode());
              if(!canvas.length || (!opts.gridOptions.fullHeight && e.namespace==='')) return '++';
              if(canvas.parent().length)
                grid.getColumns()[fillColumnWidth].width = canvas.width() - fixedColumnsToatalWidth ;
              calcSensorColumns($this, grid, $this.data('sensortree').dataview);
              $.when(grid.initializeHeights(null, null, true)).done(function () {
                $.when(grid.setColumns(grid.getColumns())).done(function(){
                  grid.getData().refreshLeafs.call(grid.getData(), grid);
                });
              });
              !!$this.data('sensortree') && !!$this.data('sensortree').dataview.update && $this.data('sensortree').dataview.update();
            }
          }

          grid = new Slick.Grid(this, [], opts.columns, opts.gridOptions);
          grid.registerPlugin(new Slick.DynamicRowHeight(grid));
          var $elm = $(grid.getCanvasNode()),
          $parent = $elm.parent();
          $elm.detach();

          //if we have a dynColumn we do some calculation on resize
          if (grid.getColumns().length > 1 && !!grid.getColumns()[1].asyncPostRender) {
            $this.addClass('slickTree');
            if(!opts.gridOptions.fullHeight)
              $this.find('.slick-viewport').css({ 'overflow-y': 'auto','overflow-x': 'hidden', "height": "100%" });

            calcSensorColumns = function calculateSensorColumns($context, grid, dataview, opts) {
              var leafCol = $context.outerWidth(),
                  id = 'sensordefault' + $.now();

              if(((opts||{}).layout||'') === 'tiny' || ((opts||{}).displayMode||'') === 'managed') {
                  leafCol = leafCol - 246;
              }
              $context.append("<sensor id='sensor" + id + "' status='Down' style='opacity:0' />");
              $sensor = $context.find('#sensor' + id);
              sensWidth = $sensor.outerWidth(true);
              $context.addClass('collapsed');
              collapsedSensWidth = $sensor.outerWidth(true);
                $sensor.remove();
                $context.removeClass('collapsed');
              (dataview || grid.getData()).sensPerLine( Math.floor(leafCol / sensWidth));
              (dataview || grid.getData()).collapsedSensPerLine( Math.floor(leafCol / collapsedSensWidth));
            };
          }
          dataView.layout(opts.layout);

          grid._positions = dataView.dynPositions;
          grid._rows = dataView.visibleRows;
          //grid.onRefreshLeafs = new Slick.Event();
          dataView.onPostDataLoaded.subscribe(function (e, args) {
            this.asyncPostProcessRange(args);
            if(!initResizer && !$('body').is('.mapshow')){
              initResizer = true;
              $this.on('resize.objecttree',doResize);
            }
          });

          !data && $this.data('sensortree', {id: id, grid: grid, dataview: dataView, options: opts, eventEditModeOnly: {} });
          data = $this.data('sensortree');
          // grid default events
          //handle scrolling and data loading
          grid.onViewportChanged.subscribe(function onViewportChanged(e) {
            var self = this;
            self.getData().refreshLeafs.call(self.getData(), self).always(function () {
              if (!!dragging && !!dragEvent && !!dragData) {
                $.event.special.drop.reinit.apply(self);
              }
            });
          });

          // drag and drop binding
          if (opts.dragMode) {
            var scrollTimer = null
              , dragEvent = null
              , dragData = null
              , loadDataOnRefresh;
            grid.onDragInit.subscribe(function dragInit(e, dd) {
              _Prtg.Tip.killPopups();
              dragEvent = null;
              dragData = null;
              if (!!popupTimer)
                clearTimeout(popupTimer);
              popupTimer = null;
              //e.preventDefault();
            });
            grid.onDragStart.subscribe(function dragStart(e, dd) {
              loadDataOnRefresh = opts.loadDataOnRefresh;
              opts.loadDataOnRefresh = false;
              var row = $(e.target).closest('*[row]').first().attr('row')
                , $target = $(e.target).andSelf().closest('.dragable,.nondragable,.selected');
              if ($target.is('.nondragable') || (!row && !$target.is('.dragable')))
                return false;
              if (Slick.GlobalEditorLock.isActive() && !Slick.GlobalEditorLock.cancelCurrentEdit())
                return false;

              dd.selection = $target.is('.dragable') ? $target : $(e.target).closest('[objid]');
              dd.type = (dd.selection.find('probe,group,device,library')[0] || dd.selection[0] || { localname: undefined }).localName;
              if (!dd.type || row === 0 || ($this.is('.libTree') && dd.type !== 'library')) {
                opts.loadDataOnRefresh = true;
                return false;
              }
              if (dd.type === 'sensor') {
                var sensorIdx = dd.selection.attr('idx');
                if (!!sensorIdx)
                  dd.sensorIdx = parseInt(sensorIdx,10);
                dd.sensors = dd.selection.addClass('selected').closest('*[row]').andSelf().find('sensor.selected');
              // }
              }else{
                dd.selection =  dd.selection.addClass('selected').closest('.grid-canvas').find('row .selected');
              }
              dd.data = grid.getDataItem(row);
              dd.row = dd.data._idx;
              dd.dataView = dataView;
              dragEvent = e;
              dragData = dd;
              dd.now = $.now();
              var $proxy = $('<div />');
              $proxy.append(dd.selection.clone().children('div').css('height', 'auto').end());
              $proxy = $('<div/>', {
                id: "dragAdorner",
                type: dd.type,
                css: {
                  'top': e.pageY + opts.adornerOffsetY,
                  'left': e.pageX + opts.adornerOffsetX
                }
              }).append($proxy);
              $proxy.appendTo("body");
              dd.adorner = $proxy;
              dd.feedback = false;
              $this.addClass('cursor-notallowed dragging');
              $('body').addClass('cursor-notallowed');
              dragging = true;
              return $proxy;
            });
            grid.onDrag.subscribe(function drag(e, dd) {
              var $this = $(e.target).closest('.slickTree,#dropTarget').addBack('#dropTarget')
                , data = $this.data('sensortree');
              if (!!scrollTimer) {
                clearInterval(scrollTimer);
                scrollTimer = null;
              }
              if (!!dd.adorner)
                dd.adorner.css({
                  'top': e.pageY + opts.adornerOffsetY,
                  'left': e.pageX + opts.adornerOffsetX
                });
              var cursor =
                !!dd.feedback
                ? dd.feedback === 'copy'
                  ? 'cursor-copy'
                  : ((e.ctrlKey||e.metaKey) === regCopy.test(dd.feedback) && !e.shiftKey)
                    ? 'cursor-copy'
                    : 'cursor-none'
                : 'cursor-notallowed';
              if (cursor !== currentCursor) {
                $this.removeClass(currentCursor);
                currentCursor = cursor;
                $this.addClass(currentCursor);
              }
              if (!!data && data.options.editMode) {
                var scrollwindow = data.options.gridOptions.fullHeight,
                $viewport = scrollwindow ? $(window) : $this.find('.slick-viewport'),
                scrolltop = $viewport.scrollTop(),
                top = scrollwindow
                  ? 0//$('#breadcrumbs').offset().top + $('#breadcrumbs').height() + 10
                  : $viewport.offset().top,
                delta = top - e.pageY,
                scrollstop = scrollwindow
                  ? $(document).height() - $viewport.height()
                  : $this.find('.grid-canvas').height() - $viewport.height()
                scroll = parseInt($viewport.height() / 10);
                if (delta < 0 && delta >= -10) {
                  scrollTimer = setInterval(function () {
                    scrolltop -= scroll;
                    if (scrolltop < 0)
                      scrolltop = 0;
                    $viewport.scrollTop(scrolltop);
                    $.event.special.drop.reinit();
                  }, 100);
                }
                delta = scrollwindow
                ? $viewport.height() + scrolltop - e.pageY
                : delta + $viewport.height();
                if (delta > 0 && delta < 10) {
                  scrollTimer = setInterval(function () {
                    scrolltop += scroll;
                    if (scrolltop > scrollstop)
                      scrolltop = scrollstop;
                    $viewport.scrollTop(scrolltop);
                    $.event.special.drop.reinit();
                  }, 100);
                }
              }
            });
            grid.onDragEnd.subscribe(function dragend(e, dd) {
              opts.loadDataOnRefresh = loadDataOnRefresh;

              if (!!scrollTimer) {
                clearInterval(scrollTimer);
                scrollTimer = null;
              }
              dragging = dd.dragging = false;
              dragEvent = null;
              dragData = null;

              $('#dragAdorner').remove();

              $('.slickTree, .libTree, #dropTarget')
              .removeClass('cursor-none cursor-copy cursor-notallowed dragging')
              .removeClass(currentCursor);
              $('body').removeClass('cursor-notallowed');
              $('#treeAdorner, #sensorAdorner').removeClass().remove();

            });
            grid.onScroll.subscribe(function () {
              if (!!popupTimer)
                clearTimeout(popupTimer);
              popupTimer = null;
            });
          }

          var $blocker = $('<div id="treeblocker"></div>').prependTo($this).hide();
          if (!opts.hideControls) {
            if($controlsParent.length){
              $this.on('dataloaded', function(e,junk){
                if(!!junk)
                  $.each({
                    'totalsens': 'span.totalsens',
                    'downsens': 'span.sensr',
                    'partialdownsens': 'span.sensq',
                    'downacksens': 'span.senso',
                    'warnsens':'span.sensy',
                    'upsens': 'span.sensg',
                    'pausedsens':'span.sensb',
                    'unusualsens': 'span.sensp',
                    'undefinedsens':'span.sensx'
                  }, function(i,v){
                      var val = '0'
                        , filter = i.replace('sens','');
                      if(junk.hasOwnProperty(i))
                        val = junk[i]===''?'0':junk[i]
                      $controlsParent.find(v).text(val)
                        .closest('div[sensorstateswitch]')
                        .removeAttr('class')
                        .addClass('iszero'+val);
                  });
                  dataView.Filters().forEach(function(val){
                    $controlsParent.find('#content'+val).prop('checked', false);
                  });
              });
            }

            $('#treesearch', $controlsParent).on({
              focus: function () {
                var self = $(this);
                if (self.val() === self.attr('defaultvalue'))
                  self.val('');
                $(this).removeData();
                if (!!$searchStyle && $searchStyle.length)
                  if (!!$searchStyle && $searchStyle.length)
                    removeStyles($searchStyle);
                $('.treesearchbox label', $controlsParent).removeClass('working ui-icon-close');
              },
              blur: function () {
                var self = $(this);
                if (self.val() === '')
                  self.val(self.attr('defaultvalue'));
              },
              select: function (e) {
                $(this).data('textIsSelected',true);
              },
              keydown: function (e) {
                if ($.inArray(e.which, [8, 46]) !== -1 || $(this).data('textIsSelected')) {
                  $(this).removeData();
                  if (!!$searchStyle && $searchStyle.length)
                    removeStyles($searchStyle);
                  $('.treesearchbox label', $controlsParent).removeClass('working ui-icon-close');
                }
                 $(this).data('textIsSelected',false);
              },
              keyup: function (e) {
                var $this = $(this);
                next = $this.data('next'),
                found = $this.data('found'),
                rules = [];
                if ($.inArray(e.which, [13, 114]) !== -1 && e.target.value.length > 0) {
                  if (!found) {
                    if (!!$searchStyle && $searchStyle.length)
                      removeStyles($searchStyle);
                    $searchStyle = $("<style type='text/css' rel='stylesheet' title='sensortree' />").appendTo($("head"));
                    setStyle($searchStyle, ['probe, group, device, library, sensor, path, div.cell, span.sensor { opacity:0.3!important; }']);

                    $('.treesearchbox label', $controlsParent).addClass('working');

                    dataView.find(e.target.value)
                    .always(function (d) {
                      found = d['multiobj'];
                      for (var i = 0; i < found.length; ) {
                        var f = found[i];
                        //if($.inArray(opts.data.id, f.probegroupdevice) > -1){
                          if (f.basetype === 'sensor') {
                            f['objid'] = f.probegroupdevice.pop();
                            f['parentid'] = f.probegroupdevice[f.probegroupdevice.length - 1];
                          } else {
                            f['parentid'] = f['objid'] = f.probegroupdevice[f.probegroupdevice.length - 1];
                          }
                          f['path'] = f.probegroupdevice.join('-');
                          f['idx'] = dataView.getPositionById(f.path);
                          ++i;
                        // }else{
                        //  found.splice(i,1);
                        // }
                      }
                      found = found.sort(function (a, b) {
                        return (a['idx'] - b['idx']);
                      });
                      $this.data('found', found);
                      $('.treesearchbox label', $controlsParent).removeClass('working').addClass('ui-icon-close');
                      if (found.length > 0) {
                        if(opts.layout === "sunburst"){
                          setStyle($searchStyle, $.map(found, function (f) {
                              return 'path[objid="' + f.parentid + '"] {opacity:1!important;}';
                          }));
                        }else if(opts.layout === "treemap"){
                          setStyle($searchStyle, $.map(found, function (f) {
                              return 'div.cell[objid="' + f.parentid + '"] {opacity:1!important;}';
                          }));
                        }else{
                          setStyle($searchStyle, $.map(found, function (f) {
                            if (f.basetype === 'sensor')
                              return 'sensor[objid="' + f.objid + '"] {opacity:1!important;}';
                            else
                              return 'row div[objid="' + f.objid + '"] *{opacity:1!important;}';
                          }));
                          $.each(found, function (i, f) {
                            dataView.ensureVisible(f.idx, grid);
                          });
                          eventFunctions['search'].apply($this, [found, 0, 1]);
                        }
                      } else if (!!$searchStyle && $searchStyle.length)
                        removeStyles($searchStyle);

                    });
                  } else {
                    if (found.length > 0)
                      eventFunctions['search'].apply($this, [found, next, 2]);
                    else if (!!$searchStyle && $searchStyle.length)
                      removeStyles($searchStyle);
                  }
                }
              }
            });
          }

          //row and header item delegates
          var eventFunctions = {
            'goto': function($elm, ctrlKey) {
              var type = $elm.attr('type');
              type = type + (type === 'probe' ? 'node' : '');
              clearTimeout(popupTimer);
              popupTimer = null;

              var e = $.Event('click.hjax', {
                data: {'namespace': 'linkloader.prtg', 'container': (!!window.winGUI?'#mainstuff':'#container')},
                ctrlKey: ctrlKey
              });
              if (ctrlKey)
                window.open(($elm.attr('altType') || type) + '.htm?id=' + $elm.attr('objid')+($elm.attr('filter')||''),'_blank');
              else
                $('<a style="display:none;" href="' + ($elm.attr('altType') || type) + '.htm?id=' + $elm.attr('objid') +($elm.attr('filter')||'')+'"></a>')
                  .appendTo((!!window.winGUI?'#mainstuff':'#main'))
                  .trigger('click.hjax', ctrlKey)
              return;
            },
            popup: function ($elm, ctrlKey, position) {
              var type = $elm.attr('type');
              type = type + (type === 'probe' ? 'node' : '');
              var $obj = $('<obj/>',
              {
                id: $elm.attr('objid'),
                'class': $elm.attr('type') + 'menu' + ' ' + $elm.attr('class'),
                href: type + '.htm?id=' + $elm.attr('objid') + ($elm.attr('filter')||''),
                css: {
                  'background-image': $elm.find('icon').css('background-image'),
                  'background-position': $elm.find('icon').css('background-position')
                },
                text: $elm.find('name,title').text()
              });
              $.fn.ptip.show.apply($obj[0], [position]);
              popupTimer = null;
              return false;
            },
            toggle: function(e) {
              e.stopImmediatePropagation();
              var data = $this.data('sensortree'),
              $self = $($(this).parents('*[type]')[0] || $(this).parent().find('*[objid][type]')[0]);
              if ((data.options.layout === 'tiny'
              && $self.attr('type') === 'device')
              || $self.is('.noaccess')
              || $self.is('.notoggle'))
                return false;
              var idx = $($(this).parents('*[row]')[0]).attr('row');
              if(!!opts.ignoreFold || $self.is('.fold-ignore'))
                data.dataview.toggleLocal(idx,grid);
              else
                data.dataview.toggle(idx, grid);
              if (data.options.postDataLoad)
                data.dataview.refreshLeafs(grid);
              return false;
            },
            switchView: function(e) {
              var layout = Layouts[id][e.target.value.toLowerCase()];

              if (!!$searchStyle && $searchStyle.length)
                removeStyles($searchStyle);
              $('.treesearchbox label', $controlsParent).removeClass('working ui-icon-close');

              if (!_Prtg.Options.userIsReadOnly) {
                $this.sensortree('setLayout', e.target.value.toLowerCase());
              } else {
                $this.sensortree('switchLayout', Layouts[id], layout);
              }
            },
            switchFilter: function(e) {
              // e.stopImmediatePropagation();
              $this.toggleClass('hide' + e.target.value);
              dataView.toggleFilter(e.target.value);
              $.when(grid.initializeHeights(0, 0)).done(function () {
                grid.invalidate();
              });
            !!$this.data('sensortree') && !!$this.data('sensortree').dataview.update && $this.data('sensortree').dataview.update();
            },
            search: function (found, next) {
              if(opts.layout === "sunburst" || opts.layout === "treemap")return;
              var row = dataView.ensureVisible(found[next].idx, grid);
              if (data.options.postDataLoad)
                data.dataview.refreshLeafs(grid);

              if (row > -1){
                if (!opts.gridOptions.fullHeight)
                  grid.scrollRowIntoView(row);
                else
                  $(document).scrollTop($('*[idx="' + row + '"]').offset().top);
              }
              ++next;
              if (next < found.length)
                $(this).data('next', next);
              else
                $(this).data('next', (next=0));
            }
          };

          if ((!opts.editMode && !opts.noPopups) || !!opts.clickable) {
            $this
              .delegate('icon[popup], [goto], goto', {
                click: function(e) {
                  if (dragging || $this.is('.cursor-progress')) return false;
                  var $self = $($(this).closest('*[objid][type]')[0] || $(this).find('*[objid][type]')[0]),
                    func = eventFunctions['goto'];
                  if ($self.is('.noaccess') || $self.closest('#objecttreecontainer').hasClass('.treeiseditable'))
                    return false;
                  if (!!popupTimer) {
                    clearTimeout(popupTimer);
                    popupTimer = null;
                  }
                  if ($(this).is('.goto'))
                    func = eventFunctions['popup'];
                  func.apply($self[0], [$self, (e.ctrlKey||e.metaKey)]);
                  return false;
                }
              });
          }
          if (!opts.editMode && !opts.noPopups) {
            $this
              .delegate('[popup]', {
                mouseenter: function(e) {
                  if (dragging || $this.is('.cursor-progress')) return false;
                  var $self = $($(this).closest('[objid][type]')[0] || $(this).find('[objid][type]')[0]),
                    func = eventFunctions['popup'],
                    mouse = { left: e.pageX - 5, top: e.pageY - 5, width: 0, height: 0 };
                  if ($self.is('.noaccess'))
                    return false;
                  if (!!popupTimer) {
                    clearTimeout(popupTimer);
                    popupTimer = null;
                  }
                  if (!$("#jqContextMenu").is(":visible") && !dragging) {
                    popupTimer = setTimeout(function () { func.call($self[0], $self, false, mouse) }, parseInt($(this).attr('popup')));
                    $this.unbind('mousemove.slickTree').bind('mousemove.slickTree', function (e) {
                      mouse = { left: e.pageX - 5, top: e.pageY - 5, width: 0, height: 0 };
                    });
                  }
                  // return false;
                },
                mouseleave: function() {
                  clearTimeout(popupTimer);
                  popupTimer = null;
                  $this.unbind('mousemove.slickTree');
                  //return false
                }
              })
              .on({
                mouseenter: function() {
                  var $self = $(this)
                    h = $self.closest('.indent').css('height','auto').height();
                    $self.closest('.indent').css('height','');
                    if(h>$self.closest('row').height())
                      $self
                        .closest('row').height(h)
                        .children().height(h);
                },
                mouseleave: function() {
                  var $self = $(this);
                    $self
                      .closest('row').css('height','')
                      .children().css('height','');
                }
              }, 'probe, probe name, probe condition, probe message, group, group name, group condition, group message, group favorit, device, device name, device condition, device message,device favorit');
          }

          $this.on('click tap','toggler',eventFunctions['toggle']);
          $controlsParent
            .delegate('.sensorstateswitches input', {
              change: eventFunctions['switchFilter']
            })
            .delegate('.treesizeswitches input', {
              change: eventFunctions['switchView']
            })
            .delegate('.treesizeswitches label', {
              click: function(e){
                $(this).prev('input').trigger('click');
              }
            });

          //context menu
          //HINT: have a look at slickgrid.selectionmodel in handleClick e.stopImmediatePropagation() line at the bottom hase to be commented

          $(document).on('contextmenu.sensortree', '.treeItem,.sensorItem,probe,group,device,sensor,library,name,condition,favorit,status,message,icon,level,g[popup]', function treeContextMenu(e) {
              var $elm = $($(e.target).closest('*[objid][type][type!="probenode"]').not('.noContextMenu')[0])
                , objid = 0;
              if (!!popupTimer) {
                clearTimeout(popupTimer);
                popupTimer = null;
              }
              if ($elm.length === 1) {
                objid = $elm.attr('objid');
                e.target = $('<a/>', {
                  id: objid,
                  expandurl: '&targeturl=' + encodeURI(document.location),
                  callerid: id,
                  row: $elm.closest('div[row]').attr('row'),
                  target: !!$elm.attr('path') ? '[path="' + $elm.attr('path') + '"] level icon' : '[path="' + $elm.closest('[path]').attr('path') + '"] *[objid="' + $elm.attr('objid') + '"] icon',
                  'class': [(objid==="0" ? 'rootgroup':$elm.attr('type')) + 'menu'].join(' ') + ' ' + $elm.attr('class'),
                  href: $elm.attr('type') + '.htm?id=' + objid,
                  css: { 'background-image': $elm.find('icon').css('background-image') },
                  text: $elm.text()
                })[0];
              }
          });

          //start loading data
          var loaded = {
            change: false,
            from: 0,
            rowcountchange: false,
            to: 0,
            update: false,
            treeDepth: 0
          };
          if (!dataView.hasOwnProperty('isinitialized')) {
            loaded = dataView.initializeData(0, junk, false);
            dataView['isinitialized'] = true;
          } else {
            loaded.treeDepth = dataView.treeDepth();
            loaded.to = dataView.getSize();
          }
          $parent.append($elm);
          if(opts.columns.length > 0 ){
            !!initColumns && initColumns(loaded.treeDepth,_Prtg.Core.objects.nameColumnWidth);
            data.grid.getColumns()[grid.getColumnIndex('leafs')]['layout'] = opts.layout !== 'tiny';
            if($(grid.getCanvasNode()).length)
              calcSensorColumns($(grid.getCanvasNode()), grid, dataView, opts);
          }
          grid.setData(dataView);

          if (!!sensors) {
            dataView.setLeafs(sensors.sensorxref);
          } else {
            onDataLoaded.call(grid, null, loaded, function () {
              if (opts.gridOptions.fullHeight)
                grid.fullHeight();
            });
          }

          Layouts[id].treeElement = $this.find('.grid-canvas');
          if (!!Layouts[id][opts.layout] && Layouts[id][opts.layout].sensheight === undefined) {
            var newlayout = opts.layout;
            data.options.layout = "sensortreenormal";
            $this.sensortree('switchLayout', Layouts[id], Layouts[id][newlayout]);

            // if(!data.dataview.getItem(0)._collapsed && !$('body').is('.mapshow')) data.dataview.toggleLocal(0,data.grid);
            // fullSize = opts.gridOptions.setFullsize();

            // var viewPlugin = $this[opts.layout]($this.data('sensortree'),null)[0];
            // Layouts[id][opts.layout].element = viewPlugin.element();
            // $this.data('sensortree').dataview.update =  $.proxy(viewPlugin.update, viewPlugin);
          }
          var refreshTree = function sensortreeRefresh(e,invalidate){
              this.dataview.refresh.call(this, this.grid, invalidate);
          };
          if (!opts.editMode && !!opts.timer){
            opts.timer.subscribe('refresh.events.prtg', $.proxy(refreshTree, data));
            opts.timer.subscribeOnce('navigate.prtg', $.proxy(function(){
              opts.timer.unsubscribe('refresh.events.prtg', $.proxy(refreshTree, data));
            },data));
          }

        });
      },
      destroy: function () {
        return this.each(function () {
          var $this = $(this);
          data = $this.data('sensortree');
          $(window).unbind('.sensortree');
        })

      },
      renderNode: function (row, cell, value, columnDef, dataContext) {
        var dx = dataContext;
        return $.jqote(_Prtg.Core.getObject(dx.basetype.toLowerCase()).template, dx);
      },
      switchLayout: function (Layouts, layout) {
        var $self = $(this)
          , data = $self.data('sensortree')
          , opts = data.options
          , fullSize = false
          , currentLayout = data.options.layout.toLowerCase();

        if (!layout.hasOwnProperty('sensheight')) {
          if(!data.dataview.getItem(0)._collapsed) data.dataview.toggleLocal(0,data.grid);
          fullSize = opts.gridOptions.setFullsize(false);
          if(!!Layouts[currentLayout] && !!Layouts[currentLayout].element){
            Layouts[currentLayout].element.detach();
          }else{
            Layouts.treeElement.detach();
          }
          var myPlugin = $self[layout.layout](data,null)[0];
          layout.element = myPlugin.element();
          data.dataview.update = $.proxy(myPlugin.update, myPlugin);
          $self.find('.slick-viewport')
            .append(layout.element);
          $('.size-by-switch, .size-switch', opts.controlsParent).addClass('show');
          data.dataview.update();
        } else {
          if(data.dataview.getItem(0)._collapsed) data.dataview.toggleLocal(0,data.grid);
          fullSize = opts.gridOptions.setFullsize();
          if(!!Layouts[currentLayout] && !!Layouts[currentLayout].element){
            Layouts[currentLayout].element.detach();
          }
          $self.find('.slick-viewport')
            .append(Layouts.treeElement);
          data.dataview.sensorHeights(layout.sensheight[!!opts.displayMode ? opts.displayMode : 'overview']);
          $('.size-by-switch, .size-switch', opts.controlsParent).removeClass('show');
          data.dataview.update = null;
        }
        data.dataview.layout(layout.layout);
        data.grid.getColumns()[data.grid.getColumnIndex('leafs')]['layout'] = layout.layout !== 'tiny';
        $self.removeClass(data.options.layout).addClass(layout.layout);
        data.options.layout = layout.layout;
        calcSensorColumns($(data.grid.getCanvasNode()), data.grid);
        $.when(data.grid.initializeHeights(null, null, true)).done(function () {
          if (fullSize) {
            data.grid.fullHeight();
            data.grid.invalidate();
            $('#treeblocker').hide();
          } else {
            data.dataview.refreshLeafs(data.grid).done(function () {
              data.grid.invalidate();
              $('#treeblocker').hide(); });
          }
        });

      },
      setLayout: function (name) {
        var $self = $(this)
          , layouts = Layouts[$self.attr('id')]
          , layout = layouts[name.toLowerCase()]
          , action = layout.action;
        $('#treeblocker').show();
        if (!_Prtg.Options.userIsReadOnly) {
          $.ajax({
            url: "/api/setviewsize.htm?action=" + action,
            success: function () {
              $self.sensortree('switchLayout', layouts, layout);
            }
          });
        } else {
          $self.sensortree('switchLayout', layouts, layout, action);
        }
      },
      update: function (idx, data, objid) { dataview.updateData(idx, data, objid); },
      refresh: function (invalidate) {
        var data = $(this).data('sensortree');
        data.dataview.refresh.call(data.dataview, data.grid, invalidate);
      },
      reload: function (from, to) {
        var data = $(this).data('sensortree');
        data.dataview.reloadData.call(data.dataview, from, to);
      },
      subscribe: function (event, callback) {
        var grid = $(this).data('sensortree').grid;
        grid[event].subscribe(callback);
      },
      registerDropTarget: function (target) {
        $(target).on.apply($([].shift.call(arguments)), arguments);
      },
      unregisterDropTarget: function (target) {
        $(target).on.apply($([].shift.call(arguments)), arguments);
      },
      treeMap: function () { //dummy
        treemap();
      },
      ___: 'end methods'
    };


  if (!_Prtg.Core.objects.sensorTree.hasOwnProperty('columns')) {
    $.extend(true,
      _Prtg.Core.objects.sensorTree,
      {
        treetype: 'sensorxref',
        gridOptions: {
          headerHeight: 0,
          showTopPanel: true,
          topPanelHeight: 31,
          showHeaderRow: false,
          multiSelect: false,
          headerRowHeight: 18
        },

        columns: [
          {
            id: 'tree',
            name: _Prtg.Lang.sensorTree.strings.ColumnHeaderObjects,
            formatter: function (row, cell, value, columnDef, dataContext) {
              return $.jqote(_Prtg.Core.getObject(dataContext.basetype.toLowerCase()).template, dataContext);
            },
            width: _Prtg.Core.objects.nameColumnWidth,
            minWidth: _Prtg.Core.objects.nameColumnWidth,
            cssClass: function(d){return (!!d && regUnapproved.test(d.info) ? 'treeColumn unapproved' : 'treeColumn');}
          },
          {
            id: 'leafs',
            name: _Prtg.Lang.sensorTree.strings.ColumnHeaderSensors,
            formatter: function formatter(row, cell, value, colDef, data) {
              var l = '';
              if (data.basetype === 'device') {
                if (data.totalsens === 0) {
                  l =
                    (_Prtg.Options.userIsReadOnly
                      || data._access <= 100
                      || regAutodisco.test(data.info)===true
                      || regDisconnected.test(data.info)===true
                    ) ?
                    '' :
                    '<a class="treeminilink actionbutton" href="addsensor.htm?id=' + data.objid + '">' + _Prtg.Lang.sensorTree.strings.AddSensor + '</a>'+
                    (!!data.smallprobe ? '' : '<a class="treeminilink actionbutton autodiscovery" href="#" onclick="$(this).parent().remove();_Prtg.objectTools.discoverObjectNow.call(this,'+data.objid+' );return false;">' + _Prtg.Lang.sensorTree.strings.RunAutoDiscovery + '</a>');
                } else {
                  if (data._collapsed || !colDef.layout)
                    return $.jqote(_Prtg.Core.getObject('sensor').deviceCollapsed.template, data);
                  else
                    return $.jqote(_Prtg.Core.getObject('sensor').template, data);
                }
              } else {
                return $.jqote(_Prtg.Core.getObject('sensor').groupCollapsed.template, data);
              }
              return '<div class="sensorItem cell-inner c1 level-'+data._level +' ' + data._classes.join(' ').trim() + '"' + ' type="' + data.basetype + '" objid="' + data.objid + '" idx="' + data._idx + '" path="' + data._id + '"><div></div><span class="sensor">' + l + '</span></div>';
            },
            asyncPostRender: function asyncPostRender(cellNode, row, dx, colDef) {
              var content = "";
              if (!!dx) {
                if (dx.basetype === 'device' && !!dx.leafs && dx.leafs.length > 0) {
                  if (dx._collapsed || !colDef.layout)
                    content = $.jqote(_Prtg.Core.getObject('sensor').deviceCollapsed.template, dx);
                  else
                    content = $.jqote(_Prtg.Core.getObject('sensor').template, dx);
                } else if (dx.basetype !== 'device' && dx._collapsed) {
                  content = $.jqote(_Prtg.Core.getObject('sensor').groupCollapsed.template, dx);
                }
              }
              return content;
            },
            rerenderOnResize: true,
            width: '*',
            minWidth: 0,
            cssClass: 'valueColumn'
          }
        ],
        postDataLoad: function (grid, from, to, dataContext, rows, idxByObjId, eventHelper, direction) {
          var loaderrors = false
            , self = this
            , opts = $.extend(true, {}, _Prtg.Core.objects['sensor'])
            , preload = _Prtg.Core.objects.deviceCache
            , dfd = $.Deferred()
            , ready = {}
            , load = []
            , prevload = []
            , settings = {
                async: true,
                type: opts.type || 'GET',
                dataType: opts.dataType || 'text json',
                url: opts.url,
                data: opts.data,
                traditional: opts.traditional || false,
                cache: opts.cache || false,
                beforeSend: function(jqXHR){
                  jqXHR.peNumber = 'PE1235';
                  jqXHR.parents = opts.parents;
                },
                success: function sensorLoadSuccess(ret) {
                  var d = ret[opts.data.content],
                    to = d.length,
                    node = null,
                    i = 0, l = 0,
                    pid = 0,
                    rowid;
                  postDataLoadRequest = null;
                  for (i = 0; i < to; i++) {
                    node = d[i].probegroupdevice.slice(0);
                    node.pop();
                    node = dataContext[idxByObjId[node.join('-')]];
                    if (!!node._updateLeafs) {
                      node.leafs = [];
                      node._updateLeafs = false;
                    }
                    !!node && !!node.leafs && node.leafs.push(d[i]);
                  }
                  eventHelper.notify(ready, null, grid);
                  dfd.resolve();
                },
                error: function sensorLoadError(jqXHR, textStatus, errorThrown) {
                  postDataLoadRequest = null;
                  dfd.reject();
                }
              };

          clearTimeout(postDataLoadTimer);
          if (!!postDataLoadRequest && postDataLoadRequest.readyState < 4) {
          	prevload = postDataLoadRequest.parents
	        }

          if(direction !== undefined) {
              if (direction < 0){
                  from = from - preload > 0 ? from - preload : 0;
              } else {
                  from = from - 5 > 0 ? from - 5 : 0;
                  to = to + preload < rows.length ? to + preload : rows.length - 1;
              }
          }

          for (var i = from; i <= to; ++i) {
            var item = dataContext[rows[i]];
            if (!!item) {
              if (item._updateLeafs && !!prevload && prevload.indexOf(item.objid)===-1) {
                load.push(item.objid);
                ready[item.objid] = i;
              }else if(!!item && !!item._loaderrors)
                loaderrors = true;
            }
          }
          if (load.length > 0) {
          	settings.parents = load;
            if (load.length > 1)
              settings.data.filter_parentid = '['+load.join(',')+']';
            else
              settings.data.filter_parentid = load;
            postDataLoadTimer = setTimeout(function () {
            		postDataLoadTimer = null;
             		postDataLoadRequest = $.ajax(settings)
           	}, 100);
          } else {
            eventHelper.notify(ready, null, grid);
            dfd.resolve();
          }
          if(!!_Prtg.Events && loaderrors){
            loaderrors = $.extend(true, {}, _Prtg.Core.objects['sensor']);
            loaderrors.data.filter_status='[5,13,14]';
            loaderrors.data.count = '*';
            loaderrors.data.id= _Prtg.Util.getUrlVars()['id'];
            dfd.promise().then(function(){
              $.ajax({
                type: 'POST',
                dataType: 'text json',
                url: loaderrors.url,
                data: loaderrors.data,
                traditional: loaderrors.traditional || false,
                cache: loaderrors.cache || false
              }).done(function(res){
                if(!!res && !!res.treesize){
                  var result = res.sensorxref;
                  for(var x=0, m=result.length; x < m; ++x){
                    result[x]._probegroupdevice = result[x].probegroupdevice.slice(0);
                    result[x]._probegroupdevice.pop();
                    result[x]._probegroupdevice.pop();
                    result[x]._probegroupdevice = result[x]._probegroupdevice.join('-');
                  }
                  _Prtg.Events.publish('leafs.refreshed.prtg',res);
                  res = null;
                }
              });
            });
          }
          return dfd.promise();
        }
      }
    );
  }
  /**
   * [sensortree description]
   * @param  {[type]} method [description]
   * @return {[type]}
   *
   */
  $.fn.sensortree = function (method) {
    if (methods[method]) {
      return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if (typeof method === 'object' || !method) {
      return methods.init.apply(this, arguments);
    } else {
      $.error('Method ' + method + ' does not exist on jQuery.sensortree');
    }
  };
})(jQuery);


/*
/   _Prtg.ObjectTree.Plugin.js
*/
(function ( $, window, document, undefined ) {
	var pluginName = "objecttree";

	function ObjectTree( element, options, parent ) {
		this.element = element;
		this.options = options;
		this.parent = parent;
		this._name = pluginName;
		this.$sensorTree = $(element);
		this.$parent = this.$sensorTree.parent();
		this.grid = null;
		this.$treeblocker = this.$sensorTree.find('#treeblocker');
		this.$editSettings = $('div.editsettings');
		this.$dropTreeAdorner = $('<div id="treeAdorner" />');
		this.$dragSensor = null;
		this.$draggedSensor = null;
		this.$right_panel = $('#rightpanel_titel');
		this.pinned = true;
		var totalsens = (this.options.objects['sensorxref'][0] || {totalsens:0}).totalsens;
		this.fullSize = totalsens <= _Prtg.Core.objects.maxSensorFullSize;
		this.editable = this.$sensorTree.parent().is('.treeiseditable');

		this.init(this);
	}

	ObjectTree.prototype.refresh = function refreshObjectTree(){
		this.$sensorTree.sensortree('refresh');
	};
	ObjectTree.prototype.setFullsize =  function (val){
		this.fullSize = val === undefined ? this.options.objects['sensorxref'][0].totalsens <= _Prtg.Core.objects.maxSensorFullSize : val;
      this.resize(
        !this.fullSize,
        this.$sensorTree.offset().top,
        document.getElementsByTagName('footer'),
        document.getElementById('sensortreelinks')
      );
		return this.fullSize;
	};

	ObjectTree.prototype.resize =  function (setHeight, offsetTop, footer, buttons){
    footer = !!footer && footer.length > 0 ? footer[0] : false;
    if(setHeight)
  		this.$sensorTree.height(
  			(window.innerHeight
  				- offsetTop
  				- (footer ? footer.offsetHeight : 0) - 14
  			)
  		);
    else
      this.$sensorTree.height('auto');
    this.$sensorTree.trigger('resize.objecttree');
	};


	ObjectTree.prototype.init = function (me) {

		_Prtg.Events.subscribe('prtg.resize.layout',$.proxy(
			me.resize,
			me,
      !me.fullSize,
			me.$sensorTree.offset().top,
			document.getElementsByTagName('footer'),
			document.getElementById('sensortreelinks')
		));
    if(!me.fullSize){
				me.resize(
          !me.fullSize,
					me.$sensorTree.offset().top,
					document.getElementsByTagName('footer'),
					document.getElementById('sensortreelinks')
				);
		}
		$.when(me.$sensorTree.sensortree($.extend(true, {},
			_Prtg.Core.objects['sensorTree'], {
				layout: (me.editable ? 'sensortreenormal': me.options.viewType),
				data: {
					id: me.options.objectid
				},
				editMode: me.editable,
				displayMode: (me.options.displayMode || 'overview'),
				controlsParent: '#loadedcontent',
				gridOptions: {
					fullHeight: me.fullSize,
					setFullsize: function(val){me.setFullsize(val);}
				},
				timer: $(me.parent).Events()
			}), me.options.objects)
		).then(function(){
			me.$sensorTree
				.appendTo(me.$parent)
				.parents('.loading').removeClass('loading');
			me.$treeblocker = me.$sensorTree.find('#treeblocker');

			if(me.editable){
				$.event.special.drop.targets=[];
				$.drop({ mode: 'mouse', distance: 5, multi: false });

				me.$sensorTree.on({
					'drop': function dropSensor(e, d) {
						var $target = $(e.currentTarget);
						var idx = parseInt(($target.attr('idx') || -1));
						var row = parseInt($target.closest('.sensorItem').attr('idx'));
						
						if(!!d.feedback && me.$draggedSensor!==null){
							if(d.feedback === 'copy' || ((e.ctrlKey||e.metaKey) && /copy/.test(d.feedback) === true && !e.shiftKey)){
								me.$treeblocker.show();
								me.$sensorTree.removeClass('cursor-none cursor-copy').addClass('cursor-progress');
								me.$draggedSensor.removeClass('sensorAdorner');
								var $draggedSensorKeep = me.$draggedSensor;
								var $dragSensorKeep = me.$dragSensor;
								var srcids = $.map(d.sensors, function(elm){
									return parseInt($(elm).attr('idx'),10);
								});
								me.$draggedSensor= null;
								d.dataView.cloneLeaf(me.$sensorTree.data('sensortree').grid, d.row, row, srcids, idx)
									.always(function(){
										me.$sensorTree.removeClass('cursor-progress');
										me.$treeblocker.hide();
									}).fail(function(){
										 $draggedSensorKeep.remove();
									});
							}else if (d.row === row) {
								me.$treeblocker.show();
								if(idx === -1)
									idx = me.$sensorTree.data('sensortree').dataview.getItemByRow(row).leafs.length -1;
								me.$sensorTree.removeClass('cursor-none cursor-copy').addClass('cursor-progress');
								var $draggedSensorKeep = me.$draggedSensor
									, $dragSensorKeep = me.$dragSensor;
								me.$dragSensor().hide();
								me.$dragSensor = null;
								me.$draggedSensor.removeClass('sensorAdorner');
								me.$draggedSensor= null;
								var srcids = $.map(d.sensors, function(elm){
									return parseInt($(elm).attr('idx'),10);
								});
								d.dataView.moveLeafe(me.$sensorTree.data('sensortree').grid, d.row, srcids, idx)
									.always(function(){
										me.$sensorTree.removeClass('cursor-progress');
										me.$treeblocker.hide();
									}).fail(function(){
										 $draggedSensorKeep.remove();
										 $dragSensorKeep().show();
									}).done(function(){
										$dragSensorKeep().remove();
									});
							}
						}
					},
					'dropstart': function dropStartSensor(e, d) {
						var $target = $(e.currentTarget);
						var idx = parseInt(($target.attr('idx') || -1), 10);
						var $sensors = $target.closest('.sensorItem');
						var row = parseInt($sensors.attr('idx'), 10);
						d.feedback = false;
						if($sensors.attr('type') === 'device'
						&& !$sensors.hasClass('clusterprobedevice')){
							switch (d.type) {
								case 'sensor':
									if(d.selection.is('.fixed')){
										if(row === d.row)
											d.feedback = 'move';
										else
											d.feedback = false;
									} else {
										if (row === d.row)
											d.feedback = 'move,copy';
										else
											d.feedback = 'copy';
									}
									break;
								default:
									break;
							}
						}
						if(!!d.feedback){
							if(row === d.row && d.sensorIdx < idx)
								$target.after(me.$draggedSensor.detach());
							else
								$target.before(me.$draggedSensor.detach());
							if(d.feedback === 'copy' || ((e.ctrlKey||e.metaKey) && /copy/.test(d.feedback) === true && !e.shiftKey))
								me.$dragSensor().show();
							else
								me.$dragSensor().hide();
						}else{
							e.stopImmediatePropagation();
						}
					}
				}, 'sensor');


				me.$sensorTree.on({
					'drop.livedrag': function dropTreeItem(e, d) {
						var $target = $(e.currentTarget);
						var dstrow = parseInt(($target.attr('idx') || -1));
						var dstType = ($target.find('probe,group,device')[0] || $target).localName;
						var func = "moveNode";
						var grid = me.$sensorTree.data('sensortree').grid;

						if(d.feedback !== false){
							if (d.row !== dstrow) {
								me.$treeblocker.show();
								me.$sensorTree.removeClass('cursor-none cursor-copy');

								if((e.ctrlKey||e.metaKey) && /copy/.test(d.feedback) === true && !e.shiftKey)
										func = "cloneNode";
								var deferreds = $.map(d.selection, function(e, i){
									var srcrow = parseInt($(e).attr('idx'),10);
									return d.dataView[func](grid, srcrow, dstrow, d.move);
								});
								$.when.apply($,deferreds)
									.always(function(){
										d.dataView.refresh(grid,true);
										me.$sensorTree.removeClass('cursor-progress');
										me.$treeblocker.hide();
										me.$sensorTree.triggerHandler('DragEnd');
										$('#main_menu').parent().load('/controls/menu.htm')
								});
							}
						}
						me.$sensorTree.data('sensortree').grid.onDragEnd.notify(d,e);
						e.stopImmediatePropagation();
					},
					'dropend.livedrag':function(e){
						$(this).off('mousemove.drag');
					},
					'dropstart.livedrag': function dropStartTreeItem(e, d) {
						var $target = $(e.currentTarget);
						var row = parseInt(($target.attr('idx') || -1));

						
						var dstType = ($target.find('probe,group,device')[0] || $target).localName;
						d.feedback = false;
						me.$dropTreeAdorner.removeClass().remove();
						if(!$target.is('.fixed')){
							switch (d.type) {
								case 'group':
									if(!me.$sensorTree.data('sensortree').dataview.isChild(d.row,row)){
										if (/probe|group|device/.test(dstType) && row > 0)
											d.feedback = 'move,copy';
									}
									break;
								case 'probe':
									if(!me.$sensorTree.data('sensortree').dataview.isChild(d.row,row)){
										if (/probe/.test(dstType) || row === 0)
											d.feedback = 'move';
									}
									break;
								case 'device':
									if (/probe|group|device/.test(dstType) && row > 0)
										d.feedback = 'move,copy';
									break;
								default:
									break;
							}
							$target.on('mousemove.drag','',{me:me,d:d},function(e){
								var $self = $(this);
								var me = e.data.me;
								var d = e.data.d;
								var h = $self.height();
								var dy = h - e.clientY + $self.offset().top;
								h /= 3;
								if(dy > 2*h){ // before
									me.$dropTreeAdorner.removeClass('dropOnClosed dropAfter').addClass('dropBefore');
									d.move ='before';
								}else if(dy > h && dstType !== 'device'){ // insert
									me.$dropTreeAdorner.removeClass('dropBefore dropAfter').addClass('dropOnClosed');
									d.move ='insert';
								}else{ //after
									me.$dropTreeAdorner.removeClass('dropOnClosed dropBefore').addClass('dropAfter');
									d.move ='after';
								}
							});
							if(d.feedback && row !== d.row) {
									$target.closest('.slick-row').prepend(me.$dropTreeAdorner);
									var classes = ' ui-icon-play level' + (parseInt($target.attr('level'))-2);
									if($target.is('.groupItem') && $target.is('.collapsed')){
										me.$dropTreeAdorner.addClass('dropOnClosed' + classes);
									} else if(row < d.row){
										me.$dropTreeAdorner.addClass('dropBefore' + classes);
									}else if(row > d.row){
										me.$dropTreeAdorner.addClass('dropAfter' + classes);
									}
								}
						}
						return true;
					}
				}, 'div.treeItem');

				me.$sensorTree.on({
					'drop': function dropSensorItem(e, d) {
						// prevent error message when dragging object accidantely in the sensor tree column
						var gridCells = $(d.target).find(".slick-cell");
						if (gridCells.length === 1) {
							return;
						}

						

						var $target = $(e.currentTarget).find('.sensorItem').andSelf().last();
						var idx = parseInt(($target.attr('idx') || -1));
						var row = parseInt($target.closest('.sensorItem').attr('idx'));
						if(!!d.feedback && me.$draggedSensor!==null){
							if(d.feedback === 'copy' || ((e.ctrlKey||e.metaKey) && /copy/.test(d.feedback) === true && !e.shiftKey)){
								me.$treeblocker.show();
								me.$sensorTree.removeClass('cursor-none cursor-copy').addClass('cursor-progress');
								me.$draggedSensor.removeClass('sensorAdorner');
								var $draggedSensorKeep = me.$draggedSensor;
								var $dragSensorKeep = me.$dragSensor;
								me.$draggedSensor= null;
								var srcids = $.map(d.sensors, function(elm){
									return parseInt($(elm).attr('idx'),10);
								});
								d.dataView.cloneLeaf(me.$sensorTree.data('sensortree').grid, d.row, row, srcids, idx)
									.always(function(){
										me.$sensorTree.removeClass('cursor-progress');
										me.$treeblocker.hide();
									}).fail(function(){
										 $draggedSensorKeep.remove();
									});
							}else if (d.row === row) {
								me.$treeblocker.show();
								if(idx === -1)
									idx = me.$sensorTree.data('sensortree').dataview.getItemByRow(row).leafs.length -1;
								me.$sensorTree.removeClass('cursor-none cursor-copy').addClass('cursor-progress');
								var $draggedSensorKeep = me.$draggedSensor;
								var $dragSensorKeep = me.$dragSensor;
								me.$dragSensor().hide();
								me.$dragSensor = null;
								me.$draggedSensor.removeClass('sensorAdorner');
								me.$draggedSensor= null;
								var srcids = $.map(d.sensors, function(elm){
									return parseInt($(elm).attr('idx'),10);
								});
								d.dataView.moveLeafe(me.$sensorTree.data('sensortree').grid, d.row, srcids, idx)
									.always(function(){
										me.$sensorTree.removeClass('cursor-progress');
										me.$treeblocker.hide();
									}).fail(function(){
										 $draggedSensorKeep.remove();
										 $dragSensorKeep().show();
									}).done(function(){
										$dragSensorKeep().remove();
									});
							}
						}
						e.stopPropagation();
					},
					'dropstart': function dropStartSensorItem(e, d) {
						var $target = $(e.currentTarget).find('.sensorItem').andSelf().last();
						var idx = -1;
						var row = parseInt($target.attr('idx'));
						d.feedback = false;
						if($target.hasClass('clusterprobedevice')===false){
							switch (d.type) {
								case 'sensor':
									if(d.selection.is('.fixed')){
										if(row === d.row)
											d.feedback = 'move';
									} else {
										if (row === d.row)
											d.feedback = 'move,copy';
										else{
											d.feedback = 'copy';
										}
									}
									break;
								default:
									break;
							}
						}
						if(!!d.feedback){
							$target.children('div').append(me.$draggedSensor.detach());
							if(d.feedback === 'copy' || ((e.ctrlKey||e.metaKey) && /copy/.test(d.feedback) === true && !e.shiftKey))
								me.$dragSensor().show();
							else
								me.$dragSensor().hide();
						}
						return true;
					}
				}, 'row');
				me.$sensorTree.sensortree('subscribe', 'onDragStart', function dragstart(e, d) {
					if(d.hasOwnProperty('sensorIdx') && !!d.data.leafs && !!d.data.leafs.length){
						me.$dragSensor = (function(p,o){
							var path = p;
							var objid = o;
							return function getDragSensor(){
								return $('div[path="'+path+'"]').find('sensor[objid="'+objid+'"], sensor.selected').not('.sensorAdorner');
							};
						})(d.data._id, d.data.leafs[d.sensorIdx].objid);
						if(me.$dragSensor().length){
							me.$draggedSensor = me.$dragSensor().clone().addClass('sensorAdorner');
							return;
						}
					} else {
						me.$dragSensor = null;
						me.$draggedSensor  = null;
					}
					e.stopImmediatePropagation();
				});

				me.$sensorTree.sensortree('subscribe', 'onDragEnd', function dragend(e, d) {
					if(me.$dragSensor !== null){
						me.$dragSensor().show();
						me.$dragSensor = null;
					}
					if(me.$draggedSensor !== null){
						me.$draggedSensor.remove();
					}
					me.$sensorTree.find('.selected').removeClass('selected');
					e.stopImmediatePropagation();
				});

				// renderes initial helpcontent when no sensor is chosen
				var loadInitialHelpContent = function () {
					if (me.$editSettings.find('.propertiesHint').length === 0) {
						me.$editSettings.empty();
						me.$editSettings.load(
							'/controls/multiedithint.htm',
							function () {
								_Prtg.initPlugins(me.$editSettings);
								$('.js-rightPanel_title').text(_Prtg.Lang.common.strings.help);
							}
						);
						selectedIds = [];
						selectorArray = [];
						objIDs = "";
						me.$sensorTree.find('.selected').removeClass('selected');
					}
				};

				if($('.multiedit').length){
					var selectedIds = [];
					var selectedObjectType = '';
					var selectorArray = [];
					var selectedTimer = null;
					var objIDs = "";
					var lastSelected=null;
					var obj = null;
					
					// renders multiedit menu on the right side
					var loadmultiinlineedit = function() {
						me.$editSettings.load(
							'/multiinlineedit.htm?id='+objIDs+'&tabid=1',
							function() {
								_Prtg.initPlugins(me.$editSettings);
								$('.js-rightPanel_title').text(_Prtg.Lang.common.strings.settings);
							}
						);
					};

					me.$editSettings
						.on('click.edit', '#PRTGContextMenu li#dodelte, .buttonbox a[delete]', function(e){
							e.stopImmediatePropagation();
							_Prtg.objectTools.deleteObject(selectedIds,true).done(function(){
								selectedIds = [];
								selectorArray = [];
								objIDs = "";
								me.$sensorTree.find('.selected').removeClass('selected');
								loadInitialHelpContent();
								$('.sensorTree').data('sensortree').dataview.refresh($('.sensorTree ').data('sensortree').grid);
							});
						})
						.on('click.edit','.buttonbox a[pause]', function(){
							_Prtg.objectTools.pauseObject(selectedIds.join(','),0).done(function(){
								loadmultiinlineedit();
								$('.sensorTree').data('sensortree').dataview.refresh($('.sensorTree ').data('sensortree').grid);
							});
						})
						.on('click.edit', '.buttonbox a[resume]', function(){
							_Prtg.objectTools.pauseObject(selectedIds.join(','),1).done(function(){
								loadmultiinlineedit();
								$('.sensorTree').data('sensortree').dataview.refresh($('.sensorTree ').data('sensortree').grid);
							});
						})
						.on('click.edit', '.buttonbox a[favorite]', function(){
							_Prtg.objectTools.faveObject(selectedIds.join(','), $(this).attr("favorite")).done(function(){
								loadmultiinlineedit();
								$('.sensorTree').data('sensortree').dataview.refresh($('.sensorTree ').data('sensortree').grid);
							});
						})
						.on('click.edit','.buttonbox a[checknow]', function(){
							_Prtg.objectTools.checkObjectNow(selectedIds.join(',')).done(function(){
								loadmultiinlineedit();
								$('.sensorTree').data('sensortree').dataview.refresh($('.sensorTree ').data('sensortree').grid);
							});
						});

					me.$sensorTree.data('sensortree').grid.onRefreshLeafs.subscribe(function(){
						$.each(selectorArray, function(i,e){
							$(e).addClass('selected');
						});
					});
					me.$sensorTree.data('sensortree').grid.onPostRender.subscribe(function(){
						$.each(selectorArray, function(i,e){
							$(e).addClass('selected');
						});
					});

					me.$sensorTree.on('click', function(e,d){
						if(/toggler|level/.test(e.target.localName) === true || $(e.target).is('.sensorItem')){
							obj = null;
						} else {
							obj = $(e.target).andSelf().closest('*[objid]');
							obj = obj.last();
						}
						
						if(obj===null || !((e.ctrlKey||e.metaKey) || e.shiftKey) || obj.attr('type') !== selectedObjectType){
							selectedIds = [];
							selectorArray = [];
							objIDs = "";
							me.$sensorTree.find('.selected').removeClass('selected');
							
							if(!obj || obj.attr('type') === "") {
								loadInitialHelpContent();
								$('.leftpanel_titletext').remove();
							}

							if(obj === null){
								e.stopImmediatePropagation();
								e.preventDefault();
								return;
							}
							selectedObjectType = obj.attr('type');
						}

						var selectedTimer = clearTimeout(selectedTimer);
						if(objIDs.indexOf(obj.attr('objid'))===-1
						&& !obj.hasClass('sensorItem')
						&& !obj.is('sensor[type!="sensor"]')){
							var $obj = obj;
							if(e.shiftKey && !!lastSelected){
								if(parseInt(lastSelected.attr("idx")) < parseInt(obj.attr("idx")))
									$obj = $obj.prevUntil(lastSelected, '*[type="'+selectedObjectType+'"]').andSelf();
								else
									$obj = $obj.nextUntil(lastSelected, '*[type="'+selectedObjectType+'"]').andSelf();
							}

							$obj.each(function(){
								var $this = $(this);
								if(!$this.hasClass('noContextMenu')){
									$this.addClass('selected');
									var objid = $this.attr('objid');
									if(objIDs.indexOf(objid)===-1){
										selectorArray.push(this.localName + '[objid="' +  objid +  '"]:first');
										selectedIds.push(objid);
									}
								}
							});
						} else if(objIDs.indexOf(obj.attr('objid'))>-1){
							var $obj = obj;
							if(e.shiftKey && !!lastSelected){
								if(parseInt(lastSelected.attr("idx")) < parseInt(obj.attr("idx")))
									$obj = $obj.prevUntil(lastSelected, '*[type="'+selectedObjectType+'"]').andSelf();
								else
									$obj = $obj.nextUntil(lastSelected, '*[type="'+selectedObjectType+'"]').andSelf();
							}

							$obj.each(function(){
								var $this = $(this);
								$this.removeClass('selected');
								for(var ii=0; ii < selectedIds.length; ++ii){
									if($this.attr('objid') === selectedIds[ii]){
										selectorArray.splice(ii,1);
										selectedIds.splice(ii,1);
										break;
									}
								}
							});
						}

						if(selectedIds.length
						&& objIDs !== selectedIds.join(',')){
							objIDs = selectedIds.join(',');
							lastSelected= obj;
							$('.sensorTree').data('sensortree').options.loadDataOnRefresh = false;
							selectedTimer = setTimeout(loadmultiinlineedit, 300);
						} else if(selectedIds.length==0 && !selectedTimer){
							loadInitialHelpContent();
							$('.leftpanel_titletext').remove();
							objIDs='';
							$('.sensorTree').data('sensortree').options.loadDataOnRefresh = true;
						}
					});
				}

				me.$sensorTree.removeClass('tiny lage medium small').addClass('small');

		_Prtg.Events.subscribe('prtg.object.deleted', $.proxy(loadInitialHelpContent, me));
		$(me.parent).Events().subscribe('refresh.events.prtg', $.proxy(me.refresh, me));
        $(me.parent).Events().subscribeOnce('navigate.prtg', $.proxy(function(){
          $(this.parent).Events().unsubscribe('refresh.events.prtg', $.proxy(this.refresh, this));
        },me));

			} else {
				if(me.$sensorTree.closest('.focussearch').length > 0)
					setTimeout(function () { $('#treesearch').focus();}, 0);
			}
		});
	};


	$.fn[pluginName] = function ( options, parent ) {
		var me = this;
		var elm = this;
		if(!!options){
			if(!!options.pluginTarget)
				me = $(options.pluginTarget);
			if(!!options.pluginFunction){
				return me.each(function(){
					$.data(this, "plugin_" + pluginName )[options.pluginFunction](elm, options);
				});
			}
		}
		return me.each(function () {
			if ( !$.data(this, "plugin_" + pluginName )) {
				$.data( this, "plugin_" + pluginName, new ObjectTree( this, options, parent ));
			}
		});
	};
})( jQuery, window, document );

// Library tree
// _Prtg.Lib.Data.Plugin.js
(function ( $, window, document, undefined ) {
  var pluginName = 'libdata';

	function LibTreeData( element, data, parent ) {

		this.element = element;
		this.data = data;  
		this.parent = parent;

		this.pipe = null;
	};

	LibTreeData.prototype.initNode = function(node){
		node['downsens'] = 0;
		node['downacksens'] = 0;
		node['partialdownsens'] = 0;
		node['warnsens'] = 0;
		node['upsens'] = 0;
		node['pausedsens'] = 0;
		node['unusualsens'] = 0;
		node['undefinedsens'] = 0;
		node['totalsens'] = 0;	
	}
	
	LibTreeData.prototype.loadLibData = function(junk, junki, i, sib){
		var self = this
			, nodeStateMap = _Prtg.Core.objects.nodeStateMap;
		if('filter' === junki.libkind){
			junki.basetype = 'library';
			return $.ajax( 
			  $.extend(true,{
					data: {
						id: junki.objid
					}},
				_Prtg.Core.objects['libObjects'])
			).done(function(d){
				self.initNode(junki);
				junki.leafs = null;
				if(d['treesize'] > 0 && d['libobjects'][0]['basetype'] === 'sensor'){
					junki.leafs = d['libobjects'];
					junki.totalsens = junki.leafs.length;
					for(var i=0, l = junki.leafs.length; i < l; ++i) {
						junki[nodeStateMap[junki.leafs[i].status]+'sens'] += 1;
					}
					var parent = junki._parent;
					while(parent){
						$.each(_Prtg.Core.objects.group.sensorTypeNames, function (key, val) {
								parent[val + 'sens']  += junki[val + 'sens'];
						});
						parent.devicenum += 1;
						parent = parent._parent;
					}
				}
			});
		}else	if('libraries' === junki.libkind){
			return $.ajax( 
			  $.extend(true,{
					data: {
						id: -6
					}},			  	
				_Prtg.Core.objects['libraries'])
			).done(function(d){
				junki.basetype = 'group';
				self.initNode(junki);
				if(d['treesize'] > 0){
					var content = d['library'];
					self.initLibraryData(content, content[0].fold).done(function(){
						content.unshift(i+1,0);
						junk.splice.apply(junk,content);					
					});
				}
			});
		}else	if('node' === junki.libkind){
				junki.basetype = 'library';
		}else if('linked' === junki.libkind){
			var parent = junki;
			junki.liblinkedid = 1 * junki.liblinkedid; //convert to integer
      if(!!sib && sib.objid === junki.liblinkedid){
        junki.basetype = 'library';
  				while(!!parent){
  					if(parent.hasOwnProperty('libkind')){
  						$.each(['group','device'], function(i, val){
  							parent[val+'num'] += sib[val+'num'];
  						});
  						$.each(_Prtg.Core.objects.group.sensorTypeNames, function (key, val) {
  							parent[val + 'sens']  += sib[val + 'sens'];
  						});
  					}
  					parent = parent._parent;
  				}
      }else{
        junki.basetype = 'device';
        return $.ajax( 
          $.extend(true,{
            data: {
              id: junki.liblinkedid
            }},         
          _Prtg.Core.objects['sensor'])
        ).done(function(d){
          junki._collapsed = true;
          junki.leafs = null;
          if(d['treesize'] > 0){
            junki.leafs = d['sensorxref'];
            junki.totalsens = junki.leafs.length;
            for(var i=0, l = junki.leafs.length; i < l; ++i) {
              junki[nodeStateMap[junki.leafs[i].status]+'sens'] += 1;
              junki.leafs[i].probegroupdevice = junki.probegroupdevice
              // junki.leafs[i].probegroupdevice.push(junki.leafs[i].objid)
            }
            var parent = junki._parent;
            while(parent){
              $.each(_Prtg.Core.objects.group.sensorTypeNames, function (key, val) {
                  parent[val + 'sens']  += junki[val + 'sens'];
              });
              parent.devicenum += 1;
              parent = parent._parent;
            }
          }
        });
		  }
    }
		return null;
	};

	LibTreeData.prototype.initLibraryData = function initLibraryData(junk, fold){
		var self = this
			, objids = {}
			, i = -1
			, l = junk.length;
    
    self.pipe = [];
		if(!self.junk) self.junk = junk;
		junk[0].fold = !!fold;
		while(++i < l){
			var junki = junk[i];
			if(!!junki.libkind){
				objids[junki.objid] = i;
				junki._parent = junki.probegroupdevice.slice(0);
			 	junki._parent.pop();
			 	junki._parent = junk[objids[junki._parent.pop()]];
				(function(junk, junki , i, sib){
          var def = self.loadLibData(junk, junki, i, sib);
          !!def && self.pipe.push(def);
				})(junk, junki, i, (i===l?null:junk[i+1]));
			}
		}
		return self.pipe;
	};
  _Prtg.Plugins.registerPlugin("libdata", LibTreeData);
})( jQuery, window, document );

/*
/   _Prtg.LibTree.Plugin.js
*/
(function ( $, window, document, undefined ) {
	var pluginName = "libtree";

	function LibTree( element, options, parent ) {
		this.element = element;
		this.options = options;
		this.parent = parent;

		this.$sensorTree = $(element);
        this.$parent = this.$sensorTree.parent();
		this.$sensorTree.attr('data-objects',null);
		this.grid = null;
		this.resizeTimer = null;
		this.$treeblocker = this.$sensorTree.find('#treeblocker');
		this.$editSettings = $('.editsettings');
		this.$dropTreeAdorner = $('<div id="treeAdorner" />');
		this.$dragSensor = null;
		this.$draggedSensor = null;
		this.unpinned = false;
		this.fullSize = false; //|| this.$sensorTree.parent().is('.treeiseditable');
		this.$positioncontainer = $('div#main');
		this.editable = this.$sensorTree.parents('#dropTarget').is('.treeiseditable');
		this.junk =this.options.objects;
		this.libName = this.options.libName;
		this.objectid = this.options.objectid;

		this.isNotRefreshable = this.options.isNotRefreshable || false;
		this.dragging = false;

		this.init(this, this.junk);
	};

	LibTree.prototype.refresh = function refreshObjectTree(){
		if(this.isNotRefreshable
		|| this.$sensorTree.find('.selected').length
		|| this.dragging)
			return;
		this.$sensorTree.sensortree('refresh');
	};

	LibTree.prototype.setFullsize =  function (val){
		this.fullSize = val === undefined ? this.fullSize : val;
		return this.fullSize;
	};

	LibTree.prototype.resize =  function (offsetTop, footer, buttons){
    footer = !!footer && footer.length > 0 ? footer[0] : false;
		this.$sensorTree.height(
			(window.innerHeight
				- offsetTop
				- (footer ? footer.offsetHeight : 0)
				- (buttons ? buttons.offsetHeight : 0)
				-50
			)
		).trigger('resize.objecttree');
	};

	LibTree.prototype.init = function init (me, junk) {
		var postDataLoadRequestLib = null
			, postDataLoadTimerLib = null
			, $layouts = $(me.parent).find("#layout")
			, libopts = $.extend(true,{}, _Prtg.Core.objects['library'], {
						treetype: 'library',
						gridOptions: {
								headerHeight: 0,
								showTopPanel: true,
								topPanelHeight: 31,
								showHeaderRow: false,
								headerRowHeight: 18
							},
							columns: [
								{
									id: 'content',
									name: _Prtg.Lang.sensorTree.strings.ColumnHeaderLibrary,
									formatter: function (row, cell, value, columnDef, dataContext) {
										if(!dataContext.libkind)
											return $.jqote(_Prtg.Core.getObject(dataContext.basetype.toLowerCase()).template, dataContext);
										else
											return $.jqote(_Prtg.Core.getObject('library').template, dataContext);

									},
		              width: _Prtg.Core.objects.nameColumnWidth,
		              minWidth: _Prtg.Core.objects.nameColumnWidth,
									cssClass: 'treeColumn'
								},
								{
									id: 'leafs',
									name: _Prtg.Lang.sensorTree.strings.ColumnHeaderSensors,
										formatter: function (row, cell, value, colDef, data) {
											var content = '<div class="sensorItem cell-inner c1 ' + data._classes.join(' ').trim() + '"' + ' type="' + data.basetype + '" objid="' + data.objid + '" idx="' + data._idx + '" path="' + data._id + '"><span></span></div>';
											if(/device/.test(data.basetype) === true){
												if (data._collapsed || !colDef.layout) {
													content = $.jqote(_Prtg.Core.getObject('sensor').deviceCollapsed.template, data);
												} else {
													content = $.jqote(_Prtg.Core.getObject('sensor').template, data);
												}
											} else {
												if(data._collapsed || !colDef.layout) {
													content = $.jqote(_Prtg.Core.getObject('sensor').groupCollapsed.template, data);
												} else {
													content = $.jqote(_Prtg.Core.getObject('sensor').template, data);
												}
											}
											return content;
									},
									asyncPostRender: function (cellNode, row, dx, colDef) {
										var content="";
											if (!!dx) {
												if (dx.basetype === 'device') {
													if (dx._collapsed || !colDef.layout) {
														content = $.jqote(_Prtg.Core.getObject('sensor').deviceCollapsed.template, dx);
													} else {
														content = $.jqote(_Prtg.Core.getObject('sensor').template, dx);
													}
												} else {
													if (dx._collapsed || !colDef.layout) {
														content = $.jqote(_Prtg.Core.getObject('sensor').groupCollapsed.template, dx);
													} else {
														content = $.jqote(_Prtg.Core.getObject('sensor').template, dx);
													}
												}
											}
											return content;
									},
									rerenderOnResize: true,
									width: '*',
									minWidth: 370,
									cssClass: 'valueColumn'
								}
							],
							postDataLoad: function postDataLoadLibrary(grid, from, to, dataContext, rows, idxByObjId, eventHelper, direction) {
								var loaderrors=false,
		              				opts = $.extend(true,{},_Prtg.Core.objects['sensor']),
									preload =_Prtg.Core.objects.deviceCache,
									dfd = $.Deferred(),
									transpose = {},
									ready = {},
									load = [],
									settings = {
										type: opts.type || 'GET',
										dataType: opts.dataType || 'text json',
										url: opts.url,
										data: opts.data,
										traditional: opts.traditional || false,
										cache: opts.cache || false,
										beforeSend: function(jqXHR){
											jqXHR.peNumber = 'PE1236'
										},
										success: function libSensorLoadSuccess(ret) {
											var d = ret[opts.data.content],
												to = d.length,
												node = null,
												i=0,l=0,
												pid=0,
												idx,
												now = $.now();
											postDataLoadRequestLib = null;
											for (i = 0; i < to; i++) {
												node = d[i].probegroupdevice.slice(0);
												node.pop();
												node = node.pop();
												$.each(transpose[node],function(j,node){
													if (!!node){
														if(!!node._updateLeafs) {
															node.leafs = [];
															node._updateLeafs = false;
														}
														!!node.leafs && node.leafs.push(d[i]);
													}
												});
											}
											eventHelper.notify(ready, null, grid);
											dfd.resolve();
										},
										error: function libSensorloadError(jqXHR, textStatus, errorThrown) {
											postDataLoadRequestLib = null;
											dfd.reject();
										}
									};
								if(!!postDataLoadTimerLib){
									clearTimeout(postDataLoadTimerLib);
									postDataLoadTimerLib = null;
								}

								if(!!postDataLoadRequestLib && postDataLoadRequestLib.readyState < 4){
									postDataLoadRequestLib.abort();
									postDataLoadRequestLib = null;
								}

                                if(direction !== undefined) {
                                    if (direction < 0){
                                        from = from - preload > 0 ? from - preload : 0;
                                    } else {
                                        from = from - 5 > 0 ? from - 5 : 0;
                                        to = to + preload < rows.length ? to + preload : rows.length - 1;
                                    }
                                }

								for(var i=from; i <= to; ++i){
									var item = dataContext[rows[i]];
									if(!!item && !item.libkind && item._updateLeafs){
										load.push(!!item.libkind? item.liblinkedid:item.objid);
										if(!transpose.hasOwnProperty(item.objid))
											transpose[item.objid] = [];
										transpose[item.objid].push(item);
										ready[[item.objid,'-',i].join('')] = i;
									}else if(!!item && !!item._loaderrors)
										loaderrors = true;
								}
								if(load.length > 0){
									if(load.length>1)
										settings.data.filter_parentid = '['+load.join(',')+']';
									else
										settings.data.filter_parentid = load;
									postDataLoadTimerLib = setTimeout(function(){
										postDataLoadTimerLib = null;
										postDataLoadRequestLib = $.ajax(settings)
									},10);
								} else {
									eventHelper.notify(ready, null, grid);
									dfd.resolve();
								}
		            if(!!_Prtg.Events && loaderrors){
		              loaderrors = $.extend(true, {}, _Prtg.Core.objects['sensor']);
		              loaderrors.data.filter_status='[5,13,14]';
		              loaderrors.data.count = '*';
		              loaderrors.data.id=0;
									dfd.promise().then(function(){
			              $.ajax({
			                type: 'POST',
			                dataType: 'text json',
			                url: loaderrors.url,
			                data: loaderrors.data,
			                traditional: loaderrors.traditional || false,
			                cache: loaderrors.cache || false
			              }).done(function(res){
			                if(!!res && !!res.treesize){
			                  var result = res.sensorxref;
			                  for(var x=0, m=result.length; x < m; ++x){
			                    result[x]._probegroupdevice = result[x].probegroupdevice.slice(0);
			                    result[x]._probegroupdevice.pop();
			                    result[x]._probegroupdevice.pop();
			                    result[x]._probegroupdevice = result[x]._probegroupdevice.join('-');
			                  }
			                  !!_Prtg.Events && _Prtg.Events.publish('leafs.refreshed.prtg',res);
			                  res = null;
			                }
			              });
		              });
		            }
								return dfd.promise();
							}
				})
			, objids = {};

		me.libraryData = _Prtg.Plugins['libdata'].init.apply(me.element,[me.options, me.parent]);

		// if(junk.treesize > 1 ){
		// 	$('.centeredHint').remove();
		// }else{
		// 	$('.centeredHint').show().delay(5000).fadeOut(2000).remove();
		// }

		if(!me.fullSize){
			_Prtg.Events.subscribe('prtg.resize.layout',$.proxy(
				me.resize,
				me,
				me.$sensorTree.offset().top,
				document.getElementsByTagName('footer'),
				document.getElementById('sensortreelinks')
			));

				me.resize(
					me.$sensorTree.offset().top,
					document.getElementsByTagName('footer'),
					document.getElementById('sensortreelinks')
				);
		}
		$.when.apply($,me.libraryData.initLibraryData(junk['library']))
		.then( function(){
			var tree = me.$sensorTree.sensortree($.extend(true, {},
				libopts, {
					treetype: 'library',
					layout: (me.editable ? 'sensortreenormal': me.options.viewType),
					data: {
						id: me.options.objectid
					},
					initLibraryData: function(junk, name){return me.libraryData.initLibraryData(junk, name)},
					editMode: me.editable,
					dragMode: me.editable,
          hideControls: !!me.options.hideControls,
					controlsParent: me.options.controlsParent || '#loadedcontent,#mainstuff',
					displayMode: (me.options.displayMode || 'overview'),
					gridOptions: {
						fullHeight: me.fullSize,
						showTopPanel: !me.editable,
						setFullsize: function(){me.setFullsize();}
					},
					timer: $(me.parent).Events()
			}), junk);

			if(!me.isNotRefreshable){
				$(me.parent).Events().subscribe('refresh.events.prtg', $.proxy(me.refresh, me));
				me.$sensorTree.on('destroyed', function(){
					$(me.parent).Events().unsubscribe('refresh.events.prtg', $.proxy(me.refresh, me));
				});
			}
			me.$sensorTree.sensortree('subscribe', 'onDragStart', function dragend(e, d) {
				me.dragging = true;
				e.stopImmediatePropagation();
			});
			me.$sensorTree.sensortree('subscribe', 'onDragEnd', function dragend(e, d) {
				me.$sensorTree.find('.selected').removeClass('selected');
				me.dragging = false;
				e.stopImmediatePropagation();
			});

			tree
				.appendTo(me.$parent)
				.parents()
				.removeClass('loading');
			if(junk.treesize > 1 ){
				$('.centeredHint').remove();
			}else{
				$('.centeredHint').css('position','relative').show().delay(8000).fadeOut(2000);
			}
		});

		$(document)
			.off('click.contextmenu','li#libaddlib, a.libaddlib')
			.on('click.contextmenu' ,'li#libaddlib, a.libaddlib',function(e){
				var data = me.$sensorTree.data('sensortree')
					, context = $(this).data('element').context;
				$(this).removeData('element');
				if(!!context){
					me.$treeblocker.show();
					me.$sensorTree.removeClass('cursor-none cursor-copy').addClass('cursor-progress');
					data.dataview.addLibrary(data.grid, parseInt($(context).attr('id'), 10), -1, parseInt($(context).attr('row'), 10), me.libraryData.initLibraryData).always(function(){
						me.$treeblocker.hide();
						me.$sensorTree.removeClass('cursor-progress');
					});
				}
				return false;
			});
	};

	LibTree.prototype.drop= function drop(e, d) {
		var $target = $(e.target).closest('.slick-row').find('.treeItem[type="filter"],.treeItem[type="node"],.treeItem[type="linked"]').first()
			, isnode = $target.has('[objid]')
			, row = parseInt(($target.attr('idx') || -1))
			, dataview = this.$sensorTree.data('sensortree').dataview
			, objid = (d.hasOwnProperty('sensorIdx') ? d.data.leafs[d.sensorIdx].objid : d.data.objid)
			, libid =  isnode ? parseInt($target.attr('objid')) : me.objectid
			, me = this;
		this.dragging = false;
		if(d.feedback !== false){
			me.$treeblocker.show();
			me.$sensorTree.removeClass('cursor-none cursor-copy').addClass('cursor-progress');
			if (d.type !== 'library') {
				dataview.addLibrary(me.$sensorTree.data('sensortree').grid, libid, objid, row, me.initLibraryData)
					.always(function(){
						me.$sensorTree.removeClass('cursor-progress');
						me.$treeblocker.hide();
						me.$sensorTree.sensortree('refresh');
					});
			} else if(d.feedback === 'move'){
				d.dataView.moveNode(me.$sensorTree.data('sensortree').grid, d.row, row, me.initLibraryData)
					.always(function(){
						me.$sensorTree.removeClass('cursor-progress');
						me.$treeblocker.hide();
						me.$sensorTree.sensortree('refresh');
					});
			}
		}
		me.$sensorTree.data('sensortree').grid.onDragEnd.notify(d,e);
		e.stopImmediatePropagation();
	};

	LibTree.prototype.dropend = function dropend(e, d) {
		this.dragging = false;
	};
	LibTree.prototype.dropstart= function dropstart(e, d) {
		var $target = $(e.target).closest('.slick-row').first().find('[idx]')
			, row = parseInt(($target.attr('idx') || -1))
			, dstType = ($target.find('library')[0] || $target).localName
			, isnode = $target.attr('type') === 'node'
			, me = this;
		me.dragging = true;
		d.target = this;
		d.feedback = false;
		me.$dropTreeAdorner.removeAttr('class').remove();
		me.$sensorTree.find('.indent').removeClass('hovered');
		if (/library/.test(dstType)){
				var classes = 'ui-icon-play level0 ';
				if (d.type !== 'library'){
					d.feedback = 'copy';
					if(isnode)
						classes += 'dropOnClosed';
					else
						d.feedback = false;
				} else {
					d.feedback = 'move';
					if(row === d.row
					|| me.$sensorTree.data('sensortree').dataview.isChild(d.row,row))
						d.feedback = false;
					else if(isnode)
						classes += 'dropOnClosed';
					else if(row < d.row && row > 0)
						classes += 'dropBefore';
					else{
						var nextSibling = me.$sensorTree.data('sensortree').dataview.Data()[row]._nextSibling;
						if(!!nextSibling){
							$target = me.$sensorTree.find('[path="'+ nextSibling._id + '"]');
							classes += 'dropBefore';
						} else {
							$target = me.$sensorTree.find('.slick-row row').last();
							classes += 'dropAfter';
						}
					}
				}
				$target = $target.first().closest('.slick-row');
				if(d.feedback && $target.length){
					me.$dropTreeAdorner.addClass(classes);
					$target.prepend(me.$dropTreeAdorner);
					if(d.feedback === 'copy')
						$target.find('.indent').addClass('hovered');
					return true;
				} else
					d.feedback = false;
			return false;
		}
	};

	LibTree.prototype.add = function(objid,e,d){
		var self = this
			, dfd = $.Deferred();
				dfd.resolve(null);
		return dfd.promise();
	}

	LibTree.prototype.getData = function(){
		return null;//this.currentData;
	};


	$.fn[pluginName] = function ( options, parent ) {
		var me = this
			, elm = this;
		if(!!options){
			if(!!options.pluginTarget)
				me = $(options.pluginTarget);
			if(!!options.pluginFunction){
				return me.each(function(){
					$.data(this, "plugin_" + pluginName )[options.pluginFunction](elm, options);
				});
			}
		}
		return me.each(function () {
			if ( !$.data(this, "plugin_" + pluginName )) {
				$.data( this, "plugin_" + pluginName, new LibTree( this, options, parent ));
			}
		});
	};

})( jQuery, window, document );


// Module: Toplists
(function($, window, document, undefined) {
	var sourceRegex = /source/ig;
	var source2Regex = /(source|ip|channel)/ig;
	var destinRegex = /destination/ig;
	_Prtg.Graphixs = _Prtg.Graphixs || { "___": '_Prtg.Graphixs' };
	$.extend(true, _Prtg.Graphixs, {
    asImage: function($self, svg, w, h){
      var s = new XMLSerializer()
        , arr = _Prtg.Util.strToUTF8Arr((svg.outerHTML || s.serializeToString(svg)));
      return 'data:image/svg+xml;base64,' + _Prtg.Util.base64EncArr(arr);
    },
		Toplist: { 
			Chord: {
				render: function render(data, to, preview, width, height, legends, sourcesStr, destinationsStr, renderAsImage){

					to = typeof(to)==='string'?$(to):to;
					if(data.length===0 || data[0].Size===0 || to.length === 0) return;
					if(width === undefined) width = to.width();
					if(height=== undefined) height = to.height();

					var r1 = Math.min(width, height) / 2
						, r0 = preview===true?r1 -r1/7:r1 - r1*0.5
						, maxcaption = Math.floor(r1/2 / 8)
						, u = Math.floor(Math.PI * r1 * 0.15)
						, ourcolors=[_Prtg.Colors.mousegray, _Prtg.Colors.graph2, _Prtg.Colors.graph4, _Prtg.Colors.graph5,_Prtg.Colors.graph6, _Prtg.Colors.graph7, _Prtg.Colors.graph8]
						// we intentionally do not use colors 1 (red) and 3 (dark blue)
						, fill = d3.scale.ordinal().range(ourcolors)
						, chord = d3.layout.chord()
							.padding(0)
							.sortSubgroups(d3.descending)
							.sortChords(d3.ascending)
						, arc = d3.svg.arc()
							.innerRadius(r0)
							.outerRadius(r0 + r0/7)
						, vis = d3.select(to[0]).append("svg:svg")
                .attr({
                  "version": 1.1,
                  "xmlns": "http://www.w3.org/2000/svg",
                  "xmlns:xmlns:xlink":"http://www.w3.org/1999/xlink",
                  "width": width,
                  "height": height
                })
						, svg = vis.append("svg:g")
							.attr("transform", "translate(" + r1 + "," + r1 + ")")
						, indexByName = {}
						, nameByIndex = {}
						, matrix = []
						, n = 0
						, row = []
						, other = null
						, sources = (function(){
								var src = sourcesStr || $.map(Object.keys(data[0]),function(e){ if(sourceRegex.test(e)) return e;}); 
								return src.length> 0 ? src : [Object.keys(data[0])[1]];
							})()
						, destinations = destinationsStr || $.map(Object.keys(data[0]),function(e){ if(destinRegex.test(e)) return e;})
						// , destinations = destinationsStr || $.map(['DestinationIP','DestinationMAC','DestinationPort'], function(e){ if(data[0].hasOwnProperty(e)) return e;})
						, values = "Size"
						, src = names(sources)
						, dst = names(destinations)
						, sum = 0.0;
					
					if(sources.toString() === destinations.toString()){
							destinations = [];
							dst = names(destinations);
					}

					if(!data[0].hasOwnProperty(values))
						return;
					if(destinations.length === 0){
						sources = $.map(Object.keys(data[0]),function(e){ if(source2Regex.test(e)) return e;})
						// sources = $.map([ 'IP','Channel','SourceIP','SourceMAC','SourcePort'], function(e) { if(data[0].hasOwnProperty(e)) return e;});
						src = names(sources);
					}
					// search for the "other" record
					for(var i = 0; i < data.length; i++) {
						if(data[i]['position'] === _Prtg.Lang.common.strings.Other) {
							other = data[i];
							other[sources[0]] = data[i]['position'];
							other[destinations[0]] = data[i]['position'];
							break;
						}
					}
					// normalize to MB and sum values
					// move surplus records to other
					for(var i = 0; i < data.length; i++) {
						data[i][values+'x'] = data[i][values];
						data[i][values] = data[i][values] !==0 ? data[i][values]/0x100000 : data[i][values];
						sum += data[i][values];
						if(!!other && i > u){
							//other[values] += data[i][values];
							data[i][sources[0]] = other[sources[0]];

						}
					}
					// build up the lookup lists
					// creating the column names from source and destination properties
					// index by name and
					// name by index
					$.each(data,function(i,d) {
						var name = src.name(d);
						if(!indexByName.hasOwnProperty(name)){
							indexByName[name] = n;
							nameByIndex[n] = {
								src: name,
								dst: [
									{
										name:dst.name(d),
										val: d[values]
									}
								]
							};
							++n;
							name = dst.name(d);
							if(!indexByName.hasOwnProperty(name)){
								indexByName[name] = n;
								nameByIndex[n] = {
									src: name,
									dst: []
								};
								++n;
							}
		        } else {
							nameByIndex[indexByName[name]].dst.push(
		            {
		              name:dst.name(d),
									val: d[values]
								}
							);
						}
					});
					if(destinations.length > 0 && sources.length > 0){
						// initialize matrix columns
						$.each(nameByIndex,function() {
							row.push(0);
						});
						// initialize matrix rows
						$.each(nameByIndex,function() {
							matrix.push(row.slice(0));
						});

						// Construct a square matrix counting package imports.
						$.each(indexByName,function(i,r) {
								var d = nameByIndex[r];
								$.each(indexByName,function(j,c){
										var e = nameByIndex[c];
										if(d.src === e.src) {
											$.each(e.dst,function(i,x){
												c = indexByName[x.name];
												if(c !== undefined){
													matrix[r][c] += x.val;
												}
											});
										}
								});
						});
						chord.matrix(matrix);
						var g = svg.selectAll("g.group")
							.data(chord.groups)
							.enter().append("svg:g")
							.on('mouseover', function(d, i) {
		            $('.chord').not($('path.s'+d.index + ',path.t'+d.index)).css('opacity',0.05);
							})
							.on('mouseout', function(d, i) {
		            $('.chord').not($('path.s'+d.index + ',path.t'+d.index)).css('opacity',0.33);
							})
							.attr("class", function(d){return "group id-"+d.index;});
						g.append("svg:path")
							.style("fill", function(d) { return fill(d.index); })
							.style("stroke", function(d) { return fill(d.index); })
							.attr("d", arc)
							.insert("svg:title")
							.text(function(d) { return nameByIndex[d.index].src; });

						g.append('svg:text') //prozentzahlen
							.each(function(d) {
								d.angle = (d.startAngle + d.endAngle) / 2;
								d.width = (d.endAngle - d.startAngle) * r0;
							})
							.attr("dy", ".35em")
							.attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
							.attr("transform", function(d) {
								return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
									+ "translate(" + (r1 *0.5+3) + ")"
									+ (d.angle > Math.PI ? "rotate(180)" : "");
							})
							.attr("style", 'font-size:9px')
							.text(function(d) { return d.width > 9 ? percentage(d.value) : null; });

						g.append("svg:text") // Beschriftungen
							.attr("dy", ".35em")
							.attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
							.style("font-size", function(d) {if (d.width>10) {return "12px"; } else if (d.width>6) {return "9px"; } else  return "7px";}) //Label ausblenden wenn zu schmal
							.style("display", function(d) {if (d.width>3) {return ""; } else return "none";}) //Label ausblenden wenn zu schmal
							.attr("transform", function(d) {
								return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
										+ "translate(" + (r0 + r0/9+ 10) + ")"
										+ (d.angle > Math.PI ? "rotate(180)" : "");
							})
							.text(function(d) { return preview===true?null:nameByIndex[d.index].src.centerellipsis(maxcaption).trim(''); })
              .attr("class", "toplist-caption")
							.insert("svg:title")
							.text(function(d) { return nameByIndex[d.index].src; });

						svg.selectAll("path.chord")  //Bunte Bögen
							.data(chord.chords)
							.enter().append("svg:path")
							.on('mouseover', function(d, i){
		            $(this).css('opacity',1);
							})
							.on('mouseout', function(d, i){
		            $(this).css('opacity',0.33);
							})
							.attr("class", function(d){return "chord s" + d.source.index + ' t' + d.target.index;})
							.style("stroke", function(d) { return d3.rgb(fill(d.source.index)); })
							.style("stroke", function(d) { return d3.rgb(fill(d.source.index)).darker(0.5); })
							.style("fill", function(d){return fill(d.source.index);})
              .style("opacity",0.33)
							.style("display", function(d) { if (d.source.endAngle - d.source.startAngle < Math.PI) {return ""; } else  return "none";}) //ausblenden des kaputten Bogens wenn >180°
							.attr("d", d3.svg.chord().radius(r0))
							.insert("svg:title")
							.text(function(d) { return nameByIndex[d.source.index].src; });



						if(sources.length >1)
							to.append('<span>'+_Prtg.Lang.common.strings.Groups+': '+sources.join(':').replace(/Source/g,'')+'</span>');
					} else {

						////
						//// PIE Chart
						////
						$('.animation').hide();
						arc.innerRadius(r1/5);
						var pie = d3.layout.pie()
							.value(function(d) { return +d[values]; })
							.sort(function(a, b) { return b[values] - a[values]; });
						var g = svg.selectAll("g.group")
							.data(function(d) { return pie(data); })
							.enter().append("svg:g")
							.attr("class", "group");

						g.append("svg:path")
							.attr("fill", function(d) { return fill(src.name(d.data)||dst.name(d.data)); })
							.attr("stroke", function(d) { return fill(src.name(d.data)||dst.name(d.data)); })
							.attr("d", arc)
							.attr("data-legend", function(d){ return percentage(d.data[values]) >= 1 ? src.name(d.data) : null;})
							.insert("svg:title")
							.text(function(d) { return src.name(d.data); });
						g.append('svg:text')
							.each(function(d) {
								d.angle = (d.startAngle + d.endAngle) / 2;
								d.width = (d.endAngle - d.startAngle) * r0;
							}) 
							.attr("dy", ".35em")
							.attr("class", "values")
							.attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
							.attr("transform", function(d) {
								return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
									+ "translate(" + (r1 *.3) + ")"
									+ (d.angle > Math.PI ? "rotate(180)" : "");
							})
							.attr("style", 'font-size:9px')
							.text(function(d) { return d.width > 10 ? percentage(d.data[values]) +'%': null; });
						if(legends)
							svg.append("g")
		            .attr("class", "legend toplist-caption")
		            .attr("transform", "translate("+r0*1.5+",-"+r0+")")
		            .style("font-size", "12px")
		            .call(d3.legend);
		        else
							g.append("svg:text")
								.attr("dy", ".35em")
								.attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
								.style("font-size", function(d) {if (d.width>10) {return "12px" } else if (d.width>6) {return "9px" } else  return "7px";}) //Label ausblenden wenn zu schmal
								.attr("transform", function(d) {
									return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
									  + "translate(" + (r0 + r0/10+ 10) + ")"
										+ (d.angle > Math.PI ? "rotate(180)" : "");
								})
								.text(function(d) {return preview===true?null:d.width > 6 ? src.name(d.data).centerellipsis(maxcaption).trim('') : null; })
                .attr("class", "toplist-caption")
								.insert("svg:title")
								.text(function(d) { return src.name(d.data); });
					}
					if(to.hasClass('zoomable'))
						to.append('<a class="zoom" title="'+_Prtg.Lang.common.strings.ZoomGraph+'" href="" target="_blank"><i class="ui-icon ui-icon-newwin"></i></a>');
          if(renderAsImage)
            return _Prtg.Graphixs.asImage(to, vis[0][0], width, height);
            
					function names(c){
						return {
							name : function(d){
								var ret = [];
								$.each(this.columns, function(i,e){
									ret.push(d[e]);
								});
								return ret.join(' : ');
							},
							columns: c
						};
					}
					function percentage(a){
						var val = a / sum * 100;
						if(val < 1)
							return '<1%';
						else
							return Math.round(val,0);
					}
        }
			},
			Linkage:{
				render: function render(data,to, width, height, sourcesStr, destinationsStr){
				to = typeof(to)==='string'?$(to):to;
				if(!data[0] || to.length === 0) return;
				if(width === undefined) width = to.width();
				if(height=== undefined) height = to.height();

				var dx = {nodes:[],links:[]}
					, nameByIndex = {}
					, n = 0
					, u = 40
					, other = null
					, sources = $.map(['SourceIP','SourceMAC','SourcePort'], function(e){ if(data[0].hasOwnProperty(e)) return e;})
					, destinations = $.map(['DestinationIP','DestinationMAC','DestinationPort'], function(e){ if(data[0].hasOwnProperty(e)) return e;})
					, values = "Size"
					, src = names(sources)
					, dst = names(destinations)
					, sum = 0.0;


				var margin = {top: 80, right: 0, bottom: 10, left: 80},
					width = 600,
					height = 600;

				var x = d3.scale.ordinal().rangeBands([0, width]),
					z = d3.scale.pow().domain([0, 1.9]).clamp(true),
					c = d3.scale.category20().domain(d3.range(40));

				var svg = d3.select("body").append("svg")
						.attr("width", width + margin.left + margin.right)
						.attr("height", height + margin.top + margin.bottom)
						.style("margin-left", margin.left + "px")
					.append("g")
						.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

					function render(data) {
						var matrix = [],
								nodes = data.nodes,
								n = nodes.length;

						// Compute index per node.
						nodes.forEach(function(node, i, a) {
								a[i] = {
										name:node.split(' : ')[0],
										group:node.split(' : ')[1],
									index:i,
									count:0};
							matrix[i] = d3.range(n).map(function(j) { return {x: j, y: i, z: 0}; });
						});

						// Convert links to matrix; count character occurrences.
						data.links.forEach(function(link) {
							matrix[link.source][link.target].z += link.value;
							matrix[link.target][link.source].z += link.value;
							matrix[link.source][link.source].z += link.value;
							matrix[link.target][link.target].z += link.value;
							nodes[link.source].count += link.value;
							nodes[link.target].count += link.value;
						});

						// Precompute the orders.
						var orders = {
							name: d3.range(n).sort(function(a, b) { return d3.ascending(nodes[a].name, nodes[b].name); }),
							count: d3.range(n).sort(function(a, b) { return nodes[b].count - nodes[a].count; }),
							group: d3.range(n).sort(function(a, b) { return nodes[b].group - nodes[a].group; })
						};

						// The default sort order.
						x.domain(orders.name);

						svg.append("rect")
								.attr("class", "background")
								.attr("width", width)
								.attr("height", height);

						var row = svg.selectAll(".row")
								.data(matrix)
							.enter().append("g")
								.attr("class", "row")
								.attr("transform", function(d, i) { return "translate(0," + x(i) + ")"; })
								.each(row);

						row.append("line")
								.attr("x2", width);

						row.append("text")
								.attr("x", -6)
								.attr("y", x.rangeBand() / 2)
								.attr("dy", ".32em")
								.attr("text-anchor", "end")
								.text(function(d, i) { return nodes[i].name; });

						var column = svg.selectAll(".column")
								.data(matrix)
							.enter().append("g")
								.attr("class", "column")
								.attr("transform", function(d, i) { return "translate(" + x(i) + ")rotate(-90)"; });

						column.append("line")
								.attr("x1", -width);

						column.append("text")
								.attr("x", 6)
								.attr("y", x.rangeBand() / 2)
								.attr("dy", ".32em")
								.attr("text-anchor", "start")
								.text(function(d, i) { return nodes[i].name; });

						function row(row) {
							var cell = d3.select(this).selectAll(".cell")
									.data(row.filter(function(d) { return d.z; }))
								.enter().append("rect")
									.attr("class", "cell")
									.attr("x", function(d) { return x(d.x); })
									.attr("width", x.rangeBand())
									.attr("height", x.rangeBand())
									.style("fill-opacity", function(d) { return z(d.z); })
									.style("fill", function(d) { return nodes[d.x].group == nodes[d.y].group ? c(nodes[d.x].group) : null; })
									.on("mouseover", mouseover)
									.on("mouseout", mouseout);
						}

						function mouseover(p) {
							d3.selectAll(".row text").classed("active", function(d, i) { return i == p.y; });
							d3.selectAll(".column text").classed("active", function(d, i) { return i == p.x; });
						}

						function mouseout() {
							d3.selectAll("text").classed("active", false);
						}

						d3.select("#order").on("change", function() {
							clearTimeout(timeout);
							order(this.value);
						});

						function order(value) {
							x.domain(orders[value]);

							var t = svg.transition().duration(2500);

							t.selectAll(".row")
									.delay(function(d, i) { return x(i) * 4; })
									.attr("transform", function(d, i) { return "translate(0," + x(i) + ")"; })
								.selectAll(".cell")
									.delay(function(d) { return x(d.x) * 4; })
									.attr("x", function(d) { return x(d.x); });

							t.selectAll(".column")
									.delay(function(d, i) { return x(i) * 4; })
									.attr("transform", function(d, i) { return "translate(" + x(i) + ")rotate(-90)"; });
						}

					};

					if(!data[0].hasOwnProperty(values))
						return;
					if(destinations.length === 0){
						sources = $.map([ 'IP','Channel','SourceIP','SourceMAC','SourcePort'], function(e){ if(data[0].hasOwnProperty(e)) return e;})
						src = names(sources)
					}
					for(var i = 0; i < data.length; i++) {
						if(data[i]['position'].lastIndexOf('.') === -1){
							data[i][sources[0]] = data[i]['position'];
							data[i][destinations[0]] = data[i]['position'];
							other = data[i];
							break;
						}
					}
					for(var i = 0; i < data.length; i++) {
						data[i][values] = data[i][values] !==0 ? data[i][values]/0x100000 : 0.0;
						if(!!other && i > u)
							other[values] += data[i][values];
					}
					 data = data.slice(0 , u);
					$.each(data,function(i,d) {
						var srcname = src.name(d)
								, srcidx = dx.nodes.indexOf(srcname);
						if(srcidx === -1)
								srcidx = dx.nodes.push(srcname)-1;
						 var dstname = dst.name(d)
								, dstidx = dx.nodes.indexOf(dstname);
						if(dstidx === -1)
								dstidx = dx.nodes.push(dstname)-1;

							dx.links.push({
								"source": srcidx,
								"target": dstidx,
								"value": d[values]
								});
					});

					renderMatrix(dx);
					function names(c){
						return {
							name : function(d){
								var ret = [];
								$.each(this.columns, function(i,e){
									ret.push(d[e]);
								});
								return ret.join(' : ');
							},
							columns: c
						}
					};
					function percentage(a){
						var val = a / sum * 100;
						if(val < 1)
							return '<1%';
						else
							return Math.round(val,0) +'%';
					};
				}
			}
		}
	});
})(jQuery, window, document);

//_Prtg.Toplist.Toplist.js
//Plugins: toplistperiods, toplist, toplistpreview
(function($, window, document, undefined) {

  function Periods(element, data, parent) {
    this.element = $(element);
    this.data = data;
    this.parent = $(parent);
    this.template = _Prtg.Core.objects.toplistTimeline;
    this.init(this);
    this.filters = {sdate: 0, edate: Math.pow(2, 53)};
	};

  Periods.prototype.init = function(me) {
    var topnumber;
    me.element.on('click','li',function() {
      var val = $(this).attr('query');
      if(!!val) {
        val += '&subid='+me.data.subid;
        me.element.attr('query',$(this).attr('id')).find('li').removeClass('selected');
        $(this).addClass('selected');
        _Prtg.Hjax.loadLink('toplist.htm?'+val,{url:'/controls/toplistscontent.htm#toplistcontent'});
        $('#updatehref').attr('href',$('#updatehref').attr('href').split('?')[0]+'?'+val);
      }
    });
    this.render(this.data.objects);

    _Prtg.Events.subscribe('refresh.events.prtg', $.proxy(me.refresh, me));
    _Prtg.Events.subscribe('datetimpicker.change', $.proxy(me.filter, me));
    me.element
      .one('destroyed',function() {
        _Prtg.Events.unsubscribe('refresh.events.prtg', $.proxy(me.refresh, me));
        _Prtg.Events.unsubscribe('datetimpicker.change', $.proxy(me.filter, me));
      });

  };

  Periods.prototype.render = function(data) {
    var topnumber;
    var self = this;
    this.element.css('max-height', $(window).height() - this.element.offset().top -76);
    if(!data || !data.topidx) return;
    this.element.empty().html(
      $.jqote(self.template.template, data.topidx)
    );
    topnumber = this.element.find('li#topnumber_'+_Prtg.Util.getUrlVars()['topnumber']);
    if(topnumber.length === 0) topnumber = this.element.find('li').eq(0);

    topnumber.addClass('selected');
  };

  Periods.prototype.refresh = function() {
    var self = this;
    $.ajax({
      url: this.template.url,
      dataType: 'json',
      data: $.extend(this.template.data,{id:this.data.objid,subid:this.data.subid})
    }).done(function(data) {
      self.render.call(self,data);
      self.filter.call(self);
    });
  };

  Periods.prototype.filter = function(e, plugin, reset) {
    var me = this
      , nulls = {sdate: 0,edate: Math.pow(2, 53)}
      , idx;

    if(!!plugin) {
      idx = plugin.$picker.context.id;
      if(reset === "reset") {
          this.filters[idx] = nulls[idx];
      } else {
        if(!!plugin.currentDateText) {
          this.filters[idx] = (new Date(plugin.currentDateText)).getTime();
        } else {
          this.filters[idx] = nulls[idx];
        }
        if(this.filters['sdate'] > this.filters['edate']) {
          idx = this.filters['sdate'];
          this.filters['sdate'] = this.filters['edate'];
          this.filters['edate'] = idx;
          if(idx === 'sdate' && this.filters['edate'] !== nulls['edate']) this.filters[idx] += 86400000;
        } else if(idx === 'edate' && this.filters['edate'] !== nulls['edate']) this.filters[idx] += 86400000;

      }
    }
    var sdate = me.filters.sdate
      , edate = me.filters.edate;
    this.element.find('ul').each(function() {
      var self = $(this)
        , unix = self.data().unix;
      if(sdate <= unix && edate > unix) self.show();
      else self.hide();
    });
  };

  _Prtg.Plugins.registerPlugin("toplistperiods",Periods);


  function Toplist(element, data, parent) {
    this.element = $(element);
    this.data = data;
    this.parent = parent;
    this.$parent = $(parent);
    this.timer = this.$parent.Events && this.$parent.Events();
    this.animationdata = data.animation || null;
    this.preview = data.preview || false;
    this.animId=0;
    this.legend = data.legend;
    this.asImage = !!data.asimage || false;
    this.init(this);
  }

  Toplist.prototype.init = function(me) {
    if(!!!me.data.nonrefreshable) {
			this.timer.subscribe('refresh.events.prtg', $.proxy(this.refresh, this));
			this.timer.subscribeOnce('navigate.prtg', $.proxy(function(e) {
				this.timer.unsubscribe('refresh.events.prtg', $.proxy(this.refresh, this));
			}, this));
		}
    me.statical(me, me.data.objects);
  };

  Toplist.prototype.refresh = function(e) {
    // console.log("update")
    var me = this;
    $.ajax({
      url: '/api/toplist.json',
      data:{
        id: me.data.objectid,
        topnumber: me.data.topnumber,
        subid: me.data.subid
      },
      dataType: 'json'
    }).done(function(data) {
      me.element.parents('#toplist').find('#toplistperiod').text(data.period + data.warning);
      me.statical(me,data.data);
    });
  };

  Toplist.prototype.update = function(data) {
    var me = this;
    if(!!data) me.statical(me,data.data);
  };

  Toplist.prototype.statical = function statical(me, data) {
    if(!!data && (data.topdata || data.topreport)) {
      var w = me.element.width()  || this.data.width
        , h = me.element.height() || this.data.height
        , $new = $('<div/>', {
          'class': (me.element.is('.zoomable') ? 'toplist-chordgraph zoomable' : 'toplist-chordgraph'),
          'style': 'width:'+w+'px;height:'+h+'px;'
        });
      $.when(_Prtg.Graphixs.Toplist.Chord.render((data.topdata||data.topreport),$new, me.preview, w,h,me.legend,undefined,undefined, me.asImage))
        .done(function(img) {
          if(!img){
            $new.prependTo(me.element.empty());
            $new.find('.zoom').attr('href',"graphzoomtoplist.htm?id="+ me.data.objectid+"&subid="+me.data.subid+"&topnumber="+me.data.topnumber);
          }else{
            $('<img src="' + img + '" width="'+w+'px" height="'+h+'px">').prependTo(me.element.empty());
          }
        });
    }
  };

  _Prtg.Plugins.registerPlugin("toplist",Toplist);

  function TolplistPreview(element,data,parent) {
    this.element = $(element);
    this.content = this.element.find('.scroll-content');
    this.elmH = this.content.children().eq(0).outerHeight(true)+3;
    this.data = data;
    this.parent = parent;
    this.scroll = 0;
    this.init(this);
  }

  TolplistPreview.prototype.init = function init(me) {
    me.show();
    me.element
      .on('click', '.scroll.left', function() {
        me.scroll = (me.scroll <= -me.elmH ? (me.scroll+=me.elmH) : (-me.content.height() + me.elmH));
        me.content.css({'margin-top': me.scroll});
      })
      .on('click', '.scroll.right', function() {
        me.scroll = (me.scroll >= -me.content.height() + me.elmH ? (me.scroll-=me.elmH) : 0);
        me.content.css({'margin-top':me.scroll});
    });
    $(window).on('resize.toplists',$.proxy(me.show,me));
    me.element.one('destroyed',function() {$(window).off('resize.toplists');});
  };

  TolplistPreview.prototype.show = function show() {
    if(this.elmH < this.content.height()) {
        this.element.find('.scroll').show();
      } else {
        this.element.find('.scroll').hide();
        this.content.css({'margin-top':0,'margin-left':2});
      }
  };

  _Prtg.Plugins.registerPlugin("toplistpreview",TolplistPreview);

})( jQuery, window, document );

//_Prtg.Toplists.Plugin.js
(function($, window, document, undefined) {
  var pluginName = 'toplists';

  function Plugin(element, data, parent) {
    this.element = $(element);
    this.data = data;
    this.parent = parent;
    this.init(this);
  }

  Plugin.prototype.init = function(me) {
    me.element.on('click', '.toplistsettings.add', function addToplist(e) {
      var data = $(e.target).data();
      _Prtg.Dialogs.defaultDialog("/controls/toplistadd.htm", {
        id: data.id,
        subid: 'new'
      }, {
        buttonText0: _Prtg.Lang.common.strings.save
      }).done(function(result) {
        result = $.extend(true, result, {
          targeturl: ''
        });
        return $.post("editsettings", result).done(function() {
          $('.refresh-on-change', me.parent).each(function() {
            $(this).load($(this).attr('refreshurl'), function() {
              _Prtg.initPlugins($(this));
            });
          });
        });
      }).fail(function() {});
    }).on('click', '.toplistsettings .editsetting', function editToplist(e) {
      var data = $(e.target.parentElement).data();
      _Prtg.Dialogs.defaultDialog("/controls/toplistedit.htm", {
        id: data.id,
        subid: data.subid
      }, {
        buttonText0: _Prtg.Lang.common.strings.save
      }).done(function(result) {
        result = $.extend(true, result, {
          targeturl: ''
        });
        return $.post("editsettings", result).done(function() {
          $('.refresh-on-change', me.parent).each(function() {
            $(this).load($(this).attr('refreshurl'), function() {
              _Prtg.initPlugins($(this));
            });
          });
        }).fail(function() {});
      }).fail(function() {});
    }).on('click', '.toplistsettings .delete', function deleteToplist(e) {
      var data = $(e.target.parentElement).data();
      _Prtg.Dialogs.defaultDialog("/controls/toplistdelete.htm", {
        id: data.id,
        subid: data.subid
      }, {
        width: 300,
        buttonText0: _Prtg.Lang.common.strings['delete']
      }).done(function(result) {
        return $.post("/api/toplistdelete.htm", result).done(function() {
          if (document.location.href.indexOf('subid=' + data.subid) > -1) _Prtg.Hjax.loadLink(document.location.href.replace(/&subid=\d+|subid=\d+&/gi, ""), "linkloader.prtg", me.element, true);
          else $('.refresh-on-change', me.parent).each(function() {
            $(this).load($(this).attr('refreshurl'), function() {
              _Prtg.initPlugins($(this));
            });
          });
        });
      }).fail(function() {});
    }).on('click', '.toplistitem,.showtoplist', {
      namespace: "linkloader.prtg",
      container: me.element
    }, _Prtg.Hjax.linkClickHandler);
  };
  $.fn[pluginName] = function(options, parent) {
    return this.each(function() {
      if (!$.data(this, "plugin_" + pluginName)) {
        $.data(this, "plugin_" + pluginName, new Plugin(this, options, parent));
      }
    });
  };
})(jQuery, window, document);

// Module: Dependencie graph
(function($, window, document, undefined) {
//  var pluginName = "prtg-datetimepicker";
//  function Plugin(element, data, parent) {}

  $.widget("prtg.datedialog", $.ui.dialog, {
    options: {
      url: '',
      closeOnEscape: true,
      draggable: false,
      resizable: false,
      modal: true,
      minWidth: 550,
      minHeight: 100,
      maxHeight: parseInt($(window).height() * 0.95, 10),
      maxWidth: (window.winGUI && 600) || 800,
      width: _Prtg.Util.calcLimit($(window).width(), 550, (window.winGUI && 600) || 800, 0.75),
      zIndex: 89,
      position: 'center'
    },

    getSelectedStartDate: function() {
      return this.element.find('.datetimepicker.dt_start').datetimepicker('getDate');
    },
    getSelectedEndDate: function() {
      return this.element.find('.datetimepicker.dt_end').datetimepicker('getDate');
    },

    _create: function() {
      if(this.options['url'] !== '') {
        this._ajaxLoadContent(this.options['url']);
      }
      _Prtg.Events.publish('create.dialog.prtg', this.element);
      this._super();
    },

    _ajaxLoadContent: function(url) {
      var self = this;
      this.options.title = _Prtg.Lang.Dialogs.strings["loading"] + '...';
      this.element.html("<div class='loading' style='height:100px;'><div class='loadspinner'></div></div>");
      $.ajax({
        url: url,
        dataType: 'html',
        type: "GET"
      }).done(function(response) {
        self._ajaxdone.call(self, response);
      });
    },

    _ajaxdone: function(response) {
      var self = this;
      self.element.html(response);
      setTimeout($.proxy(self._setOptions, self, {'position': 'center'}), 1);

      self._setOptions({'title': _Prtg.Lang.Dialogs.strings["selectdaterange"] });

      self._setOptions({'buttons': [{
        html: _Prtg.Lang.Dialogs.strings.ok,
        'class': 'actionbutton',
        click: function(ev, data) {
          self.close();
          self.destroy();
          self.element.remove();
        }
      }, {
        html: _Prtg.Lang.Dialogs.strings.cancel,
        'class': 'button btngrey',
        click: function(ev) {
          self.destroy();
          self.element.remove();
        }
      }]});

      _Prtg.initPlugins(self.element);
      self.element.find('.datetimepicker').datetimepicker({
        showButtonPanel: false,
        maxDate: 0,
        onSelect: function(dateText, obj) {
          var input = $(this).attr('for');
          $('#' + input).val(dateText);
        },
      });
      self.element.on('keyup.daterangedialog', '.datetimepickerinput', function() {
        var datepicker = $(this).attr("id");
        self.element.find('.datetimepicker[for="'+datepicker+'"]').datetimepicker('setDate', $(this).val());
      });
    },
    close: function() {
      this._super();
      this._destroy();
      this.element.remove();
    },
    _destroy: function() {
      $('.tooltip, .popover').remove();
      this.element.off('.daterangedialog');
      this.element.find('.datetimepicker').datetimepicker('destroy');
      this._super();
    },

    _setOptions: function(options) {
      this._superApply( arguments );
    }
  });

})(jQuery, window, document);


// Module: Dependencie graph
/* _Prtg.DependencyGraph.js */
(function($, window, document, undefined) {
  var pluginName = 'dependenciesGraph';

  var dependenciesGraph = function(element, data, parent) {
    var self = this;
    this.element  = element;
    this.$element = $(element);
    this.objid = data.objid;
    this.tree = data.objects;
    this.zoom = 1;
    this.masters = false;
    if(!this.tree) return;
    this.size = {
      translate: [0,0],
      width:  this.$element.width(),
      height: this.$element.height(),
      minwidth:  this.$element.width(),
      minheight:this.$element.height()
    };
    this.node = {
      width:200,
      height:20
    };
    this.$svg = this.$element.find('svg#dependencygraph');
    this.svg = d3.select(this.$svg[0])
      .attr("width", this.size.width)
      .attr("height", this.size.height);

    this.svg.append('svg:rect')
      .attr('width', "100%")
      .attr('height',"100%")
      // .call(d3.behavior.zoom().on("zoom",function(){
      //   self.zoom = d3.event.scale;
      //   zoom(self.zoom);
      //   d3.event.sourceEvent.cancelBubble = true;
      // }))
      .attr('fill', "white")
      .on('click',function(){
        self.pathes.classed('bolded',false);
        self.pathes.selectAll('.bold').classed('bold',false);
      });
    this.svg = this.svg
      .append('svg:g')
      .attr('fill', "white")

    this.pathes = this.svg.append('svg:g');

    this.d3tree = d3.layout
      .cluster()
      .nodeSize([this.node.height,this.node.width+20]);
    this.diagonal= d3.svg
      .diagonal()
      .projection(function(d) { return [d.x, d.y]; });

    this.mode = this.elbowTree;
    this.updateTree();

   $('#dependencygraphlegend')
      .off()
      .on('click','.radio', function(e){
        self.masters = $('#showmaster').is(':checked');
        self.refresh();
      });

    $('#Zoom_Sunburst')
      .off()
      .on('click','.olControlZoomOut',function(e){
        self.zoom -= self.zoom/10;
        zoom(self.zoom);
      })
      .on('click','.olControlZoomIn',function(e){
        self.zoom += self.zoom/10;
        zoom(self.zoom);
      });

    function zoom(zoom){
      var width = Math.ceil(self.size.width * zoom)
        , height = Math.ceil(self.size.height * zoom);
      width > self.size.minwidth
        && self.$element.css('width', width)
         , self.$svg.attr('width', width);
      height > self.size.minheight
        && self.$element.css('height',height)
         , self.$svg.attr('height',height);
      self.svg.attr("transform", "translate("+(self.size.translate[0]*zoom)+","+(self.size.translate[1]*zoom)+") scale(" + zoom + ")");
    }
  };

  dependenciesGraph.prototype = {
    refresh: function(){
        var self = this;
        if( $('#content').find('.loadspinner').length == 0){
            $('#content').append('<div class="loadspinner"></div>')
        }
        self.$svg.addClass('loading');
        $.ajax({
          type: 'GET',
          dataType: 'json',
          url: '/api/gettreeasjson.htm',
          data: {
            id:         0,
            probes:     1,
            groups:     1,
            devices:    1,
            allowone:   1,
            allowself:  1,
            showsensor: 1,
            dependency: 1,
            altformat:  1
          }
        }).fail(function(){
          $('#content').removeClass('loading');
          self.$svg.removeClass('loading');
        }).done(function(data){
          self.tree = data;
          self.updateTree();
        });
      },
    updateTree: function(){
      var self = this;
      self.tree.fixed = true;
      self.tree.type += " root";
      self.tree = self.initTree(self.tree, null);
      self.mode.init(self, self.tree);
      $('#dependencies-overview').removeClass('loading');
      self.$svg.removeClass('loading');
    },
    toggle: function(d,noupd){
      var mem;
      d.fixed = true;
      if(!!d._children){
        if (!d.fold) {
          mem = d.__children||[];
          d.__children = d.children;
          d.children = mem;
          d.fold = 1;
        } else {
          d.fold = 0;
          mem = d.children;
          d.children = d.__children;
          d.__children = mem;
        }
        self.mode.init(self, d);
      } else return false;
      return true;
    },

    initTree: function(tree) {
      self = this;
      function firstrun(parent,node){
        //set parent, dependency and hide sensors
        node.parent = parent;
        node.dependency = !!node.dependency ? 0 ^ node.dependency : node.dependency;
        switch(node.dependencytype){
          case 'Parent':
            node.dependency = parent;
            break;
          case 'Master':
          case 'Select':
            node.dependency = self.getObj(tree, node.dependency);
            break;
          default:
            node.dependency = null;
            break;
        }

        if(!!node.children)
          node.children.forEach(function(child){firstrun(node,child)});

        node._children = (node.children || []);
        node.children = [];

      };

      function secondrun(node, expand, master){
        function testpush(a,e){if(!!a && a.indexOf(e)<0)return a.push(e); else return false;};
        function ensure(n,u){
          var p = !!n ? n.parent : null
            , wayup = u || "dependency";
          if(!p) return;
          if(node.broken
          && n.dependencytype === "Select"
          && n.type !== "sensor")
            ensure(n.parent,"parent");

          while(!!p){
            if(!testpush(p.children,n)){
              p=null;
            }else{
              n = n[wayup] || n.parent;
              p = n.parent;
            }
          }
        };

        node.childcount = 0;
        if(!!node._children
        && !!node._children.length){
          node.childcount = node._children.length;
          if(node.type !== "device"
          && node.type !== "sensor")
            node._children.forEach(function(e){secondrun(e, (expand || e.objid === self.objid), master);});
        }

        if(!expand) return;

        if(node.objid < 10
        || node.objid === self.objid){
          node.parent && ensure(node.parent);
          node.children = node._children;
          node.objid === self.objid && ensure(node);
        }

        if(!node.dependency // repair broken dependency
        && !!node.parent){
          var idx = node._children.length;
          if(!!node._children)
            idx = node._children.push(
              {
                objid: 'x'+node.objid,
                dependency: node,
                dependencytype: 'Select',
                type: 'sensor',
                name: _Prtg.Lang.common.strings.unknownsensor,
                parent: node,
                broken: true,
                icon: '/images/transparent.gif'
              }
            );
          
          node.broken = true;
          ensure(node._children[idx-1],'parent');
          node.dependency = node.parent;
          node.dependencytype = 'Parent';
          ensure(node.parent);
        }

        if(node.dependencytype === "Select"){
          if (node.dependency.parent.objid != node.objid){
            if(!node.dependency.dependencies)
              node.dependency.dependencies=[];
            node.dependency.dependencies.push(node.objid);
            ensure(node,"parent");
            ensure(node.dependency,"parent");
          }
          if((!!master && node.dependency.dependencytype === "Master")
          || node.dependency.dependencytype !== "Master"){
            if(!node.dependency.dependencies)
              node.dependency.dependencies=[];
            node.dependency.dependencies.push(node.objid);
            ensure(node,"parent");
            ensure(node.dependency,"parent");
          }
        }

        if(node.type === "device"
        && !!node._children
        && !!node._children.length){
          node._children.forEach(function(sensor){
            if((!!master
            && sensor.dependencytype === "Master")
            || sensor.dependencytype === "Select"){
              if(!sensor.dependency){ // repair broken dependency
                if(!node.brokensensor)
                  node.brokensensor = node._children.push(
                    {
                      objid: 'x'+node.objid,
                      dependency: node,
                      dependencytype: 'Parent',
                      type: 'sensor',
                      name:_Prtg.Lang.common.strings.unknownsensor,
                      parent: node,
                      broken: true,
                      icon: '/images/transparent.gif'
                    }
                  )-1;
                sensor.sensorbroken = true;
                sensor.dependency = node._children[node.brokensensor];
              }else{
                ensure(sensor.dependency,"parent");
                ensure(sensor.dependency.parent);
              }
              ensure(sensor);
              ensure(node);
              if(!sensor.dependency.dependencies)
                sensor.dependency.dependencies=[];
              sensor.dependency.dependencies.push(sensor.objid);
              if(sensor.dependencytype === "Master")
                sensor.dependency = sensor.parent;
            }else if(sensor.dependencytype === "Master"){
              sensor.dependency = sensor.parent;
              // sensor.dependencytype = node.parent.fold ? "Master" : "Parent";
            }
          });
        }
      };

      firstrun(null,tree);
      secondrun(tree,(tree.objid===self.objid), self.masters);
      return tree;
    },

    createLinksJson: function(nodes) {
      var links = [];
      var i = -1;
      var l = nodes.length;
      while(++i < l) {
        var node = nodes[i];
        if(!!node.dependency && nodes.indexOf(node.dependency)>-1){
          links.push({
            "type": node.dependencytype,
            "source": node,
            "target": node.dependency
          });
        }
        if(node.dependencytype !== "Parent"){
          links.push({
            "type": "Parent",
            "source": node,
            "target":  node.parent
          });
        }
      }
      return links;
    },
    getObj: function(data, objId) {
      var ret = null;
      function recurse(node){
        if(node.objid === objId)
          ret = node;
        else{
         if(!!node._children && !!node._children.length)
          node._children.some(function(node){
              if(!ret)
                ret = recurse(node);
              if(ret)
                return true;
          });
        if(!ret && !!node.children && !!node.children.length)
          node.children.some(function(node){
              if(!ret)
                ret = recurse(node);
              if(ret)
                return true;
          });
        }
        return ret;
      };
      recurse(data);
      return ret;
    },
    elbowTree:{
      init: function(self, node){
        var max={x:0,y:0}
          , min={x:0,y:0}
          , nodes = self.d3tree.nodes(self.tree);
        links = self.createLinksJson(nodes);
        nodes.forEach(function(d) {
          if(d.type !== 'sensor')
            d.y = d.depth *self.node.width;
        });
        nodes.forEach(function(d){
          max.x = d.x > max.x ? d.x : max.x;
          max.y = d.y > max.y ? d.y : max.y;
          min.x = d.x < min.x ? d.x : min.x;
          min.y = d.y < min.y ? d.y : min.y;
        });

        var width = Math.abs(max.y) + Math.abs(min.y) + self.node.width*3
          , height= Math.abs(max.x) + Math.abs(min.x) + self.node.height*2;
        self.size.translate = [Math.abs(self.node.width),Math.abs(min.x)+self.node.height];
        self.svg.attr('transform','translate('+self.size.translate+')');

        self.$element.css('width', width)
          ,self.$svg.attr('width', width)
          ,self.size.width = width;
        self.$element.css('height',height)
          ,self.$svg.attr('height',height)
          ,self.size.height = height;
        this.update(self, nodes, links, node);
      },
      update: function(self,nodes, links, node){
        var duration = 50
          , hoverTimer = 0
          , node = self.pathes.selectAll(".node")
                  .data(nodes, function(d){return d.objid;})
          , nodeEnter = node.enter().append("g")
              .attr('id', function(d){return 'g'+d.objid;})
              .attr("class", function(d) {return "node " + d.type + (!!d.broken?' Broken':'') + (!!d.sensorbroken?' SensorBroken':'') + " fold" + (d.fold || 0 )})
              .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; })
        ;

        nodeEnter.filter(function(d){return !!d._children && d.type!=='sensor'?null:this;})
          .append('svg:clipPath')
          .attr('id',function(d){return 'clip-'+d.objid;})
          .insert("svg:rect")
          .attr("transform","translate(0,-7)")
          .attr("width",self.node.width-15)
          .attr("height",self.node.height-6);

        nodeEnter.filter(function(d){return !!d._children && d.type!=='sensor'?null:this;})
          .append("svg:rect")
          .attr("transform","translate(0,-7)")
          .attr("width",self.node.width+4)
          .attr("height",self.node.height-6);

        nodeEnter
          .append("svg:image")
          .attr("class","icon")
          .attr("xlink:href", function(d){return d.icon})
          .attr("width", 14)
          .attr("height",14)
          .attr("transform","translate(0,-7)")

        nodeEnter.filter(function(d){return !!d._children && d.type!=='sensor'?this:null;})
          .append("svg:image")
          .attr("class", function(d){return "fold folded" +  (d.fold||0);})
          .attr("xlink:href", function(d){return !d.fold
                                            ?"/css/images/tv-collapse-gray"+(d.fold  === 2?'-2':'')+".png"
                                            :"/css/images/tv-foldout-gray"+(!!d.___children?'-2':'')+".png"})
          .attr("width", 9)
          .attr("height",9)
          .attr("transform","translate(-12,-4.5)")
          .on('click', self.toggle);


        nodeEnter
          .append("svg:a")
          .attr("xlink:href", function(d){ return d.broken && d.type === 'sensor' ?  null : (d.type === 'device'||d.type==='sensor'?'/'+d.type+'.htm?id=':'/dependencies.htm?id=') + d.objid})
          .insert("text")
          .attr('clip-path',function(d){return d.type==='sensor'?'url(#clip-'+d.objid+')':null;})
          .attr('id',function(d){return 'obj-'+d.objid;})
          .attr('data-id',function(d){return d.objid;})
          .attr("class", function(d) {return d.broken && d.type === 'sensor' ? 'readonly' : 'readonly ' +(d.type==='probe'?'probenode':d.type) +'menu'})
          .attr("text-anchor",function(d){return d.depth==0 ? "end":'start';})
          .attr("transform", function(d){return d.depth===0 ? "translate(-16,4)" : "translate(16,4)"})
          .text(function(d) {return d.name.centerellipsis((d.childcount>=0?15:25)) + (d.childcount>=0?' ('+d.children.length+'/'+d.childcount+')':''); });

        nodeEnter
          .append("title")
          .text(function(d){
            return d.childcount>=0
              ?(d.childrencount=d.children.length,_Prtg.Lang.common.strings.dependenciestitle.printf(d))
              :d.name;});

        nodeEnter.filter(function(d){return (!!d._children||!!d.dependencies) && d.type==='sensor'?this:null;})
          .append("svg:use")
          .attr("xlink:href","#zoomicon")
          .attr("class","zoomicon")
          .attr("width", 14)
          .attr("height",14)
          .attr("transform","translate("+(self.node.width+5)+",-7)")
          .on('click',function(e){
            var target = d3.event.target
              , d = e
              , that = d3.select('#g'+d.objid)
              , bolded = d.bolded||false
              , dep ='g'+d.dependency.objid
              , id = 'g'+d.objid;
            self.pathes.classed('bolded',false);
            self.pathes.selectAll('.bold').classed('bold',false);
            if(bolded){
              d.bolded = false;
              return;
            }
            d.bolded = true;
            // if(target.classList.contains('fold')) return;
            // self.pathes.classed('bolded',true);
            that.classed('bold',true);
            if(!!dep)
             [dep,dep+id,id+dep].forEach(function(elm){
              d3.selectAll('#'+elm).classed('bold',true);
             });
            if(!!d.dependencies)
              d.dependencies.forEach(function(dep){
                ['g'+dep,'g'+dep+id].forEach(function(elm){
                  d3.selectAll('#'+elm).classed('bold',true);
                });
              });
          })
          .append("title")
          .text(_Prtg.Lang.common.strings.highlight);



        var nodeUpdate = node.transition()
          .duration(duration)
          .attr("class", function(d) {return "node " + d.type + ' menu'+d.type+ (!!d.broken ? ' Broken':'')  + (!!d.sensorbroken?' SensorBroken':'') + " fold" + (d.fold || 0 )})
          .attr("transform", function(d) {return "translate(" + d.y + "," + d.x +")"; })
          .attr('up', function(d){return d.dependencytype;})
          .attr('down', function(d){return !!d.dependency ? d.dependency.dependencytype:null;})
        nodeUpdate.select("image.fold")
          .attr("class", function(d){return "fold folded" +  (d.fold||0);})
          .attr("xlink:href", function(d){return !d.fold
                                            ?"/css/images/tv-collapse-gray"+(d.fold  === 2?'-2':'')+".png"
                                            :"/css/images/tv-foldout-gray"+(!!d.___children?'-2':'')+".png"})

        node
          .exit()
          .transition()
          .duration(duration)
          .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; })
          .remove();

        var link = self.pathes.selectAll(".link")
          .data(links,function(d) { return d.source.objid+'-'+d.target.objid; });
        link
          .enter()
          .insert("path","g")
          .attr("marker-start",function(d) { return d.type !== 'Select'?(d.target.dependencytype==='Master' && d.source.children.indexOf(d.target)>-1?'url(#Master)':null):"url(#" + d.type + ")"; })
          .attr("marker-end",function(d) { return d.type === 'Master'?"url(#" + d.type + ")":null; })
          // .attr("marker-end","url(#markerCircle)")
          .attr("class", function(d) {
            return "link " +  (d.type!=='Select'?d.type:(d.target.dependencytype==='Master' && d.source.children.indexOf(d.target)>-1?'Master':d.type)) + (!!d.target.broken ? ' Broken':'')  +(d.target.hidden||'');
          })
          .attr("d", elbow)
          .attr("id", function(d) { return 'g'+d.source.objid+'g'+d.target.objid; });

        link
          .transition()
          .duration(duration)
          .attr("d", elbow);
        link
          .exit()
          .transition()
          .duration(duration)
          .attr("d",elbow)
          .remove();

        function elbow(d, i) {

          var deltax = 20;
              srcwidth = d.source.type !== 'sensor'
                        ?d3.select("#obj-"+d.source.objid).node().getBBox().width
                        :self.node.width
              trgwidth = d.target.depth === 0
                        ?0
                        :d3.select("#obj-"+d.target.objid).node().getBBox().width+18;

          if(d.type==="Parent"
          || d.type==="Master"
          || (d.source.broken && d.target.type !== 'sensor')){
            return "M" + (d.source.y-10) + "," + d.source.x
                 + "H" + (d.target.y+
                      (d.target.x==d.source.x
                        ? trgwidth
                        // ? d.target.name.centerellipsis(15).length*6*(d.target.depth?1:0)
                        : -8
                      )
                    ) + "V" + d.target.x
                 + (d.target.children ? "" : "h" + 10);
          }else{
            var dx = Math.abs(d.source.x - d.target.x)||self.node.height
              , dy = Math.sqrt(dx)*4;
            return "M" + (d.target.y+self.node.width+deltax) + "," + (d.target.x)
                 + "q" + dy + "," + 0 +" "+ dy + "," + (d.source.x < d.target.x?-1:1)*dx/2
                 + "T" + (d.source.y+srcwidth+deltax) + "," + (d.source.x-0);
          }
        }
      }
    }
  };

  _Prtg.Plugins.registerPlugin(pluginName, dependenciesGraph);

})(jQuery, window, document);


(function($, window, document, undefined) {
  var pluginName = 'activity';
  var spacing = 0.7;
  var width = $(window).width();
  var height = $(window).height();
  var quader = 0;
  var font = '1.5em';
  var cfont = '2.5em';
  var radius = 0;
  var marginLeft = 0;
  var marginTop = 0;
  /* STANDARD FUNCTIONS */
  function Activity(element, data, parent) {
    this.element = element;
    this.$element = $(element);
    this.data = data;
    this.timer = null;
    this.countdown = null;
    this.delay = setDelay();
    this.proxRefreshClock = $.proxy(this.refreshClock, this);
    this.proxStartClock = $.proxy(this.startClock, this);
    this.resetClock();
    this.initClock(this);
  }
  Activity.prototype.fields = function fields(startTime) {
    var usertime = (_Prtg.Options.logoutAfterInactivity / 60);
    var time = [0, 0];
    if (!!startTime) {
      if (usertime < 60) {
        time[0] = startTime[0];
        time[1] = startTime[1];
      } else {
        time[0] = parseInt(startTime[0] * 60, 10) + parseInt(startTime[1], 10);
        time[1] = startTime[2];
      }
    }
    var seconds = ((time[1] / 60));
    return [{
      index: 2,
      value: seconds,
      positionX: 60,
      color: '#BDD73C'
    } ];
  };
  Activity.prototype.initClock = function initClock(self) { 
    $(document).on('mousedown keydown touchstart', {'self': self}, self.clickToStopEvent);
    $(window).on('resize', {'self': self}, self.clickToStopEvent);
    self.activity = '' + (Date.now());
    !!window.localStorage && window.localStorage.setItem('lastActivity', self.activity);
    self.presvg = d3.select('body').append('div')
      .attr('class', 'ui-widget-overlay ui-front')
      .attr('width', height)
      .attr('height', width)
      .style('visibility', 'hidden');
    var svg = self.presvg.append('svg')
      .attr('class', 'svg')
      .attr('height', quader)
      .attr('width', quader)
      .style('margin-left', marginLeft)
      .style('margin-top', marginTop)
      .append('g')
      .attr('id', 'gunit');
    svg.append('text')
      .attr('dy', '-3.0em')
      .attr('dx', '-3.3em')
      .attr('id', 'txt')
      .style('font-size', font)
      .style('fill', '#00245D')
      .text('You are inactive.');
    svg.append('text')
      .attr('dy', '-1.5em')
      .attr('dx', '-5.3em')
      .attr('id', 'txt')
      .style('font-size', font)
      .style('fill', '#00245D')
      .text('You will be logged out in');
    svg.append('text')
      .attr('dy', '4.0em')
      .attr('dx', '-5.3em')
      .attr('id', 'txt')
      .style('font-size', font)
      .style('fill', '#00245D')
      .text('Unless you click to stop it!');
    self.presvg.append('svg')
      .attr('class', 'settings')
      .attr('height', height)
      .attr('width', (width))
      .style('visibility', 'hidden')
      .on('click', function click() {
        document.location.href = '/systemsetup.htm?tabid=1';
      })
      .on('touchstart', function touchstart() {
        document.location.href = '/systemsetup.htm?tabid=1';
      })
      .append('text')
      .attr('id', 'txt_setting')
      .style('font-size', font)
      .attr('y', (height / 100) * 22)
      .style('fill', '#00245D')
      .text('You can change this behavior under Setup | System Administration | User Interface.');
    self.arc = d3.svg.arc()
      .startAngle(0)
      .endAngle(function(d) {
        return d.value * 2 * Math.PI;
      })
      .innerRadius(function(d) {
        return d.index * radius / 3;
      })
      .outerRadius(function(d) {
        return (d.index + spacing) * radius / 3;
      });
    self.field = svg.selectAll('g')
      .data(this.fields())
      .enter().append('g');
    self.field.append('path');
    self.field.append('text');
    self.field.append('text');
    resizeSVGQuader();
    windowFontClock();
  };
  Activity.prototype.tick = function tick(self, time) {
    var arcTween = function arcTween(d) {
      var i = d3.interpolateNumber(d.previousValue, d.value);
      return function(t) {
        d.value = i(t);
        return self.arc(d);
      };
    };
    if (_Prtg.Options.userIsReadOnly === false) {
      d3.select('.settings').style('visibility', 'initial');
    }
    this.field.style('display', 'block');
    this.presvg.style('visibility', 'initial');
    this.field = this.field
      .each(function(d) {
        this._value = d.value;
      })
      .data(this.fields(time))
      .each(function(d) {
        d.previousValue = this._value;
      });
    this.field.select('path')
      .transition()
      .ease('elastic')
      .attrTween('d', arcTween)
      .style('fill', function(d) {
        return d.color;
      });
    d3.transition();
  };
  Activity.prototype.resetClock = function resetClock() {
    this.activity =
    this.countdown = null;
    this.timer = setTimeout(this.proxStartClock, this.delay);
  };
  Activity.prototype.startClock = function startClock() {
    width = $(window).width();
    height = $(window).height();
    d3.select('.popover.right.in').style('visibility', 'hidden');
    this.timer = null;
    this.countdown = setTimeout(this.proxRefreshClock, 0);
  };
  Activity.prototype.refreshClock = function refreshClock() {
    var now = new Date();
    var s;
    var activity;
    if (this.timer === null) {
      try {
        activity = window.localStorage.getItem('lastActivity');
      } catch (e) {
        this.resetClock();
      }
      s = _Prtg.Options.logoutAfterInactivity - Math.floor((now.getTime() - activity) / 1000);
      if (s <= 0) {
        sessionStorage.setItem("sessionExpired", true);
        document.location.href = '/index.htm?logout=1';
      } else {
        now.setTime(s * 1000);
        var time = _Prtg.Util.secondsAsTime(s).split(':');
        this.field.select('text')
          .attr('dy', '0.8em')
          .attr('dx', '-2.15em')
          .style('font-size', cfont)
          .style('fill', '#00245D')
          .text(time[1] + ' seconds');
        this.tick(this, time);
        if (this.countdown && this.activity === activity) {
          this.countdown = setTimeout(this.proxRefreshClock, 1000);
        } else {
          this.resetClock();
          this.activity = activity;
        }
      }
    } else {
      this.resetClock();
    }
  };

  /* D3JS HELPER FUNCTIONS */
  function resizeSVGQuader() {
    width = $(window).width();
    height = $(window).height();
    var heightMarginTop = (height / 4) - 20;
    radius = width / 4;
    d3.select('.settings').attr('height', height)
      .attr('width', width);
    if (width < height) {
      quader = width / 2;
      radius = quader / 2;
      marginLeft = ((width / 2) - (quader / 2));
      marginTop = (((height) / 2) - (quader / 2));
      d3.select('.svg').attr('class', 'svg')
        .attr('height', quader + 'px')
        .attr('width', quader + 'px')
        .style('margin-left', marginLeft + 'px')
        .style('margin-top', marginTop + 'px');
      d3.select('#gunit').attr('transform', 'translate(' + quader / 2 + ',' + quader / 2 + ')');
      d3.select('#txt_setting').attr('y', (heightMarginTop));
    } else {
      quader = (height / 2);
      radius = (quader / 2);
      marginLeft = ((width / 2) - (quader / 2));
      marginTop = (((height) / 2) - (quader / 2));
      d3.select('#gunit').attr('transform', 'translate(' + (quader / 2) + ',' + (quader / 2) + ')');
      d3.select('.svg').attr('class', 'svg')
        .attr('height', quader + 'px')
        .attr('width', quader + 'px')
        .style('margin-left', marginLeft + 'px')
        .style('margin-top', marginTop + 'px');
      d3.select('#txt_setting').attr('y', ((heightMarginTop) - 10) + 'px');
    }
  }
  function windowFontClock() {
    var wiwi = $(window).width();
    var wihe = $(window).height();
    if (wiwi < wihe) {
      if (wiwi <= 750 && wiwi > 650) {
        font = (radius / 100) - 0.3;
      } else if (wiwi <= 650 && wiwi > 450) {
        font = (radius / 100) - 0.3;
      } else if (wiwi <= 450 && wiwi > 350) {
        font = (radius / 100) - 0.3;
      } else if (wiwi <= 350) {
        font = (radius / 100) - 0.3;
      } else {
        font = 1.5;
      }
    } else if (wihe <= 750 && wihe >= 600) {
      font = (radius / 100) - 0.3;
    } else if (wihe < 600 && wihe > 460) {
      font = (radius / 100) - 0.3;
    } else if (wihe <= 460) {
      font = (radius / 100) - 0.3;
    } else {
      font = 1.5;
    }
    d3.selectAll('#txt').style('font-size', font + 'em');
    d3.select('#txt_setting').style('font-size', (font * 1.2) + 'em');
    cfont = (font * 1.5) + 'em';
  }
  function setDelay() {
    var counter = 0;
    if ((_Prtg.Options.logoutAfterInactivity / 60) <= 1) {
      counter = 30000;
    } else {
      counter = 60000 * ((_Prtg.Options.logoutAfterInactivity / 60)) - 59000;
    }
    return counter;
  }

  Activity.prototype.clickToStopEvent = function clickToStopEvent(event) {
    var self = event.data.self;
    resizeSVGQuader();
    windowFontClock();
    d3.select('.popover.right.in').style('visibility', 'initial');
    clearTimeout(self.timer);
    setTimeout(function timer() {
      self.field.style('display', 'none');
      self.presvg.style('visibility', 'hidden');
      d3.select('.settings').style('visibility', 'hidden');
    }, 300);
    if (self.countdown) {
      clearTimeout(self.countdown);
      self.countdown = null;
    }
    self.activity = '' + (new Date()).getTime();
    !!window.localStorage && window.localStorage.setItem('lastActivity', self.activity);
    self.timer = setTimeout(self.proxStartClock, self.delay);
  };


  _Prtg.Plugins.registerPlugin(pluginName, Activity);
})(jQuery, window, document);


// Module: FactoResize
// prtg.factorResize.js
(function($, window, document, undefined) {
  var pluginName = "prtg-factorResize";

  function factorResize(element, data, parent) {
    this.data = data;
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.factor = this.data.factor;
    this.initEvents();
  }

  factorResize.prototype.initEvents = function() {
    var self = this;
    self.$el.on('destroyed.factorResize', {
      "self": self
    }, self.destroy);

    $(window).on('resize.factorResize', {'self': self}, self.checkAndResize).trigger('resize.factorResize');
  };

  factorResize.prototype.checkAndResize = function(event) {
    var self = event.data.self;
    self.$el.css("width", "100%");
    var currentwidth = parseInt(self.$el.width(), 10);
    if((currentwidth / self.factor) !== 0) {
      self.$el.width(currentwidth - (currentwidth % self.factor));
    }
  };

  factorResize.prototype.destroy = function(event) {
    var self = event.data.self;
    $(window).off('.factorResize');
    $(document).off('.factorResize');
  };

  _Prtg.Plugins.registerPlugin(pluginName, factorResize);

})(jQuery, window, document);


/* _Prtg.SimplDonut.js */
(function PrtgSimpleDonutPlugin($, window, document, undefined) {
  var pluginName = 'prtg-simpledonut';

  function PrtgSimpleDonut(element, data, parent) {
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.$parent = (!(parent instanceof jQuery)) ? $(parent) : parent;

    this.datasetcolor = [];
    this.dataset = [];
    this.basisColor = data.basisColor || '#808282';
    this.innerText = data.innertext || '';

    if (data.hasOwnProperty('remaining')) {
      this.remaining = data.remaining.split(':');
      if (data.hasOwnProperty('warninglimit')) {
        this.remaining[0] = this.getColor(data.warninglimit, this.remaining[1], this.remaining[0]);
      }

      if (data.hasOwnProperty('errorlimit')) {
        this.remaining[0] = this.getColor(data.errorlimit, this.remaining[1], this.remaining[0]);
      }
      this.total = this.remaining[1];

      this.datasetcolor.push(this.remaining[0]);
      this.dataset.push(this.remaining[1]);
      this.basis = data.total - this.remaining[1];
    } else if (data.hasOwnProperty('used')) {
      this.used = data.used.split(':');

      if(this.used[1] > data.total) {
        this.used[1] = data.total;
      }

      if (this.used[1] < 0) {
        this.used[1] = data.total - Math.abs(this.used[1]);
      }

      if (data.hasOwnProperty('warninglimit')) {
        this.used[0] = this.getColor(data.warninglimit, data.total - this.used[1], this.used[0]);
      }

      if (data.hasOwnProperty('errorlimit')) {
        this.used[0] = this.getColor(data.errorlimit, data.total - this.used[1], this.used[0]);
      }

      this.datasetcolor.push(this.used[0]);
      this.dataset = [data.total - this.used[1]];
      this.basis = data.total - (data.total - this.used[1]);
      this.total = data.total - this.used[1];
    } else {
      this.dataset = data.dataset.split(',');
      this.datasetcolor = [];

      var temp;
      for (var i = 0; i <= this.dataset.length - 1; i++) {
        temp = this.dataset[i].split(':');
        this.datasetcolor.push(temp[0]);
        this.dataset[i] = temp[1];
      }

      this.total = this.dataset.reduce(function(a, b) { return parseInt(a, 10) + parseInt(b, 10); });

      this.basis = data.basis || 0;
      if (this.total === 0) {
        this.dataset = [1];
        this.datasetcolor = ['#b4cc38'];
      }
    }

    if (this.basis !== 0) {
      this.dataset.unshift(this.basis);
      this.datasetcolor.unshift(this.basisColor);
    }

    this.width = data.width || this.$el.width();
    this.height = data.height || this.$el.height();
    this.radius = Math.min(this.width, this.height) / 2;
    this.innerRadiusRatio = parseInt(data.innerratio, 10) || 30;
    this.innerRadius = this.radius - ((this.radius / 100) * this.innerRadiusRatio);


    this.init();
  }

  PrtgSimpleDonut.prototype.init = function init() {
    var _this = this;

    d3.scale.category20();
    var pie = d3.layout.pie().sort(null);
    var dy = (_this.innerText === '' ? '+12px' : '-2px');
    var arc = d3.svg.arc()
      .innerRadius(_this.innerRadius)
      .outerRadius(_this.radius);
    var svg = d3.select(this.el).append('svg')
      .attr('width', _this.width)
      .attr('height', _this.height)
      .append('g')
      .attr('transform', 'translate(' + _this.width / 2 + ',' + _this.height / 2 + ')');

    svg.selectAll('path')
      .data(pie(_this.dataset))
      .enter()
      .append('path')
      .attr('fill', function(d, i) { return _this.datasetcolor[i]; })
      .attr('d', arc);

    svg.append('text')
      .attr('dy', dy)
      .attr('class', 'donutext')
      .text(function() { return _this.total; });

    if (_this.innerText !== ''){
      var padding=(this.width-100)/2;
      this.$el
      	.append($('<div class="donutlabel">'+_this.innerText+'</div>')
      	.css({
      			'padding-left': padding,
      			'padding-right':padding,
      			'height': this.height/2,
      			'margin-top':this.height/2
      		}));
    }
  };

  PrtgSimpleDonut.prototype.getColor = function getColor(limitData, value, defaultColor) {
    var limit = limitData.split(':');
    var color = defaultColor;
    if (parseInt(value, 10) <= parseInt(limit[1], 10)) {
      color = limit[0];
    }
    return color;
  };

  _Prtg.Plugins.registerPlugin(pluginName, PrtgSimpleDonut);
})(jQuery, window, document);

/* _Prtg.sparklineextend.js */
(function SparklineExtendPlugin($, window, document, undefined) {
  var pluginName = 'prtg-sparklineextend';

  function SparklineExtend(element, data, parent) {
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.$parent = (!(parent instanceof jQuery)) ? $(parent) : parent;

    this.values = data.values;
    this.dates = data.dates;
    this.init();
  }

  SparklineExtend.prototype.init = function init() {
    var _this = this;
    this.$el.sparkline(_this.values, {
      type: 'line',
      lineColor: '#aaaaaa',
      fillColor: '#dddddd',
      defaultPixelsPerValue: 1,
      chartRangeMin: 0,
      spotRadius: 0,
      tooltipFormat: '<span>{{offset:offset}} ({{y}})</span>',
      tooltipValueLookups: {
        offset: _this.dates
      }
    });
    $(this.$el).find('canvas').width('100%')
  };

  _Prtg.Plugins.registerPlugin(pluginName, SparklineExtend);
})(jQuery, window, document);


// _Prtg.debug.js
(function($) {
  _Prtg.debug = {
    // Print all forms and controls
    formContents: function() {
      var forms = document.querySelectorAll("form");

      for (var i = 0, len = forms.length; i < len; i++) {
        var tab = [];

        console.group("HTMLForm \"" + forms[i].name + "\": " + forms[i].action);
        console.log("Element:", forms[i], "\nName:    " + forms[i].name + "\nMethod:  " + forms[i].method.toUpperCase() + "\nAction:  " + forms[i].action || "null");

        ["input", "textarea", "select"].forEach(function(control) {
          [].forEach.call(forms[i].querySelectorAll(control), function(node) {
            tab.push({
              "Element": node,
              "Type": node.type,
              "Name": node.name,
              "Value": node.value,
              "Pretty Value": (isNaN(node.value) || node.value === "" ? node.value : parseFloat(node.value))
            });
          });
        });

        console.table(tab);
        console.groupEnd();
      }
    },
    // Print all http headers
    showHeaders: function() {
      var request = new XMLHttpRequest();
      request.open('HEAD', window.location, false);
      request.send(null);

      var headers = request.getAllResponseHeaders();
      var tab = headers.split("\n").map(function(h) {
        return {
          "Key": h.split(": ")[0],
          "Value": h.split(": ")[1]
        };
      }).filter(function(h) {
        return h.Value !== undefined;
      });

      console.group("Request Headers");
      console.log(headers);
      console.table(tab);
      console.groupEnd("Request Headers");
    },
    // Prints all Global Variables
    logGloabls: function() {
      'use strict';

      function getIframe() {
        var el = document.createElement('iframe');
        el.style.display = 'none';
        document.body.appendChild(el);
        var win = el.contentWindow;
        document.body.removeChild(el);
        return win;
      }

      function detectGlobals() {
        var iframe = getIframe();
        var ret = Object.create(null);

        for (var prop in window) {
          if (!(prop in iframe)) {
            ret[prop] = window[prop];
          }
        }

        return ret;
      }

      console.log(detectGlobals());
    },
    performance: function() {
      var t = window.performance.timing;
      var lt = window.chrome && window.chrome.loadTimes && window.chrome.loadTimes();
      var timings = [];

      timings.push({
        label: "Time Until Page Loaded",
        time: t.loadEventEnd - t.navigationStart + "ms"
      });
      timings.push({
        label: "Time Until DOMContentLoaded",
        time: t.domContentLoadedEventEnd - t.navigationStart + "ms"
      });
      timings.push({
        label: "Total Response Time",
        time: t.responseEnd - t.requestStart + "ms"
      });
      timings.push({
        label: "Connection",
        time: t.connectEnd - t.connectStart + "ms"
      });
      timings.push({
        label: "Response",
        time: t.responseEnd - t.responseStart + "ms"
      });
      timings.push({
        label: "Domain Lookup",
        time: t.domainLookupEnd - t.domainLookupStart + "ms"
      });
      timings.push({
        label: "Load Event",
        time: t.loadEventEnd - t.loadEventStart + "ms"
      });
      timings.push({
        label: "Unload Event",
        time: t.unloadEventEnd - t.unloadEventStart + "ms"
      });
      timings.push({
        label: "DOMContentLoaded Event",
        time: t.domContentLoadedEventEnd - t.domContentLoadedEventStart + "ms"
      });
      if (lt) {
        if (lt.wasNpnNegotiated) {
          timings.push({
            label: "NPN negotiation protocol",
            time: lt.npnNegotiatedProtocol
          });
        }
        timings.push({
          label: "Connection Info",
          time: lt.connectionInfo
        });
        timings.push({
          label: "First paint after Document load",
          time: Math.ceil(lt.firstPaintTime - lt.finishDocumentLoadTime) + "ms"
        });
      }

      var navigation = window.performance.navigation;
      var navigationTypes = {};
      navigationTypes[navigation.TYPE_NAVIGATENEXT || 0] = "Navigation started by clicking on a link, or entering the URL in the user agent's address bar, or form submission.", navigationTypes[navigation.TYPE_RELOAD] = "Navigation through the reload operation or the location.reload() method.", navigationTypes[navigation.TYPE_BACK_FORWARD] = "Navigation through a history traversal operation.", navigationTypes[navigation.TYPE_UNDEFINED] = "Navigation type is undefined.",

      console.group("window.performance");

      console.log(window.performance);

      console.group("Navigation Information");
      console.log(navigationTypes[navigation.type]);
      console.log("Number of redirects that have taken place: ", navigation.redirectCount)
      console.groupEnd("Navigation Information");

      console.group("Timing");
      console.log(window.performance.timing);
      console.table(timings, ["label", "time"]);
      console.groupEnd("Timing");

      console.groupEnd("window.performance");
    }


  };
})(jQuery);

/* _Prtg.AdvertLinks.Plugin.js */
(function prtgAdvetLinksPlugin($, window, document, undefined) {
  var pluginName = 'prtgPluginAdvertLinks';
  function prtgPluginAdvertLinks(element, data, parent) {
    this.data = data;
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.subject = this.data.subject;
    this.initEvents();
  }

  prtgPluginAdvertLinks.prototype.initEvents = function() {
    var _this = this;
    _this.$el.on('destroyed', _this, _this.destroy);
    this.$el.on('click.adverLinkClickEvent', _this, _this.adverLinkClickEvent);
  };

  prtgPluginAdvertLinks.prototype.adverLinkClickEvent = function adverLinkClickEvent(event) {
    var _this = (event !== undefined && event.data !== undefined ? event.data : this);
    if(event.target.classList.contains('closebutton')) return;
    _Prtg.objectTools.sendFeedback('/sendsalesfeedback.htm', { subject: _this.subject });
  };

  prtgPluginAdvertLinks.prototype.destroy = function destroyEvent(event) {
    var _this = event.data;
    $(window).off('.prtgPluginAdvertLinks');
    $(document).off('.prtgPluginAdvertLinks');
    _this.$el.off('.prtgPluginAdvertLinks');
  };

  _Prtg.Plugins.registerPlugin(pluginName, prtgPluginAdvertLinks);
})(jQuery, window, document);
;
/* _Prtg.toggleAutoRefresh.js */
(function prtgToggleAutoRefreshPlugin($, window, document, undefined) {
  var pluginName = 'prtg-toggle-autorefresh';

  function prtgToggleAutoRefresh(element, data, parent) {
    this.data = data;
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    if(_Prtg.Options.refreshType !== 'none')
      this.init();
  }

  prtgToggleAutoRefresh.prototype.init = function init() {
    this.$el.find('i').removeClass('icon-play').addClass('icon-pause');
    this.initEvents();
  };

  prtgToggleAutoRefresh.prototype.initEvents = function initEvents() {
    var _this = this;
    _this.$el.on('click.toggleAutoRefresh', _this, _this.toggleAutoRefresh);
    _this.$el.parents('body').on('keyup.toggleAutoRefresh', _this, $.proxy(_this.keyUpHandler, _this));
    _this.$el.on('destroyed', _this, $.proxy(_this.destroy, _this));
    _Prtg.Events.subscribe('start.events.prtg', $.proxy(_this.reset, _this));
  };

  prtgToggleAutoRefresh.prototype.keyUpHandler = function keyUpHandler(event) {
    var _this = (event !== undefined && event.data !== undefined ? event.data : this);
    if (event.altKey && event.ctrlKey && event.which === 80) {
      _this.toggleAutoRefresh(event);
    }
  };

  prtgToggleAutoRefresh.prototype.reset = function reset(event) {
    var _this = (event !== undefined && event.data !== undefined ? event.data : this);
    _this.$el.find('i').removeClass('icon-play').addClass('icon-pause');
  };

  prtgToggleAutoRefresh.prototype.toggleAutoRefresh = function toggleAutoRefresh(event) {
    var _this = (event !== undefined && event.data !== undefined ? event.data : this);
    _Prtg.Events.running ? _Prtg.Events.pause() : _Prtg.Events.resume();
    _this.$el.find('i').toggleClass('icon-pause', _Prtg.Events.running).toggleClass('icon-play', !_Prtg.Events.running);
    return false;
  };

  prtgToggleAutoRefresh.prototype.destroy = function destroyEvent(event) {
    var _this = this;

    _this.$el.off('.toggleAutoRefresh');
    _this.$el.parents('body').off('.toggleAutoRefresh');

    _Prtg.Events.unsubscribe('start.events.prtg', $.proxy(_this.reset, _this));
  };

  _Prtg.Plugins.registerPlugin(pluginName, prtgToggleAutoRefresh);
})(jQuery, window, document);
;
/* _Prtg.CssHelper.Plugin.js */
(function prtgCssHelperPlugin($, window, document, undefined) {
  var pluginName = 'prtgPluginCssHelper';
  function prtgPluginCssHelper(element, data, parent) {
    this.data = data;
    this.el = (!(element instanceof jQuery)) ? element : element[0];
    this.$el = (!(element instanceof jQuery)) ? $(element) : element;
    this.subject = this.data.subject;
    this.initEvents();
  }

  prtgPluginCssHelper.prototype.initEvents = function(triggered) {
    var _this = this;
    _this.$el.on('destroyed', _this, _this.destroy);
    _this.width=_this.$el.css('width').replace(/[^0-9]/g,'')*1;
    var breakpoint=0;
    $(this.$el.attr('class').split(' ')).each(function(){
      if(!!~this.indexOf('square-breakpoint-')) breakpoint=this.replace(/[^0-9]/g,'')*1;
    });

   
    _this.$el.find('.same-square-height').css('width','').css('height','');
    
    if(_this.width>=breakpoint){
      sameSquareHeight(_this.$el.find('.same-square-height'),_this.$el.hasClass('square-fit-parent'));
    }else{
      sameHeight(_this.$el.find('.same-square-height'));
    }
    
    setTimeout(function(){
      // _this.$el.find('.same-square-height,.square-height,.same-square-width,.square-width').removeClass('cssHelper-moving').css('visibility','visible');
    },300);
    
    if(!triggered){
      $(window).resize(function(){
        // _this.$el.find('.same-square-height,.square-height,.same-square-width,.square-width').addClass('cssHelper-moving');
        clearTimeout(_this.resizeTimeout);
        _this.resizeTimeout= setTimeout(function(){
            _this.initEvents(1);
        },500);
      });
    }
  };
  
  var sameSquareHeight=function(squareHeightElems,fitParent){
    var _this=this;
    var maxHeight=0,maxPadding=0,maxMargin=0;
    squareHeightElems.each(function(){
        var curHeight=$(this).css('height').replace(/[^0-9]/g,'');
        maxHeight=curHeight>maxHeight?curHeight:maxHeight;
        if(fitParent){
          var curPadding=$(this).css('padding').replace(/[^0-9]/g,'');
          maxPadding=curPadding>maxPadding?curPadding:maxPadding;
       
          var curMargin=$(this).css('margin').replace(/[^0-9]/g,'');
          maxMargin=curMargin>maxMargin?curMargin:maxMargin;
        }
    });
    if(maxHeight) squareHeightElems.css('width',maxHeight).css('height',maxHeight);
    if(fitParent){
      var inArow=Math.floor(_this.width/maxHeight);
      _this.parent.css('width',maxHeight*inArow+(((maxPadding+maxMargin)*2)*inArow));
    }
  }
  
  var sameHeight=function(squareHeightElems){
    var _this=this;
    var maxHeight=0;
    squareHeightElems.each(function(){
        var curHeight=$(this).css('height').replace(/[^0-9]/g,'');
        maxHeight=curHeight>maxHeight?curHeight:maxHeight;
    });
    if(maxHeight) squareHeightElems.css('height',maxHeight);
  }

  prtgPluginCssHelper.prototype.destroy = function destroyEvent(event) {
    var _this = event.data;
    $(window).off('.prtgPluginCssHelper');
    $(document).off('.prtgPluginCssHelper');
    _this.$el.off('.prtgPluginCssHelper');
  };

  _Prtg.Plugins.registerPlugin(pluginName, prtgPluginCssHelper);
})(jQuery, window, document);
;


if (!/MSIE \d|Trident.*rv:/.test(navigator.userAgent)){
    /*! iFrame Resizer (iframeSizer.contentWindow.min.js) - v3.6.3 - 2018-10-28
 *  Desc: Include this file in any page being loaded into an iframe
 *        to force the iframe to resize to the content size.
 *  Requires: iframeResizer.min.js on host page.
 *  Copyright: (c) 2018 David J. Bradshaw - dave@bradshaw.net
 *  License: MIT
 *  @url: https://github.com/davidjbradshaw/iframe-resizer
 */

!function(a){"use strict";function b(){}function c(a,b,c,d){"addEventListener"in window?a.addEventListener(b,c,!!Ia&&(d||{})):"attachEvent"in window&&a.attachEvent("on"+b,c)}function d(a,b,c){"removeEventListener"in window?a.removeEventListener(b,c,!1):"detachEvent"in window&&a.detachEvent("on"+b,c)}function e(a){return a.charAt(0).toUpperCase()+a.slice(1)}function f(a){var b,c,d,e=null,f=0,g=function(){f=La(),e=null,d=a.apply(b,c),e||(b=c=null)};return function(){var h=La();f||(f=h);var i=ya-(h-f);return b=this,c=arguments,i<=0||i>ya?(e&&(clearTimeout(e),e=null),f=h,d=a.apply(b,c),e||(b=c=null)):e||(e=setTimeout(g,i)),d}}function g(a){return na+"["+pa+"] "+a}function h(a){ma&&"object"==typeof window.console&&console.log(g(a))}function i(a){"object"==typeof window.console&&console.warn(g(a))}function j(){k(),h("Initialising iFrame ("+location.href+")"),l(),o(),n("background",X),n("padding",_),B(),t(),u(),p(),D(),v(),ja=C(),O("init","Init message from host page"),Ea()}function k(){function b(a){return"true"===a}var c=ia.substr(oa).split(":");pa=c[0],Y=a!==c[1]?Number(c[1]):Y,aa=a!==c[2]?b(c[2]):aa,ma=a!==c[3]?b(c[3]):ma,ka=a!==c[4]?Number(c[4]):ka,V=a!==c[6]?b(c[6]):V,Z=c[7],ga=a!==c[8]?c[8]:ga,X=c[9],_=c[10],va=a!==c[11]?Number(c[11]):va,ja.enable=a!==c[12]&&b(c[12]),ra=a!==c[13]?c[13]:ra,Ba=a!==c[14]?c[14]:Ba}function l(){function a(){var a=window.iFrameResizer;h("Reading data from page: "+JSON.stringify(a)),Da="messageCallback"in a?a.messageCallback:Da,Ea="readyCallback"in a?a.readyCallback:Ea,ua="targetOrigin"in a?a.targetOrigin:ua,ga="heightCalculationMethod"in a?a.heightCalculationMethod:ga,Ba="widthCalculationMethod"in a?a.widthCalculationMethod:Ba}function b(a,b){return"function"==typeof a&&(h("Setup custom "+b+"CalcMethod"),Ga[b]=a,a="custom"),a}"iFrameResizer"in window&&Object===window.iFrameResizer.constructor&&(a(),ga=b(ga,"height"),Ba=b(Ba,"width")),h("TargetOrigin for parent set to: "+ua)}function m(a,b){return-1!==b.indexOf("-")&&(i("Negative CSS value ignored for "+a),b=""),b}function n(b,c){a!==c&&""!==c&&"null"!==c&&(document.body.style[b]=c,h("Body "+b+' set to "'+c+'"'))}function o(){a===Z&&(Z=Y+"px"),n("margin",m("margin",Z))}function p(){document.documentElement.style.height="",document.body.style.height="",h('HTML & body height set to "auto"')}function q(a){var b={add:function(b){function d(){O(a.eventName,a.eventType)}Ha[b]=d,c(window,b,d,{passive:!0})},remove:function(a){var b=Ha[a];delete Ha[a],d(window,a,b)}};a.eventNames&&Array.prototype.map?(a.eventName=a.eventNames[0],a.eventNames.map(b[a.method])):b[a.method](a.eventName),h(e(a.method)+" event listener: "+a.eventType)}function r(a){q({method:a,eventType:"Animation Start",eventNames:["animationstart","webkitAnimationStart"]}),q({method:a,eventType:"Animation Iteration",eventNames:["animationiteration","webkitAnimationIteration"]}),q({method:a,eventType:"Animation End",eventNames:["animationend","webkitAnimationEnd"]}),q({method:a,eventType:"Input",eventName:"input"}),q({method:a,eventType:"Mouse Up",eventName:"mouseup"}),q({method:a,eventType:"Mouse Down",eventName:"mousedown"}),q({method:a,eventType:"Orientation Change",eventName:"orientationchange"}),q({method:a,eventType:"Print",eventName:["afterprint","beforeprint"]}),q({method:a,eventType:"Ready State Change",eventName:"readystatechange"}),q({method:a,eventType:"Touch Start",eventName:"touchstart"}),q({method:a,eventType:"Touch End",eventName:"touchend"}),q({method:a,eventType:"Touch Cancel",eventName:"touchcancel"}),q({method:a,eventType:"Transition Start",eventNames:["transitionstart","webkitTransitionStart","MSTransitionStart","oTransitionStart","otransitionstart"]}),q({method:a,eventType:"Transition Iteration",eventNames:["transitioniteration","webkitTransitionIteration","MSTransitionIteration","oTransitionIteration","otransitioniteration"]}),q({method:a,eventType:"Transition End",eventNames:["transitionend","webkitTransitionEnd","MSTransitionEnd","oTransitionEnd","otransitionend"]}),"child"===ra&&q({method:a,eventType:"IFrame Resized",eventName:"resize"})}function s(a,b,c,d){return b!==a&&(a in c||(i(a+" is not a valid option for "+d+"CalculationMethod."),a=b),h(d+' calculation method set to "'+a+'"')),a}function t(){ga=s(ga,fa,Ma,"height")}function u(){Ba=s(Ba,Aa,Na,"width")}function v(){!0===V?(r("add"),G()):h("Auto Resize disabled")}function w(){h("Disable outgoing messages"),sa=!1}function x(){h("Remove event listener: Message"),d(window,"message",T)}function y(){null!==$&&$.disconnect()}function z(){r("remove"),y(),clearInterval(la)}function A(){w(),x(),!0===V&&z()}function B(){var a=document.createElement("div");a.style.clear="both",a.style.display="block",document.body.appendChild(a)}function C(){function b(){return{x:window.pageXOffset!==a?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==a?window.pageYOffset:document.documentElement.scrollTop}}function d(a){var c=a.getBoundingClientRect(),d=b();return{x:parseInt(c.left,10)+parseInt(d.x,10),y:parseInt(c.top,10)+parseInt(d.y,10)}}function e(b){function c(a){var b=d(a);h("Moving to in page link (#"+e+") at x: "+b.x+" y: "+b.y),S(b.y,b.x,"scrollToOffset")}var e=b.split("#")[1]||b,f=decodeURIComponent(e),g=document.getElementById(f)||document.getElementsByName(f)[0];a!==g?c(g):(h("In page link (#"+e+") not found in iFrame, so sending to parent"),S(0,0,"inPageLink","#"+e))}function f(){""!==location.hash&&"#"!==location.hash&&e(location.href)}function g(){function a(a){function b(a){a.preventDefault(),e(this.getAttribute("href"))}"#"!==a.getAttribute("href")&&c(a,"click",b)}Array.prototype.forEach.call(document.querySelectorAll('a[href^="#"]'),a)}function j(){c(window,"hashchange",f)}function k(){setTimeout(f,ca)}function l(){Array.prototype.forEach&&document.querySelectorAll?(h("Setting up location.hash handlers"),g(),j(),k()):i("In page linking not fully supported in this browser! (See README.md for IE8 workaround)")}return ja.enable?l():h("In page linking not enabled"),{findTarget:e}}function D(){h("Enable public methods"),Ca.parentIFrame={autoResize:function(a){return!0===a&&!1===V?(V=!0,v()):!1===a&&!0===V&&(V=!1,z()),V},close:function(){S(0,0,"close"),A()},getId:function(){return pa},getPageInfo:function(a){"function"==typeof a?(Fa=a,S(0,0,"pageInfo")):(Fa=function(){},S(0,0,"pageInfoStop"))},moveToAnchor:function(a){ja.findTarget(a)},reset:function(){R("parentIFrame.reset")},scrollTo:function(a,b){S(b,a,"scrollTo")},scrollToOffset:function(a,b){S(b,a,"scrollToOffset")},sendMessage:function(a,b){S(0,0,"message",JSON.stringify(a),b)},setHeightCalculationMethod:function(a){ga=a,t()},setWidthCalculationMethod:function(a){Ba=a,u()},setTargetOrigin:function(a){h("Set targetOrigin: "+a),ua=a},size:function(a,b){O("size","parentIFrame.size("+(a||"")+(b?","+b:"")+")",a,b)}}}function E(){0!==ka&&(h("setInterval: "+ka+"ms"),la=setInterval(function(){O("interval","setInterval: "+ka)},Math.abs(ka)))}function F(){function b(a){function b(a){!1===a.complete&&(h("Attach listeners to "+a.src),a.addEventListener("load",f,!1),a.addEventListener("error",g,!1),k.push(a))}"attributes"===a.type&&"src"===a.attributeName?b(a.target):"childList"===a.type&&Array.prototype.forEach.call(a.target.querySelectorAll("img"),b)}function c(a){k.splice(k.indexOf(a),1)}function d(a){h("Remove listeners from "+a.src),a.removeEventListener("load",f,!1),a.removeEventListener("error",g,!1),c(a)}function e(b,c,e){d(b.target),O(c,e+": "+b.target.src,a,a)}function f(a){e(a,"imageLoad","Image loaded")}function g(a){e(a,"imageLoadFailed","Image load failed")}function i(a){O("mutationObserver","mutationObserver: "+a[0].target+" "+a[0].type),a.forEach(b)}function j(){var a=document.querySelector("body"),b={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0};return m=new l(i),h("Create body MutationObserver"),m.observe(a,b),m}var k=[],l=window.MutationObserver||window.WebKitMutationObserver,m=j();return{disconnect:function(){"disconnect"in m&&(h("Disconnect body MutationObserver"),m.disconnect(),k.forEach(d))}}}function G(){var a=0>ka;window.MutationObserver||window.WebKitMutationObserver?a?E():$=F():(h("MutationObserver not supported in this browser!"),E())}function H(a,b){function c(a){if(/^\d+(px)?$/i.test(a))return parseInt(a,W);var c=b.style.left,d=b.runtimeStyle.left;return b.runtimeStyle.left=b.currentStyle.left,b.style.left=a||0,a=b.style.pixelLeft,b.style.left=c,b.runtimeStyle.left=d,a}var d=0;return b=b||document.body,"defaultView"in document&&"getComputedStyle"in document.defaultView?(d=document.defaultView.getComputedStyle(b,null),d=null!==d?d[a]:0):d=c(b.currentStyle[a]),parseInt(d,W)}function I(a){a>ya/2&&(ya=2*a,h("Event throttle increased to "+ya+"ms"))}function J(a,b){for(var c=b.length,d=0,f=0,g=e(a),i=La(),j=0;j<c;j++)(d=b[j].getBoundingClientRect()[a]+H("margin"+g,b[j]))>f&&(f=d);return i=La()-i,h("Parsed "+c+" HTML elements"),h("Element position calculated in "+i+"ms"),I(i),f}function K(a){return[a.bodyOffset(),a.bodyScroll(),a.documentElementOffset(),a.documentElementScroll()]}function L(a,b){function c(){return i("No tagged elements ("+b+") found on page"),document.querySelectorAll("body *")}var d=document.querySelectorAll("["+b+"]");return 0===d.length&&c(),J(a,d)}function M(){return document.querySelectorAll("body *")}function N(b,c,d,e){function f(){ea=m,za=n,S(ea,za,b)}function g(){function b(a,b){return!(Math.abs(a-b)<=va)}return m=a!==d?d:Ma[ga](),n=a!==e?e:Na[Ba](),b(ea,m)||aa&&b(za,n)}function i(){return!(b in{init:1,interval:1,size:1})}function j(){return ga in qa||aa&&Ba in qa}function k(){h("No change in size detected")}function l(){i()&&j()?R(c):b in{interval:1}||k()}var m,n;g()||"init"===b?(P(),f()):l()}function O(a,b,c,d){function e(){a in{reset:1,resetPage:1,init:1}||h("Trigger event: "+b)}function f(){return wa&&a in ba}f()?h("Trigger event cancelled: "+a):(e(),"init"===a?N(a,b,c,d):Oa(a,b,c,d))}function P(){wa||(wa=!0,h("Trigger event lock on")),clearTimeout(xa),xa=setTimeout(function(){wa=!1,h("Trigger event lock off"),h("--")},ca)}function Q(a){ea=Ma[ga](),za=Na[Ba](),S(ea,za,a)}function R(a){var b=ga;ga=fa,h("Reset trigger event: "+a),P(),Q("reset"),ga=b}function S(b,c,d,e,f){function g(){a===f?f=ua:h("Message targetOrigin: "+f)}function i(){var g=b+":"+c,i=pa+":"+g+":"+d+(a!==e?":"+e:"");h("Sending message to host page ("+i+")"),ta.postMessage(na+i,f)}!0===sa&&(g(),i())}function T(a){function b(){return na===(""+a.data).substr(0,oa)}function c(){return a.data.split("]")[1].split(":")[0]}function d(){return a.data.substr(a.data.indexOf(":")+1)}function e(){return!("undefined"!=typeof module&&module.exports)&&"iFrameResize"in window||"jQuery"in window&&"iFrameResize"in window.jQuery.prototype}function f(){return a.data.split(":")[2]in{true:1,false:1}}function g(){var b=c();b in l?l[b]():e()||f()||i("Unexpected message ("+a.data+")")}function k(){!1===da?g():f()?l.init():h('Ignored message of type "'+c()+'". Received before initialization.')}var l={init:function(){ia=a.data,ta=a.source,j(),da=!1,setTimeout(function(){ha=!1},ca)},reset:function(){ha?h("Page reset ignored by init"):(h("Page size reset by host page"),Q("resetPage"))},resize:function(){O("resizeParent","Parent window requested size check")},moveToAnchor:function(){ja.findTarget(d())},inPageLink:function(){this.moveToAnchor()},pageInfo:function(){var a=d();h("PageInfoFromParent called from parent: "+a),Fa(JSON.parse(a)),h(" --")},message:function(){var a=d();h("MessageCallback called from parent: "+a),Da(JSON.parse(a)),h(" --")}};b()&&k()}function U(){"loading"!==document.readyState&&window.parent.postMessage("[iFrameResizerChild]Ready","*")}if("undefined"!=typeof window){var V=!0,W=10,X="",Y=0,Z="",$=null,_="",aa=!1,ba={resize:1,click:1},ca=128,da=!0,ea=1,fa="bodyOffset",ga=fa,ha=!0,ia="",ja={},ka=32,la=null,ma=!1,na="[iFrameSizer]",oa=na.length,pa="",qa={max:1,min:1,bodyScroll:1,documentElementScroll:1},ra="child",sa=!0,ta=window.parent,ua="*",va=0,wa=!1,xa=null,ya=16,za=1,Aa="scroll",Ba=Aa,Ca=window,Da=function(){i("MessageCallback function not defined")},Ea=function(){},Fa=function(){},Ga={height:function(){return i("Custom height calculation function not defined"),document.documentElement.offsetHeight},width:function(){return i("Custom width calculation function not defined"),document.body.scrollWidth}},Ha={},Ia=!1,Ja=!1;try{var Ka=Object.create({},{passive:{get:function(){Ia=!0}},once:{get:function(){Ja=!0}}});window.addEventListener("test",b,Ka),window.removeEventListener("test",b,Ka)}catch(Pa){}var La=Date.now||function(){return(new Date).getTime()},Ma={bodyOffset:function(){return document.body.offsetHeight+H("marginTop")+H("marginBottom")},offset:function(){return Ma.bodyOffset()},bodyScroll:function(){return document.body.scrollHeight},custom:function(){return Ga.height()},documentElementOffset:function(){return document.documentElement.offsetHeight},documentElementScroll:function(){return document.documentElement.scrollHeight},max:function(){return Math.max.apply(null,K(Ma))},min:function(){return Math.min.apply(null,K(Ma))},grow:function(){return Ma.max()},lowestElement:function(){return Math.max(Ma.bodyOffset()||Ma.documentElementOffset(),J("bottom",M()))},taggedElement:function(){return L("bottom","data-iframe-height")}},Na={bodyScroll:function(){return document.body.scrollWidth},bodyOffset:function(){return document.body.offsetWidth},custom:function(){return Ga.width()},documentElementScroll:function(){return document.documentElement.scrollWidth},documentElementOffset:function(){return document.documentElement.offsetWidth},scroll:function(){return Math.max(Na.bodyScroll(),Na.documentElementScroll())},max:function(){return Math.max.apply(null,K(Na))},min:function(){return Math.min.apply(null,K(Na))},rightMostElement:function(){return J("right",M())},taggedElement:function(){return L("right","data-iframe-width")}},Oa=f(N);c(window,"message",T),c(window,"readystatechange",U),U()}}();
}

//_Prtg.Initialisation.js
(function($, window, undefined) {
  var $feedback, watcher,$body;

  //executed when document ready
  function setup() {
    $body = $('#mainbody');


    if($body.length && !$body.is('.mapshow')) {
      _Prtg.Events = $body.Events(_Prtg.Options);

      $body.refreshable($('#mainbody')[0]); //dummy clock keeper

      
      Tinycon.setOptions({
        width: 7,
        height: 10,
        font: '9px arial',
        colour: '#ffffff',
        background: '#D21925',
        fallback: true
      });
      Tinycon.setImage('/favicon.ico').setBubble(0);
      
    } else {
      _Prtg.Events = {
        publish: function(){},
        subscribe: function(){},
        unsubscribe: function(){},
        subscribeOnce: function(){}
      };
    }

		_Prtg.desktopNotification.requestPermission();

    if(_Prtg.Options.currentUserId != -1) {
      _Prtg.Plugins["TCT"] && _Prtg.Plugins["TCT"].init.apply(null);
    }

    //keep help popover open if hovered
    var originalLeave = $.fn.popover.Constructor.prototype.leave;
    $.fn.popover.Constructor.prototype.leave = function(obj){
      var self = obj instanceof this.constructor ?
        obj : $(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.' + this.type)
      var container, timeout;
      originalLeave.call(this, obj);
      if(obj.currentTarget) {
        container = $('body .popover')
        timeout = self.timeout;
        container.one('mouseenter', function(){
          clearTimeout(timeout);
          container.one('mouseleave', function(){
            $.fn.popover.Constructor.prototype.leave.call(self, self);
          });
        })
      }
    };

    _Prtg.Events.subscribe('refresh.events.prtg', function() {
      $('.tooltip, .popover').remove();
    });

    $('body').tooltip({
      "animation": false,
      "selector": "[title]:not([data-helptext]),[data-original-title]:not([data-helptext])",
      "trigger": ' hover',
      "container": 'body',
      "placement": function(tooltip, elm) {
        $('.tooltip').remove();
        if (elm.hasAttribute('data-placement')) {
          return elm.getAttribute('data-placement') 
        } else if ($(elm).closest('.tableflyout').length > 0) {
          return "left"
        } 
        return "bottom"
      },
      "delay": { show: 333, hide: 0 },
      "html": true,
      "sanitize": false
    });

    $('body').popover({
      "animation": false,
      "selector": '[data-helptext]',
      "trigger": 'hover focus',
      "container": 'body',
      "placement": function(tooltip, elm) {
        $('.popover').remove();
        return elm.hasAttribute('data-placement') ? elm.getAttribute('data-placement') : "bottom";
      },
      "title": _Prtg.Lang.common.strings['help'],
      "content": function() {
        return $(this).data('helptext');
      },
      "delay": { show: 400, hide: 400 },
      "html": true,
      "sanitize": false
    });

    if($('body.publicmapshow').length === 0) {
      $.fn.ptip.install();
    }

    $.ajaxSetup({
      global: true,
      cache: false,
      timeout: _Prtg.Options.ajaxTimeout,
      traditional: true
    });

    _Prtg.xhrManager = {
      pool: [],
      xhrabort: function() {
        $.each(_Prtg.xhrManager.pool, function(idx, jqXHR) {
          jqXHR.abort();
        });
      }
    };

    var connectionLostTimer;
    $(document)
      .on("ajaxSend", function(e, jqXHR, options){
        if(jqXHR.ignoreManager === undefined) {
          jqXHR.ignoreManager = false;
        }
        if(jqXHR.ignoreManager !== true) {
          _Prtg.xhrManager.pool.push(jqXHR);
        }
      })
      .on("ajaxComplete", function(e, jqXHR, options) {
        if(!!connectionLostTimer) {
          connectionLostTimer = clearTimeout(connectionLostTimer);
        }
        _Prtg.xhrManager.pool = $.grep(_Prtg.xhrManager.pool, function(x){return x!=jqXHR;});
      })
      .on("ajaxError", function(event, jqXHR, ajaxSettings, thrownError) {

        // If error handled directly in ajax request, don't handle it again here
        if (ajaxSettings.handleErrors && ~ajaxSettings.handleErrors.indexOf(jqXHR.status)) return;

        if(jqXHR.ignoreError) return;
        if(thrownError === 'abort'
        || (typeof(thrownError) === 'object' && !!thrownError.message)
        || jqXHR.status === 556)
          return;
        if(!!console && !!console.log) console.log(arguments);

        if((jqXHR.status === 401 || jqXHR.status === 400) && jqXHR.getResponseHeader('LoginAgain') === 'true') {
          var self = this;
          _Prtg.Dialogs.defaultDialog('controls/loginform_small.htm').done(function(result) {
            var loadingDialog = _Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.multieditworking);
            $.post('/public/checklogin.htm', result).done(function(result) {
      				if(ajaxSettings.wingui) {
      					loadingDialog.dialog('destroy').remove();
      					window.prtgLoadContent("wingui.htm?action="+encodeURIComponent(ajaxSettings.url));
      				} else {
      					$.ajax(ajaxSettings).always(function() {
      						if(loadingDialog.hasClass('ui-dialog-content')) {
      						loadingDialog.dialog('destroy').remove();
      						}
      					});
      				}
            });
          }).fail(function() {
            document.location.reload();
          });
        } else if(jqXHR.status === 401 || jqXHR.status === 503) {
          document.location.reload()
        } else if((jqXHR.status % 199 > 0) && jqXHR.readyState === 4 && jqXHR.responseText.length > 0) {
          var error;
          var version;
          var errorContent = "";
          try {
            error = $($.parseXML(jqXHR.responseText));
            errorContent = error.find('error').text();
            version = '<b>Version</b>: ' + error.find('version').text() + '<br>';
          } catch(e) {
            errorContent = $(jqXHR.responseText).text();
          }


          _Prtg.Dialogs.alert(
            $('<div id="errordialog"><div class="ajaxerror">' + errorContent +
                ' <span style="cursor: pointer; text-decoration: underline;" onclick="$(\'.advancederrorinfo\').toggleClass(\'hide\');">' + _Prtg.Lang.common.strings.advancedinfo + '</a></div><p class="small wordwrap advancederrorinfo hide">' +
                  version +
                  '<b>'+_Prtg.Lang.common.strings.server + "</b>: " + location.host +'<br>' +
                  '<b>'+_Prtg.Lang.common.strings.url + '</b>: ' + ajaxSettings.url + (!!ajaxSettings.data ? '?' + decodeURIComponent(ajaxSettings.data) : '') +'<br>' +
                  '<b>Time</b>: ' + _Prtg.Util.getTimeString() +
                '</p>' +
              '</div>'),
            _Prtg.Lang.common.strings['error'] + (thrownError && ' ('+thrownError+') ') || '',
            jqXHR.status === 555 || !!jqXHR.ignoreHome ? {} : {
              buttons:[{
                html: _Prtg.Lang.Dialogs.strings.ok,
                'class': "actionbutton",
                click: function () {
                  if(jqXHR.gotoAfterError === false) {
                    $(this).dialog('destroy').remove();
                  } else {
                    document.location.href = jqXHR.gotoAfterError || "/home";
                  }
                }
              }]
            }
          );
        } else if(!connectionLostTimer && jqXHR.readyState === 0 && thrownError === "" && !_Prtg.Options.connectionLost) {
          connectionLostTimer = setTimeout(function() {
            _Prtg.Dialogs.connectionLost(ajaxSettings.url + ' ('+ (jqXHR.peNumber||thrownError||jqXHR.statusText) +')');
          }, 1000);
          return;
        }
        _Prtg.Growls.add({
          id: 'ajaxErrorGrowl',
          type: "info",
          title: _Prtg.Lang.common.strings.ajaxerror,
          message: _Prtg.Lang.common.strings.ajaxerror + ' ' + (jqXHR.peNumber ||'') + ":<br>" + thrownError,
          time: 4
        });
        _Prtg.api.logError(_Prtg.Lang.common.strings.ajaxerror.replace(' ','') + ": " + thrownError + ' - PE:' + (jqXHR.peNumber ||'none') + ' - ajaxSettings: ' + JSON.stringify(ajaxSettings).substring(0,250), {global:false});
      });

    $(window).on('unload', function() {
      _Prtg.xhrManager.xhrabort();
    });

    if(_Prtg.Options.currentUserId != -1) {
      fetchStatus()
      _Prtg.Events.subscribe('refresh.events.prtg', fetchStatus);
    }

    $('#helpcontainer').contexthelp();
  }
  
  function fetchStatus() {
    $.ajax({
      url: '/api/status.json',
      global: false,
      timeout: 30000,
      dataType: 'json',
      data: {
        asjson: true,
        id: (window.winguiid || _Prtg.Util.getUrlVars()['id'] || -1)
      },
    }).done(handleNewStatusData)
  }
  
  function handleNewStatusData(statusData) {
    _Prtg.serverTime.setTime(statusData.jsClock * 1000);
    _Prtg.Events.publish('refreshstatus.events.prtg', statusData)
  }

  // Stuff todo after new page loaded via ajax!
  function setupPage(parent) {
  	$('body').removeClass('page-initialized').addClass('page-initializing');
    if(!parent) {
      setupPage($('#container, #mainstuff'));
      return;
    }
    var $parent = !parent ? $('body') : (!(parent instanceof jQuery)) ? $(parent) : parent;
    if($parent.length) {
      !$body.is('.mapshow') && $parent.addClass('prtg-events-container').Events({});
      initPlugins($parent[0]);
    }

    decorateWitchPageIdentifier(document.location.pathname, $body, 'body');
    registerAddMenuEvents($parent);
  	$('body').removeClass('page-initializing').addClass('page-initialized');
  }

  function registerAddMenuEvents($container) {
  	var	showClass = "add-menu-open",
        eventDomain = 'click.' + showClass;

    $container.on('click mouseenter','.add-menu-badge', function(event){
	    var badge = $(this),
          addMenu = badge.parent().parent().find('.add-menu-wrapper .add-menu');

	    if (!addMenu.length) return;
      event.stopImmediatePropagation();
      addMenu.addClass(showClass)

    }).parent().on(eventDomain, function(){
			$(this).find('.add-menu-wrapper .add-menu').removeClass(showClass);
    });
	}
	
  function removePageIdentifiers($element, classSuffix) {
    var oldClasses = [],
        uniqueSuffix = '-' + classSuffix;
    if($element.length) {
      $.each($element.attr('class').split(/\s+/), function(i, className) {
        if(className.indexOf(uniqueSuffix)>-1) {
          oldClasses.push(className)
        }
      });
    }
    $.each(oldClasses, function(i, className) {
        $element.removeClass(className);
    });
  };

  function decorateWitchPageIdentifier(pathSource, $element, classSuffix) {
    if(!(pathSource && $element && $element instanceof jQuery && classSuffix))
        return;

    var lastSlash = pathSource.lastIndexOf('/'),
        lastDot = pathSource.lastIndexOf('.'),
        elementsWithOldIdentifiers = $("[class*='-" + classSuffix + "']");

    var pageNameStart = lastSlash === -1 ? 0 : lastSlash + 1,
        pageNameEnd = lastDot === -1 ? pathSource.length : lastDot,
        newPageClass = pathSource.substring(pageNameStart ,pageNameEnd) + '-' + classSuffix;

    removePageIdentifiers($element, classSuffix);
    $.each(elementsWithOldIdentifiers, function(i, $element) {
        removePageIdentifiers($element, classSuffix);
    });
    $element.addClass(newPageClass);
  }

  function initPlugins(parent) {
    // plugin must look like
    // <div class="prtg-plugin" data-plugin="PLUGINNAME" data-OPTIONALDATANAME="ANY OPTIONAL DATAVALUE EVEN JSON"></div>
    var $parent = !parent ? $('body') : (!(parent instanceof jQuery)) ? $(parent) : parent;

    $parent.find('.refreshable>.prtg-plugin').parent().removeClass('refreshable');
    $parent.find('.refreshable').toggleClass('refreshable refreshable-initialized clock-keeper-'+$parent.attr('id')).refreshable(parent);

    $parent.find('.prtg-plugin').toggleClass('prtg-plugin prtg-plugin-initializing').each(function initPlugin() {
      var self = this;
      var $self = $(this);
      var data = $self.data();
      var plugins = !!data && !!data.plugin && data.plugin.trim();
      var comment = $self.contents().filter(function(){return this.nodeType===8;});
      if(!!plugins) {
        plugins = plugins.split(' ');
        $.each(plugins, function(i, plugin){
          try {
            if(comment.length) {
              $.extend(true, data, JSON.parse(comment.get(0).nodeValue));
              comment.remove();
            }
            if ( !!_Prtg.Plugins[plugin]) $self[plugin] = _Prtg.Plugins[plugin].init.apply(self, [data, parent]);
            else $self[plugin](data, parent);
          } catch(e) {
            if(console && console.error) console.error('Error in plugin:', plugin, e.stack);
            _Prtg.api.logError("Error in plugin: " + plugin + ' - Error-Msg: ' + e.message + ' ' + e + " - Plugin-Data: " + JSON.stringify(data), {global:false});
          }
        });
      }
      data = null;
      comment =null;
    }).toggleClass('prtg-plugin-initialized prtg-plugin-initializing');

    if(_Prtg.Options.userIsReadOnly){
      $parent.find(".hideforreadonlyuser").remove();
    }
    loadlater($parent);
  }

  function loadOneLater(object, attribute, secondtry) {
    var $obj = $(object);
      if( $obj.find('.loadspinner').length == 0){
          $obj.append('<div class="loadspinner"></div>')
      }
    $obj.addClass("loading");
    $.ajax({
        url: encodeURI($obj.attr(attribute)),
        data:"",
        type: "POST",
        timeout: _Prtg.Options.ajaxTimeout*5,
        beforeSend: function(jqXHR){
          jqXHR.peNumber = 'PE1115';
        }
      }).done(function(html){
        $obj.addClass('prtg-events-container').Events({});
        $obj.removeClass("loading").html(html);
        initPlugins($obj);
      }).fail(function(){
        !secondtry && setTimeout(function(){loadOneLater(object, attribute, true);}, 500);
      });
  }
  function loadlater($elm){
    $elm.find(".loadlaterfirst").each(function () {
      loadOneLater(this, "loadurl");
    }).removeClass("loadlaterfirst");

    $elm.find(".loadlater").each(function(index) {
      if(index > 4) {
        setTimeout(function(){loadlater($elm);},500); //let's do the rest later to avoid overload!
        return false;
      } else {
        $(this).removeClass("loadlater");
        loadOneLater(this, "loadurl");
      }
    });
  }

  function addStyleSheet(rules){
  	$style = $("<style type='text/css' rel='stylesheet' name='_Prtg.Ininitialisation.js'/>").appendTo($("head"));
		if ($style[0].styleSheet) { // IE
			$style[0].styleSheet.cssText = rules.join(" ");
		}
		else {
			$style[0].appendChild(document.createTextNode(rules.join(" ")));
		}
  }
  $.extend(true, _Prtg, {
    Setup: setup,
    SetupPage: setupPage,
    initPlugins: initPlugins,
    decorateWitchPageIdentifier: decorateWitchPageIdentifier,
    removePageIdentifiers: removePageIdentifiers
  });
})(jQuery, window);


  var actualBrowserInclude = {
    "current": {
        "desktop": {
            "c": 72,
            "e": 18,
            "f": 65,
            "i": 11,
            "ios": 10.3,
            "o": 57,
            "s": 12,
            "vivaldi": 1.8
        },
        "mobile": {
            "android": 0,
            "c": 71,
            "f": 64,
            "o": 46
        }
    }
}
// prebuild action on bmx
// this file should be downloaded and updated from
// https://github.com/browser-update/browser-update/browser.json
;
  (function(window, document, undefined){
//(c)2017, MIT Style License <browser-update.org/LICENSE.txt>
//https://github.com/browser-update/browser-update/blob/master/update.js
//unmodified
if (window.nocheck) {
    return
}
function $bu_getBrowser(ua_str) {
    var n,t,ua=ua_str||navigator.userAgent,donotnotify=false;
    var names={i:'Internet Explorer',e:"Edge",f:'Firefox',o:'Opera',s:'Safari',n:'Netscape',c:"Chrome",a:"Android Browser", y:"Yandex Browser",v:"Vivaldi",uc:"UC Browser",x:"Other"};
    function ignore(reason,pattern){if (RegExp(pattern,"i").test(ua)) return reason;}
    var ig=ignore("bot","bot|spider|archiver|transcoder|crawl|checker|monitoring|screenshot|python-|php|uptime|validator|fetcher|facebook|slurp|google|yahoo|microsoft|node|mail.ru|github|cloudflare|addthis|thumb|proxy|feed|fetch|favicon|link|http|scrape|seo|page|search console|AOLBuild|Teoma|Gecko Expeditor")||
        ignore("discontinued browser","camino|flot|k-meleon|fennec|galeon|chromeframe|coolnovo") ||
        ignore("complicated device browser","SMART-TV|SmartTV") ||
        ignore("niche browser","Dorado|Whale|SamsungBrowser|MIDP|wii|Puffin|Opera Mini|maxthon|maxton|dolfin|dolphin|seamonkey|opera mini|netfront|moblin|maemo|arora|kazehakase|epiphany|konqueror|rekonq|symbian|webos|PaleMoon|QupZilla|Otter|Midori|qutebrowser") ||
        ignore("mobile without upgrade path or landing page","kindle|silk|blackberry|bb10|RIM|PlayBook|meego|nokia|ucweb|ZuneWP7|537.85.10") ||
        ignore("android(chrome) web view","; wv");
    var mobile=(/iphone|ipod|ipad|android|mobile|phone|ios|iemobile/i.test(ua));
    if (ig)
        return {n:"x",v:0,t:"other browser",donotnotify:ig};

    var pats=[
        ["CriOS.VV","c"],
        ["FxiOS.VV","f"],
        ["Trident.*rv:VV","i"],
        ["Trident.VV","io"],
        ["UCBrowser.VV","uc"],
        ["MSIE.VV","i"],
        ["Edge.VV","e"],
        ["Vivaldi.VV","v"],
        ["OPR.VV","o"],
        ["YaBrowser.VV","y"],
        ["Chrome.VV","c"],
        ["Firefox.VV","f"],
        ["Version.VV.*Safari","s"],
        ["Safari.VV","so"],
        ["Opera.*Version.VV","o"],
        ["Opera.VV","o"],
        ["Netscape.VV","n"]
    ];
    for (var i=0; i <pats.length; i++) {
        if (ua.match(new RegExp(pats[i][0].replace("VV","(\\d+\\.?\\d+)"),"i"))) {
            n=pats[i][1];
            break;
        }
    }

    var semver=n==="v"||n==="y"||n==="uc";
    if (semver) {//zero pad semver for easy comparing
        var parts = (RegExp.$1).split('.');
        var v=(parts[0] + "." + ("00".substring(0, 2 - parts[1].length) + parts[1]));
    }
    else {
        var v=Math.round(parseFloat(RegExp.$1)*10)/10;
    }

    if (!n)
        return {n:"x",v:0,t:(names[n]||"unknown"),mobile:mobile};

    //do not notify old systems since there is no up-to-date browser available
    if (/windows.nt.5.0|windows.nt.4.0|windows.95|windows.98|os x 10.2|os x 10.3|os x 10.4|os x 10.5|os x 10.6|os x 10.7/i.test(ua))
        donotnotify="oldOS";

    //iOS
    if (/iphone|ipod|ipad|ios/i.test(ua)) {
        ua.replace("_",".").match(new RegExp("OS.(\\d+\\.?\\d?)","i"));//
        n="iOS";
        v=parseFloat(RegExp.$1);
        var h = Math.max(window.screen.height, window.screen.width);
        if (h<=480 || window.devicePixelRatio<2) //iphone <5 and old iPads  // (h>568 -->iphone 6+)
              return {n:"s",v:v,t:"iOS "+v,donotnotify:"iOS without upgrade path",mobile:mobile};
        return {n:"s",v:v,t:"iOS "+v,donotnotify:false,mobile:mobile};//identify as safari
    }

    //check for android stock browser
    if (ua.indexOf('Android')>-1 && n==="s") {
        var ver=parseInt((/WebKit\/([0-9]+)/i.exec(ua) || 0)[1],10) || 2000;
        if (ver <= 534)
            return {n:"a",v:ver,t:names["a"],mob:true,donotnotify:donotnotify,mobile:mobile};
        //else
        //    return {n:n,v:v,t:names[n]+" "+v,donotnotify:"mobile on android",mobile:mobile};
    }

    //do not notify firefox ESR
    if (n=="f" && (Math.round(v)==60 || Math.round(v)==68))
        donotnotify="ESR";

    if (n=="so") {
        v=4.0;
        n="s";
    }
    if (n=="i" && v==7 && window.XDomainRequest) {
        v=8;
    }
    if (n=="io") {
        n="i";
        if (v>6) v=11;
        else if (v>5) v=10;
        else if (v>4) v=9;
        else if (v>3.1) v=8;
        else if (v>3) v=7;
        else v=9;
    }
    if (n=="e") {
        return {n:"i",v:v,t:(names[n]||"unknown")+" "+v,donotnotify:donotnotify,mobile:mobile};
    }
    return {n:n,v:v,t:(names[n]||"unknown")+" "+v,donotnotify:donotnotify,mobile:mobile};
	}


  //(c)2017, MIT Style License <browser-update.org/LICENSE.txt>
//https://github.com/browser-update/browser-update/blob/master/update.js
//
  $buo = function(op, test) {
    var jsv = 24;
    var n = window.navigator;
    var b;
    var vsdefault = { i: 11, f: -4, o: -4, s: -2, n: 12, c: -4, a: 534, y: -1, v: -0.2 };
    var vsmin = { i: 11, f: 10, o: 20, s: 7, n: 12, c: 33};
    var vs = {x: 9999999};
    var akt = actualBrowserInclude;
    var vsakt = {};
    var ls = !!localStorage && localStorage.getItem("browsercheck");

    if(ls !== null){
      if(ls === "false")
        return;
      else if(typeof(ls) === "string"){
        try{
          ls = JSON.parse(ls);
        }catch(e){
          ls = false;
        }
      }
      if(ls !== false && !!ls.l && !!ls.b){
        if (ls.b.donotnotify) return;
        window.isunsupportedbrowser = true;
        $bu_show(ls.l,ls.b);
        return;
      }
    }
    akt = akt.current.desktop;
    this.op = op || {};

	  vsakt["c"] = akt["c"];
	  vsakt["f"] = akt["f"];
	  vsakt["i"] = akt["i"];
	  vsakt["o"] = akt["o"];
	  vsakt["s"] = akt["s"];
	  vsakt["e"] = akt["e"];

    for (b in vsdefault) {
      if (!vs[b]) vs[b] = vsdefault[b];
      if (vsakt[b] && vs[b] >= vsakt[b]) vs[b] = vsakt[b] - 0.2;
      if (vsakt[b] && vs[b] <0) vs[b] = vsakt[b] + vs[b];
      if (vsmin[b] && vs[b] <vsmin[b]) vs[b] = vsmin[b];
    }

    this.op.onshow = op.onshow || function(o) {};
    this.op.onclick = op.onclick || function(o) {};
    this.op.onclose = op.onclose || function(o) {};

    var bb = $bu_getBrowser(test);
    if (!bb
      || !bb.n
      || (document.cookie.indexOf("browserupdateorg=pause") > -1 && this.op.reminder > 0)
      || bb.v >= vs[bb.n]
      || (bb.mobile && op.mobile === false)
     ){
     		 //!!test && !!console && console.log("Browser OK", bb, vs)
      		return;
    } else {
      if (bb.donotnotify == 'ESR') return;
    }

    if (this.op.nomessage) {
      op.onshow(this.op);
      return;
    }
    var ll = op.l || (n.languages ? n.languages[0] : null) || n.language || n.browserLanguage || n.userLanguage || document.documentElement.getAttribute("lang") || "en";
    ll = ll.replace("_","-").toLowerCase().substr(0,2);
    window.isunsupportedbrowser = true;
    $bu_show(ll, bb)

  };

  function $bu_show(ll,bb){
    var t = {};
    t.en = '<b>Your web browser (%s) is out of date</b>. For more security, comfort and the best experience on this site: <a%s>Update your browser</a> <a%s>Ignore</a>';
    t.de = '<b>Ihr Browser (%s) ist veraltet</b>. Aktualisieren sie ihren Browser für mehr Sicherheit, Komfort und die einwandfreie Nutzung dieser Webseite. <a%s>Browser aktualisieren</a> <a%s>Ignorieren</a>';
    t.it = '<b>Il tuo browser (%s) non è aggiornato</b>. Ha delle falle di sicurezza e potrebbe non visualizzare correttamente le pagine di questo e altri siti. <a%s>Actualice su navegador</a> <a%s>Chiudi</a>';
    t.pl = 'Przeglądarka (%s), której używasz, jest przestarzała. Posiada ona udokumentowane <b>luki bezpieczeństwa, inne wady</b> oraz <b>ograniczoną funkcjonalność</b>. Tracisz możliwość skorzystania z pełni możliwości oferowanych przez niektóre strony internetowe. <a%s>Dowiedz się jak zaktualizować swoją przeglądarkę</a>.';
    t.es = '<b>Su navegador (%s) no está actualizado</b>. Tiene fallos de seguridad conocidos y podría no mostrar todas las características de este y otros sitios web. <a%s>Averigüe cómo actualizar su navegador.</a> <a%s>Cerrar</a>';
    t.nl = 'Uw browser (%s) is <b>oud</b>. Het heeft bekende <b>veiligheidsissues</b> en kan <b>niet alle mogelijkheden</b> weergeven van deze of andere websites. <a%s>Lees meer over hoe uw browser te upgraden</a>';
    t.pt = '<b>Seu navegador (%s) está desatualizado</b>. Ele possui falhas de segurança e pode apresentar problemas para exibir este e outros websites. <a%s>Veja como atualizar o seu navegador</a> <a%s>Fechar</a>';
    t.sl = 'Vaš brskalnik (%s) je <b>zastarel</b>. Ima več <b>varnostnih pomankljivosti</b> in morda <b>ne bo pravilno prikazal</b> te ali drugih strani. <a%s>Poglejte kako lahko posodobite svoj brskalnik</a>';
    t.ru = 'Ваш браузер (%s) <b>устарел</b>. Он имеет <b>уязвимости в безопасности</b> и может <b>не показывать все возможности</b> на этом и других сайтах. <a%s>Узнайте, как обновить Ваш браузер</a>';
    t.id = 'Browser Anda (%s) sudah <b>kedaluarsa</b>. Browser yang Anda pakai memiliki <b>kelemahan keamanan</b> dan mungkin <b>tidak dapat menampilkan semua fitur</b> dari situs Web ini dan lainnya. <a%s> Pelajari cara memperbarui browser Anda</a>';
    t.uk = 'Ваш браузер (%s) <b>застарів</b>. Він <b>уразливий</b> й може <b>не відображати всі можливості</b> на цьому й інших сайтах. <a%s>Дізнайтесь, як оновити Ваш браузер</a>';
    t.ko = '지금 사용하고 계신 브라우저(%s)는 <b>오래되었습니다.</b> 알려진 <b>보안 취약점</b>이 존재하며, 새로운 웹 사이트가 <b>깨져 보일 수도</b> 있습니다. <a%s>브라우저를 어떻게 업데이트하나요?</a>';
    t.rm = 'Tes navigatur (%s) è <b>antiquà</b>. El cuntegna <b>problems da segirezza</b> enconuschents e mussa eventualmain <b>betg tut las funcziuns</b> da questa ed autras websites. <a%s>Emprenda sco actualisar tes navigatur</a>.';
    t.jp = 'お使いのブラウザ「%s」は、<b>時代遅れ</b>のバージョンです。既知の<b>脆弱性</b>が存在するばかりか、<b>機能不足</b>によって、サイトが正常に表示できない可能性があります。 <a%s>ブラウザを更新する方法を確認する</a>';
    t.fr = '<b>Votre navigateur (%s) est périmé</b>. Il contient des failles de sécurité et pourrait ne pas afficher certaines fonctionnalités des sites internet récents. <a%s>Mettre le navigateur à jour</a> <a%s>Fermer</a>';
    t.da = 'Din browser (%s) er <b>for&aelig;ldet</b>. Den har kendte <b>sikkerhedshuller</b> og kan m&aring;ske <b>ikke vise alle funktioner</b> p&aring; dette og andre websteder. <a%s>Se hvordan du opdaterer din browser</a>';
    t.sq = 'Shfletuesi juaj (%s) është <b>ca i vjetër</b>. Ai ka <b>të meta sigurie</b> të njohura dhe mundet të <b>mos i shfaqë të gjitha karakteristikat</b> e kësaj dhe shumë faqeve web të tjera. <a%s>Mësoni se si të përditësoni shfletuesin tuaj</a>';
    t.ca = 'El teu navegador (%s) està <b>desactualitzat</b>. Té <b>vulnerabilitats</b> conegudes i pot <b>no mostrar totes les característiques</b> d\'aquest i altres llocs web. <a%s>Aprèn a actualitzar el navegador</a>';
    t.fa = 'مرورگر شما (%s) <b>از رده خارج شده</b> می باشد. این مرورگر دارای <b>مشکلات امنیتی شناخته شده</b> می باشد و <b>نمی تواند تمامی ویژگی های این</b> وب سایت و دیگر وب سایت ها را به خوبی نمایش دهد. <a%s>در خصوص گرفتن راهنمایی درخصوص نحوه ی به روز رسانی مرورگر خود اینجا کلیک کنید.</a>';
    t.sv = 'Din webbläsare (%s) är <b>föråldrad</b>. Den har kända <b>säkerhetshål</b> och <b>kan inte visa alla funktioner korrekt</b> på denna och på andra webbsidor. <a%s>Uppdatera din webbläsare idag</a>';
    t.hu = 'Az Ön böngészője (%s) <b>elavult</b>. Ismert <b>biztonsági hiányosságai</b> vannak és esetlegesen <b>nem tud minden funkciót megjeleníteni</b> ezen vagy más weboldalakon. <a%s>Itt talál bővebb információt a böngészőjének frissítésével kapcsolatban</a>     ';
    t.gl = 'O seu navegador (%s) está <b>desactualizado</b>. Ten coñecidos <b>fallos de seguranza</b> e podería <b>non mostrar tódalas características</b> deste e outros sitios web. <a%s>Aprenda como pode actualizar o seu navegador</a>';
    t.cs = 'Váš prohlížeč (%s) je <b>zastaralý</b>. Jsou známy <b>bezpečnostní rizika</b> a možná <b>nedokáže zobrazit všechny prvky</b> této a dalších webových stránek. <a%s>Naučte se, jak aktualizovat svůj prohlížeč</a>';
    t.he = 'הדפדפן שלך (%s) <b>אינו מעודכן</b>. יש לו <b>בעיות אבטחה ידועות</b> ועשוי <b>לא להציג את כל התכונות</b> של אתר זה ואתרים אחרים. <a%s>למד כיצד לעדכן את הדפדפן שלך</a>';
    t.nb = 'Nettleseren din (%s) er <b>utdatert</b>. Den har kjente <b>sikkerhetshull</b> og <b>kan ikke vise alle funksjonene</b> på denne og andre websider. <a%s>Lær hvordan du kan oppdatere din nettleser</a>';
    t["zh-tw"] = '您的瀏覽器(%s) 需要更新。該瀏覽器有諸多安全漏洞，無法顯示本網站的所有功能。 <a%s>瞭解如何更新瀏覽器</a>';
    t.zh = '<b>您的网页浏览器 (%s) 已过期</b>。更新您的浏览器，以提高安全性和舒适性，并获得访问本网站的最佳体验。<a%s>更新浏览器</a> <a%s>忽略</a>';
    t.fi = 'Selaimesi (%s) on <b>vanhentunut</b>. Siinä on tunnettuja tietoturvaongelmia eikä se välttämättä tue kaikkia ominaisuuksia tällä tai muilla sivustoilla. <a%s>Lue lisää siitä kuinka päivität selaimesi</a>.';
    t.tr = 'Tarayıcınız (%s) <b>güncel değil</b>. Eski versiyon olduğu için <b>güvenlik açıkları</b> vardır ve görmek istediğiniz bu web sitesinin ve diğer web sitelerinin <b>tüm özelliklerini hatasız bir şekilde</b> gösteremeyecektir. <a%s>Tarayıcınızı nasıl güncelleyebileceğinizi öğrenin</a>';
    t.ro = 'Browser-ul (%s) tau este <b>invechit</b>. Detine <b>probleme de securitate</b> cunoscute si poate <b>sa nu afiseze corect</b> toate elementele acestui si altor site-uri. <a%s>Invata cum sa-ti actualizezi browserul.</a>';
    t.bg = 'Вашият браузър (%s) <b>не е актуален</b>. Известно е, че има <b>пропуски в сигурността</b> и може <b>да не покаже правилно</b> този или други сайтове. <a%s>Научете как да актуализирате браузъра си</a>.';
    t.el = 'Αυτός ο ιστότοπος σας υπενθυμίζει: Ο φυλλομετρητής σας (%s) είναι <b>παρωχημένος</b>. <a%s>Ενημερώστε το πρόγραμμα περιήγησής σας</a> για μεγαλύτερη ασφάλεια και άνεση σε αυτήν την ιστοσελίδα.';
    t.ar = 'متصفحك (%s) <b>منتهى الصلاحيه</b>. ويوجد به <b>ثغرات امنية</b> معروفة وقد <b>لا يُشغل كثير من الميزات</b> المتعلقه بهذه الموقع. <a%s>أضغط هنا</a>لتعرف كيف تقوم بتحديث متصفحك';
    t.sr = 'Vaš pretraživač (%s) je <b>zastareo</b>. Ima poznate <b>sigurnosne probleme</b> i najverovatnije <b>neće prikazati sve funkcionalnisti</b> ovog i drugih sajtova. <a%s>Nauči više o nadogradnji svog pretraživača</a>';
    t.la = 'Mēs vēlamies Jums atgādināt: Jūsu pārlūkprogramma (%s) ir novecojusi. <a>Atjauniniet savu pārlūkprogrammu</a>, lai uzlabotu drošību, ātrumu un pārlūkošanas ērtības šajā un citās lapās.';
    t.ga = 'Tá an líonléitheoir agat (%s) <b>as dáta</b>. Tá <b>laigeachtaí slándála</b> a bhfuil ar eolas ann agus b\'fhéidir <b>nach taispeánfaidh sé gach gné</b> den suíomh gréasáin seo ná cinn eile. <a%s>Foghlaim conas do líonléitheoir a nuashonrú</a>';
    t.lv = 'Jūsu pārlūkprogramma (%s) ir <b>novecojusi</b>.  Tai ir zināmas <b>drošības problēmas</b>, un tā var attēlot šo un citas  tīmekļa lapas <b>nekorekti</b>. <a%s>Uzzini, kā atjaunot savu pārlūkprogrammu</a>';
    t.no = 'Dette nettstedet ønsker å minne deg på: Din nettleser (%s) er <b>utdatert</b>. <a%s>Oppdater nettleseren din </a> for mer sikkerhet, komfort og den beste opplevelsen på denne siden.';
    t.th = 'เว็บไซต์นี้อยากจะเตือนคุณ: เบราว์เซอร์ (%s) ของคุณนั้น <b>ล้าสมัยแล้ว</b> <a%s>ปรับปรุงเบราว์เซอร์ของคุณ</a> เพื่อเพิ่ม ความปลอดภัย ความสะดวกสบายและประสบการณ์ที่ดีที่สุดในเว็บไซต์นี้';
    t.hi = 'यह वेबसाइट आपको याद दिलाना चाहती हैं: आपका ब्राउज़र (%s) <b> आउट ऑफ़ डेट </ b> हैं। <a%s> और अधिक सुरक्षा, आराम और इस साइट पर सबसे अच्छा अनुभव करने लिए आपके ब्राउज़र को अपडेट करें</a>।';
    t.sk = 'Chceli by sme Vám pripomenúť: Váš prehliadač (%s) je <b>zastaralý</b>. <a%s>Aktualizujte si ho</a> pre viac bezpečnosti, pohodlia a pre ten najlepší zážitok na tejto stránke.';
    t.vi = 'Website này xin nhắc bạn rằng: Trình duyệt (%s) của bạn hiện đã <b>lỗi thời</b>. <a%s>Hãy cập nhật trình duyệt của bạn</a> để tăng thêm tính bảo mật, sự tiện lợi và trải nghiệm tuyệt nhất trên trang web này.';

    var text = t[ll] || t.en;
    text = busprintf(text, bb.t, ' class="update arrow" href="//www.google.com/chrome" target="_blank"' ,' style="display:none"');
    var div = document.createElement('div');
    div.className = "browsercheck container";
    var _prtg = window._PRTG || undefined;
    div.innerHTML = '<div class="browsercheck_inner">' +
                        ( _prtg != undefined  
                          ? '<button title="'+_Prtg.Lang.Dialogs.strings.close+'" class="browsercheck-ignore ignore glyph-cancel-1"></button>'
                          : '<button class="browsercheck-ignore ignore glyph-cancel-1"></button>'
                        ) +
                        '<p>' + text + '</p>' +
                    '</div>';
    document.body.insertBefore(div, document.getElementById("container"));
    document.getElementsByClassName("browsercheck-ignore")[0].onclick = function(){
      !!localStorage && localStorage.setItem("browsercheck", false);
      div.style ="display:none"
    };
    !!localStorage && localStorage.setItem("browsercheck", JSON.stringify({l:ll,b:bb}));
  }

  function busprintf() {
    var args = arguments;
    var data = args[0];
    for (var k = 1; k <args.length; ++k)
      data = data.replace(/%s/, args[k]);
    return data;
  }

  function getURLParameter(name) {
    return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
  }

  //test add browsercheck = {"l":"en","b":{"n":"c","v":10,"t":"Chrome 10","donotnotify":false,"mobile":false}} to localStrorage
  //or add browser=ABCD.12 to the URL
  var test = getURLParameter('browser');
  if(!!test)
    localStorage.removeItem("browsercheck")
  $buo({mobile: false}, test);

})(window, document);



/*
//        You can use this file to modify the appearance of the PRTG web interface
//        as described in https://kb.paessler.com/en/topic/33
//        
//        Please note that you are using an unsupported and deprecated feature. 
//        Your changes will be broken or removed with future PRTG updates.
//        
//        If you modify this file, PLEASE LET US KNOW what you're changing and why!
//        Just drop an email to support@paessler.com and help us understand your 
//        needs. Thank you!       
*/



// The ONE and !!!!!ONLY!!!! document.ready function!!!
    $(function() {
        _Prtg.Setup();
        _Prtg.SetupPage($('body'));

        if(_Prtg.Options.currentUserId != -1) {
          !!_Prtg.Plugins.TCT && _Prtg.Plugins.TCT.plugin.init(null, document.body);
        }
    });

// IE Handling / Javascriptfile on demand laoder
    // IE only
    if(/MSIE \d|Trident.*rv:/.test(navigator.userAgent)){
        loadScript('/javascript/ieonly.js')
        loadScript('/javascript/lib/jquery-migrate-1.2.1.min.js')
        console.warn('[PRTG] Internet Explorer detected: Compatibility mode initialized')
    // Every browser but IE
    }

    function loadScript(filepath){
        var scriptTag = document.createElement("script")
        scriptTag.type = "text/javascript";
        scriptTag.src = filepath
        document.getElementsByTagName("head")[0].appendChild(scriptTag)
    }